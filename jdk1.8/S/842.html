<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/prefs/XmlSupport.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L97">[^]</a><a href="#L417">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L97" title="Defined at 97.">export</a></li>
<li><a href="#L138" title="Defined at 138.">putPreferencesInXml</a></li>
<li><a href="#L195" title="Defined at 195.">importPreferences</a></li>
<li><a href="#L223" title="Defined at 223.">createPrefsDoc</a></li>
<li><a href="#L238" title="Defined at 238.">loadPrefsDoc</a></li>
<li><a href="#L259" title="Defined at 259.">writeDoc</a></li>
<li><a href="#L288" title="Defined at 288.">ImportSubtree</a></li>
<li><a href="#L325" title="Defined at 325.">ImportPrefs</a></li>
<li><a href="#L342" title="Defined at 342.">exportMap</a></li>
<li><a href="#L371" title="Defined at 371.">importMap</a></li>
<li><a href="#L397" title="Defined at 397.">resolveEntity</a></li>
<li><a href="#L411" title="Defined at 411.">error</a></li>
<li><a href="#L414" title="Defined at 414.">fatalError</a></li>
<li><a href="#L417" title="Defined at 417.">warning</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.prefs;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.*;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.io.*;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> javax.xml.parsers.*;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> javax.xml.transform.*;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> javax.xml.transform.dom.*;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> javax.xml.transform.stream.*;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> org.xml.sax.*;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> org.w3c.dom.*;
<a id="L36" name="L36"></a>  36 
<div class="comment">
  XML Support for java.util.prefs. Methods to import and export preference
  nodes and subtrees.
  @author  Josh Bloch and Mark Reinhold
  @see     Preferences
  @since   1.4</div>
<a id="L45" name="L45"></a>  45 <strong class="reserved">class</strong> <a href="../R/9291.html" title="Multiple referred from 5 places.">XmlSupport</a> <em class="brace">{</em>
<a id="L46" name="L46"></a>  46     <em class="comment">// The required DTD URI for exported preferences</em>
<a id="L47" name="L47"></a>  47     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> PREFS_DTD_URI =
<a id="L48" name="L48"></a>  48         "http://java.sun.com/dtd/preferences.dtd";
<a id="L49" name="L49"></a>  49 
<a id="L50" name="L50"></a>  50     <em class="comment">// The actual DTD corresponding to the URI</em>
<a id="L51" name="L51"></a>  51     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> PREFS_DTD =
<a id="L52" name="L52"></a>  52         "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;" +
<a id="L53" name="L53"></a>  53 
<a id="L54" name="L54"></a>  54         "&lt;!-- DTD for preferences --&gt;"               +
<a id="L55" name="L55"></a>  55 
<a id="L56" name="L56"></a>  56         "&lt;!ELEMENT preferences (root) &gt;"             +
<a id="L57" name="L57"></a>  57         "&lt;!ATTLIST preferences"                      +
<a id="L58" name="L58"></a>  58         " EXTERNAL_XML_VERSION CDATA \"0.0\"  &gt;"     +
<a id="L59" name="L59"></a>  59 
<a id="L60" name="L60"></a>  60         "&lt;!ELEMENT root (map, node*) &gt;"              +
<a id="L61" name="L61"></a>  61         "&lt;!ATTLIST root"                             +
<a id="L62" name="L62"></a>  62         "          type (system|user) #REQUIRED &gt;"   +
<a id="L63" name="L63"></a>  63 
<a id="L64" name="L64"></a>  64         "&lt;!ELEMENT node (map, node*) &gt;"              +
<a id="L65" name="L65"></a>  65         "&lt;!ATTLIST node"                             +
<a id="L66" name="L66"></a>  66         "          name CDATA #REQUIRED &gt;"           +
<a id="L67" name="L67"></a>  67 
<a id="L68" name="L68"></a>  68         "&lt;!ELEMENT map (entry*) &gt;"                   +
<a id="L69" name="L69"></a>  69         "&lt;!ATTLIST map"                              +
<a id="L70" name="L70"></a>  70         "  MAP_XML_VERSION CDATA \"0.0\"  &gt;"         +
<a id="L71" name="L71"></a>  71         "&lt;!ELEMENT entry EMPTY &gt;"                    +
<a id="L72" name="L72"></a>  72         "&lt;!ATTLIST entry"                            +
<a id="L73" name="L73"></a>  73         "          key CDATA #REQUIRED"              +
<a id="L74" name="L74"></a>  74         "          value CDATA #REQUIRED &gt;"          ;
<div class="comment">
      Version number for the format exported preferences files.</div>
<a id="L78" name="L78"></a>  78     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> EXTERNAL_XML_VERSION = "1.0";
<a id="L79" name="L79"></a>  79 
<div class="comment">
      Version number for the internal map files.</div>
<a id="L83" name="L83"></a>  83     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> MAP_XML_VERSION = "1.0";
<a id="L84" name="L84"></a>  84 
<div class="comment">
      Export the specified preferences node and, if subTree is true, all
      subnodes, to the specified output stream.  Preferences are exported as
      an XML document conforming to the definition in the Preferences spec.
      @throws IOException if writing to the specified output stream
              results in an <tt>IOException</tt>.
      @throws BackingStoreException if preference data cannot be read from
              backing store.
      @throws IllegalStateException if this node (or an ancestor) has been
              removed with the {@link Preferences#removeNode()} method.</div>
<a id="L97" name="L97"></a>  97     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/14158.html" title="Multiple referred from 5 places.">export</a>(<a href="../D/6445.html" title="Multiple defined in 3 places.">OutputStream</a> os, <strong class="reserved">final</strong> <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a> p, <strong class="reserved">boolean</strong> subTree)
<a id="L98" name="L98"></a>  98         <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/836.html#L38" title="Defined at 38 in src/java/util/prefs/BackingStoreException.java.">BackingStoreException</a> <em class="brace">{</em>
<a id="L99" name="L99"></a>  99         <strong class="reserved">if</strong> (((<a href="../S/839.html#L123" title="Defined at 123 in src/java/util/prefs/AbstractPreferences.java.">AbstractPreferences</a>)p).<a href="../S/839.html#L1436" title="Defined at 1436 in src/java/util/prefs/AbstractPreferences.java.">isRemoved</a>())
<a id="L100" name="L100"></a> 100             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>("Node has been removed");
<a id="L101" name="L101"></a> 101         <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc = <a href="../S/842.html#L223" title="Defined at 223 in src/java/util/prefs/XmlSupport.java.">createPrefsDoc</a>("preferences");
<a id="L102" name="L102"></a> 102         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> preferences =  doc.<a href="../D/18558.html" title="Multiple defined in 7 places.">getDocumentElement</a>() ;
<a id="L103" name="L103"></a> 103         preferences.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("EXTERNAL_XML_VERSION", EXTERNAL_XML_VERSION);
<a id="L104" name="L104"></a> 104         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlRoot =  (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>)
<a id="L105" name="L105"></a> 105         preferences.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("root"));
<a id="L106" name="L106"></a> 106         xmlRoot.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("type", (p.<a href="../D/26425.html" title="Multiple defined in 2 places.">isUserNode</a>() ? "user" : "system"));
<a id="L107" name="L107"></a> 107 
<a id="L108" name="L108"></a> 108         <em class="comment">// Get bottom-up list of nodes from p to root, excluding root</em>
<a id="L109" name="L109"></a> 109         <a href="../D/5090.html" title="Multiple defined in 5 places.">List</a>&lt;<a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>&gt; ancestors = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;&gt;();
<a id="L110" name="L110"></a> 110 
<a id="L111" name="L111"></a> 111         <strong class="reserved">for</strong> (<a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a> kid = p, dad = kid.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>(); dad != <strong class="reserved">null</strong>;
<a id="L112" name="L112"></a> 112                                    kid = dad, dad = kid.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>()) <em class="brace">{</em>
<a id="L113" name="L113"></a> 113             ancestors.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(kid);
<a id="L114" name="L114"></a> 114         <em class="brace">}</em>
<a id="L115" name="L115"></a> 115         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> e = xmlRoot;
<a id="L116" name="L116"></a> 116         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=ancestors.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()-1; i &gt;= 0; i--) <em class="brace">{</em>
<a id="L117" name="L117"></a> 117             e.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("map"));
<a id="L118" name="L118"></a> 118             e = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) e.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("node"));
<a id="L119" name="L119"></a> 119             e.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("name", ancestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i).<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>());
<a id="L120" name="L120"></a> 120         <em class="brace">}</em>
<a id="L121" name="L121"></a> 121         <a href="../S/842.html#L138" title="Defined at 138 in src/java/util/prefs/XmlSupport.java.">putPreferencesInXml</a>(e, doc, p, subTree);
<a id="L122" name="L122"></a> 122 
<a id="L123" name="L123"></a> 123         <a href="../S/842.html#L259" title="Defined at 259 in src/java/util/prefs/XmlSupport.java.">writeDoc</a>(doc, os);
<a id="L124" name="L124"></a> 124     <em class="brace">}</em>
<a id="L125" name="L125"></a> 125 
<div class="comment">
      Put the preferences in the specified Preferences node into the
      specified XML element which is assumed to represent a node
      in the specified XML document which is assumed to conform to
      PREFS_DTD.  If subTree is true, create children of the specified
      XML node conforming to all of the children of the specified
      Preferences node and recurse.
      @throws BackingStoreException if it is not possible to read
              the preferences or children out of the specified
              preferences node.</div>
<a id="L138" name="L138"></a> 138     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/25343.html" title="Multiple referred from 2 places.">putPreferencesInXml</a>(<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> elt, <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc,
<a id="L139" name="L139"></a> 139                <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a> prefs, <strong class="reserved">boolean</strong> subTree) <strong class="reserved">throws</strong> <a href="../S/836.html#L38" title="Defined at 38 in src/java/util/prefs/BackingStoreException.java.">BackingStoreException</a>
<a id="L140" name="L140"></a> 140     <em class="brace">{</em>
<a id="L141" name="L141"></a> 141         <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>[] kidsCopy = <strong class="reserved">null</strong>;
<a id="L142" name="L142"></a> 142         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] kidNames = <strong class="reserved">null</strong>;
<a id="L143" name="L143"></a> 143 
<a id="L144" name="L144"></a> 144         <em class="comment">// Node is locked to export its contents and get a</em>
<a id="L145" name="L145"></a> 145         <em class="comment">// copy of children, then lock is released,</em>
<a id="L146" name="L146"></a> 146         <em class="comment">// and, if subTree = true, recursive calls are made on children</em>
<a id="L147" name="L147"></a> 147         <strong class="reserved">synchronized</strong> (((<a href="../S/839.html#L123" title="Defined at 123 in src/java/util/prefs/AbstractPreferences.java.">AbstractPreferences</a>)prefs).<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L148" name="L148"></a> 148             <em class="comment">// Check if this node was concurrently removed. If yes</em>
<a id="L149" name="L149"></a> 149             <em class="comment">// remove it from XML Document and return.</em>
<a id="L150" name="L150"></a> 150             <strong class="reserved">if</strong> (((<a href="../S/839.html#L123" title="Defined at 123 in src/java/util/prefs/AbstractPreferences.java.">AbstractPreferences</a>)prefs).<a href="../S/839.html#L1436" title="Defined at 1436 in src/java/util/prefs/AbstractPreferences.java.">isRemoved</a>()) <em class="brace">{</em>
<a id="L151" name="L151"></a> 151                 elt.<a href="../D/21403.html" title="Multiple defined in 15 places.">getParentNode</a>().<a href="../D/30731.html" title="Multiple defined in 14 places.">removeChild</a>(elt);
<a id="L152" name="L152"></a> 152                 <strong class="reserved">return</strong>;
<a id="L153" name="L153"></a> 153             <em class="brace">}</em>
<a id="L154" name="L154"></a> 154             <em class="comment">// Put map in xml element</em>
<a id="L155" name="L155"></a> 155             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] <a href="../D/26726.html" title="Multiple defined in 22 places.">keys</a> = prefs.<a href="../D/26726.html" title="Multiple defined in 22 places.">keys</a>();
<a id="L156" name="L156"></a> 156             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) elt.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("map"));
<a id="L157" name="L157"></a> 157             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i&lt;<a href="../D/26726.html" title="Multiple defined in 22 places.">keys</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L158" name="L158"></a> 158                 <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> entry = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>)
<a id="L159" name="L159"></a> 159                     <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("entry"));
<a id="L160" name="L160"></a> 160                 entry.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("key", <a href="../D/26726.html" title="Multiple defined in 22 places.">keys</a>[i]);
<a id="L161" name="L161"></a> 161                 <em class="comment">// NEXT STATEMENT THROWS NULL PTR EXC INSTEAD OF ASSERT FAIL</em>
<a id="L162" name="L162"></a> 162                 entry.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("value", prefs.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(<a href="../D/26726.html" title="Multiple defined in 22 places.">keys</a>[i], <strong class="reserved">null</strong>));
<a id="L163" name="L163"></a> 163             <em class="brace">}</em>
<a id="L164" name="L164"></a> 164             <em class="comment">// Recurse if appropriate</em>
<a id="L165" name="L165"></a> 165             <strong class="reserved">if</strong> (subTree) <em class="brace">{</em>
<div class="comment">
                 /* Get a copy of kids while lock is held */</div>
<a id="L167" name="L167"></a> 167                 kidNames = prefs.<a href="../D/12748.html" title="Multiple defined in 2 places.">childrenNames</a>();
<a id="L168" name="L168"></a> 168                 kidsCopy = <strong class="reserved">new</strong> <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>[kidNames.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L169" name="L169"></a> 169                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt;  kidNames.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)
<a id="L170" name="L170"></a> 170                     kidsCopy[i] = prefs.<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>(kidNames[i]);
<a id="L171" name="L171"></a> 171             <em class="brace">}</em>
<a id="L172" name="L172"></a> 172             <em class="comment">// release lock</em>
<a id="L173" name="L173"></a> 173         <em class="brace">}</em>
<a id="L174" name="L174"></a> 174 
<a id="L175" name="L175"></a> 175         <strong class="reserved">if</strong> (subTree) <em class="brace">{</em>
<a id="L176" name="L176"></a> 176             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i &lt; kidNames.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L177" name="L177"></a> 177                 <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlKid = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>)
<a id="L178" name="L178"></a> 178                     elt.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("node"));
<a id="L179" name="L179"></a> 179                 xmlKid.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("name", kidNames[i]);
<a id="L180" name="L180"></a> 180                 <a href="../S/842.html#L138" title="Defined at 138 in src/java/util/prefs/XmlSupport.java.">putPreferencesInXml</a>(xmlKid, doc, kidsCopy[i], subTree);
<a id="L181" name="L181"></a> 181             <em class="brace">}</em>
<a id="L182" name="L182"></a> 182         <em class="brace">}</em>
<a id="L183" name="L183"></a> 183     <em class="brace">}</em>
<a id="L184" name="L184"></a> 184 
<div class="comment">
      Import preferences from the specified input stream, which is assumed
      to contain an XML document in the format described in the Preferences
      spec.
      @throws IOException if reading from the specified output stream
              results in an <tt>IOException</tt>.
      @throws InvalidPreferencesFormatException Data on input stream does not
              constitute a valid XML document with the mandated document type.</div>
<a id="L195" name="L195"></a> 195     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../S/833.html#L1256" title="Referred from 1256 in src/java/util/prefs/Preferences.java.">importPreferences</a>(<a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>)
<a id="L196" name="L196"></a> 196         <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/837.html#L40" title="Defined at 40 in src/java/util/prefs/InvalidPreferencesFormatException.java.">InvalidPreferencesFormatException</a>
<a id="L197" name="L197"></a> 197     <em class="brace">{</em>
<a id="L198" name="L198"></a> 198         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L199" name="L199"></a> 199             <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc = <a href="../S/842.html#L238" title="Defined at 238 in src/java/util/prefs/XmlSupport.java.">loadPrefsDoc</a>(<a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>);
<a id="L200" name="L200"></a> 200             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> xmlVersion =
<a id="L201" name="L201"></a> 201                 doc.<a href="../D/18558.html" title="Multiple defined in 7 places.">getDocumentElement</a>().<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("EXTERNAL_XML_VERSION");
<a id="L202" name="L202"></a> 202             <strong class="reserved">if</strong> (xmlVersion.<a href="../D/13068.html" title="Multiple defined in 86 places.">compareTo</a>(EXTERNAL_XML_VERSION) &gt; 0)
<a id="L203" name="L203"></a> 203                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/837.html#L40" title="Defined at 40 in src/java/util/prefs/InvalidPreferencesFormatException.java.">InvalidPreferencesFormatException</a>(
<a id="L204" name="L204"></a> 204                 "Exported preferences file format version " + xmlVersion +
<a id="L205" name="L205"></a> 205                 " is not supported. This java installation can read" +
<a id="L206" name="L206"></a> 206                 " versions " + EXTERNAL_XML_VERSION + " or older. You may need" +
<a id="L207" name="L207"></a> 207                 " to install a newer version of JDK.");
<a id="L208" name="L208"></a> 208 
<a id="L209" name="L209"></a> 209             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlRoot = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) doc.<a href="../D/18558.html" title="Multiple defined in 7 places.">getDocumentElement</a>().
<a id="L210" name="L210"></a> 210                                                <a href="../D/17640.html" title="Multiple defined in 11 places.">getChildNodes</a>().<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(0);
<a id="L211" name="L211"></a> 211             <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a> prefsRoot =
<a id="L212" name="L212"></a> 212                 (xmlRoot.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("type").<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("user") ?
<a id="L213" name="L213"></a> 213                             <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>.<a href="../D/36293.html" title="Multiple defined in 3 places.">userRoot</a>() : <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>.<a href="../D/35194.html" title="Multiple defined in 3 places.">systemRoot</a>());
<a id="L214" name="L214"></a> 214             <a href="../S/842.html#L288" title="Defined at 288 in src/java/util/prefs/XmlSupport.java.">ImportSubtree</a>(prefsRoot, xmlRoot);
<a id="L215" name="L215"></a> 215         <em class="brace">}</em> <strong class="reserved">catch</strong>(<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a> e) <em class="brace">{</em>
<a id="L216" name="L216"></a> 216             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/837.html#L40" title="Defined at 40 in src/java/util/prefs/InvalidPreferencesFormatException.java.">InvalidPreferencesFormatException</a>(e);
<a id="L217" name="L217"></a> 217         <em class="brace">}</em>
<a id="L218" name="L218"></a> 218     <em class="brace">}</em>
<a id="L219" name="L219"></a> 219 
<div class="comment">
      Create a new prefs XML document.</div>
<a id="L223" name="L223"></a> 223     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> <a href="../R/12632.html" title="Multiple referred from 2 places.">createPrefsDoc</a>( <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> qname ) <em class="brace">{</em>
<a id="L224" name="L224"></a> 224         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L225" name="L225"></a> 225             <a href="../S/119.html#L50" title="Defined at 50 in src/org/w3c/dom/DOMImplementation.java.">DOMImplementation</a> di = <a href="../S/3849.html#L41" title="Defined at 41 in src/javax/xml/parsers/DocumentBuilderFactory.java.">DocumentBuilderFactory</a>.<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>().
<a id="L226" name="L226"></a> 226                 <a href="../D/27987.html" title="Multiple defined in 2 places.">newDocumentBuilder</a>().<a href="../D/18159.html" title="Multiple defined in 12 places.">getDOMImplementation</a>();
<a id="L227" name="L227"></a> 227             <a href="../S/130.html#L55" title="Defined at 55 in src/org/w3c/dom/DocumentType.java.">DocumentType</a> dt = di.<a href="../D/13815.html" title="Multiple defined in 5 places.">createDocumentType</a>(qname, <strong class="reserved">null</strong>, PREFS_DTD_URI);
<a id="L228" name="L228"></a> 228             <strong class="reserved">return</strong> di.<a href="../D/13812.html" title="Multiple defined in 9 places.">createDocument</a>(<strong class="reserved">null</strong>, qname, dt);
<a id="L229" name="L229"></a> 229         <em class="brace">}</em> <strong class="reserved">catch</strong>(<a href="../S/3851.html#L34" title="Defined at 34 in src/javax/xml/parsers/ParserConfigurationException.java.">ParserConfigurationException</a> e) <em class="brace">{</em>
<a id="L230" name="L230"></a> 230             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1575.html#L43" title="Defined at 43 in src/java/lang/AssertionError.java.">AssertionError</a>(e);
<a id="L231" name="L231"></a> 231         <em class="brace">}</em>
<a id="L232" name="L232"></a> 232     <em class="brace">}</em>
<a id="L233" name="L233"></a> 233 
<div class="comment">
      Load an XML document from specified input stream, which must
      have the requisite DTD URI.</div>
<a id="L238" name="L238"></a> 238     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> <a href="../R/22610.html" title="Multiple referred from 2 places.">loadPrefsDoc</a>(<a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>)
<a id="L239" name="L239"></a> 239         <strong class="reserved">throws</strong> <a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>, <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>
<a id="L240" name="L240"></a> 240     <em class="brace">{</em>
<a id="L241" name="L241"></a> 241         <a href="../S/3849.html#L41" title="Defined at 41 in src/javax/xml/parsers/DocumentBuilderFactory.java.">DocumentBuilderFactory</a> dbf = <a href="../S/3849.html#L41" title="Defined at 41 in src/javax/xml/parsers/DocumentBuilderFactory.java.">DocumentBuilderFactory</a>.<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>();
<a id="L242" name="L242"></a> 242         dbf.<a href="../S/3849.html#L238" title="Defined at 238 in src/javax/xml/parsers/DocumentBuilderFactory.java.">setIgnoringElementContentWhitespace</a>(<strong class="reserved">true</strong>);
<a id="L243" name="L243"></a> 243         dbf.<a href="../D/34262.html" title="Multiple defined in 5 places.">setValidating</a>(<strong class="reserved">true</strong>);
<a id="L244" name="L244"></a> 244         dbf.<a href="../S/3849.html#L278" title="Defined at 278 in src/javax/xml/parsers/DocumentBuilderFactory.java.">setCoalescing</a>(<strong class="reserved">true</strong>);
<a id="L245" name="L245"></a> 245         dbf.<a href="../S/3849.html#L263" title="Defined at 263 in src/javax/xml/parsers/DocumentBuilderFactory.java.">setIgnoringComments</a>(<strong class="reserved">true</strong>);
<a id="L246" name="L246"></a> 246         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L247" name="L247"></a> 247             <a href="../S/3846.html#L62" title="Defined at 62 in src/javax/xml/parsers/DocumentBuilder.java.">DocumentBuilder</a> db = dbf.<a href="../D/27987.html" title="Multiple defined in 2 places.">newDocumentBuilder</a>();
<a id="L248" name="L248"></a> 248             db.<a href="../D/32603.html" title="Multiple defined in 31 places.">setEntityResolver</a>(<strong class="reserved">new</strong> <a href="../D/7320.html" title="Multiple defined in 4 places.">Resolver</a>());
<a id="L249" name="L249"></a> 249             db.<a href="../D/32615.html" title="Multiple defined in 34 places.">setErrorHandler</a>(<strong class="reserved">new</strong> <a href="../S/842.html#L410" title="Defined at 410 in src/java/util/prefs/XmlSupport.java.">EH</a>());
<a id="L250" name="L250"></a> 250             <strong class="reserved">return</strong> db.<a href="../D/29076.html" title="Multiple defined in 178 places.">parse</a>(<strong class="reserved">new</strong> <a href="../S/711.html#L84" title="Defined at 84 in src/org/xml/sax/InputSource.java.">InputSource</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>));
<a id="L251" name="L251"></a> 251         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3851.html#L34" title="Defined at 34 in src/javax/xml/parsers/ParserConfigurationException.java.">ParserConfigurationException</a> e) <em class="brace">{</em>
<a id="L252" name="L252"></a> 252             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1575.html#L43" title="Defined at 43 in src/java/lang/AssertionError.java.">AssertionError</a>(e);
<a id="L253" name="L253"></a> 253         <em class="brace">}</em>
<a id="L254" name="L254"></a> 254     <em class="brace">}</em>
<a id="L255" name="L255"></a> 255 
<div class="comment">
      Write XML document to the specified output stream.</div>
<a id="L259" name="L259"></a> 259     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/30598.html" title="Multiple referred from 2 places.">writeDoc</a>(<a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc, <a href="../D/6445.html" title="Multiple defined in 3 places.">OutputStream</a> <a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>)
<a id="L260" name="L260"></a> 260         <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>
<a id="L261" name="L261"></a> 261     <em class="brace">{</em>
<a id="L262" name="L262"></a> 262         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L263" name="L263"></a> 263             <a href="../S/4029.html#L44" title="Defined at 44 in src/javax/xml/transform/TransformerFactory.java.">TransformerFactory</a> tf = <a href="../S/4029.html#L44" title="Defined at 44 in src/javax/xml/transform/TransformerFactory.java.">TransformerFactory</a>.<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>();
<a id="L264" name="L264"></a> 264             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L265" name="L265"></a> 265                 tf.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("indent-number", <strong class="reserved">new</strong> <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>(2));
<a id="L266" name="L266"></a> 266             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a> iae) <em class="brace">{</em>
<a id="L267" name="L267"></a> 267                 <em class="comment">//Ignore the IAE. Should not fail the writeout even the</em>
<a id="L268" name="L268"></a> 268                 <em class="comment">//transformer provider does not support "indent-number".</em>
<a id="L269" name="L269"></a> 269             <em class="brace">}</em>
<a id="L270" name="L270"></a> 270             <a href="../S/4036.html#L49" title="Defined at 49 in src/javax/xml/transform/Transformer.java.">Transformer</a> t = tf.<a href="../D/28099.html" title="Multiple defined in 8 places.">newTransformer</a>();
<a id="L271" name="L271"></a> 271             t.<a href="../D/33459.html" title="Multiple defined in 3 places.">setOutputProperty</a>(<a href="../S/4048.html#L37" title="Defined at 37 in src/javax/xml/transform/OutputKeys.java.">OutputKeys</a>.DOCTYPE_SYSTEM, doc.<a href="../D/18550.html" title="Multiple defined in 5 places.">getDoctype</a>().<a href="../D/22911.html" title="Multiple defined in 50 places.">getSystemId</a>());
<a id="L272" name="L272"></a> 272             t.<a href="../D/33459.html" title="Multiple defined in 3 places.">setOutputProperty</a>(<a href="../S/4048.html#L37" title="Defined at 37 in src/javax/xml/transform/OutputKeys.java.">OutputKeys</a>.INDENT, "yes");
<a id="L273" name="L273"></a> 273             <em class="comment">//Transformer resets the "indent" info if the "result" is a StreamResult with</em>
<a id="L274" name="L274"></a> 274             <em class="comment">//an OutputStream object embedded, creating a Writer object on top of that</em>
<a id="L275" name="L275"></a> 275             <em class="comment">//OutputStream object however works.</em>
<a id="L276" name="L276"></a> 276             t.<a href="../D/35592.html" title="Multiple defined in 22 places.">transform</a>(<strong class="reserved">new</strong> <a href="../S/4046.html#L44" title="Defined at 44 in src/javax/xml/transform/dom/DOMSource.java.">DOMSource</a>(doc),
<a id="L277" name="L277"></a> 277                         <strong class="reserved">new</strong> <a href="../S/4038.html#L41" title="Defined at 41 in src/javax/xml/transform/stream/StreamResult.java.">StreamResult</a>(<strong class="reserved">new</strong> <a href="../S/1404.html#L66" title="Defined at 66 in src/java/io/BufferedWriter.java.">BufferedWriter</a>(<strong class="reserved">new</strong> <a href="../S/1388.html#L77" title="Defined at 77 in src/java/io/OutputStreamWriter.java.">OutputStreamWriter</a>(<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>, "UTF-8"))));
<a id="L278" name="L278"></a> 278         <em class="brace">}</em> <strong class="reserved">catch</strong>(<a href="../S/4051.html#L35" title="Defined at 35 in src/javax/xml/transform/TransformerException.java.">TransformerException</a> e) <em class="brace">{</em>
<a id="L279" name="L279"></a> 279             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1575.html#L43" title="Defined at 43 in src/java/lang/AssertionError.java.">AssertionError</a>(e);
<a id="L280" name="L280"></a> 280         <em class="brace">}</em>
<a id="L281" name="L281"></a> 281     <em class="brace">}</em>
<a id="L282" name="L282"></a> 282 
<div class="comment">
      Recursively traverse the specified preferences node and store
      the described preferences into the system or current user
      preferences tree, as appropriate.</div>
<a id="L288" name="L288"></a> 288     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/3749.html" title="Multiple referred from 2 places.">ImportSubtree</a>(<a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a> prefsNode, <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlNode) <em class="brace">{</em>
<a id="L289" name="L289"></a> 289         <a href="../S/115.html#L52" title="Defined at 52 in src/org/w3c/dom/NodeList.java.">NodeList</a> xmlKids = xmlNode.<a href="../D/17640.html" title="Multiple defined in 11 places.">getChildNodes</a>();
<a id="L290" name="L290"></a> 290         <strong class="reserved">int</strong> numXmlKids = xmlKids.<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>();
<div class="comment">
          We first lock the node, import its contents and get
          child nodes. Then we unlock the node and go to children
          Since some of the children might have been concurrently
          deleted we check for this.</div>
<a id="L297" name="L297"></a> 297         <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>[] prefsKids;
<div class="comment">
         /* Lock the node */</div>
<a id="L299" name="L299"></a> 299         <strong class="reserved">synchronized</strong> (((<a href="../S/839.html#L123" title="Defined at 123 in src/java/util/prefs/AbstractPreferences.java.">AbstractPreferences</a>)prefsNode).<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L300" name="L300"></a> 300             <em class="comment">//If removed, return silently</em>
<a id="L301" name="L301"></a> 301             <strong class="reserved">if</strong> (((<a href="../S/839.html#L123" title="Defined at 123 in src/java/util/prefs/AbstractPreferences.java.">AbstractPreferences</a>)prefsNode).<a href="../S/839.html#L1436" title="Defined at 1436 in src/java/util/prefs/AbstractPreferences.java.">isRemoved</a>())
<a id="L302" name="L302"></a> 302                 <strong class="reserved">return</strong>;
<a id="L303" name="L303"></a> 303 
<a id="L304" name="L304"></a> 304             <em class="comment">// Import any preferences at this node</em>
<a id="L305" name="L305"></a> 305             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> firstXmlKid = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) xmlKids.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(0);
<a id="L306" name="L306"></a> 306             <a href="../S/842.html#L325" title="Defined at 325 in src/java/util/prefs/XmlSupport.java.">ImportPrefs</a>(prefsNode, firstXmlKid);
<a id="L307" name="L307"></a> 307             prefsKids = <strong class="reserved">new</strong> <a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a>[numXmlKids - 1];
<a id="L308" name="L308"></a> 308 
<a id="L309" name="L309"></a> 309             <em class="comment">// Get involved children</em>
<a id="L310" name="L310"></a> 310             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=1; i &lt; numXmlKids; i++) <em class="brace">{</em>
<a id="L311" name="L311"></a> 311                 <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlKid = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) xmlKids.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(i);
<a id="L312" name="L312"></a> 312                 prefsKids[i-1] = prefsNode.<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>(xmlKid.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("name"));
<a id="L313" name="L313"></a> 313             <em class="brace">}</em>
<a id="L314" name="L314"></a> 314         <em class="brace">}</em> <em class="comment">// unlocked the node</em>
<a id="L315" name="L315"></a> 315         <em class="comment">// import children</em>
<a id="L316" name="L316"></a> 316         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=1; i &lt; numXmlKids; i++)
<a id="L317" name="L317"></a> 317             <a href="../S/842.html#L288" title="Defined at 288 in src/java/util/prefs/XmlSupport.java.">ImportSubtree</a>(prefsKids[i-1], (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>)xmlKids.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(i));
<a id="L318" name="L318"></a> 318     <em class="brace">}</em>
<a id="L319" name="L319"></a> 319 
<div class="comment">
      Import the preferences described by the specified XML element
      (a map from a preferences document) into the specified
      preferences node.</div>
<a id="L325" name="L325"></a> 325     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../S/842.html#L306" title="Referred from 306 in src/java/util/prefs/XmlSupport.java.">ImportPrefs</a>(<a href="../S/833.html#L224" title="Defined at 224 in src/java/util/prefs/Preferences.java.">Preferences</a> prefsNode, <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>) <em class="brace">{</em>
<a id="L326" name="L326"></a> 326         <a href="../S/115.html#L52" title="Defined at 52 in src/org/w3c/dom/NodeList.java.">NodeList</a> <a href="../D/15643.html" title="Multiple defined in 6 places.">entries</a> = <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>.<a href="../D/17640.html" title="Multiple defined in 11 places.">getChildNodes</a>();
<a id="L327" name="L327"></a> 327         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0, numEntries = <a href="../D/15643.html" title="Multiple defined in 6 places.">entries</a>.<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>(); i &lt; numEntries; i++) <em class="brace">{</em>
<a id="L328" name="L328"></a> 328             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> entry = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) <a href="../D/15643.html" title="Multiple defined in 6 places.">entries</a>.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(i);
<a id="L329" name="L329"></a> 329             prefsNode.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(entry.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("key"),
<a id="L330" name="L330"></a> 330                           entry.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("value"));
<a id="L331" name="L331"></a> 331         <em class="brace">}</em>
<a id="L332" name="L332"></a> 332     <em class="brace">}</em>
<a id="L333" name="L333"></a> 333 
<div class="comment">
      Export the specified Map<string,string> to a map document on
      the specified OutputStream as per the prefs DTD.  This is used
      as the internal (undocumented) format for FileSystemPrefs.
      @throws IOException if writing to the specified output stream
              results in an <tt>IOException</tt>.</string,string></div>
<a id="L342" name="L342"></a> 342     <strong class="reserved">static</strong> <strong class="reserved">void</strong> exportMap(<a href="../D/6445.html" title="Multiple defined in 3 places.">OutputStream</a> os, <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>&gt; <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L343" name="L343"></a> 343         <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc = <a href="../S/842.html#L223" title="Defined at 223 in src/java/util/prefs/XmlSupport.java.">createPrefsDoc</a>("map");
<a id="L344" name="L344"></a> 344         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlMap = doc.<a href="../D/18558.html" title="Multiple defined in 7 places.">getDocumentElement</a>( ) ;
<a id="L345" name="L345"></a> 345         xmlMap.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("MAP_XML_VERSION", MAP_XML_VERSION);
<a id="L346" name="L346"></a> 346 
<a id="L347" name="L347"></a> 347         <strong class="reserved">for</strong> (<a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a>&lt;<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>&gt;&gt; i = <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>(); i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>(); ) <em class="brace">{</em>
<a id="L348" name="L348"></a> 348             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>&gt; e = i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L349" name="L349"></a> 349             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xe = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>)
<a id="L350" name="L350"></a> 350                 xmlMap.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(doc.<a href="../D/13831.html" title="Multiple defined in 10 places.">createElement</a>("entry"));
<a id="L351" name="L351"></a> 351             xe.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("key",   e.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>());
<a id="L352" name="L352"></a> 352             xe.<a href="../D/31941.html" title="Multiple defined in 34 places.">setAttribute</a>("value", e.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>());
<a id="L353" name="L353"></a> 353         <em class="brace">}</em>
<a id="L354" name="L354"></a> 354 
<a id="L355" name="L355"></a> 355         <a href="../S/842.html#L259" title="Defined at 259 in src/java/util/prefs/XmlSupport.java.">writeDoc</a>(doc, os);
<a id="L356" name="L356"></a> 356     <em class="brace">}</em>
<a id="L357" name="L357"></a> 357 
<div class="comment">
      Import Map from the specified input stream, which is assumed
      to contain a map document as per the prefs DTD.  This is used
      as the internal (undocumented) format for FileSystemPrefs.  The
      key-value pairs specified in the XML document will be put into
      the specified Map.  (If this Map is empty, it will contain exactly
      the key-value pairs int the XML-document when this method returns.)
      @throws IOException if reading from the specified output stream
              results in an <tt>IOException</tt>.
      @throws InvalidPreferencesFormatException Data on input stream does not
              constitute a valid XML document with the mandated document type.</div>
<a id="L371" name="L371"></a> 371     <strong class="reserved">static</strong> <strong class="reserved">void</strong> importMap(<a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>, <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>&gt; m)
<a id="L372" name="L372"></a> 372         <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/837.html#L40" title="Defined at 40 in src/java/util/prefs/InvalidPreferencesFormatException.java.">InvalidPreferencesFormatException</a>
<a id="L373" name="L373"></a> 373     <em class="brace">{</em>
<a id="L374" name="L374"></a> 374         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L375" name="L375"></a> 375             <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc = <a href="../S/842.html#L238" title="Defined at 238 in src/java/util/prefs/XmlSupport.java.">loadPrefsDoc</a>(<a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>);
<a id="L376" name="L376"></a> 376             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> xmlMap = doc.<a href="../D/18558.html" title="Multiple defined in 7 places.">getDocumentElement</a>();
<a id="L377" name="L377"></a> 377             <em class="comment">// check version</em>
<a id="L378" name="L378"></a> 378             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> mapVersion = xmlMap.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("MAP_XML_VERSION");
<a id="L379" name="L379"></a> 379             <strong class="reserved">if</strong> (mapVersion.<a href="../D/13068.html" title="Multiple defined in 86 places.">compareTo</a>(MAP_XML_VERSION) &gt; 0)
<a id="L380" name="L380"></a> 380                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/837.html#L40" title="Defined at 40 in src/java/util/prefs/InvalidPreferencesFormatException.java.">InvalidPreferencesFormatException</a>(
<a id="L381" name="L381"></a> 381                 "Preferences map file format version " + mapVersion +
<a id="L382" name="L382"></a> 382                 " is not supported. This java installation can read" +
<a id="L383" name="L383"></a> 383                 " versions " + MAP_XML_VERSION + " or older. You may need" +
<a id="L384" name="L384"></a> 384                 " to install a newer version of JDK.");
<a id="L385" name="L385"></a> 385 
<a id="L386" name="L386"></a> 386             <a href="../S/115.html#L52" title="Defined at 52 in src/org/w3c/dom/NodeList.java.">NodeList</a> <a href="../D/15643.html" title="Multiple defined in 6 places.">entries</a> = xmlMap.<a href="../D/17640.html" title="Multiple defined in 11 places.">getChildNodes</a>();
<a id="L387" name="L387"></a> 387             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0, numEntries=<a href="../D/15643.html" title="Multiple defined in 6 places.">entries</a>.<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>(); i&lt;numEntries; i++) <em class="brace">{</em>
<a id="L388" name="L388"></a> 388                 <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> entry = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>) <a href="../D/15643.html" title="Multiple defined in 6 places.">entries</a>.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(i);
<a id="L389" name="L389"></a> 389                 m.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(entry.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("key"), entry.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>("value"));
<a id="L390" name="L390"></a> 390             <em class="brace">}</em>
<a id="L391" name="L391"></a> 391         <em class="brace">}</em> <strong class="reserved">catch</strong>(<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a> e) <em class="brace">{</em>
<a id="L392" name="L392"></a> 392             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/837.html#L40" title="Defined at 40 in src/java/util/prefs/InvalidPreferencesFormatException.java.">InvalidPreferencesFormatException</a>(e);
<a id="L393" name="L393"></a> 393         <em class="brace">}</em>
<a id="L394" name="L394"></a> 394     <em class="brace">}</em>
<a id="L395" name="L395"></a> 395 
<a id="L396" name="L396"></a> 396     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/6675.html" title="Multiple referred from 72 places.">Resolver</a> <strong class="reserved">implements</strong> <a href="../S/722.html#L93" title="Defined at 93 in src/org/xml/sax/EntityResolver.java.">EntityResolver</a> <em class="brace">{</em>
<a id="L397" name="L397"></a> 397         <strong class="reserved">public</strong> <a href="../S/711.html#L84" title="Defined at 84 in src/org/xml/sax/InputSource.java.">InputSource</a> <a href="../R/26336.html" title="Multiple referred from 17 places.">resolveEntity</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pid, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> sid)
<a id="L398" name="L398"></a> 398             <strong class="reserved">throws</strong> <a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>
<a id="L399" name="L399"></a> 399         <em class="brace">{</em>
<a id="L400" name="L400"></a> 400             <strong class="reserved">if</strong> (sid.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(PREFS_DTD_URI)) <em class="brace">{</em>
<a id="L401" name="L401"></a> 401                 <a href="../S/711.html#L84" title="Defined at 84 in src/org/xml/sax/InputSource.java.">InputSource</a> <a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>;
<a id="L402" name="L402"></a> 402                 <a href="../D/25134.html" title="Multiple defined in 5 places.">is</a> = <strong class="reserved">new</strong> <a href="../S/711.html#L84" title="Defined at 84 in src/org/xml/sax/InputSource.java.">InputSource</a>(<strong class="reserved">new</strong> <a href="../S/1417.html#L36" title="Defined at 36 in src/java/io/StringReader.java.">StringReader</a>(PREFS_DTD));
<a id="L403" name="L403"></a> 403                 <a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>.<a href="../D/34059.html" title="Multiple defined in 31 places.">setSystemId</a>(PREFS_DTD_URI);
<a id="L404" name="L404"></a> 404                 <strong class="reserved">return</strong> <a href="../D/25134.html" title="Multiple defined in 5 places.">is</a>;
<a id="L405" name="L405"></a> 405             <em class="brace">}</em>
<a id="L406" name="L406"></a> 406             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>("Invalid system identifier: " + sid);
<a id="L407" name="L407"></a> 407         <em class="brace">}</em>
<a id="L408" name="L408"></a> 408     <em class="brace">}</em>
<a id="L409" name="L409"></a> 409 
<a id="L410" name="L410"></a> 410     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../S/842.html#L249" title="Referred from 249 in src/java/util/prefs/XmlSupport.java.">EH</a> <strong class="reserved">implements</strong> <a href="../S/723.html#L73" title="Defined at 73 in src/org/xml/sax/ErrorHandler.java.">ErrorHandler</a> <em class="brace">{</em>
<a id="L411" name="L411"></a> 411         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/14003.html" title="Multiple referred from 408 places.">error</a>(<a href="../S/712.html#L62" title="Defined at 62 in src/org/xml/sax/SAXParseException.java.">SAXParseException</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <strong class="reserved">throws</strong> <a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a> <em class="brace">{</em>
<a id="L412" name="L412"></a> 412             <strong class="reserved">throw</strong> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>;
<a id="L413" name="L413"></a> 413         <em class="brace">}</em>
<a id="L414" name="L414"></a> 414         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/14255.html" title="Multiple referred from 46 places.">fatalError</a>(<a href="../S/712.html#L62" title="Defined at 62 in src/org/xml/sax/SAXParseException.java.">SAXParseException</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <strong class="reserved">throws</strong> <a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a> <em class="brace">{</em>
<a id="L415" name="L415"></a> 415             <strong class="reserved">throw</strong> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>;
<a id="L416" name="L416"></a> 416         <em class="brace">}</em>
<a id="L417" name="L417"></a> 417         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/30453.html" title="Multiple referred from 107 places.">warning</a>(<a href="../S/712.html#L62" title="Defined at 62 in src/org/xml/sax/SAXParseException.java.">SAXParseException</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <strong class="reserved">throws</strong> <a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a> <em class="brace">{</em>
<a id="L418" name="L418"></a> 418             <strong class="reserved">throw</strong> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>;
<a id="L419" name="L419"></a> 419         <em class="brace">}</em>
<a id="L420" name="L420"></a> 420     <em class="brace">}</em>
<a id="L421" name="L421"></a> 421 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L97">[^]</a><a href="#L417">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>