<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/launcher/parse_manifest.c</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L56">[^]</a><a href="#L659">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L56" title="Defined at 56.">inflate_file</a></li>
<li><a href="#L121" title="Defined at 121.">haveZIP64</a></li>
<li><a href="#L133" title="Defined at 133.">find_end64</a></li>
<li><a href="#L159" title="Defined at 159.">find_end</a></li>
<li><a href="#L229" title="Defined at 229.">compute_cen</a></li>
<li><a href="#L327" title="Defined at 327.">find_file</a></li>
<li><a href="#L480" title="Defined at 480.">parse_nv_pair</a></li>
<li><a href="#L555" title="Defined at 555.">JLI_ParseManifest</a></li>
<li><a href="#L616" title="Defined at 616.">JLI_JarUnpackFile</a></li>
<li><a href="#L642" title="Defined at 642.">JLI_FreeManifest</a></li>
<li><a href="#L659" title="Defined at 659.">JLI_ManifestIterate</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <em class="sharp">#include</em> &lt;sys/types.h&gt;
<a id="L27" name="L27"></a>  27 <em class="sharp">#include</em> &lt;sys/stat.h&gt;
<a id="L28" name="L28"></a>  28 <em class="sharp">#include</em> &lt;fcntl.h&gt;
<a id="L29" name="L29"></a>  29 <em class="sharp">#include</em> &lt;stdio.h&gt;
<a id="L30" name="L30"></a>  30 <em class="sharp">#include</em> &lt;stdlib.h&gt;
<a id="L31" name="L31"></a>  31 <em class="sharp">#include</em> &lt;string.h&gt;
<a id="L32" name="L32"></a>  32 <em class="sharp">#include</em> "<a href="9.html">jli_util.h</a>"
<a id="L33" name="L33"></a>  33 
<a id="L34" name="L34"></a>  34 <em class="sharp">#include</em> &lt;zlib.h&gt;
<a id="L35" name="L35"></a>  35 <em class="sharp">#include</em> "<a href="12.html">manifest_info.h</a>"
<a id="L36" name="L36"></a>  36 
<a id="L37" name="L37"></a>  37 <strong class="reserved">static</strong> <strong class="reserved">char</strong>     *manifest;
<a id="L38" name="L38"></a>  38 
<a id="L39" name="L39"></a>  39 <strong class="reserved">static</strong> <strong class="reserved">const</strong> <strong class="reserved">char</strong>       *manifest_name = "META-INF/MANIFEST.MF";
<a id="L40" name="L40"></a>  40 
<div class="comment">
  Inflate the manifest file (or any file for that matter).
    fd:        File descriptor of the jar file.
    entry:     Contains the information necessary to perform the inflation
               (the compressed and uncompressed sizes and the offset in
               the file where the compressed data is located).
    size_out:  Returns the size of the inflated file.
  Upon success, it returns a pointer to a NUL-terminated malloc'd buffer
  containing the inflated manifest file.  When the caller is done with it,
  this buffer should be released by a call to free().  Upon failure,
  returns NULL.</div>
<a id="L55" name="L55"></a>  55 <strong class="reserved">static</strong> <strong class="reserved">char</strong> *
<a id="L56" name="L56"></a>  56 <a href="../R/20533.html" title="Multiple referred from 3 places.">inflate_file</a>(<strong class="reserved">int</strong> fd, <a href="../D/37321.html" title="Multiple defined in 2 places.">zentry</a> *entry, <strong class="reserved">int</strong> *size_out)
<a id="L57" name="L57"></a>  57 <em class="brace">{</em>
<a id="L58" name="L58"></a>  58     <strong class="reserved">char</strong>        *<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>;
<a id="L59" name="L59"></a>  59     <strong class="reserved">char</strong>        *<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>;
<a id="L60" name="L60"></a>  60     z_stream    zs;
<a id="L61" name="L61"></a>  61 
<a id="L62" name="L62"></a>  62     <strong class="reserved">if</strong> (entry-&gt;csize == (size_t) -1 || entry-&gt;isize == (size_t) -1 )
<a id="L63" name="L63"></a>  63         <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L64" name="L64"></a>  64     <strong class="reserved">if</strong> (<a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, entry-&gt;<a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>, SEEK_SET) &lt; (jlong)0)
<a id="L65" name="L65"></a>  65         <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L66" name="L66"></a>  66     <strong class="reserved">if</strong> ((<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a> = malloc(entry-&gt;csize + 1)) == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L67" name="L67"></a>  67         <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L68" name="L68"></a>  68     <strong class="reserved">if</strong> ((size_t)(<a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>, (<strong class="reserved">unsigned</strong> <strong class="reserved">int</strong>)entry-&gt;csize)) != entry-&gt;csize) <em class="brace">{</em>
<a id="L69" name="L69"></a>  69         <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L70" name="L70"></a>  70         <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L71" name="L71"></a>  71     <em class="brace">}</em>
<a id="L72" name="L72"></a>  72     <strong class="reserved">if</strong> (entry-&gt;how == <a href="../S/12.html#L144" title="Defined at 144 in src/launcher/manifest_info.h.">STORED</a>) <em class="brace">{</em>
<a id="L73" name="L73"></a>  73         *(<strong class="reserved">char</strong> *)((size_t)<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a> + entry-&gt;csize) = '\0';
<a id="L74" name="L74"></a>  74         <strong class="reserved">if</strong> (size_out) <em class="brace">{</em>
<a id="L75" name="L75"></a>  75             *size_out = (<strong class="reserved">int</strong>)entry-&gt;csize;
<a id="L76" name="L76"></a>  76         <em class="brace">}</em>
<a id="L77" name="L77"></a>  77         <strong class="reserved">return</strong> (<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L78" name="L78"></a>  78     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (entry-&gt;how == <a href="../S/12.html#L145" title="Defined at 145 in src/launcher/manifest_info.h.">DEFLATED</a>) <em class="brace">{</em>
<a id="L79" name="L79"></a>  79         zs.zalloc = (alloc_func)Z_NULL;
<a id="L80" name="L80"></a>  80         zs.zfree = (free_func)Z_NULL;
<a id="L81" name="L81"></a>  81         zs.opaque = (voidpf)Z_NULL;
<a id="L82" name="L82"></a>  82         zs.next_in = (<a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>*)<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>;
<a id="L83" name="L83"></a>  83         zs.avail_in = (uInt)entry-&gt;csize;
<a id="L84" name="L84"></a>  84         <strong class="reserved">if</strong> (inflateInit2(&amp;zs, -MAX_WBITS) &lt; 0) <em class="brace">{</em>
<a id="L85" name="L85"></a>  85             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L86" name="L86"></a>  86             <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L87" name="L87"></a>  87         <em class="brace">}</em>
<a id="L88" name="L88"></a>  88         <strong class="reserved">if</strong> ((<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a> = malloc(entry-&gt;isize + 1)) == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L89" name="L89"></a>  89             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L90" name="L90"></a>  90             <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L91" name="L91"></a>  91         <em class="brace">}</em>
<a id="L92" name="L92"></a>  92         zs.next_out = (<a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>*)<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>;
<a id="L93" name="L93"></a>  93         zs.avail_out = (uInt)entry-&gt;isize;
<a id="L94" name="L94"></a>  94         <strong class="reserved">if</strong> (<a href="../D/24488.html" title="Multiple defined in 3 places.">inflate</a>(&amp;zs, Z_PARTIAL_FLUSH) &lt; 0) <em class="brace">{</em>
<a id="L95" name="L95"></a>  95             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L96" name="L96"></a>  96             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>);
<a id="L97" name="L97"></a>  97             <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L98" name="L98"></a>  98         <em class="brace">}</em>
<a id="L99" name="L99"></a>  99         *(<strong class="reserved">char</strong> *)((size_t)<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a> + entry-&gt;isize) = '\0';
<a id="L100" name="L100"></a> 100         <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L101" name="L101"></a> 101         <strong class="reserved">if</strong> (inflateEnd(&amp;zs) &lt; 0) <em class="brace">{</em>
<a id="L102" name="L102"></a> 102             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>);
<a id="L103" name="L103"></a> 103             <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L104" name="L104"></a> 104         <em class="brace">}</em>
<a id="L105" name="L105"></a> 105         <strong class="reserved">if</strong> (size_out) <em class="brace">{</em>
<a id="L106" name="L106"></a> 106             *size_out = (<strong class="reserved">int</strong>)entry-&gt;isize;
<a id="L107" name="L107"></a> 107         <em class="brace">}</em>
<a id="L108" name="L108"></a> 108         <strong class="reserved">return</strong> (<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>);
<a id="L109" name="L109"></a> 109     <em class="brace">}</em>
<a id="L110" name="L110"></a> 110     <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L111" name="L111"></a> 111     <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L112" name="L112"></a> 112 <em class="brace">}</em>
<a id="L113" name="L113"></a> 113 
<a id="L114" name="L114"></a> 114 <strong class="reserved">static</strong> jboolean zip64_present = JNI_FALSE;
<a id="L115" name="L115"></a> 115 
<div class="comment">
  Checks to see if we have ZIP64 archive, and save
  the check for later use</div>
<a id="L120" name="L120"></a> 120 <strong class="reserved">static</strong> <strong class="reserved">int</strong>
<a id="L121" name="L121"></a> 121 <a href="../R/20302.html" title="Multiple referred from 2 places.">haveZIP64</a>(<a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a> *p) <em class="brace">{</em>
<a id="L122" name="L122"></a> 122     jlong cenlen, cenoff, centot;
<a id="L123" name="L123"></a> 123     cenlen = <a href="../S/12.html#L111" title="Defined at 111 in src/launcher/manifest_info.h.">ENDSIZ</a>(p);
<a id="L124" name="L124"></a> 124     cenoff = <a href="../S/12.html#L112" title="Defined at 112 in src/launcher/manifest_info.h.">ENDOFF</a>(p);
<a id="L125" name="L125"></a> 125     centot = <a href="../S/12.html#L110" title="Defined at 110 in src/launcher/manifest_info.h.">ENDTOT</a>(p);
<a id="L126" name="L126"></a> 126     zip64_present = (cenlen == <a href="../S/12.html#L55" title="Defined at 55 in src/launcher/manifest_info.h.">ZIP64_MAGICVAL</a> ||
<a id="L127" name="L127"></a> 127                      cenoff == <a href="../S/12.html#L55" title="Defined at 55 in src/launcher/manifest_info.h.">ZIP64_MAGICVAL</a> ||
<a id="L128" name="L128"></a> 128                      centot == <a href="../S/12.html#L56" title="Defined at 56 in src/launcher/manifest_info.h.">ZIP64_MAGICCOUNT</a>);
<a id="L129" name="L129"></a> 129     <strong class="reserved">return</strong> zip64_present;
<a id="L130" name="L130"></a> 130 <em class="brace">}</em>
<a id="L131" name="L131"></a> 131 
<a id="L132" name="L132"></a> 132 <strong class="reserved">static</strong> jlong
<a id="L133" name="L133"></a> 133 <a href="../R/14509.html" title="Multiple referred from 2 places.">find_end64</a>(<strong class="reserved">int</strong> fd, <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a> *ep, jlong pos)
<a id="L134" name="L134"></a> 134 <em class="brace">{</em>
<a id="L135" name="L135"></a> 135     jlong end64pos;
<a id="L136" name="L136"></a> 136     jlong bytes;
<a id="L137" name="L137"></a> 137     <strong class="reserved">if</strong> ((end64pos = <a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, pos - <a href="../S/12.html#L51" title="Defined at 51 in src/launcher/manifest_info.h.">ZIP64_LOCHDR</a>, SEEK_SET)) &lt; (jlong)0)
<a id="L138" name="L138"></a> 138         <strong class="reserved">return</strong> -1;
<a id="L139" name="L139"></a> 139     <strong class="reserved">if</strong> ((bytes = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, ep, <a href="../S/12.html#L51" title="Defined at 51 in src/launcher/manifest_info.h.">ZIP64_LOCHDR</a>)) &lt; 0)
<a id="L140" name="L140"></a> 140         <strong class="reserved">return</strong> -1;
<a id="L141" name="L141"></a> 141     <strong class="reserved">if</strong> (<a href="../S/12.html#L65" title="Defined at 65 in src/launcher/manifest_info.h.">GETSIG</a>(ep) == <a href="../S/12.html#L41" title="Defined at 41 in src/launcher/manifest_info.h.">ZIP64_LOCSIG</a>)
<a id="L142" name="L142"></a> 142        <strong class="reserved">return</strong> end64pos;
<a id="L143" name="L143"></a> 143     <strong class="reserved">return</strong> -1;
<a id="L144" name="L144"></a> 144 <em class="brace">}</em>
<a id="L145" name="L145"></a> 145 
<div class="comment">
  A very little used routine to handle the case that zip file has
  a comment at the end. Believe it or not, the only way to find the
  END record is to walk backwards, byte by bloody byte looking for
  the END record signature.
       fd:     File descriptor of the jar file.
       eb:     Pointer to a buffer to receive a copy of the END header.
  Returns the offset of the END record in the file on success,
  -1 on failure.</div>
<a id="L158" name="L158"></a> 158 <strong class="reserved">static</strong> jlong
<a id="L159" name="L159"></a> 159 <a href="../S/13.html#L242" title="Referred from 242 in src/launcher/parse_manifest.c.">find_end</a>(<strong class="reserved">int</strong> fd, <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a> *eb)
<a id="L160" name="L160"></a> 160 <em class="brace">{</em>
<a id="L161" name="L161"></a> 161     jlong   len;
<a id="L162" name="L162"></a> 162     jlong   pos;
<a id="L163" name="L163"></a> 163     jlong   flen;
<a id="L164" name="L164"></a> 164     <strong class="reserved">int</strong>     bytes;
<a id="L165" name="L165"></a> 165     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    *cp;
<a id="L166" name="L166"></a> 166     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    *endpos;
<a id="L167" name="L167"></a> 167     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    *<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<a id="L168" name="L168"></a> 168 
<div class="comment">
      99.44% (or more) of the time, there will be no comment at the
      end of the zip file.  Try reading just enough to read the END
      record from the end of the file, at this time we should also
      check to see if we have a ZIP64 archive.</div>
<a id="L175" name="L175"></a> 175     <strong class="reserved">if</strong> ((pos = <a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, -<a href="../S/12.html#L48" title="Defined at 48 in src/launcher/manifest_info.h.">ENDHDR</a>, SEEK_END)) &lt; (jlong)0)
<a id="L176" name="L176"></a> 176         <strong class="reserved">return</strong> (-1);
<a id="L177" name="L177"></a> 177     <strong class="reserved">if</strong> ((bytes = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, eb, <a href="../S/12.html#L48" title="Defined at 48 in src/launcher/manifest_info.h.">ENDHDR</a>)) &lt; 0)
<a id="L178" name="L178"></a> 178         <strong class="reserved">return</strong> (-1);
<a id="L179" name="L179"></a> 179     <strong class="reserved">if</strong> (<a href="../S/12.html#L65" title="Defined at 65 in src/launcher/manifest_info.h.">GETSIG</a>(eb) == <a href="../S/12.html#L38" title="Defined at 38 in src/launcher/manifest_info.h.">ENDSIG</a>) <em class="brace">{</em>
<a id="L180" name="L180"></a> 180         <strong class="reserved">return</strong> <a href="../S/13.html#L121" title="Defined at 121 in src/launcher/parse_manifest.c.">haveZIP64</a>(eb) ? <a href="../S/13.html#L133" title="Defined at 133 in src/launcher/parse_manifest.c.">find_end64</a>(fd, eb, pos) : pos;
<a id="L181" name="L181"></a> 181     <em class="brace">}</em>
<a id="L182" name="L182"></a> 182 
<div class="comment">
      Shucky-Darn,... There is a comment at the end of the zip file.
      Allocate and fill a buffer with enough of the zip file
      to meet the specification for a maximal comment length.</div>
<a id="L189" name="L189"></a> 189     <strong class="reserved">if</strong> ((flen = <a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, 0, SEEK_END)) &lt; (jlong)0)
<a id="L190" name="L190"></a> 190         <strong class="reserved">return</strong> (-1);
<a id="L191" name="L191"></a> 191     len = (flen &lt; <a href="../S/12.html#L139" title="Defined at 139 in src/launcher/manifest_info.h.">END_MAXLEN</a>) ? flen : <a href="../S/12.html#L139" title="Defined at 139 in src/launcher/manifest_info.h.">END_MAXLEN</a>;
<a id="L192" name="L192"></a> 192     <strong class="reserved">if</strong> (<a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, -len, SEEK_END) &lt; (jlong)0)
<a id="L193" name="L193"></a> 193         <strong class="reserved">return</strong> (-1);
<a id="L194" name="L194"></a> 194     <strong class="reserved">if</strong> ((<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> = malloc(<a href="../S/12.html#L139" title="Defined at 139 in src/launcher/manifest_info.h.">END_MAXLEN</a>)) == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L195" name="L195"></a> 195         <strong class="reserved">return</strong> (-1);
<a id="L196" name="L196"></a> 196     <strong class="reserved">if</strong> ((bytes = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, len)) &lt; 0) <em class="brace">{</em>
<a id="L197" name="L197"></a> 197         <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L198" name="L198"></a> 198         <strong class="reserved">return</strong> (-1);
<a id="L199" name="L199"></a> 199     <em class="brace">}</em>
<a id="L200" name="L200"></a> 200 
<div class="comment">
      Search backwards from the end of file stopping when the END header
      signature is found. (The first condition of the "if" is just a
      fast fail, because the GETSIG macro isn't always cheap.  The
      final condition protects against false positives.)</div>
<a id="L207" name="L207"></a> 207     endpos = &amp;<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[bytes];
<a id="L208" name="L208"></a> 208     <strong class="reserved">for</strong> (cp = &amp;<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[bytes - <a href="../S/12.html#L48" title="Defined at 48 in src/launcher/manifest_info.h.">ENDHDR</a>]; cp &gt;= &amp;<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[0]; cp--)
<a id="L209" name="L209"></a> 209         <strong class="reserved">if</strong> ((*cp == (<a href="../S/12.html#L38" title="Defined at 38 in src/launcher/manifest_info.h.">ENDSIG</a> &amp; 0xFF)) &amp;&amp; (<a href="../S/12.html#L65" title="Defined at 65 in src/launcher/manifest_info.h.">GETSIG</a>(cp) == <a href="../S/12.html#L38" title="Defined at 38 in src/launcher/manifest_info.h.">ENDSIG</a>) &amp;&amp;
<a id="L210" name="L210"></a> 210           (cp + <a href="../S/12.html#L48" title="Defined at 48 in src/launcher/manifest_info.h.">ENDHDR</a> + <a href="../S/12.html#L113" title="Defined at 113 in src/launcher/manifest_info.h.">ENDCOM</a>(cp) == endpos)) <em class="brace">{</em>
<a id="L211" name="L211"></a> 211             (<strong class="reserved">void</strong>) memcpy(eb, cp, <a href="../S/12.html#L48" title="Defined at 48 in src/launcher/manifest_info.h.">ENDHDR</a>);
<a id="L212" name="L212"></a> 212             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L213" name="L213"></a> 213             pos = flen - (endpos - cp);
<a id="L214" name="L214"></a> 214             <strong class="reserved">return</strong> <a href="../S/13.html#L121" title="Defined at 121 in src/launcher/parse_manifest.c.">haveZIP64</a>(eb) ? <a href="../S/13.html#L133" title="Defined at 133 in src/launcher/parse_manifest.c.">find_end64</a>(fd, eb, pos) : pos;
<a id="L215" name="L215"></a> 215         <em class="brace">}</em>
<a id="L216" name="L216"></a> 216     <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L217" name="L217"></a> 217     <strong class="reserved">return</strong> (-1);
<a id="L218" name="L218"></a> 218 <em class="brace">}</em>
<a id="L219" name="L219"></a> 219 
<a id="L220" name="L220"></a> 220 <em class="sharp">#define</em> <a href="../R/632.html" title="Multiple referred from 5 places.">BUFSIZE</a> (3 * 65536 + <a href="../S/12.html#L47" title="Defined at 47 in src/launcher/manifest_info.h.">CENHDR</a> + <a href="../S/12.html#L34" title="Defined at 34 in src/launcher/manifest_info.h.">SIGSIZ</a>)
<a id="L221" name="L221"></a> 221 <em class="sharp">#define</em> <a href="../R/4856.html" title="Multiple referred from 5 places.">MINREAD</a> 1024
<a id="L222" name="L222"></a> 222 
<div class="comment">
  Computes and positions at the start of the CEN header, ie. the central
  directory, this will also return the offset if there is a zip file comment
  at the end of the archive, for most cases this would be 0.</div>
<a id="L228" name="L228"></a> 228 <strong class="reserved">static</strong> jlong
<a id="L229" name="L229"></a> 229 <a href="../S/13.html#L344" title="Referred from 344 in src/launcher/parse_manifest.c.">compute_cen</a>(<strong class="reserved">int</strong> fd, <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a> *bp)
<a id="L230" name="L230"></a> 230 <em class="brace">{</em>
<a id="L231" name="L231"></a> 231     <strong class="reserved">int</strong> bytes;
<a id="L232" name="L232"></a> 232     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a> *p;
<a id="L233" name="L233"></a> 233     jlong base_offset;
<a id="L234" name="L234"></a> 234     jlong <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>;
<a id="L235" name="L235"></a> 235     <strong class="reserved">char</strong> <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[<a href="../S/13.html#L221" title="Defined at 221 in src/launcher/parse_manifest.c.">MINREAD</a>];
<a id="L236" name="L236"></a> 236     p = <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<div class="comment">
      Read the END Header, which is the starting point for ZIP files.
      (Clearly designed to make writing a zip file easier than reading
      one. Now isn't that precious...)</div>
<a id="L242" name="L242"></a> 242     <strong class="reserved">if</strong> ((base_offset = <a href="../S/13.html#L159" title="Defined at 159 in src/launcher/parse_manifest.c.">find_end</a>(fd, bp)) == -1) <em class="brace">{</em>
<a id="L243" name="L243"></a> 243         <strong class="reserved">return</strong> (-1);
<a id="L244" name="L244"></a> 244     <em class="brace">}</em>
<a id="L245" name="L245"></a> 245     p = bp;
<div class="comment">
      There is a historical, but undocumented, ability to allow for
      additional "stuff" to be prepended to the zip/jar file. It seems
      that this has been used to prepend an actual java launcher
      executable to the jar on Windows.  Although this is just another
      form of statically linking a small piece of the JVM to the
      application, we choose to continue to support it.  Note that no
      guarantees have been made (or should be made) to the customer that
      this will continue to work.
      Therefore, calculate the base offset of the zip file (within the
      expanded file) by assuming that the central directory is followed
      immediately by the end record.</div>
<a id="L260" name="L260"></a> 260     <strong class="reserved">if</strong> (zip64_present) <em class="brace">{</em>
<a id="L261" name="L261"></a> 261         <strong class="reserved">if</strong> ((<a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a> = <a href="../S/12.html#L132" title="Defined at 132 in src/launcher/manifest_info.h.">ZIP64_LOCOFF</a>(p)) &lt; (jlong)0) <em class="brace">{</em>
<a id="L262" name="L262"></a> 262             <strong class="reserved">return</strong> -1;
<a id="L263" name="L263"></a> 263         <em class="brace">}</em>
<a id="L264" name="L264"></a> 264         <strong class="reserved">if</strong> (<a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>, SEEK_SET) &lt; (jlong) 0) <em class="brace">{</em>
<a id="L265" name="L265"></a> 265             <strong class="reserved">return</strong> (-1);
<a id="L266" name="L266"></a> 266         <em class="brace">}</em>
<a id="L267" name="L267"></a> 267         <strong class="reserved">if</strong> ((bytes = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, <a href="../S/13.html#L221" title="Defined at 221 in src/launcher/parse_manifest.c.">MINREAD</a>)) &lt; 0) <em class="brace">{</em>
<a id="L268" name="L268"></a> 268             <strong class="reserved">return</strong> (-1);
<a id="L269" name="L269"></a> 269         <em class="brace">}</em>
<a id="L270" name="L270"></a> 270         <strong class="reserved">if</strong> (<a href="../S/12.html#L65" title="Defined at 65 in src/launcher/manifest_info.h.">GETSIG</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>) != <a href="../S/12.html#L40" title="Defined at 40 in src/launcher/manifest_info.h.">ZIP64_ENDSIG</a>) <em class="brace">{</em>
<a id="L271" name="L271"></a> 271             <strong class="reserved">return</strong> -1;
<a id="L272" name="L272"></a> 272         <em class="brace">}</em>
<a id="L273" name="L273"></a> 273         <strong class="reserved">if</strong> ((<a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a> = <a href="../S/12.html#L126" title="Defined at 126 in src/launcher/manifest_info.h.">ZIP64_ENDOFF</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>)) &lt; (jlong)0) <em class="brace">{</em>
<a id="L274" name="L274"></a> 274             <strong class="reserved">return</strong> -1;
<a id="L275" name="L275"></a> 275         <em class="brace">}</em>
<a id="L276" name="L276"></a> 276         <strong class="reserved">if</strong> (<a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>, SEEK_SET) &lt; (jlong)0) <em class="brace">{</em>
<a id="L277" name="L277"></a> 277             <strong class="reserved">return</strong> (-1);
<a id="L278" name="L278"></a> 278         <em class="brace">}</em>
<a id="L279" name="L279"></a> 279         p = <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<a id="L280" name="L280"></a> 280         base_offset = base_offset - <a href="../S/12.html#L125" title="Defined at 125 in src/launcher/manifest_info.h.">ZIP64_ENDSIZ</a>(p) - <a href="../S/12.html#L126" title="Defined at 126 in src/launcher/manifest_info.h.">ZIP64_ENDOFF</a>(p) - <a href="../S/12.html#L50" title="Defined at 50 in src/launcher/manifest_info.h.">ZIP64_ENDHDR</a>;
<a id="L281" name="L281"></a> 281     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L282" name="L282"></a> 282         base_offset = base_offset - <a href="../S/12.html#L111" title="Defined at 111 in src/launcher/manifest_info.h.">ENDSIZ</a>(p) - <a href="../S/12.html#L112" title="Defined at 112 in src/launcher/manifest_info.h.">ENDOFF</a>(p);
<div class="comment">
          The END Header indicates the start of the Central Directory
          Headers. Remember that the desired Central Directory Header (CEN)
          will almost always be the second one and the first one is a small
          directory entry ("META-INF/"). Keep the code optimized for
          that case.
          Seek to the beginning of the Central Directory.</div>
<a id="L292" name="L292"></a> 292         <strong class="reserved">if</strong> (<a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, base_offset + <a href="../S/12.html#L112" title="Defined at 112 in src/launcher/manifest_info.h.">ENDOFF</a>(p), SEEK_SET) &lt; (jlong) 0) <em class="brace">{</em>
<a id="L293" name="L293"></a> 293             <strong class="reserved">return</strong> (-1);
<a id="L294" name="L294"></a> 294         <em class="brace">}</em>
<a id="L295" name="L295"></a> 295     <em class="brace">}</em>
<a id="L296" name="L296"></a> 296     <strong class="reserved">return</strong> base_offset;
<a id="L297" name="L297"></a> 297 <em class="brace">}</em>
<a id="L298" name="L298"></a> 298 
<div class="comment">
  Locate the manifest file with the zip/jar file.
       fd:     File descriptor of the jar file.
       entry:  To be populated with the information necessary to perform
               the inflation (the compressed and uncompressed sizes and
               the offset in the file where the compressed data is located).
  Returns zero upon success. Returns a negative value upon failure.
  The buffer for reading the Central Directory if the zip/jar file needs
  to be large enough to accommodate the largest possible single record
  and the signature of the next record which is:
       3*2**16 + CENHDR + SIGSIZ
  Each of the three variable sized fields (name, comment and extension)
  has a maximum possible size of 64k.
  Typically, only a small bit of this buffer is used with bytes shuffled
  down to the beginning of the buffer.  It is one thing to allocate such
  a large buffer and another thing to actually start faulting it in.
  In most cases, all that needs to be read are the first two entries in
  a typical jar file (META-INF and META-INF/MANIFEST.MF). Keep this factoid
  in mind when optimizing this code.</div>
<a id="L326" name="L326"></a> 326 <strong class="reserved">static</strong> <strong class="reserved">int</strong>
<a id="L327" name="L327"></a> 327 <a href="../R/14510.html" title="Multiple referred from 3 places.">find_file</a>(<strong class="reserved">int</strong> fd, <a href="../D/37321.html" title="Multiple defined in 2 places.">zentry</a> *entry, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *file_name)
<a id="L328" name="L328"></a> 328 <em class="brace">{</em>
<a id="L329" name="L329"></a> 329     <strong class="reserved">int</strong>     bytes;
<a id="L330" name="L330"></a> 330     <strong class="reserved">int</strong>     res;
<a id="L331" name="L331"></a> 331     <strong class="reserved">int</strong>     entry_size;
<a id="L332" name="L332"></a> 332     <strong class="reserved">int</strong>     read_size;
<a id="L333" name="L333"></a> 333     jlong   base_offset;
<a id="L334" name="L334"></a> 334     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    *p;
<a id="L335" name="L335"></a> 335     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    *bp;
<a id="L336" name="L336"></a> 336     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    *<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<a id="L337" name="L337"></a> 337     <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>    locbuf[<a href="../S/12.html#L45" title="Defined at 45 in src/launcher/manifest_info.h.">LOCHDR</a>];
<a id="L338" name="L338"></a> 338 
<a id="L339" name="L339"></a> 339     <strong class="reserved">if</strong> ((<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> = (<a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>*)malloc(<a href="../S/13.html#L220" title="Defined at 220 in src/launcher/parse_manifest.c.">BUFSIZE</a>)) == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L340" name="L340"></a> 340         <strong class="reserved">return</strong>(-1);
<a id="L341" name="L341"></a> 341     <em class="brace">}</em>
<a id="L342" name="L342"></a> 342 
<a id="L343" name="L343"></a> 343     bp = <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<a id="L344" name="L344"></a> 344     base_offset = <a href="../S/13.html#L229" title="Defined at 229 in src/launcher/parse_manifest.c.">compute_cen</a>(fd, bp);
<a id="L345" name="L345"></a> 345     <strong class="reserved">if</strong> (base_offset == -1) <em class="brace">{</em>
<a id="L346" name="L346"></a> 346         <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L347" name="L347"></a> 347         <strong class="reserved">return</strong> -1;
<a id="L348" name="L348"></a> 348     <em class="brace">}</em>
<a id="L349" name="L349"></a> 349 
<a id="L350" name="L350"></a> 350     <strong class="reserved">if</strong> ((bytes = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, bp, <a href="../S/13.html#L221" title="Defined at 221 in src/launcher/parse_manifest.c.">MINREAD</a>)) &lt; 0) <em class="brace">{</em>
<a id="L351" name="L351"></a> 351         <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L352" name="L352"></a> 352         <strong class="reserved">return</strong> (-1);
<a id="L353" name="L353"></a> 353     <em class="brace">}</em>
<a id="L354" name="L354"></a> 354     p = bp;
<div class="comment">
      Loop through the Central Directory Headers. Note that a valid zip/jar
      must have an ENDHDR (with ENDSIG) after the Central Directory.</div>
<a id="L359" name="L359"></a> 359     <strong class="reserved">while</strong> (<a href="../S/12.html#L65" title="Defined at 65 in src/launcher/manifest_info.h.">GETSIG</a>(p) == <a href="../S/12.html#L37" title="Defined at 37 in src/launcher/manifest_info.h.">CENSIG</a>) <em class="brace">{</em>
<a id="L360" name="L360"></a> 360 
<div class="comment">
          If a complete header isn't in the buffer, shift the contents
          of the buffer down and refill the buffer.  Note that the check
          for "bytes &lt; CENHDR" must be made before the test for the entire
          size of the header, because if bytes is less than CENHDR, the
          actual size of the header can't be determined. The addition of
          SIGSIZ guarantees that the next signature is also in the buffer
          for proper loop termination.</div>
<a id="L370" name="L370"></a> 370         <strong class="reserved">if</strong> (bytes &lt; <a href="../S/12.html#L47" title="Defined at 47 in src/launcher/manifest_info.h.">CENHDR</a>) <em class="brace">{</em>
<a id="L371" name="L371"></a> 371             p = memmove(bp, p, bytes);
<a id="L372" name="L372"></a> 372             <strong class="reserved">if</strong> ((res = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, bp + bytes, <a href="../S/13.html#L221" title="Defined at 221 in src/launcher/parse_manifest.c.">MINREAD</a>)) &lt;= 0) <em class="brace">{</em>
<a id="L373" name="L373"></a> 373                 <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L374" name="L374"></a> 374                 <strong class="reserved">return</strong> (-1);
<a id="L375" name="L375"></a> 375             <em class="brace">}</em>
<a id="L376" name="L376"></a> 376             bytes += res;
<a id="L377" name="L377"></a> 377         <em class="brace">}</em>
<a id="L378" name="L378"></a> 378         entry_size = <a href="../S/12.html#L47" title="Defined at 47 in src/launcher/manifest_info.h.">CENHDR</a> + <a href="../S/12.html#L98" title="Defined at 98 in src/launcher/manifest_info.h.">CENNAM</a>(p) + <a href="../S/12.html#L99" title="Defined at 99 in src/launcher/manifest_info.h.">CENEXT</a>(p) + <a href="../S/12.html#L100" title="Defined at 100 in src/launcher/manifest_info.h.">CENCOM</a>(p);
<a id="L379" name="L379"></a> 379         <strong class="reserved">if</strong> (bytes &lt; entry_size + <a href="../S/12.html#L34" title="Defined at 34 in src/launcher/manifest_info.h.">SIGSIZ</a>) <em class="brace">{</em>
<a id="L380" name="L380"></a> 380             <strong class="reserved">if</strong> (p != bp)
<a id="L381" name="L381"></a> 381                 p = memmove(bp, p, bytes);
<a id="L382" name="L382"></a> 382             read_size = entry_size - bytes + <a href="../S/12.html#L34" title="Defined at 34 in src/launcher/manifest_info.h.">SIGSIZ</a>;
<a id="L383" name="L383"></a> 383             read_size = (read_size &lt; <a href="../S/13.html#L221" title="Defined at 221 in src/launcher/parse_manifest.c.">MINREAD</a>) ? <a href="../S/13.html#L221" title="Defined at 221 in src/launcher/parse_manifest.c.">MINREAD</a> : read_size;
<a id="L384" name="L384"></a> 384             <strong class="reserved">if</strong> ((res = <a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, bp + bytes,  read_size)) &lt;= 0) <em class="brace">{</em>
<a id="L385" name="L385"></a> 385                 <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L386" name="L386"></a> 386                 <strong class="reserved">return</strong> (-1);
<a id="L387" name="L387"></a> 387             <em class="brace">}</em>
<a id="L388" name="L388"></a> 388             bytes += res;
<a id="L389" name="L389"></a> 389         <em class="brace">}</em>
<a id="L390" name="L390"></a> 390 
<div class="comment">
          Check if the name is the droid we are looking for; the jar file
          manifest.  If so, build the entry record from the data found in
          the header located and return success.</div>
<a id="L396" name="L396"></a> 396         <strong class="reserved">if</strong> ((size_t)<a href="../S/12.html#L98" title="Defined at 98 in src/launcher/manifest_info.h.">CENNAM</a>(p) == <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(file_name) &amp;&amp;
<a id="L397" name="L397"></a> 397           memcmp((p + <a href="../S/12.html#L47" title="Defined at 47 in src/launcher/manifest_info.h.">CENHDR</a>), file_name, <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(file_name)) == 0) <em class="brace">{</em>
<a id="L398" name="L398"></a> 398             <strong class="reserved">if</strong> (<a href="../D/4565.html" title="Multiple defined in 5 places.">JLI_Lseek</a>(fd, base_offset + <a href="../S/12.html#L104" title="Defined at 104 in src/launcher/manifest_info.h.">CENOFF</a>(p), SEEK_SET) &lt; (jlong)0) <em class="brace">{</em>
<a id="L399" name="L399"></a> 399                 <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L400" name="L400"></a> 400                 <strong class="reserved">return</strong> (-1);
<a id="L401" name="L401"></a> 401             <em class="brace">}</em>
<a id="L402" name="L402"></a> 402             <strong class="reserved">if</strong> (<a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(fd, locbuf, <a href="../S/12.html#L45" title="Defined at 45 in src/launcher/manifest_info.h.">LOCHDR</a>) &lt; 0) <em class="brace">{</em>
<a id="L403" name="L403"></a> 403                 <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L404" name="L404"></a> 404                 <strong class="reserved">return</strong> (-1);
<a id="L405" name="L405"></a> 405             <em class="brace">}</em>
<a id="L406" name="L406"></a> 406             <strong class="reserved">if</strong> (<a href="../S/12.html#L65" title="Defined at 65 in src/launcher/manifest_info.h.">GETSIG</a>(locbuf) != <a href="../S/12.html#L35" title="Defined at 35 in src/launcher/manifest_info.h.">LOCSIG</a>) <em class="brace">{</em>
<a id="L407" name="L407"></a> 407                 <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L408" name="L408"></a> 408                 <strong class="reserved">return</strong> (-1);
<a id="L409" name="L409"></a> 409             <em class="brace">}</em>
<a id="L410" name="L410"></a> 410             entry-&gt;isize = <a href="../S/12.html#L97" title="Defined at 97 in src/launcher/manifest_info.h.">CENLEN</a>(p);
<a id="L411" name="L411"></a> 411             entry-&gt;csize = <a href="../S/12.html#L96" title="Defined at 96 in src/launcher/manifest_info.h.">CENSIZ</a>(p);
<a id="L412" name="L412"></a> 412             entry-&gt;<a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a> = base_offset + <a href="../S/12.html#L104" title="Defined at 104 in src/launcher/manifest_info.h.">CENOFF</a>(p) + <a href="../S/12.html#L45" title="Defined at 45 in src/launcher/manifest_info.h.">LOCHDR</a> +
<a id="L413" name="L413"></a> 413                 <a href="../S/12.html#L77" title="Defined at 77 in src/launcher/manifest_info.h.">LOCNAM</a>(locbuf) + <a href="../S/12.html#L78" title="Defined at 78 in src/launcher/manifest_info.h.">LOCEXT</a>(locbuf);
<a id="L414" name="L414"></a> 414             entry-&gt;how = <a href="../S/12.html#L93" title="Defined at 93 in src/launcher/manifest_info.h.">CENHOW</a>(p);
<a id="L415" name="L415"></a> 415             <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L416" name="L416"></a> 416             <strong class="reserved">return</strong> (0);
<a id="L417" name="L417"></a> 417         <em class="brace">}</em>
<a id="L418" name="L418"></a> 418 
<div class="comment">
          Point to the next entry and decrement the count of valid remaining
          bytes.</div>
<a id="L423" name="L423"></a> 423         bytes -= entry_size;
<a id="L424" name="L424"></a> 424         p += entry_size;
<a id="L425" name="L425"></a> 425     <em class="brace">}</em>
<a id="L426" name="L426"></a> 426     <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>);
<a id="L427" name="L427"></a> 427     <div class="comment">
);        /* Fell off the end the loop without a Manifest */</div>
<a id="L428" name="L428"></a> 428 <em class="brace">}</em>
<a id="L429" name="L429"></a> 429 
<div class="comment">
  Parse a Manifest file header entry into a distinct "name" and "value".
  Continuation lines are joined into a single "value". The documented
  syntax for a header entry is:
       header: name ":" value
       name: alphanum *headerchar
       value: SPACE *otherchar newline *continuation
       continuation: SPACE *otherchar newline
       newline: CR LF | LF | CR (not followed by LF)
       alphanum: {"A"-"Z"} | {"a"-"z"} | {"0"-"9"}
       headerchar: alphanum | "-" | "_"
       otherchar: any UTF-8 character except NUL, CR and LF
  Note that a manifest file may be composed of multiple sections,
  each of which may contain multiple headers.
       section: *header +newline
       nonempty-section: +header +newline
  (Note that the point of "nonempty-section" is unclear, because it isn't
  referenced elsewhere in the full specification for the Manifest file.)
  Arguments:
       lp      pointer to a character pointer which points to the start
               of a valid header.
       name    pointer to a character pointer which will be set to point
               to the name portion of the header (nul terminated).
       value   pointer to a character pointer which will be set to point
               to the value portion of the header (nul terminated).
  Returns:
     1 Successful parsing of an NV pair.  lp is updated to point to the
       next character after the terminating newline in the string
       representing the Manifest file. name and value are updated to
       point to the strings parsed.
     0 A valid end of section indicator was encountered.  lp, name, and
       value are not modified.
    -1 lp does not point to a valid header. Upon return, the values of
       lp, name, and value are undefined.</div>
<a id="L479" name="L479"></a> 479 <strong class="reserved">static</strong> <strong class="reserved">int</strong>
<a id="L480" name="L480"></a> 480 <a href="../R/24656.html" title="Multiple referred from 2 places.">parse_nv_pair</a>(<strong class="reserved">char</strong> **lp, <strong class="reserved">char</strong> **<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <strong class="reserved">char</strong> **<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)
<a id="L481" name="L481"></a> 481 <em class="brace">{</em>
<a id="L482" name="L482"></a> 482     <strong class="reserved">char</strong>    *nl;
<a id="L483" name="L483"></a> 483     <strong class="reserved">char</strong>    *cp;
<a id="L484" name="L484"></a> 484 
<div class="comment">
      End of the section - return 0. The end of section condition is
      indicated by either encountering a blank line or the end of the
      Manifest "string" (EOF).</div>
<a id="L490" name="L490"></a> 490     <strong class="reserved">if</strong> (**lp == '\0' || **lp == '\n' || **lp == '\r')
<a id="L491" name="L491"></a> 491         <strong class="reserved">return</strong> (0);
<a id="L492" name="L492"></a> 492 
<div class="comment">
      Getting to here, indicates that *lp points to an "otherchar".
      Turn the "header" into a string on its own.</div>
<a id="L497" name="L497"></a> 497     nl = <a href="../S/9.html#L60" title="Defined at 60 in src/launcher/jli_util.h.">JLI_StrPBrk</a>(*lp, "\n\r");
<a id="L498" name="L498"></a> 498     <strong class="reserved">if</strong> (nl == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L499" name="L499"></a> 499         nl = <a href="../S/9.html#L50" title="Defined at 50 in src/launcher/jli_util.h.">JLI_StrChr</a>(*lp, (<strong class="reserved">int</strong>)'\0');
<a id="L500" name="L500"></a> 500     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
         cp = nl;                        /* For merging continuation lines */</div>
<a id="L502" name="L502"></a> 502         <strong class="reserved">if</strong> (*nl == '\r' &amp;&amp; *(nl+1) == '\n')
<a id="L503" name="L503"></a> 503             *nl++ = '\0';
<a id="L504" name="L504"></a> 504         *nl++ = '\0';
<a id="L505" name="L505"></a> 505 
<div class="comment">
          Process any "continuation" line(s), by making them part of the
          "header" line. Yes, I know that we are "undoing" the NULs we
          just placed here, but continuation lines are the fairly rare
          case, so we shouldn't unnecessarily complicate the code above.
          Note that an entire continuation line is processed each iteration
          through the outer while loop.</div>
<a id="L515" name="L515"></a> 515         <strong class="reserved">while</strong> (*nl == ' ') <em class="brace">{</em>
<div class="comment">
             nl++;                       /* First character to be moved */</div>
<a id="L517" name="L517"></a> 517             <strong class="reserved">while</strong> (*nl != '\n' &amp;&amp; *nl != '\r' &amp;&amp; *nl != '\0')
<div class="comment">
                 *cp++ = *nl++;          /* Shift string */</div>
<a id="L519" name="L519"></a> 519             <strong class="reserved">if</strong> (*nl == '\0')
<a id="L520" name="L520"></a> 520                 <div class="comment">
);            /* Error: newline required */</div>
<a id="L521" name="L521"></a> 521             *cp = '\0';
<a id="L522" name="L522"></a> 522             <strong class="reserved">if</strong> (*nl == '\r' &amp;&amp; *(nl+1) == '\n')
<a id="L523" name="L523"></a> 523                 *nl++ = '\0';
<a id="L524" name="L524"></a> 524             *nl++ = '\0';
<a id="L525" name="L525"></a> 525         <em class="brace">}</em>
<a id="L526" name="L526"></a> 526     <em class="brace">}</em>
<a id="L527" name="L527"></a> 527 
<div class="comment">
      Separate the name from the value;</div>
<a id="L531" name="L531"></a> 531     cp = <a href="../S/9.html#L50" title="Defined at 50 in src/launcher/jli_util.h.">JLI_StrChr</a>(*lp, (<strong class="reserved">int</strong>)':');
<a id="L532" name="L532"></a> 532     <strong class="reserved">if</strong> (cp == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L533" name="L533"></a> 533         <strong class="reserved">return</strong> (-1);
<div class="comment">
     *cp++ = '\0';               /* The colon terminates the name */</div>
<a id="L535" name="L535"></a> 535     <strong class="reserved">if</strong> (*cp != ' ')
<a id="L536" name="L536"></a> 536         <strong class="reserved">return</strong> (-1);
<div class="comment">
     *cp++ = '\0';               /* Eat the required space */</div>
<a id="L538" name="L538"></a> 538     *<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> = *lp;
<a id="L539" name="L539"></a> 539     *<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = cp;
<a id="L540" name="L540"></a> 540     *lp = nl;
<a id="L541" name="L541"></a> 541     <strong class="reserved">return</strong> (1);
<a id="L542" name="L542"></a> 542 <em class="brace">}</em>
<a id="L543" name="L543"></a> 543 
<div class="comment">
  Read the manifest from the specified jar file and fill in the manifest_info
  structure with the information found within.
  Error returns are as follows:
     0 Success
    -1 Unable to open jarfile
    -2 Error accessing the manifest from within the jarfile (most likely
       a manifest is not present, or this isn't a valid zip/jar file).</div>
<a id="L554" name="L554"></a> 554 <strong class="reserved">int</strong>
<a id="L555" name="L555"></a> 555 <a href="../R/4156.html" title="Multiple referred from 2 places.">JLI_ParseManifest</a>(<strong class="reserved">char</strong> *jarfile, <a href="../D/27439.html" title="Multiple defined in 2 places.">manifest_info</a> *<a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>)
<a id="L556" name="L556"></a> 556 <em class="brace">{</em>
<a id="L557" name="L557"></a> 557     <strong class="reserved">int</strong>     fd;
<a id="L558" name="L558"></a> 558     <a href="../D/37321.html" title="Multiple defined in 2 places.">zentry</a>  entry;
<a id="L559" name="L559"></a> 559     <strong class="reserved">char</strong>    *lp;
<a id="L560" name="L560"></a> 560     <strong class="reserved">char</strong>    *<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>;
<a id="L561" name="L561"></a> 561     <strong class="reserved">char</strong>    *<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L562" name="L562"></a> 562     <strong class="reserved">int</strong>     rc;
<a id="L563" name="L563"></a> 563     <strong class="reserved">char</strong>    *splashscreen_name = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L564" name="L564"></a> 564 
<a id="L565" name="L565"></a> 565     <strong class="reserved">if</strong> ((fd = <a href="../D/28509.html" title="Multiple defined in 32 places.">open</a>(jarfile, O_RDONLY
<a id="L566" name="L566"></a> 566 <em class="sharp">#ifdef</em> O_LARGEFILE
<div class="comment">
         | O_LARGEFILE /* large file mode */</div>
<a id="L568" name="L568"></a> 568 <em class="sharp">#endif</em>
<a id="L569" name="L569"></a> 569 <em class="sharp">#ifdef</em> O_BINARY
<div class="comment">
         | O_BINARY /* use binary mode on windows */</div>
<a id="L571" name="L571"></a> 571 <em class="sharp">#endif</em>
<a id="L572" name="L572"></a> 572         )) == -1) <em class="brace">{</em>
<a id="L573" name="L573"></a> 573         <strong class="reserved">return</strong> (-1);
<a id="L574" name="L574"></a> 574     <em class="brace">}</em>
<a id="L575" name="L575"></a> 575     <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;manifest_version = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L576" name="L576"></a> 576     <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;main_class = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L577" name="L577"></a> 577     <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;jre_version = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L578" name="L578"></a> 578     <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;jre_restrict_search = 0;
<a id="L579" name="L579"></a> 579     <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;splashscreen_image_file_name = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L580" name="L580"></a> 580     <strong class="reserved">if</strong> (rc = <a href="../S/13.html#L327" title="Defined at 327 in src/launcher/parse_manifest.c.">find_file</a>(fd, &amp;entry, manifest_name) != 0) <em class="brace">{</em>
<a id="L581" name="L581"></a> 581         <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L582" name="L582"></a> 582         <strong class="reserved">return</strong> (-2);
<a id="L583" name="L583"></a> 583     <em class="brace">}</em>
<a id="L584" name="L584"></a> 584     manifest = <a href="../S/13.html#L56" title="Defined at 56 in src/launcher/parse_manifest.c.">inflate_file</a>(fd, &amp;entry, <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L585" name="L585"></a> 585     <strong class="reserved">if</strong> (manifest == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L586" name="L586"></a> 586         <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L587" name="L587"></a> 587         <strong class="reserved">return</strong> (-2);
<a id="L588" name="L588"></a> 588     <em class="brace">}</em>
<a id="L589" name="L589"></a> 589     lp = manifest;
<a id="L590" name="L590"></a> 590     <strong class="reserved">while</strong> ((rc = <a href="../S/13.html#L480" title="Defined at 480 in src/launcher/parse_manifest.c.">parse_nv_pair</a>(&amp;lp, &amp;<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, &amp;<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)) &gt; 0) <em class="brace">{</em>
<a id="L591" name="L591"></a> 591         <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, "Manifest-Version") == 0)
<a id="L592" name="L592"></a> 592             <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;manifest_version = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L593" name="L593"></a> 593         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, "Main-Class") == 0)
<a id="L594" name="L594"></a> 594             <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;main_class = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L595" name="L595"></a> 595         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, "JRE-Version") == 0)
<a id="L596" name="L596"></a> 596             <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;jre_version = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L597" name="L597"></a> 597         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, "JRE-Restrict-Search") == 0) <em class="brace">{</em>
<a id="L598" name="L598"></a> 598             <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>, "true") == 0)
<a id="L599" name="L599"></a> 599                 <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;jre_restrict_search = 1;
<a id="L600" name="L600"></a> 600         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, "Splashscreen-Image") == 0) <em class="brace">{</em>
<a id="L601" name="L601"></a> 601             <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;splashscreen_image_file_name = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L602" name="L602"></a> 602         <em class="brace">}</em>
<a id="L603" name="L603"></a> 603     <em class="brace">}</em>
<a id="L604" name="L604"></a> 604     <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L605" name="L605"></a> 605     <strong class="reserved">if</strong> (rc == 0)
<a id="L606" name="L606"></a> 606         <strong class="reserved">return</strong> (0);
<a id="L607" name="L607"></a> 607     <strong class="reserved">else</strong>
<a id="L608" name="L608"></a> 608         <strong class="reserved">return</strong> (-2);
<a id="L609" name="L609"></a> 609 <em class="brace">}</em>
<a id="L610" name="L610"></a> 610 
<div class="comment">
  Opens the jar file and unpacks the specified file from its contents.
  Returns NULL on failure.</div>
<a id="L615" name="L615"></a> 615 <strong class="reserved">void</strong> *
<a id="L616" name="L616"></a> 616 <a href="../R/4149.html" title="Multiple referred from 3 places.">JLI_JarUnpackFile</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *jarfile, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *filename, <strong class="reserved">int</strong> *<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>) <em class="brace">{</em>
<a id="L617" name="L617"></a> 617     <strong class="reserved">int</strong>     fd;
<a id="L618" name="L618"></a> 618     <a href="../D/37321.html" title="Multiple defined in 2 places.">zentry</a>  entry;
<a id="L619" name="L619"></a> 619     <strong class="reserved">void</strong>    *<a href="../S/6040.html#L177" title="Defined at 177 in src/com/sun/org/apache/xalan/internal/xsltc/dom/BitArray.java.">data</a> = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L620" name="L620"></a> 620 
<a id="L621" name="L621"></a> 621     <strong class="reserved">if</strong> ((fd = <a href="../D/28509.html" title="Multiple defined in 32 places.">open</a>(jarfile, O_RDONLY
<a id="L622" name="L622"></a> 622 <em class="sharp">#ifdef</em> O_LARGEFILE
<div class="comment">
         | O_LARGEFILE /* large file mode */</div>
<a id="L624" name="L624"></a> 624 <em class="sharp">#endif</em>
<a id="L625" name="L625"></a> 625 <em class="sharp">#ifdef</em> O_BINARY
<div class="comment">
         | O_BINARY /* use binary mode on windows */</div>
<a id="L627" name="L627"></a> 627 <em class="sharp">#endif</em>
<a id="L628" name="L628"></a> 628         )) == -1) <em class="brace">{</em>
<a id="L629" name="L629"></a> 629         <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L630" name="L630"></a> 630     <em class="brace">}</em>
<a id="L631" name="L631"></a> 631     <strong class="reserved">if</strong> (<a href="../S/13.html#L327" title="Defined at 327 in src/launcher/parse_manifest.c.">find_file</a>(fd, &amp;entry, filename) == 0) <em class="brace">{</em>
<a id="L632" name="L632"></a> 632         <a href="../S/6040.html#L177" title="Defined at 177 in src/com/sun/org/apache/xalan/internal/xsltc/dom/BitArray.java.">data</a> = <a href="../S/13.html#L56" title="Defined at 56 in src/launcher/parse_manifest.c.">inflate_file</a>(fd, &amp;entry, <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>);
<a id="L633" name="L633"></a> 633     <em class="brace">}</em>
<a id="L634" name="L634"></a> 634     <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L635" name="L635"></a> 635     <strong class="reserved">return</strong> (<a href="../S/6040.html#L177" title="Defined at 177 in src/com/sun/org/apache/xalan/internal/xsltc/dom/BitArray.java.">data</a>);
<a id="L636" name="L636"></a> 636 <em class="brace">}</em>
<a id="L637" name="L637"></a> 637 
<div class="comment">
  Specialized "free" function.</div>
<a id="L641" name="L641"></a> 641 <strong class="reserved">void</strong>
<a id="L642" name="L642"></a> 642 <a href="../R/4146.html" title="Multiple referred from 4 places.">JLI_FreeManifest</a>()
<a id="L643" name="L643"></a> 643 <em class="brace">{</em>
<a id="L644" name="L644"></a> 644     <strong class="reserved">if</strong> (manifest)
<a id="L645" name="L645"></a> 645         <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(manifest);
<a id="L646" name="L646"></a> 646 <em class="brace">}</em>
<a id="L647" name="L647"></a> 647 
<div class="comment">
  Iterate over the manifest of the specified jar file and invoke the provided
  closure function for each attribute encountered.
  Error returns are as follows:
     0 Success
    -1 Unable to open jarfile
    -2 Error accessing the manifest from within the jarfile (most likely
       this means a manifest is not present, or it isn't a valid zip/jar file).</div>
<a id="L658" name="L658"></a> 658 <strong class="reserved">int</strong>
<a id="L659" name="L659"></a> 659 <a href="../S/12.html#L184" title="Referred from 184 in src/launcher/manifest_info.h.">JLI_ManifestIterate</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *jarfile, attribute_closure ac, <strong class="reserved">void</strong> *user_data)
<a id="L660" name="L660"></a> 660 <em class="brace">{</em>
<a id="L661" name="L661"></a> 661     <strong class="reserved">int</strong>     fd;
<a id="L662" name="L662"></a> 662     <a href="../D/37321.html" title="Multiple defined in 2 places.">zentry</a>  entry;
<a id="L663" name="L663"></a> 663     <div class="comment">
/* manifest pointer */</div>
<a id="L664" name="L664"></a> 664     <div class="comment">
/* pointer into manifest, updated during iteration */</div>
<a id="L665" name="L665"></a> 665     <strong class="reserved">char</strong>    *<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>;
<a id="L666" name="L666"></a> 666     <strong class="reserved">char</strong>    *<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L667" name="L667"></a> 667     <strong class="reserved">int</strong>     rc;
<a id="L668" name="L668"></a> 668 
<a id="L669" name="L669"></a> 669     <strong class="reserved">if</strong> ((fd = <a href="../D/28509.html" title="Multiple defined in 32 places.">open</a>(jarfile, O_RDONLY
<a id="L670" name="L670"></a> 670 <em class="sharp">#ifdef</em> O_LARGEFILE
<div class="comment">
         | O_LARGEFILE /* large file mode */</div>
<a id="L672" name="L672"></a> 672 <em class="sharp">#endif</em>
<a id="L673" name="L673"></a> 673 <em class="sharp">#ifdef</em> O_BINARY
<div class="comment">
         | O_BINARY /* use binary mode on windows */</div>
<a id="L675" name="L675"></a> 675 <em class="sharp">#endif</em>
<a id="L676" name="L676"></a> 676         )) == -1) <em class="brace">{</em>
<a id="L677" name="L677"></a> 677         <strong class="reserved">return</strong> (-1);
<a id="L678" name="L678"></a> 678     <em class="brace">}</em>
<a id="L679" name="L679"></a> 679 
<a id="L680" name="L680"></a> 680     <strong class="reserved">if</strong> (rc = <a href="../S/13.html#L327" title="Defined at 327 in src/launcher/parse_manifest.c.">find_file</a>(fd, &amp;entry, manifest_name) != 0) <em class="brace">{</em>
<a id="L681" name="L681"></a> 681         <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L682" name="L682"></a> 682         <strong class="reserved">return</strong> (-2);
<a id="L683" name="L683"></a> 683     <em class="brace">}</em>
<a id="L684" name="L684"></a> 684 
<a id="L685" name="L685"></a> 685     mp = <a href="../S/13.html#L56" title="Defined at 56 in src/launcher/parse_manifest.c.">inflate_file</a>(fd, &amp;entry, <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L686" name="L686"></a> 686     <strong class="reserved">if</strong> (mp == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L687" name="L687"></a> 687         <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L688" name="L688"></a> 688         <strong class="reserved">return</strong> (-2);
<a id="L689" name="L689"></a> 689     <em class="brace">}</em>
<a id="L690" name="L690"></a> 690 
<a id="L691" name="L691"></a> 691     lp = mp;
<a id="L692" name="L692"></a> 692     <strong class="reserved">while</strong> ((rc = <a href="../S/13.html#L480" title="Defined at 480 in src/launcher/parse_manifest.c.">parse_nv_pair</a>(&amp;lp, &amp;<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, &amp;<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)) &gt; 0) <em class="brace">{</em>
<a id="L693" name="L693"></a> 693         (*ac)(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>, user_data);
<a id="L694" name="L694"></a> 694     <em class="brace">}</em>
<a id="L695" name="L695"></a> 695     <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>(mp);
<a id="L696" name="L696"></a> 696     <a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>(fd);
<a id="L697" name="L697"></a> 697     <strong class="reserved">return</strong> (rc == 0) ? 0 : -2;
<a id="L698" name="L698"></a> 698 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L56">[^]</a><a href="#L659">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>