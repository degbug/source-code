<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L270">[^]</a><a href="#L1255">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L270" title="Defined at 270.">size</a></li>
<li><a href="#L280" title="Defined at 280.">length</a></li>
<li><a href="#L290" title="Defined at 290.">reset</a></li>
<li><a href="#L326" title="Defined at 326.">setLength</a></li>
<li><a href="#L359" title="Defined at 359.">setLength</a></li>
<li><a href="#L400" title="Defined at 400.">toString</a></li>
<li><a href="#L418" title="Defined at 418.">append</a></li>
<li><a href="#L480" title="Defined at 480.">append</a></li>
<li><a href="#L562" title="Defined at 562.">append</a></li>
<li><a href="#L647" title="Defined at 647.">append</a></li>
<li><a href="#L728" title="Defined at 728.">append</a></li>
<li><a href="#L827" title="Defined at 827.">isWhitespace</a></li>
<li><a href="#L865" title="Defined at 865.">getString</a></li>
<li><a href="#L876" title="Defined at 876.">getOneChunkString</a></li>
<li><a href="#L887" title="Defined at 887.">getString</a></li>
<li><a href="#L916" title="Defined at 916.">getString</a></li>
<li><a href="#L951" title="Defined at 951.">charAt</a></li>
<li><a href="#L980" title="Defined at 980.">sendSAXcharacters</a></li>
<li><a href="#L1040" title="Defined at 1040.">sendNormalizedSAXcharacters</a></li>
<li><a href="#L1130" title="Defined at 1130.">sendNormalizedSAXcharacters</a></li>
<li><a href="#L1203" title="Defined at 1203.">sendNormalizedSAXcharacters</a></li>
<li><a href="#L1224" title="Defined at 1224.">sendSAXComment</a></li>
<li><a href="#L1255" title="Defined at 1255.">getChars</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<div class="comment">
  Copyright 1999-2004 The Apache Software Foundation.
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
      http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.</div>
<div class="comment">
  $Id: FastStringBuffer.java,v 1.2.4.1 2005/09/15 08:15:44 suresh_emailid Exp $</div>
<a id="L23" name="L23"></a>  23 <strong class="reserved">package</strong> com.sun.org.apache.xml.internal.utils;
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Bare-bones, unsafe, fast string buffer. No thread-safety, no
  parameter range checking, exposed fields. Note that in typical
  applications, thread-safety of a StringBuffer is a somewhat
  dubious concept in any case.
  <p>
  Note that Stree and DTM used a single FastStringBuffer as a string pool,
  by recording start and length indices within this single buffer. This
  minimizes heap overhead, but of course requires more work when retrieving
  the data.
  </p><p>
  FastStringBuffer operates as a "chunked buffer". Doing so
  reduces the need to recopy existing information when an append
  exceeds the space available; we just allocate another chunk and
  flow across to it. (The array of chunks may need to grow,
  admittedly, but that's a much smaller object.) Some excess
  recopying may arise when we extract Strings which cross chunk
  boundaries; larger chunks make that less frequent.
  </p><p>
  The size values are parameterized, to allow tuning this code. In
  theory, Result Tree Fragments might want to be tuned differently
  from the main document's text.
  </p><p>
  %REVIEW% An experiment in self-tuning is
  included in the code (using nested FastStringBuffers to achieve
  variation in chunk sizes), but this implementation has proven to
  be problematic when data may be being copied from the FSB into itself.
  We should either re-architect that to make this safe (if possible)
  or remove that code and clean up for performance/maintainability reasons.
  </p><p></p></div>
<a id="L56" name="L56"></a>  56 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/2871.html" title="Multiple referred from 57 places.">FastStringBuffer</a>
<a id="L57" name="L57"></a>  57 <em class="brace">{</em>
<a id="L58" name="L58"></a>  58   <em class="comment">// If nonzero, forces the inial chunk size.</em>
<div class="comment">
   /**/</div><strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> DEBUG_FORCE_INIT_BITS=0;
<a id="L60" name="L60"></a>  60 
<a id="L61" name="L61"></a>  61         <em class="comment">// %BUG% %REVIEW% *****PROBLEM SUSPECTED: If data from an FSB is being copied</em>
<a id="L62" name="L62"></a>  62         <em class="comment">// back into the same FSB (variable set from previous variable, for example)</em>
<a id="L63" name="L63"></a>  63         <em class="comment">// and blocksize changes in mid-copy... there's risk of severe malfunction in</em>
<a id="L64" name="L64"></a>  64         <em class="comment">// the read process, due to how the resizing code re-jiggers storage. Arggh.</em>
<a id="L65" name="L65"></a>  65         <em class="comment">// If we want to retain the variable-size-block feature, we need to reconsider</em>
<a id="L66" name="L66"></a>  66         <em class="comment">// that issue. For now, I have forced us into fixed-size mode.</em>
<a id="L67" name="L67"></a>  67     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> DEBUG_FORCE_FIXED_CHUNKSIZE=<strong class="reserved">true</strong>;
<a id="L68" name="L68"></a>  68 
<div class="comment">
 Manifest constant: Suppress leading whitespace.
          This should be used when normalize-to-SAX is called for the first chunk of a
          multi-chunk output, or one following unsuppressed whitespace in a previous
          chunk.
          @see #sendNormalizedSAXcharacters(org.xml.sax.ContentHandler,int,int)</div>
<a id="L75" name="L75"></a>  75         <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SUPPRESS_LEADING_WS=0x01;
<a id="L76" name="L76"></a>  76 
<div class="comment">
 Manifest constant: Suppress trailing whitespace.
          This should be used when normalize-to-SAX is called for the last chunk of a
          multi-chunk output; it may have to be or'ed with SUPPRESS_LEADING_WS.</div>
<a id="L81" name="L81"></a>  81         <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SUPPRESS_TRAILING_WS=0x02;
<a id="L82" name="L82"></a>  82 
<div class="comment">
 Manifest constant: Suppress both leading and trailing whitespace.
          This should be used when normalize-to-SAX is called for a complete string.
          (I'm not wild about the name of this one. Ideas welcome.)
          @see #sendNormalizedSAXcharacters(org.xml.sax.ContentHandler,int,int)</div>
<a id="L88" name="L88"></a>  88         <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SUPPRESS_BOTH
<a id="L89" name="L89"></a>  89                 = SUPPRESS_LEADING_WS | SUPPRESS_TRAILING_WS;
<a id="L90" name="L90"></a>  90 
<div class="comment">
 Manifest constant: Carry trailing whitespace of one chunk as leading
          whitespace of the next chunk. Used internally; I don't see any reason
          to make it public right now.</div>
<a id="L95" name="L95"></a>  95         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CARRY_WS=0x04;
<a id="L96" name="L96"></a>  96 
<div class="comment">
    Field m_chunkBits sets our chunking strategy, by saying how many
    bits of index can be used within a single chunk before flowing over
    to the next chunk. For example, if m_chunkbits is set to 15, each
    chunk can contain up to 2^15 (32K) characters</div>
<a id="L103" name="L103"></a> 103   <strong class="reserved">int</strong> m_chunkBits = 15;
<a id="L104" name="L104"></a> 104 
<div class="comment">
    Field m_maxChunkBits affects our chunk-growth strategy, by saying what
    the largest permissible chunk size is in this particular FastStringBuffer
    hierarchy.</div>
<a id="L110" name="L110"></a> 110   <strong class="reserved">int</strong> m_maxChunkBits = 15;
<a id="L111" name="L111"></a> 111 
<div class="comment">
    Field m_rechunkBits affects our chunk-growth strategy, by saying how
    many chunks should be allocated at one size before we encapsulate them
    into the first chunk of the next size up. For example, if m_rechunkBits
    is set to 3, then after 8 chunks at a given size we will rebundle
    them as the first element of a FastStringBuffer using a chunk size
    8 times larger (chunkBits shifted left three bits).</div>
<a id="L120" name="L120"></a> 120   <strong class="reserved">int</strong> m_rebundleBits = 2;
<a id="L121" name="L121"></a> 121 
<div class="comment">
    Field m_chunkSize establishes the maximum size of one chunk of the array
    as 2**chunkbits characters.
    (Which may also be the minimum size if we aren't tuning for storage)</div>
<a id="L127" name="L127"></a> 127   <strong class="reserved">int</strong> m_chunkSize;  <em class="comment">// =1&lt;&lt;(m_chunkBits-1);</em>
<a id="L128" name="L128"></a> 128 
<div class="comment">
    Field m_chunkMask is m_chunkSize-1 -- in other words, m_chunkBits
    worth of low-order '1' bits, useful for shift-and-mask addressing
    within the chunks.</div>
<a id="L134" name="L134"></a> 134   <strong class="reserved">int</strong> m_chunkMask;  <em class="comment">// =m_chunkSize-1;</em>
<a id="L135" name="L135"></a> 135 
<div class="comment">
    Field m_array holds the string buffer's text contents, using an
    array-of-arrays. Note that this array, and the arrays it contains, may be
    reallocated when necessary in order to allow the buffer to grow;
    references to them should be considered to be invalidated after any
    append. However, the only time these arrays are directly exposed
    is in the sendSAXcharacters call.</div>
<a id="L144" name="L144"></a> 144   <strong class="reserved">char</strong>[][] m_array;
<a id="L145" name="L145"></a> 145 
<div class="comment">
    Field m_lastChunk is an index into m_array[], pointing to the last
    chunk of the Chunked Array currently in use. Note that additional
    chunks may actually be allocated, eg if the FastStringBuffer had
    previously been truncated or if someone issued an ensureSpace request.
    <p>
    The insertion point for append operations is addressed by the combination
    of m_lastChunk and m_firstFree.</p></div>
<a id="L155" name="L155"></a> 155   <strong class="reserved">int</strong> m_lastChunk = 0;
<a id="L156" name="L156"></a> 156 
<div class="comment">
    Field m_firstFree is an index into m_array[m_lastChunk][], pointing to
    the first character in the Chunked Array which is not part of the
    FastStringBuffer's current content. Since m_array[][] is zero-based,
    the length of that content can be calculated as
    (m_lastChunk&lt;</div>
<a id="L164" name="L164"></a> 164   <strong class="reserved">int</strong> m_firstFree = 0;
<a id="L165" name="L165"></a> 165 
<div class="comment">
    Field m_innerFSB, when non-null, is a FastStringBuffer whose total
    length equals m_chunkSize, and which replaces m_array[0]. This allows
    building a hierarchy of FastStringBuffers, where early appends use
    a smaller chunkSize (for less wasted memory overhead) but later
    ones use a larger chunkSize (for less heap activity overhead).</div>
<a id="L173" name="L173"></a> 173   <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a> m_innerFSB = <strong class="reserved">null</strong>;
<a id="L174" name="L174"></a> 174 
<div class="comment">
    Construct a FastStringBuffer, with allocation policy as per parameters.
    <p>
    For coding convenience, I've expressed both allocation sizes in terms of
    a number of bits. That's needed for the final size of a chunk,
    to permit fast and efficient shift-and-mask addressing. It's less critical
    for the inital size, and may be reconsidered.
    </p><p>
    An alternative would be to accept integer sizes and round to powers of two;
    that really doesn't seem to buy us much, if anything.
    @param initChunkBits Length in characters of the initial allocation
    of a chunk, expressed in log-base-2. (That is, 10 means allocate 1024
    characters.) Later chunks will use larger allocation units, to trade off
    allocation speed of large document against storage efficiency of small
    ones.
    @param maxChunkBits Number of character-offset bits that should be used for
    addressing within a chunk. Maximum length of a chunk is 2^chunkBits
    characters.
    @param rebundleBits Number of character-offset bits that addressing should
    advance before we attempt to take a step from initChunkBits to maxChunkBits</p></div>
<a id="L197" name="L197"></a> 197   <strong class="reserved">public</strong> FastStringBuffer(<strong class="reserved">int</strong> initChunkBits, <strong class="reserved">int</strong> maxChunkBits,
<a id="L198" name="L198"></a> 198                           <strong class="reserved">int</strong> rebundleBits)
<a id="L199" name="L199"></a> 199   <em class="brace">{</em>
<a id="L200" name="L200"></a> 200     <strong class="reserved">if</strong>(DEBUG_FORCE_INIT_BITS!=0) initChunkBits=DEBUG_FORCE_INIT_BITS;
<a id="L201" name="L201"></a> 201 
<a id="L202" name="L202"></a> 202     <em class="comment">// %REVIEW%</em>
<a id="L203" name="L203"></a> 203     <em class="comment">// Should this force to larger value, or smaller? Smaller less efficient, but if</em>
<a id="L204" name="L204"></a> 204     <em class="comment">// someone requested variable mode it's because they care about storage space.</em>
<a id="L205" name="L205"></a> 205     <em class="comment">// On the other hand, given the other changes I'm making, odds are that we should</em>
<a id="L206" name="L206"></a> 206     <em class="comment">// adopt the larger size. Dither, dither, dither... This is just stopgap workaround</em>
<a id="L207" name="L207"></a> 207     <em class="comment">// anyway; we need a permanant solution.</em>
<a id="L208" name="L208"></a> 208     <em class="comment">//</em>
<a id="L209" name="L209"></a> 209     <strong class="reserved">if</strong>(DEBUG_FORCE_FIXED_CHUNKSIZE) maxChunkBits=initChunkBits;
<a id="L210" name="L210"></a> 210     <em class="comment">//if(DEBUG_FORCE_FIXED_CHUNKSIZE) initChunkBits=maxChunkBits;</em>
<a id="L211" name="L211"></a> 211 
<a id="L212" name="L212"></a> 212     m_array = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[16][];
<a id="L213" name="L213"></a> 213 
<a id="L214" name="L214"></a> 214     <em class="comment">// Don't bite off more than we're prepared to swallow!</em>
<a id="L215" name="L215"></a> 215     <strong class="reserved">if</strong> (initChunkBits &gt; maxChunkBits)
<a id="L216" name="L216"></a> 216       initChunkBits = maxChunkBits;
<a id="L217" name="L217"></a> 217 
<a id="L218" name="L218"></a> 218     m_chunkBits = initChunkBits;
<a id="L219" name="L219"></a> 219     m_maxChunkBits = maxChunkBits;
<a id="L220" name="L220"></a> 220     m_rebundleBits = rebundleBits;
<a id="L221" name="L221"></a> 221     m_chunkSize = 1 &lt;&lt; (initChunkBits);
<a id="L222" name="L222"></a> 222     m_chunkMask = m_chunkSize - 1;
<a id="L223" name="L223"></a> 223     m_array[0] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L224" name="L224"></a> 224   <em class="brace">}</em>
<a id="L225" name="L225"></a> 225 
<div class="comment">
    Construct a FastStringBuffer, using a default rebundleBits value.
    NEEDSDOC @param initChunkBits
    NEEDSDOC @param maxChunkBits</div>
<a id="L232" name="L232"></a> 232   <strong class="reserved">public</strong> FastStringBuffer(<strong class="reserved">int</strong> initChunkBits, <strong class="reserved">int</strong> maxChunkBits)
<a id="L233" name="L233"></a> 233   <em class="brace">{</em>
<a id="L234" name="L234"></a> 234     <strong class="reserved">this</strong>(initChunkBits, maxChunkBits, 2);
<a id="L235" name="L235"></a> 235   <em class="brace">}</em>
<a id="L236" name="L236"></a> 236 
<div class="comment">
    Construct a FastStringBuffer, using default maxChunkBits and
    rebundleBits values.
    <p>
    ISSUE: Should this call assert initial size, or fixed size?
    Now configured as initial, with a default for fixed.
    NEEDSDOC @param initChunkBits</p></div>
<a id="L246" name="L246"></a> 246   <strong class="reserved">public</strong> FastStringBuffer(<strong class="reserved">int</strong> initChunkBits)
<a id="L247" name="L247"></a> 247   <em class="brace">{</em>
<a id="L248" name="L248"></a> 248     <strong class="reserved">this</strong>(initChunkBits, 15, 2);
<a id="L249" name="L249"></a> 249   <em class="brace">}</em>
<a id="L250" name="L250"></a> 250 
<div class="comment">
    Construct a FastStringBuffer, using a default allocation policy.</div>
<a id="L254" name="L254"></a> 254   <strong class="reserved">public</strong> FastStringBuffer()
<a id="L255" name="L255"></a> 255   <em class="brace">{</em>
<a id="L256" name="L256"></a> 256 
<a id="L257" name="L257"></a> 257     <em class="comment">// 10 bits is 1K. 15 bits is 32K. Remember that these are character</em>
<a id="L258" name="L258"></a> 258     <em class="comment">// counts, so actual memory allocation unit is doubled for UTF-16 chars.</em>
<a id="L259" name="L259"></a> 259     <em class="comment">//</em>
<a id="L260" name="L260"></a> 260     <em class="comment">// For reference: In the original FastStringBuffer, we simply</em>
<a id="L261" name="L261"></a> 261     <em class="comment">// overallocated by blocksize (default 1KB) on each buffer-growth.</em>
<a id="L262" name="L262"></a> 262     <strong class="reserved">this</strong>(10, 15, 2);
<a id="L263" name="L263"></a> 263   <em class="brace">}</em>
<a id="L264" name="L264"></a> 264 
<div class="comment">
    Get the length of the list. Synonym for length().
    @return the number of characters in the FastStringBuffer's content.</div>
<a id="L270" name="L270"></a> 270   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/28639.html" title="Multiple referred from 5617 places.">size</a>()
<a id="L271" name="L271"></a> 271   <em class="brace">{</em>
<a id="L272" name="L272"></a> 272     <strong class="reserved">return</strong> (m_lastChunk &lt;&lt; m_chunkBits) + m_firstFree;
<a id="L273" name="L273"></a> 273   <em class="brace">}</em>
<a id="L274" name="L274"></a> 274 
<div class="comment">
    Get the length of the list. Synonym for size().
    @return the number of characters in the FastStringBuffer's content.</div>
<a id="L280" name="L280"></a> 280   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/22477.html" title="Multiple referred from 12963 places.">length</a>()
<a id="L281" name="L281"></a> 281   <em class="brace">{</em>
<a id="L282" name="L282"></a> 282     <strong class="reserved">return</strong> (m_lastChunk &lt;&lt; m_chunkBits) + m_firstFree;
<a id="L283" name="L283"></a> 283   <em class="brace">}</em>
<a id="L284" name="L284"></a> 284 
<div class="comment">
    Discard the content of the FastStringBuffer, and most of the memory
    that was allocated by it, restoring the initial state. Note that this
    may eventually be different from setLength(0), which see.</div>
<a id="L290" name="L290"></a> 290   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/26238.html" title="Multiple referred from 619 places.">reset</a>()
<a id="L291" name="L291"></a> 291   <em class="brace">{</em>
<a id="L292" name="L292"></a> 292 
<a id="L293" name="L293"></a> 293     m_lastChunk = 0;
<a id="L294" name="L294"></a> 294     m_firstFree = 0;
<a id="L295" name="L295"></a> 295 
<a id="L296" name="L296"></a> 296     <em class="comment">// Recover the original chunk size</em>
<a id="L297" name="L297"></a> 297     <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a> innermost = <strong class="reserved">this</strong>;
<a id="L298" name="L298"></a> 298 
<a id="L299" name="L299"></a> 299     <strong class="reserved">while</strong> (innermost.m_innerFSB != <strong class="reserved">null</strong>)
<a id="L300" name="L300"></a> 300     <em class="brace">{</em>
<a id="L301" name="L301"></a> 301       innermost = innermost.m_innerFSB;
<a id="L302" name="L302"></a> 302     <em class="brace">}</em>
<a id="L303" name="L303"></a> 303 
<a id="L304" name="L304"></a> 304     m_chunkBits = innermost.m_chunkBits;
<a id="L305" name="L305"></a> 305     m_chunkSize = innermost.m_chunkSize;
<a id="L306" name="L306"></a> 306     m_chunkMask = innermost.m_chunkMask;
<a id="L307" name="L307"></a> 307 
<a id="L308" name="L308"></a> 308     <em class="comment">// Discard the hierarchy</em>
<a id="L309" name="L309"></a> 309     m_innerFSB = <strong class="reserved">null</strong>;
<a id="L310" name="L310"></a> 310     m_array = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[16][0];
<a id="L311" name="L311"></a> 311     m_array[0] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L312" name="L312"></a> 312   <em class="brace">}</em>
<a id="L313" name="L313"></a> 313 
<div class="comment">
    Directly set how much of the FastStringBuffer's storage is to be
    considered part of its content. This is a fast but hazardous
    operation. It is not protected against negative values, or values
    greater than the amount of storage currently available... and even
    if additional storage does exist, its contents are unpredictable.
    The only safe use for our setLength() is to truncate the FastStringBuffer
    to a shorter string.
    @param l New length. If l&lt;0 or l&gt;=getLength(), this operation will
    not report an error but future operations will almost certainly fail.</div>
<a id="L326" name="L326"></a> 326   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/27657.html" title="Multiple referred from 89 places.">setLength</a>(<strong class="reserved">int</strong> l)
<a id="L327" name="L327"></a> 327   <em class="brace">{</em>
<a id="L328" name="L328"></a> 328     m_lastChunk = l &gt;&gt;&gt; m_chunkBits;
<a id="L329" name="L329"></a> 329 
<a id="L330" name="L330"></a> 330     <strong class="reserved">if</strong> (m_lastChunk == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L331" name="L331"></a> 331     <em class="brace">{</em>
<a id="L332" name="L332"></a> 332       <em class="comment">// Replace this FSB with the appropriate inner FSB, truncated</em>
<a id="L333" name="L333"></a> 333       m_innerFSB.<a href="../D/33077.html" title="Multiple defined in 10 places.">setLength</a>(l, <strong class="reserved">this</strong>);
<a id="L334" name="L334"></a> 334     <em class="brace">}</em>
<a id="L335" name="L335"></a> 335     <strong class="reserved">else</strong>
<a id="L336" name="L336"></a> 336     <em class="brace">{</em>
<a id="L337" name="L337"></a> 337       m_firstFree = l &amp; m_chunkMask;
<a id="L338" name="L338"></a> 338 
<a id="L339" name="L339"></a> 339           <em class="comment">// There's an edge case if l is an exact multiple of m_chunkBits, which risks leaving</em>
<a id="L340" name="L340"></a> 340           <em class="comment">// us pointing at the start of a chunk which has not yet been allocated. Rather than</em>
<a id="L341" name="L341"></a> 341           <em class="comment">// pay the cost of dealing with that in the append loops (more scattered and more</em>
<a id="L342" name="L342"></a> 342           <em class="comment">// inner-loop), we correct it here by moving to the safe side of that</em>
<a id="L343" name="L343"></a> 343           <em class="comment">// line -- as we would have left the indexes had we appended up to that point.</em>
<a id="L344" name="L344"></a> 344       <strong class="reserved">if</strong>(m_firstFree==0 &amp;&amp; m_lastChunk&gt;0)
<a id="L345" name="L345"></a> 345       <em class="brace">{</em>
<a id="L346" name="L346"></a> 346         --m_lastChunk;
<a id="L347" name="L347"></a> 347         m_firstFree=m_chunkSize;
<a id="L348" name="L348"></a> 348       <em class="brace">}</em>
<a id="L349" name="L349"></a> 349     <em class="brace">}</em>
<a id="L350" name="L350"></a> 350   <em class="brace">}</em>
<a id="L351" name="L351"></a> 351 
<div class="comment">
    Subroutine for the public setLength() method. Deals with the fact
    that truncation may require restoring one of the innerFSBs
    NEEDSDOC @param l
    NEEDSDOC @param rootFSB</div>
<a id="L359" name="L359"></a> 359   <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/27657.html" title="Multiple referred from 89 places.">setLength</a>(<strong class="reserved">int</strong> l, <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a> rootFSB)
<a id="L360" name="L360"></a> 360   <em class="brace">{</em>
<a id="L361" name="L361"></a> 361 
<a id="L362" name="L362"></a> 362     m_lastChunk = l &gt;&gt;&gt; m_chunkBits;
<a id="L363" name="L363"></a> 363 
<a id="L364" name="L364"></a> 364     <strong class="reserved">if</strong> (m_lastChunk == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L365" name="L365"></a> 365     <em class="brace">{</em>
<a id="L366" name="L366"></a> 366       m_innerFSB.<a href="../D/33077.html" title="Multiple defined in 10 places.">setLength</a>(l, rootFSB);
<a id="L367" name="L367"></a> 367     <em class="brace">}</em>
<a id="L368" name="L368"></a> 368     <strong class="reserved">else</strong>
<a id="L369" name="L369"></a> 369     <em class="brace">{</em>
<a id="L370" name="L370"></a> 370 
<a id="L371" name="L371"></a> 371       <em class="comment">// Undo encapsulation -- pop the innerFSB data back up to root.</em>
<a id="L372" name="L372"></a> 372       <em class="comment">// Inefficient, but attempts to keep the code simple.</em>
<a id="L373" name="L373"></a> 373       rootFSB.m_chunkBits = m_chunkBits;
<a id="L374" name="L374"></a> 374       rootFSB.m_maxChunkBits = m_maxChunkBits;
<a id="L375" name="L375"></a> 375       rootFSB.m_rebundleBits = m_rebundleBits;
<a id="L376" name="L376"></a> 376       rootFSB.m_chunkSize = m_chunkSize;
<a id="L377" name="L377"></a> 377       rootFSB.m_chunkMask = m_chunkMask;
<a id="L378" name="L378"></a> 378       rootFSB.m_array = m_array;
<a id="L379" name="L379"></a> 379       rootFSB.m_innerFSB = m_innerFSB;
<a id="L380" name="L380"></a> 380       rootFSB.m_lastChunk = m_lastChunk;
<a id="L381" name="L381"></a> 381 
<a id="L382" name="L382"></a> 382       <em class="comment">// Finally, truncate this sucker.</em>
<a id="L383" name="L383"></a> 383       rootFSB.m_firstFree = l &amp; m_chunkMask;
<a id="L384" name="L384"></a> 384     <em class="brace">}</em>
<a id="L385" name="L385"></a> 385   <em class="brace">}</em>
<a id="L386" name="L386"></a> 386 
<div class="comment">
    Note that this operation has been somewhat deoptimized by the shift to a
    chunked array, as there is no factory method to produce a String object
    directly from an array of arrays and hence a double copy is needed.
    By using ensureCapacity we hope to minimize the heap overhead of building
    the intermediate StringBuffer.
    <p>
    (It really is a pity that Java didn't design String as a final subclass
    of MutableString, rather than having StringBuffer be a separate hierarchy.
    We'd avoid a <strong>lot</strong> of double-buffering.)
    @return the contents of the FastStringBuffer as a standard Java string.</p></div>
<a id="L400" name="L400"></a> 400   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>()
<a id="L401" name="L401"></a> 401   <em class="brace">{</em>
<a id="L402" name="L402"></a> 402 
<a id="L403" name="L403"></a> 403     <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = (m_lastChunk &lt;&lt; m_chunkBits) + m_firstFree;
<a id="L404" name="L404"></a> 404 
<a id="L405" name="L405"></a> 405     <strong class="reserved">return</strong> <a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(<strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>(<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>), 0, 0, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>).<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L406" name="L406"></a> 406   <em class="brace">}</em>
<a id="L407" name="L407"></a> 407 
<div class="comment">
    Append a single character onto the FastStringBuffer, growing the
    storage if necessary.
    <p>
    NOTE THAT after calling append(), previously obtained
    references to m_array[][] may no longer be valid....
    though in fact they should be in this instance.
    @param value character to be appended.</p></div>
<a id="L418" name="L418"></a> 418   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10189.html" title="Multiple referred from 5855 places.">append</a>(<strong class="reserved">char</strong> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)
<a id="L419" name="L419"></a> 419   <em class="brace">{</em>
<a id="L420" name="L420"></a> 420 
<a id="L421" name="L421"></a> 421     <strong class="reserved">char</strong>[] chunk;
<a id="L422" name="L422"></a> 422 
<a id="L423" name="L423"></a> 423     <em class="comment">// We may have preallocated chunks. If so, all but last should</em>
<a id="L424" name="L424"></a> 424     <em class="comment">// be at full size.</em>
<a id="L425" name="L425"></a> 425     <strong class="reserved">boolean</strong> lastchunk = (m_lastChunk + 1 == m_array.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L426" name="L426"></a> 426 
<a id="L427" name="L427"></a> 427     <strong class="reserved">if</strong> (m_firstFree &lt; m_chunkSize)  <em class="comment">// Simplified test single-character-fits</em>
<a id="L428" name="L428"></a> 428       chunk = m_array[m_lastChunk];
<a id="L429" name="L429"></a> 429     <strong class="reserved">else</strong>
<a id="L430" name="L430"></a> 430     <em class="brace">{</em>
<a id="L431" name="L431"></a> 431 
<a id="L432" name="L432"></a> 432       <em class="comment">// Extend array?</em>
<a id="L433" name="L433"></a> 433       <strong class="reserved">int</strong> i = m_array.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L434" name="L434"></a> 434 
<a id="L435" name="L435"></a> 435       <strong class="reserved">if</strong> (m_lastChunk + 1 == i)
<a id="L436" name="L436"></a> 436       <em class="brace">{</em>
<a id="L437" name="L437"></a> 437         <strong class="reserved">char</strong>[][] newarray = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[i + 16][];
<a id="L438" name="L438"></a> 438 
<a id="L439" name="L439"></a> 439         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(m_array, 0, newarray, 0, i);
<a id="L440" name="L440"></a> 440 
<a id="L441" name="L441"></a> 441         m_array = newarray;
<a id="L442" name="L442"></a> 442       <em class="brace">}</em>
<a id="L443" name="L443"></a> 443 
<a id="L444" name="L444"></a> 444       <em class="comment">// Advance one chunk</em>
<a id="L445" name="L445"></a> 445       chunk = m_array[++m_lastChunk];
<a id="L446" name="L446"></a> 446 
<a id="L447" name="L447"></a> 447       <strong class="reserved">if</strong> (chunk == <strong class="reserved">null</strong>)
<a id="L448" name="L448"></a> 448       <em class="brace">{</em>
<a id="L449" name="L449"></a> 449 
<a id="L450" name="L450"></a> 450         <em class="comment">// Hierarchical encapsulation</em>
<a id="L451" name="L451"></a> 451         <strong class="reserved">if</strong> (m_lastChunk == 1 &lt;&lt; m_rebundleBits
<a id="L452" name="L452"></a> 452                 &amp;&amp; m_chunkBits &lt; m_maxChunkBits)
<a id="L453" name="L453"></a> 453         <em class="brace">{</em>
<a id="L454" name="L454"></a> 454 
<a id="L455" name="L455"></a> 455           <em class="comment">// Should do all the work of both encapsulating</em>
<a id="L456" name="L456"></a> 456           <em class="comment">// existing data and establishing new sizes/offsets</em>
<a id="L457" name="L457"></a> 457           m_innerFSB = <strong class="reserved">new</strong> <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a>(<strong class="reserved">this</strong>);
<a id="L458" name="L458"></a> 458         <em class="brace">}</em>
<a id="L459" name="L459"></a> 459 
<a id="L460" name="L460"></a> 460         <em class="comment">// Add a chunk.</em>
<a id="L461" name="L461"></a> 461         chunk = m_array[m_lastChunk] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L462" name="L462"></a> 462       <em class="brace">}</em>
<a id="L463" name="L463"></a> 463 
<a id="L464" name="L464"></a> 464       m_firstFree = 0;
<a id="L465" name="L465"></a> 465     <em class="brace">}</em>
<a id="L466" name="L466"></a> 466 
<a id="L467" name="L467"></a> 467     <em class="comment">// Space exists in the chunk. Append the character.</em>
<a id="L468" name="L468"></a> 468     chunk[m_firstFree++] = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L469" name="L469"></a> 469   <em class="brace">}</em>
<a id="L470" name="L470"></a> 470 
<div class="comment">
    Append the contents of a String onto the FastStringBuffer,
    growing the storage if necessary.
    <p>
    NOTE THAT after calling append(), previously obtained
    references to m_array[] may no longer be valid.
    @param value String whose contents are to be appended.</p></div>
<a id="L480" name="L480"></a> 480   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10189.html" title="Multiple referred from 5855 places.">append</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)
<a id="L481" name="L481"></a> 481   <em class="brace">{</em>
<a id="L482" name="L482"></a> 482 
<a id="L483" name="L483"></a> 483     <strong class="reserved">if</strong> (<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> == <strong class="reserved">null</strong>)
<a id="L484" name="L484"></a> 484       <strong class="reserved">return</strong>;
<a id="L485" name="L485"></a> 485     <strong class="reserved">int</strong> strlen = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>();
<a id="L486" name="L486"></a> 486 
<a id="L487" name="L487"></a> 487     <strong class="reserved">if</strong> (0 == strlen)
<a id="L488" name="L488"></a> 488       <strong class="reserved">return</strong>;
<a id="L489" name="L489"></a> 489 
<a id="L490" name="L490"></a> 490     <strong class="reserved">int</strong> copyfrom = 0;
<a id="L491" name="L491"></a> 491     <strong class="reserved">char</strong>[] chunk = m_array[m_lastChunk];
<a id="L492" name="L492"></a> 492     <strong class="reserved">int</strong> <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize - m_firstFree;
<a id="L493" name="L493"></a> 493 
<a id="L494" name="L494"></a> 494     <em class="comment">// Repeat while data remains to be copied</em>
<a id="L495" name="L495"></a> 495     <strong class="reserved">while</strong> (strlen &gt; 0)
<a id="L496" name="L496"></a> 496     <em class="brace">{</em>
<a id="L497" name="L497"></a> 497 
<a id="L498" name="L498"></a> 498       <em class="comment">// Copy what fits</em>
<a id="L499" name="L499"></a> 499       <strong class="reserved">if</strong> (<a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> &gt; strlen)
<a id="L500" name="L500"></a> 500         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = strlen;
<a id="L501" name="L501"></a> 501 
<a id="L502" name="L502"></a> 502       <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.<a href="../D/17616.html" title="Multiple defined in 22 places.">getChars</a>(copyfrom, copyfrom + <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>, m_array[m_lastChunk],
<a id="L503" name="L503"></a> 503                      m_firstFree);
<a id="L504" name="L504"></a> 504 
<a id="L505" name="L505"></a> 505       strlen -= <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L506" name="L506"></a> 506       copyfrom += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L507" name="L507"></a> 507 
<a id="L508" name="L508"></a> 508       <em class="comment">// If there's more left, allocate another chunk and continue</em>
<a id="L509" name="L509"></a> 509       <strong class="reserved">if</strong> (strlen &gt; 0)
<a id="L510" name="L510"></a> 510       <em class="brace">{</em>
<a id="L511" name="L511"></a> 511 
<a id="L512" name="L512"></a> 512         <em class="comment">// Extend array?</em>
<a id="L513" name="L513"></a> 513         <strong class="reserved">int</strong> i = m_array.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L514" name="L514"></a> 514 
<a id="L515" name="L515"></a> 515         <strong class="reserved">if</strong> (m_lastChunk + 1 == i)
<a id="L516" name="L516"></a> 516         <em class="brace">{</em>
<a id="L517" name="L517"></a> 517           <strong class="reserved">char</strong>[][] newarray = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[i + 16][];
<a id="L518" name="L518"></a> 518 
<a id="L519" name="L519"></a> 519           <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(m_array, 0, newarray, 0, i);
<a id="L520" name="L520"></a> 520 
<a id="L521" name="L521"></a> 521           m_array = newarray;
<a id="L522" name="L522"></a> 522         <em class="brace">}</em>
<a id="L523" name="L523"></a> 523 
<a id="L524" name="L524"></a> 524         <em class="comment">// Advance one chunk</em>
<a id="L525" name="L525"></a> 525         chunk = m_array[++m_lastChunk];
<a id="L526" name="L526"></a> 526 
<a id="L527" name="L527"></a> 527         <strong class="reserved">if</strong> (chunk == <strong class="reserved">null</strong>)
<a id="L528" name="L528"></a> 528         <em class="brace">{</em>
<a id="L529" name="L529"></a> 529 
<a id="L530" name="L530"></a> 530           <em class="comment">// Hierarchical encapsulation</em>
<a id="L531" name="L531"></a> 531           <strong class="reserved">if</strong> (m_lastChunk == 1 &lt;&lt; m_rebundleBits
<a id="L532" name="L532"></a> 532                   &amp;&amp; m_chunkBits &lt; m_maxChunkBits)
<a id="L533" name="L533"></a> 533           <em class="brace">{</em>
<a id="L534" name="L534"></a> 534 
<a id="L535" name="L535"></a> 535             <em class="comment">// Should do all the work of both encapsulating</em>
<a id="L536" name="L536"></a> 536             <em class="comment">// existing data and establishing new sizes/offsets</em>
<a id="L537" name="L537"></a> 537             m_innerFSB = <strong class="reserved">new</strong> <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a>(<strong class="reserved">this</strong>);
<a id="L538" name="L538"></a> 538           <em class="brace">}</em>
<a id="L539" name="L539"></a> 539 
<a id="L540" name="L540"></a> 540           <em class="comment">// Add a chunk.</em>
<a id="L541" name="L541"></a> 541           chunk = m_array[m_lastChunk] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L542" name="L542"></a> 542         <em class="brace">}</em>
<a id="L543" name="L543"></a> 543 
<a id="L544" name="L544"></a> 544         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize;
<a id="L545" name="L545"></a> 545         m_firstFree = 0;
<a id="L546" name="L546"></a> 546       <em class="brace">}</em>
<a id="L547" name="L547"></a> 547     <em class="brace">}</em>
<a id="L548" name="L548"></a> 548 
<a id="L549" name="L549"></a> 549     <em class="comment">// Adjust the insert point in the last chunk, when we've reached it.</em>
<a id="L550" name="L550"></a> 550     m_firstFree += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L551" name="L551"></a> 551   <em class="brace">}</em>
<a id="L552" name="L552"></a> 552 
<div class="comment">
    Append the contents of a StringBuffer onto the FastStringBuffer,
    growing the storage if necessary.
    <p>
    NOTE THAT after calling append(), previously obtained
    references to m_array[] may no longer be valid.
    @param value StringBuffer whose contents are to be appended.</p></div>
<a id="L562" name="L562"></a> 562   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10189.html" title="Multiple referred from 5855 places.">append</a>(<a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)
<a id="L563" name="L563"></a> 563   <em class="brace">{</em>
<a id="L564" name="L564"></a> 564 
<a id="L565" name="L565"></a> 565     <strong class="reserved">if</strong> (<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> == <strong class="reserved">null</strong>)
<a id="L566" name="L566"></a> 566       <strong class="reserved">return</strong>;
<a id="L567" name="L567"></a> 567     <strong class="reserved">int</strong> strlen = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>();
<a id="L568" name="L568"></a> 568 
<a id="L569" name="L569"></a> 569     <strong class="reserved">if</strong> (0 == strlen)
<a id="L570" name="L570"></a> 570       <strong class="reserved">return</strong>;
<a id="L571" name="L571"></a> 571 
<a id="L572" name="L572"></a> 572     <strong class="reserved">int</strong> copyfrom = 0;
<a id="L573" name="L573"></a> 573     <strong class="reserved">char</strong>[] chunk = m_array[m_lastChunk];
<a id="L574" name="L574"></a> 574     <strong class="reserved">int</strong> <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize - m_firstFree;
<a id="L575" name="L575"></a> 575 
<a id="L576" name="L576"></a> 576     <em class="comment">// Repeat while data remains to be copied</em>
<a id="L577" name="L577"></a> 577     <strong class="reserved">while</strong> (strlen &gt; 0)
<a id="L578" name="L578"></a> 578     <em class="brace">{</em>
<a id="L579" name="L579"></a> 579 
<a id="L580" name="L580"></a> 580       <em class="comment">// Copy what fits</em>
<a id="L581" name="L581"></a> 581       <strong class="reserved">if</strong> (<a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> &gt; strlen)
<a id="L582" name="L582"></a> 582         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = strlen;
<a id="L583" name="L583"></a> 583 
<a id="L584" name="L584"></a> 584       <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.<a href="../D/17616.html" title="Multiple defined in 22 places.">getChars</a>(copyfrom, copyfrom + <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>, m_array[m_lastChunk],
<a id="L585" name="L585"></a> 585                      m_firstFree);
<a id="L586" name="L586"></a> 586 
<a id="L587" name="L587"></a> 587       strlen -= <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L588" name="L588"></a> 588       copyfrom += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L589" name="L589"></a> 589 
<a id="L590" name="L590"></a> 590       <em class="comment">// If there's more left, allocate another chunk and continue</em>
<a id="L591" name="L591"></a> 591       <strong class="reserved">if</strong> (strlen &gt; 0)
<a id="L592" name="L592"></a> 592       <em class="brace">{</em>
<a id="L593" name="L593"></a> 593 
<a id="L594" name="L594"></a> 594         <em class="comment">// Extend array?</em>
<a id="L595" name="L595"></a> 595         <strong class="reserved">int</strong> i = m_array.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L596" name="L596"></a> 596 
<a id="L597" name="L597"></a> 597         <strong class="reserved">if</strong> (m_lastChunk + 1 == i)
<a id="L598" name="L598"></a> 598         <em class="brace">{</em>
<a id="L599" name="L599"></a> 599           <strong class="reserved">char</strong>[][] newarray = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[i + 16][];
<a id="L600" name="L600"></a> 600 
<a id="L601" name="L601"></a> 601           <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(m_array, 0, newarray, 0, i);
<a id="L602" name="L602"></a> 602 
<a id="L603" name="L603"></a> 603           m_array = newarray;
<a id="L604" name="L604"></a> 604         <em class="brace">}</em>
<a id="L605" name="L605"></a> 605 
<a id="L606" name="L606"></a> 606         <em class="comment">// Advance one chunk</em>
<a id="L607" name="L607"></a> 607         chunk = m_array[++m_lastChunk];
<a id="L608" name="L608"></a> 608 
<a id="L609" name="L609"></a> 609         <strong class="reserved">if</strong> (chunk == <strong class="reserved">null</strong>)
<a id="L610" name="L610"></a> 610         <em class="brace">{</em>
<a id="L611" name="L611"></a> 611 
<a id="L612" name="L612"></a> 612           <em class="comment">// Hierarchical encapsulation</em>
<a id="L613" name="L613"></a> 613           <strong class="reserved">if</strong> (m_lastChunk == 1 &lt;&lt; m_rebundleBits
<a id="L614" name="L614"></a> 614                   &amp;&amp; m_chunkBits &lt; m_maxChunkBits)
<a id="L615" name="L615"></a> 615           <em class="brace">{</em>
<a id="L616" name="L616"></a> 616 
<a id="L617" name="L617"></a> 617             <em class="comment">// Should do all the work of both encapsulating</em>
<a id="L618" name="L618"></a> 618             <em class="comment">// existing data and establishing new sizes/offsets</em>
<a id="L619" name="L619"></a> 619             m_innerFSB = <strong class="reserved">new</strong> <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a>(<strong class="reserved">this</strong>);
<a id="L620" name="L620"></a> 620           <em class="brace">}</em>
<a id="L621" name="L621"></a> 621 
<a id="L622" name="L622"></a> 622           <em class="comment">// Add a chunk.</em>
<a id="L623" name="L623"></a> 623           chunk = m_array[m_lastChunk] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L624" name="L624"></a> 624         <em class="brace">}</em>
<a id="L625" name="L625"></a> 625 
<a id="L626" name="L626"></a> 626         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize;
<a id="L627" name="L627"></a> 627         m_firstFree = 0;
<a id="L628" name="L628"></a> 628       <em class="brace">}</em>
<a id="L629" name="L629"></a> 629     <em class="brace">}</em>
<a id="L630" name="L630"></a> 630 
<a id="L631" name="L631"></a> 631     <em class="comment">// Adjust the insert point in the last chunk, when we've reached it.</em>
<a id="L632" name="L632"></a> 632     m_firstFree += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L633" name="L633"></a> 633   <em class="brace">}</em>
<a id="L634" name="L634"></a> 634 
<div class="comment">
    Append part of the contents of a Character Array onto the
    FastStringBuffer,  growing the storage if necessary.
    <p>
    NOTE THAT after calling append(), previously obtained
    references to m_array[] may no longer be valid.
    @param chars character array from which data is to be copied
    @param start offset in chars of first character to be copied,
    zero-based.
    @param length number of characters to be copied</p></div>
<a id="L647" name="L647"></a> 647   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10189.html" title="Multiple referred from 5855 places.">append</a>(<strong class="reserved">char</strong>[] <a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>, <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L648" name="L648"></a> 648   <em class="brace">{</em>
<a id="L649" name="L649"></a> 649 
<a id="L650" name="L650"></a> 650     <strong class="reserved">int</strong> strlen = <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L651" name="L651"></a> 651 
<a id="L652" name="L652"></a> 652     <strong class="reserved">if</strong> (0 == strlen)
<a id="L653" name="L653"></a> 653       <strong class="reserved">return</strong>;
<a id="L654" name="L654"></a> 654 
<a id="L655" name="L655"></a> 655     <strong class="reserved">int</strong> copyfrom = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>;
<a id="L656" name="L656"></a> 656     <strong class="reserved">char</strong>[] chunk = m_array[m_lastChunk];
<a id="L657" name="L657"></a> 657     <strong class="reserved">int</strong> <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize - m_firstFree;
<a id="L658" name="L658"></a> 658 
<a id="L659" name="L659"></a> 659     <em class="comment">// Repeat while data remains to be copied</em>
<a id="L660" name="L660"></a> 660     <strong class="reserved">while</strong> (strlen &gt; 0)
<a id="L661" name="L661"></a> 661     <em class="brace">{</em>
<a id="L662" name="L662"></a> 662 
<a id="L663" name="L663"></a> 663       <em class="comment">// Copy what fits</em>
<a id="L664" name="L664"></a> 664       <strong class="reserved">if</strong> (<a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> &gt; strlen)
<a id="L665" name="L665"></a> 665         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = strlen;
<a id="L666" name="L666"></a> 666 
<a id="L667" name="L667"></a> 667       <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>, copyfrom, m_array[m_lastChunk], m_firstFree,
<a id="L668" name="L668"></a> 668                        <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>);
<a id="L669" name="L669"></a> 669 
<a id="L670" name="L670"></a> 670       strlen -= <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L671" name="L671"></a> 671       copyfrom += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L672" name="L672"></a> 672 
<a id="L673" name="L673"></a> 673       <em class="comment">// If there's more left, allocate another chunk and continue</em>
<a id="L674" name="L674"></a> 674       <strong class="reserved">if</strong> (strlen &gt; 0)
<a id="L675" name="L675"></a> 675       <em class="brace">{</em>
<a id="L676" name="L676"></a> 676 
<a id="L677" name="L677"></a> 677         <em class="comment">// Extend array?</em>
<a id="L678" name="L678"></a> 678         <strong class="reserved">int</strong> i = m_array.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L679" name="L679"></a> 679 
<a id="L680" name="L680"></a> 680         <strong class="reserved">if</strong> (m_lastChunk + 1 == i)
<a id="L681" name="L681"></a> 681         <em class="brace">{</em>
<a id="L682" name="L682"></a> 682           <strong class="reserved">char</strong>[][] newarray = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[i + 16][];
<a id="L683" name="L683"></a> 683 
<a id="L684" name="L684"></a> 684           <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(m_array, 0, newarray, 0, i);
<a id="L685" name="L685"></a> 685 
<a id="L686" name="L686"></a> 686           m_array = newarray;
<a id="L687" name="L687"></a> 687         <em class="brace">}</em>
<a id="L688" name="L688"></a> 688 
<a id="L689" name="L689"></a> 689         <em class="comment">// Advance one chunk</em>
<a id="L690" name="L690"></a> 690         chunk = m_array[++m_lastChunk];
<a id="L691" name="L691"></a> 691 
<a id="L692" name="L692"></a> 692         <strong class="reserved">if</strong> (chunk == <strong class="reserved">null</strong>)
<a id="L693" name="L693"></a> 693         <em class="brace">{</em>
<a id="L694" name="L694"></a> 694 
<a id="L695" name="L695"></a> 695           <em class="comment">// Hierarchical encapsulation</em>
<a id="L696" name="L696"></a> 696           <strong class="reserved">if</strong> (m_lastChunk == 1 &lt;&lt; m_rebundleBits
<a id="L697" name="L697"></a> 697                   &amp;&amp; m_chunkBits &lt; m_maxChunkBits)
<a id="L698" name="L698"></a> 698           <em class="brace">{</em>
<a id="L699" name="L699"></a> 699 
<a id="L700" name="L700"></a> 700             <em class="comment">// Should do all the work of both encapsulating</em>
<a id="L701" name="L701"></a> 701             <em class="comment">// existing data and establishing new sizes/offsets</em>
<a id="L702" name="L702"></a> 702             m_innerFSB = <strong class="reserved">new</strong> <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a>(<strong class="reserved">this</strong>);
<a id="L703" name="L703"></a> 703           <em class="brace">}</em>
<a id="L704" name="L704"></a> 704 
<a id="L705" name="L705"></a> 705           <em class="comment">// Add a chunk.</em>
<a id="L706" name="L706"></a> 706           chunk = m_array[m_lastChunk] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L707" name="L707"></a> 707         <em class="brace">}</em>
<a id="L708" name="L708"></a> 708 
<a id="L709" name="L709"></a> 709         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize;
<a id="L710" name="L710"></a> 710         m_firstFree = 0;
<a id="L711" name="L711"></a> 711       <em class="brace">}</em>
<a id="L712" name="L712"></a> 712     <em class="brace">}</em>
<a id="L713" name="L713"></a> 713 
<a id="L714" name="L714"></a> 714     <em class="comment">// Adjust the insert point in the last chunk, when we've reached it.</em>
<a id="L715" name="L715"></a> 715     m_firstFree += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L716" name="L716"></a> 716   <em class="brace">}</em>
<a id="L717" name="L717"></a> 717 
<div class="comment">
    Append the contents of another FastStringBuffer onto
    this FastStringBuffer, growing the storage if necessary.
    <p>
    NOTE THAT after calling append(), previously obtained
    references to m_array[] may no longer be valid.
    @param value FastStringBuffer whose contents are
    to be appended.</p></div>
<a id="L728" name="L728"></a> 728   <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10189.html" title="Multiple referred from 5855 places.">append</a>(<a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>)
<a id="L729" name="L729"></a> 729   <em class="brace">{</em>
<a id="L730" name="L730"></a> 730 
<a id="L731" name="L731"></a> 731     <em class="comment">// Complicating factor here is that the two buffers may use</em>
<a id="L732" name="L732"></a> 732     <em class="comment">// different chunk sizes, and even if they're the same we're</em>
<a id="L733" name="L733"></a> 733     <em class="comment">// probably on a different alignment due to previously appended</em>
<a id="L734" name="L734"></a> 734     <em class="comment">// data. We have to work through the source in bite-sized chunks.</em>
<a id="L735" name="L735"></a> 735     <strong class="reserved">if</strong> (<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> == <strong class="reserved">null</strong>)
<a id="L736" name="L736"></a> 736       <strong class="reserved">return</strong>;
<a id="L737" name="L737"></a> 737     <strong class="reserved">int</strong> strlen = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>();
<a id="L738" name="L738"></a> 738 
<a id="L739" name="L739"></a> 739     <strong class="reserved">if</strong> (0 == strlen)
<a id="L740" name="L740"></a> 740       <strong class="reserved">return</strong>;
<a id="L741" name="L741"></a> 741 
<a id="L742" name="L742"></a> 742     <strong class="reserved">int</strong> copyfrom = 0;
<a id="L743" name="L743"></a> 743     <strong class="reserved">char</strong>[] chunk = m_array[m_lastChunk];
<a id="L744" name="L744"></a> 744     <strong class="reserved">int</strong> <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize - m_firstFree;
<a id="L745" name="L745"></a> 745 
<a id="L746" name="L746"></a> 746     <em class="comment">// Repeat while data remains to be copied</em>
<a id="L747" name="L747"></a> 747     <strong class="reserved">while</strong> (strlen &gt; 0)
<a id="L748" name="L748"></a> 748     <em class="brace">{</em>
<a id="L749" name="L749"></a> 749 
<a id="L750" name="L750"></a> 750       <em class="comment">// Copy what fits</em>
<a id="L751" name="L751"></a> 751       <strong class="reserved">if</strong> (<a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> &gt; strlen)
<a id="L752" name="L752"></a> 752         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = strlen;
<a id="L753" name="L753"></a> 753 
<a id="L754" name="L754"></a> 754       <strong class="reserved">int</strong> sourcechunk = (copyfrom + <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.m_chunkSize - 1)
<a id="L755" name="L755"></a> 755                         &gt;&gt;&gt; <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.m_chunkBits;
<a id="L756" name="L756"></a> 756       <strong class="reserved">int</strong> sourcecolumn = copyfrom &amp; <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.m_chunkMask;
<a id="L757" name="L757"></a> 757       <strong class="reserved">int</strong> runlength = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.m_chunkSize - sourcecolumn;
<a id="L758" name="L758"></a> 758 
<a id="L759" name="L759"></a> 759       <strong class="reserved">if</strong> (runlength &gt; <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>)
<a id="L760" name="L760"></a> 760         runlength = <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L761" name="L761"></a> 761 
<a id="L762" name="L762"></a> 762       <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.m_array[sourcechunk], sourcecolumn,
<a id="L763" name="L763"></a> 763                        m_array[m_lastChunk], m_firstFree, runlength);
<a id="L764" name="L764"></a> 764 
<a id="L765" name="L765"></a> 765       <strong class="reserved">if</strong> (runlength != <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>)
<a id="L766" name="L766"></a> 766         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>.m_array[sourcechunk + 1], 0,
<a id="L767" name="L767"></a> 767                          m_array[m_lastChunk], m_firstFree + runlength,
<a id="L768" name="L768"></a> 768                          <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> - runlength);
<a id="L769" name="L769"></a> 769 
<a id="L770" name="L770"></a> 770       strlen -= <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L771" name="L771"></a> 771       copyfrom += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L772" name="L772"></a> 772 
<a id="L773" name="L773"></a> 773       <em class="comment">// If there's more left, allocate another chunk and continue</em>
<a id="L774" name="L774"></a> 774       <strong class="reserved">if</strong> (strlen &gt; 0)
<a id="L775" name="L775"></a> 775       <em class="brace">{</em>
<a id="L776" name="L776"></a> 776 
<a id="L777" name="L777"></a> 777         <em class="comment">// Extend array?</em>
<a id="L778" name="L778"></a> 778         <strong class="reserved">int</strong> i = m_array.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L779" name="L779"></a> 779 
<a id="L780" name="L780"></a> 780         <strong class="reserved">if</strong> (m_lastChunk + 1 == i)
<a id="L781" name="L781"></a> 781         <em class="brace">{</em>
<a id="L782" name="L782"></a> 782           <strong class="reserved">char</strong>[][] newarray = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[i + 16][];
<a id="L783" name="L783"></a> 783 
<a id="L784" name="L784"></a> 784           <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(m_array, 0, newarray, 0, i);
<a id="L785" name="L785"></a> 785 
<a id="L786" name="L786"></a> 786           m_array = newarray;
<a id="L787" name="L787"></a> 787         <em class="brace">}</em>
<a id="L788" name="L788"></a> 788 
<a id="L789" name="L789"></a> 789         <em class="comment">// Advance one chunk</em>
<a id="L790" name="L790"></a> 790         chunk = m_array[++m_lastChunk];
<a id="L791" name="L791"></a> 791 
<a id="L792" name="L792"></a> 792         <strong class="reserved">if</strong> (chunk == <strong class="reserved">null</strong>)
<a id="L793" name="L793"></a> 793         <em class="brace">{</em>
<a id="L794" name="L794"></a> 794 
<a id="L795" name="L795"></a> 795           <em class="comment">// Hierarchical encapsulation</em>
<a id="L796" name="L796"></a> 796           <strong class="reserved">if</strong> (m_lastChunk == 1 &lt;&lt; m_rebundleBits
<a id="L797" name="L797"></a> 797                   &amp;&amp; m_chunkBits &lt; m_maxChunkBits)
<a id="L798" name="L798"></a> 798           <em class="brace">{</em>
<a id="L799" name="L799"></a> 799 
<a id="L800" name="L800"></a> 800             <em class="comment">// Should do all the work of both encapsulating</em>
<a id="L801" name="L801"></a> 801             <em class="comment">// existing data and establishing new sizes/offsets</em>
<a id="L802" name="L802"></a> 802             m_innerFSB = <strong class="reserved">new</strong> <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a>(<strong class="reserved">this</strong>);
<a id="L803" name="L803"></a> 803           <em class="brace">}</em>
<a id="L804" name="L804"></a> 804 
<a id="L805" name="L805"></a> 805           <em class="comment">// Add a chunk.</em>
<a id="L806" name="L806"></a> 806           chunk = m_array[m_lastChunk] = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[m_chunkSize];
<a id="L807" name="L807"></a> 807         <em class="brace">}</em>
<a id="L808" name="L808"></a> 808 
<a id="L809" name="L809"></a> 809         <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize;
<a id="L810" name="L810"></a> 810         m_firstFree = 0;
<a id="L811" name="L811"></a> 811       <em class="brace">}</em>
<a id="L812" name="L812"></a> 812     <em class="brace">}</em>
<a id="L813" name="L813"></a> 813 
<a id="L814" name="L814"></a> 814     <em class="comment">// Adjust the insert point in the last chunk, when we've reached it.</em>
<a id="L815" name="L815"></a> 815     m_firstFree += <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L816" name="L816"></a> 816   <em class="brace">}</em>
<a id="L817" name="L817"></a> 817 
<div class="comment">
    @return true if the specified range of characters are all whitespace,
    as defined by XMLCharacterRecognizer.
    <p>
    CURRENTLY DOES NOT CHECK FOR OUT-OF-RANGE.
    @param start Offset of first character in the range.
    @param length Number of characters to send.</p></div>
<a id="L827" name="L827"></a> 827   <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22238.html" title="Multiple referred from 54 places.">isWhitespace</a>(<strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L828" name="L828"></a> 828   <em class="brace">{</em>
<a id="L829" name="L829"></a> 829 
<a id="L830" name="L830"></a> 830     <strong class="reserved">int</strong> sourcechunk = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &gt;&gt;&gt; m_chunkBits;
<a id="L831" name="L831"></a> 831     <strong class="reserved">int</strong> sourcecolumn = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &amp; m_chunkMask;
<a id="L832" name="L832"></a> 832     <strong class="reserved">int</strong> <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize - sourcecolumn;
<a id="L833" name="L833"></a> 833     <strong class="reserved">boolean</strong> chunkOK;
<a id="L834" name="L834"></a> 834 
<a id="L835" name="L835"></a> 835     <strong class="reserved">while</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt; 0)
<a id="L836" name="L836"></a> 836     <em class="brace">{</em>
<a id="L837" name="L837"></a> 837       <strong class="reserved">int</strong> runlength = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt;= <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>) ? <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> : <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>;
<a id="L838" name="L838"></a> 838 
<a id="L839" name="L839"></a> 839       <strong class="reserved">if</strong> (sourcechunk == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L840" name="L840"></a> 840         chunkOK = m_innerFSB.<a href="../D/26507.html" title="Multiple defined in 18 places.">isWhitespace</a>(sourcecolumn, runlength);
<a id="L841" name="L841"></a> 841       <strong class="reserved">else</strong>
<a id="L842" name="L842"></a> 842         chunkOK = com.sun.org.apache.xml.internal.utils.<a href="../S/5871.html#L30" title="Defined at 30 in src/com/sun/org/apache/xml/internal/utils/XMLCharacterRecognizer.java.">XMLCharacterRecognizer</a>.<a href="../D/26505.html" title="Multiple defined in 15 places.">isWhiteSpace</a>(
<a id="L843" name="L843"></a> 843           m_array[sourcechunk], sourcecolumn, runlength);
<a id="L844" name="L844"></a> 844 
<a id="L845" name="L845"></a> 845       <strong class="reserved">if</strong> (!chunkOK)
<a id="L846" name="L846"></a> 846         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L847" name="L847"></a> 847 
<a id="L848" name="L848"></a> 848       <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> -= runlength;
<a id="L849" name="L849"></a> 849 
<a id="L850" name="L850"></a> 850       ++sourcechunk;
<a id="L851" name="L851"></a> 851 
<a id="L852" name="L852"></a> 852       sourcecolumn = 0;
<a id="L853" name="L853"></a> 853       <a href="../D/11656.html" title="Multiple defined in 33 places.">available</a> = m_chunkSize;
<a id="L854" name="L854"></a> 854     <em class="brace">}</em>
<a id="L855" name="L855"></a> 855 
<a id="L856" name="L856"></a> 856     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L857" name="L857"></a> 857   <em class="brace">}</em>
<a id="L858" name="L858"></a> 858 
<div class="comment">
    @param start Offset of first character in the range.
    @param length Number of characters to send.
    @return a new String object initialized from the specified range of
    characters.</div>
<a id="L865" name="L865"></a> 865   <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/19208.html" title="Multiple referred from 527 places.">getString</a>(<strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L866" name="L866"></a> 866   <em class="brace">{</em>
<a id="L867" name="L867"></a> 867     <strong class="reserved">int</strong> startColumn = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &amp; m_chunkMask;
<a id="L868" name="L868"></a> 868     <strong class="reserved">int</strong> <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a> = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &gt;&gt;&gt; m_chunkBits;
<a id="L869" name="L869"></a> 869     <strong class="reserved">if</strong> (startColumn + <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; m_chunkMask &amp;&amp; m_innerFSB == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L870" name="L870"></a> 870       <strong class="reserved">return</strong> <a href="../S/5847.html#L876" title="Defined at 876 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">getOneChunkString</a>(<a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>, startColumn, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L871" name="L871"></a> 871     <em class="brace">}</em>
<a id="L872" name="L872"></a> 872     <strong class="reserved">return</strong> <a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(<strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>(<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>), <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>, startColumn,
<a id="L873" name="L873"></a> 873                      <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>).<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L874" name="L874"></a> 874   <em class="brace">}</em>
<a id="L875" name="L875"></a> 875 
<a id="L876" name="L876"></a> 876   <strong class="reserved">protected</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/5847.html#L870" title="Referred from 870 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">getOneChunkString</a>(<strong class="reserved">int</strong> <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>, <strong class="reserved">int</strong> startColumn,
<a id="L877" name="L877"></a> 877                                      <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L878" name="L878"></a> 878     <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>(m_array[<a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>], startColumn, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L879" name="L879"></a> 879   <em class="brace">}</em>
<a id="L880" name="L880"></a> 880 
<div class="comment">
    @param sb StringBuffer to be appended to
    @param start Offset of first character in the range.
    @param length Number of characters to send.
    @return sb with the requested text appended to it</div>
<a id="L887" name="L887"></a> 887   <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> <a href="../R/19208.html" title="Multiple referred from 527 places.">getString</a>(<a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> sb, <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L888" name="L888"></a> 888   <em class="brace">{</em>
<a id="L889" name="L889"></a> 889     <strong class="reserved">return</strong> <a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(sb, <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &gt;&gt;&gt; m_chunkBits, <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &amp; m_chunkMask, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L890" name="L890"></a> 890   <em class="brace">}</em>
<a id="L891" name="L891"></a> 891 
<div class="comment">
    Internal support for toString() and getString().
    PLEASE NOTE SIGNATURE CHANGE from earlier versions; it now appends into
    and returns a StringBuffer supplied by the caller. This simplifies
    m_innerFSB support.
    <p>
    Note that this operation has been somewhat deoptimized by the shift to a
    chunked array, as there is no factory method to produce a String object
    directly from an array of arrays and hence a double copy is needed.
    By presetting length we hope to minimize the heap overhead of building
    the intermediate StringBuffer.
    </p><p>
    (It really is a pity that Java didn't design String as a final subclass
    of MutableString, rather than having StringBuffer be a separate hierarchy.
    We'd avoid a <strong>lot</strong> of double-buffering.)
    @param sb
    @param startChunk
    @param startColumn
    @param length
    @return the contents of the FastStringBuffer as a standard Java string.</p></div>
<a id="L916" name="L916"></a> 916   <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> <a href="../R/19208.html" title="Multiple referred from 527 places.">getString</a>(<a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> sb, <strong class="reserved">int</strong> <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>, <strong class="reserved">int</strong> startColumn,
<a id="L917" name="L917"></a> 917                          <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L918" name="L918"></a> 918   <em class="brace">{</em>
<a id="L919" name="L919"></a> 919 
<a id="L920" name="L920"></a> 920     <strong class="reserved">int</strong> <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> = (<a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a> &lt;&lt; m_chunkBits) + startColumn + <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L921" name="L921"></a> 921     <strong class="reserved">int</strong> stopChunk = <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> &gt;&gt;&gt; m_chunkBits;
<a id="L922" name="L922"></a> 922     <strong class="reserved">int</strong> stopColumn = <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> &amp; m_chunkMask;
<a id="L923" name="L923"></a> 923 
<a id="L924" name="L924"></a> 924     <em class="comment">// Factored out</em>
<a id="L925" name="L925"></a> 925     <em class="comment">//StringBuffer sb=new StringBuffer(length);</em>
<a id="L926" name="L926"></a> 926     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>; i &lt; stopChunk; ++i)
<a id="L927" name="L927"></a> 927     <em class="brace">{</em>
<a id="L928" name="L928"></a> 928       <strong class="reserved">if</strong> (i == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L929" name="L929"></a> 929         m_innerFSB.<a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(sb, startColumn, m_chunkSize - startColumn);
<a id="L930" name="L930"></a> 930       <strong class="reserved">else</strong>
<a id="L931" name="L931"></a> 931         sb.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(m_array[i], startColumn, m_chunkSize - startColumn);
<a id="L932" name="L932"></a> 932 
<a id="L933" name="L933"></a> 933       startColumn = 0;  <em class="comment">// after first chunk</em>
<a id="L934" name="L934"></a> 934     <em class="brace">}</em>
<a id="L935" name="L935"></a> 935 
<a id="L936" name="L936"></a> 936     <strong class="reserved">if</strong> (stopChunk == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L937" name="L937"></a> 937       m_innerFSB.<a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(sb, startColumn, stopColumn - startColumn);
<a id="L938" name="L938"></a> 938     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (stopColumn &gt; startColumn)
<a id="L939" name="L939"></a> 939       sb.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(m_array[stopChunk], startColumn, stopColumn - startColumn);
<a id="L940" name="L940"></a> 940 
<a id="L941" name="L941"></a> 941     <strong class="reserved">return</strong> sb;
<a id="L942" name="L942"></a> 942   <em class="brace">}</em>
<a id="L943" name="L943"></a> 943 
<div class="comment">
    Get a single character from the string buffer.
    @param pos character position requested.
    @return A character from the requested position.</div>
<a id="L951" name="L951"></a> 951   <strong class="reserved">public</strong> <strong class="reserved">char</strong> <a href="../R/11039.html" title="Multiple referred from 1437 places.">charAt</a>(<strong class="reserved">int</strong> pos)
<a id="L952" name="L952"></a> 952   <em class="brace">{</em>
<a id="L953" name="L953"></a> 953     <strong class="reserved">int</strong> <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a> = pos &gt;&gt;&gt; m_chunkBits;
<a id="L954" name="L954"></a> 954 
<a id="L955" name="L955"></a> 955     <strong class="reserved">if</strong> (<a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a> == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L956" name="L956"></a> 956       <strong class="reserved">return</strong> m_innerFSB.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(pos &amp; m_chunkMask);
<a id="L957" name="L957"></a> 957     <strong class="reserved">else</strong>
<a id="L958" name="L958"></a> 958       <strong class="reserved">return</strong> m_array[<a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>][pos &amp; m_chunkMask];
<a id="L959" name="L959"></a> 959   <em class="brace">}</em>
<a id="L960" name="L960"></a> 960 
<div class="comment">
    Sends the specified range of characters as one or more SAX characters()
    events.
    Note that the buffer reference passed to the ContentHandler may be
    invalidated if the FastStringBuffer is edited; it's the user's
    responsibility to manage access to the FastStringBuffer to prevent this
    problem from arising.
    <p>
    Note too that there is no promise that the output will be sent as a
    single call. As is always true in SAX, one logical string may be split
    across multiple blocks of memory and hence delivered as several
    successive events.
    @param ch SAX ContentHandler object to receive the event.
    @param start Offset of first character in the range.
    @param length Number of characters to send.
    @exception org.xml.sax.SAXException may be thrown by handler's
    characters() method.</p></div>
<a id="L980" name="L980"></a> 980   <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26785.html" title="Multiple referred from 10 places.">sendSAXcharacters</a>(
<a id="L981" name="L981"></a> 981           org.xml.sax.<a href="../D/1853.html" title="Multiple defined in 2 places.">ContentHandler</a> ch, <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L982" name="L982"></a> 982             <strong class="reserved">throws</strong> org.xml.sax.<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>
<a id="L983" name="L983"></a> 983   <em class="brace">{</em>
<a id="L984" name="L984"></a> 984 
<a id="L985" name="L985"></a> 985     <strong class="reserved">int</strong> <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a> = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &gt;&gt;&gt; m_chunkBits;
<a id="L986" name="L986"></a> 986     <strong class="reserved">int</strong> startColumn = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &amp; m_chunkMask;
<a id="L987" name="L987"></a> 987     <strong class="reserved">if</strong> (startColumn + <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; m_chunkMask &amp;&amp; m_innerFSB == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L988" name="L988"></a> 988         ch.<a href="../D/12339.html" title="Multiple defined in 98 places.">characters</a>(m_array[<a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>], startColumn, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L989" name="L989"></a> 989         <strong class="reserved">return</strong>;
<a id="L990" name="L990"></a> 990     <em class="brace">}</em>
<a id="L991" name="L991"></a> 991 
<a id="L992" name="L992"></a> 992     <strong class="reserved">int</strong> <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> + <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L993" name="L993"></a> 993     <strong class="reserved">int</strong> stopChunk = <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> &gt;&gt;&gt; m_chunkBits;
<a id="L994" name="L994"></a> 994     <strong class="reserved">int</strong> stopColumn = <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> &amp; m_chunkMask;
<a id="L995" name="L995"></a> 995 
<a id="L996" name="L996"></a> 996     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>; i &lt; stopChunk; ++i)
<a id="L997" name="L997"></a> 997     <em class="brace">{</em>
<a id="L998" name="L998"></a> 998       <strong class="reserved">if</strong> (i == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L999" name="L999"></a> 999         m_innerFSB.<a href="../S/5847.html#L980" title="Defined at 980 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">sendSAXcharacters</a>(ch, startColumn,
<a id="L1000" name="L1000"></a>1000                                      m_chunkSize - startColumn);
<a id="L1001" name="L1001"></a>1001       <strong class="reserved">else</strong>
<a id="L1002" name="L1002"></a>1002         ch.<a href="../D/12339.html" title="Multiple defined in 98 places.">characters</a>(m_array[i], startColumn, m_chunkSize - startColumn);
<a id="L1003" name="L1003"></a>1003 
<a id="L1004" name="L1004"></a>1004       startColumn = 0;  <em class="comment">// after first chunk</em>
<a id="L1005" name="L1005"></a>1005     <em class="brace">}</em>
<a id="L1006" name="L1006"></a>1006 
<a id="L1007" name="L1007"></a>1007     <em class="comment">// Last, or only, chunk</em>
<a id="L1008" name="L1008"></a>1008     <strong class="reserved">if</strong> (stopChunk == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L1009" name="L1009"></a>1009       m_innerFSB.<a href="../S/5847.html#L980" title="Defined at 980 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">sendSAXcharacters</a>(ch, startColumn, stopColumn - startColumn);
<a id="L1010" name="L1010"></a>1010     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (stopColumn &gt; startColumn)
<a id="L1011" name="L1011"></a>1011     <em class="brace">{</em>
<a id="L1012" name="L1012"></a>1012       ch.<a href="../D/12339.html" title="Multiple defined in 98 places.">characters</a>(m_array[stopChunk], startColumn,
<a id="L1013" name="L1013"></a>1013                     stopColumn - startColumn);
<a id="L1014" name="L1014"></a>1014     <em class="brace">}</em>
<a id="L1015" name="L1015"></a>1015   <em class="brace">}</em>
<a id="L1016" name="L1016"></a>1016 
<div class="comment">
    Sends the specified range of characters as one or more SAX characters()
    events, normalizing the characters according to XSLT rules.
    @param ch SAX ContentHandler object to receive the event.
    @param start Offset of first character in the range.
    @param length Number of characters to send.
    @return normalization status to apply to next chunk (because we may
    have been called recursively to process an inner FSB):
    <dl>
    <dt>0</dt>
    <dd>if this output did not end in retained whitespace, and thus whitespace
    at the start of the following chunk (if any) should be converted to a
    single space.
    </dd><dt>SUPPRESS_LEADING_WS</dt>
    <dd>if this output ended in retained whitespace, and thus whitespace
    at the start of the following chunk (if any) should be completely
    suppressed.</dd>
    </dl>
    @exception org.xml.sax.SAXException may be thrown by handler's
    characters() method.</div>
<a id="L1040" name="L1040"></a>1040   <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/26771.html" title="Multiple referred from 12 places.">sendNormalizedSAXcharacters</a>(
<a id="L1041" name="L1041"></a>1041           org.xml.sax.<a href="../D/1853.html" title="Multiple defined in 2 places.">ContentHandler</a> ch, <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L1042" name="L1042"></a>1042             <strong class="reserved">throws</strong> org.xml.sax.<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>
<a id="L1043" name="L1043"></a>1043   <em class="brace">{</em>
<a id="L1044" name="L1044"></a>1044         <em class="comment">// This call always starts at the beginning of the</em>
<a id="L1045" name="L1045"></a>1045     <em class="comment">// string being written out, either because it was called directly or</em>
<a id="L1046" name="L1046"></a>1046     <em class="comment">// because it was an m_innerFSB recursion. This is important since</em>
<a id="L1047" name="L1047"></a>1047         <em class="comment">// it gives us a well-known initial state for this flag:</em>
<a id="L1048" name="L1048"></a>1048         <strong class="reserved">int</strong> stateForNextChunk=SUPPRESS_LEADING_WS;
<a id="L1049" name="L1049"></a>1049 
<a id="L1050" name="L1050"></a>1050     <strong class="reserved">int</strong> <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> + <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L1051" name="L1051"></a>1051     <strong class="reserved">int</strong> <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a> = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &gt;&gt;&gt; m_chunkBits;
<a id="L1052" name="L1052"></a>1052     <strong class="reserved">int</strong> startColumn = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &amp; m_chunkMask;
<a id="L1053" name="L1053"></a>1053     <strong class="reserved">int</strong> stopChunk = <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> &gt;&gt;&gt; m_chunkBits;
<a id="L1054" name="L1054"></a>1054     <strong class="reserved">int</strong> stopColumn = <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> &amp; m_chunkMask;
<a id="L1055" name="L1055"></a>1055 
<a id="L1056" name="L1056"></a>1056     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../S/6780.html#L174" title="Defined at 174 in src/com/sun/imageio/plugins/png/PNGImageWriter.java.">startChunk</a>; i &lt; stopChunk; ++i)
<a id="L1057" name="L1057"></a>1057     <em class="brace">{</em>
<a id="L1058" name="L1058"></a>1058       <strong class="reserved">if</strong> (i == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L1059" name="L1059"></a>1059                                 stateForNextChunk=
<a id="L1060" name="L1060"></a>1060         m_innerFSB.<a href="../D/31740.html" title="Multiple defined in 3 places.">sendNormalizedSAXcharacters</a>(ch, startColumn,
<a id="L1061" name="L1061"></a>1061                                      m_chunkSize - startColumn);
<a id="L1062" name="L1062"></a>1062       <strong class="reserved">else</strong>
<a id="L1063" name="L1063"></a>1063                                 stateForNextChunk=
<a id="L1064" name="L1064"></a>1064         <a href="../D/31740.html" title="Multiple defined in 3 places.">sendNormalizedSAXcharacters</a>(m_array[i], startColumn,
<a id="L1065" name="L1065"></a>1065                                     m_chunkSize - startColumn,
<a id="L1066" name="L1066"></a>1066                                                                                                                                                 ch,stateForNextChunk);
<a id="L1067" name="L1067"></a>1067 
<a id="L1068" name="L1068"></a>1068       startColumn = 0;  <em class="comment">// after first chunk</em>
<a id="L1069" name="L1069"></a>1069     <em class="brace">}</em>
<a id="L1070" name="L1070"></a>1070 
<a id="L1071" name="L1071"></a>1071     <em class="comment">// Last, or only, chunk</em>
<a id="L1072" name="L1072"></a>1072     <strong class="reserved">if</strong> (stopChunk == 0 &amp;&amp; m_innerFSB != <strong class="reserved">null</strong>)
<a id="L1073" name="L1073"></a>1073                         stateForNextChunk= <em class="comment">// %REVIEW% Is this update really needed?</em>
<a id="L1074" name="L1074"></a>1074       m_innerFSB.<a href="../D/31740.html" title="Multiple defined in 3 places.">sendNormalizedSAXcharacters</a>(ch, startColumn, stopColumn - startColumn);
<a id="L1075" name="L1075"></a>1075     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (stopColumn &gt; startColumn)
<a id="L1076" name="L1076"></a>1076     <em class="brace">{</em>
<a id="L1077" name="L1077"></a>1077                         stateForNextChunk= <em class="comment">// %REVIEW% Is this update really needed?</em>
<a id="L1078" name="L1078"></a>1078       <a href="../D/31740.html" title="Multiple defined in 3 places.">sendNormalizedSAXcharacters</a>(m_array[stopChunk],
<a id="L1079" name="L1079"></a>1079                                                                                                                                         startColumn, stopColumn - startColumn,
<a id="L1080" name="L1080"></a>1080                                                                                                                                         ch, stateForNextChunk | SUPPRESS_TRAILING_WS);
<a id="L1081" name="L1081"></a>1081     <em class="brace">}</em>
<a id="L1082" name="L1082"></a>1082                 <strong class="reserved">return</strong> stateForNextChunk;
<a id="L1083" name="L1083"></a>1083   <em class="brace">}</em>
<a id="L1084" name="L1084"></a>1084 
<a id="L1085" name="L1085"></a>1085   <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">char</strong>[] SINGLE_SPACE = <em class="brace">{</em>' '<em class="brace">}</em>;
<a id="L1086" name="L1086"></a>1086 
<div class="comment">
    Internal method to directly normalize and dispatch the character array.
    This version is aware of the fact that it may be called several times
    in succession if the data is made up of multiple "chunks", and thus
    must actively manage the handling of leading and trailing whitespace.
    Note: The recursion is due to the possible recursion of inner FSBs.
    @param ch The characters from the XML document.
    @param start The start position in the array.
    @param length The number of characters to read from the array.
    @param handler SAX ContentHandler object to receive the event.
    @param edgeTreatmentFlags How leading/trailing spaces should be handled.
    This is a bitfield contining two flags, bitwise-ORed together:
    <dl>
    <dt>SUPPRESS_LEADING_WS</dt>
    <dd>When false, causes leading whitespace to be converted to a single
    space; when true, causes it to be discarded entirely.
    Should be set TRUE for the first chunk, and (in multi-chunk output)
    whenever the previous chunk ended in retained whitespace.</dd>
    <dt>SUPPRESS_TRAILING_WS</dt>
    <dd>When false, causes trailing whitespace to be converted to a single
    space; when true, causes it to be discarded entirely.
    Should be set TRUE for the last or only chunk.
    </dd>
    </dl>
    @return normalization status, as in the edgeTreatmentFlags parameter:
    <dl>
    <dt>0</dt>
    <dd>if this output did not end in retained whitespace, and thus whitespace
    at the start of the following chunk (if any) should be converted to a
    single space.
    </dd><dt>SUPPRESS_LEADING_WS</dt>
    <dd>if this output ended in retained whitespace, and thus whitespace
    at the start of the following chunk (if any) should be completely
    suppressed.</dd>
    </dl>
    @exception org.xml.sax.SAXException Any SAX exception, possibly
               wrapping another exception.</div>
<a id="L1130" name="L1130"></a>1130   <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/26771.html" title="Multiple referred from 12 places.">sendNormalizedSAXcharacters</a>(<strong class="reserved">char</strong> ch[],
<a id="L1131" name="L1131"></a>1131              <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>,
<a id="L1132" name="L1132"></a>1132              org.xml.sax.<a href="../D/1853.html" title="Multiple defined in 2 places.">ContentHandler</a> <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>,
<a id="L1133" name="L1133"></a>1133                                                  <strong class="reserved">int</strong> edgeTreatmentFlags)
<a id="L1134" name="L1134"></a>1134           <strong class="reserved">throws</strong> org.xml.sax.<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>
<a id="L1135" name="L1135"></a>1135   <em class="brace">{</em>
<a id="L1136" name="L1136"></a>1136      <strong class="reserved">boolean</strong> processingLeadingWhitespace =
<a id="L1137" name="L1137"></a>1137                        ((edgeTreatmentFlags &amp; SUPPRESS_LEADING_WS) != 0);
<a id="L1138" name="L1138"></a>1138      <strong class="reserved">boolean</strong> seenWhitespace = ((edgeTreatmentFlags &amp; CARRY_WS) != 0);
<a id="L1139" name="L1139"></a>1139      <strong class="reserved">boolean</strong> suppressTrailingWhitespace =
<a id="L1140" name="L1140"></a>1140                        ((edgeTreatmentFlags &amp; SUPPRESS_TRAILING_WS) != 0);
<a id="L1141" name="L1141"></a>1141      <strong class="reserved">int</strong> currPos = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>;
<a id="L1142" name="L1142"></a>1142      <strong class="reserved">int</strong> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>+<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L1143" name="L1143"></a>1143 
<a id="L1144" name="L1144"></a>1144      <em class="comment">// Strip any leading spaces first, if required</em>
<a id="L1145" name="L1145"></a>1145      <strong class="reserved">if</strong> (processingLeadingWhitespace) <em class="brace">{</em>
<a id="L1146" name="L1146"></a>1146          <strong class="reserved">for</strong> (; currPos &lt; <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>
<a id="L1147" name="L1147"></a>1147                 &amp;&amp; <a href="../S/5871.html#L30" title="Defined at 30 in src/com/sun/org/apache/xml/internal/utils/XMLCharacterRecognizer.java.">XMLCharacterRecognizer</a>.<a href="../D/26505.html" title="Multiple defined in 15 places.">isWhiteSpace</a>(ch[currPos]);
<a id="L1148" name="L1148"></a>1148               currPos++) <em class="brace">{</em> <em class="brace">}</em>
<a id="L1149" name="L1149"></a>1149 
<a id="L1150" name="L1150"></a>1150          <em class="comment">// If we've only encountered leading spaces, the</em>
<a id="L1151" name="L1151"></a>1151          <em class="comment">// current state remains unchanged</em>
<a id="L1152" name="L1152"></a>1152          <strong class="reserved">if</strong> (currPos == <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>) <em class="brace">{</em>
<a id="L1153" name="L1153"></a>1153              <strong class="reserved">return</strong> edgeTreatmentFlags;
<a id="L1154" name="L1154"></a>1154          <em class="brace">}</em>
<a id="L1155" name="L1155"></a>1155      <em class="brace">}</em>
<a id="L1156" name="L1156"></a>1156 
<a id="L1157" name="L1157"></a>1157      <em class="comment">// If we get here, there are no more leading spaces to strip</em>
<a id="L1158" name="L1158"></a>1158      <strong class="reserved">while</strong> (currPos &lt; <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>) <em class="brace">{</em>
<a id="L1159" name="L1159"></a>1159          <strong class="reserved">int</strong> startNonWhitespace = currPos;
<a id="L1160" name="L1160"></a>1160 
<a id="L1161" name="L1161"></a>1161          <em class="comment">// Grab a chunk of non-whitespace characters</em>
<a id="L1162" name="L1162"></a>1162          <strong class="reserved">for</strong> (; currPos &lt; <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>
<a id="L1163" name="L1163"></a>1163                 &amp;&amp; !<a href="../S/5871.html#L30" title="Defined at 30 in src/com/sun/org/apache/xml/internal/utils/XMLCharacterRecognizer.java.">XMLCharacterRecognizer</a>.<a href="../D/26505.html" title="Multiple defined in 15 places.">isWhiteSpace</a>(ch[currPos]);
<a id="L1164" name="L1164"></a>1164               currPos++) <em class="brace">{</em> <em class="brace">}</em>
<a id="L1165" name="L1165"></a>1165 
<a id="L1166" name="L1166"></a>1166          <em class="comment">// Non-whitespace seen - emit them, along with a single</em>
<a id="L1167" name="L1167"></a>1167          <em class="comment">// space for any preceding whitespace characters</em>
<a id="L1168" name="L1168"></a>1168          <strong class="reserved">if</strong> (startNonWhitespace != currPos) <em class="brace">{</em>
<a id="L1169" name="L1169"></a>1169              <strong class="reserved">if</strong> (seenWhitespace) <em class="brace">{</em>
<a id="L1170" name="L1170"></a>1170                  <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>.<a href="../D/12339.html" title="Multiple defined in 98 places.">characters</a>(SINGLE_SPACE, 0, 1);
<a id="L1171" name="L1171"></a>1171                  seenWhitespace = <strong class="reserved">false</strong>;
<a id="L1172" name="L1172"></a>1172              <em class="brace">}</em>
<a id="L1173" name="L1173"></a>1173              <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>.<a href="../D/12339.html" title="Multiple defined in 98 places.">characters</a>(ch, startNonWhitespace,
<a id="L1174" name="L1174"></a>1174                                 currPos - startNonWhitespace);
<a id="L1175" name="L1175"></a>1175          <em class="brace">}</em>
<a id="L1176" name="L1176"></a>1176 
<a id="L1177" name="L1177"></a>1177          <strong class="reserved">int</strong> startWhitespace = currPos;
<a id="L1178" name="L1178"></a>1178 
<a id="L1179" name="L1179"></a>1179          <em class="comment">// Consume any whitespace characters</em>
<a id="L1180" name="L1180"></a>1180          <strong class="reserved">for</strong> (; currPos &lt; <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>
<a id="L1181" name="L1181"></a>1181                 &amp;&amp; <a href="../S/5871.html#L30" title="Defined at 30 in src/com/sun/org/apache/xml/internal/utils/XMLCharacterRecognizer.java.">XMLCharacterRecognizer</a>.<a href="../D/26505.html" title="Multiple defined in 15 places.">isWhiteSpace</a>(ch[currPos]);
<a id="L1182" name="L1182"></a>1182               currPos++) <em class="brace">{</em> <em class="brace">}</em>
<a id="L1183" name="L1183"></a>1183 
<a id="L1184" name="L1184"></a>1184          <strong class="reserved">if</strong> (startWhitespace != currPos) <em class="brace">{</em>
<a id="L1185" name="L1185"></a>1185              seenWhitespace = <strong class="reserved">true</strong>;
<a id="L1186" name="L1186"></a>1186          <em class="brace">}</em>
<a id="L1187" name="L1187"></a>1187      <em class="brace">}</em>
<a id="L1188" name="L1188"></a>1188 
<a id="L1189" name="L1189"></a>1189      <strong class="reserved">return</strong> (seenWhitespace ? CARRY_WS : 0)
<a id="L1190" name="L1190"></a>1190             | (edgeTreatmentFlags &amp; SUPPRESS_TRAILING_WS);
<a id="L1191" name="L1191"></a>1191   <em class="brace">}</em>
<a id="L1192" name="L1192"></a>1192 
<div class="comment">
    Directly normalize and dispatch the character array.
    @param ch The characters from the XML document.
    @param start The start position in the array.
    @param length The number of characters to read from the array.
    @param handler SAX ContentHandler object to receive the event.
    @exception org.xml.sax.SAXException Any SAX exception, possibly
               wrapping another exception.</div>
<a id="L1203" name="L1203"></a>1203   <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/26771.html" title="Multiple referred from 12 places.">sendNormalizedSAXcharacters</a>(<strong class="reserved">char</strong> ch[],
<a id="L1204" name="L1204"></a>1204              <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>,
<a id="L1205" name="L1205"></a>1205              org.xml.sax.<a href="../D/1853.html" title="Multiple defined in 2 places.">ContentHandler</a> <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>)
<a id="L1206" name="L1206"></a>1206           <strong class="reserved">throws</strong> org.xml.sax.<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>
<a id="L1207" name="L1207"></a>1207   <em class="brace">{</em>
<a id="L1208" name="L1208"></a>1208                 <a href="../D/31740.html" title="Multiple defined in 3 places.">sendNormalizedSAXcharacters</a>(ch, <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>,
<a id="L1209" name="L1209"></a>1209              <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>, SUPPRESS_BOTH);
<a id="L1210" name="L1210"></a>1210         <em class="brace">}</em>
<a id="L1211" name="L1211"></a>1211 
<div class="comment">
    Sends the specified range of characters as sax Comment.
    <p>
    Note that, unlike sendSAXcharacters, this has to be done as a single
    call to LexicalHandler#comment.
    @param ch SAX LexicalHandler object to receive the event.
    @param start Offset of first character in the range.
    @param length Number of characters to send.
    @exception org.xml.sax.SAXException may be thrown by handler's
    characters() method.</p></div>
<a id="L1224" name="L1224"></a>1224   <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../S/4895.html#L201" title="Referred from 201 in src/com/sun/org/apache/xpath/internal/objects/XStringForFSB.java.">sendSAXComment</a>(
<a id="L1225" name="L1225"></a>1225           org.xml.sax.ext.<a href="../S/719.html#L68" title="Defined at 68 in src/org/xml/sax/ext/LexicalHandler.java.">LexicalHandler</a> ch, <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L1226" name="L1226"></a>1226             <strong class="reserved">throws</strong> org.xml.sax.<a href="../S/726.html#L62" title="Defined at 62 in src/org/xml/sax/SAXException.java.">SAXException</a>
<a id="L1227" name="L1227"></a>1227   <em class="brace">{</em>
<a id="L1228" name="L1228"></a>1228 
<a id="L1229" name="L1229"></a>1229     <em class="comment">// %OPT% Do it this way for now...</em>
<a id="L1230" name="L1230"></a>1230     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/13011.html" title="Multiple defined in 65 places.">comment</a> = <a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L1231" name="L1231"></a>1231     ch.<a href="../D/13011.html" title="Multiple defined in 65 places.">comment</a>(<a href="../D/13011.html" title="Multiple defined in 65 places.">comment</a>.<a href="../D/35368.html" title="Multiple defined in 3 places.">toCharArray</a>(), 0, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L1232" name="L1232"></a>1232   <em class="brace">}</em>
<a id="L1233" name="L1233"></a>1233 
<div class="comment">
    Copies characters from this string into the destination character
    array.
    @param      srcBegin   index of the first character in the string
                           to copy.
    @param      srcEnd     index after the last character in the string
                           to copy.
    @param      dst        the destination array.
    @param      dstBegin   the start offset in the destination array.
    @exception IndexOutOfBoundsException If any of the following
               is true:
               <ul><li><code>srcBegin</code> is negative.
               </li><li><code>srcBegin</code> is greater than <code>srcEnd</code>
               </li><li><code>srcEnd</code> is greater than the length of this
                   string
               </li><li><code>dstBegin</code> is negative
               </li><li><code>dstBegin+(srcEnd-srcBegin)</code> is larger than
                   <code>dst.length</code></li></ul>
    @exception NullPointerException if <code>dst</code> is <code>null</code></div>
<a id="L1255" name="L1255"></a>1255   <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/15533.html" title="Multiple referred from 94 places.">getChars</a>(<strong class="reserved">int</strong> srcBegin, <strong class="reserved">int</strong> srcEnd, <strong class="reserved">char</strong> dst[], <strong class="reserved">int</strong> dstBegin)
<a id="L1256" name="L1256"></a>1256   <em class="brace">{</em>
<a id="L1257" name="L1257"></a>1257     <em class="comment">// %TBD% Joe needs to write this function.  Make public when implemented.</em>
<a id="L1258" name="L1258"></a>1258   <em class="brace">}</em>
<a id="L1259" name="L1259"></a>1259 
<div class="comment">
    Encapsulation c'tor. After this is called, the source FastStringBuffer
    will be reset to use the new object as its m_innerFSB, and will have
    had its chunk size reset appropriately. IT SHOULD NEVER BE CALLED
    EXCEPT WHEN source.length()==1&lt;&lt;(source.m_chunkBits+source.m_rebundleBits)
    NEEDSDOC @param source</div>
<a id="L1268" name="L1268"></a>1268   <strong class="reserved">private</strong> <a href="../S/5847.html#L56" title="Defined at 56 in src/com/sun/org/apache/xml/internal/utils/FastStringBuffer.java.">FastStringBuffer</a>(FastStringBuffer <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>)
<a id="L1269" name="L1269"></a>1269   <em class="brace">{</em>
<a id="L1270" name="L1270"></a>1270 
<a id="L1271" name="L1271"></a>1271     <em class="comment">// Copy existing information into new encapsulation</em>
<a id="L1272" name="L1272"></a>1272     m_chunkBits = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkBits;
<a id="L1273" name="L1273"></a>1273     m_maxChunkBits = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_maxChunkBits;
<a id="L1274" name="L1274"></a>1274     m_rebundleBits = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_rebundleBits;
<a id="L1275" name="L1275"></a>1275     m_chunkSize = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkSize;
<a id="L1276" name="L1276"></a>1276     m_chunkMask = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkMask;
<a id="L1277" name="L1277"></a>1277     m_array = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_array;
<a id="L1278" name="L1278"></a>1278     m_innerFSB = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_innerFSB;
<a id="L1279" name="L1279"></a>1279 
<a id="L1280" name="L1280"></a>1280     <em class="comment">// These have to be adjusted because we're calling just at the time</em>
<a id="L1281" name="L1281"></a>1281     <em class="comment">// when we would be about to allocate another chunk</em>
<a id="L1282" name="L1282"></a>1282     m_lastChunk = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_lastChunk - 1;
<a id="L1283" name="L1283"></a>1283     m_firstFree = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkSize;
<a id="L1284" name="L1284"></a>1284 
<a id="L1285" name="L1285"></a>1285     <em class="comment">// Establish capsule as the Inner FSB, reset chunk sizes/addressing</em>
<a id="L1286" name="L1286"></a>1286     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_array = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[16][];
<a id="L1287" name="L1287"></a>1287     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_innerFSB = <strong class="reserved">this</strong>;
<a id="L1288" name="L1288"></a>1288 
<a id="L1289" name="L1289"></a>1289     <em class="comment">// Since we encapsulated just as we were about to append another</em>
<a id="L1290" name="L1290"></a>1290     <em class="comment">// chunk, return ready to create the chunk after the innerFSB</em>
<a id="L1291" name="L1291"></a>1291     <em class="comment">// -- 1, not 0.</em>
<a id="L1292" name="L1292"></a>1292     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_lastChunk = 1;
<a id="L1293" name="L1293"></a>1293     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_firstFree = 0;
<a id="L1294" name="L1294"></a>1294     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkBits += m_rebundleBits;
<a id="L1295" name="L1295"></a>1295     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkSize = 1 &lt;&lt; (<a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkBits);
<a id="L1296" name="L1296"></a>1296     <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkMask = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>.m_chunkSize - 1;
<a id="L1297" name="L1297"></a>1297   <em class="brace">}</em>
<a id="L1298" name="L1298"></a>1298 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L270">[^]</a><a href="#L1255">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>