<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/org/apache/xpath/internal/compiler/Lexer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L98">[^]</a><a href="#L572">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L98" title="Defined at 98.">tokenize</a></li>
<li><a href="#L111" title="Defined at 111.">tokenize</a></li>
<li><a href="#L391" title="Defined at 391.">mapPatternElemPos</a></li>
<li><a href="#L426" title="Defined at 426.">getTokenQueuePosFromMap</a></li>
<li><a href="#L439" title="Defined at 439.">resetTokenMark</a></li>
<li><a href="#L467" title="Defined at 467.">getKeywordToken</a></li>
<li><a href="#L495" title="Defined at 495.">recordTokenString</a></li>
<li><a href="#L554" title="Defined at 554.">addToTokenQueue</a></li>
<li><a href="#L572" title="Defined at 572.">mapNSTokens</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<div class="comment">
  Copyright 1999-2004 The Apache Software Foundation.
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
      http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.</div>
<div class="comment">
  $Id: Lexer.java,v 1.2.4.1 2005/09/10 03:55:45 jeffsuttor Exp $</div>
<a id="L23" name="L23"></a>  23 <strong class="reserved">package</strong> com.sun.org.apache.xpath.internal.compiler;
<a id="L24" name="L24"></a>  24 
<a id="L25" name="L25"></a>  25 <strong class="reserved">import</strong> java.util.Vector;
<a id="L26" name="L26"></a>  26 
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.utils.PrefixResolver;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> com.sun.org.apache.xpath.internal.res.XPATHErrorResources;
<a id="L29" name="L29"></a>  29 
<div class="comment">
  This class is in charge of lexical processing of the XPath
  expression into tokens.</div>
<a id="L34" name="L34"></a>  34 <strong class="reserved">class</strong> <a href="../R/4566.html" title="Multiple referred from 2 places.">Lexer</a>
<a id="L35" name="L35"></a>  35 <em class="brace">{</em>
<a id="L36" name="L36"></a>  36 
<div class="comment">
    The target XPath.</div>
<a id="L40" name="L40"></a>  40   <strong class="reserved">private</strong> <a href="../D/1702.html" title="Multiple defined in 2 places.">Compiler</a> m_compiler;
<a id="L41" name="L41"></a>  41 
<div class="comment">
    The prefix resolver to map prefixes to namespaces in the XPath.</div>
<a id="L45" name="L45"></a>  45   <a href="../S/5879.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/utils/PrefixResolver.java.">PrefixResolver</a> m_namespaceContext;
<a id="L46" name="L46"></a>  46 
<div class="comment">
    The XPath processor object.</div>
<a id="L50" name="L50"></a>  50   <a href="../D/10106.html" title="Multiple defined in 2 places.">XPathParser</a> m_processor;
<a id="L51" name="L51"></a>  51 
<div class="comment">
    This value is added to each element name in the TARGETEXTRA
    that is a 'target' (right-most top-level element name).</div>
<a id="L56" name="L56"></a>  56   <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> TARGETEXTRA = 10000;
<a id="L57" name="L57"></a>  57 
<div class="comment">
    Ignore this, it is going away.
    This holds a map to the m_tokenQueue that tells where the top-level elements are.
    It is used for pattern matching so the m_tokenQueue can be walked backwards.
    Each element that is a 'target', (right-most top level element name) has
    TARGETEXTRA added to it.</div>
<a id="L66" name="L66"></a>  66   <strong class="reserved">private</strong> <strong class="reserved">int</strong> m_patternMap[] = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[100];
<a id="L67" name="L67"></a>  67 
<div class="comment">
    Ignore this, it is going away.
    The number of elements that m_patternMap maps;</div>
<a id="L72" name="L72"></a>  72   <strong class="reserved">private</strong> <strong class="reserved">int</strong> m_patternMapSize;
<a id="L73" name="L73"></a>  73 
<div class="comment">
    Create a Lexer object.
    @param compiler The owning compiler for this lexer.
    @param resolver The prefix resolver for mapping qualified name prefixes
                    to namespace URIs.
    @param xpathProcessor The parser that is processing strings to opcodes.</div>
<a id="L82" name="L82"></a>  82   Lexer(<a href="../D/1702.html" title="Multiple defined in 2 places.">Compiler</a> compiler, <a href="../S/5879.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/utils/PrefixResolver.java.">PrefixResolver</a> resolver,
<a id="L83" name="L83"></a>  83         <a href="../D/10106.html" title="Multiple defined in 2 places.">XPathParser</a> xpathProcessor)
<a id="L84" name="L84"></a>  84   <em class="brace">{</em>
<a id="L85" name="L85"></a>  85 
<a id="L86" name="L86"></a>  86     m_compiler = compiler;
<a id="L87" name="L87"></a>  87     m_namespaceContext = resolver;
<a id="L88" name="L88"></a>  88     m_processor = xpathProcessor;
<a id="L89" name="L89"></a>  89   <em class="brace">}</em>
<a id="L90" name="L90"></a>  90 
<div class="comment">
    Walk through the expression and build a token queue, and a map of the top-level
    elements.
    @param pat XSLT Expression.
    @throws javax.xml.transform.TransformerException</div>
<a id="L98" name="L98"></a>  98   <strong class="reserved">void</strong> <a href="../R/29387.html" title="Multiple referred from 5 places.">tokenize</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pat) <strong class="reserved">throws</strong> <a href="../D/26637.html" title="Multiple defined in 6 places.">javax</a>.xml.<a href="../D/35592.html" title="Multiple defined in 22 places.">transform</a>.<a href="../S/4051.html#L35" title="Defined at 35 in src/javax/xml/transform/TransformerException.java.">TransformerException</a>
<a id="L99" name="L99"></a>  99   <em class="brace">{</em>
<a id="L100" name="L100"></a> 100     <a href="../D/35549.html" title="Multiple defined in 6 places.">tokenize</a>(pat, <strong class="reserved">null</strong>);
<a id="L101" name="L101"></a> 101   <em class="brace">}</em>
<a id="L102" name="L102"></a> 102 
<div class="comment">
    Walk through the expression and build a token queue, and a map of the top-level
    elements.
    @param pat XSLT Expression.
    @param targetStrings Vector to hold Strings, may be null.
    @throws javax.xml.transform.TransformerException</div>
<a id="L111" name="L111"></a> 111   <strong class="reserved">void</strong> <a href="../R/29387.html" title="Multiple referred from 5 places.">tokenize</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pat, <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a> targetStrings)
<a id="L112" name="L112"></a> 112           <strong class="reserved">throws</strong> <a href="../D/26637.html" title="Multiple defined in 6 places.">javax</a>.xml.<a href="../D/35592.html" title="Multiple defined in 22 places.">transform</a>.<a href="../S/4051.html#L35" title="Defined at 35 in src/javax/xml/transform/TransformerException.java.">TransformerException</a>
<a id="L113" name="L113"></a> 113   <em class="brace">{</em>
<a id="L114" name="L114"></a> 114 
<a id="L115" name="L115"></a> 115     m_compiler.m_currentPattern = pat;
<a id="L116" name="L116"></a> 116     m_patternMapSize = 0;
<a id="L117" name="L117"></a> 117 
<a id="L118" name="L118"></a> 118     <em class="comment">// This needs to grow too.</em>
<a id="L119" name="L119"></a> 119     m_compiler.m_opMap = <strong class="reserved">new</strong> <a href="../S/5003.html#L33" title="Defined at 33 in src/com/sun/org/apache/xpath/internal/compiler/OpMapVector.java.">OpMapVector</a>(<a href="../S/4996.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">OpMap</a>.MAXTOKENQUEUESIZE * 5, <a href="../S/4996.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">OpMap</a>.BLOCKTOKENQUEUESIZE * 5, <a href="../S/4996.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">OpMap</a>.MAPINDEX_LENGTH);
<a id="L120" name="L120"></a> 120 
<a id="L121" name="L121"></a> 121     <strong class="reserved">int</strong> nChars = pat.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>();
<a id="L122" name="L122"></a> 122     <strong class="reserved">int</strong> startSubstring = -1;
<a id="L123" name="L123"></a> 123     <strong class="reserved">int</strong> posOfNSSep = -1;
<a id="L124" name="L124"></a> 124     <strong class="reserved">boolean</strong> isStartOfPat = <strong class="reserved">true</strong>;
<a id="L125" name="L125"></a> 125     <strong class="reserved">boolean</strong> isAttrName = <strong class="reserved">false</strong>;
<a id="L126" name="L126"></a> 126     <strong class="reserved">boolean</strong> isNum = <strong class="reserved">false</strong>;
<a id="L127" name="L127"></a> 127 
<a id="L128" name="L128"></a> 128     <em class="comment">// Nesting of '[' so we can know if the given element should be</em>
<a id="L129" name="L129"></a> 129     <em class="comment">// counted inside the m_patternMap.</em>
<a id="L130" name="L130"></a> 130     <strong class="reserved">int</strong> nesting = 0;
<a id="L131" name="L131"></a> 131 
<a id="L132" name="L132"></a> 132     <em class="comment">// char[] chars = pat.toCharArray();</em>
<a id="L133" name="L133"></a> 133     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; nChars; i++)
<a id="L134" name="L134"></a> 134     <em class="brace">{</em>
<a id="L135" name="L135"></a> 135       <strong class="reserved">char</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = pat.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i);
<a id="L136" name="L136"></a> 136 
<a id="L137" name="L137"></a> 137       <strong class="reserved">switch</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)
<a id="L138" name="L138"></a> 138       <em class="brace">{</em>
<a id="L139" name="L139"></a> 139       <strong class="reserved">case</strong> '\"' :
<a id="L140" name="L140"></a> 140       <em class="brace">{</em>
<a id="L141" name="L141"></a> 141         <strong class="reserved">if</strong> (startSubstring != -1)
<a id="L142" name="L142"></a> 142         <em class="brace">{</em>
<a id="L143" name="L143"></a> 143           isNum = <strong class="reserved">false</strong>;
<a id="L144" name="L144"></a> 144           isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L145" name="L145"></a> 145           isAttrName = <strong class="reserved">false</strong>;
<a id="L146" name="L146"></a> 146 
<a id="L147" name="L147"></a> 147           <strong class="reserved">if</strong> (-1 != posOfNSSep)
<a id="L148" name="L148"></a> 148           <em class="brace">{</em>
<a id="L149" name="L149"></a> 149             posOfNSSep = <a href="../S/5000.html#L572" title="Defined at 572 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapNSTokens</a>(pat, startSubstring, posOfNSSep, i);
<a id="L150" name="L150"></a> 150           <em class="brace">}</em>
<a id="L151" name="L151"></a> 151           <strong class="reserved">else</strong>
<a id="L152" name="L152"></a> 152           <em class="brace">{</em>
<a id="L153" name="L153"></a> 153             <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i));
<a id="L154" name="L154"></a> 154           <em class="brace">}</em>
<a id="L155" name="L155"></a> 155         <em class="brace">}</em>
<a id="L156" name="L156"></a> 156 
<a id="L157" name="L157"></a> 157         startSubstring = i;
<a id="L158" name="L158"></a> 158 
<a id="L159" name="L159"></a> 159         <strong class="reserved">for</strong> (i++; (i &lt; nChars) &amp;&amp; ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = pat.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i)) != '\"'); i++);
<a id="L160" name="L160"></a> 160 
<a id="L161" name="L161"></a> 161         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == '\"' &amp;&amp; i &lt; nChars)
<a id="L162" name="L162"></a> 162         <em class="brace">{</em>
<a id="L163" name="L163"></a> 163           <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i + 1));
<a id="L164" name="L164"></a> 164 
<a id="L165" name="L165"></a> 165           startSubstring = -1;
<a id="L166" name="L166"></a> 166         <em class="brace">}</em>
<a id="L167" name="L167"></a> 167         <strong class="reserved">else</strong>
<a id="L168" name="L168"></a> 168         <em class="brace">{</em>
<a id="L169" name="L169"></a> 169           m_processor.<a href="../D/15699.html" title="Multiple defined in 51 places.">error</a>(<a href="../S/4836.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/res/XPATHErrorResources.java.">XPATHErrorResources</a>.ER_EXPECTED_DOUBLE_QUOTE,
<a id="L170" name="L170"></a> 170                             <strong class="reserved">null</strong>);  <em class="comment">//"misquoted literal... expected double quote!");</em>
<a id="L171" name="L171"></a> 171         <em class="brace">}</em>
<a id="L172" name="L172"></a> 172       <em class="brace">}</em>
<a id="L173" name="L173"></a> 173       <strong class="reserved">break</strong>;
<a id="L174" name="L174"></a> 174       <strong class="reserved">case</strong> '\'' :
<a id="L175" name="L175"></a> 175         <strong class="reserved">if</strong> (startSubstring != -1)
<a id="L176" name="L176"></a> 176         <em class="brace">{</em>
<a id="L177" name="L177"></a> 177           isNum = <strong class="reserved">false</strong>;
<a id="L178" name="L178"></a> 178           isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L179" name="L179"></a> 179           isAttrName = <strong class="reserved">false</strong>;
<a id="L180" name="L180"></a> 180 
<a id="L181" name="L181"></a> 181           <strong class="reserved">if</strong> (-1 != posOfNSSep)
<a id="L182" name="L182"></a> 182           <em class="brace">{</em>
<a id="L183" name="L183"></a> 183             posOfNSSep = <a href="../S/5000.html#L572" title="Defined at 572 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapNSTokens</a>(pat, startSubstring, posOfNSSep, i);
<a id="L184" name="L184"></a> 184           <em class="brace">}</em>
<a id="L185" name="L185"></a> 185           <strong class="reserved">else</strong>
<a id="L186" name="L186"></a> 186           <em class="brace">{</em>
<a id="L187" name="L187"></a> 187             <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i));
<a id="L188" name="L188"></a> 188           <em class="brace">}</em>
<a id="L189" name="L189"></a> 189         <em class="brace">}</em>
<a id="L190" name="L190"></a> 190 
<a id="L191" name="L191"></a> 191         startSubstring = i;
<a id="L192" name="L192"></a> 192 
<a id="L193" name="L193"></a> 193         <strong class="reserved">for</strong> (i++; (i &lt; nChars) &amp;&amp; ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = pat.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i)) != '\''); i++);
<a id="L194" name="L194"></a> 194 
<a id="L195" name="L195"></a> 195         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == '\'' &amp;&amp; i &lt; nChars)
<a id="L196" name="L196"></a> 196         <em class="brace">{</em>
<a id="L197" name="L197"></a> 197           <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i + 1));
<a id="L198" name="L198"></a> 198 
<a id="L199" name="L199"></a> 199           startSubstring = -1;
<a id="L200" name="L200"></a> 200         <em class="brace">}</em>
<a id="L201" name="L201"></a> 201         <strong class="reserved">else</strong>
<a id="L202" name="L202"></a> 202         <em class="brace">{</em>
<a id="L203" name="L203"></a> 203           m_processor.<a href="../D/15699.html" title="Multiple defined in 51 places.">error</a>(<a href="../S/4836.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/res/XPATHErrorResources.java.">XPATHErrorResources</a>.ER_EXPECTED_SINGLE_QUOTE,
<a id="L204" name="L204"></a> 204                             <strong class="reserved">null</strong>);  <em class="comment">//"misquoted literal... expected single quote!");</em>
<a id="L205" name="L205"></a> 205         <em class="brace">}</em>
<a id="L206" name="L206"></a> 206         <strong class="reserved">break</strong>;
<a id="L207" name="L207"></a> 207       <strong class="reserved">case</strong> 0x0A :
<a id="L208" name="L208"></a> 208       <strong class="reserved">case</strong> 0x0D :
<a id="L209" name="L209"></a> 209       <strong class="reserved">case</strong> ' ' :
<a id="L210" name="L210"></a> 210       <strong class="reserved">case</strong> '\t' :
<a id="L211" name="L211"></a> 211         <strong class="reserved">if</strong> (startSubstring != -1)
<a id="L212" name="L212"></a> 212         <em class="brace">{</em>
<a id="L213" name="L213"></a> 213           isNum = <strong class="reserved">false</strong>;
<a id="L214" name="L214"></a> 214           isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L215" name="L215"></a> 215           isAttrName = <strong class="reserved">false</strong>;
<a id="L216" name="L216"></a> 216 
<a id="L217" name="L217"></a> 217           <strong class="reserved">if</strong> (-1 != posOfNSSep)
<a id="L218" name="L218"></a> 218           <em class="brace">{</em>
<a id="L219" name="L219"></a> 219             posOfNSSep = <a href="../S/5000.html#L572" title="Defined at 572 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapNSTokens</a>(pat, startSubstring, posOfNSSep, i);
<a id="L220" name="L220"></a> 220           <em class="brace">}</em>
<a id="L221" name="L221"></a> 221           <strong class="reserved">else</strong>
<a id="L222" name="L222"></a> 222           <em class="brace">{</em>
<a id="L223" name="L223"></a> 223             <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i));
<a id="L224" name="L224"></a> 224           <em class="brace">}</em>
<a id="L225" name="L225"></a> 225 
<a id="L226" name="L226"></a> 226           startSubstring = -1;
<a id="L227" name="L227"></a> 227         <em class="brace">}</em>
<a id="L228" name="L228"></a> 228         <strong class="reserved">break</strong>;
<a id="L229" name="L229"></a> 229       <strong class="reserved">case</strong> '@' :
<a id="L230" name="L230"></a> 230         isAttrName = <strong class="reserved">true</strong>;
<a id="L231" name="L231"></a> 231 
<a id="L232" name="L232"></a> 232       <em class="comment">// fall-through on purpose</em>
<a id="L233" name="L233"></a> 233       <strong class="reserved">case</strong> '-' :
<a id="L234" name="L234"></a> 234         <strong class="reserved">if</strong> ('-' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)
<a id="L235" name="L235"></a> 235         <em class="brace">{</em>
<a id="L236" name="L236"></a> 236           <strong class="reserved">if</strong> (!(isNum || (startSubstring == -1)))
<a id="L237" name="L237"></a> 237           <em class="brace">{</em>
<a id="L238" name="L238"></a> 238             <strong class="reserved">break</strong>;
<a id="L239" name="L239"></a> 239           <em class="brace">}</em>
<a id="L240" name="L240"></a> 240 
<a id="L241" name="L241"></a> 241           isNum = <strong class="reserved">false</strong>;
<a id="L242" name="L242"></a> 242         <em class="brace">}</em>
<a id="L243" name="L243"></a> 243 
<a id="L244" name="L244"></a> 244       <em class="comment">// fall-through on purpose</em>
<a id="L245" name="L245"></a> 245       <strong class="reserved">case</strong> '(' :
<a id="L246" name="L246"></a> 246       <strong class="reserved">case</strong> '[' :
<a id="L247" name="L247"></a> 247       <strong class="reserved">case</strong> ')' :
<a id="L248" name="L248"></a> 248       <strong class="reserved">case</strong> ']' :
<a id="L249" name="L249"></a> 249       <strong class="reserved">case</strong> '|' :
<a id="L250" name="L250"></a> 250       <strong class="reserved">case</strong> '/' :
<a id="L251" name="L251"></a> 251       <strong class="reserved">case</strong> '*' :
<a id="L252" name="L252"></a> 252       <strong class="reserved">case</strong> '+' :
<a id="L253" name="L253"></a> 253       <strong class="reserved">case</strong> '=' :
<a id="L254" name="L254"></a> 254       <strong class="reserved">case</strong> ',' :
<a id="L255" name="L255"></a> 255       <strong class="reserved">case</strong> '\\' :  <em class="comment">// Unused at the moment</em>
<a id="L256" name="L256"></a> 256       <strong class="reserved">case</strong> '^' :  <em class="comment">// Unused at the moment</em>
<a id="L257" name="L257"></a> 257       <strong class="reserved">case</strong> '!' :  <em class="comment">// Unused at the moment</em>
<a id="L258" name="L258"></a> 258       <strong class="reserved">case</strong> '$' :
<a id="L259" name="L259"></a> 259       <strong class="reserved">case</strong> '&lt;' :
<a id="L260" name="L260"></a> 260       <strong class="reserved">case</strong> '&gt;' :
<a id="L261" name="L261"></a> 261         <strong class="reserved">if</strong> (startSubstring != -1)
<a id="L262" name="L262"></a> 262         <em class="brace">{</em>
<a id="L263" name="L263"></a> 263           isNum = <strong class="reserved">false</strong>;
<a id="L264" name="L264"></a> 264           isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L265" name="L265"></a> 265           isAttrName = <strong class="reserved">false</strong>;
<a id="L266" name="L266"></a> 266 
<a id="L267" name="L267"></a> 267           <strong class="reserved">if</strong> (-1 != posOfNSSep)
<a id="L268" name="L268"></a> 268           <em class="brace">{</em>
<a id="L269" name="L269"></a> 269             posOfNSSep = <a href="../S/5000.html#L572" title="Defined at 572 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapNSTokens</a>(pat, startSubstring, posOfNSSep, i);
<a id="L270" name="L270"></a> 270           <em class="brace">}</em>
<a id="L271" name="L271"></a> 271           <strong class="reserved">else</strong>
<a id="L272" name="L272"></a> 272           <em class="brace">{</em>
<a id="L273" name="L273"></a> 273             <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i));
<a id="L274" name="L274"></a> 274           <em class="brace">}</em>
<a id="L275" name="L275"></a> 275 
<a id="L276" name="L276"></a> 276           startSubstring = -1;
<a id="L277" name="L277"></a> 277         <em class="brace">}</em>
<a id="L278" name="L278"></a> 278         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (('/' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) &amp;&amp; isStartOfPat)
<a id="L279" name="L279"></a> 279         <em class="brace">{</em>
<a id="L280" name="L280"></a> 280           isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L281" name="L281"></a> 281         <em class="brace">}</em>
<a id="L282" name="L282"></a> 282         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ('*' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)
<a id="L283" name="L283"></a> 283         <em class="brace">{</em>
<a id="L284" name="L284"></a> 284           isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L285" name="L285"></a> 285           isAttrName = <strong class="reserved">false</strong>;
<a id="L286" name="L286"></a> 286         <em class="brace">}</em>
<a id="L287" name="L287"></a> 287 
<a id="L288" name="L288"></a> 288         <strong class="reserved">if</strong> (0 == nesting)
<a id="L289" name="L289"></a> 289         <em class="brace">{</em>
<a id="L290" name="L290"></a> 290           <strong class="reserved">if</strong> ('|' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)
<a id="L291" name="L291"></a> 291           <em class="brace">{</em>
<a id="L292" name="L292"></a> 292             <strong class="reserved">if</strong> (<strong class="reserved">null</strong> != targetStrings)
<a id="L293" name="L293"></a> 293             <em class="brace">{</em>
<a id="L294" name="L294"></a> 294               <a href="../S/5000.html#L495" title="Defined at 495 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">recordTokenString</a>(targetStrings);
<a id="L295" name="L295"></a> 295             <em class="brace">}</em>
<a id="L296" name="L296"></a> 296 
<a id="L297" name="L297"></a> 297             isStartOfPat = <strong class="reserved">true</strong>;
<a id="L298" name="L298"></a> 298           <em class="brace">}</em>
<a id="L299" name="L299"></a> 299         <em class="brace">}</em>
<a id="L300" name="L300"></a> 300 
<a id="L301" name="L301"></a> 301         <strong class="reserved">if</strong> ((')' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) || (']' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>))
<a id="L302" name="L302"></a> 302         <em class="brace">{</em>
<a id="L303" name="L303"></a> 303           nesting--;
<a id="L304" name="L304"></a> 304         <em class="brace">}</em>
<a id="L305" name="L305"></a> 305         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (('(' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) || ('[' == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>))
<a id="L306" name="L306"></a> 306         <em class="brace">{</em>
<a id="L307" name="L307"></a> 307           nesting++;
<a id="L308" name="L308"></a> 308         <em class="brace">}</em>
<a id="L309" name="L309"></a> 309 
<a id="L310" name="L310"></a> 310         <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(i, i + 1));
<a id="L311" name="L311"></a> 311         <strong class="reserved">break</strong>;
<a id="L312" name="L312"></a> 312       <strong class="reserved">case</strong> ':' :
<a id="L313" name="L313"></a> 313         <strong class="reserved">if</strong> (i&gt;0)
<a id="L314" name="L314"></a> 314         <em class="brace">{</em>
<a id="L315" name="L315"></a> 315           <strong class="reserved">if</strong> (posOfNSSep == (i - 1))
<a id="L316" name="L316"></a> 316           <em class="brace">{</em>
<a id="L317" name="L317"></a> 317             <strong class="reserved">if</strong> (startSubstring != -1)
<a id="L318" name="L318"></a> 318             <em class="brace">{</em>
<a id="L319" name="L319"></a> 319               <strong class="reserved">if</strong> (startSubstring &lt; (i - 1))
<a id="L320" name="L320"></a> 320                 <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, i - 1));
<a id="L321" name="L321"></a> 321             <em class="brace">}</em>
<a id="L322" name="L322"></a> 322 
<a id="L323" name="L323"></a> 323             isNum = <strong class="reserved">false</strong>;
<a id="L324" name="L324"></a> 324             isAttrName = <strong class="reserved">false</strong>;
<a id="L325" name="L325"></a> 325             startSubstring = -1;
<a id="L326" name="L326"></a> 326             posOfNSSep = -1;
<a id="L327" name="L327"></a> 327 
<a id="L328" name="L328"></a> 328             <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(i - 1, i + 1));
<a id="L329" name="L329"></a> 329 
<a id="L330" name="L330"></a> 330             <strong class="reserved">break</strong>;
<a id="L331" name="L331"></a> 331           <em class="brace">}</em>
<a id="L332" name="L332"></a> 332           <strong class="reserved">else</strong>
<a id="L333" name="L333"></a> 333           <em class="brace">{</em>
<a id="L334" name="L334"></a> 334             posOfNSSep = i;
<a id="L335" name="L335"></a> 335           <em class="brace">}</em>
<a id="L336" name="L336"></a> 336         <em class="brace">}</em>
<a id="L337" name="L337"></a> 337 
<a id="L338" name="L338"></a> 338       <em class="comment">// fall through on purpose</em>
<a id="L339" name="L339"></a> 339       <strong class="reserved">default</strong> :
<a id="L340" name="L340"></a> 340         <strong class="reserved">if</strong> (-1 == startSubstring)
<a id="L341" name="L341"></a> 341         <em class="brace">{</em>
<a id="L342" name="L342"></a> 342           startSubstring = i;
<a id="L343" name="L343"></a> 343           isNum = <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25439.html" title="Multiple defined in 11 places.">isDigit</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L344" name="L344"></a> 344         <em class="brace">}</em>
<a id="L345" name="L345"></a> 345         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (isNum)
<a id="L346" name="L346"></a> 346         <em class="brace">{</em>
<a id="L347" name="L347"></a> 347           isNum = <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25439.html" title="Multiple defined in 11 places.">isDigit</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L348" name="L348"></a> 348         <em class="brace">}</em>
<a id="L349" name="L349"></a> 349       <em class="brace">}</em>
<a id="L350" name="L350"></a> 350     <em class="brace">}</em>
<a id="L351" name="L351"></a> 351 
<a id="L352" name="L352"></a> 352     <strong class="reserved">if</strong> (startSubstring != -1)
<a id="L353" name="L353"></a> 353     <em class="brace">{</em>
<a id="L354" name="L354"></a> 354       isNum = <strong class="reserved">false</strong>;
<a id="L355" name="L355"></a> 355       isStartOfPat = <a href="../S/5000.html#L391" title="Defined at 391 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapPatternElemPos</a>(nesting, isStartOfPat, isAttrName);
<a id="L356" name="L356"></a> 356 
<a id="L357" name="L357"></a> 357       <strong class="reserved">if</strong> ((-1 != posOfNSSep) ||
<a id="L358" name="L358"></a> 358          ((m_namespaceContext != <strong class="reserved">null</strong>) &amp;&amp; (m_namespaceContext.<a href="../D/24049.html" title="Multiple defined in 4 places.">handlesNullPrefixes</a>())))
<a id="L359" name="L359"></a> 359       <em class="brace">{</em>
<a id="L360" name="L360"></a> 360         posOfNSSep = <a href="../S/5000.html#L572" title="Defined at 572 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">mapNSTokens</a>(pat, startSubstring, posOfNSSep, nChars);
<a id="L361" name="L361"></a> 361       <em class="brace">}</em>
<a id="L362" name="L362"></a> 362       <strong class="reserved">else</strong>
<a id="L363" name="L363"></a> 363       <em class="brace">{</em>
<a id="L364" name="L364"></a> 364         <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, nChars));
<a id="L365" name="L365"></a> 365       <em class="brace">}</em>
<a id="L366" name="L366"></a> 366     <em class="brace">}</em>
<a id="L367" name="L367"></a> 367 
<a id="L368" name="L368"></a> 368     <strong class="reserved">if</strong> (0 == m_compiler.<a href="../S/4996.html#L111" title="Defined at 111 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">getTokenQueueSize</a>())
<a id="L369" name="L369"></a> 369     <em class="brace">{</em>
<a id="L370" name="L370"></a> 370       m_processor.<a href="../D/15699.html" title="Multiple defined in 51 places.">error</a>(<a href="../S/4836.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/res/XPATHErrorResources.java.">XPATHErrorResources</a>.ER_EMPTY_EXPRESSION, <strong class="reserved">null</strong>);  <em class="comment">//"Empty expression!");</em>
<a id="L371" name="L371"></a> 371     <em class="brace">}</em>
<a id="L372" name="L372"></a> 372     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<strong class="reserved">null</strong> != targetStrings)
<a id="L373" name="L373"></a> 373     <em class="brace">{</em>
<a id="L374" name="L374"></a> 374       <a href="../S/5000.html#L495" title="Defined at 495 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">recordTokenString</a>(targetStrings);
<a id="L375" name="L375"></a> 375     <em class="brace">}</em>
<a id="L376" name="L376"></a> 376 
<a id="L377" name="L377"></a> 377     m_processor.m_queueMark = 0;
<a id="L378" name="L378"></a> 378   <em class="brace">}</em>
<a id="L379" name="L379"></a> 379 
<div class="comment">
    Record the current position on the token queue as long as
    this is a top-level element.  Must be called before the
    next token is added to the m_tokenQueue.
    @param nesting The nesting count for the pattern element.
    @param isStart true if this is the start of a pattern.
    @param isAttrName true if we have determined that this is an attribute name.
    @return true if this is the start of a pattern.</div>
<a id="L391" name="L391"></a> 391   <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/23062.html" title="Multiple referred from 7 places.">mapPatternElemPos</a>(<strong class="reserved">int</strong> nesting, <strong class="reserved">boolean</strong> isStart,
<a id="L392" name="L392"></a> 392                                     <strong class="reserved">boolean</strong> isAttrName)
<a id="L393" name="L393"></a> 393   <em class="brace">{</em>
<a id="L394" name="L394"></a> 394 
<a id="L395" name="L395"></a> 395     <strong class="reserved">if</strong> (0 == nesting)
<a id="L396" name="L396"></a> 396     <em class="brace">{</em>
<a id="L397" name="L397"></a> 397       <strong class="reserved">if</strong>(m_patternMapSize &gt;= m_patternMap.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L398" name="L398"></a> 398       <em class="brace">{</em>
<a id="L399" name="L399"></a> 399         <strong class="reserved">int</strong> patternMap[] = m_patternMap;
<a id="L400" name="L400"></a> 400         <strong class="reserved">int</strong> len = m_patternMap.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L401" name="L401"></a> 401         m_patternMap = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[m_patternMapSize + 100];
<a id="L402" name="L402"></a> 402         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(patternMap, 0, m_patternMap, 0, len);
<a id="L403" name="L403"></a> 403       <em class="brace">}</em>
<a id="L404" name="L404"></a> 404       <strong class="reserved">if</strong> (!isStart)
<a id="L405" name="L405"></a> 405       <em class="brace">{</em>
<a id="L406" name="L406"></a> 406         m_patternMap[m_patternMapSize - 1] -= TARGETEXTRA;
<a id="L407" name="L407"></a> 407       <em class="brace">}</em>
<a id="L408" name="L408"></a> 408       m_patternMap[m_patternMapSize] =
<a id="L409" name="L409"></a> 409         (m_compiler.<a href="../S/4996.html#L111" title="Defined at 111 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">getTokenQueueSize</a>() - (isAttrName ? 1 : 0)) + TARGETEXTRA;
<a id="L410" name="L410"></a> 410 
<a id="L411" name="L411"></a> 411       m_patternMapSize++;
<a id="L412" name="L412"></a> 412 
<a id="L413" name="L413"></a> 413       isStart = <strong class="reserved">false</strong>;
<a id="L414" name="L414"></a> 414     <em class="brace">}</em>
<a id="L415" name="L415"></a> 415 
<a id="L416" name="L416"></a> 416     <strong class="reserved">return</strong> isStart;
<a id="L417" name="L417"></a> 417   <em class="brace">}</em>
<a id="L418" name="L418"></a> 418 
<div class="comment">
    Given a map pos, return the corresponding token queue pos.
    @param i The index in the m_patternMap.
    @return the token queue position.</div>
<a id="L426" name="L426"></a> 426   <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/5000.html#L498" title="Referred from 498 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">getTokenQueuePosFromMap</a>(<strong class="reserved">int</strong> i)
<a id="L427" name="L427"></a> 427   <em class="brace">{</em>
<a id="L428" name="L428"></a> 428 
<a id="L429" name="L429"></a> 429     <strong class="reserved">int</strong> pos = m_patternMap[i];
<a id="L430" name="L430"></a> 430 
<a id="L431" name="L431"></a> 431     <strong class="reserved">return</strong> (pos &gt;= TARGETEXTRA) ? (pos - TARGETEXTRA) : pos;
<a id="L432" name="L432"></a> 432   <em class="brace">}</em>
<a id="L433" name="L433"></a> 433 
<div class="comment">
    Reset token queue mark and m_token to a
    given position.
    @param mark The new position.</div>
<a id="L439" name="L439"></a> 439   <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/26301.html" title="Multiple referred from 2 places.">resetTokenMark</a>(<strong class="reserved">int</strong> <a href="../D/27489.html" title="Multiple defined in 38 places.">mark</a>)
<a id="L440" name="L440"></a> 440   <em class="brace">{</em>
<a id="L441" name="L441"></a> 441 
<a id="L442" name="L442"></a> 442     <strong class="reserved">int</strong> qsz = m_compiler.<a href="../S/4996.html#L111" title="Defined at 111 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">getTokenQueueSize</a>();
<a id="L443" name="L443"></a> 443 
<a id="L444" name="L444"></a> 444     m_processor.m_queueMark = (<a href="../D/27489.html" title="Multiple defined in 38 places.">mark</a> &gt; 0)
<a id="L445" name="L445"></a> 445                               ? ((<a href="../D/27489.html" title="Multiple defined in 38 places.">mark</a> &lt;= qsz) ? <a href="../D/27489.html" title="Multiple defined in 38 places.">mark</a> - 1 : <a href="../D/27489.html" title="Multiple defined in 38 places.">mark</a>) : 0;
<a id="L446" name="L446"></a> 446 
<a id="L447" name="L447"></a> 447     <strong class="reserved">if</strong> (m_processor.m_queueMark &lt; qsz)
<a id="L448" name="L448"></a> 448     <em class="brace">{</em>
<a id="L449" name="L449"></a> 449       m_processor.m_token =
<a id="L450" name="L450"></a> 450         (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>) m_compiler.<a href="../S/4996.html#L84" title="Defined at 84 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">getTokenQueue</a>().<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(m_processor.m_queueMark++);
<a id="L451" name="L451"></a> 451       m_processor.m_tokenChar = m_processor.m_token.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0);
<a id="L452" name="L452"></a> 452     <em class="brace">}</em>
<a id="L453" name="L453"></a> 453     <strong class="reserved">else</strong>
<a id="L454" name="L454"></a> 454     <em class="brace">{</em>
<a id="L455" name="L455"></a> 455       m_processor.m_token = <strong class="reserved">null</strong>;
<a id="L456" name="L456"></a> 456       m_processor.m_tokenChar = 0;
<a id="L457" name="L457"></a> 457     <em class="brace">}</em>
<a id="L458" name="L458"></a> 458   <em class="brace">}</em>
<a id="L459" name="L459"></a> 459 
<div class="comment">
    Given a string, return the corresponding keyword token.
    @param key The keyword.
    @return An opcode value.</div>
<a id="L467" name="L467"></a> 467   <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/5000.html#L504" title="Referred from 504 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">getKeywordToken</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>)
<a id="L468" name="L468"></a> 468   <em class="brace">{</em>
<a id="L469" name="L469"></a> 469 
<a id="L470" name="L470"></a> 470     <strong class="reserved">int</strong> tok;
<a id="L471" name="L471"></a> 471 
<a id="L472" name="L472"></a> 472     <strong class="reserved">try</strong>
<a id="L473" name="L473"></a> 473     <em class="brace">{</em>
<a id="L474" name="L474"></a> 474       <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a> itok = (<a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>) <a href="../S/4993.html#L31" title="Defined at 31 in src/com/sun/org/apache/xpath/internal/compiler/Keywords.java.">Keywords</a>.<a href="../S/4993.html#L281" title="Defined at 281 in src/com/sun/org/apache/xpath/internal/compiler/Keywords.java.">getKeyWord</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L475" name="L475"></a> 475 
<a id="L476" name="L476"></a> 476       tok = (<strong class="reserved">null</strong> != itok) ? itok.<a href="../D/24897.html" title="Multiple defined in 21 places.">intValue</a>() : 0;
<a id="L477" name="L477"></a> 477     <em class="brace">}</em>
<a id="L478" name="L478"></a> 478     <strong class="reserved">catch</strong> (<a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a> npe)
<a id="L479" name="L479"></a> 479     <em class="brace">{</em>
<a id="L480" name="L480"></a> 480       tok = 0;
<a id="L481" name="L481"></a> 481     <em class="brace">}</em>
<a id="L482" name="L482"></a> 482     <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> cce)
<a id="L483" name="L483"></a> 483     <em class="brace">{</em>
<a id="L484" name="L484"></a> 484       tok = 0;
<a id="L485" name="L485"></a> 485     <em class="brace">}</em>
<a id="L486" name="L486"></a> 486 
<a id="L487" name="L487"></a> 487     <strong class="reserved">return</strong> tok;
<a id="L488" name="L488"></a> 488   <em class="brace">}</em>
<a id="L489" name="L489"></a> 489 
<div class="comment">
    Record the current token in the passed vector.
    @param targetStrings Vector of string.</div>
<a id="L495" name="L495"></a> 495   <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25665.html" title="Multiple referred from 2 places.">recordTokenString</a>(<a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a> targetStrings)
<a id="L496" name="L496"></a> 496   <em class="brace">{</em>
<a id="L497" name="L497"></a> 497 
<a id="L498" name="L498"></a> 498     <strong class="reserved">int</strong> tokPos = <a href="../S/5000.html#L426" title="Defined at 426 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">getTokenQueuePosFromMap</a>(m_patternMapSize - 1);
<a id="L499" name="L499"></a> 499 
<a id="L500" name="L500"></a> 500     <a href="../S/5000.html#L439" title="Defined at 439 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">resetTokenMark</a>(tokPos + 1);
<a id="L501" name="L501"></a> 501 
<a id="L502" name="L502"></a> 502     <strong class="reserved">if</strong> (m_processor.<a href="../D/27091.html" title="Multiple defined in 2 places.">lookahead</a>('(', 1))
<a id="L503" name="L503"></a> 503     <em class="brace">{</em>
<a id="L504" name="L504"></a> 504       <strong class="reserved">int</strong> tok = <a href="../S/5000.html#L467" title="Defined at 467 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">getKeywordToken</a>(m_processor.m_token);
<a id="L505" name="L505"></a> 505 
<a id="L506" name="L506"></a> 506       <strong class="reserved">switch</strong> (tok)
<a id="L507" name="L507"></a> 507       <em class="brace">{</em>
<a id="L508" name="L508"></a> 508       <strong class="reserved">case</strong> <a href="../S/5001.html#L43" title="Defined at 43 in src/com/sun/org/apache/xpath/internal/compiler/OpCodes.java.">OpCodes</a>.NODETYPE_COMMENT :
<a id="L509" name="L509"></a> 509         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_COMMENT);
<a id="L510" name="L510"></a> 510         <strong class="reserved">break</strong>;
<a id="L511" name="L511"></a> 511       <strong class="reserved">case</strong> <a href="../S/5001.html#L43" title="Defined at 43 in src/com/sun/org/apache/xpath/internal/compiler/OpCodes.java.">OpCodes</a>.NODETYPE_TEXT :
<a id="L512" name="L512"></a> 512         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_TEXT);
<a id="L513" name="L513"></a> 513         <strong class="reserved">break</strong>;
<a id="L514" name="L514"></a> 514       <strong class="reserved">case</strong> <a href="../S/5001.html#L43" title="Defined at 43 in src/com/sun/org/apache/xpath/internal/compiler/OpCodes.java.">OpCodes</a>.NODETYPE_NODE :
<a id="L515" name="L515"></a> 515         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_ANY);
<a id="L516" name="L516"></a> 516         <strong class="reserved">break</strong>;
<a id="L517" name="L517"></a> 517       <strong class="reserved">case</strong> <a href="../S/5001.html#L43" title="Defined at 43 in src/com/sun/org/apache/xpath/internal/compiler/OpCodes.java.">OpCodes</a>.NODETYPE_ROOT :
<a id="L518" name="L518"></a> 518         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_ROOT);
<a id="L519" name="L519"></a> 519         <strong class="reserved">break</strong>;
<a id="L520" name="L520"></a> 520       <strong class="reserved">case</strong> <a href="../S/5001.html#L43" title="Defined at 43 in src/com/sun/org/apache/xpath/internal/compiler/OpCodes.java.">OpCodes</a>.NODETYPE_ANYELEMENT :
<a id="L521" name="L521"></a> 521         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_ANY);
<a id="L522" name="L522"></a> 522         <strong class="reserved">break</strong>;
<a id="L523" name="L523"></a> 523       <strong class="reserved">case</strong> <a href="../S/5001.html#L43" title="Defined at 43 in src/com/sun/org/apache/xpath/internal/compiler/OpCodes.java.">OpCodes</a>.NODETYPE_PI :
<a id="L524" name="L524"></a> 524         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_ANY);
<a id="L525" name="L525"></a> 525         <strong class="reserved">break</strong>;
<a id="L526" name="L526"></a> 526       <strong class="reserved">default</strong> :
<a id="L527" name="L527"></a> 527         targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<a href="../S/5002.html#L29" title="Defined at 29 in src/com/sun/org/apache/xpath/internal/compiler/PsuedoNames.java.">PsuedoNames</a>.PSEUDONAME_ANY);
<a id="L528" name="L528"></a> 528       <em class="brace">}</em>
<a id="L529" name="L529"></a> 529     <em class="brace">}</em>
<a id="L530" name="L530"></a> 530     <strong class="reserved">else</strong>
<a id="L531" name="L531"></a> 531     <em class="brace">{</em>
<a id="L532" name="L532"></a> 532       <strong class="reserved">if</strong> (m_processor.<a href="../D/35548.html" title="Multiple defined in 2 places.">tokenIs</a>('@'))
<a id="L533" name="L533"></a> 533       <em class="brace">{</em>
<a id="L534" name="L534"></a> 534         tokPos++;
<a id="L535" name="L535"></a> 535 
<a id="L536" name="L536"></a> 536         <a href="../S/5000.html#L439" title="Defined at 439 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">resetTokenMark</a>(tokPos + 1);
<a id="L537" name="L537"></a> 537       <em class="brace">}</em>
<a id="L538" name="L538"></a> 538 
<a id="L539" name="L539"></a> 539       <strong class="reserved">if</strong> (m_processor.<a href="../D/27091.html" title="Multiple defined in 2 places.">lookahead</a>(':', 1))
<a id="L540" name="L540"></a> 540       <em class="brace">{</em>
<a id="L541" name="L541"></a> 541         tokPos += 2;
<a id="L542" name="L542"></a> 542       <em class="brace">}</em>
<a id="L543" name="L543"></a> 543 
<a id="L544" name="L544"></a> 544       targetStrings.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(m_compiler.<a href="../S/4996.html#L84" title="Defined at 84 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">getTokenQueue</a>().<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(tokPos));
<a id="L545" name="L545"></a> 545     <em class="brace">}</em>
<a id="L546" name="L546"></a> 546   <em class="brace">}</em>
<a id="L547" name="L547"></a> 547 
<div class="comment">
    Add a token to the token queue.
    @param s The token.</div>
<a id="L554" name="L554"></a> 554   <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10008.html" title="Multiple referred from 15 places.">addToTokenQueue</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> s)
<a id="L555" name="L555"></a> 555   <em class="brace">{</em>
<a id="L556" name="L556"></a> 556     m_compiler.<a href="../S/4996.html#L84" title="Defined at 84 in src/com/sun/org/apache/xpath/internal/compiler/OpMap.java.">getTokenQueue</a>().<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(s);
<a id="L557" name="L557"></a> 557   <em class="brace">}</em>
<a id="L558" name="L558"></a> 558 
<div class="comment">
    When a seperator token is found, see if there's a element name or
    the like to map.
    @param pat The XPath name string.
    @param startSubstring The start of the name string.
    @param posOfNSSep The position of the namespace seperator (':').
    @param posOfScan The end of the name index.
    @throws javax.xml.transform.TransformerException
    @return -1 always.</div>
<a id="L572" name="L572"></a> 572   <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/23056.html" title="Multiple referred from 5 places.">mapNSTokens</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pat, <strong class="reserved">int</strong> startSubstring, <strong class="reserved">int</strong> posOfNSSep,
<a id="L573" name="L573"></a> 573                           <strong class="reserved">int</strong> posOfScan)
<a id="L574" name="L574"></a> 574            <strong class="reserved">throws</strong> <a href="../D/26637.html" title="Multiple defined in 6 places.">javax</a>.xml.<a href="../D/35592.html" title="Multiple defined in 22 places.">transform</a>.<a href="../S/4051.html#L35" title="Defined at 35 in src/javax/xml/transform/TransformerException.java.">TransformerException</a>
<a id="L575" name="L575"></a> 575  <em class="brace">{</em>
<a id="L576" name="L576"></a> 576 
<a id="L577" name="L577"></a> 577     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a> = "";
<a id="L578" name="L578"></a> 578 
<a id="L579" name="L579"></a> 579     <strong class="reserved">if</strong> ((startSubstring &gt;= 0) &amp;&amp; (posOfNSSep &gt;= 0))
<a id="L580" name="L580"></a> 580     <em class="brace">{</em>
<a id="L581" name="L581"></a> 581        <a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a> = pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(startSubstring, posOfNSSep);
<a id="L582" name="L582"></a> 582     <em class="brace">}</em>
<a id="L583" name="L583"></a> 583     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> uName;
<a id="L584" name="L584"></a> 584 
<a id="L585" name="L585"></a> 585     <strong class="reserved">if</strong> ((<strong class="reserved">null</strong> != m_namespaceContext) &amp;&amp;!<a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("*")
<a id="L586" name="L586"></a> 586             &amp;&amp;!<a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("xmlns"))
<a id="L587" name="L587"></a> 587     <em class="brace">{</em>
<a id="L588" name="L588"></a> 588       <strong class="reserved">try</strong>
<a id="L589" name="L589"></a> 589       <em class="brace">{</em>
<a id="L590" name="L590"></a> 590         <strong class="reserved">if</strong> (<a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 0)
<a id="L591" name="L591"></a> 591           uName = ((<a href="../S/5879.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/utils/PrefixResolver.java.">PrefixResolver</a>) m_namespaceContext).<a href="../D/20813.html" title="Multiple defined in 9 places.">getNamespaceForPrefix</a>(
<a id="L592" name="L592"></a> 592             <a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>);
<a id="L593" name="L593"></a> 593         <strong class="reserved">else</strong>
<a id="L594" name="L594"></a> 594         <em class="brace">{</em>
<a id="L595" name="L595"></a> 595 
<a id="L596" name="L596"></a> 596           <em class="comment">// Assume last was wildcard. This is not legal according</em>
<a id="L597" name="L597"></a> 597           <em class="comment">// to the draft. Set the below to true to make namespace</em>
<a id="L598" name="L598"></a> 598           <em class="comment">// wildcards work.</em>
<a id="L599" name="L599"></a> 599           <strong class="reserved">if</strong> (<strong class="reserved">false</strong>)
<a id="L600" name="L600"></a> 600           <em class="brace">{</em>
<a id="L601" name="L601"></a> 601             <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(":");
<a id="L602" name="L602"></a> 602 
<a id="L603" name="L603"></a> 603             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> s = pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(posOfNSSep + 1, posOfScan);
<a id="L604" name="L604"></a> 604 
<a id="L605" name="L605"></a> 605             <strong class="reserved">if</strong> (s.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 0)
<a id="L606" name="L606"></a> 606               <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(s);
<a id="L607" name="L607"></a> 607 
<a id="L608" name="L608"></a> 608             <strong class="reserved">return</strong> -1;
<a id="L609" name="L609"></a> 609           <em class="brace">}</em>
<a id="L610" name="L610"></a> 610           <strong class="reserved">else</strong>
<a id="L611" name="L611"></a> 611           <em class="brace">{</em>
<a id="L612" name="L612"></a> 612             uName =
<a id="L613" name="L613"></a> 613               ((<a href="../S/5879.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/utils/PrefixResolver.java.">PrefixResolver</a>) m_namespaceContext).<a href="../D/20813.html" title="Multiple defined in 9 places.">getNamespaceForPrefix</a>(
<a id="L614" name="L614"></a> 614                 <a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>);
<a id="L615" name="L615"></a> 615           <em class="brace">}</em>
<a id="L616" name="L616"></a> 616         <em class="brace">}</em>
<a id="L617" name="L617"></a> 617       <em class="brace">}</em>
<a id="L618" name="L618"></a> 618       <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> cce)
<a id="L619" name="L619"></a> 619       <em class="brace">{</em>
<a id="L620" name="L620"></a> 620         uName = m_namespaceContext.<a href="../D/20813.html" title="Multiple defined in 9 places.">getNamespaceForPrefix</a>(<a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>);
<a id="L621" name="L621"></a> 621       <em class="brace">}</em>
<a id="L622" name="L622"></a> 622     <em class="brace">}</em>
<a id="L623" name="L623"></a> 623     <strong class="reserved">else</strong>
<a id="L624" name="L624"></a> 624     <em class="brace">{</em>
<a id="L625" name="L625"></a> 625       uName = <a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a>;
<a id="L626" name="L626"></a> 626     <em class="brace">}</em>
<a id="L627" name="L627"></a> 627 
<a id="L628" name="L628"></a> 628     <strong class="reserved">if</strong> ((<strong class="reserved">null</strong> != uName) &amp;&amp; (uName.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 0))
<a id="L629" name="L629"></a> 629     <em class="brace">{</em>
<a id="L630" name="L630"></a> 630       <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(uName);
<a id="L631" name="L631"></a> 631       <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(":");
<a id="L632" name="L632"></a> 632 
<a id="L633" name="L633"></a> 633       <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> s = pat.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(posOfNSSep + 1, posOfScan);
<a id="L634" name="L634"></a> 634 
<a id="L635" name="L635"></a> 635       <strong class="reserved">if</strong> (s.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 0)
<a id="L636" name="L636"></a> 636         <a href="../S/5000.html#L554" title="Defined at 554 in src/com/sun/org/apache/xpath/internal/compiler/Lexer.java.">addToTokenQueue</a>(s);
<a id="L637" name="L637"></a> 637     <em class="brace">}</em>
<a id="L638" name="L638"></a> 638     <strong class="reserved">else</strong>
<a id="L639" name="L639"></a> 639     <em class="brace">{</em>
<a id="L640" name="L640"></a> 640         <em class="comment">// To older XPath code it doesn't matter if</em>
<a id="L641" name="L641"></a> 641         <em class="comment">// error() is called or errorForDOM3().</em>
<a id="L642" name="L642"></a> 642                 m_processor.<a href="../S/4999.html#L651" title="Defined at 651 in src/com/sun/org/apache/xpath/internal/compiler/XPathParser.java.">errorForDOM3</a>(<a href="../S/4836.html#L34" title="Defined at 34 in src/com/sun/org/apache/xpath/internal/res/XPATHErrorResources.java.">XPATHErrorResources</a>.ER_PREFIX_MUST_RESOLVE,
<a id="L643" name="L643"></a> 643                                                  <strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] <em class="brace">{</em><a href="../S/3963.html#L53" title="Defined at 53 in src/javax/xml/bind/annotation/XmlNs.java.">prefix</a><em class="brace">}</em>);  <em class="comment">//"Prefix must resolve to a namespace: {0}";</em>
<a id="L644" name="L644"></a> 644 
<div class="comment">
 old code commented out 17-Sep-2004
// error("Could not locate namespace for prefix: "+prefix);
//                m_processor.error(XPATHErrorResources.ER_PREFIX_MUST_RESOLVE,
//                                       new String[] {prefix});  //"Prefix must resolve to a namespace: {0}";</div>
<a id="L650" name="L650"></a> 650 
<div class="comment">
*  Old code commented out 10-Jan-2001
      addToTokenQueue(prefix);
      addToTokenQueue(":");
      String s = pat.substring(posOfNSSep + 1, posOfScan);
      if (s.length() &gt; 0)
        addToTokenQueue(s);
      **</div>
<a id="L660" name="L660"></a> 660     <em class="brace">}</em>
<a id="L661" name="L661"></a> 661 
<a id="L662" name="L662"></a> 662     <strong class="reserved">return</strong> -1;
<a id="L663" name="L663"></a> 663   <em class="brace">}</em>
<a id="L664" name="L664"></a> 664 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L98">[^]</a><a href="#L572">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>