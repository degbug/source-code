<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L483">[^]</a><a href="#L2310">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L483" title="Defined at 483.">isShared</a></li>
<li><a href="#L494" title="Defined at 494.">predecessor</a></li>
<li><a href="#L540" title="Defined at 540.">getState</a></li>
<li><a href="#L549" title="Defined at 549.">setState</a></li>
<li><a href="#L564" title="Defined at 564.">compareAndSetState</a></li>
<li><a href="#L583" title="Defined at 583.">enq</a></li>
<li><a href="#L605" title="Defined at 605.">addWaiter</a></li>
<li><a href="#L627" title="Defined at 627.">setHead</a></li>
<li><a href="#L638" title="Defined at 638.">unparkSuccessor</a></li>
<li><a href="#L670" title="Defined at 670.">doReleaseShared</a></li>
<li><a href="#L708" title="Defined at 708.">setHeadAndPropagate</a></li>
<li><a href="#L742" title="Defined at 742.">cancelAcquire</a></li>
<li><a href="#L795" title="Defined at 795.">shouldParkAfterFailedAcquire</a></li>
<li><a href="#L826" title="Defined at 826.">selfInterrupt</a></li>
<li><a href="#L835" title="Defined at 835.">parkAndCheckInterrupt</a></li>
<li><a href="#L857" title="Defined at 857.">acquireQueued</a></li>
<li><a href="#L883" title="Defined at 883.">doAcquireInterruptibly</a></li>
<li><a href="#L913" title="Defined at 913.">doAcquireNanos</a></li>
<li><a href="#L948" title="Defined at 948.">doAcquireShared</a></li>
<li><a href="#L980" title="Defined at 980.">doAcquireSharedInterruptibly</a></li>
<li><a href="#L1013" title="Defined at 1013.">doAcquireSharedNanos</a></li>
<li><a href="#L1075" title="Defined at 1075.">tryAcquire</a></li>
<li><a href="#L1101" title="Defined at 1101.">tryRelease</a></li>
<li><a href="#L1137" title="Defined at 1137.">tryAcquireShared</a></li>
<li><a href="#L1162" title="Defined at 1162.">tryReleaseShared</a></li>
<li><a href="#L1181" title="Defined at 1181.">isHeldExclusively</a></li>
<li><a href="#L1197" title="Defined at 1197.">acquire</a></li>
<li><a href="#L1217" title="Defined at 1217.">acquireInterruptibly</a></li>
<li><a href="#L1242" title="Defined at 1242.">tryAcquireNanos</a></li>
<li><a href="#L1260" title="Defined at 1260.">release</a></li>
<li><a href="#L1281" title="Defined at 1281.">acquireShared</a></li>
<li><a href="#L1299" title="Defined at 1299.">acquireSharedInterruptibly</a></li>
<li><a href="#L1323" title="Defined at 1323.">tryAcquireSharedNanos</a></li>
<li><a href="#L1340" title="Defined at 1340.">releaseShared</a></li>
<li><a href="#L1361" title="Defined at 1361.">hasQueuedThreads</a></li>
<li><a href="#L1374" title="Defined at 1374.">hasContended</a></li>
<li><a href="#L1389" title="Defined at 1389.">getFirstQueuedThread</a></li>
<li><a href="#L1397" title="Defined at 1397.">fullGetFirstQueuedThread</a></li>
<li><a href="#L1443" title="Defined at 1443.">isQueued</a></li>
<li><a href="#L1461" title="Defined at 1461.">apparentlyFirstQueuedIsExclusive</a></li>
<li><a href="#L1512" title="Defined at 1512.">hasQueuedPredecessors</a></li>
<li><a href="#L1536" title="Defined at 1536.">getQueueLength</a></li>
<li><a href="#L1556" title="Defined at 1556.">getQueuedThreads</a></li>
<li><a href="#L1574" title="Defined at 1574.">getExclusiveQueuedThreads</a></li>
<li><a href="#L1594" title="Defined at 1594.">getSharedQueuedThreads</a></li>
<li><a href="#L1615" title="Defined at 1615.">toString</a></li>
<li><a href="#L1631" title="Defined at 1631.">isOnSyncQueue</a></li>
<li><a href="#L1652" title="Defined at 1652.">findNodeFromTail</a></li>
<li><a href="#L1670" title="Defined at 1670.">transferForSignal</a></li>
<li><a href="#L1697" title="Defined at 1697.">transferAfterCancelledWait</a></li>
<li><a href="#L1719" title="Defined at 1719.">fullyRelease</a></li>
<li><a href="#L1745" title="Defined at 1745.">owns</a></li>
<li><a href="#L1765" title="Defined at 1765.">hasWaiters</a></li>
<li><a href="#L1787" title="Defined at 1787.">getWaitQueueLength</a></li>
<li><a href="#L1809" title="Defined at 1809.">getWaitingThreads</a></li>
<li><a href="#L1848" title="Defined at 1848.">addConditionWaiter</a></li>
<li><a href="#L1870" title="Defined at 1870.">doSignal</a></li>
<li><a href="#L1883" title="Defined at 1883.">doSignalAll</a></li>
<li><a href="#L1907" title="Defined at 1907.">unlinkCancelledWaiters</a></li>
<li><a href="#L1937" title="Defined at 1937.">signal</a></li>
<li><a href="#L1952" title="Defined at 1952.">signalAll</a></li>
<li><a href="#L1971" title="Defined at 1971.">awaitUninterruptibly</a></li>
<li><a href="#L2001" title="Defined at 2001.">checkInterruptWhileWaiting</a></li>
<li><a href="#L2011" title="Defined at 2011.">reportInterruptAfterWait</a></li>
<li><a href="#L2032" title="Defined at 2032.">await</a></li>
<li><a href="#L2064" title="Defined at 2064.">awaitNanos</a></li>
<li><a href="#L2106" title="Defined at 2106.">awaitUntil</a></li>
<li><a href="#L2147" title="Defined at 2147.">await</a></li>
<li><a href="#L2185" title="Defined at 2185.">isOwnedBy</a></li>
<li><a href="#L2197" title="Defined at 2197.">hasWaiters</a></li>
<li><a href="#L2216" title="Defined at 2216.">getWaitQueueLength</a></li>
<li><a href="#L2236" title="Defined at 2236.">getWaitingThreads</a></li>
<li><a href="#L2286" title="Defined at 2286.">compareAndSetHead</a></li>
<li><a href="#L2293" title="Defined at 2293.">compareAndSetTail</a></li>
<li><a href="#L2300" title="Defined at 2300.">compareAndSetWaitStatus</a></li>
<li><a href="#L2310" title="Defined at 2310.">compareAndSetNext</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent.locks;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.concurrent.TimeUnit;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.Collection;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.util.Date;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> sun.misc.Unsafe;
<a id="L42" name="L42"></a>  42 
<div class="comment">
  Provides a framework for implementing blocking locks and related
  synchronizers (semaphores, events, etc) that rely on
  first-in-first-out (FIFO) wait queues.  This class is designed to
  be a useful basis for most kinds of synchronizers that rely on a
  single atomic <code>int</code> value to represent state. Subclasses
  must define the protected methods that change this state, and which
  define what that state means in terms of this object being acquired
  or released.  Given these, the other methods in this class carry
  out all queuing and blocking mechanics. Subclasses can maintain
  other state fields, but only the atomically updated <code>int</code>
  value manipulated using methods <a href="#L540" title="Defined at 540.">getState</a>, {@link
  #setState} and <a href="#L564" title="Defined at 564.">compareAndSetState</a> is tracked with respect
  to synchronization.
  <p>Subclasses should be defined as non-public internal helper
  classes that are used to implement the synchronization properties
  of their enclosing class.  Class
  <code>AbstractQueuedSynchronizer</code> does not implement any
  synchronization interface.  Instead it defines methods such as
  <a href="#L1217" title="Defined at 1217.">acquireInterruptibly</a> that can be invoked as
  appropriate by concrete locks and related synchronizers to
  implement their public methods.
  </p><p>This class supports either or both a default <em>exclusive</em>
  mode and a <em>shared</em> mode. When acquired in exclusive mode,
  attempted acquires by other threads cannot succeed. Shared mode
  acquires by multiple threads may (but need not) succeed. This class
  does not "understand" these differences except in the
  mechanical sense that when a shared mode acquire succeeds, the next
  waiting thread (if one exists) must also determine whether it can
  acquire as well. Threads waiting in the different modes share the
  same FIFO queue. Usually, implementation subclasses support only
  one of these modes, but both can come into play for example in a
  {@link ReadWriteLock}. Subclasses that support only exclusive or
  only shared modes need not define the methods supporting the unused mode.
  </p><p>This class defines a nested <a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> class that
  can be used as a <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> implementation by subclasses
  supporting exclusive mode for which method {@link
  #isHeldExclusively} reports whether synchronization is exclusively
  held with respect to the current thread, method <a href="#L1260" title="Defined at 1260.">release</a>
  invoked with the current <a href="#L540" title="Defined at 540.">getState</a> value fully releases
  this object, and <a href="#L1197" title="Defined at 1197.">acquire</a>, given this saved state value,
  eventually restores this object to its previous acquired state.  No
  <code>AbstractQueuedSynchronizer</code> method otherwise creates such a
  condition, so if this constraint cannot be met, do not use it.  The
  behavior of <a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> depends of course on the
  semantics of its synchronizer implementation.
  </p><p>This class provides inspection, instrumentation, and monitoring
  methods for the internal queue, as well as similar methods for
  condition objects. These can be exported as desired into classes
  using an <code>AbstractQueuedSynchronizer</code> for their
  synchronization mechanics.
  </p><p>Serialization of this class stores only the underlying atomic
  integer maintaining state, so deserialized objects have empty
  thread queues. Typical subclasses requiring serializability will
  define a <code>readObject</code> method that restores this to a known
  initial state upon deserialization.
  </p><h3>Usage</h3>
  <p>To use this class as the basis of a synchronizer, redefine the
  following methods, as applicable, by inspecting and/or modifying
  the synchronization state using <a href="#L540" title="Defined at 540.">getState</a>, {@link
  #setState} and/or <a href="#L564" title="Defined at 564.">compareAndSetState</a>:
  </p><ul><li> <a href="#L1075" title="Defined at 1075.">tryAcquire</a>
  </li><li> <a href="#L1101" title="Defined at 1101.">tryRelease</a>
  </li><li> <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a>
  </li><li> <a href="#L1162" title="Defined at 1162.">tryReleaseShared</a>
  </li><li> <a href="#L1181" title="Defined at 1181.">isHeldExclusively</a>
  </li></ul>
  Each of these methods by default throws {@link
  UnsupportedOperationException}.  Implementations of these methods
  must be internally thread-safe, and should in general be short and
  not block. Defining these methods is the <em>only</em> supported
  means of using this class. All other methods are declared
  <code>final</code> because they cannot be independently varied.
  <p>You may also find the inherited methods from {@link
  AbstractOwnableSynchronizer} useful to keep track of the thread
  owning an exclusive synchronizer.  You are encouraged to use them
  -- this enables monitoring and diagnostic tools to assist users in
  determining which threads hold locks.
  </p><p>Even though this class is based on an internal FIFO queue, it
  does not automatically enforce FIFO acquisition policies.  The core
  of exclusive synchronization takes the form:
  </p><pre>  Acquire:
      while (!tryAcquire(arg)) {
         <em>enqueue thread if it is not already queued</em>;
         <em>possibly block current thread</em>;
      }
  Release:
      if (tryRelease(arg))
         <em>unblock the first queued thread</em>;
  </pre>
  (Shared mode is similar but may involve cascading signals.)
  <p id="barging">Because checks in acquire are invoked before
  enqueuing, a newly acquiring thread may <em>barge</em> ahead of
  others that are blocked and queued.  However, you can, if desired,
  define <code>tryAcquire</code> and/or <code>tryAcquireShared</code> to
  disable barging by internally invoking one or more of the inspection
  methods, thereby providing a <em>fair</em> FIFO acquisition order.
  In particular, most fair synchronizers can define <code>tryAcquire</code>
  to return <code>false</code> if <a href="#L1512" title="Defined at 1512.">hasQueuedPredecessors</a> (a method
  specifically designed to be used by fair synchronizers) returns
  <code>true</code>.  Other variations are possible.
  </p><p>Throughput and scalability are generally highest for the
  default barging (also known as <em>greedy</em>,
  <em>renouncement</em>, and <em>convoy-avoidance</em>) strategy.
  While this is not guaranteed to be fair or starvation-free, earlier
  queued threads are allowed to recontend before later queued
  threads, and each recontention has an unbiased chance to succeed
  against incoming threads.  Also, while acquires do not
  "spin" in the usual sense, they may perform multiple
  invocations of <code>tryAcquire</code> interspersed with other
  computations before blocking.  This gives most of the benefits of
  spins when exclusive synchronization is only briefly held, without
  most of the liabilities when it isn't. If so desired, you can
  augment this by preceding calls to acquire methods with
  "fast-path" checks, possibly prechecking <a href="#L1374" title="Defined at 1374.">hasContended</a>
  and/or <a href="#L1361" title="Defined at 1361.">hasQueuedThreads</a> to only do so if the synchronizer
  is likely not to be contended.
  </p><p>This class provides an efficient and scalable basis for
  synchronization in part by specializing its range of use to
  synchronizers that can rely on <code>int</code> state, acquire, and
  release parameters, and an internal FIFO wait queue. When this does
  not suffice, you can build synchronizers from a lower level using
  {@link java.util.concurrent.atomic atomic} classes, your own custom
  {@link java.util.Queue} classes, and <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a> blocking
  support.
  </p><h3>Usage Examples</h3>
  <p>Here is a non-reentrant mutual exclusion lock class that uses
  the value zero to represent the unlocked state, and one to
  represent the locked state. While a non-reentrant lock
  does not strictly require recording of the current owner
  thread, this class does so anyway to make usage easier to monitor.
  It also supports conditions and exposes
  one of the instrumentation methods:
   </p><pre> {@code
  class Mutex implements Lock, java.io.Serializable {
    // Our internal helper class
    private static class Sync extends AbstractQueuedSynchronizer {
      // Reports whether in locked state
      protected boolean isHeldExclusively() {
        return getState() == 1;
      }
      // Acquires the lock if state is zero
      public boolean tryAcquire(int acquires) {
        assert acquires == 1; // Otherwise unused
        if (compareAndSetState(0, 1)) {
          setExclusiveOwnerThread(Thread.currentThread());
          return true;
        }
        return false;
      }
      // Releases the lock by setting state to zero
      protected boolean tryRelease(int releases) {
        assert releases == 1; // Otherwise unused
        if (getState() == 0) throw new IllegalMonitorStateException();
        setExclusiveOwnerThread(null);
        setState(0);
        return true;
      }
      // Provides a Condition
      Condition newCondition() { return new ConditionObject(); }
      // Deserializes properly
      private void readObject(ObjectInputStream s)
          throws IOException, ClassNotFoundException {
        s.defaultReadObject();
        setState(0); // reset to unlocked state
      }
    }
    // The sync object does all the hard work. We just forward to it.
    private final Sync sync = new Sync();
    public void lock()                { sync.acquire(1); }
    public boolean tryLock()          { return sync.tryAcquire(1); }
    public void unlock()              { sync.release(1); }
    public Condition newCondition()   { return sync.newCondition(); }
    public boolean isLocked()         { return sync.isHeldExclusively(); }
    public boolean hasQueuedThreads() { return sync.hasQueuedThreads(); }
    public void lockInterruptibly() throws InterruptedException {
      sync.acquireInterruptibly(1);
    }
    public boolean tryLock(long timeout, TimeUnit unit)
        throws InterruptedException {
      return sync.tryAcquireNanos(1, unit.toNanos(timeout));
    }
  }}</pre>
  <p>Here is a latch class that is like a
  {@link java.util.concurrent.CountDownLatch CountDownLatch}
  except that it only requires a single <code>signal</code> to
  fire. Because a latch is non-exclusive, it uses the <code>shared</code>
  acquire and release methods.
   </p><pre> {@code
  class BooleanLatch {
    private static class Sync extends AbstractQueuedSynchronizer {
      boolean isSignalled() { return getState() != 0; }
      protected int tryAcquireShared(int ignore) {
        return isSignalled() ? 1 : -1;
      }
      protected boolean tryReleaseShared(int ignore) {
        setState(1);
        return true;
      }
    }
    private final Sync sync = new Sync();
    public boolean isSignalled() { return sync.isSignalled(); }
    public void signal()         { sync.releaseShared(1); }
    public void await() throws InterruptedException {
      sync.acquireSharedInterruptibly(1);
    }
  }}</pre>
  @since 1.5
  @author Doug Lea</div>
<a id="L289" name="L289"></a> 289 <strong class="reserved">public</strong> <strong class="reserved">abstract</strong> <strong class="reserved">class</strong> <a href="../R/105.html" title="Multiple referred from 25 places.">AbstractQueuedSynchronizer</a>
<a id="L290" name="L290"></a> 290     <strong class="reserved">extends</strong> <a href="../S/1048.html#L50" title="Defined at 50 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">AbstractOwnableSynchronizer</a>
<a id="L291" name="L291"></a> 291     <strong class="reserved">implements</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L292" name="L292"></a> 292 
<a id="L293" name="L293"></a> 293     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 7373984972572414691L;
<a id="L294" name="L294"></a> 294 
<div class="comment">
      Creates a new <code>AbstractQueuedSynchronizer</code> instance
      with initial synchronization state of zero.</div>
<a id="L299" name="L299"></a> 299     <strong class="reserved">protected</strong> AbstractQueuedSynchronizer() <em class="brace">{</em> <em class="brace">}</em>
<a id="L300" name="L300"></a> 300 
<div class="comment">
      Wait queue node class.
      <p>The wait queue is a variant of a "CLH" (Craig, Landin, and
      Hagersten) lock queue. CLH locks are normally used for
      spinlocks.  We instead use them for blocking synchronizers, but
      use the same basic tactic of holding some of the control
      information about a thread in the predecessor of its node.  A
      "status" field in each node keeps track of whether a thread
      should block.  A node is signalled when its predecessor
      releases.  Each node of the queue otherwise serves as a
      specific-notification-style monitor holding a single waiting
      thread. The status field does NOT control whether threads are
      granted locks etc though.  A thread may try to acquire if it is
      first in the queue. But being first does not guarantee success;
      it only gives the right to contend.  So the currently released
      contender thread may need to rewait.
      </p><p>To enqueue into a CLH lock, you atomically splice it in as new
      tail. To dequeue, you just set the head field.
      </p><pre>           +------+  prev +-----+       +-----+
      head |      | &lt;---- |     | &lt;---- |     |  tail
           +------+       +-----+       +-----+
      </pre>
      <p>Insertion into a CLH queue requires only a single atomic
      operation on "tail", so there is a simple atomic point of
      demarcation from unqueued to queued. Similarly, dequeuing
      involves only updating the "head". However, it takes a bit
      more work for nodes to determine who their successors are,
      in part to deal with possible cancellation due to timeouts
      and interrupts.
      </p><p>The "prev" links (not used in original CLH locks), are mainly
      needed to handle cancellation. If a node is cancelled, its
      successor is (normally) relinked to a non-cancelled
      predecessor. For explanation of similar mechanics in the case
      of spin locks, see the papers by Scott and Scherer at
      http://www.cs.rochester.edu/u/scott/synchronization/
      </p><p>We also use "next" links to implement blocking mechanics.
      The thread id for each node is kept in its own node, so a
      predecessor signals the next node to wake up by traversing
      next link to determine which thread it is.  Determination of
      successor must avoid races with newly queued nodes to set
      the "next" fields of their predecessors.  This is solved
      when necessary by checking backwards from the atomically
      updated "tail" when a node's successor appears to be null.
      (Or, said differently, the next-links are an optimization
      so that we don't usually need a backward scan.)
      </p><p>Cancellation introduces some conservatism to the basic
      algorithms.  Since we must poll for cancellation of other
      nodes, we can miss noticing whether a cancelled node is
      ahead or behind us. This is dealt with by always unparking
      successors upon cancellation, allowing them to stabilize on
      a new predecessor, unless we can identify an uncancelled
      predecessor who will carry this responsibility.
      </p><p>CLH queues need a dummy header node to get started. But
      we don't create them on construction, because it would be wasted
      effort if there is never contention. Instead, the node
      is constructed and head and tail pointers are set upon first
      contention.
      </p><p>Threads waiting on Conditions use the same nodes, but
      use an additional link. Conditions only need to link nodes
      in simple (non-concurrent) linked queues because they are
      only accessed when exclusively held.  Upon await, a node is
      inserted into a condition queue.  Upon signal, the node is
      transferred to the main queue.  A special value of status
      field is used to mark which queue a node is on.
      </p><p>Thanks go to Dave Dice, Mark Moir, Victor Luchangco, Bill
      Scherer and Michael Scott, along with members of JSR-166
      expert group, for helpful ideas, discussions, and critiques
      on the design of this class.</p></div>
<a id="L380" name="L380"></a> 380     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5542.html" title="Multiple referred from 4060 places.">Node</a> <em class="brace">{</em>
<div class="comment">
         /** Marker to indicate a node is waiting in shared mode */</div>
<a id="L382" name="L382"></a> 382         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> SHARED = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>();
<div class="comment">
         /** Marker to indicate a node is waiting in exclusive mode */</div>
<a id="L384" name="L384"></a> 384         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> EXCLUSIVE = <strong class="reserved">null</strong>;
<a id="L385" name="L385"></a> 385 
<div class="comment">
         /** waitStatus value to indicate thread has cancelled */</div>
<a id="L387" name="L387"></a> 387         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CANCELLED =  1;
<div class="comment">
         /** waitStatus value to indicate successor's thread needs unparking */</div>
<a id="L389" name="L389"></a> 389         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SIGNAL    = -1;
<div class="comment">
         /** waitStatus value to indicate thread is waiting on condition */</div>
<a id="L391" name="L391"></a> 391         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CONDITION = -2;
<div class="comment">
          waitStatus value to indicate the next acquireShared should
          unconditionally propagate</div>
<a id="L396" name="L396"></a> 396         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> PROPAGATE = -3;
<a id="L397" name="L397"></a> 397 
<div class="comment">
          Status field, taking on only the values:
            SIGNAL:     The successor of this node is (or will soon be)
                        blocked (via park), so the current node must
                        unpark its successor when it releases or
                        cancels. To avoid races, acquire methods must
                        first indicate they need a signal,
                        then retry the atomic acquire, and then,
                        on failure, block.
            CANCELLED:  This node is cancelled due to timeout or interrupt.
                        Nodes never leave this state. In particular,
                        a thread with cancelled node never again blocks.
            CONDITION:  This node is currently on a condition queue.
                        It will not be used as a sync queue node
                        until transferred, at which time the status
                        will be set to 0. (Use of this value here has
                        nothing to do with the other uses of the
                        field, but simplifies mechanics.)
            PROPAGATE:  A releaseShared should be propagated to other
                        nodes. This is set (for head node only) in
                        doReleaseShared to ensure propagation
                        continues, even if other operations have
                        since intervened.
            0:          None of the above
          The values are arranged numerically to simplify use.
          Non-negative values mean that a node doesn't need to
          signal. So, most code doesn't need to check for particular
          values, just for sign.
          The field is initialized to 0 for normal sync nodes, and
          CONDITION for condition nodes.  It is modified using CAS
          (or when possible, unconditional volatile writes).</div>
<a id="L432" name="L432"></a> 432         <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> waitStatus;
<a id="L433" name="L433"></a> 433 
<div class="comment">
          Link to predecessor node that current node/thread relies on
          for checking waitStatus. Assigned during enqueuing, and nulled
          out (for sake of GC) only upon dequeuing.  Also, upon
          cancellation of a predecessor, we short-circuit while
          finding a non-cancelled one, which will always exist
          because the head node is never cancelled: A node becomes
          head only as a result of successful acquire. A
          cancelled thread never succeeds in acquiring, and a thread only
          cancels itself, not any other node.</div>
<a id="L445" name="L445"></a> 445         <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> prev;
<a id="L446" name="L446"></a> 446 
<div class="comment">
          Link to the successor node that the current node/thread
          unparks upon release. Assigned during enqueuing, adjusted
          when bypassing cancelled predecessors, and nulled out (for
          sake of GC) when dequeued.  The enq operation does not
          assign next field of a predecessor until after attachment,
          so seeing a null next field does not necessarily mean that
          node is at end of queue. However, if a next field appears
          to be null, we can scan prev's from the tail to
          double-check.  The next field of cancelled nodes is set to
          point to the node itself instead of null, to make life
          easier for isOnSyncQueue.</div>
<a id="L460" name="L460"></a> 460         <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L461" name="L461"></a> 461 
<div class="comment">
          The thread that enqueued this node.  Initialized on
          construction and nulled out after use.</div>
<a id="L466" name="L466"></a> 466         <strong class="reserved">volatile</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread;
<a id="L467" name="L467"></a> 467 
<div class="comment">
          Link to next node waiting on condition, or the special
          value SHARED.  Because condition queues are accessed only
          when holding in exclusive mode, we just need a simple
          linked queue to hold nodes while they are waiting on
          conditions. They are then transferred to the queue to
          re-acquire. And because conditions can only be exclusive,
          we save a field by using special value to indicate shared
          mode.</div>
<a id="L478" name="L478"></a> 478         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> nextWaiter;
<a id="L479" name="L479"></a> 479 
<div class="comment">
          Returns true if node is waiting in shared mode.</div>
<a id="L483" name="L483"></a> 483         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/22014.html" title="Multiple referred from 8 places.">isShared</a>() <em class="brace">{</em>
<a id="L484" name="L484"></a> 484             <strong class="reserved">return</strong> nextWaiter == SHARED;
<a id="L485" name="L485"></a> 485         <em class="brace">}</em>
<a id="L486" name="L486"></a> 486 
<div class="comment">
          Returns previous node, or throws NullPointerException if null.
          Use when predecessor cannot be null.  The null check could
          be elided, but is present to help the VM.
          @return the predecessor of this node</div>
<a id="L494" name="L494"></a> 494         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/24906.html" title="Multiple referred from 16 places.">predecessor</a>() <strong class="reserved">throws</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a> <em class="brace">{</em>
<a id="L495" name="L495"></a> 495             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = prev;
<a id="L496" name="L496"></a> 496             <strong class="reserved">if</strong> (p == <strong class="reserved">null</strong>)
<a id="L497" name="L497"></a> 497                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L498" name="L498"></a> 498             <strong class="reserved">else</strong>
<a id="L499" name="L499"></a> 499                 <strong class="reserved">return</strong> p;
<a id="L500" name="L500"></a> 500         <em class="brace">}</em>
<a id="L501" name="L501"></a> 501 
<a id="L502" name="L502"></a> 502         Node() <em class="brace">{</em>    <em class="comment">// Used to establish initial head or SHARED marker</em>
<a id="L503" name="L503"></a> 503         <em class="brace">}</em>
<a id="L504" name="L504"></a> 504 
<a id="L505" name="L505"></a> 505         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread, Node mode) <em class="brace">{</em>     <em class="comment">// Used by addWaiter</em>
<a id="L506" name="L506"></a> 506             <strong class="reserved">this</strong>.nextWaiter = mode;
<a id="L507" name="L507"></a> 507             <strong class="reserved">this</strong>.thread = thread;
<a id="L508" name="L508"></a> 508         <em class="brace">}</em>
<a id="L509" name="L509"></a> 509 
<a id="L510" name="L510"></a> 510         Node(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread, <strong class="reserved">int</strong> waitStatus) <em class="brace">{</em> <em class="comment">// Used by Condition</em>
<a id="L511" name="L511"></a> 511             <strong class="reserved">this</strong>.waitStatus = waitStatus;
<a id="L512" name="L512"></a> 512             <strong class="reserved">this</strong>.thread = thread;
<a id="L513" name="L513"></a> 513         <em class="brace">}</em>
<a id="L514" name="L514"></a> 514     <em class="brace">}</em>
<a id="L515" name="L515"></a> 515 
<div class="comment">
      Head of the wait queue, lazily initialized.  Except for
      initialization, it is modified only via method setHead.  Note:
      If head exists, its waitStatus is guaranteed not to be
      CANCELLED.</div>
<a id="L522" name="L522"></a> 522     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> head;
<a id="L523" name="L523"></a> 523 
<div class="comment">
      Tail of the wait queue, lazily initialized.  Modified only via
      method enq to add new wait node.</div>
<a id="L528" name="L528"></a> 528     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> tail;
<a id="L529" name="L529"></a> 529 
<div class="comment">
      The synchronization state.</div>
<a id="L533" name="L533"></a> 533     <strong class="reserved">private</strong> <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>;
<a id="L534" name="L534"></a> 534 
<div class="comment">
      Returns the current value of synchronization state.
      This operation has memory semantics of a <code>volatile</code> read.
      @return current state value</div>
<a id="L540" name="L540"></a> 540     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19176.html" title="Multiple referred from 92 places.">getState</a>() <em class="brace">{</em>
<a id="L541" name="L541"></a> 541         <strong class="reserved">return</strong> <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>;
<a id="L542" name="L542"></a> 542     <em class="brace">}</em>
<a id="L543" name="L543"></a> 543 
<div class="comment">
      Sets the value of synchronization state.
      This operation has memory semantics of a <code>volatile</code> write.
      @param newState the new state value</div>
<a id="L549" name="L549"></a> 549     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28224.html" title="Multiple referred from 77 places.">setState</a>(<strong class="reserved">int</strong> newState) <em class="brace">{</em>
<a id="L550" name="L550"></a> 550         <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = newState;
<a id="L551" name="L551"></a> 551     <em class="brace">}</em>
<a id="L552" name="L552"></a> 552 
<div class="comment">
      Atomically sets synchronization state to the given updated
      value if the current state value equals the expected value.
      This operation has memory semantics of a <code>volatile</code> read
      and write.
      @param expect the expected value
      @param update the new value
      @return <code>true</code> if successful. False return indicates that the actual
              value was not equal to the expected value.</div>
<a id="L564" name="L564"></a> 564     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11700.html" title="Multiple referred from 16 places.">compareAndSetState</a>(<strong class="reserved">int</strong> expect, <strong class="reserved">int</strong> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L565" name="L565"></a> 565         <em class="comment">// See below for intrinsics setup to support this</em>
<a id="L566" name="L566"></a> 566         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapInt(<strong class="reserved">this</strong>, stateOffset, expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L567" name="L567"></a> 567     <em class="brace">}</em>
<a id="L568" name="L568"></a> 568 
<a id="L569" name="L569"></a> 569     <em class="comment">// Queuing utilities</em>
<a id="L570" name="L570"></a> 570 
<div class="comment">
      The number of nanoseconds for which it is faster to spin
      rather than to use timed park. A rough estimate suffices
      to improve responsiveness with very short timeouts.</div>
<a id="L576" name="L576"></a> 576     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> spinForTimeoutThreshold = 1000L;
<a id="L577" name="L577"></a> 577 
<div class="comment">
      Inserts node into queue, initializing if necessary. See picture above.
      @param node the node to insert
      @return node's predecessor</div>
<a id="L583" name="L583"></a> 583     <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/13892.html" title="Multiple referred from 6 places.">enq</a>(<strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L584" name="L584"></a> 584         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L585" name="L585"></a> 585             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail;
<a id="L586" name="L586"></a> 586             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// Must initialize</em>
<a id="L587" name="L587"></a> 587                 <strong class="reserved">if</strong> (<a href="../D/13037.html" title="Multiple defined in 2 places.">compareAndSetHead</a>(<strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>()))
<a id="L588" name="L588"></a> 588                     tail = head;
<a id="L589" name="L589"></a> 589             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L590" name="L590"></a> 590                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = t;
<a id="L591" name="L591"></a> 591                 <strong class="reserved">if</strong> (<a href="../D/13042.html" title="Multiple defined in 2 places.">compareAndSetTail</a>(t, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L592" name="L592"></a> 592                     t.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L593" name="L593"></a> 593                     <strong class="reserved">return</strong> t;
<a id="L594" name="L594"></a> 594                 <em class="brace">}</em>
<a id="L595" name="L595"></a> 595             <em class="brace">}</em>
<a id="L596" name="L596"></a> 596         <em class="brace">}</em>
<a id="L597" name="L597"></a> 597     <em class="brace">}</em>
<a id="L598" name="L598"></a> 598 
<div class="comment">
      Creates and enqueues node for current thread and given mode.
      @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared
      @return the new node</div>
<a id="L605" name="L605"></a> 605     <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/10036.html" title="Multiple referred from 12 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> mode) <em class="brace">{</em>
<a id="L606" name="L606"></a> 606         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>(), mode);
<a id="L607" name="L607"></a> 607         <em class="comment">// Try the fast path of enq; backup to full enq on failure</em>
<a id="L608" name="L608"></a> 608         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = tail;
<a id="L609" name="L609"></a> 609         <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L610" name="L610"></a> 610             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>;
<a id="L611" name="L611"></a> 611             <strong class="reserved">if</strong> (<a href="../D/13042.html" title="Multiple defined in 2 places.">compareAndSetTail</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612                 <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L613" name="L613"></a> 613                 <strong class="reserved">return</strong> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L614" name="L614"></a> 614             <em class="brace">}</em>
<a id="L615" name="L615"></a> 615         <em class="brace">}</em>
<a id="L616" name="L616"></a> 616         <a href="../D/15581.html" title="Multiple defined in 2 places.">enq</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L617" name="L617"></a> 617         <strong class="reserved">return</strong> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L618" name="L618"></a> 618     <em class="brace">}</em>
<a id="L619" name="L619"></a> 619 
<div class="comment">
      Sets head of queue to be node, thus dequeuing. Called only by
      acquire methods.  Also nulls out unused fields for sake of GC
      and to suppress unnecessary signals and traversals.
      @param node the node</div>
<a id="L627" name="L627"></a> 627     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/27494.html" title="Multiple referred from 8 places.">setHead</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L628" name="L628"></a> 628         head = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L629" name="L629"></a> 629         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L630" name="L630"></a> 630         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <strong class="reserved">null</strong>;
<a id="L631" name="L631"></a> 631     <em class="brace">}</em>
<a id="L632" name="L632"></a> 632 
<div class="comment">
      Wakes up node's successor, if one exists.
      @param node the node</div>
<a id="L638" name="L638"></a> 638     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/29742.html" title="Multiple referred from 6 places.">unparkSuccessor</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<div class="comment">
          If status is negative (i.e., possibly needing signal) try
          to clear in anticipation of signalling.  It is OK if this
          fails or if status is changed by waiting thread.</div>
<a id="L644" name="L644"></a> 644         <strong class="reserved">int</strong> ws = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus;
<a id="L645" name="L645"></a> 645         <strong class="reserved">if</strong> (ws &lt; 0)
<a id="L646" name="L646"></a> 646             <a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, ws, 0);
<a id="L647" name="L647"></a> 647 
<div class="comment">
          Thread to unpark is held in successor, which is normally
          just the next node.  But if cancelled or apparently null,
          traverse backwards from tail to find the actual
          non-cancelled successor.</div>
<a id="L654" name="L654"></a> 654         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L655" name="L655"></a> 655         <strong class="reserved">if</strong> (s == <strong class="reserved">null</strong> || s.waitStatus &gt; 0) <em class="brace">{</em>
<a id="L656" name="L656"></a> 656             s = <strong class="reserved">null</strong>;
<a id="L657" name="L657"></a> 657             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail; t != <strong class="reserved">null</strong> &amp;&amp; t != <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>; t = t.prev)
<a id="L658" name="L658"></a> 658                 <strong class="reserved">if</strong> (t.waitStatus &lt;= 0)
<a id="L659" name="L659"></a> 659                     s = t;
<a id="L660" name="L660"></a> 660         <em class="brace">}</em>
<a id="L661" name="L661"></a> 661         <strong class="reserved">if</strong> (s != <strong class="reserved">null</strong>)
<a id="L662" name="L662"></a> 662             <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(s.thread);
<a id="L663" name="L663"></a> 663     <em class="brace">}</em>
<a id="L664" name="L664"></a> 664 
<div class="comment">
      Release action for shared mode -- signals successor and ensures
      propagation. (Note: For exclusive mode, release just amounts
      to calling unparkSuccessor of head if it needs signal.)</div>
<a id="L670" name="L670"></a> 670     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13431.html" title="Multiple referred from 4 places.">doReleaseShared</a>() <em class="brace">{</em>
<div class="comment">
          Ensure that a release propagates, even if there are other
          in-progress acquires/releases.  This proceeds in the usual
          way of trying to unparkSuccessor of head if it needs
          signal. But if it does not, status is set to PROPAGATE to
          ensure that upon release, propagation continues.
          Additionally, we must loop in case a new node is added
          while we are doing this. Also, unlike other uses of
          unparkSuccessor, we need to know if CAS to reset status
          fails, if so rechecking.</div>
<a id="L682" name="L682"></a> 682         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L683" name="L683"></a> 683             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L684" name="L684"></a> 684             <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong> &amp;&amp; h != tail) <em class="brace">{</em>
<a id="L685" name="L685"></a> 685                 <strong class="reserved">int</strong> ws = h.waitStatus;
<a id="L686" name="L686"></a> 686                 <strong class="reserved">if</strong> (ws == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL) <em class="brace">{</em>
<a id="L687" name="L687"></a> 687                     <strong class="reserved">if</strong> (!<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(h, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL, 0))
<a id="L688" name="L688"></a> 688                         <strong class="reserved">continue</strong>;            <em class="comment">// loop to recheck cases</em>
<a id="L689" name="L689"></a> 689                     <a href="../D/35953.html" title="Multiple defined in 2 places.">unparkSuccessor</a>(h);
<a id="L690" name="L690"></a> 690                 <em class="brace">}</em>
<a id="L691" name="L691"></a> 691                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ws == 0 &amp;&amp;
<a id="L692" name="L692"></a> 692                          !<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(h, 0, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.PROPAGATE))
<a id="L693" name="L693"></a> 693                     <strong class="reserved">continue</strong>;                <em class="comment">// loop on failed CAS</em>
<a id="L694" name="L694"></a> 694             <em class="brace">}</em>
<a id="L695" name="L695"></a> 695             <strong class="reserved">if</strong> (h == head)                   <em class="comment">// loop if head changed</em>
<a id="L696" name="L696"></a> 696                 <strong class="reserved">break</strong>;
<a id="L697" name="L697"></a> 697         <em class="brace">}</em>
<a id="L698" name="L698"></a> 698     <em class="brace">}</em>
<a id="L699" name="L699"></a> 699 
<div class="comment">
      Sets head of queue, and checks if successor may be waiting
      in shared mode, if so propagating if either propagate &gt; 0 or
      PROPAGATE status was set.
      @param node the node
      @param propagate the return value from a tryAcquireShared</div>
<a id="L708" name="L708"></a> 708     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/27495.html" title="Multiple referred from 6 places.">setHeadAndPropagate</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">int</strong> propagate) <em class="brace">{</em>
<a id="L709" name="L709"></a> 709         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head; <em class="comment">// Record old head for check below</em>
<a id="L710" name="L710"></a> 710         <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<div class="comment">
          Try to signal next queued node if:
            Propagation was indicated by caller,
              or was recorded (as h.waitStatus either before
              or after setHead) by a previous operation
              (note: this uses sign-check of waitStatus because
               PROPAGATE status may transition to SIGNAL.)
          and
            The next node is waiting in shared mode,
              or we don't know, because it appears null
          The conservatism in both of these checks may cause
          unnecessary wake-ups, but only when there are multiple
          racing acquires/releases, so most need signals now or soon
          anyway.</div>
<a id="L727" name="L727"></a> 727         <strong class="reserved">if</strong> (propagate &gt; 0 || h == <strong class="reserved">null</strong> || h.waitStatus &lt; 0 ||
<a id="L728" name="L728"></a> 728             (h = head) == <strong class="reserved">null</strong> || h.waitStatus &lt; 0) <em class="brace">{</em>
<a id="L729" name="L729"></a> 729             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L730" name="L730"></a> 730             <strong class="reserved">if</strong> (s == <strong class="reserved">null</strong> || s.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>())
<a id="L731" name="L731"></a> 731                 <a href="../D/15071.html" title="Multiple defined in 2 places.">doReleaseShared</a>();
<a id="L732" name="L732"></a> 732         <em class="brace">}</em>
<a id="L733" name="L733"></a> 733     <em class="brace">}</em>
<a id="L734" name="L734"></a> 734 
<a id="L735" name="L735"></a> 735     <em class="comment">// Utilities for various versions of acquire</em>
<a id="L736" name="L736"></a> 736 
<div class="comment">
      Cancels an ongoing attempt to acquire.
      @param node the node</div>
<a id="L742" name="L742"></a> 742     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10919.html" title="Multiple referred from 12 places.">cancelAcquire</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L743" name="L743"></a> 743         <em class="comment">// Ignore if node doesn't exist</em>
<a id="L744" name="L744"></a> 744         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == <strong class="reserved">null</strong>)
<a id="L745" name="L745"></a> 745             <strong class="reserved">return</strong>;
<a id="L746" name="L746"></a> 746 
<a id="L747" name="L747"></a> 747         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L748" name="L748"></a> 748 
<a id="L749" name="L749"></a> 749         <em class="comment">// Skip cancelled predecessors</em>
<a id="L750" name="L750"></a> 750         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev;
<a id="L751" name="L751"></a> 751         <strong class="reserved">while</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus &gt; 0)
<a id="L752" name="L752"></a> 752             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.prev;
<a id="L753" name="L753"></a> 753 
<a id="L754" name="L754"></a> 754         <em class="comment">// predNext is the apparent node to unsplice. CASes below will</em>
<a id="L755" name="L755"></a> 755         <em class="comment">// fail if not, in which case, we lost race vs another cancel</em>
<a id="L756" name="L756"></a> 756         <em class="comment">// or signal, so no further action is necessary.</em>
<a id="L757" name="L757"></a> 757         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> predNext = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L758" name="L758"></a> 758 
<a id="L759" name="L759"></a> 759         <em class="comment">// Can use unconditional write instead of CAS here.</em>
<a id="L760" name="L760"></a> 760         <em class="comment">// After this atomic step, other Nodes can skip past us.</em>
<a id="L761" name="L761"></a> 761         <em class="comment">// Before, we are free of interference from other threads.</em>
<a id="L762" name="L762"></a> 762         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus = <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CANCELLED;
<a id="L763" name="L763"></a> 763 
<a id="L764" name="L764"></a> 764         <em class="comment">// If we are the tail, remove ourselves.</em>
<a id="L765" name="L765"></a> 765         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == tail &amp;&amp; <a href="../D/13042.html" title="Multiple defined in 2 places.">compareAndSetTail</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>)) <em class="brace">{</em>
<a id="L766" name="L766"></a> 766             <a href="../D/13038.html" title="Multiple defined in 2 places.">compareAndSetNext</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, predNext, <strong class="reserved">null</strong>);
<a id="L767" name="L767"></a> 767         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L768" name="L768"></a> 768             <em class="comment">// If successor needs signal, try to set pred's next-link</em>
<a id="L769" name="L769"></a> 769             <em class="comment">// so it will get one. Otherwise wake it up to propagate.</em>
<a id="L770" name="L770"></a> 770             <strong class="reserved">int</strong> ws;
<a id="L771" name="L771"></a> 771             <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != head &amp;&amp;
<a id="L772" name="L772"></a> 772                 ((ws = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus) == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL ||
<a id="L773" name="L773"></a> 773                  (ws &lt;= 0 &amp;&amp; <a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, ws, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL))) &amp;&amp;
<a id="L774" name="L774"></a> 774                 <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.thread != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L775" name="L775"></a> 775                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L776" name="L776"></a> 776                 <strong class="reserved">if</strong> (<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>.waitStatus &lt;= 0)
<a id="L777" name="L777"></a> 777                     <a href="../D/13038.html" title="Multiple defined in 2 places.">compareAndSetNext</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, predNext, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>);
<a id="L778" name="L778"></a> 778             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L779" name="L779"></a> 779                 <a href="../D/35953.html" title="Multiple defined in 2 places.">unparkSuccessor</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L780" name="L780"></a> 780             <em class="brace">}</em>
<a id="L781" name="L781"></a> 781 
<a id="L782" name="L782"></a> 782             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>; <em class="comment">// help GC</em>
<a id="L783" name="L783"></a> 783         <em class="brace">}</em>
<a id="L784" name="L784"></a> 784     <em class="brace">}</em>
<a id="L785" name="L785"></a> 785 
<div class="comment">
      Checks and updates status for a node that failed to acquire.
      Returns true if thread should block. This is the main signal
      control in all acquire loops.  Requires that pred == node.prev.
      @param pred node's predecessor holding status
      @param node the node
      @return <code>true</code> if thread should block</div>
<a id="L795" name="L795"></a> 795     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> <a href="../R/28538.html" title="Multiple referred from 12 places.">shouldParkAfterFailedAcquire</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L796" name="L796"></a> 796         <strong class="reserved">int</strong> ws = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus;
<a id="L797" name="L797"></a> 797         <strong class="reserved">if</strong> (ws == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL)
<div class="comment">
              This node has already set status asking a release
              to signal it, so it can safely park.</div>
<a id="L802" name="L802"></a> 802             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L803" name="L803"></a> 803         <strong class="reserved">if</strong> (ws &gt; 0) <em class="brace">{</em>
<div class="comment">
              Predecessor was cancelled. Skip over predecessors and
              indicate retry.</div>
<a id="L808" name="L808"></a> 808             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L809" name="L809"></a> 809                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.prev;
<a id="L810" name="L810"></a> 810             <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus &gt; 0);
<a id="L811" name="L811"></a> 811             <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L812" name="L812"></a> 812         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
              waitStatus must be 0 or PROPAGATE.  Indicate that we
              need a signal, but don't park yet.  Caller will need to
              retry to make sure it cannot acquire before parking.</div>
<a id="L818" name="L818"></a> 818             <a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, ws, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL);
<a id="L819" name="L819"></a> 819         <em class="brace">}</em>
<a id="L820" name="L820"></a> 820         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L821" name="L821"></a> 821     <em class="brace">}</em>
<a id="L822" name="L822"></a> 822 
<div class="comment">
      Convenience method to interrupt current thread.</div>
<a id="L826" name="L826"></a> 826     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/26756.html" title="Multiple referred from 8 places.">selfInterrupt</a>() <em class="brace">{</em>
<a id="L827" name="L827"></a> 827         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>().<a href="../D/24969.html" title="Multiple defined in 3 places.">interrupt</a>();
<a id="L828" name="L828"></a> 828     <em class="brace">}</em>
<a id="L829" name="L829"></a> 829 
<div class="comment">
      Convenience method to park and then check if interrupted
      @return <code>true</code> if interrupted</div>
<a id="L835" name="L835"></a> 835     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/24490.html" title="Multiple referred from 8 places.">parkAndCheckInterrupt</a>() <em class="brace">{</em>
<a id="L836" name="L836"></a> 836         <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L837" name="L837"></a> 837         <strong class="reserved">return</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>();
<a id="L838" name="L838"></a> 838     <em class="brace">}</em>
<a id="L839" name="L839"></a> 839 
<div class="comment">
      Various flavors of acquire, varying in exclusive/shared and
      control modes.  Each is mostly the same, but annoyingly
      different.  Only a little bit of factoring is possible due to
      interactions of exception mechanics (including ensuring that we
      cancel if tryAcquire throws exception) and other control, at
      least not without hurting performance too much.</div>
<a id="L848" name="L848"></a> 848 
<div class="comment">
      Acquires in exclusive uninterruptible mode for thread already in
      queue. Used by condition wait methods as well as acquire.
      @param node the node
      @param arg the acquire argument
      @return <code>true</code> if interrupted while waiting</div>
<a id="L857" name="L857"></a> 857     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/9552.html" title="Multiple referred from 12 places.">acquireQueued</a>(<strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L858" name="L858"></a> 858         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L859" name="L859"></a> 859         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L860" name="L860"></a> 860             <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">false</strong>;
<a id="L861" name="L861"></a> 861             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L862" name="L862"></a> 862                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L863" name="L863"></a> 863                 <strong class="reserved">if</strong> (p == head &amp;&amp; <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L864" name="L864"></a> 864                     <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L865" name="L865"></a> 865                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L866" name="L866"></a> 866                     <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L867" name="L867"></a> 867                     <strong class="reserved">return</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>;
<a id="L868" name="L868"></a> 868                 <em class="brace">}</em>
<a id="L869" name="L869"></a> 869                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L870" name="L870"></a> 870                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L871" name="L871"></a> 871                     <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">true</strong>;
<a id="L872" name="L872"></a> 872             <em class="brace">}</em>
<a id="L873" name="L873"></a> 873         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L874" name="L874"></a> 874             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L875" name="L875"></a> 875                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L876" name="L876"></a> 876         <em class="brace">}</em>
<a id="L877" name="L877"></a> 877     <em class="brace">}</em>
<a id="L878" name="L878"></a> 878 
<div class="comment">
      Acquires in exclusive interruptible mode.
      @param arg the acquire argument</div>
<a id="L883" name="L883"></a> 883     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13372.html" title="Multiple referred from 2 places.">doAcquireInterruptibly</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L884" name="L884"></a> 884         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L885" name="L885"></a> 885         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.EXCLUSIVE);
<a id="L886" name="L886"></a> 886         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L887" name="L887"></a> 887         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L888" name="L888"></a> 888             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L889" name="L889"></a> 889                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L890" name="L890"></a> 890                 <strong class="reserved">if</strong> (p == head &amp;&amp; <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L891" name="L891"></a> 891                     <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L892" name="L892"></a> 892                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L893" name="L893"></a> 893                     <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L894" name="L894"></a> 894                     <strong class="reserved">return</strong>;
<a id="L895" name="L895"></a> 895                 <em class="brace">}</em>
<a id="L896" name="L896"></a> 896                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L897" name="L897"></a> 897                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L898" name="L898"></a> 898                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L899" name="L899"></a> 899             <em class="brace">}</em>
<a id="L900" name="L900"></a> 900         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L901" name="L901"></a> 901             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L902" name="L902"></a> 902                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L903" name="L903"></a> 903         <em class="brace">}</em>
<a id="L904" name="L904"></a> 904     <em class="brace">}</em>
<a id="L905" name="L905"></a> 905 
<div class="comment">
      Acquires in exclusive timed mode.
      @param arg the acquire argument
      @param nanosTimeout max wait time
      @return <code>true</code> if acquired</div>
<a id="L913" name="L913"></a> 913     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/13373.html" title="Multiple referred from 2 places.">doAcquireNanos</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L914" name="L914"></a> 914             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L915" name="L915"></a> 915         <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L916" name="L916"></a> 916             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L917" name="L917"></a> 917         <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L918" name="L918"></a> 918         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.EXCLUSIVE);
<a id="L919" name="L919"></a> 919         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L920" name="L920"></a> 920         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L921" name="L921"></a> 921             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L922" name="L922"></a> 922                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L923" name="L923"></a> 923                 <strong class="reserved">if</strong> (p == head &amp;&amp; <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L924" name="L924"></a> 924                     <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L925" name="L925"></a> 925                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L926" name="L926"></a> 926                     <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L927" name="L927"></a> 927                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L928" name="L928"></a> 928                 <em class="brace">}</em>
<a id="L929" name="L929"></a> 929                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L930" name="L930"></a> 930                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L931" name="L931"></a> 931                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L932" name="L932"></a> 932                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L933" name="L933"></a> 933                     nanosTimeout &gt; spinForTimeoutThreshold)
<a id="L934" name="L934"></a> 934                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L935" name="L935"></a> 935                 <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L936" name="L936"></a> 936                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L937" name="L937"></a> 937             <em class="brace">}</em>
<a id="L938" name="L938"></a> 938         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L939" name="L939"></a> 939             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L940" name="L940"></a> 940                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L941" name="L941"></a> 941         <em class="brace">}</em>
<a id="L942" name="L942"></a> 942     <em class="brace">}</em>
<a id="L943" name="L943"></a> 943 
<div class="comment">
      Acquires in shared uninterruptible mode.
      @param arg the acquire argument</div>
<a id="L948" name="L948"></a> 948     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13374.html" title="Multiple referred from 2 places.">doAcquireShared</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L949" name="L949"></a> 949         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SHARED);
<a id="L950" name="L950"></a> 950         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L951" name="L951"></a> 951         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L952" name="L952"></a> 952             <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">false</strong>;
<a id="L953" name="L953"></a> 953             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L954" name="L954"></a> 954                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L955" name="L955"></a> 955                 <strong class="reserved">if</strong> (p == head) <em class="brace">{</em>
<a id="L956" name="L956"></a> 956                     <strong class="reserved">int</strong> r = <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L957" name="L957"></a> 957                     <strong class="reserved">if</strong> (r &gt;= 0) <em class="brace">{</em>
<a id="L958" name="L958"></a> 958                         <a href="../D/32836.html" title="Multiple defined in 2 places.">setHeadAndPropagate</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, r);
<a id="L959" name="L959"></a> 959                         p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L960" name="L960"></a> 960                         <strong class="reserved">if</strong> (<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>)
<a id="L961" name="L961"></a> 961                             <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L962" name="L962"></a> 962                         <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L963" name="L963"></a> 963                         <strong class="reserved">return</strong>;
<a id="L964" name="L964"></a> 964                     <em class="brace">}</em>
<a id="L965" name="L965"></a> 965                 <em class="brace">}</em>
<a id="L966" name="L966"></a> 966                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L967" name="L967"></a> 967                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L968" name="L968"></a> 968                     <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">true</strong>;
<a id="L969" name="L969"></a> 969             <em class="brace">}</em>
<a id="L970" name="L970"></a> 970         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L971" name="L971"></a> 971             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L972" name="L972"></a> 972                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L973" name="L973"></a> 973         <em class="brace">}</em>
<a id="L974" name="L974"></a> 974     <em class="brace">}</em>
<a id="L975" name="L975"></a> 975 
<div class="comment">
      Acquires in shared interruptible mode.
      @param arg the acquire argument</div>
<a id="L980" name="L980"></a> 980     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13375.html" title="Multiple referred from 2 places.">doAcquireSharedInterruptibly</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L981" name="L981"></a> 981         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L982" name="L982"></a> 982         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SHARED);
<a id="L983" name="L983"></a> 983         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L984" name="L984"></a> 984         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L985" name="L985"></a> 985             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L986" name="L986"></a> 986                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L987" name="L987"></a> 987                 <strong class="reserved">if</strong> (p == head) <em class="brace">{</em>
<a id="L988" name="L988"></a> 988                     <strong class="reserved">int</strong> r = <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L989" name="L989"></a> 989                     <strong class="reserved">if</strong> (r &gt;= 0) <em class="brace">{</em>
<a id="L990" name="L990"></a> 990                         <a href="../D/32836.html" title="Multiple defined in 2 places.">setHeadAndPropagate</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, r);
<a id="L991" name="L991"></a> 991                         p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L992" name="L992"></a> 992                         <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L993" name="L993"></a> 993                         <strong class="reserved">return</strong>;
<a id="L994" name="L994"></a> 994                     <em class="brace">}</em>
<a id="L995" name="L995"></a> 995                 <em class="brace">}</em>
<a id="L996" name="L996"></a> 996                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L997" name="L997"></a> 997                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L998" name="L998"></a> 998                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L999" name="L999"></a> 999             <em class="brace">}</em>
<a id="L1000" name="L1000"></a>1000         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L1001" name="L1001"></a>1001             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L1002" name="L1002"></a>1002                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1003" name="L1003"></a>1003         <em class="brace">}</em>
<a id="L1004" name="L1004"></a>1004     <em class="brace">}</em>
<a id="L1005" name="L1005"></a>1005 
<div class="comment">
      Acquires in shared timed mode.
      @param arg the acquire argument
      @param nanosTimeout max wait time
      @return <code>true</code> if acquired</div>
<a id="L1013" name="L1013"></a>1013     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/13376.html" title="Multiple referred from 2 places.">doAcquireSharedNanos</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L1014" name="L1014"></a>1014             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1015" name="L1015"></a>1015         <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L1016" name="L1016"></a>1016             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1017" name="L1017"></a>1017         <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L1018" name="L1018"></a>1018         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SHARED);
<a id="L1019" name="L1019"></a>1019         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L1020" name="L1020"></a>1020         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1021" name="L1021"></a>1021             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L1022" name="L1022"></a>1022                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L1023" name="L1023"></a>1023                 <strong class="reserved">if</strong> (p == head) <em class="brace">{</em>
<a id="L1024" name="L1024"></a>1024                     <strong class="reserved">int</strong> r = <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1025" name="L1025"></a>1025                     <strong class="reserved">if</strong> (r &gt;= 0) <em class="brace">{</em>
<a id="L1026" name="L1026"></a>1026                         <a href="../D/32836.html" title="Multiple defined in 2 places.">setHeadAndPropagate</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, r);
<a id="L1027" name="L1027"></a>1027                         p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L1028" name="L1028"></a>1028                         <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L1029" name="L1029"></a>1029                         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1030" name="L1030"></a>1030                     <em class="brace">}</em>
<a id="L1031" name="L1031"></a>1031                 <em class="brace">}</em>
<a id="L1032" name="L1032"></a>1032                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L1033" name="L1033"></a>1033                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L1034" name="L1034"></a>1034                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1035" name="L1035"></a>1035                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L1036" name="L1036"></a>1036                     nanosTimeout &gt; spinForTimeoutThreshold)
<a id="L1037" name="L1037"></a>1037                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L1038" name="L1038"></a>1038                 <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1039" name="L1039"></a>1039                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1040" name="L1040"></a>1040             <em class="brace">}</em>
<a id="L1041" name="L1041"></a>1041         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L1042" name="L1042"></a>1042             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L1043" name="L1043"></a>1043                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1044" name="L1044"></a>1044         <em class="brace">}</em>
<a id="L1045" name="L1045"></a>1045     <em class="brace">}</em>
<a id="L1046" name="L1046"></a>1046 
<a id="L1047" name="L1047"></a>1047     <em class="comment">// Main exported methods</em>
<a id="L1048" name="L1048"></a>1048 
<div class="comment">
      Attempts to acquire in exclusive mode. This method should query
      if the state of the object permits it to be acquired in the
      exclusive mode, and if so to acquire it.
      <p>This method is always invoked by the thread performing
      acquire.  If this method reports failure, the acquire method
      may queue the thread, if it is not already queued, until it is
      signalled by a release from some other thread. This can be used
      to implement method {@link Lock#tryLock()}.
      </p><p>The default
      implementation throws <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>.
      @param arg the acquire argument. This value is always the one
             passed to an acquire method, or is the value saved on entry
             to a condition wait.  The value is otherwise uninterpreted
             and can represent anything you like.
      @return <code>true</code> if successful. Upon success, this object has
              been acquired.
      @throws IllegalMonitorStateException if acquiring would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if exclusive mode is not supported</p></div>
<a id="L1075" name="L1075"></a>1075     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/29536.html" title="Multiple referred from 13 places.">tryAcquire</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1076" name="L1076"></a>1076         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L1077" name="L1077"></a>1077     <em class="brace">}</em>
<a id="L1078" name="L1078"></a>1078 
<div class="comment">
      Attempts to set the state to reflect a release in exclusive
      mode.
      <p>This method is always invoked by the thread performing release.
      </p><p>The default implementation throws
      <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>.
      @param arg the release argument. This value is always the one
             passed to a release method, or the current state value upon
             entry to a condition wait.  The value is otherwise
             uninterpreted and can represent anything you like.
      @return <code>true</code> if this object is now in a fully released
              state, so that any waiting threads may attempt to acquire;
              and <code>false</code> otherwise.
      @throws IllegalMonitorStateException if releasing would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if exclusive mode is not supported</p></div>
<a id="L1101" name="L1101"></a>1101     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/29560.html" title="Multiple referred from 7 places.">tryRelease</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1102" name="L1102"></a>1102         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L1103" name="L1103"></a>1103     <em class="brace">}</em>
<a id="L1104" name="L1104"></a>1104 
<div class="comment">
      Attempts to acquire in shared mode. This method should query if
      the state of the object permits it to be acquired in the shared
      mode, and if so to acquire it.
      <p>This method is always invoked by the thread performing
      acquire.  If this method reports failure, the acquire method
      may queue the thread, if it is not already queued, until it is
      signalled by a release from some other thread.
      </p><p>The default implementation throws {@link
      UnsupportedOperationException}.
      @param arg the acquire argument. This value is always the one
             passed to an acquire method, or is the value saved on entry
             to a condition wait.  The value is otherwise uninterpreted
             and can represent anything you like.
      @return a negative value on failure; zero if acquisition in shared
              mode succeeded but no subsequent shared-mode acquire can
              succeed; and a positive value if acquisition in shared
              mode succeeded and subsequent shared-mode acquires might
              also succeed, in which case a subsequent waiting thread
              must check availability. (Support for three different
              return values enables this method to be used in contexts
              where acquires only sometimes act exclusively.)  Upon
              success, this object has been acquired.
      @throws IllegalMonitorStateException if acquiring would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if shared mode is not supported</p></div>
<a id="L1137" name="L1137"></a>1137     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> <a href="../R/29538.html" title="Multiple referred from 12 places.">tryAcquireShared</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1138" name="L1138"></a>1138         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L1139" name="L1139"></a>1139     <em class="brace">}</em>
<a id="L1140" name="L1140"></a>1140 
<div class="comment">
      Attempts to set the state to reflect a release in shared mode.
      <p>This method is always invoked by the thread performing release.
      </p><p>The default implementation throws
      <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>.
      @param arg the release argument. This value is always the one
             passed to a release method, or the current state value upon
             entry to a condition wait.  The value is otherwise
             uninterpreted and can represent anything you like.
      @return <code>true</code> if this release of shared mode may permit a
              waiting acquire (shared or exclusive) to succeed; and
              <code>false</code> otherwise
      @throws IllegalMonitorStateException if releasing would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if shared mode is not supported</p></div>
<a id="L1162" name="L1162"></a>1162     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/29561.html" title="Multiple referred from 2 places.">tryReleaseShared</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1163" name="L1163"></a>1163         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L1164" name="L1164"></a>1164     <em class="brace">}</em>
<a id="L1165" name="L1165"></a>1165 
<div class="comment">
      Returns <code>true</code> if synchronization is held exclusively with
      respect to the current (calling) thread.  This method is invoked
      upon each call to a non-waiting <a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> method.
      (Waiting methods instead invoke <a href="#L1260" title="Defined at 1260.">release</a>.)
      <p>The default implementation throws {@link
      UnsupportedOperationException}. This method is invoked
      internally only within <a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> methods, so need
      not be defined if conditions are not used.
      @return <code>true</code> if synchronization is held exclusively;
              <code>false</code> otherwise
      @throws UnsupportedOperationException if conditions are not supported</p></div>
<a id="L1181" name="L1181"></a>1181     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/21524.html" title="Multiple referred from 17 places.">isHeldExclusively</a>() <em class="brace">{</em>
<a id="L1182" name="L1182"></a>1182         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L1183" name="L1183"></a>1183     <em class="brace">}</em>
<a id="L1184" name="L1184"></a>1184 
<div class="comment">
      Acquires in exclusive mode, ignoring interrupts.  Implemented
      by invoking at least once <a href="#L1075" title="Defined at 1075.">tryAcquire</a>,
      returning on success.  Otherwise the thread is queued, possibly
      repeatedly blocking and unblocking, invoking {@link
      #tryAcquire} until success.  This method can be used
      to implement method {@link Lock#lock}.
      @param arg the acquire argument.  This value is conveyed to
             <a href="#L1075" title="Defined at 1075.">tryAcquire</a> but is otherwise uninterpreted and
             can represent anything you like.</div>
<a id="L1197" name="L1197"></a>1197     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9543.html" title="Multiple referred from 7 places.">acquire</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1198" name="L1198"></a>1198         <strong class="reserved">if</strong> (!<a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &amp;&amp;
<a id="L1199" name="L1199"></a>1199             <a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.EXCLUSIVE), <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>))
<a id="L1200" name="L1200"></a>1200             <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L1201" name="L1201"></a>1201     <em class="brace">}</em>
<a id="L1202" name="L1202"></a>1202 
<div class="comment">
      Acquires in exclusive mode, aborting if interrupted.
      Implemented by first checking interrupt status, then invoking
      at least once <a href="#L1075" title="Defined at 1075.">tryAcquire</a>, returning on
      success.  Otherwise the thread is queued, possibly repeatedly
      blocking and unblocking, invoking <a href="#L1075" title="Defined at 1075.">tryAcquire</a>
      until success or the thread is interrupted.  This method can be
      used to implement method {@link Lock#lockInterruptibly}.
      @param arg the acquire argument.  This value is conveyed to
             <a href="#L1075" title="Defined at 1075.">tryAcquire</a> but is otherwise uninterpreted and
             can represent anything you like.
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1217" name="L1217"></a>1217     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9548.html" title="Multiple referred from 2 places.">acquireInterruptibly</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L1218" name="L1218"></a>1218             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1219" name="L1219"></a>1219         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1220" name="L1220"></a>1220             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1221" name="L1221"></a>1221         <strong class="reserved">if</strong> (!<a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>))
<a id="L1222" name="L1222"></a>1222             <a href="../D/15007.html" title="Multiple defined in 2 places.">doAcquireInterruptibly</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1223" name="L1223"></a>1223     <em class="brace">}</em>
<a id="L1224" name="L1224"></a>1224 
<div class="comment">
      Attempts to acquire in exclusive mode, aborting if interrupted,
      and failing if the given timeout elapses.  Implemented by first
      checking interrupt status, then invoking at least once {@link
      #tryAcquire}, returning on success.  Otherwise, the thread is
      queued, possibly repeatedly blocking and unblocking, invoking
      <a href="#L1075" title="Defined at 1075.">tryAcquire</a> until success or the thread is interrupted
      or the timeout elapses.  This method can be used to implement
      method {@link Lock#tryLock(long, TimeUnit)}.
      @param arg the acquire argument.  This value is conveyed to
             <a href="#L1075" title="Defined at 1075.">tryAcquire</a> but is otherwise uninterpreted and
             can represent anything you like.
      @param nanosTimeout the maximum number of nanoseconds to wait
      @return <code>true</code> if acquired; <code>false</code> if timed out
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1242" name="L1242"></a>1242     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29537.html" title="Multiple referred from 2 places.">tryAcquireNanos</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L1243" name="L1243"></a>1243             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1244" name="L1244"></a>1244         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1245" name="L1245"></a>1245             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1246" name="L1246"></a>1246         <strong class="reserved">return</strong> <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) ||
<a id="L1247" name="L1247"></a>1247             <a href="../D/15008.html" title="Multiple defined in 2 places.">doAcquireNanos</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, nanosTimeout);
<a id="L1248" name="L1248"></a>1248     <em class="brace">}</em>
<a id="L1249" name="L1249"></a>1249 
<div class="comment">
      Releases in exclusive mode.  Implemented by unblocking one or
      more threads if <a href="#L1101" title="Defined at 1101.">tryRelease</a> returns true.
      This method can be used to implement method {@link Lock#unlock}.
      @param arg the release argument.  This value is conveyed to
             <a href="#L1101" title="Defined at 1101.">tryRelease</a> but is otherwise uninterpreted and
             can represent anything you like.
      @return the value returned from <a href="#L1101" title="Defined at 1101.">tryRelease</a></div>
<a id="L1260" name="L1260"></a>1260     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/25846.html" title="Multiple referred from 40 places.">release</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1261" name="L1261"></a>1261         <strong class="reserved">if</strong> (<a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L1262" name="L1262"></a>1262             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L1263" name="L1263"></a>1263             <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong> &amp;&amp; h.waitStatus != 0)
<a id="L1264" name="L1264"></a>1264                 <a href="../D/35953.html" title="Multiple defined in 2 places.">unparkSuccessor</a>(h);
<a id="L1265" name="L1265"></a>1265             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1266" name="L1266"></a>1266         <em class="brace">}</em>
<a id="L1267" name="L1267"></a>1267         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1268" name="L1268"></a>1268     <em class="brace">}</em>
<a id="L1269" name="L1269"></a>1269 
<div class="comment">
      Acquires in shared mode, ignoring interrupts.  Implemented by
      first invoking at least once <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a>,
      returning on success.  Otherwise the thread is queued, possibly
      repeatedly blocking and unblocking, invoking {@link
      #tryAcquireShared} until success.
      @param arg the acquire argument.  This value is conveyed to
             <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a> but is otherwise uninterpreted
             and can represent anything you like.</div>
<a id="L1281" name="L1281"></a>1281     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9554.html" title="Multiple referred from 3 places.">acquireShared</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1282" name="L1282"></a>1282         <strong class="reserved">if</strong> (<a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &lt; 0)
<a id="L1283" name="L1283"></a>1283             <a href="../D/15009.html" title="Multiple defined in 2 places.">doAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1284" name="L1284"></a>1284     <em class="brace">}</em>
<a id="L1285" name="L1285"></a>1285 
<div class="comment">
      Acquires in shared mode, aborting if interrupted.  Implemented
      by first checking interrupt status, then invoking at least once
      <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a>, returning on success.  Otherwise the
      thread is queued, possibly repeatedly blocking and unblocking,
      invoking <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a> until success or the thread
      is interrupted.
      @param arg the acquire argument.
      This value is conveyed to <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a> but is
      otherwise uninterpreted and can represent anything
      you like.
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1299" name="L1299"></a>1299     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9555.html" title="Multiple referred from 4 places.">acquireSharedInterruptibly</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L1300" name="L1300"></a>1300             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1301" name="L1301"></a>1301         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1302" name="L1302"></a>1302             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1303" name="L1303"></a>1303         <strong class="reserved">if</strong> (<a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &lt; 0)
<a id="L1304" name="L1304"></a>1304             <a href="../D/15010.html" title="Multiple defined in 2 places.">doAcquireSharedInterruptibly</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1305" name="L1305"></a>1305     <em class="brace">}</em>
<a id="L1306" name="L1306"></a>1306 
<div class="comment">
      Attempts to acquire in shared mode, aborting if interrupted, and
      failing if the given timeout elapses.  Implemented by first
      checking interrupt status, then invoking at least once {@link
      #tryAcquireShared}, returning on success.  Otherwise, the
      thread is queued, possibly repeatedly blocking and unblocking,
      invoking <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a> until success or the thread
      is interrupted or the timeout elapses.
      @param arg the acquire argument.  This value is conveyed to
             <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a> but is otherwise uninterpreted
             and can represent anything you like.
      @param nanosTimeout the maximum number of nanoseconds to wait
      @return <code>true</code> if acquired; <code>false</code> if timed out
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1323" name="L1323"></a>1323     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29539.html" title="Multiple referred from 4 places.">tryAcquireSharedNanos</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L1324" name="L1324"></a>1324             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1325" name="L1325"></a>1325         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1326" name="L1326"></a>1326             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1327" name="L1327"></a>1327         <strong class="reserved">return</strong> <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &gt;= 0 ||
<a id="L1328" name="L1328"></a>1328             <a href="../D/15011.html" title="Multiple defined in 2 places.">doAcquireSharedNanos</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, nanosTimeout);
<a id="L1329" name="L1329"></a>1329     <em class="brace">}</em>
<a id="L1330" name="L1330"></a>1330 
<div class="comment">
      Releases in shared mode.  Implemented by unblocking one or more
      threads if <a href="#L1162" title="Defined at 1162.">tryReleaseShared</a> returns true.
      @param arg the release argument.  This value is conveyed to
             <a href="#L1162" title="Defined at 1162.">tryReleaseShared</a> but is otherwise uninterpreted
             and can represent anything you like.
      @return the value returned from <a href="#L1162" title="Defined at 1162.">tryReleaseShared</a></div>
<a id="L1340" name="L1340"></a>1340     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/25864.html" title="Multiple referred from 4 places.">releaseShared</a>(<strong class="reserved">int</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1341" name="L1341"></a>1341         <strong class="reserved">if</strong> (<a href="../D/35736.html" title="Multiple defined in 5 places.">tryReleaseShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L1342" name="L1342"></a>1342             <a href="../D/15071.html" title="Multiple defined in 2 places.">doReleaseShared</a>();
<a id="L1343" name="L1343"></a>1343             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1344" name="L1344"></a>1344         <em class="brace">}</em>
<a id="L1345" name="L1345"></a>1345         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1346" name="L1346"></a>1346     <em class="brace">}</em>
<a id="L1347" name="L1347"></a>1347 
<a id="L1348" name="L1348"></a>1348     <em class="comment">// Queue inspection methods</em>
<a id="L1349" name="L1349"></a>1349 
<div class="comment">
      Queries whether any threads are waiting to acquire. Note that
      because cancellations due to interrupts and timeouts may occur
      at any time, a <code>true</code> return does not guarantee that any
      other thread will ever acquire.
      <p>In this implementation, this operation returns in
      constant time.
      @return <code>true</code> if there may be other threads waiting to acquire</p></div>
<a id="L1361" name="L1361"></a>1361     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20258.html" title="Multiple referred from 5 places.">hasQueuedThreads</a>() <em class="brace">{</em>
<a id="L1362" name="L1362"></a>1362         <strong class="reserved">return</strong> head != tail;
<a id="L1363" name="L1363"></a>1363     <em class="brace">}</em>
<a id="L1364" name="L1364"></a>1364 
<div class="comment">
      Queries whether any threads have ever contended to acquire this
      synchronizer; that is if an acquire method has ever blocked.
      <p>In this implementation, this operation returns in
      constant time.
      @return <code>true</code> if there has ever been contention</p></div>
<a id="L1374" name="L1374"></a>1374     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> hasContended() <em class="brace">{</em>
<a id="L1375" name="L1375"></a>1375         <strong class="reserved">return</strong> head != <strong class="reserved">null</strong>;
<a id="L1376" name="L1376"></a>1376     <em class="brace">}</em>
<a id="L1377" name="L1377"></a>1377 
<div class="comment">
      Returns the first (longest-waiting) thread in the queue, or
      <code>null</code> if no threads are currently queued.
      <p>In this implementation, this operation normally returns in
      constant time, but may iterate upon contention if other threads are
      concurrently modifying the queue.
      @return the first (longest-waiting) thread in the queue, or
              <code>null</code> if no threads are currently queued</p></div>
<a id="L1389" name="L1389"></a>1389     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> getFirstQueuedThread() <em class="brace">{</em>
<a id="L1390" name="L1390"></a>1390         <em class="comment">// handle only fast path, else relay</em>
<a id="L1391" name="L1391"></a>1391         <strong class="reserved">return</strong> (head == tail) ? <strong class="reserved">null</strong> : <a href="../D/16612.html" title="Multiple defined in 2 places.">fullGetFirstQueuedThread</a>();
<a id="L1392" name="L1392"></a>1392     <em class="brace">}</em>
<a id="L1393" name="L1393"></a>1393 
<div class="comment">
      Version of getFirstQueuedThread called when fastpath fails</div>
<a id="L1397" name="L1397"></a>1397     <strong class="reserved">private</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../R/14822.html" title="Multiple referred from 2 places.">fullGetFirstQueuedThread</a>() <em class="brace">{</em>
<div class="comment">
          The first node is normally head.next. Try to get its
          thread field, ensuring consistent reads: If thread
          field is nulled out or s.prev is no longer head, then
          some other thread(s) concurrently performed setHead in
          between some of our reads. We try this twice before
          resorting to traversal.</div>
<a id="L1406" name="L1406"></a>1406         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h, s;
<a id="L1407" name="L1407"></a>1407         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> st;
<a id="L1408" name="L1408"></a>1408         <strong class="reserved">if</strong> (((h = head) != <strong class="reserved">null</strong> &amp;&amp; (s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1409" name="L1409"></a>1409              s.prev == head &amp;&amp; (st = s.thread) != <strong class="reserved">null</strong>) ||
<a id="L1410" name="L1410"></a>1410             ((h = head) != <strong class="reserved">null</strong> &amp;&amp; (s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1411" name="L1411"></a>1411              s.prev == head &amp;&amp; (st = s.thread) != <strong class="reserved">null</strong>))
<a id="L1412" name="L1412"></a>1412             <strong class="reserved">return</strong> st;
<a id="L1413" name="L1413"></a>1413 
<div class="comment">
          Head's next field might not have been set yet, or may have
          been unset after setHead. So we must check to see if tail
          is actually first node. If not, we continue on, safely
          traversing from tail back to head to find first,
          guaranteeing termination.</div>
<a id="L1421" name="L1421"></a>1421 
<a id="L1422" name="L1422"></a>1422         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail;
<a id="L1423" name="L1423"></a>1423         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> firstThread = <strong class="reserved">null</strong>;
<a id="L1424" name="L1424"></a>1424         <strong class="reserved">while</strong> (t != <strong class="reserved">null</strong> &amp;&amp; t != head) <em class="brace">{</em>
<a id="L1425" name="L1425"></a>1425             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> tt = t.thread;
<a id="L1426" name="L1426"></a>1426             <strong class="reserved">if</strong> (tt != <strong class="reserved">null</strong>)
<a id="L1427" name="L1427"></a>1427                 firstThread = tt;
<a id="L1428" name="L1428"></a>1428             t = t.prev;
<a id="L1429" name="L1429"></a>1429         <em class="brace">}</em>
<a id="L1430" name="L1430"></a>1430         <strong class="reserved">return</strong> firstThread;
<a id="L1431" name="L1431"></a>1431     <em class="brace">}</em>
<a id="L1432" name="L1432"></a>1432 
<div class="comment">
      Returns true if the given thread is currently queued.
      <p>This implementation traverses the queue to determine
      presence of the given thread.
      @param thread the thread
      @return <code>true</code> if the given thread is on the queue
      @throws NullPointerException if the thread is null</p></div>
<a id="L1443" name="L1443"></a>1443     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21920.html" title="Multiple referred from 2 places.">isQueued</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread) <em class="brace">{</em>
<a id="L1444" name="L1444"></a>1444         <strong class="reserved">if</strong> (thread == <strong class="reserved">null</strong>)
<a id="L1445" name="L1445"></a>1445             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1446" name="L1446"></a>1446         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev)
<a id="L1447" name="L1447"></a>1447             <strong class="reserved">if</strong> (p.thread == thread)
<a id="L1448" name="L1448"></a>1448                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1449" name="L1449"></a>1449         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1450" name="L1450"></a>1450     <em class="brace">}</em>
<a id="L1451" name="L1451"></a>1451 
<div class="comment">
      Returns <code>true</code> if the apparent first queued thread, if one
      exists, is waiting in exclusive mode.  If this method returns
      <code>true</code>, and the current thread is attempting to acquire in
      shared mode (that is, this method is invoked from {@link
      #tryAcquireShared}) then it is guaranteed that the current thread
      is not the first queued thread.  Used only as a heuristic in
      ReentrantReadWriteLock.</div>
<a id="L1461" name="L1461"></a>1461     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L682" title="Referred from 682 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">apparentlyFirstQueuedIsExclusive</a>() <em class="brace">{</em>
<a id="L1462" name="L1462"></a>1462         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h, s;
<a id="L1463" name="L1463"></a>1463         <strong class="reserved">return</strong> (h = head) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1464" name="L1464"></a>1464             (s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>)  != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1465" name="L1465"></a>1465             !s.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>()         &amp;&amp;
<a id="L1466" name="L1466"></a>1466             s.thread != <strong class="reserved">null</strong>;
<a id="L1467" name="L1467"></a>1467     <em class="brace">}</em>
<a id="L1468" name="L1468"></a>1468 
<div class="comment">
      Queries whether any threads have been waiting to acquire longer
      than the current thread.
      <p>An invocation of this method is equivalent to (but may be
      more efficient than):
       </p><pre> {@code
      getFirstQueuedThread() != Thread.currentThread() &amp;&amp;
      hasQueuedThreads()}</pre>
      <p>Note that because cancellations due to interrupts and
      timeouts may occur at any time, a <code>true</code> return does not
      guarantee that some other thread will acquire before the current
      thread.  Likewise, it is possible for another thread to win a
      race to enqueue after this method has returned <code>false</code>,
      due to the queue being empty.
      </p><p>This method is designed to be used by a fair synchronizer to
      avoid <a href="AbstractQueuedSynchronizer#barging">barging</a>.
      Such a synchronizer's <a href="#L1075" title="Defined at 1075.">tryAcquire</a> method should return
      <code>false</code>, and its <a href="#L1137" title="Defined at 1137.">tryAcquireShared</a> method should
      return a negative value, if this method returns <code>true</code>
      (unless this is a reentrant acquire).  For example, the {@code
      tryAcquire} method for a fair, reentrant, exclusive mode
      synchronizer might look like this:
       </p><pre> {@code
      protected boolean tryAcquire(int arg) {
        if (isHeldExclusively()) {
          // A reentrant acquire; increment hold count
          return true;
        } else if (hasQueuedPredecessors()) {
          return false;
        } else {
          // try to acquire normally
        }
      }}</pre>
      @return <code>true</code> if there is a queued thread preceding the
              current thread, and <code>false</code> if the current thread
              is at the head of the queue or the queue is empty
      @since 1.7</div>
<a id="L1512" name="L1512"></a>1512     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20257.html" title="Multiple referred from 4 places.">hasQueuedPredecessors</a>() <em class="brace">{</em>
<a id="L1513" name="L1513"></a>1513         <em class="comment">// The correctness of this depends on head being initialized</em>
<a id="L1514" name="L1514"></a>1514         <em class="comment">// before tail and on head.next being accurate if the current</em>
<a id="L1515" name="L1515"></a>1515         <em class="comment">// thread is first in queue.</em>
<a id="L1516" name="L1516"></a>1516         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail; <em class="comment">// Read fields in reverse initialization order</em>
<a id="L1517" name="L1517"></a>1517         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L1518" name="L1518"></a>1518         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s;
<a id="L1519" name="L1519"></a>1519         <strong class="reserved">return</strong> h != t &amp;&amp;
<a id="L1520" name="L1520"></a>1520             ((s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong> || s.thread != <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>());
<a id="L1521" name="L1521"></a>1521     <em class="brace">}</em>
<a id="L1522" name="L1522"></a>1522 
<a id="L1523" name="L1523"></a>1523 
<a id="L1524" name="L1524"></a>1524     <em class="comment">// Instrumentation and monitoring methods</em>
<a id="L1525" name="L1525"></a>1525 
<div class="comment">
      Returns an estimate of the number of threads waiting to
      acquire.  The value is only an estimate because the number of
      threads may change dynamically while this method traverses
      internal data structures.  This method is designed for use in
      monitoring system state, not for synchronization
      control.
      @return the estimated number of threads waiting to acquire</div>
<a id="L1536" name="L1536"></a>1536     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/18572.html" title="Multiple referred from 3 places.">getQueueLength</a>() <em class="brace">{</em>
<a id="L1537" name="L1537"></a>1537         <strong class="reserved">int</strong> n = 0;
<a id="L1538" name="L1538"></a>1538         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1539" name="L1539"></a>1539             <strong class="reserved">if</strong> (p.thread != <strong class="reserved">null</strong>)
<a id="L1540" name="L1540"></a>1540                 ++n;
<a id="L1541" name="L1541"></a>1541         <em class="brace">}</em>
<a id="L1542" name="L1542"></a>1542         <strong class="reserved">return</strong> n;
<a id="L1543" name="L1543"></a>1543     <em class="brace">}</em>
<a id="L1544" name="L1544"></a>1544 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire.  Because the actual set of threads may change
      dynamically while constructing this result, the returned
      collection is only a best-effort estimate.  The elements of the
      returned collection are in no particular order.  This method is
      designed to facilitate construction of subclasses that provide
      more extensive monitoring facilities.
      @return the collection of threads</div>
<a id="L1556" name="L1556"></a>1556     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/18573.html" title="Multiple referred from 3 places.">getQueuedThreads</a>() <em class="brace">{</em>
<a id="L1557" name="L1557"></a>1557         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L1558" name="L1558"></a>1558         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1559" name="L1559"></a>1559             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = p.thread;
<a id="L1560" name="L1560"></a>1560             <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L1561" name="L1561"></a>1561                 <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L1562" name="L1562"></a>1562         <em class="brace">}</em>
<a id="L1563" name="L1563"></a>1563         <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L1564" name="L1564"></a>1564     <em class="brace">}</em>
<a id="L1565" name="L1565"></a>1565 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire in exclusive mode. This has the same properties
      as <a href="#L1556" title="Defined at 1556.">getQueuedThreads</a> except that it only returns
      those threads waiting due to an exclusive acquire.
      @return the collection of threads</div>
<a id="L1574" name="L1574"></a>1574     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../S/1043.html#L1321" title="Referred from 1321 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">getExclusiveQueuedThreads</a>() <em class="brace">{</em>
<a id="L1575" name="L1575"></a>1575         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L1576" name="L1576"></a>1576         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1577" name="L1577"></a>1577             <strong class="reserved">if</strong> (!p.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>()) <em class="brace">{</em>
<a id="L1578" name="L1578"></a>1578                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = p.thread;
<a id="L1579" name="L1579"></a>1579                 <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L1580" name="L1580"></a>1580                     <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L1581" name="L1581"></a>1581             <em class="brace">}</em>
<a id="L1582" name="L1582"></a>1582         <em class="brace">}</em>
<a id="L1583" name="L1583"></a>1583         <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L1584" name="L1584"></a>1584     <em class="brace">}</em>
<a id="L1585" name="L1585"></a>1585 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire in shared mode. This has the same properties
      as <a href="#L1556" title="Defined at 1556.">getQueuedThreads</a> except that it only returns
      those threads waiting due to a shared acquire.
      @return the collection of threads</div>
<a id="L1594" name="L1594"></a>1594     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../S/1043.html#L1336" title="Referred from 1336 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">getSharedQueuedThreads</a>() <em class="brace">{</em>
<a id="L1595" name="L1595"></a>1595         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L1596" name="L1596"></a>1596         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1597" name="L1597"></a>1597             <strong class="reserved">if</strong> (p.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>()) <em class="brace">{</em>
<a id="L1598" name="L1598"></a>1598                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = p.thread;
<a id="L1599" name="L1599"></a>1599                 <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L1600" name="L1600"></a>1600                     <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L1601" name="L1601"></a>1601             <em class="brace">}</em>
<a id="L1602" name="L1602"></a>1602         <em class="brace">}</em>
<a id="L1603" name="L1603"></a>1603         <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L1604" name="L1604"></a>1604     <em class="brace">}</em>
<a id="L1605" name="L1605"></a>1605 
<div class="comment">
      Returns a string identifying this synchronizer, as well as its state.
      The state, in brackets, includes the String <code>"State ="</code>
      followed by the current value of <a href="#L540" title="Defined at 540.">getState</a>, and either
      <code>"nonempty"</code> or <code>"empty"</code> depending on whether the
      queue is empty.
      @return a string identifying this synchronizer, as well as its state</div>
<a id="L1615" name="L1615"></a>1615     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L1616" name="L1616"></a>1616         <strong class="reserved">int</strong> s = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L1617" name="L1617"></a>1617         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> q  = <a href="../D/24168.html" title="Multiple defined in 5 places.">hasQueuedThreads</a>() ? "non" : "";
<a id="L1618" name="L1618"></a>1618         <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L1619" name="L1619"></a>1619             "[State = " + s + ", " + q + "empty queue]";
<a id="L1620" name="L1620"></a>1620     <em class="brace">}</em>
<a id="L1621" name="L1621"></a>1621 
<a id="L1622" name="L1622"></a>1622 
<a id="L1623" name="L1623"></a>1623     <em class="comment">// Internal support methods for Conditions</em>
<a id="L1624" name="L1624"></a>1624 
<div class="comment">
      Returns true if a node, always one that was initially placed on
      a condition queue, is now waiting to reacquire on sync queue.
      @param node the node
      @return true if is reacquiring</div>
<a id="L1631" name="L1631"></a>1631     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21817.html" title="Multiple referred from 12 places.">isOnSyncQueue</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1632" name="L1632"></a>1632         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION || <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev == <strong class="reserved">null</strong>)
<a id="L1633" name="L1633"></a>1633             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1634" name="L1634"></a>1634         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != <strong class="reserved">null</strong>) <em class="comment">// If has successor, it must be on queue</em>
<a id="L1635" name="L1635"></a>1635             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<div class="comment">
          node.prev can be non-null, but not yet on queue because
          the CAS to place it on queue can fail. So we have to
          traverse from tail to make sure it actually made it.  It
          will always be near the tail in calls to this method, and
          unless the CAS failed (which is unlikely), it will be
          there, so we hardly ever traverse much.</div>
<a id="L1644" name="L1644"></a>1644         <strong class="reserved">return</strong> <a href="../D/16196.html" title="Multiple defined in 2 places.">findNodeFromTail</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1645" name="L1645"></a>1645     <em class="brace">}</em>
<a id="L1646" name="L1646"></a>1646 
<div class="comment">
      Returns true if node is on sync queue by searching backwards from tail.
      Called only when needed by isOnSyncQueue.
      @return true if present</div>
<a id="L1652" name="L1652"></a>1652     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/14443.html" title="Multiple referred from 2 places.">findNodeFromTail</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1653" name="L1653"></a>1653         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail;
<a id="L1654" name="L1654"></a>1654         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L1655" name="L1655"></a>1655             <strong class="reserved">if</strong> (t == <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)
<a id="L1656" name="L1656"></a>1656                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1657" name="L1657"></a>1657             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>)
<a id="L1658" name="L1658"></a>1658                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1659" name="L1659"></a>1659             t = t.prev;
<a id="L1660" name="L1660"></a>1660         <em class="brace">}</em>
<a id="L1661" name="L1661"></a>1661     <em class="brace">}</em>
<a id="L1662" name="L1662"></a>1662 
<div class="comment">
      Transfers a node from a condition queue onto sync queue.
      Returns true if successful.
      @param node the node
      @return true if successfully transferred (else the node was
      cancelled before signal)</div>
<a id="L1670" name="L1670"></a>1670     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29420.html" title="Multiple referred from 4 places.">transferForSignal</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<div class="comment">
          If cannot change waitStatus, the node has been cancelled.</div>
<a id="L1674" name="L1674"></a>1674         <strong class="reserved">if</strong> (!<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION, 0))
<a id="L1675" name="L1675"></a>1675             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1676" name="L1676"></a>1676 
<div class="comment">
          Splice onto queue and try to set waitStatus of predecessor to
          indicate that thread is (probably) waiting. If cancelled or
          attempt to set waitStatus fails, wake up to resync (in which
          case the waitStatus can be transiently and harmlessly wrong).</div>
<a id="L1683" name="L1683"></a>1683         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/15581.html" title="Multiple defined in 2 places.">enq</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1684" name="L1684"></a>1684         <strong class="reserved">int</strong> ws = p.waitStatus;
<a id="L1685" name="L1685"></a>1685         <strong class="reserved">if</strong> (ws &gt; 0 || !<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(p, ws, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL))
<a id="L1686" name="L1686"></a>1686             <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread);
<a id="L1687" name="L1687"></a>1687         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1688" name="L1688"></a>1688     <em class="brace">}</em>
<a id="L1689" name="L1689"></a>1689 
<div class="comment">
      Transfers node, if necessary, to sync queue after a cancelled wait.
      Returns true if thread was cancelled before being signalled.
      @param node the node
      @return true if cancelled before the node was signalled</div>
<a id="L1697" name="L1697"></a>1697     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29414.html" title="Multiple referred from 8 places.">transferAfterCancelledWait</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1698" name="L1698"></a>1698         <strong class="reserved">if</strong> (<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION, 0)) <em class="brace">{</em>
<a id="L1699" name="L1699"></a>1699             <a href="../D/15581.html" title="Multiple defined in 2 places.">enq</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1700" name="L1700"></a>1700             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1701" name="L1701"></a>1701         <em class="brace">}</em>
<div class="comment">
          If we lost out to a signal(), then we can't proceed
          until it finishes its enq().  Cancelling during an
          incomplete transfer is both rare and transient, so just
          spin.</div>
<a id="L1708" name="L1708"></a>1708         <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>))
<a id="L1709" name="L1709"></a>1709             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>();
<a id="L1710" name="L1710"></a>1710         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1711" name="L1711"></a>1711     <em class="brace">}</em>
<a id="L1712" name="L1712"></a>1712 
<div class="comment">
      Invokes release with current state value; returns saved state.
      Cancels node and throws exception on failure.
      @param node the condition node for this wait
      @return previous sync state</div>
<a id="L1719" name="L1719"></a>1719     <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/14827.html" title="Multiple referred from 10 places.">fullyRelease</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1720" name="L1720"></a>1720         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L1721" name="L1721"></a>1721         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1722" name="L1722"></a>1722             <strong class="reserved">int</strong> savedState = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L1723" name="L1723"></a>1723             <strong class="reserved">if</strong> (<a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(savedState)) <em class="brace">{</em>
<a id="L1724" name="L1724"></a>1724                 <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L1725" name="L1725"></a>1725                 <strong class="reserved">return</strong> savedState;
<a id="L1726" name="L1726"></a>1726             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1727" name="L1727"></a>1727                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1728" name="L1728"></a>1728             <em class="brace">}</em>
<a id="L1729" name="L1729"></a>1729         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L1730" name="L1730"></a>1730             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L1731" name="L1731"></a>1731                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus = <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CANCELLED;
<a id="L1732" name="L1732"></a>1732         <em class="brace">}</em>
<a id="L1733" name="L1733"></a>1733     <em class="brace">}</em>
<a id="L1734" name="L1734"></a>1734 
<a id="L1735" name="L1735"></a>1735     <em class="comment">// Instrumentation methods for conditions</em>
<a id="L1736" name="L1736"></a>1736 
<div class="comment">
      Queries whether the given ConditionObject
      uses this synchronizer as its lock.
      @param condition the condition
      @return <code>true</code> if owned
      @throws NullPointerException if the condition is null</div>
<a id="L1745" name="L1745"></a>1745     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/24077.html" title="Multiple referred from 6 places.">owns</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1746" name="L1746"></a>1746         <strong class="reserved">return</strong> condition.<a href="../D/26021.html" title="Multiple defined in 2 places.">isOwnedBy</a>(<strong class="reserved">this</strong>);
<a id="L1747" name="L1747"></a>1747     <em class="brace">}</em>
<a id="L1748" name="L1748"></a>1748 
<div class="comment">
      Queries whether any threads are waiting on the given condition
      associated with this synchronizer. Note that because timeouts
      and interrupts may occur at any time, a <code>true</code> return
      does not guarantee that a future <code>signal</code> will awaken
      any threads.  This method is designed primarily for use in
      monitoring of the system state.
      @param condition the condition
      @return <code>true</code> if there are any waiting threads
      @throws IllegalMonitorStateException if exclusive synchronization
              is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this synchronizer
      @throws NullPointerException if the condition is null</div>
<a id="L1765" name="L1765"></a>1765     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20290.html" title="Multiple referred from 6 places.">hasWaiters</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1766" name="L1766"></a>1766         <strong class="reserved">if</strong> (!<a href="../D/28638.html" title="Multiple defined in 2 places.">owns</a>(condition))
<a id="L1767" name="L1767"></a>1767             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Not owner");
<a id="L1768" name="L1768"></a>1768         <strong class="reserved">return</strong> condition.<a href="../D/24209.html" title="Multiple defined in 6 places.">hasWaiters</a>();
<a id="L1769" name="L1769"></a>1769     <em class="brace">}</em>
<a id="L1770" name="L1770"></a>1770 
<div class="comment">
      Returns an estimate of the number of threads waiting on the
      given condition associated with this synchronizer. Note that
      because timeouts and interrupts may occur at any time, the
      estimate serves only as an upper bound on the actual number of
      waiters.  This method is designed for use in monitoring of the
      system state, not for synchronization control.
      @param condition the condition
      @return the estimated number of waiting threads
      @throws IllegalMonitorStateException if exclusive synchronization
              is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this synchronizer
      @throws NullPointerException if the condition is null</div>
<a id="L1787" name="L1787"></a>1787     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19840.html" title="Multiple referred from 4 places.">getWaitQueueLength</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1788" name="L1788"></a>1788         <strong class="reserved">if</strong> (!<a href="../D/28638.html" title="Multiple defined in 2 places.">owns</a>(condition))
<a id="L1789" name="L1789"></a>1789             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Not owner");
<a id="L1790" name="L1790"></a>1790         <strong class="reserved">return</strong> condition.<a href="../D/23651.html" title="Multiple defined in 6 places.">getWaitQueueLength</a>();
<a id="L1791" name="L1791"></a>1791     <em class="brace">}</em>
<a id="L1792" name="L1792"></a>1792 
<div class="comment">
      Returns a collection containing those threads that may be
      waiting on the given condition associated with this
      synchronizer.  Because the actual set of threads may change
      dynamically while constructing this result, the returned
      collection is only a best-effort estimate. The elements of the
      returned collection are in no particular order.
      @param condition the condition
      @return the collection of threads
      @throws IllegalMonitorStateException if exclusive synchronization
              is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this synchronizer
      @throws NullPointerException if the condition is null</div>
<a id="L1809" name="L1809"></a>1809     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/19841.html" title="Multiple referred from 4 places.">getWaitingThreads</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1810" name="L1810"></a>1810         <strong class="reserved">if</strong> (!<a href="../D/28638.html" title="Multiple defined in 2 places.">owns</a>(condition))
<a id="L1811" name="L1811"></a>1811             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Not owner");
<a id="L1812" name="L1812"></a>1812         <strong class="reserved">return</strong> condition.<a href="../D/23655.html" title="Multiple defined in 6 places.">getWaitingThreads</a>();
<a id="L1813" name="L1813"></a>1813     <em class="brace">}</em>
<a id="L1814" name="L1814"></a>1814 
<div class="comment">
      Condition implementation for a {@link
      AbstractQueuedSynchronizer} serving as the basis of a {@link
      Lock} implementation.
      <p>Method documentation for this class describes mechanics,
      not behavioral specifications from the point of view of Lock
      and Condition users. Exported versions of this class will in
      general need to be accompanied by documentation describing
      condition semantics that rely on those of the associated
      <code>AbstractQueuedSynchronizer</code>.
      </p><p>This class is Serializable, but all fields are transient,
      so deserialized conditions have no waiters.</p></div>
<a id="L1830" name="L1830"></a>1830     <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/1639.html" title="Multiple referred from 24 places.">ConditionObject</a> <strong class="reserved">implements</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a>, <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L1831" name="L1831"></a>1831         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 1173984872572414699L;
<div class="comment">
         /** First node of condition queue. */</div>
<a id="L1833" name="L1833"></a>1833         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> firstWaiter;
<div class="comment">
         /** Last node of condition queue. */</div>
<a id="L1835" name="L1835"></a>1835         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> lastWaiter;
<a id="L1836" name="L1836"></a>1836 
<div class="comment">
          Creates a new <code>ConditionObject</code> instance.</div>
<a id="L1840" name="L1840"></a>1840         <strong class="reserved">public</strong> ConditionObject() <em class="brace">{</em> <em class="brace">}</em>
<a id="L1841" name="L1841"></a>1841 
<a id="L1842" name="L1842"></a>1842         <em class="comment">// Internal methods</em>
<a id="L1843" name="L1843"></a>1843 
<div class="comment">
          Adds a new waiter to wait queue.
          @return its new wait node</div>
<a id="L1848" name="L1848"></a>1848         <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/9663.html" title="Multiple referred from 10 places.">addConditionWaiter</a>() <em class="brace">{</em>
<a id="L1849" name="L1849"></a>1849             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = lastWaiter;
<a id="L1850" name="L1850"></a>1850             <em class="comment">// If lastWaiter is cancelled, clean out.</em>
<a id="L1851" name="L1851"></a>1851             <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong> &amp;&amp; t.waitStatus != <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION) <em class="brace">{</em>
<a id="L1852" name="L1852"></a>1852                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L1853" name="L1853"></a>1853                 t = lastWaiter;
<a id="L1854" name="L1854"></a>1854             <em class="brace">}</em>
<a id="L1855" name="L1855"></a>1855             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>(), <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION);
<a id="L1856" name="L1856"></a>1856             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>)
<a id="L1857" name="L1857"></a>1857                 firstWaiter = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1858" name="L1858"></a>1858             <strong class="reserved">else</strong>
<a id="L1859" name="L1859"></a>1859                 t.nextWaiter = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1860" name="L1860"></a>1860             lastWaiter = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1861" name="L1861"></a>1861             <strong class="reserved">return</strong> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1862" name="L1862"></a>1862         <em class="brace">}</em>
<a id="L1863" name="L1863"></a>1863 
<div class="comment">
          Removes and transfers nodes until hit non-cancelled one or
          null. Split out from signal in part to encourage compilers
          to inline the case of no waiters.
          @param first (non-null) the first node on condition queue</div>
<a id="L1870" name="L1870"></a>1870         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13446.html" title="Multiple referred from 2 places.">doSignal</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>) <em class="brace">{</em>
<a id="L1871" name="L1871"></a>1871             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1872" name="L1872"></a>1872                 <strong class="reserved">if</strong> ( (firstWaiter = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter) == <strong class="reserved">null</strong>)
<a id="L1873" name="L1873"></a>1873                     lastWaiter = <strong class="reserved">null</strong>;
<a id="L1874" name="L1874"></a>1874                 <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter = <strong class="reserved">null</strong>;
<a id="L1875" name="L1875"></a>1875             <em class="brace">}</em> <strong class="reserved">while</strong> (!<a href="../D/35584.html" title="Multiple defined in 2 places.">transferForSignal</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>) &amp;&amp;
<a id="L1876" name="L1876"></a>1876                      (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = firstWaiter) != <strong class="reserved">null</strong>);
<a id="L1877" name="L1877"></a>1877         <em class="brace">}</em>
<a id="L1878" name="L1878"></a>1878 
<div class="comment">
          Removes and transfers all nodes.
          @param first (non-null) the first node on condition queue</div>
<a id="L1883" name="L1883"></a>1883         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13447.html" title="Multiple referred from 2 places.">doSignalAll</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>) <em class="brace">{</em>
<a id="L1884" name="L1884"></a>1884             lastWaiter = firstWaiter = <strong class="reserved">null</strong>;
<a id="L1885" name="L1885"></a>1885             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1886" name="L1886"></a>1886                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter;
<a id="L1887" name="L1887"></a>1887                 <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter = <strong class="reserved">null</strong>;
<a id="L1888" name="L1888"></a>1888                 <a href="../D/35584.html" title="Multiple defined in 2 places.">transferForSignal</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L1889" name="L1889"></a>1889                 <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1890" name="L1890"></a>1890             <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> != <strong class="reserved">null</strong>);
<a id="L1891" name="L1891"></a>1891         <em class="brace">}</em>
<a id="L1892" name="L1892"></a>1892 
<div class="comment">
          Unlinks cancelled waiter nodes from condition queue.
          Called only while holding lock. This is called when
          cancellation occurred during condition wait, and upon
          insertion of a new waiter when lastWaiter is seen to have
          been cancelled. This method is needed to avoid garbage
          retention in the absence of signals. So even though it may
          require a full traversal, it comes into play only when
          timeouts or cancellations occur in the absence of
          signals. It traverses all nodes rather than stopping at a
          particular target to unlink all pointers to garbage nodes
          without requiring many re-traversals during cancellation
          storms.</div>
<a id="L1907" name="L1907"></a>1907         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/29706.html" title="Multiple referred from 10 places.">unlinkCancelledWaiters</a>() <em class="brace">{</em>
<a id="L1908" name="L1908"></a>1908             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = firstWaiter;
<a id="L1909" name="L1909"></a>1909             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> trail = <strong class="reserved">null</strong>;
<a id="L1910" name="L1910"></a>1910             <strong class="reserved">while</strong> (t != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1911" name="L1911"></a>1911                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = t.nextWaiter;
<a id="L1912" name="L1912"></a>1912                 <strong class="reserved">if</strong> (t.waitStatus != <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION) <em class="brace">{</em>
<a id="L1913" name="L1913"></a>1913                     t.nextWaiter = <strong class="reserved">null</strong>;
<a id="L1914" name="L1914"></a>1914                     <strong class="reserved">if</strong> (trail == <strong class="reserved">null</strong>)
<a id="L1915" name="L1915"></a>1915                         firstWaiter = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1916" name="L1916"></a>1916                     <strong class="reserved">else</strong>
<a id="L1917" name="L1917"></a>1917                         trail.nextWaiter = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1918" name="L1918"></a>1918                     <strong class="reserved">if</strong> (<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> == <strong class="reserved">null</strong>)
<a id="L1919" name="L1919"></a>1919                         lastWaiter = trail;
<a id="L1920" name="L1920"></a>1920                 <em class="brace">}</em>
<a id="L1921" name="L1921"></a>1921                 <strong class="reserved">else</strong>
<a id="L1922" name="L1922"></a>1922                     trail = t;
<a id="L1923" name="L1923"></a>1923                 t = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1924" name="L1924"></a>1924             <em class="brace">}</em>
<a id="L1925" name="L1925"></a>1925         <em class="brace">}</em>
<a id="L1926" name="L1926"></a>1926 
<a id="L1927" name="L1927"></a>1927         <em class="comment">// public methods</em>
<a id="L1928" name="L1928"></a>1928 
<div class="comment">
          Moves the longest-waiting thread, if one exists, from the
          wait queue for this condition to the wait queue for the
          owning lock.
          @throws IllegalMonitorStateException if <a href="#L1181" title="Defined at 1181.">isHeldExclusively</a>
                  returns <code>false</code></div>
<a id="L1937" name="L1937"></a>1937         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28605.html" title="Multiple referred from 27 places.">signal</a>() <em class="brace">{</em>
<a id="L1938" name="L1938"></a>1938             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L1939" name="L1939"></a>1939                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1940" name="L1940"></a>1940             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = firstWaiter;
<a id="L1941" name="L1941"></a>1941             <strong class="reserved">if</strong> (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> != <strong class="reserved">null</strong>)
<a id="L1942" name="L1942"></a>1942                 <a href="../D/15086.html" title="Multiple defined in 2 places.">doSignal</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L1943" name="L1943"></a>1943         <em class="brace">}</em>
<a id="L1944" name="L1944"></a>1944 
<div class="comment">
          Moves all threads from the wait queue for this condition to
          the wait queue for the owning lock.
          @throws IllegalMonitorStateException if <a href="#L1181" title="Defined at 1181.">isHeldExclusively</a>
                  returns <code>false</code></div>
<a id="L1952" name="L1952"></a>1952         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28606.html" title="Multiple referred from 10 places.">signalAll</a>() <em class="brace">{</em>
<a id="L1953" name="L1953"></a>1953             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L1954" name="L1954"></a>1954                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1955" name="L1955"></a>1955             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = firstWaiter;
<a id="L1956" name="L1956"></a>1956             <strong class="reserved">if</strong> (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> != <strong class="reserved">null</strong>)
<a id="L1957" name="L1957"></a>1957                 <a href="../D/15087.html" title="Multiple defined in 2 places.">doSignalAll</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L1958" name="L1958"></a>1958         <em class="brace">}</em>
<a id="L1959" name="L1959"></a>1959 
<div class="comment">
          Implements uninterruptible condition wait.
          <ol>
          <li> Save lock state returned by <a href="#L540" title="Defined at 540.">getState</a>.
          </li><li> Invoke <a href="#L1260" title="Defined at 1260.">release</a> with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled.
          </li><li> Reacquire by invoking specialized version of
               <a href="#L1197" title="Defined at 1197.">acquire</a> with saved state as argument.
          </li></ol></div>
<a id="L1971" name="L1971"></a>1971         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> awaitUninterruptibly() <em class="brace">{</em>
<a id="L1972" name="L1972"></a>1972             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L1973" name="L1973"></a>1973             <strong class="reserved">int</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1974" name="L1974"></a>1974             <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">false</strong>;
<a id="L1975" name="L1975"></a>1975             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1976" name="L1976"></a>1976                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L1977" name="L1977"></a>1977                 <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1978" name="L1978"></a>1978                     <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">true</strong>;
<a id="L1979" name="L1979"></a>1979             <em class="brace">}</em>
<a id="L1980" name="L1980"></a>1980             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) || <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>)
<a id="L1981" name="L1981"></a>1981                 <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L1982" name="L1982"></a>1982         <em class="brace">}</em>
<a id="L1983" name="L1983"></a>1983 
<div class="comment">
          For interruptible waits, we need to track whether to throw
          InterruptedException, if interrupted while blocked on
          condition, versus reinterrupt current thread, if
          interrupted while blocked waiting to re-acquire.</div>
<a id="L1990" name="L1990"></a>1990 
<div class="comment">
         /** Mode meaning to reinterrupt on exit from wait */</div>
<a id="L1992" name="L1992"></a>1992         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> REINTERRUPT =  1;
<div class="comment">
         /** Mode meaning to throw InterruptedException on exit from wait */</div>
<a id="L1994" name="L1994"></a>1994         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> THROW_IE    = -1;
<a id="L1995" name="L1995"></a>1995 
<div class="comment">
          Checks for interrupt, returning THROW_IE if interrupted
          before signalled, REINTERRUPT if after signalled, or
          0 if not interrupted.</div>
<a id="L2001" name="L2001"></a>2001         <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/11208.html" title="Multiple referred from 8 places.">checkInterruptWhileWaiting</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L2002" name="L2002"></a>2002             <strong class="reserved">return</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>() ?
<a id="L2003" name="L2003"></a>2003                 (<a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) ? THROW_IE : REINTERRUPT) :
<a id="L2004" name="L2004"></a>2004                 0;
<a id="L2005" name="L2005"></a>2005         <em class="brace">}</em>
<a id="L2006" name="L2006"></a>2006 
<div class="comment">
          Throws InterruptedException, reinterrupts current thread, or
          does nothing, depending on mode.</div>
<a id="L2011" name="L2011"></a>2011         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/26189.html" title="Multiple referred from 8 places.">reportInterruptAfterWait</a>(<strong class="reserved">int</strong> interruptMode)
<a id="L2012" name="L2012"></a>2012             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L2013" name="L2013"></a>2013             <strong class="reserved">if</strong> (interruptMode == THROW_IE)
<a id="L2014" name="L2014"></a>2014                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L2015" name="L2015"></a>2015             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (interruptMode == REINTERRUPT)
<a id="L2016" name="L2016"></a>2016                 <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L2017" name="L2017"></a>2017         <em class="brace">}</em>
<a id="L2018" name="L2018"></a>2018 
<div class="comment">
          Implements interruptible condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by <a href="#L540" title="Defined at 540.">getState</a>.
          </li><li> Invoke <a href="#L1260" title="Defined at 1260.">release</a> with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled or interrupted.
          </li><li> Reacquire by invoking specialized version of
               <a href="#L1197" title="Defined at 1197.">acquire</a> with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li></ol></div>
<a id="L2032" name="L2032"></a>2032         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10432.html" title="Multiple referred from 21 places.">await</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L2033" name="L2033"></a>2033             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L2034" name="L2034"></a>2034                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L2035" name="L2035"></a>2035             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L2036" name="L2036"></a>2036             <strong class="reserved">int</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2037" name="L2037"></a>2037             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L2038" name="L2038"></a>2038             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L2039" name="L2039"></a>2039                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L2040" name="L2040"></a>2040                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L2041" name="L2041"></a>2041                     <strong class="reserved">break</strong>;
<a id="L2042" name="L2042"></a>2042             <em class="brace">}</em>
<a id="L2043" name="L2043"></a>2043             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L2044" name="L2044"></a>2044                 interruptMode = REINTERRUPT;
<a id="L2045" name="L2045"></a>2045             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>) <em class="comment">// clean up if cancelled</em>
<a id="L2046" name="L2046"></a>2046                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L2047" name="L2047"></a>2047             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L2048" name="L2048"></a>2048                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L2049" name="L2049"></a>2049         <em class="brace">}</em>
<a id="L2050" name="L2050"></a>2050 
<div class="comment">
          Implements timed condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by <a href="#L540" title="Defined at 540.">getState</a>.
          </li><li> Invoke <a href="#L1260" title="Defined at 1260.">release</a> with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled, interrupted, or timed out.
          </li><li> Reacquire by invoking specialized version of
               <a href="#L1197" title="Defined at 1197.">acquire</a> with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li></ol></div>
<a id="L2064" name="L2064"></a>2064         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../R/10437.html" title="Multiple referred from 20 places.">awaitNanos</a>(<strong class="reserved">long</strong> nanosTimeout)
<a id="L2065" name="L2065"></a>2065                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L2066" name="L2066"></a>2066             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L2067" name="L2067"></a>2067                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L2068" name="L2068"></a>2068             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L2069" name="L2069"></a>2069             <strong class="reserved">int</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2070" name="L2070"></a>2070             <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L2071" name="L2071"></a>2071             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L2072" name="L2072"></a>2072             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L2073" name="L2073"></a>2073                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L) <em class="brace">{</em>
<a id="L2074" name="L2074"></a>2074                     <a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2075" name="L2075"></a>2075                     <strong class="reserved">break</strong>;
<a id="L2076" name="L2076"></a>2076                 <em class="brace">}</em>
<a id="L2077" name="L2077"></a>2077                 <strong class="reserved">if</strong> (nanosTimeout &gt;= spinForTimeoutThreshold)
<a id="L2078" name="L2078"></a>2078                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L2079" name="L2079"></a>2079                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L2080" name="L2080"></a>2080                     <strong class="reserved">break</strong>;
<a id="L2081" name="L2081"></a>2081                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L2082" name="L2082"></a>2082             <em class="brace">}</em>
<a id="L2083" name="L2083"></a>2083             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L2084" name="L2084"></a>2084                 interruptMode = REINTERRUPT;
<a id="L2085" name="L2085"></a>2085             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>)
<a id="L2086" name="L2086"></a>2086                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L2087" name="L2087"></a>2087             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L2088" name="L2088"></a>2088                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L2089" name="L2089"></a>2089             <strong class="reserved">return</strong> deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L2090" name="L2090"></a>2090         <em class="brace">}</em>
<a id="L2091" name="L2091"></a>2091 
<div class="comment">
          Implements absolute timed condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by <a href="#L540" title="Defined at 540.">getState</a>.
          </li><li> Invoke <a href="#L1260" title="Defined at 1260.">release</a> with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled, interrupted, or timed out.
          </li><li> Reacquire by invoking specialized version of
               <a href="#L1197" title="Defined at 1197.">acquire</a> with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li><li> If timed out while blocked in step 4, return false, else true.
          </li></ol></div>
<a id="L2106" name="L2106"></a>2106         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> awaitUntil(<a href="../D/2208.html" title="Multiple defined in 2 places.">Date</a> deadline)
<a id="L2107" name="L2107"></a>2107                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L2108" name="L2108"></a>2108             <strong class="reserved">long</strong> abstime = deadline.<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>();
<a id="L2109" name="L2109"></a>2109             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L2110" name="L2110"></a>2110                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L2111" name="L2111"></a>2111             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L2112" name="L2112"></a>2112             <strong class="reserved">int</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2113" name="L2113"></a>2113             <strong class="reserved">boolean</strong> timedout = <strong class="reserved">false</strong>;
<a id="L2114" name="L2114"></a>2114             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L2115" name="L2115"></a>2115             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L2116" name="L2116"></a>2116                 <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>() &gt; abstime) <em class="brace">{</em>
<a id="L2117" name="L2117"></a>2117                     timedout = <a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2118" name="L2118"></a>2118                     <strong class="reserved">break</strong>;
<a id="L2119" name="L2119"></a>2119                 <em class="brace">}</em>
<a id="L2120" name="L2120"></a>2120                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29075.html" title="Multiple defined in 2 places.">parkUntil</a>(<strong class="reserved">this</strong>, abstime);
<a id="L2121" name="L2121"></a>2121                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L2122" name="L2122"></a>2122                     <strong class="reserved">break</strong>;
<a id="L2123" name="L2123"></a>2123             <em class="brace">}</em>
<a id="L2124" name="L2124"></a>2124             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L2125" name="L2125"></a>2125                 interruptMode = REINTERRUPT;
<a id="L2126" name="L2126"></a>2126             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>)
<a id="L2127" name="L2127"></a>2127                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L2128" name="L2128"></a>2128             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L2129" name="L2129"></a>2129                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L2130" name="L2130"></a>2130             <strong class="reserved">return</strong> !timedout;
<a id="L2131" name="L2131"></a>2131         <em class="brace">}</em>
<a id="L2132" name="L2132"></a>2132 
<div class="comment">
          Implements timed condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by <a href="#L540" title="Defined at 540.">getState</a>.
          </li><li> Invoke <a href="#L1260" title="Defined at 1260.">release</a> with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled, interrupted, or timed out.
          </li><li> Reacquire by invoking specialized version of
               <a href="#L1197" title="Defined at 1197.">acquire</a> with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li><li> If timed out while blocked in step 4, return false, else true.
          </li></ol></div>
<a id="L2147" name="L2147"></a>2147         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/10432.html" title="Multiple referred from 21 places.">await</a>(<strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L2148" name="L2148"></a>2148                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L2149" name="L2149"></a>2149             <strong class="reserved">long</strong> nanosTimeout = unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);
<a id="L2150" name="L2150"></a>2150             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L2151" name="L2151"></a>2151                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L2152" name="L2152"></a>2152             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L2153" name="L2153"></a>2153             <strong class="reserved">int</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2154" name="L2154"></a>2154             <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L2155" name="L2155"></a>2155             <strong class="reserved">boolean</strong> timedout = <strong class="reserved">false</strong>;
<a id="L2156" name="L2156"></a>2156             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L2157" name="L2157"></a>2157             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L2158" name="L2158"></a>2158                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L) <em class="brace">{</em>
<a id="L2159" name="L2159"></a>2159                     timedout = <a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L2160" name="L2160"></a>2160                     <strong class="reserved">break</strong>;
<a id="L2161" name="L2161"></a>2161                 <em class="brace">}</em>
<a id="L2162" name="L2162"></a>2162                 <strong class="reserved">if</strong> (nanosTimeout &gt;= spinForTimeoutThreshold)
<a id="L2163" name="L2163"></a>2163                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L2164" name="L2164"></a>2164                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L2165" name="L2165"></a>2165                     <strong class="reserved">break</strong>;
<a id="L2166" name="L2166"></a>2166                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L2167" name="L2167"></a>2167             <em class="brace">}</em>
<a id="L2168" name="L2168"></a>2168             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L2169" name="L2169"></a>2169                 interruptMode = REINTERRUPT;
<a id="L2170" name="L2170"></a>2170             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>)
<a id="L2171" name="L2171"></a>2171                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L2172" name="L2172"></a>2172             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L2173" name="L2173"></a>2173                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L2174" name="L2174"></a>2174             <strong class="reserved">return</strong> !timedout;
<a id="L2175" name="L2175"></a>2175         <em class="brace">}</em>
<a id="L2176" name="L2176"></a>2176 
<a id="L2177" name="L2177"></a>2177         <em class="comment">//  support for instrumentation</em>
<a id="L2178" name="L2178"></a>2178 
<div class="comment">
          Returns true if this condition was created by the given
          synchronization object.
          @return <code>true</code> if owned</div>
<a id="L2185" name="L2185"></a>2185         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21845.html" title="Multiple referred from 2 places.">isOwnedBy</a>(<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>) <em class="brace">{</em>
<a id="L2186" name="L2186"></a>2186             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a> == <a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<strong class="reserved">this</strong>;
<a id="L2187" name="L2187"></a>2187         <em class="brace">}</em>
<a id="L2188" name="L2188"></a>2188 
<div class="comment">
          Queries whether any threads are waiting on this condition.
          Implements {@link AbstractQueuedSynchronizer#hasWaiters(ConditionObject)}.
          @return <code>true</code> if there are any waiting threads
          @throws IllegalMonitorStateException if <a href="#L1181" title="Defined at 1181.">isHeldExclusively</a>
                  returns <code>false</code></div>
<a id="L2197" name="L2197"></a>2197         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20290.html" title="Multiple referred from 6 places.">hasWaiters</a>() <em class="brace">{</em>
<a id="L2198" name="L2198"></a>2198             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L2199" name="L2199"></a>2199                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L2200" name="L2200"></a>2200             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> w = firstWaiter; w != <strong class="reserved">null</strong>; w = w.nextWaiter) <em class="brace">{</em>
<a id="L2201" name="L2201"></a>2201                 <strong class="reserved">if</strong> (w.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION)
<a id="L2202" name="L2202"></a>2202                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L2203" name="L2203"></a>2203             <em class="brace">}</em>
<a id="L2204" name="L2204"></a>2204             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L2205" name="L2205"></a>2205         <em class="brace">}</em>
<a id="L2206" name="L2206"></a>2206 
<div class="comment">
          Returns an estimate of the number of threads waiting on
          this condition.
          Implements {@link AbstractQueuedSynchronizer#getWaitQueueLength(ConditionObject)}.
          @return the estimated number of waiting threads
          @throws IllegalMonitorStateException if <a href="#L1181" title="Defined at 1181.">isHeldExclusively</a>
                  returns <code>false</code></div>
<a id="L2216" name="L2216"></a>2216         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19840.html" title="Multiple referred from 4 places.">getWaitQueueLength</a>() <em class="brace">{</em>
<a id="L2217" name="L2217"></a>2217             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L2218" name="L2218"></a>2218                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L2219" name="L2219"></a>2219             <strong class="reserved">int</strong> n = 0;
<a id="L2220" name="L2220"></a>2220             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> w = firstWaiter; w != <strong class="reserved">null</strong>; w = w.nextWaiter) <em class="brace">{</em>
<a id="L2221" name="L2221"></a>2221                 <strong class="reserved">if</strong> (w.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION)
<a id="L2222" name="L2222"></a>2222                     ++n;
<a id="L2223" name="L2223"></a>2223             <em class="brace">}</em>
<a id="L2224" name="L2224"></a>2224             <strong class="reserved">return</strong> n;
<a id="L2225" name="L2225"></a>2225         <em class="brace">}</em>
<a id="L2226" name="L2226"></a>2226 
<div class="comment">
          Returns a collection containing those threads that may be
          waiting on this Condition.
          Implements {@link AbstractQueuedSynchronizer#getWaitingThreads(ConditionObject)}.
          @return the collection of threads
          @throws IllegalMonitorStateException if <a href="#L1181" title="Defined at 1181.">isHeldExclusively</a>
                  returns <code>false</code></div>
<a id="L2236" name="L2236"></a>2236         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/19841.html" title="Multiple referred from 4 places.">getWaitingThreads</a>() <em class="brace">{</em>
<a id="L2237" name="L2237"></a>2237             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L2238" name="L2238"></a>2238                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L2239" name="L2239"></a>2239             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L2240" name="L2240"></a>2240             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> w = firstWaiter; w != <strong class="reserved">null</strong>; w = w.nextWaiter) <em class="brace">{</em>
<a id="L2241" name="L2241"></a>2241                 <strong class="reserved">if</strong> (w.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION) <em class="brace">{</em>
<a id="L2242" name="L2242"></a>2242                     <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = w.thread;
<a id="L2243" name="L2243"></a>2243                     <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L2244" name="L2244"></a>2244                         <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L2245" name="L2245"></a>2245                 <em class="brace">}</em>
<a id="L2246" name="L2246"></a>2246             <em class="brace">}</em>
<a id="L2247" name="L2247"></a>2247             <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L2248" name="L2248"></a>2248         <em class="brace">}</em>
<a id="L2249" name="L2249"></a>2249     <em class="brace">}</em>
<a id="L2250" name="L2250"></a>2250 
<div class="comment">
      Setup to support compareAndSet. We need to natively implement
      this here: For the sake of permitting future enhancements, we
      cannot explicitly subclass AtomicInteger, which would be
      efficient and useful otherwise. So, as the lesser of evils, we
      natively implement using hotspot intrinsics API. And while we
      are at it, we do the same for other CASable fields (which could
      otherwise be done with atomic field updaters).</div>
<a id="L2260" name="L2260"></a>2260     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> Unsafe <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a> = Unsafe.getUnsafe();
<a id="L2261" name="L2261"></a>2261     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> stateOffset;
<a id="L2262" name="L2262"></a>2262     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> headOffset;
<a id="L2263" name="L2263"></a>2263     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> tailOffset;
<a id="L2264" name="L2264"></a>2264     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> waitStatusOffset;
<a id="L2265" name="L2265"></a>2265     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>;
<a id="L2266" name="L2266"></a>2266 
<a id="L2267" name="L2267"></a>2267     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L2268" name="L2268"></a>2268         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L2269" name="L2269"></a>2269             stateOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2270" name="L2270"></a>2270                 (<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("state"));
<a id="L2271" name="L2271"></a>2271             headOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2272" name="L2272"></a>2272                 (<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("head"));
<a id="L2273" name="L2273"></a>2273             tailOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2274" name="L2274"></a>2274                 (<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("tail"));
<a id="L2275" name="L2275"></a>2275             waitStatusOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2276" name="L2276"></a>2276                 (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("waitStatus"));
<a id="L2277" name="L2277"></a>2277             <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a> = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2278" name="L2278"></a>2278                 (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("next"));
<a id="L2279" name="L2279"></a>2279 
<a id="L2280" name="L2280"></a>2280         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em> <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(<a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>); <em class="brace">}</em>
<a id="L2281" name="L2281"></a>2281     <em class="brace">}</em>
<a id="L2282" name="L2282"></a>2282 
<div class="comment">
      CAS head field. Used only by enq.</div>
<a id="L2286" name="L2286"></a>2286     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11696.html" title="Multiple referred from 2 places.">compareAndSetHead</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2287" name="L2287"></a>2287         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapObject(<strong class="reserved">this</strong>, headOffset, <strong class="reserved">null</strong>, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2288" name="L2288"></a>2288     <em class="brace">}</em>
<a id="L2289" name="L2289"></a>2289 
<div class="comment">
      CAS tail field. Used only by enq.</div>
<a id="L2293" name="L2293"></a>2293     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11701.html" title="Multiple referred from 6 places.">compareAndSetTail</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> expect, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2294" name="L2294"></a>2294         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapObject(<strong class="reserved">this</strong>, tailOffset, expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2295" name="L2295"></a>2295     <em class="brace">}</em>
<a id="L2296" name="L2296"></a>2296 
<div class="comment">
      CAS waitStatus field of a node.</div>
<a id="L2300" name="L2300"></a>2300     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11702.html" title="Multiple referred from 16 places.">compareAndSetWaitStatus</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>,
<a id="L2301" name="L2301"></a>2301                                                          <strong class="reserved">int</strong> expect,
<a id="L2302" name="L2302"></a>2302                                                          <strong class="reserved">int</strong> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2303" name="L2303"></a>2303         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapInt(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, waitStatusOffset,
<a id="L2304" name="L2304"></a>2304                                         expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2305" name="L2305"></a>2305     <em class="brace">}</em>
<a id="L2306" name="L2306"></a>2306 
<div class="comment">
      CAS next field of a node.</div>
<a id="L2310" name="L2310"></a>2310     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11697.html" title="Multiple referred from 4 places.">compareAndSetNext</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>,
<a id="L2311" name="L2311"></a>2311                                                    <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> expect,
<a id="L2312" name="L2312"></a>2312                                                    <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2313" name="L2313"></a>2313         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapObject(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>, expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2314" name="L2314"></a>2314     <em class="brace">}</em>
<a id="L2315" name="L2315"></a>2315 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L483">[^]</a><a href="#L2310">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>