<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/lang/reflect/Proxy.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L361">[^]</a><a href="#L834">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L361" title="Defined at 361.">getProxyClass</a></li>
<li><a href="#L392" title="Defined at 392.">checkProxyAccess</a></li>
<li><a href="#L410" title="Defined at 410.">getProxyClass0</a></li>
<li><a href="#L444" title="Defined at 444.">hashCode</a></li>
<li><a href="#L449" title="Defined at 449.">equals</a></li>
<li><a href="#L473" title="Defined at 473.">hashCode</a></li>
<li><a href="#L478" title="Defined at 478.">equals</a></li>
<li><a href="#L498" title="Defined at 498.">SuppressWarnings</a></li>
<li><a href="#L508" title="Defined at 508.">hashCode</a></li>
<li><a href="#L513" title="Defined at 513.">equals</a></li>
<li><a href="#L520" title="Defined at 520.">equals</a></li>
<li><a href="#L543" title="Defined at 543.">apply</a></li>
<li><a href="#L567" title="Defined at 567.">apply</a></li>
<li><a href="#L703" title="Defined at 703.">newProxyInstance</a></li>
<li><a href="#L754" title="Defined at 754.">checkNewProxyPermission</a></li>
<li><a href="#L790" title="Defined at 790.">isProxyClass</a></li>
<li><a href="#L809" title="Defined at 809.">getInvocationHandler</a></li>
<li><a href="#L834" title="Defined at 834.">defineClass0</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1999, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.lang.reflect;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.lang.ref.WeakReference;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.security.AccessController;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.security.PrivilegedAction;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.util.Arrays;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.util.IdentityHashMap;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.util.Map;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> java.util.Objects;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> java.util.concurrent.atomic.AtomicLong;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.util.function.BiFunction;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> sun.misc.ProxyGenerator;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> sun.misc.VM;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> sun.reflect.CallerSensitive;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> sun.reflect.Reflection;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> sun.reflect.misc.ReflectUtil;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> sun.security.util.SecurityConstants;
<a id="L43" name="L43"></a>  43 
<div class="comment">
  <code>Proxy</code> provides static methods for creating dynamic proxy
  classes and instances, and it is also the superclass of all
  dynamic proxy classes created by those methods.
  <p>To create a proxy for some interface <code>Foo</code>:
  </p><pre>      InvocationHandler handler = new MyInvocationHandler(...);
      Class&lt;?&gt; proxyClass = Proxy.getProxyClass(Foo.class.getClassLoader(), Foo.class);
      Foo f = (Foo) proxyClass.getConstructor(InvocationHandler.class).
                      newInstance(handler);
  </pre>
  or more simply:
  <pre>      Foo f = (Foo) Proxy.newProxyInstance(Foo.class.getClassLoader(),
                                           new Class&lt;?&gt;[] { Foo.class },
                                           handler);
  </pre>
  <p>A <i>dynamic proxy class</i> (simply referred to as a <i>proxy
  class</i> below) is a class that implements a list of interfaces
  specified at runtime when the class is created, with behavior as
  described below.
  A <i>proxy interface</i> is such an interface that is implemented
  by a proxy class.
  A <i>proxy instance</i> is an instance of a proxy class.
  Each proxy instance has an associated <i>invocation handler</i>
  object, which implements the interface {@link InvocationHandler}.
  A method invocation on a proxy instance through one of its proxy
  interfaces will be dispatched to the {@link InvocationHandler#invoke
  invoke} method of the instance's invocation handler, passing the proxy
  instance, a <code>java.lang.reflect.Method</code> object identifying
  the method that was invoked, and an array of type <code>Object</code>
  containing the arguments.  The invocation handler processes the
  encoded method invocation as appropriate and the result that it
  returns will be returned as the result of the method invocation on
  the proxy instance.
  </p><p>A proxy class has the following properties:
  </p><ul><li>Proxy classes are <em>public, final, and not abstract</em> if
  all proxy interfaces are public.</li><li>Proxy classes are <em>non-public, final, and not abstract</em> if
  any of the proxy interfaces is non-public.</li><li>The unqualified name of a proxy class is unspecified.  The space
  of class names that begin with the string <code>"$Proxy"</code>
  should be, however, reserved for proxy classes.
  </li><li>A proxy class extends <code>java.lang.reflect.Proxy</code>.
  </li><li>A proxy class implements exactly the interfaces specified at its
  creation, in the same order.
  </li><li>If a proxy class implements a non-public interface, then it will
  be defined in the same package as that interface.  Otherwise, the
  package of a proxy class is also unspecified.  Note that package
  sealing will not prevent a proxy class from being successfully defined
  in a particular package at runtime, and neither will classes already
  defined by the same class loader and the same package with particular
  signers.
  </li><li>Since a proxy class implements all of the interfaces specified at
  its creation, invoking <code>getInterfaces</code> on its
  <code>Class</code> object will return an array containing the same
  list of interfaces (in the order specified at its creation), invoking
  <code>getMethods</code> on its <code>Class</code> object will return
  an array of <code>Method</code> objects that include all of the
  methods in those interfaces, and invoking <code>getMethod</code> will
  find methods in the proxy interfaces as would be expected.
  </li><li>The {@link Proxy#isProxyClass Proxy.isProxyClass} method will
  return true if it is passed a proxy class-- a class returned by
  <code>Proxy.getProxyClass</code> or the class of an object returned by
  <code>Proxy.newProxyInstance</code>-- and false otherwise.
  </li><li>The <code>java.security.ProtectionDomain</code> of a proxy class
  is the same as that of system classes loaded by the bootstrap class
  loader, such as <code>java.lang.Object</code>, because the code for a
  proxy class is generated by trusted system code.  This protection
  domain will typically be granted
  <code>java.security.AllPermission</code>.
  </li><li>Each proxy class has one public constructor that takes one argument,
  an implementation of the interface {@link InvocationHandler}, to set
  the invocation handler for a proxy instance.  Rather than having to use
  the reflection API to access the public constructor, a proxy instance
  can be also be created by calling the {@link Proxy#newProxyInstance
  Proxy.newProxyInstance} method, which combines the actions of calling
  {@link Proxy#getProxyClass Proxy.getProxyClass} with invoking the
  constructor with an invocation handler.
  </li></ul>
  <p>A proxy instance has the following properties:
  </p><ul><li>Given a proxy instance <code>proxy</code> and one of the
  interfaces implemented by its proxy class <code>Foo</code>, the
  following expression will return true:
  <pre>      <code>proxy instanceof Foo</code>
  </pre>
  and the following cast operation will succeed (rather than throwing
  a <code>ClassCastException</code>):
  <pre>      <code>(Foo) proxy</code>
  </pre>
  </li><li>Each proxy instance has an associated invocation handler, the one
  that was passed to its constructor.  The static
  {@link Proxy#getInvocationHandler Proxy.getInvocationHandler} method
  will return the invocation handler associated with the proxy instance
  passed as its argument.
  </li><li>An interface method invocation on a proxy instance will be
  encoded and dispatched to the invocation handler's {@link
  InvocationHandler#invoke invoke} method as described in the
  documentation for that method.
  </li><li>An invocation of the <code>hashCode</code>,
  <code>equals</code>, or <code>toString</code> methods declared in
  <code>java.lang.Object</code> on a proxy instance will be encoded and
  dispatched to the invocation handler's <code>invoke</code> method in
  the same manner as interface method invocations are encoded and
  dispatched, as described above.  The declaring class of the
  <code>Method</code> object passed to <code>invoke</code> will be
  <code>java.lang.Object</code>.  Other public methods of a proxy
  instance inherited from <code>java.lang.Object</code> are not
  overridden by a proxy class, so invocations of those methods behave
  like they do for instances of <code>java.lang.Object</code>.
  </li></ul>
  <h3>Methods Duplicated in Multiple Proxy Interfaces</h3>
  <p>When two or more interfaces of a proxy class contain a method with
  the same name and parameter signature, the order of the proxy class's
  interfaces becomes significant.  When such a <i>duplicate method</i>
  is invoked on a proxy instance, the <code>Method</code> object passed
  to the invocation handler will not necessarily be the one whose
  declaring class is assignable from the reference type of the interface
  that the proxy's method was invoked through.  This limitation exists
  because the corresponding method implementation in the generated proxy
  class cannot determine which interface it was invoked through.
  Therefore, when a duplicate method is invoked on a proxy instance,
  the <code>Method</code> object for the method in the foremost interface
  that contains the method (either directly or inherited through a
  superinterface) in the proxy class's list of interfaces is passed to
  the invocation handler's <code>invoke</code> method, regardless of the
  reference type through which the method invocation occurred.
  </p><p>If a proxy interface contains a method with the same name and
  parameter signature as the <code>hashCode</code>, <code>equals</code>,
  or <code>toString</code> methods of <code>java.lang.Object</code>,
  when such a method is invoked on a proxy instance, the
  <code>Method</code> object passed to the invocation handler will have
  <code>java.lang.Object</code> as its declaring class.  In other words,
  the public, non-final methods of <code>java.lang.Object</code>
  logically precede all of the proxy interfaces for the determination of
  which <code>Method</code> object to pass to the invocation handler.
  </p><p>Note also that when a duplicate method is dispatched to an
  invocation handler, the <code>invoke</code> method may only throw
  checked exception types that are assignable to one of the exception
  types in the <code>throws</code> clause of the method in <i>all</i> of
  the proxy interfaces that it can be invoked through.  If the
  <code>invoke</code> method throws a checked exception that is not
  assignable to any of the exception types declared by the method in one
  of the proxy interfaces that it can be invoked through, then an
  unchecked <code>UndeclaredThrowableException</code> will be thrown by
  the invocation on the proxy instance.  This restriction means that not
  all of the exception types returned by invoking
  <code>getExceptionTypes</code> on the <code>Method</code> object
  passed to the <code>invoke</code> method can necessarily be thrown
  successfully by the <code>invoke</code> method.
  @author      Peter Jones
  @see         InvocationHandler
  @since       1.3</p></div>
<a id="L228" name="L228"></a> 228 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/6341.html" title="Multiple referred from 97 places.">Proxy</a> <strong class="reserved">implements</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L229" name="L229"></a> 229 
<a id="L230" name="L230"></a> 230     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -2222568056686623797L;
<a id="L231" name="L231"></a> 231 
<div class="comment">
     /** parameter types of a proxy class constructor */</div>
<a id="L233" name="L233"></a> 233     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] constructorParams =
<a id="L234" name="L234"></a> 234         <em class="brace">{</em> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a>.<strong class="reserved">class</strong> <em class="brace">}</em>;
<a id="L235" name="L235"></a> 235 
<div class="comment">
      a cache of proxy classes</div>
<a id="L239" name="L239"></a> 239     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1643.html#L57" title="Defined at 57 in src/java/lang/reflect/WeakCache.java.">WeakCache</a>&lt;<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a>, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[], <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;
<a id="L240" name="L240"></a> 240         proxyClassCache = <strong class="reserved">new</strong> <a href="../S/1643.html#L57" title="Defined at 57 in src/java/lang/reflect/WeakCache.java.">WeakCache</a>&lt;&gt;(<strong class="reserved">new</strong> <a href="../D/4794.html" title="Multiple defined in 2 places.">KeyFactory</a>(), <strong class="reserved">new</strong> <a href="../S/1663.html#L557" title="Defined at 557 in src/java/lang/reflect/Proxy.java.">ProxyClassFactory</a>());
<a id="L241" name="L241"></a> 241 
<div class="comment">
      the invocation handler for this proxy instance.
      @serial</div>
<a id="L246" name="L246"></a> 246     <strong class="reserved">protected</strong> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> h;
<a id="L247" name="L247"></a> 247 
<div class="comment">
      Prohibits instantiation.</div>
<a id="L251" name="L251"></a> 251     <strong class="reserved">private</strong> Proxy() <em class="brace">{</em>
<a id="L252" name="L252"></a> 252     <em class="brace">}</em>
<a id="L253" name="L253"></a> 253 
<div class="comment">
      Constructs a new <code>Proxy</code> instance from a subclass
      (typically, a dynamic proxy class) with the specified value
      for its invocation handler.
      @param  h the invocation handler for this proxy instance
      @throws NullPointerException if the given invocation handler, <code>h</code>,
              is <code>null</code>.</div>
<a id="L264" name="L264"></a> 264     <strong class="reserved">protected</strong> Proxy(<a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> h) <em class="brace">{</em>
<a id="L265" name="L265"></a> 265         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(h);
<a id="L266" name="L266"></a> 266         <strong class="reserved">this</strong>.h = h;
<a id="L267" name="L267"></a> 267     <em class="brace">}</em>
<a id="L268" name="L268"></a> 268 
<div class="comment">
      Returns the <code>java.lang.Class</code> object for a proxy class
      given a class loader and an array of interfaces.  The proxy class
      will be defined by the specified class loader and will implement
      all of the supplied interfaces.  If any of the given interfaces
      is non-public, the proxy class will be non-public. If a proxy class
      for the same permutation of interfaces has already been defined by the
      class loader, then the existing proxy class will be returned; otherwise,
      a proxy class for those interfaces will be generated dynamically
      and defined by the class loader.
      <p>There are several restrictions on the parameters that may be
      passed to <code>Proxy.getProxyClass</code>:
      </p><ul><li>All of the <code>Class</code> objects in the
      <code>interfaces</code> array must represent interfaces, not
      classes or primitive types.
      </li><li>No two elements in the <code>interfaces</code> array may
      refer to identical <code>Class</code> objects.
      </li><li>All of the interface types must be visible by name through the
      specified class loader.  In other words, for class loader
      <code>cl</code> and every interface <code>i</code>, the following
      expression must be true:
      <pre>          Class.forName(i.getName(), false, cl) == i
      </pre>
      </li><li>All non-public interfaces must be in the same package;
      otherwise, it would not be possible for the proxy class to
      implement all of the interfaces, regardless of what package it is
      defined in.
      </li><li>For any set of member methods of the specified interfaces
      that have the same signature:
      <ul><li>If the return type of any of the methods is a primitive
      type or void, then all of the methods must have that same
      return type.
      </li><li>Otherwise, one of the methods must have a return type that
      is assignable to all of the return types of the rest of the
      methods.
      </li></ul>
      </li><li>The resulting proxy class must not exceed any limits imposed
      on classes by the virtual machine.  For example, the VM may limit
      the number of interfaces that a class may implement to 65535; in
      that case, the size of the <code>interfaces</code> array must not
      exceed 65535.
      </li></ul>
      <p>If any of these restrictions are violated,
      <code>Proxy.getProxyClass</code> will throw an
      <code>IllegalArgumentException</code>.  If the <code>interfaces</code>
      array argument or any of its elements are <code>null</code>, a
      <code>NullPointerException</code> will be thrown.
      </p><p>Note that the order of the specified proxy interfaces is
      significant: two requests for a proxy class with the same combination
      of interfaces but in a different order will result in two distinct
      proxy classes.
      @param   loader the class loader to define the proxy class
      @param   interfaces the list of interfaces for the proxy class
               to implement
      @return  a proxy class that is defined in the specified class loader
               and that implements the specified interfaces
      @throws  IllegalArgumentException if any of the restrictions on the
               parameters that may be passed to <code>getProxyClass</code>
               are violated
      @throws  SecurityException if a security manager, <em>s</em>, is present
               and any of the following conditions is met:
               </p><ul><li> the given <code>loader</code> is <code>null</code> and
                  the caller's class loader is not <code>null</code> and the
                  invocation of {@link SecurityManager#checkPermission
                  s.checkPermission} with
                  <code>RuntimePermission("getClassLoader")</code> permission
                  denies access.</li><li> for each proxy interface, <code>intf</code>,
                  the caller's class loader is not the same as or an
                  ancestor of the class loader for <code>intf</code> and
                  invocation of {@link SecurityManager#checkPackageAccess
                  s.checkPackageAccess()} denies access to <code>intf</code>.</li>
               </ul>
      @throws  NullPointerException if the <code>interfaces</code> array
               argument or any of its elements are <code>null</code></div>
<a id="L360" name="L360"></a> 360     @CallerSensitive
<a id="L361" name="L361"></a> 361     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; <a href="../S/1378.html#L713" title="Referred from 713 in src/java/io/ObjectInputStream.java.">getProxyClass</a>(<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader,
<a id="L362" name="L362"></a> 362                                          <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;... <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>)
<a id="L363" name="L363"></a> 363         <strong class="reserved">throws</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>
<a id="L364" name="L364"></a> 364     <em class="brace">{</em>
<a id="L365" name="L365"></a> 365         <strong class="reserved">final</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] intfs = <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/12888.html" title="Multiple defined in 229 places.">clone</a>();
<a id="L366" name="L366"></a> 366         <strong class="reserved">final</strong> <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> sm = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L367" name="L367"></a> 367         <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L368" name="L368"></a> 368             <a href="../S/1663.html#L392" title="Defined at 392 in src/java/lang/reflect/Proxy.java.">checkProxyAccess</a>(Reflection.getCallerClass(), loader, intfs);
<a id="L369" name="L369"></a> 369         <em class="brace">}</em>
<a id="L370" name="L370"></a> 370 
<a id="L371" name="L371"></a> 371         <strong class="reserved">return</strong> <a href="../S/1663.html#L410" title="Defined at 410 in src/java/lang/reflect/Proxy.java.">getProxyClass0</a>(loader, intfs);
<a id="L372" name="L372"></a> 372     <em class="brace">}</em>
<a id="L373" name="L373"></a> 373 
<div class="comment">
      Check permissions required to create a Proxy class.
      To define a proxy class, it performs the access checks as in
      Class.forName (VM will invoke ClassLoader.checkPackageAccess):
      1. "getClassLoader" permission check if loader == null
      2. checkPackageAccess on the interfaces it implements
      To get a constructor and new instance of a proxy class, it performs
      the package access check on the interfaces it implements
      as in Class.getConstructor.
      If an interface is non-public, the proxy class must be defined by
      the defining loader of the interface.  If the caller's class loader
      is not the same as the defining loader of the interface, the VM
      will throw IllegalAccessError when the generated proxy class is
      being defined via the defineClass0 method.</div>
<a id="L392" name="L392"></a> 392     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/11309.html" title="Multiple referred from 2 places.">checkProxyAccess</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; caller,
<a id="L393" name="L393"></a> 393                                          <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader,
<a id="L394" name="L394"></a> 394                                          <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;... <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>)
<a id="L395" name="L395"></a> 395     <em class="brace">{</em>
<a id="L396" name="L396"></a> 396         <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> sm = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L397" name="L397"></a> 397         <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L398" name="L398"></a> 398             <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> ccl = caller.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>();
<a id="L399" name="L399"></a> 399             <strong class="reserved">if</strong> (VM.isSystemDomainLoader(loader) &amp;&amp; !VM.isSystemDomainLoader(ccl)) <em class="brace">{</em>
<a id="L400" name="L400"></a> 400                 sm.<a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>(SecurityConstants.GET_CLASSLOADER_PERMISSION);
<a id="L401" name="L401"></a> 401             <em class="brace">}</em>
<a id="L402" name="L402"></a> 402             ReflectUtil.checkProxyPackageAccess(ccl, <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>);
<a id="L403" name="L403"></a> 403         <em class="brace">}</em>
<a id="L404" name="L404"></a> 404     <em class="brace">}</em>
<a id="L405" name="L405"></a> 405 
<div class="comment">
      Generate a proxy class.  Must call the checkProxyAccess method
      to perform permission checks before calling this.</div>
<a id="L410" name="L410"></a> 410     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; <a href="../R/18548.html" title="Multiple referred from 2 places.">getProxyClass0</a>(<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader,
<a id="L411" name="L411"></a> 411                                            <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;... <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>) <em class="brace">{</em>
<a id="L412" name="L412"></a> 412         <strong class="reserved">if</strong> (<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt; 65535) <em class="brace">{</em>
<a id="L413" name="L413"></a> 413             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("interface limit exceeded");
<a id="L414" name="L414"></a> 414         <em class="brace">}</em>
<a id="L415" name="L415"></a> 415 
<a id="L416" name="L416"></a> 416         <em class="comment">// If the proxy class defined by the given loader implementing</em>
<a id="L417" name="L417"></a> 417         <em class="comment">// the given interfaces exists, this will simply return the cached copy;</em>
<a id="L418" name="L418"></a> 418         <em class="comment">// otherwise, it will create the proxy class via the ProxyClassFactory</em>
<a id="L419" name="L419"></a> 419         <strong class="reserved">return</strong> proxyClassCache.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(loader, <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>);
<a id="L420" name="L420"></a> 420     <em class="brace">}</em>
<a id="L421" name="L421"></a> 421 
<div class="comment">
      a key used for proxy class with 0 implemented interfaces</div>
<a id="L425" name="L425"></a> 425     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> key0 = <strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>();
<a id="L426" name="L426"></a> 426 
<div class="comment">
      Key1 and Key2 are optimized for the common use of dynamic proxies
      that implement 1 or 2 interfaces.</div>
<a id="L431" name="L431"></a> 431 
<div class="comment">
      a key used for proxy class with 1 implemented interface</div>
<a id="L435" name="L435"></a> 435     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/4346.html" title="Multiple referred from 3 places.">Key1</a> <strong class="reserved">extends</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt; <em class="brace">{</em>
<a id="L436" name="L436"></a> 436         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a>;
<a id="L437" name="L437"></a> 437 
<a id="L438" name="L438"></a> 438         Key1(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf) <em class="brace">{</em>
<a id="L439" name="L439"></a> 439             <strong class="reserved">super</strong>(intf);
<a id="L440" name="L440"></a> 440             <strong class="reserved">this</strong>.<a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a> = intf.<a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>();
<a id="L441" name="L441"></a> 441         <em class="brace">}</em>
<a id="L442" name="L442"></a> 442 
<a id="L443" name="L443"></a> 443         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L444" name="L444"></a> 444         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/20298.html" title="Multiple referred from 715 places.">hashCode</a>() <em class="brace">{</em>
<a id="L445" name="L445"></a> 445             <strong class="reserved">return</strong> <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a>;
<a id="L446" name="L446"></a> 446         <em class="brace">}</em>
<a id="L447" name="L447"></a> 447 
<a id="L448" name="L448"></a> 448         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L449" name="L449"></a> 449         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/13992.html" title="Multiple referred from 5400 places.">equals</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> obj) <em class="brace">{</em>
<a id="L450" name="L450"></a> 450             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf;
<a id="L451" name="L451"></a> 451             <strong class="reserved">return</strong> <strong class="reserved">this</strong> == obj ||
<a id="L452" name="L452"></a> 452                    obj != <strong class="reserved">null</strong> &amp;&amp;
<a id="L453" name="L453"></a> 453                    obj.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>() == <a href="../S/1663.html#L435" title="Defined at 435 in src/java/lang/reflect/Proxy.java.">Key1</a>.<strong class="reserved">class</strong> &amp;&amp;
<a id="L454" name="L454"></a> 454                    (intf = <a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>()) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L455" name="L455"></a> 455                    intf == ((<a href="../S/1663.html#L435" title="Defined at 435 in src/java/lang/reflect/Proxy.java.">Key1</a>) obj).<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L456" name="L456"></a> 456         <em class="brace">}</em>
<a id="L457" name="L457"></a> 457     <em class="brace">}</em>
<a id="L458" name="L458"></a> 458 
<div class="comment">
      a key used for proxy class with 2 implemented interfaces</div>
<a id="L462" name="L462"></a> 462     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/4347.html" title="Multiple referred from 4 places.">Key2</a> <strong class="reserved">extends</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt; <em class="brace">{</em>
<a id="L463" name="L463"></a> 463         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a>;
<a id="L464" name="L464"></a> 464         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt; ref2;
<a id="L465" name="L465"></a> 465 
<a id="L466" name="L466"></a> 466         Key2(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf1, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf2) <em class="brace">{</em>
<a id="L467" name="L467"></a> 467             <strong class="reserved">super</strong>(intf1);
<a id="L468" name="L468"></a> 468             <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a> = 31 * intf1.<a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>() + intf2.<a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>();
<a id="L469" name="L469"></a> 469             ref2 = <strong class="reserved">new</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;(intf2);
<a id="L470" name="L470"></a> 470         <em class="brace">}</em>
<a id="L471" name="L471"></a> 471 
<a id="L472" name="L472"></a> 472         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L473" name="L473"></a> 473         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/20298.html" title="Multiple referred from 715 places.">hashCode</a>() <em class="brace">{</em>
<a id="L474" name="L474"></a> 474             <strong class="reserved">return</strong> <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a>;
<a id="L475" name="L475"></a> 475         <em class="brace">}</em>
<a id="L476" name="L476"></a> 476 
<a id="L477" name="L477"></a> 477         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L478" name="L478"></a> 478         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/13992.html" title="Multiple referred from 5400 places.">equals</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> obj) <em class="brace">{</em>
<a id="L479" name="L479"></a> 479             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf1, intf2;
<a id="L480" name="L480"></a> 480             <strong class="reserved">return</strong> <strong class="reserved">this</strong> == obj ||
<a id="L481" name="L481"></a> 481                    obj != <strong class="reserved">null</strong> &amp;&amp;
<a id="L482" name="L482"></a> 482                    obj.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>() == <a href="../S/1663.html#L462" title="Defined at 462 in src/java/lang/reflect/Proxy.java.">Key2</a>.<strong class="reserved">class</strong> &amp;&amp;
<a id="L483" name="L483"></a> 483                    (intf1 = <a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>()) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L484" name="L484"></a> 484                    intf1 == ((<a href="../S/1663.html#L462" title="Defined at 462 in src/java/lang/reflect/Proxy.java.">Key2</a>) obj).<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() &amp;&amp;
<a id="L485" name="L485"></a> 485                    (intf2 = ref2.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>()) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L486" name="L486"></a> 486                    intf2 == ((<a href="../S/1663.html#L462" title="Defined at 462 in src/java/lang/reflect/Proxy.java.">Key2</a>) obj).ref2.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L487" name="L487"></a> 487         <em class="brace">}</em>
<a id="L488" name="L488"></a> 488     <em class="brace">}</em>
<a id="L489" name="L489"></a> 489 
<div class="comment">
      a key used for proxy class with any number of implemented interfaces
      (used here for 3 or more only)</div>
<a id="L494" name="L494"></a> 494     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/4403.html" title="Multiple referred from 3 places.">KeyX</a> <em class="brace">{</em>
<a id="L495" name="L495"></a> 495         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a>;
<a id="L496" name="L496"></a> 496         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;[] refs;
<a id="L497" name="L497"></a> 497 
<a id="L498" name="L498"></a> 498         @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L499" name="L499"></a> 499         KeyX(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>) <em class="brace">{</em>
<a id="L500" name="L500"></a> 500             <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a> = <a href="../S/1150.html#L71" title="Defined at 71 in src/java/util/Arrays.java.">Arrays</a>.<a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>(<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>);
<a id="L501" name="L501"></a> 501             refs = (<a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;[])<strong class="reserved">new</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;?&gt;[<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L502" name="L502"></a> 502             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L503" name="L503"></a> 503                 refs[i] = <strong class="reserved">new</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;&gt;(<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>[i]);
<a id="L504" name="L504"></a> 504             <em class="brace">}</em>
<a id="L505" name="L505"></a> 505         <em class="brace">}</em>
<a id="L506" name="L506"></a> 506 
<a id="L507" name="L507"></a> 507         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L508" name="L508"></a> 508         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/20298.html" title="Multiple referred from 715 places.">hashCode</a>() <em class="brace">{</em>
<a id="L509" name="L509"></a> 509             <strong class="reserved">return</strong> <a href="../D/24219.html" title="Multiple defined in 17 places.">hash</a>;
<a id="L510" name="L510"></a> 510         <em class="brace">}</em>
<a id="L511" name="L511"></a> 511 
<a id="L512" name="L512"></a> 512         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L513" name="L513"></a> 513         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/13992.html" title="Multiple referred from 5400 places.">equals</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> obj) <em class="brace">{</em>
<a id="L514" name="L514"></a> 514             <strong class="reserved">return</strong> <strong class="reserved">this</strong> == obj ||
<a id="L515" name="L515"></a> 515                    obj != <strong class="reserved">null</strong> &amp;&amp;
<a id="L516" name="L516"></a> 516                    obj.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>() == <a href="../S/1663.html#L494" title="Defined at 494 in src/java/lang/reflect/Proxy.java.">KeyX</a>.<strong class="reserved">class</strong> &amp;&amp;
<a id="L517" name="L517"></a> 517                    <a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(refs, ((<a href="../S/1663.html#L494" title="Defined at 494 in src/java/lang/reflect/Proxy.java.">KeyX</a>) obj).refs);
<a id="L518" name="L518"></a> 518         <em class="brace">}</em>
<a id="L519" name="L519"></a> 519 
<a id="L520" name="L520"></a> 520         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> <a href="../R/13992.html" title="Multiple referred from 5400 places.">equals</a>(<a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;[] refs1,
<a id="L521" name="L521"></a> 521                                       <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;[] refs2) <em class="brace">{</em>
<a id="L522" name="L522"></a> 522             <strong class="reserved">if</strong> (refs1.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> != refs2.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L523" name="L523"></a> 523                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L524" name="L524"></a> 524             <em class="brace">}</em>
<a id="L525" name="L525"></a> 525             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; refs1.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L526" name="L526"></a> 526                 <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf = refs1[i].<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L527" name="L527"></a> 527                 <strong class="reserved">if</strong> (intf == <strong class="reserved">null</strong> || intf != refs2[i].<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>()) <em class="brace">{</em>
<a id="L528" name="L528"></a> 528                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L529" name="L529"></a> 529                 <em class="brace">}</em>
<a id="L530" name="L530"></a> 530             <em class="brace">}</em>
<a id="L531" name="L531"></a> 531             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L532" name="L532"></a> 532         <em class="brace">}</em>
<a id="L533" name="L533"></a> 533     <em class="brace">}</em>
<a id="L534" name="L534"></a> 534 
<div class="comment">
      A function that maps an array of interfaces to an optimal key where
      Class objects representing interfaces are weakly referenced.</div>
<a id="L539" name="L539"></a> 539     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/4358.html" title="Multiple referred from 16 places.">KeyFactory</a>
<a id="L540" name="L540"></a> 540         <strong class="reserved">implements</strong> <a href="../S/975.html#L44" title="Defined at 44 in src/java/util/function/BiFunction.java.">BiFunction</a>&lt;<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a>, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[], <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt;
<a id="L541" name="L541"></a> 541     <em class="brace">{</em>
<a id="L542" name="L542"></a> 542         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L543" name="L543"></a> 543         <strong class="reserved">public</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../R/10262.html" title="Multiple referred from 190 places.">apply</a>(<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> classLoader, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>) <em class="brace">{</em>
<a id="L544" name="L544"></a> 544             <strong class="reserved">switch</strong> (<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L545" name="L545"></a> 545                 <strong class="reserved">case</strong> 1: <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1663.html#L435" title="Defined at 435 in src/java/lang/reflect/Proxy.java.">Key1</a>(<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>[0]); <em class="comment">// the most frequent</em>
<a id="L546" name="L546"></a> 546                 <strong class="reserved">case</strong> 2: <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1663.html#L462" title="Defined at 462 in src/java/lang/reflect/Proxy.java.">Key2</a>(<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>[0], <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>[1]);
<a id="L547" name="L547"></a> 547                 <strong class="reserved">case</strong> 0: <strong class="reserved">return</strong> key0;
<a id="L548" name="L548"></a> 548                 <strong class="reserved">default</strong>: <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1663.html#L494" title="Defined at 494 in src/java/lang/reflect/Proxy.java.">KeyX</a>(<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>);
<a id="L549" name="L549"></a> 549             <em class="brace">}</em>
<a id="L550" name="L550"></a> 550         <em class="brace">}</em>
<a id="L551" name="L551"></a> 551     <em class="brace">}</em>
<a id="L552" name="L552"></a> 552 
<div class="comment">
      A factory function that generates, defines and returns the proxy class given
      the ClassLoader and array of interfaces.</div>
<a id="L557" name="L557"></a> 557     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/1663.html#L240" title="Referred from 240 in src/java/lang/reflect/Proxy.java.">ProxyClassFactory</a>
<a id="L558" name="L558"></a> 558         <strong class="reserved">implements</strong> <a href="../S/975.html#L44" title="Defined at 44 in src/java/util/function/BiFunction.java.">BiFunction</a>&lt;<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a>, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[], <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;&gt;
<a id="L559" name="L559"></a> 559     <em class="brace">{</em>
<a id="L560" name="L560"></a> 560         <em class="comment">// prefix for all proxy class names</em>
<a id="L561" name="L561"></a> 561         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> proxyClassNamePrefix = "$Proxy";
<a id="L562" name="L562"></a> 562 
<a id="L563" name="L563"></a> 563         <em class="comment">// next number to use for generation of unique proxy class names</em>
<a id="L564" name="L564"></a> 564         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a> nextUniqueNumber = <strong class="reserved">new</strong> <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a>();
<a id="L565" name="L565"></a> 565 
<a id="L566" name="L566"></a> 566         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L567" name="L567"></a> 567         <strong class="reserved">public</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; <a href="../R/10262.html" title="Multiple referred from 190 places.">apply</a>(<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>) <em class="brace">{</em>
<a id="L568" name="L568"></a> 568 
<a id="L569" name="L569"></a> 569             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;, <a href="../S/1770.html#L43" title="Defined at 43 in src/java/lang/Boolean.java.">Boolean</a>&gt; interfaceSet = <strong class="reserved">new</strong> <a href="../S/863.html#L138" title="Defined at 138 in src/java/util/IdentityHashMap.java.">IdentityHashMap</a>&lt;&gt;(<a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L570" name="L570"></a> 570             <strong class="reserved">for</strong> (<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf : <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>) <em class="brace">{</em>
<div class="comment">
                  Verify that the class loader resolves the name of this
                  interface to the same Class object.</div>
<a id="L575" name="L575"></a> 575                 <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; interfaceClass = <strong class="reserved">null</strong>;
<a id="L576" name="L576"></a> 576                 <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L577" name="L577"></a> 577                     interfaceClass = <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>.<a href="../D/16518.html" title="Multiple defined in 6 places.">forName</a>(intf.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>(), <strong class="reserved">false</strong>, loader);
<a id="L578" name="L578"></a> 578                 <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1705.html#L53" title="Defined at 53 in src/java/lang/ClassNotFoundException.java.">ClassNotFoundException</a> e) <em class="brace">{</em>
<a id="L579" name="L579"></a> 579                 <em class="brace">}</em>
<a id="L580" name="L580"></a> 580                 <strong class="reserved">if</strong> (interfaceClass != intf) <em class="brace">{</em>
<a id="L581" name="L581"></a> 581                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L582" name="L582"></a> 582                         intf + " is not visible from class loader");
<a id="L583" name="L583"></a> 583                 <em class="brace">}</em>
<div class="comment">
                  Verify that the Class object actually represents an
                  interface.</div>
<a id="L588" name="L588"></a> 588                 <strong class="reserved">if</strong> (!interfaceClass.<a href="../D/25735.html" title="Multiple defined in 6 places.">isInterface</a>()) <em class="brace">{</em>
<a id="L589" name="L589"></a> 589                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L590" name="L590"></a> 590                         interfaceClass.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>() + " is not an interface");
<a id="L591" name="L591"></a> 591                 <em class="brace">}</em>
<div class="comment">
                  Verify that this interface is not a duplicate.</div>
<a id="L595" name="L595"></a> 595                 <strong class="reserved">if</strong> (interfaceSet.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(interfaceClass, <a href="../S/1770.html#L43" title="Defined at 43 in src/java/lang/Boolean.java.">Boolean</a>.TRUE) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L596" name="L596"></a> 596                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L597" name="L597"></a> 597                         "repeated interface: " + interfaceClass.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L598" name="L598"></a> 598                 <em class="brace">}</em>
<a id="L599" name="L599"></a> 599             <em class="brace">}</em>
<a id="L600" name="L600"></a> 600 
<a id="L601" name="L601"></a> 601             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> proxyPkg = <strong class="reserved">null</strong>;     <em class="comment">// package to define proxy class in</em>
<a id="L602" name="L602"></a> 602             <strong class="reserved">int</strong> accessFlags = <a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.PUBLIC | <a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.FINAL;
<a id="L603" name="L603"></a> 603 
<div class="comment">
              Record the package of a non-public proxy interface so that the
              proxy class will be defined in the same package.  Verify that
              all non-public proxy interfaces are in the same package.</div>
<a id="L609" name="L609"></a> 609             <strong class="reserved">for</strong> (<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intf : <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>) <em class="brace">{</em>
<a id="L610" name="L610"></a> 610                 <strong class="reserved">int</strong> <a href="../D/16441.html" title="Multiple defined in 7 places.">flags</a> = intf.<a href="../D/20712.html" title="Multiple defined in 18 places.">getModifiers</a>();
<a id="L611" name="L611"></a> 611                 <strong class="reserved">if</strong> (!<a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.<a href="../D/26117.html" title="Multiple defined in 5 places.">isPublic</a>(<a href="../D/16441.html" title="Multiple defined in 7 places.">flags</a>)) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612                     accessFlags = <a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.FINAL;
<a id="L613" name="L613"></a> 613                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> = intf.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L614" name="L614"></a> 614                     <strong class="reserved">int</strong> n = <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>.<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>('.');
<a id="L615" name="L615"></a> 615                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pkg = ((n == -1) ? "" : <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0, n + 1));
<a id="L616" name="L616"></a> 616                     <strong class="reserved">if</strong> (proxyPkg == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L617" name="L617"></a> 617                         proxyPkg = pkg;
<a id="L618" name="L618"></a> 618                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!pkg.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(proxyPkg)) <em class="brace">{</em>
<a id="L619" name="L619"></a> 619                         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L620" name="L620"></a> 620                             "non-public interfaces from different packages");
<a id="L621" name="L621"></a> 621                     <em class="brace">}</em>
<a id="L622" name="L622"></a> 622                 <em class="brace">}</em>
<a id="L623" name="L623"></a> 623             <em class="brace">}</em>
<a id="L624" name="L624"></a> 624 
<a id="L625" name="L625"></a> 625             <strong class="reserved">if</strong> (proxyPkg == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L626" name="L626"></a> 626                 <em class="comment">// if no non-public proxy interfaces, use com.sun.proxy package</em>
<a id="L627" name="L627"></a> 627                 proxyPkg = ReflectUtil.PROXY_PACKAGE + ".";
<a id="L628" name="L628"></a> 628             <em class="brace">}</em>
<a id="L629" name="L629"></a> 629 
<div class="comment">
              Choose a name for the proxy class to generate.</div>
<a id="L633" name="L633"></a> 633             <strong class="reserved">long</strong> <a href="../D/28365.html" title="Multiple defined in 17 places.">num</a> = nextUniqueNumber.<a href="../D/16942.html" title="Multiple defined in 8 places.">getAndIncrement</a>();
<a id="L634" name="L634"></a> 634             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> proxyName = proxyPkg + proxyClassNamePrefix + <a href="../D/28365.html" title="Multiple defined in 17 places.">num</a>;
<a id="L635" name="L635"></a> 635 
<div class="comment">
              Generate the specified proxy class.</div>
<a id="L639" name="L639"></a> 639             <strong class="reserved">byte</strong>[] proxyClassFile = ProxyGenerator.generateProxyClass(
<a id="L640" name="L640"></a> 640                 proxyName, <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>, accessFlags);
<a id="L641" name="L641"></a> 641             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L642" name="L642"></a> 642                 <strong class="reserved">return</strong> <a href="../D/14763.html" title="Multiple defined in 2 places.">defineClass0</a>(loader, proxyName,
<a id="L643" name="L643"></a> 643                                     proxyClassFile, 0, proxyClassFile.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L644" name="L644"></a> 644             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1742.html#L37" title="Defined at 37 in src/java/lang/ClassFormatError.java.">ClassFormatError</a> e) <em class="brace">{</em>
<div class="comment">
                  A ClassFormatError here means that (barring bugs in the
                  proxy class generation code) there was some other
                  invalid aspect of the arguments supplied to the proxy
                  class creation (such as virtual machine limitations
                  exceeded).</div>
<a id="L652" name="L652"></a> 652                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(e.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L653" name="L653"></a> 653             <em class="brace">}</em>
<a id="L654" name="L654"></a> 654         <em class="brace">}</em>
<a id="L655" name="L655"></a> 655     <em class="brace">}</em>
<a id="L656" name="L656"></a> 656 
<div class="comment">
      Returns an instance of a proxy class for the specified interfaces
      that dispatches method invocations to the specified invocation
      handler.
      <p><code>Proxy.newProxyInstance</code> throws
      <code>IllegalArgumentException</code> for the same reasons that
      <code>Proxy.getProxyClass</code> does.
      @param   loader the class loader to define the proxy class
      @param   interfaces the list of interfaces for the proxy class
               to implement
      @param   h the invocation handler to dispatch method invocations to
      @return  a proxy instance with the specified invocation handler of a
               proxy class that is defined by the specified class loader
               and that implements the specified interfaces
      @throws  IllegalArgumentException if any of the restrictions on the
               parameters that may be passed to <code>getProxyClass</code>
               are violated
      @throws  SecurityException if a security manager, <em>s</em>, is present
               and any of the following conditions is met:
               </p><ul><li> the given <code>loader</code> is <code>null</code> and
                    the caller's class loader is not <code>null</code> and the
                    invocation of {@link SecurityManager#checkPermission
                    s.checkPermission} with
                    <code>RuntimePermission("getClassLoader")</code> permission
                    denies access;</li><li> for each proxy interface, <code>intf</code>,
                    the caller's class loader is not the same as or an
                    ancestor of the class loader for <code>intf</code> and
                    invocation of {@link SecurityManager#checkPackageAccess
                    s.checkPackageAccess()} denies access to <code>intf</code>;</li><li> any of the given proxy interfaces is non-public and the
                    caller class is not in the same {@linkplain Package runtime package}
                    as the non-public interface and the invocation of
                    {@link SecurityManager#checkPermission s.checkPermission} with
                    <code>ReflectPermission("newProxyInPackage.{package name</code>")}
                    permission denies access.</li>
               </ul>
      @throws  NullPointerException if the <code>interfaces</code> array
               argument or any of its elements are <code>null</code>, or
               if the invocation handler, <code>h</code>, is
               <code>null</code></div>
<a id="L702" name="L702"></a> 702     @CallerSensitive
<a id="L703" name="L703"></a> 703     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../R/23600.html" title="Multiple referred from 7 places.">newProxyInstance</a>(<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader,
<a id="L704" name="L704"></a> 704                                           <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>,
<a id="L705" name="L705"></a> 705                                           <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> h)
<a id="L706" name="L706"></a> 706         <strong class="reserved">throws</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>
<a id="L707" name="L707"></a> 707     <em class="brace">{</em>
<a id="L708" name="L708"></a> 708         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(h);
<a id="L709" name="L709"></a> 709 
<a id="L710" name="L710"></a> 710         <strong class="reserved">final</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[] intfs = <a href="../D/24908.html" title="Multiple defined in 2 places.">interfaces</a>.<a href="../D/12888.html" title="Multiple defined in 229 places.">clone</a>();
<a id="L711" name="L711"></a> 711         <strong class="reserved">final</strong> <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> sm = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L712" name="L712"></a> 712         <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L713" name="L713"></a> 713             <a href="../S/1663.html#L392" title="Defined at 392 in src/java/lang/reflect/Proxy.java.">checkProxyAccess</a>(Reflection.getCallerClass(), loader, intfs);
<a id="L714" name="L714"></a> 714         <em class="brace">}</em>
<a id="L715" name="L715"></a> 715 
<div class="comment">
          Look up or generate the designated proxy class.</div>
<a id="L719" name="L719"></a> 719         <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; cl = <a href="../S/1663.html#L410" title="Defined at 410 in src/java/lang/reflect/Proxy.java.">getProxyClass0</a>(loader, intfs);
<a id="L720" name="L720"></a> 720 
<div class="comment">
          Invoke its constructor with the designated invocation handler.</div>
<a id="L724" name="L724"></a> 724         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L725" name="L725"></a> 725             <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L726" name="L726"></a> 726                 <a href="../S/1663.html#L754" title="Defined at 754 in src/java/lang/reflect/Proxy.java.">checkNewProxyPermission</a>(Reflection.getCallerClass(), cl);
<a id="L727" name="L727"></a> 727             <em class="brace">}</em>
<a id="L728" name="L728"></a> 728 
<a id="L729" name="L729"></a> 729             <strong class="reserved">final</strong> <a href="../D/1833.html" title="Multiple defined in 2 places.">Constructor</a>&lt;?&gt; cons = cl.<a href="../D/17932.html" title="Multiple defined in 2 places.">getConstructor</a>(constructorParams);
<a id="L730" name="L730"></a> 730             <strong class="reserved">final</strong> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> ih = h;
<a id="L731" name="L731"></a> 731             <strong class="reserved">if</strong> (!<a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.<a href="../D/26117.html" title="Multiple defined in 5 places.">isPublic</a>(cl.<a href="../D/20712.html" title="Multiple defined in 18 places.">getModifiers</a>())) <em class="brace">{</em>
<a id="L732" name="L732"></a> 732                 <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(<strong class="reserved">new</strong> <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt;() <em class="brace">{</em>
<a id="L733" name="L733"></a> 733                     <strong class="reserved">public</strong> <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L734" name="L734"></a> 734                         cons.<a href="../D/31850.html" title="Multiple defined in 2 places.">setAccessible</a>(<strong class="reserved">true</strong>);
<a id="L735" name="L735"></a> 735                         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L736" name="L736"></a> 736                     <em class="brace">}</em>
<a id="L737" name="L737"></a> 737                 <em class="brace">}</em>);
<a id="L738" name="L738"></a> 738             <em class="brace">}</em>
<a id="L739" name="L739"></a> 739             <strong class="reserved">return</strong> cons.<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>(<strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[]<em class="brace">{</em>h<em class="brace">}</em>);
<a id="L740" name="L740"></a> 740         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1574.html#L59" title="Defined at 59 in src/java/lang/IllegalAccessException.java.">IllegalAccessException</a>|<a href="../S/1743.html#L46" title="Defined at 46 in src/java/lang/InstantiationException.java.">InstantiationException</a> e) <em class="brace">{</em>
<a id="L741" name="L741"></a> 741             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(e.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(), e);
<a id="L742" name="L742"></a> 742         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1671.html#L42" title="Defined at 42 in src/java/lang/reflect/InvocationTargetException.java.">InvocationTargetException</a> e) <em class="brace">{</em>
<a id="L743" name="L743"></a> 743             <a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> t = e.<a href="../D/17525.html" title="Multiple defined in 41 places.">getCause</a>();
<a id="L744" name="L744"></a> 744             <strong class="reserved">if</strong> (t <strong class="reserved">instanceof</strong> <a href="../S/1723.html#L43" title="Defined at 43 in src/java/lang/RuntimeException.java.">RuntimeException</a>) <em class="brace">{</em>
<a id="L745" name="L745"></a> 745                 <strong class="reserved">throw</strong> (<a href="../S/1723.html#L43" title="Defined at 43 in src/java/lang/RuntimeException.java.">RuntimeException</a>) t;
<a id="L746" name="L746"></a> 746             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L747" name="L747"></a> 747                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(t.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(), t);
<a id="L748" name="L748"></a> 748             <em class="brace">}</em>
<a id="L749" name="L749"></a> 749         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1776.html#L35" title="Defined at 35 in src/java/lang/NoSuchMethodException.java.">NoSuchMethodException</a> e) <em class="brace">{</em>
<a id="L750" name="L750"></a> 750             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(e.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(), e);
<a id="L751" name="L751"></a> 751         <em class="brace">}</em>
<a id="L752" name="L752"></a> 752     <em class="brace">}</em>
<a id="L753" name="L753"></a> 753 
<a id="L754" name="L754"></a> 754     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../S/1663.html#L726" title="Referred from 726 in src/java/lang/reflect/Proxy.java.">checkNewProxyPermission</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; caller, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; proxyClass) <em class="brace">{</em>
<a id="L755" name="L755"></a> 755         <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> sm = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L756" name="L756"></a> 756         <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L757" name="L757"></a> 757             <strong class="reserved">if</strong> (ReflectUtil.isNonPublicProxyClass(proxyClass)) <em class="brace">{</em>
<a id="L758" name="L758"></a> 758                 <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> ccl = caller.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>();
<a id="L759" name="L759"></a> 759                 <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> pcl = proxyClass.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>();
<a id="L760" name="L760"></a> 760 
<a id="L761" name="L761"></a> 761                 <em class="comment">// do permission check if the caller is in a different runtime package</em>
<a id="L762" name="L762"></a> 762                 <em class="comment">// of the proxy class</em>
<a id="L763" name="L763"></a> 763                 <strong class="reserved">int</strong> n = proxyClass.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>().<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>('.');
<a id="L764" name="L764"></a> 764                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pkg = (n == -1) ? "" : proxyClass.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>().<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0, n);
<a id="L765" name="L765"></a> 765 
<a id="L766" name="L766"></a> 766                 n = caller.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>().<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>('.');
<a id="L767" name="L767"></a> 767                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> callerPkg = (n == -1) ? "" : caller.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>().<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0, n);
<a id="L768" name="L768"></a> 768 
<a id="L769" name="L769"></a> 769                 <strong class="reserved">if</strong> (pcl != ccl || !pkg.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(callerPkg)) <em class="brace">{</em>
<a id="L770" name="L770"></a> 770                     sm.<a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>(<strong class="reserved">new</strong> <a href="../S/1669.html#L75" title="Defined at 75 in src/java/lang/reflect/ReflectPermission.java.">ReflectPermission</a>("newProxyInPackage." + pkg));
<a id="L771" name="L771"></a> 771                 <em class="brace">}</em>
<a id="L772" name="L772"></a> 772             <em class="brace">}</em>
<a id="L773" name="L773"></a> 773         <em class="brace">}</em>
<a id="L774" name="L774"></a> 774     <em class="brace">}</em>
<a id="L775" name="L775"></a> 775 
<div class="comment">
      Returns true if and only if the specified class was dynamically
      generated to be a proxy class using the <code>getProxyClass</code>
      method or the <code>newProxyInstance</code> method.
      <p>The reliability of this method is important for the ability
      to use it to make security decisions, so its implementation should
      not just test if the class in question extends <code>Proxy</code>.
      @param   cl the class to test
      @return  <code>true</code> if the class is a proxy class and
               <code>false</code> otherwise
      @throws  NullPointerException if <code>cl</code> is <code>null</code></p></div>
<a id="L790" name="L790"></a> 790     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> <a href="../R/21916.html" title="Multiple referred from 16 places.">isProxyClass</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; cl) <em class="brace">{</em>
<a id="L791" name="L791"></a> 791         <strong class="reserved">return</strong> <a href="../D/6957.html" title="Multiple defined in 2 places.">Proxy</a>.<strong class="reserved">class</strong>.<a href="../D/25213.html" title="Multiple defined in 7 places.">isAssignableFrom</a>(cl) &amp;&amp; proxyClassCache.<a href="../D/13361.html" title="Multiple defined in 32 places.">containsValue</a>(cl);
<a id="L792" name="L792"></a> 792     <em class="brace">}</em>
<a id="L793" name="L793"></a> 793 
<div class="comment">
      Returns the invocation handler for the specified proxy instance.
      @param   proxy the proxy instance to return the invocation handler for
      @return  the invocation handler for the proxy instance
      @throws  IllegalArgumentException if the argument is not a
               proxy instance
      @throws  SecurityException if a security manager, <em>s</em>, is present
               and the caller's class loader is not the same as or an
               ancestor of the class loader for the invocation handler
               and invocation of {@link SecurityManager#checkPackageAccess
               s.checkPackageAccess()} denies access to the invocation
               handler's class.</div>
<a id="L808" name="L808"></a> 808     @CallerSensitive
<a id="L809" name="L809"></a> 809     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> <a href="../R/17160.html" title="Multiple referred from 12 places.">getInvocationHandler</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> proxy)
<a id="L810" name="L810"></a> 810         <strong class="reserved">throws</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>
<a id="L811" name="L811"></a> 811     <em class="brace">{</em>
<div class="comment">
          Verify that the object is actually a proxy instance.</div>
<a id="L815" name="L815"></a> 815         <strong class="reserved">if</strong> (!<a href="../S/1663.html#L790" title="Defined at 790 in src/java/lang/reflect/Proxy.java.">isProxyClass</a>(proxy.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>())) <em class="brace">{</em>
<a id="L816" name="L816"></a> 816             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("not a proxy instance");
<a id="L817" name="L817"></a> 817         <em class="brace">}</em>
<a id="L818" name="L818"></a> 818 
<a id="L819" name="L819"></a> 819         <strong class="reserved">final</strong> <a href="../D/6957.html" title="Multiple defined in 2 places.">Proxy</a> p = (<a href="../D/6957.html" title="Multiple defined in 2 places.">Proxy</a>) proxy;
<a id="L820" name="L820"></a> 820         <strong class="reserved">final</strong> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> ih = p.h;
<a id="L821" name="L821"></a> 821         <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>() != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L822" name="L822"></a> 822             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; ihClass = ih.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>();
<a id="L823" name="L823"></a> 823             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; caller = Reflection.getCallerClass();
<a id="L824" name="L824"></a> 824             <strong class="reserved">if</strong> (ReflectUtil.needsPackageAccessCheck(caller.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>(),
<a id="L825" name="L825"></a> 825                                                     ihClass.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>()))
<a id="L826" name="L826"></a> 826             <em class="brace">{</em>
<a id="L827" name="L827"></a> 827                 ReflectUtil.<a href="../D/12578.html" title="Multiple defined in 3 places.">checkPackageAccess</a>(ihClass);
<a id="L828" name="L828"></a> 828             <em class="brace">}</em>
<a id="L829" name="L829"></a> 829         <em class="brace">}</em>
<a id="L830" name="L830"></a> 830 
<a id="L831" name="L831"></a> 831         <strong class="reserved">return</strong> ih;
<a id="L832" name="L832"></a> 832     <em class="brace">}</em>
<a id="L833" name="L833"></a> 833 
<a id="L834" name="L834"></a> 834     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">native</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; <a href="../S/1663.html#L642" title="Referred from 642 in src/java/lang/reflect/Proxy.java.">defineClass0</a>(<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>,
<a id="L835" name="L835"></a> 835                                                 <strong class="reserved">byte</strong>[] b, <strong class="reserved">int</strong> off, <strong class="reserved">int</strong> len);
<a id="L836" name="L836"></a> 836 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L361">[^]</a><a href="#L834">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>