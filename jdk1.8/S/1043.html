<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/locks/ReentrantReadWriteLock.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L245">[^]</a><a href="#L1492">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L245" title="Defined at 245.">writeLock</a></li>
<li><a href="#L246" title="Defined at 246.">readLock</a></li>
<li><a href="#L268" title="Defined at 268.">sharedCount</a></li>
<li><a href="#L270" title="Defined at 270.">exclusiveCount</a></li>
<li><a href="#L288" title="Defined at 288.">initialValue</a></li>
<li><a href="#L353" title="Defined at 353.">readerShouldBlock</a></li>
<li><a href="#L360" title="Defined at 360.">writerShouldBlock</a></li>
<li><a href="#L369" title="Defined at 369.">tryRelease</a></li>
<li><a href="#L380" title="Defined at 380.">tryAcquire</a></li>
<li><a href="#L412" title="Defined at 412.">tryReleaseShared</a></li>
<li><a href="#L443" title="Defined at 443.">unmatchedUnlockException</a></li>
<li><a href="#L448" title="Defined at 448.">tryAcquireShared</a></li>
<li><a href="#L495" title="Defined at 495.">fullTryAcquireShared</a></li>
<li><a href="#L555" title="Defined at 555.">tryWriteLock</a></li>
<li><a href="#L576" title="Defined at 576.">tryReadLock</a></li>
<li><a href="#L605" title="Defined at 605.">isHeldExclusively</a></li>
<li><a href="#L613" title="Defined at 613.">newCondition</a></li>
<li><a href="#L617" title="Defined at 617.">getOwner</a></li>
<li><a href="#L624" title="Defined at 624.">getReadLockCount</a></li>
<li><a href="#L628" title="Defined at 628.">isWriteLocked</a></li>
<li><a href="#L632" title="Defined at 632.">getWriteHoldCount</a></li>
<li><a href="#L636" title="Defined at 636.">getReadHoldCount</a></li>
<li><a href="#L656" title="Defined at 656.">readObject</a></li>
<li><a href="#L663" title="Defined at 663.">getCount</a></li>
<li><a href="#L671" title="Defined at 671.">writerShouldBlock</a></li>
<li><a href="#L674" title="Defined at 674.">readerShouldBlock</a></li>
<li><a href="#L691" title="Defined at 691.">writerShouldBlock</a></li>
<li><a href="#L694" title="Defined at 694.">readerShouldBlock</a></li>
<li><a href="#L726" title="Defined at 726.">lock</a></li>
<li><a href="#L771" title="Defined at 771.">lockInterruptibly</a></li>
<li><a href="#L798" title="Defined at 798.">tryLock</a></li>
<li><a href="#L869" title="Defined at 869.">tryLock</a></li>
<li><a href="#L880" title="Defined at 880.">unlock</a></li>
<li><a href="#L890" title="Defined at 890.">newCondition</a></li>
<li><a href="#L901" title="Defined at 901.">toString</a></li>
<li><a href="#L942" title="Defined at 942.">lock</a></li>
<li><a href="#L997" title="Defined at 997.">lockInterruptibly</a></li>
<li><a href="#L1030" title="Defined at 1030.">tryLock</a></li>
<li><a href="#L1113" title="Defined at 1113.">tryLock</a></li>
<li><a href="#L1130" title="Defined at 1130.">unlock</a></li>
<li><a href="#L1177" title="Defined at 1177.">newCondition</a></li>
<li><a href="#L1189" title="Defined at 1189.">toString</a></li>
<li><a href="#L1205" title="Defined at 1205.">isHeldByCurrentThread</a></li>
<li><a href="#L1219" title="Defined at 1219.">getHoldCount</a></li>
<li><a href="#L1231" title="Defined at 1231.">isFair</a></li>
<li><a href="#L1248" title="Defined at 1248.">getOwner</a></li>
<li><a href="#L1258" title="Defined at 1258.">getReadLockCount</a></li>
<li><a href="#L1270" title="Defined at 1270.">isWriteLocked</a></li>
<li><a href="#L1280" title="Defined at 1280.">isWriteLockedByCurrentThread</a></li>
<li><a href="#L1292" title="Defined at 1292.">getWriteHoldCount</a></li>
<li><a href="#L1305" title="Defined at 1305.">getReadHoldCount</a></li>
<li><a href="#L1320" title="Defined at 1320.">getQueuedWriterThreads</a></li>
<li><a href="#L1335" title="Defined at 1335.">getQueuedReaderThreads</a></li>
<li><a href="#L1349" title="Defined at 1349.">hasQueuedThreads</a></li>
<li><a href="#L1364" title="Defined at 1364.">hasQueuedThread</a></li>
<li><a href="#L1378" title="Defined at 1378.">getQueueLength</a></li>
<li><a href="#L1393" title="Defined at 1393.">getQueuedThreads</a></li>
<li><a href="#L1412" title="Defined at 1412.">hasWaiters</a></li>
<li><a href="#L1435" title="Defined at 1435.">getWaitQueueLength</a></li>
<li><a href="#L1460" title="Defined at 1460.">getWaitingThreads</a></li>
<li><a href="#L1477" title="Defined at 1477.">toString</a></li>
<li><a href="#L1492" title="Defined at 1492.">getThreadId</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent.locks;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.concurrent.TimeUnit;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.Collection;
<a id="L39" name="L39"></a>  39 
<div class="comment">
  An implementation of <a href="../S/1042.html#L119" title="Defined at 119 in src/java/util/concurrent/locks/ReadWriteLock.java.">ReadWriteLock</a> supporting similar
  semantics to {@link ReentrantLock}.
  <p>This class has the following properties:
  </p><ul><li><b>Acquisition order</b>
  <p>This class does not impose a reader or writer preference
  ordering for lock access.  However, it does support an optional
  <em>fairness</em> policy.
  </p><dl>
  <dt><b><i>Non-fair mode (default)</i></b>
  </dt><dd>When constructed as non-fair (the default), the order of entry
  to the read and write lock is unspecified, subject to reentrancy
  constraints.  A nonfair lock that is continuously contended may
  indefinitely postpone one or more reader or writer threads, but
  will normally have higher throughput than a fair lock.
  </dd><dt><b><i>Fair mode</i></b>
  </dt><dd>When constructed as fair, threads contend for entry using an
  approximately arrival-order policy. When the currently held lock
  is released, either the longest-waiting single writer thread will
  be assigned the write lock, or if there is a group of reader threads
  waiting longer than all waiting writer threads, that group will be
  assigned the read lock.
  <p>A thread that tries to acquire a fair read lock (non-reentrantly)
  will block if either the write lock is held, or there is a waiting
  writer thread. The thread will not acquire the read lock until
  after the oldest currently waiting writer thread has acquired and
  released the write lock. Of course, if a waiting writer abandons
  its wait, leaving one or more reader threads as the longest waiters
  in the queue with the write lock free, then those readers will be
  assigned the read lock.
  </p><p>A thread that tries to acquire a fair write lock (non-reentrantly)
  will block unless both the read lock and write lock are free (which
  implies there are no waiting threads).  (Note that the non-blocking
  {@link ReadLock#tryLock()} and {@link WriteLock#tryLock()} methods
  do not honor this fair setting and will immediately acquire the lock
  if it is possible, regardless of waiting threads.)
  </p><p>
  </p></dd></dl>
  </li><li><b>Reentrancy</b>
  <p>This lock allows both readers and writers to reacquire read or
  write locks in the style of a {@link ReentrantLock}. Non-reentrant
  readers are not allowed until all write locks held by the writing
  thread have been released.
  </p><p>Additionally, a writer can acquire the read lock, but not
  vice-versa.  Among other applications, reentrancy can be useful
  when write locks are held during calls or callbacks to methods that
  perform reads under read locks.  If a reader tries to acquire the
  write lock it will never succeed.
  </p></li><li><b>Lock downgrading</b>
  <p>Reentrancy also allows downgrading from the write lock to a read lock,
  by acquiring the write lock, then the read lock and then releasing the
  write lock. However, upgrading from a read lock to the write lock is
  <b>not</b> possible.
  </p></li><li><b>Interruption of lock acquisition</b>
  <p>The read lock and write lock both support interruption during lock
  acquisition.
  </p></li><li><b><a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> support</b>
  <p>The write lock provides a <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> implementation that
  behaves in the same way, with respect to the write lock, as the
  <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> implementation provided by
  {@link ReentrantLock#newCondition} does for {@link ReentrantLock}.
  This <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> can, of course, only be used with the write lock.
  </p><p>The read lock does not support a <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> and
  <code>readLock().newCondition()</code> throws
  <code>UnsupportedOperationException</code>.
  </p></li><li><b>Instrumentation</b>
  <p>This class supports methods to determine whether locks
  are held or contended. These methods are designed for monitoring
  system state, not for synchronization control.
  </p></li></ul>
  <p>Serialization of this class behaves in the same way as built-in
  locks: a deserialized lock is in the unlocked state, regardless of
  its state when serialized.
  </p><p><b>Sample usages</b>. Here is a code sketch showing how to perform
  lock downgrading after updating a cache (exception handling is
  particularly tricky when handling multiple locks in a non-nested
  fashion):
  </p><pre> {@code
  class CachedData {
    Object data;
    volatile boolean cacheValid;
    final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();
    void processCachedData() {
      rwl.readLock().lock();
      if (!cacheValid) {
        // Must release read lock before acquiring write lock
        rwl.readLock().unlock();
        rwl.writeLock().lock();
        try {
          // Recheck state because another thread might have
          // acquired write lock and changed state before we did.
          if (!cacheValid) {
            data = ...
            cacheValid = true;
          }
          // Downgrade by acquiring read lock before releasing write lock
          rwl.readLock().lock();
        } finally {
          rwl.writeLock().unlock(); // Unlock write, still hold read
        }
      }
      try {
        use(data);
      } finally {
        rwl.readLock().unlock();
      }
    }
  }}</pre>
  ReentrantReadWriteLocks can be used to improve concurrency in some
  uses of some kinds of Collections. This is typically worthwhile
  only when the collections are expected to be large, accessed by
  more reader threads than writer threads, and entail operations with
  overhead that outweighs synchronization overhead. For example, here
  is a class using a TreeMap that is expected to be large and
  concurrently accessed.
   <pre> {@code
  class RWDictionary {
    private final Map<string, data> m = new TreeMap<string, data>();
    private final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();
    private final Lock r = rwl.readLock();
    private final Lock w = rwl.writeLock();
    public Data get(String key) {
      r.lock();
      try { return m.get(key); }
      finally { r.unlock(); }
    }
    public String[] allKeys() {
      r.lock();
      try { return m.keySet().toArray(); }
      finally { r.unlock(); }
    }
    public Data put(String key, Data value) {
      w.lock();
      try { return m.put(key, value); }
      finally { w.unlock(); }
    }
    public void clear() {
      w.lock();
      try { m.clear(); }
      finally { w.unlock(); }
    }
  }}</string,></string,></pre>
  <h3>Implementation Notes</h3>
  <p>This lock supports a maximum of 65535 recursive write locks
  and 65535 read locks. Attempts to exceed these limits result in
  <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a> throws from locking methods.
  @since 1.5
  @author Doug Lea</p></div>
<a id="L215" name="L215"></a> 215 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/6532.html" title="Multiple referred from 11 places.">ReentrantReadWriteLock</a>
<a id="L216" name="L216"></a> 216         <strong class="reserved">implements</strong> <a href="../S/1042.html#L119" title="Defined at 119 in src/java/util/concurrent/locks/ReadWriteLock.java.">ReadWriteLock</a>, <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L217" name="L217"></a> 217     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -6992448646407690164L;
<div class="comment">
     /** Inner class providing readlock */</div>
<a id="L219" name="L219"></a> 219     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1043.html#L215" title="Defined at 215 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReentrantReadWriteLock</a>.<a href="../S/1043.html#L702" title="Defined at 702 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReadLock</a> readerLock;
<div class="comment">
     /** Inner class providing writelock */</div>
<a id="L221" name="L221"></a> 221     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1043.html#L215" title="Defined at 215 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReentrantReadWriteLock</a>.<a href="../S/1043.html#L911" title="Defined at 911 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">WriteLock</a> writerLock;
<div class="comment">
     /** Performs all synchronization mechanics */</div>
<a id="L223" name="L223"></a> 223     <strong class="reserved">final</strong> <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>;
<a id="L224" name="L224"></a> 224 
<div class="comment">
      Creates a new <code>ReentrantReadWriteLock</code> with
      default (nonfair) ordering properties.</div>
<a id="L229" name="L229"></a> 229     <strong class="reserved">public</strong> ReentrantReadWriteLock() <em class="brace">{</em>
<a id="L230" name="L230"></a> 230         <strong class="reserved">this</strong>(<strong class="reserved">false</strong>);
<a id="L231" name="L231"></a> 231     <em class="brace">}</em>
<a id="L232" name="L232"></a> 232 
<div class="comment">
      Creates a new <code>ReentrantReadWriteLock</code> with
      the given fairness policy.
      @param fair <code>true</code> if this lock should use a fair ordering policy</div>
<a id="L239" name="L239"></a> 239     <strong class="reserved">public</strong> ReentrantReadWriteLock(<strong class="reserved">boolean</strong> fair) <em class="brace">{</em>
<a id="L240" name="L240"></a> 240         <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a> = fair ? <strong class="reserved">new</strong> <a href="../D/3129.html" title="Multiple defined in 3 places.">FairSync</a>() : <strong class="reserved">new</strong> <a href="../D/6119.html" title="Multiple defined in 3 places.">NonfairSync</a>();
<a id="L241" name="L241"></a> 241         readerLock = <strong class="reserved">new</strong> <a href="../S/1043.html#L702" title="Defined at 702 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReadLock</a>(<strong class="reserved">this</strong>);
<a id="L242" name="L242"></a> 242         writerLock = <strong class="reserved">new</strong> <a href="../S/1043.html#L911" title="Defined at 911 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">WriteLock</a>(<strong class="reserved">this</strong>);
<a id="L243" name="L243"></a> 243     <em class="brace">}</em>
<a id="L244" name="L244"></a> 244 
<a id="L245" name="L245"></a> 245     <strong class="reserved">public</strong> <a href="../S/1043.html#L215" title="Defined at 215 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReentrantReadWriteLock</a>.<a href="../S/1043.html#L911" title="Defined at 911 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">WriteLock</a> <a href="../R/30659.html" title="Multiple referred from 42 places.">writeLock</a>() <em class="brace">{</em> <strong class="reserved">return</strong> writerLock; <em class="brace">}</em>
<a id="L246" name="L246"></a> 246     <strong class="reserved">public</strong> <a href="../S/1043.html#L215" title="Defined at 215 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReentrantReadWriteLock</a>.<a href="../S/1043.html#L702" title="Defined at 702 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReadLock</a>  <a href="../R/25503.html" title="Multiple referred from 51 places.">readLock</a>()  <em class="brace">{</em> <strong class="reserved">return</strong> readerLock; <em class="brace">}</em>
<a id="L247" name="L247"></a> 247 
<div class="comment">
      Synchronization implementation for ReentrantReadWriteLock.
      Subclassed into fair and nonfair versions.</div>
<a id="L252" name="L252"></a> 252     <strong class="reserved">abstract</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/7786.html" title="Multiple referred from 25 places.">Sync</a> <strong class="reserved">extends</strong> <a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a> <em class="brace">{</em>
<a id="L253" name="L253"></a> 253         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 6317671515068378041L;
<a id="L254" name="L254"></a> 254 
<div class="comment">
          Read vs write count extraction constants and functions.
          Lock state is logically divided into two unsigned shorts:
          The lower one representing the exclusive (writer) lock hold count,
          and the upper the shared (reader) hold count.</div>
<a id="L261" name="L261"></a> 261 
<a id="L262" name="L262"></a> 262         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SHARED_SHIFT   = 16;
<a id="L263" name="L263"></a> 263         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SHARED_UNIT    = (1 &lt;&lt; SHARED_SHIFT);
<a id="L264" name="L264"></a> 264         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_COUNT      = (1 &lt;&lt; SHARED_SHIFT) - 1;
<a id="L265" name="L265"></a> 265         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;
<a id="L266" name="L266"></a> 266 
<div class="comment">
         /** Returns the number of shared holds represented in count  */</div>
<a id="L268" name="L268"></a> 268         <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/28496.html" title="Multiple referred from 6 places.">sharedCount</a>(<strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)    <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt;&gt; SHARED_SHIFT; <em class="brace">}</em>
<div class="comment">
         /** Returns the number of exclusive holds represented in count  */</div>
<a id="L270" name="L270"></a> 270         <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/14089.html" title="Multiple referred from 11 places.">exclusiveCount</a>(<strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &amp; EXCLUSIVE_MASK; <em class="brace">}</em>
<a id="L271" name="L271"></a> 271 
<div class="comment">
          A counter for per-thread read hold counts.
          Maintained as a ThreadLocal; cached in cachedHoldCounter</div>
<a id="L276" name="L276"></a> 276         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/3439.html" title="Multiple referred from 9 places.">HoldCounter</a> <em class="brace">{</em>
<a id="L277" name="L277"></a> 277             <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L278" name="L278"></a> 278             <em class="comment">// Use id, not reference, to avoid garbage retention</em>
<a id="L279" name="L279"></a> 279             <strong class="reserved">final</strong> <strong class="reserved">long</strong> tid = <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>());
<a id="L280" name="L280"></a> 280         <em class="brace">}</em>
<a id="L281" name="L281"></a> 281 
<div class="comment">
          ThreadLocal subclass. Easiest to explicitly define for sake
          of deserialization mechanics.</div>
<a id="L286" name="L286"></a> 286         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/8134.html" title="Multiple referred from 3 places.">ThreadLocalHoldCounter</a>
<a id="L287" name="L287"></a> 287             <strong class="reserved">extends</strong> <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;<a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a>&gt; <em class="brace">{</em>
<a id="L288" name="L288"></a> 288             <strong class="reserved">public</strong> <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> <a href="../R/20680.html" title="Multiple referred from 271 places.">initialValue</a>() <em class="brace">{</em>
<a id="L289" name="L289"></a> 289                 <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a>();
<a id="L290" name="L290"></a> 290             <em class="brace">}</em>
<a id="L291" name="L291"></a> 291         <em class="brace">}</em>
<a id="L292" name="L292"></a> 292 
<div class="comment">
          The number of reentrant read locks held by current thread.
          Initialized only in constructor and readObject.
          Removed whenever a thread's read hold count drops to 0.</div>
<a id="L298" name="L298"></a> 298         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/1043.html#L286" title="Defined at 286 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ThreadLocalHoldCounter</a> readHolds;
<a id="L299" name="L299"></a> 299 
<div class="comment">
          The hold count of the last thread to successfully acquire
          readLock. This saves ThreadLocal lookup in the common case
          where the next thread to release is the last one to
          acquire. This is non-volatile since it is just used
          as a heuristic, and would be great for threads to cache.
          <p>Can outlive the Thread for which it is caching the read
          hold count, but avoids garbage retention by not retaining a
          reference to the Thread.
          </p><p>Accessed via a benign data race; relies on the memory
          model's final field and out-of-thin-air guarantees.</p></div>
<a id="L314" name="L314"></a> 314         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> cachedHoldCounter;
<a id="L315" name="L315"></a> 315 
<div class="comment">
          firstReader is the first thread to have acquired the read lock.
          firstReaderHoldCount is firstReader's hold count.
          <p>More precisely, firstReader is the unique thread that last
          changed the shared count from 0 to 1, and has not released the
          read lock since then; null if there is no such thread.
          </p><p>Cannot cause garbage retention unless the thread terminated
          without relinquishing its read locks, since tryReleaseShared
          sets it to null.
          </p><p>Accessed via a benign data race; relies on the memory
          model's out-of-thin-air guarantees for references.
          </p><p>This allows tracking of read holds for uncontended read
          locks to be very cheap.</p></div>
<a id="L334" name="L334"></a> 334         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> firstReader = <strong class="reserved">null</strong>;
<a id="L335" name="L335"></a> 335         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">int</strong> firstReaderHoldCount;
<a id="L336" name="L336"></a> 336 
<a id="L337" name="L337"></a> 337         Sync() <em class="brace">{</em>
<a id="L338" name="L338"></a> 338             readHolds = <strong class="reserved">new</strong> <a href="../S/1043.html#L286" title="Defined at 286 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ThreadLocalHoldCounter</a>();
<a id="L339" name="L339"></a> 339             <a href="../D/34006.html" title="Multiple defined in 21 places.">setState</a>(<a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>()); <em class="comment">// ensures visibility of readHolds</em>
<a id="L340" name="L340"></a> 340         <em class="brace">}</em>
<a id="L341" name="L341"></a> 341 
<div class="comment">
          Acquires and releases use the same code for fair and
          nonfair locks, but differ in whether/how they allow barging
          when queues are non-empty.</div>
<a id="L347" name="L347"></a> 347 
<div class="comment">
          Returns true if the current thread, when trying to acquire
          the read lock, and otherwise eligible to do so, should block
          because of policy for overtaking other waiting threads.</div>
<a id="L353" name="L353"></a> 353         <strong class="reserved">abstract</strong> <strong class="reserved">boolean</strong> <a href="../R/25624.html" title="Multiple referred from 2 places.">readerShouldBlock</a>();
<a id="L354" name="L354"></a> 354 
<div class="comment">
          Returns true if the current thread, when trying to acquire
          the write lock, and otherwise eligible to do so, should block
          because of policy for overtaking other waiting threads.</div>
<a id="L360" name="L360"></a> 360         <strong class="reserved">abstract</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L405" title="Referred from 405 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">writerShouldBlock</a>();
<a id="L361" name="L361"></a> 361 
<div class="comment">
          Note that tryRelease and tryAcquire can be called by
          Conditions. So it is possible that their arguments contain
          both read and write holds that are all released during a
          condition wait and re-established in tryAcquire.</div>
<a id="L368" name="L368"></a> 368 
<a id="L369" name="L369"></a> 369         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29560.html" title="Multiple referred from 7 places.">tryRelease</a>(<strong class="reserved">int</strong> releases) <em class="brace">{</em>
<a id="L370" name="L370"></a> 370             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L371" name="L371"></a> 371                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L372" name="L372"></a> 372             <strong class="reserved">int</strong> nextc = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>() - releases;
<a id="L373" name="L373"></a> 373             <strong class="reserved">boolean</strong> <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a> = <a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(nextc) == 0;
<a id="L374" name="L374"></a> 374             <strong class="reserved">if</strong> (<a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>)
<a id="L375" name="L375"></a> 375                 <a href="../S/1048.html#L73" title="Defined at 73 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">setExclusiveOwnerThread</a>(<strong class="reserved">null</strong>);
<a id="L376" name="L376"></a> 376             <a href="../D/34006.html" title="Multiple defined in 21 places.">setState</a>(nextc);
<a id="L377" name="L377"></a> 377             <strong class="reserved">return</strong> <a href="../D/16577.html" title="Multiple defined in 8 places.">free</a>;
<a id="L378" name="L378"></a> 378         <em class="brace">}</em>
<a id="L379" name="L379"></a> 379 
<a id="L380" name="L380"></a> 380         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29536.html" title="Multiple referred from 13 places.">tryAcquire</a>(<strong class="reserved">int</strong> acquires) <em class="brace">{</em>
<div class="comment">
              Walkthrough:
              1. If read count nonzero or write count nonzero
                 and owner is a different thread, fail.
              2. If count would saturate, fail. (This can only
                 happen if count is already nonzero.)
              3. Otherwise, this thread is eligible for lock if
                 it is either a reentrant acquire or
                 queue policy allows it. If so, update state
                 and set owner.</div>
<a id="L392" name="L392"></a> 392             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L393" name="L393"></a> 393             <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L394" name="L394"></a> 394             <strong class="reserved">int</strong> w = <a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L395" name="L395"></a> 395             <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> != 0) <em class="brace">{</em>
<a id="L396" name="L396"></a> 396                 <em class="comment">// (Note: if c != 0 and w == 0 then shared count != 0)</em>
<a id="L397" name="L397"></a> 397                 <strong class="reserved">if</strong> (w == 0 || <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> != <a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>())
<a id="L398" name="L398"></a> 398                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L399" name="L399"></a> 399                 <strong class="reserved">if</strong> (w + <a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(acquires) &gt; MAX_COUNT)
<a id="L400" name="L400"></a> 400                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>("Maximum lock count exceeded");
<a id="L401" name="L401"></a> 401                 <em class="comment">// Reentrant acquire</em>
<a id="L402" name="L402"></a> 402                 <a href="../D/34006.html" title="Multiple defined in 21 places.">setState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + acquires);
<a id="L403" name="L403"></a> 403                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L404" name="L404"></a> 404             <em class="brace">}</em>
<a id="L405" name="L405"></a> 405             <strong class="reserved">if</strong> (<a href="../D/37278.html" title="Multiple defined in 3 places.">writerShouldBlock</a>() ||
<a id="L406" name="L406"></a> 406                 !<a href="../D/13041.html" title="Multiple defined in 2 places.">compareAndSetState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + acquires))
<a id="L407" name="L407"></a> 407                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L408" name="L408"></a> 408             <a href="../S/1048.html#L73" title="Defined at 73 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">setExclusiveOwnerThread</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>);
<a id="L409" name="L409"></a> 409             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L410" name="L410"></a> 410         <em class="brace">}</em>
<a id="L411" name="L411"></a> 411 
<a id="L412" name="L412"></a> 412         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29561.html" title="Multiple referred from 2 places.">tryReleaseShared</a>(<strong class="reserved">int</strong> unused) <em class="brace">{</em>
<a id="L413" name="L413"></a> 413             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L414" name="L414"></a> 414             <strong class="reserved">if</strong> (firstReader == <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) <em class="brace">{</em>
<a id="L415" name="L415"></a> 415                 <em class="comment">// assert firstReaderHoldCount &gt; 0;</em>
<a id="L416" name="L416"></a> 416                 <strong class="reserved">if</strong> (firstReaderHoldCount == 1)
<a id="L417" name="L417"></a> 417                     firstReader = <strong class="reserved">null</strong>;
<a id="L418" name="L418"></a> 418                 <strong class="reserved">else</strong>
<a id="L419" name="L419"></a> 419                     firstReaderHoldCount--;
<a id="L420" name="L420"></a> 420             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L421" name="L421"></a> 421                 <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> rh = cachedHoldCounter;
<a id="L422" name="L422"></a> 422                 <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong> || rh.tid != <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>))
<a id="L423" name="L423"></a> 423                     rh = readHolds.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L424" name="L424"></a> 424                 <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L425" name="L425"></a> 425                 <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &lt;= 1) <em class="brace">{</em>
<a id="L426" name="L426"></a> 426                     readHolds.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L427" name="L427"></a> 427                     <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &lt;= 0)
<a id="L428" name="L428"></a> 428                         <strong class="reserved">throw</strong> <a href="../S/1043.html#L443" title="Defined at 443 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">unmatchedUnlockException</a>();
<a id="L429" name="L429"></a> 429                 <em class="brace">}</em>
<a id="L430" name="L430"></a> 430                 --rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L431" name="L431"></a> 431             <em class="brace">}</em>
<a id="L432" name="L432"></a> 432             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L433" name="L433"></a> 433                 <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L434" name="L434"></a> 434                 <strong class="reserved">int</strong> nextc = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> - SHARED_UNIT;
<a id="L435" name="L435"></a> 435                 <strong class="reserved">if</strong> (<a href="../D/13041.html" title="Multiple defined in 2 places.">compareAndSetState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nextc))
<a id="L436" name="L436"></a> 436                     <em class="comment">// Releasing the read lock has no effect on readers,</em>
<a id="L437" name="L437"></a> 437                     <em class="comment">// but it may allow waiting writers to proceed if</em>
<a id="L438" name="L438"></a> 438                     <em class="comment">// both read and write locks are now free.</em>
<a id="L439" name="L439"></a> 439                     <strong class="reserved">return</strong> nextc == 0;
<a id="L440" name="L440"></a> 440             <em class="brace">}</em>
<a id="L441" name="L441"></a> 441         <em class="brace">}</em>
<a id="L442" name="L442"></a> 442 
<a id="L443" name="L443"></a> 443         <strong class="reserved">private</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a> <a href="../S/1043.html#L428" title="Referred from 428 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">unmatchedUnlockException</a>() <em class="brace">{</em>
<a id="L444" name="L444"></a> 444             <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>(
<a id="L445" name="L445"></a> 445                 "attempt to unlock read lock, not locked by current thread");
<a id="L446" name="L446"></a> 446         <em class="brace">}</em>
<a id="L447" name="L447"></a> 447 
<a id="L448" name="L448"></a> 448         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/29538.html" title="Multiple referred from 12 places.">tryAcquireShared</a>(<strong class="reserved">int</strong> unused) <em class="brace">{</em>
<div class="comment">
              Walkthrough:
              1. If write lock held by another thread, fail.
              2. Otherwise, this thread is eligible for
                 lock wrt state, so ask if it should block
                 because of queue policy. If not, try
                 to grant by CASing state and updating count.
                 Note that step does not check for reentrant
                 acquires, which is postponed to full version
                 to avoid having to check hold count in
                 the more typical non-reentrant case.
              3. If step 2 fails either because thread
                 apparently not eligible or CAS fails or count
                 saturated, chain to version with full retry loop.</div>
<a id="L464" name="L464"></a> 464             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L465" name="L465"></a> 465             <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L466" name="L466"></a> 466             <strong class="reserved">if</strong> (<a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) != 0 &amp;&amp;
<a id="L467" name="L467"></a> 467                 <a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>() != <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>)
<a id="L468" name="L468"></a> 468                 <strong class="reserved">return</strong> -1;
<a id="L469" name="L469"></a> 469             <strong class="reserved">int</strong> r = <a href="../S/1043.html#L268" title="Defined at 268 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">sharedCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L470" name="L470"></a> 470             <strong class="reserved">if</strong> (!<a href="../D/30351.html" title="Multiple defined in 3 places.">readerShouldBlock</a>() &amp;&amp;
<a id="L471" name="L471"></a> 471                 r &lt; MAX_COUNT &amp;&amp;
<a id="L472" name="L472"></a> 472                 <a href="../D/13041.html" title="Multiple defined in 2 places.">compareAndSetState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + SHARED_UNIT)) <em class="brace">{</em>
<a id="L473" name="L473"></a> 473                 <strong class="reserved">if</strong> (r == 0) <em class="brace">{</em>
<a id="L474" name="L474"></a> 474                     firstReader = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;
<a id="L475" name="L475"></a> 475                     firstReaderHoldCount = 1;
<a id="L476" name="L476"></a> 476                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (firstReader == <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) <em class="brace">{</em>
<a id="L477" name="L477"></a> 477                     firstReaderHoldCount++;
<a id="L478" name="L478"></a> 478                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L479" name="L479"></a> 479                     <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> rh = cachedHoldCounter;
<a id="L480" name="L480"></a> 480                     <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong> || rh.tid != <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>))
<a id="L481" name="L481"></a> 481                         cachedHoldCounter = rh = readHolds.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L482" name="L482"></a> 482                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 0)
<a id="L483" name="L483"></a> 483                         readHolds.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(rh);
<a id="L484" name="L484"></a> 484                     rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>++;
<a id="L485" name="L485"></a> 485                 <em class="brace">}</em>
<a id="L486" name="L486"></a> 486                 <strong class="reserved">return</strong> 1;
<a id="L487" name="L487"></a> 487             <em class="brace">}</em>
<a id="L488" name="L488"></a> 488             <strong class="reserved">return</strong> <a href="../S/1043.html#L495" title="Defined at 495 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">fullTryAcquireShared</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>);
<a id="L489" name="L489"></a> 489         <em class="brace">}</em>
<a id="L490" name="L490"></a> 490 
<div class="comment">
          Full version of acquire for reads, that handles CAS misses
          and reentrant reads not dealt with in tryAcquireShared.</div>
<a id="L495" name="L495"></a> 495         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/1043.html#L488" title="Referred from 488 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">fullTryAcquireShared</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) <em class="brace">{</em>
<div class="comment">
              This code is in part redundant with that in
              tryAcquireShared but is simpler overall by not
              complicating tryAcquireShared with interactions between
              retries and lazily reading hold counts.</div>
<a id="L502" name="L502"></a> 502             <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> rh = <strong class="reserved">null</strong>;
<a id="L503" name="L503"></a> 503             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L504" name="L504"></a> 504                 <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L505" name="L505"></a> 505                 <strong class="reserved">if</strong> (<a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) != 0) <em class="brace">{</em>
<a id="L506" name="L506"></a> 506                     <strong class="reserved">if</strong> (<a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>() != <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>)
<a id="L507" name="L507"></a> 507                         <strong class="reserved">return</strong> -1;
<a id="L508" name="L508"></a> 508                     <em class="comment">// else we hold the exclusive lock; blocking here</em>
<a id="L509" name="L509"></a> 509                     <em class="comment">// would cause deadlock.</em>
<a id="L510" name="L510"></a> 510                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/30351.html" title="Multiple defined in 3 places.">readerShouldBlock</a>()) <em class="brace">{</em>
<a id="L511" name="L511"></a> 511                     <em class="comment">// Make sure we're not acquiring read lock reentrantly</em>
<a id="L512" name="L512"></a> 512                     <strong class="reserved">if</strong> (firstReader == <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) <em class="brace">{</em>
<a id="L513" name="L513"></a> 513                         <em class="comment">// assert firstReaderHoldCount &gt; 0;</em>
<a id="L514" name="L514"></a> 514                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L515" name="L515"></a> 515                         <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L516" name="L516"></a> 516                             rh = cachedHoldCounter;
<a id="L517" name="L517"></a> 517                             <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong> || rh.tid != <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>)) <em class="brace">{</em>
<a id="L518" name="L518"></a> 518                                 rh = readHolds.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L519" name="L519"></a> 519                                 <strong class="reserved">if</strong> (rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 0)
<a id="L520" name="L520"></a> 520                                     readHolds.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L521" name="L521"></a> 521                             <em class="brace">}</em>
<a id="L522" name="L522"></a> 522                         <em class="brace">}</em>
<a id="L523" name="L523"></a> 523                         <strong class="reserved">if</strong> (rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 0)
<a id="L524" name="L524"></a> 524                             <strong class="reserved">return</strong> -1;
<a id="L525" name="L525"></a> 525                     <em class="brace">}</em>
<a id="L526" name="L526"></a> 526                 <em class="brace">}</em>
<a id="L527" name="L527"></a> 527                 <strong class="reserved">if</strong> (<a href="../S/1043.html#L268" title="Defined at 268 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">sharedCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) == MAX_COUNT)
<a id="L528" name="L528"></a> 528                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>("Maximum lock count exceeded");
<a id="L529" name="L529"></a> 529                 <strong class="reserved">if</strong> (<a href="../D/13041.html" title="Multiple defined in 2 places.">compareAndSetState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + SHARED_UNIT)) <em class="brace">{</em>
<a id="L530" name="L530"></a> 530                     <strong class="reserved">if</strong> (<a href="../S/1043.html#L268" title="Defined at 268 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">sharedCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) == 0) <em class="brace">{</em>
<a id="L531" name="L531"></a> 531                         firstReader = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;
<a id="L532" name="L532"></a> 532                         firstReaderHoldCount = 1;
<a id="L533" name="L533"></a> 533                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (firstReader == <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) <em class="brace">{</em>
<a id="L534" name="L534"></a> 534                         firstReaderHoldCount++;
<a id="L535" name="L535"></a> 535                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L536" name="L536"></a> 536                         <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong>)
<a id="L537" name="L537"></a> 537                             rh = cachedHoldCounter;
<a id="L538" name="L538"></a> 538                         <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong> || rh.tid != <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>))
<a id="L539" name="L539"></a> 539                             rh = readHolds.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L540" name="L540"></a> 540                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 0)
<a id="L541" name="L541"></a> 541                             readHolds.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(rh);
<a id="L542" name="L542"></a> 542                         rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>++;
<a id="L543" name="L543"></a> 543                         cachedHoldCounter = rh; <em class="comment">// cache for release</em>
<a id="L544" name="L544"></a> 544                     <em class="brace">}</em>
<a id="L545" name="L545"></a> 545                     <strong class="reserved">return</strong> 1;
<a id="L546" name="L546"></a> 546                 <em class="brace">}</em>
<a id="L547" name="L547"></a> 547             <em class="brace">}</em>
<a id="L548" name="L548"></a> 548         <em class="brace">}</em>
<a id="L549" name="L549"></a> 549 
<div class="comment">
          Performs tryLock for write, enabling barging in both modes.
          This is identical in effect to tryAcquire except for lack
          of calls to writerShouldBlock.</div>
<a id="L555" name="L555"></a> 555         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29567.html" title="Multiple referred from 4 places.">tryWriteLock</a>() <em class="brace">{</em>
<a id="L556" name="L556"></a> 556             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L557" name="L557"></a> 557             <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L558" name="L558"></a> 558             <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> != 0) <em class="brace">{</em>
<a id="L559" name="L559"></a> 559                 <strong class="reserved">int</strong> w = <a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L560" name="L560"></a> 560                 <strong class="reserved">if</strong> (w == 0 || <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> != <a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>())
<a id="L561" name="L561"></a> 561                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L562" name="L562"></a> 562                 <strong class="reserved">if</strong> (w == MAX_COUNT)
<a id="L563" name="L563"></a> 563                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>("Maximum lock count exceeded");
<a id="L564" name="L564"></a> 564             <em class="brace">}</em>
<a id="L565" name="L565"></a> 565             <strong class="reserved">if</strong> (!<a href="../D/13041.html" title="Multiple defined in 2 places.">compareAndSetState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + 1))
<a id="L566" name="L566"></a> 566                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L567" name="L567"></a> 567             <a href="../S/1048.html#L73" title="Defined at 73 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">setExclusiveOwnerThread</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>);
<a id="L568" name="L568"></a> 568             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L569" name="L569"></a> 569         <em class="brace">}</em>
<a id="L570" name="L570"></a> 570 
<div class="comment">
          Performs tryLock for read, enabling barging in both modes.
          This is identical in effect to tryAcquireShared except for
          lack of calls to readerShouldBlock.</div>
<a id="L576" name="L576"></a> 576         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29558.html" title="Multiple referred from 3 places.">tryReadLock</a>() <em class="brace">{</em>
<a id="L577" name="L577"></a> 577             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L578" name="L578"></a> 578             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L579" name="L579"></a> 579                 <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L580" name="L580"></a> 580                 <strong class="reserved">if</strong> (<a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) != 0 &amp;&amp;
<a id="L581" name="L581"></a> 581                     <a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>() != <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>)
<a id="L582" name="L582"></a> 582                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L583" name="L583"></a> 583                 <strong class="reserved">int</strong> r = <a href="../S/1043.html#L268" title="Defined at 268 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">sharedCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L584" name="L584"></a> 584                 <strong class="reserved">if</strong> (r == MAX_COUNT)
<a id="L585" name="L585"></a> 585                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>("Maximum lock count exceeded");
<a id="L586" name="L586"></a> 586                 <strong class="reserved">if</strong> (<a href="../D/13041.html" title="Multiple defined in 2 places.">compareAndSetState</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + SHARED_UNIT)) <em class="brace">{</em>
<a id="L587" name="L587"></a> 587                     <strong class="reserved">if</strong> (r == 0) <em class="brace">{</em>
<a id="L588" name="L588"></a> 588                         firstReader = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;
<a id="L589" name="L589"></a> 589                         firstReaderHoldCount = 1;
<a id="L590" name="L590"></a> 590                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (firstReader == <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) <em class="brace">{</em>
<a id="L591" name="L591"></a> 591                         firstReaderHoldCount++;
<a id="L592" name="L592"></a> 592                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L593" name="L593"></a> 593                         <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> rh = cachedHoldCounter;
<a id="L594" name="L594"></a> 594                         <strong class="reserved">if</strong> (rh == <strong class="reserved">null</strong> || rh.tid != <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>))
<a id="L595" name="L595"></a> 595                             cachedHoldCounter = rh = readHolds.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L596" name="L596"></a> 596                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 0)
<a id="L597" name="L597"></a> 597                             readHolds.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(rh);
<a id="L598" name="L598"></a> 598                         rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>++;
<a id="L599" name="L599"></a> 599                     <em class="brace">}</em>
<a id="L600" name="L600"></a> 600                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L601" name="L601"></a> 601                 <em class="brace">}</em>
<a id="L602" name="L602"></a> 602             <em class="brace">}</em>
<a id="L603" name="L603"></a> 603         <em class="brace">}</em>
<a id="L604" name="L604"></a> 604 
<a id="L605" name="L605"></a> 605         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21524.html" title="Multiple referred from 17 places.">isHeldExclusively</a>() <em class="brace">{</em>
<a id="L606" name="L606"></a> 606             <em class="comment">// While we must in general read state before owner,</em>
<a id="L607" name="L607"></a> 607             <em class="comment">// we don't need to do so to check if current thread is owner</em>
<a id="L608" name="L608"></a> 608             <strong class="reserved">return</strong> <a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>() == <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L609" name="L609"></a> 609         <em class="brace">}</em>
<a id="L610" name="L610"></a> 610 
<a id="L611" name="L611"></a> 611         <em class="comment">// Methods relayed to outer class</em>
<a id="L612" name="L612"></a> 612 
<a id="L613" name="L613"></a> 613         <strong class="reserved">final</strong> <a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> <a href="../R/23534.html" title="Multiple referred from 15 places.">newCondition</a>() <em class="brace">{</em>
<a id="L614" name="L614"></a> 614             <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>();
<a id="L615" name="L615"></a> 615         <em class="brace">}</em>
<a id="L616" name="L616"></a> 616 
<a id="L617" name="L617"></a> 617         <strong class="reserved">final</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../R/18200.html" title="Multiple referred from 29 places.">getOwner</a>() <em class="brace">{</em>
<a id="L618" name="L618"></a> 618             <em class="comment">// Must read state before owner to ensure memory consistency</em>
<a id="L619" name="L619"></a> 619             <strong class="reserved">return</strong> ((<a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>()) == 0) ?
<a id="L620" name="L620"></a> 620                     <strong class="reserved">null</strong> :
<a id="L621" name="L621"></a> 621                     <a href="../S/1048.html#L83" title="Defined at 83 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">getExclusiveOwnerThread</a>());
<a id="L622" name="L622"></a> 622         <em class="brace">}</em>
<a id="L623" name="L623"></a> 623 
<a id="L624" name="L624"></a> 624         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/18607.html" title="Multiple referred from 5 places.">getReadLockCount</a>() <em class="brace">{</em>
<a id="L625" name="L625"></a> 625             <strong class="reserved">return</strong> <a href="../S/1043.html#L268" title="Defined at 268 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">sharedCount</a>(<a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>());
<a id="L626" name="L626"></a> 626         <em class="brace">}</em>
<a id="L627" name="L627"></a> 627 
<a id="L628" name="L628"></a> 628         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L1271" title="Referred from 1271 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">isWriteLocked</a>() <em class="brace">{</em>
<a id="L629" name="L629"></a> 629             <strong class="reserved">return</strong> <a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>()) != 0;
<a id="L630" name="L630"></a> 630         <em class="brace">}</em>
<a id="L631" name="L631"></a> 631 
<a id="L632" name="L632"></a> 632         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19896.html" title="Multiple referred from 2 places.">getWriteHoldCount</a>() <em class="brace">{</em>
<a id="L633" name="L633"></a> 633             <strong class="reserved">return</strong> <a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>() ? <a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>()) : 0;
<a id="L634" name="L634"></a> 634         <em class="brace">}</em>
<a id="L635" name="L635"></a> 635 
<a id="L636" name="L636"></a> 636         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/1043.html#L1306" title="Referred from 1306 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">getReadHoldCount</a>() <em class="brace">{</em>
<a id="L637" name="L637"></a> 637             <strong class="reserved">if</strong> (<a href="../D/21870.html" title="Multiple defined in 4 places.">getReadLockCount</a>() == 0)
<a id="L638" name="L638"></a> 638                 <strong class="reserved">return</strong> 0;
<a id="L639" name="L639"></a> 639 
<a id="L640" name="L640"></a> 640             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L641" name="L641"></a> 641             <strong class="reserved">if</strong> (firstReader == <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>)
<a id="L642" name="L642"></a> 642                 <strong class="reserved">return</strong> firstReaderHoldCount;
<a id="L643" name="L643"></a> 643 
<a id="L644" name="L644"></a> 644             <a href="../S/1043.html#L276" title="Defined at 276 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">HoldCounter</a> rh = cachedHoldCounter;
<a id="L645" name="L645"></a> 645             <strong class="reserved">if</strong> (rh != <strong class="reserved">null</strong> &amp;&amp; rh.tid == <a href="../D/23096.html" title="Multiple defined in 2 places.">getThreadId</a>(<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>))
<a id="L646" name="L646"></a> 646                 <strong class="reserved">return</strong> rh.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L647" name="L647"></a> 647 
<a id="L648" name="L648"></a> 648             <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = readHolds.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>().<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L649" name="L649"></a> 649             <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 0) readHolds.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L650" name="L650"></a> 650             <strong class="reserved">return</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L651" name="L651"></a> 651         <em class="brace">}</em>
<a id="L652" name="L652"></a> 652 
<div class="comment">
          Reconstitutes the instance from a stream (that is, deserializes it).</div>
<a id="L656" name="L656"></a> 656         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25518.html" title="Multiple referred from 189 places.">readObject</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1378.html#L206" title="Defined at 206 in src/java/io/ObjectInputStream.java.">ObjectInputStream</a> s)
<a id="L657" name="L657"></a> 657             <strong class="reserved">throws</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/1705.html#L53" title="Defined at 53 in src/java/lang/ClassNotFoundException.java.">ClassNotFoundException</a> <em class="brace">{</em>
<a id="L658" name="L658"></a> 658             s.<a href="../D/14746.html" title="Multiple defined in 2 places.">defaultReadObject</a>();
<a id="L659" name="L659"></a> 659             readHolds = <strong class="reserved">new</strong> <a href="../S/1043.html#L286" title="Defined at 286 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ThreadLocalHoldCounter</a>();
<a id="L660" name="L660"></a> 660             <a href="../D/34006.html" title="Multiple defined in 21 places.">setState</a>(0); <em class="comment">// reset to unlocked state</em>
<a id="L661" name="L661"></a> 661         <em class="brace">}</em>
<a id="L662" name="L662"></a> 662 
<a id="L663" name="L663"></a> 663         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/15841.html" title="Multiple referred from 20 places.">getCount</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>(); <em class="brace">}</em>
<a id="L664" name="L664"></a> 664     <em class="brace">}</em>
<a id="L665" name="L665"></a> 665 
<div class="comment">
      Nonfair version of Sync</div>
<a id="L669" name="L669"></a> 669     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5578.html" title="Multiple referred from 5 places.">NonfairSync</a> <strong class="reserved">extends</strong> <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a> <em class="brace">{</em>
<a id="L670" name="L670"></a> 670         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -8159625535654395037L;
<a id="L671" name="L671"></a> 671         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L405" title="Referred from 405 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">writerShouldBlock</a>() <em class="brace">{</em>
<a id="L672" name="L672"></a> 672             <strong class="reserved">return</strong> <strong class="reserved">false</strong>; <em class="comment">// writers can always barge</em>
<a id="L673" name="L673"></a> 673         <em class="brace">}</em>
<a id="L674" name="L674"></a> 674         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/25624.html" title="Multiple referred from 2 places.">readerShouldBlock</a>() <em class="brace">{</em>
<div class="comment">
 As a heuristic to avoid indefinite writer starvation,
              block if the thread that momentarily appears to be head
              of queue, if one exists, is a waiting writer.  This is
              only a probabilistic effect since a new reader will not
              block if there is a waiting writer behind other enabled
              readers that have not yet drained from the queue.</div>
<a id="L682" name="L682"></a> 682             <strong class="reserved">return</strong> <a href="../D/11356.html" title="Multiple defined in 2 places.">apparentlyFirstQueuedIsExclusive</a>();
<a id="L683" name="L683"></a> 683         <em class="brace">}</em>
<a id="L684" name="L684"></a> 684     <em class="brace">}</em>
<a id="L685" name="L685"></a> 685 
<div class="comment">
      Fair version of Sync</div>
<a id="L689" name="L689"></a> 689     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/2866.html" title="Multiple referred from 6 places.">FairSync</a> <strong class="reserved">extends</strong> <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a> <em class="brace">{</em>
<a id="L690" name="L690"></a> 690         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -2274990926593161451L;
<a id="L691" name="L691"></a> 691         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L405" title="Referred from 405 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">writerShouldBlock</a>() <em class="brace">{</em>
<a id="L692" name="L692"></a> 692             <strong class="reserved">return</strong> <a href="../D/24165.html" title="Multiple defined in 2 places.">hasQueuedPredecessors</a>();
<a id="L693" name="L693"></a> 693         <em class="brace">}</em>
<a id="L694" name="L694"></a> 694         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/25624.html" title="Multiple referred from 2 places.">readerShouldBlock</a>() <em class="brace">{</em>
<a id="L695" name="L695"></a> 695             <strong class="reserved">return</strong> <a href="../D/24165.html" title="Multiple defined in 2 places.">hasQueuedPredecessors</a>();
<a id="L696" name="L696"></a> 696         <em class="brace">}</em>
<a id="L697" name="L697"></a> 697     <em class="brace">}</em>
<a id="L698" name="L698"></a> 698 
<div class="comment">
      The lock returned by method {@link ReentrantReadWriteLock#readLock}.</div>
<a id="L702" name="L702"></a> 702     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/6485.html" title="Multiple referred from 3 places.">ReadLock</a> <strong class="reserved">implements</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a>, <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L703" name="L703"></a> 703         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -5992448646407690164L;
<a id="L704" name="L704"></a> 704         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>;
<a id="L705" name="L705"></a> 705 
<div class="comment">
          Constructor for use by subclasses
          @param lock the outer lock object
          @throws NullPointerException if the lock is null</div>
<a id="L712" name="L712"></a> 712         <strong class="reserved">protected</strong> ReadLock(<a href="../S/1043.html#L215" title="Defined at 215 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReentrantReadWriteLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L713" name="L713"></a> 713             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a> = <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>;
<a id="L714" name="L714"></a> 714         <em class="brace">}</em>
<a id="L715" name="L715"></a> 715 
<div class="comment">
          Acquires the read lock.
          <p>Acquires the read lock if the write lock is not held by
          another thread and returns immediately.
          </p><p>If the write lock is held by another thread then
          the current thread becomes disabled for thread scheduling
          purposes and lies dormant until the read lock has been acquired.</p></div>
<a id="L726" name="L726"></a> 726         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22669.html" title="Multiple referred from 810 places.">lock</a>() <em class="brace">{</em>
<a id="L727" name="L727"></a> 727             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/10586.html" title="Multiple defined in 2 places.">acquireShared</a>(1);
<a id="L728" name="L728"></a> 728         <em class="brace">}</em>
<a id="L729" name="L729"></a> 729 
<div class="comment">
          Acquires the read lock unless the current thread is
          {@linkplain Thread#interrupt interrupted}.
          <p>Acquires the read lock if the write lock is not held
          by another thread and returns immediately.
          </p><p>If the write lock is held by another thread then the
          current thread becomes disabled for thread scheduling
          purposes and lies dormant until one of two things happens:
          </p><ul><li>The read lock is acquired by the current thread; or
          </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
          the current thread.
          </li></ul>
          <p>If the current thread:
          </p><ul><li>has its interrupted status set on entry to this method; or
          </li><li>is {@linkplain Thread#interrupt interrupted} while
          acquiring the read lock,
          </li></ul>
          then <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> is thrown and the current
          thread's interrupted status is cleared.
          <p>In this implementation, as this method is an explicit
          interruption point, preference is given to responding to
          the interrupt over normal or reentrant acquisition of the
          lock.
          @throws InterruptedException if the current thread is interrupted</p></div>
<a id="L771" name="L771"></a> 771         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22670.html" title="Multiple referred from 18 places.">lockInterruptibly</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L772" name="L772"></a> 772             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/10587.html" title="Multiple defined in 2 places.">acquireSharedInterruptibly</a>(1);
<a id="L773" name="L773"></a> 773         <em class="brace">}</em>
<a id="L774" name="L774"></a> 774 
<div class="comment">
          Acquires the read lock only if the write lock is not held by
          another thread at the time of invocation.
          <p>Acquires the read lock if the write lock is not held by
          another thread and returns immediately with the value
          <code>true</code>. Even when this lock has been set to use a
          fair ordering policy, a call to <code>tryLock()</code>
          <em>will</em> immediately acquire the read lock if it is
          available, whether or not other threads are currently
          waiting for the read lock.  This "barging" behavior
          can be useful in certain circumstances, even though it
          breaks fairness. If you want to honor the fairness setting
          for this lock, then use {@link #tryLock(long, TimeUnit)
          tryLock(0, TimeUnit.SECONDS) } which is almost equivalent
          (it also detects interruption).
          </p><p>If the write lock is held by another thread then
          this method will return immediately with the value
          <code>false</code>.
          @return <code>true</code> if the read lock was acquired</p></div>
<a id="L798" name="L798"></a> 798         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>() <em class="brace">{</em>
<a id="L799" name="L799"></a> 799             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/35733.html" title="Multiple defined in 3 places.">tryReadLock</a>();
<a id="L800" name="L800"></a> 800         <em class="brace">}</em>
<a id="L801" name="L801"></a> 801 
<div class="comment">
          Acquires the read lock if the write lock is not held by
          another thread within the given waiting time and the
          current thread has not been {@linkplain Thread#interrupt
          interrupted}.
          <p>Acquires the read lock if the write lock is not held by
          another thread and returns immediately with the value
          <code>true</code>. If this lock has been set to use a fair
          ordering policy then an available lock <em>will not</em> be
          acquired if any other threads are waiting for the
          lock. This is in contrast to the {@link #tryLock()}
          method. If you want a timed <code>tryLock</code> that does
          permit barging on a fair lock then combine the timed and
          un-timed forms together:
           </p><pre> {@code
          if (lock.tryLock() ||
              lock.tryLock(timeout, unit)) {
            ...
          }}</pre>
          <p>If the write lock is held by another thread then the
          current thread becomes disabled for thread scheduling
          purposes and lies dormant until one of three things happens:
          </p><ul><li>The read lock is acquired by the current thread; or
          </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
          the current thread; or
          </li><li>The specified waiting time elapses.
          </li></ul>
          <p>If the read lock is acquired then the value <code>true</code> is
          returned.
          </p><p>If the current thread:
          </p><ul><li>has its interrupted status set on entry to this method; or
          </li><li>is {@linkplain Thread#interrupt interrupted} while
          acquiring the read lock,
          </li></ul> then <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> is thrown and the
          current thread's interrupted status is cleared.
          <p>If the specified waiting time elapses then the value
          <code>false</code> is returned.  If the time is less than or
          equal to zero, the method will not wait at all.
          </p><p>In this implementation, as this method is an explicit
          interruption point, preference is given to responding to
          the interrupt over normal or reentrant acquisition of the
          lock, and over reporting the elapse of the waiting time.
          @param timeout the time to wait for the read lock
          @param unit the time unit of the timeout argument
          @return <code>true</code> if the read lock was acquired
          @throws InterruptedException if the current thread is interrupted
          @throws NullPointerException if the time unit is null</p></div>
<a id="L869" name="L869"></a> 869         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>(<strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L870" name="L870"></a> 870                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L871" name="L871"></a> 871             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/35710.html" title="Multiple defined in 2 places.">tryAcquireSharedNanos</a>(1, unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout));
<a id="L872" name="L872"></a> 872         <em class="brace">}</em>
<a id="L873" name="L873"></a> 873 
<div class="comment">
          Attempts to release this lock.
          <p>If the number of readers is now zero then the lock
          is made available for write lock attempts.</p></div>
<a id="L880" name="L880"></a> 880         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/29713.html" title="Multiple referred from 276 places.">unlock</a>() <em class="brace">{</em>
<a id="L881" name="L881"></a> 881             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/30655.html" title="Multiple defined in 2 places.">releaseShared</a>(1);
<a id="L882" name="L882"></a> 882         <em class="brace">}</em>
<a id="L883" name="L883"></a> 883 
<div class="comment">
          Throws <code>UnsupportedOperationException</code> because
          <code>ReadLocks</code> do not support conditions.
          @throws UnsupportedOperationException always</div>
<a id="L890" name="L890"></a> 890         <strong class="reserved">public</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> <a href="../R/23534.html" title="Multiple referred from 15 places.">newCondition</a>() <em class="brace">{</em>
<a id="L891" name="L891"></a> 891             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L892" name="L892"></a> 892         <em class="brace">}</em>
<a id="L893" name="L893"></a> 893 
<div class="comment">
          Returns a string identifying this lock, as well as its lock state.
          The state, in brackets, includes the String <code>"Read locks ="</code>
          followed by the number of held read locks.
          @return a string identifying this lock, as well as its lock state</div>
<a id="L901" name="L901"></a> 901         <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L902" name="L902"></a> 902             <strong class="reserved">int</strong> r = <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21870.html" title="Multiple defined in 4 places.">getReadLockCount</a>();
<a id="L903" name="L903"></a> 903             <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L904" name="L904"></a> 904                 "[Read locks = " + r + "]";
<a id="L905" name="L905"></a> 905         <em class="brace">}</em>
<a id="L906" name="L906"></a> 906     <em class="brace">}</em>
<a id="L907" name="L907"></a> 907 
<div class="comment">
      The lock returned by method {@link ReentrantReadWriteLock#writeLock}.</div>
<a id="L911" name="L911"></a> 911     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/8886.html" title="Multiple referred from 3 places.">WriteLock</a> <strong class="reserved">implements</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a>, <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L912" name="L912"></a> 912         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -4992448646407690164L;
<a id="L913" name="L913"></a> 913         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>;
<a id="L914" name="L914"></a> 914 
<div class="comment">
          Constructor for use by subclasses
          @param lock the outer lock object
          @throws NullPointerException if the lock is null</div>
<a id="L921" name="L921"></a> 921         <strong class="reserved">protected</strong> WriteLock(<a href="../S/1043.html#L215" title="Defined at 215 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">ReentrantReadWriteLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L922" name="L922"></a> 922             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a> = <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>;
<a id="L923" name="L923"></a> 923         <em class="brace">}</em>
<a id="L924" name="L924"></a> 924 
<div class="comment">
          Acquires the write lock.
          <p>Acquires the write lock if neither the read nor write lock
          are held by another thread
          and returns immediately, setting the write lock hold count to
          one.
          </p><p>If the current thread already holds the write lock then the
          hold count is incremented by one and the method returns
          immediately.
          </p><p>If the lock is held by another thread then the current
          thread becomes disabled for thread scheduling purposes and
          lies dormant until the write lock has been acquired, at which
          time the write lock hold count is set to one.</p></div>
<a id="L942" name="L942"></a> 942         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22669.html" title="Multiple referred from 810 places.">lock</a>() <em class="brace">{</em>
<a id="L943" name="L943"></a> 943             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/10575.html" title="Multiple defined in 9 places.">acquire</a>(1);
<a id="L944" name="L944"></a> 944         <em class="brace">}</em>
<a id="L945" name="L945"></a> 945 
<div class="comment">
          Acquires the write lock unless the current thread is
          {@linkplain Thread#interrupt interrupted}.
          <p>Acquires the write lock if neither the read nor write lock
          are held by another thread
          and returns immediately, setting the write lock hold count to
          one.
          </p><p>If the current thread already holds this lock then the
          hold count is incremented by one and the method returns
          immediately.
          </p><p>If the lock is held by another thread then the current
          thread becomes disabled for thread scheduling purposes and
          lies dormant until one of two things happens:
          </p><ul><li>The write lock is acquired by the current thread; or
          </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
          the current thread.
          </li></ul>
          <p>If the write lock is acquired by the current thread then the
          lock hold count is set to one.
          </p><p>If the current thread:
          </p><ul><li>has its interrupted status set on entry to this method;
          or
          </li><li>is {@linkplain Thread#interrupt interrupted} while
          acquiring the write lock,
          </li></ul>
          then <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> is thrown and the current
          thread's interrupted status is cleared.
          <p>In this implementation, as this method is an explicit
          interruption point, preference is given to responding to
          the interrupt over normal or reentrant acquisition of the
          lock.
          @throws InterruptedException if the current thread is interrupted</p></div>
<a id="L997" name="L997"></a> 997         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22670.html" title="Multiple referred from 18 places.">lockInterruptibly</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L998" name="L998"></a> 998             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/10580.html" title="Multiple defined in 2 places.">acquireInterruptibly</a>(1);
<a id="L999" name="L999"></a> 999         <em class="brace">}</em>
<a id="L1000" name="L1000"></a>1000 
<div class="comment">
          Acquires the write lock only if it is not held by another thread
          at the time of invocation.
          <p>Acquires the write lock if neither the read nor write lock
          are held by another thread
          and returns immediately with the value <code>true</code>,
          setting the write lock hold count to one. Even when this lock has
          been set to use a fair ordering policy, a call to
          <code>tryLock()</code> <em>will</em> immediately acquire the
          lock if it is available, whether or not other threads are
          currently waiting for the write lock.  This "barging"
          behavior can be useful in certain circumstances, even
          though it breaks fairness. If you want to honor the
          fairness setting for this lock, then use {@link
          #tryLock(long, TimeUnit) tryLock(0, TimeUnit.SECONDS) }
          which is almost equivalent (it also detects interruption).
          </p><p>If the current thread already holds this lock then the
          hold count is incremented by one and the method returns
          <code>true</code>.
          </p><p>If the lock is held by another thread then this method
          will return immediately with the value <code>false</code>.
          @return <code>true</code> if the lock was free and was acquired
          by the current thread, or the write lock was already held
          by the current thread; and <code>false</code> otherwise.</p></div>
<a id="L1030" name="L1030"></a>1030         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>( ) <em class="brace">{</em>
<a id="L1031" name="L1031"></a>1031             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/35746.html" title="Multiple defined in 3 places.">tryWriteLock</a>();
<a id="L1032" name="L1032"></a>1032         <em class="brace">}</em>
<a id="L1033" name="L1033"></a>1033 
<div class="comment">
          Acquires the write lock if it is not held by another thread
          within the given waiting time and the current thread has
          not been {@linkplain Thread#interrupt interrupted}.
          <p>Acquires the write lock if neither the read nor write lock
          are held by another thread
          and returns immediately with the value <code>true</code>,
          setting the write lock hold count to one. If this lock has been
          set to use a fair ordering policy then an available lock
          <em>will not</em> be acquired if any other threads are
          waiting for the write lock. This is in contrast to the {@link
          #tryLock()} method. If you want a timed <code>tryLock</code>
          that does permit barging on a fair lock then combine the
          timed and un-timed forms together:
           </p><pre> {@code
          if (lock.tryLock() ||
              lock.tryLock(timeout, unit)) {
            ...
          }}</pre>
          <p>If the current thread already holds this lock then the
          hold count is incremented by one and the method returns
          <code>true</code>.
          </p><p>If the lock is held by another thread then the current
          thread becomes disabled for thread scheduling purposes and
          lies dormant until one of three things happens:
          </p><ul><li>The write lock is acquired by the current thread; or
          </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
          the current thread; or
          </li><li>The specified waiting time elapses
          </li></ul>
          <p>If the write lock is acquired then the value <code>true</code> is
          returned and the write lock hold count is set to one.
          </p><p>If the current thread:
          </p><ul><li>has its interrupted status set on entry to this method;
          or
          </li><li>is {@linkplain Thread#interrupt interrupted} while
          acquiring the write lock,
          </li></ul>
          then <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> is thrown and the current
          thread's interrupted status is cleared.
          <p>If the specified waiting time elapses then the value
          <code>false</code> is returned.  If the time is less than or
          equal to zero, the method will not wait at all.
          </p><p>In this implementation, as this method is an explicit
          interruption point, preference is given to responding to
          the interrupt over normal or reentrant acquisition of the
          lock, and over reporting the elapse of the waiting time.
          @param timeout the time to wait for the write lock
          @param unit the time unit of the timeout argument
          @return <code>true</code> if the lock was free and was acquired
          by the current thread, or the write lock was already held by the
          current thread; and <code>false</code> if the waiting time
          elapsed before the lock could be acquired.
          @throws InterruptedException if the current thread is interrupted
          @throws NullPointerException if the time unit is null</p></div>
<a id="L1113" name="L1113"></a>1113         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>(<strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L1114" name="L1114"></a>1114                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1115" name="L1115"></a>1115             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/35708.html" title="Multiple defined in 2 places.">tryAcquireNanos</a>(1, unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout));
<a id="L1116" name="L1116"></a>1116         <em class="brace">}</em>
<a id="L1117" name="L1117"></a>1117 
<div class="comment">
          Attempts to release this lock.
          <p>If the current thread is the holder of this lock then
          the hold count is decremented. If the hold count is now
          zero then the lock is released.  If the current thread is
          not the holder of this lock then {@link
          IllegalMonitorStateException} is thrown.
          @throws IllegalMonitorStateException if the current thread does not
          hold this lock</p></div>
<a id="L1130" name="L1130"></a>1130         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/29713.html" title="Multiple referred from 276 places.">unlock</a>() <em class="brace">{</em>
<a id="L1131" name="L1131"></a>1131             <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(1);
<a id="L1132" name="L1132"></a>1132         <em class="brace">}</em>
<a id="L1133" name="L1133"></a>1133 
<div class="comment">
          Returns a <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> instance for use with this
          <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> instance.
          <p>The returned <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> instance supports the same
          usages as do the {@link Object} monitor methods ({@link
          Object#wait() wait}, {@link Object#notify notify}, and {@link
          Object#notifyAll notifyAll}) when used with the built-in
          monitor lock.
          </p><ul><li>If this write lock is not held when any {@link
          Condition} method is called then an {@link
          IllegalMonitorStateException} is thrown.  (Read locks are
          held independently of write locks, so are not checked or
          affected. However it is essentially always an error to
          invoke a condition waiting method when the current thread
          has also acquired read locks, since other threads that
          could unblock it will not be able to acquire the write
          lock.)
          </li><li>When the condition {@linkplain Condition#await() waiting}
          methods are called the write lock is released and, before
          they return, the write lock is reacquired and the lock hold
          count restored to what it was when the method was called.
          </li><li>If a thread is {@linkplain Thread#interrupt interrupted} while
          waiting then the wait will terminate, an {@link
          InterruptedException} will be thrown, and the thread's
          interrupted status will be cleared.
          </li><li> Waiting threads are signalled in FIFO order.
          </li><li>The ordering of lock reacquisition for threads returning
          from waiting methods is the same as for threads initially
          acquiring the lock, which is in the default case not specified,
          but for <em>fair</em> locks favors those threads that have been
          waiting the longest.
          </li></ul>
          @return the Condition object</div>
<a id="L1177" name="L1177"></a>1177         <strong class="reserved">public</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> <a href="../R/23534.html" title="Multiple referred from 15 places.">newCondition</a>() <em class="brace">{</em>
<a id="L1178" name="L1178"></a>1178             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/27977.html" title="Multiple defined in 8 places.">newCondition</a>();
<a id="L1179" name="L1179"></a>1179         <em class="brace">}</em>
<a id="L1180" name="L1180"></a>1180 
<div class="comment">
          Returns a string identifying this lock, as well as its lock
          state.  The state, in brackets includes either the String
          <code>"Unlocked"</code> or the String <code>"Locked by"</code>
          followed by the {@linkplain Thread#getName name} of the owning thread.
          @return a string identifying this lock, as well as its lock state</div>
<a id="L1189" name="L1189"></a>1189         <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L1190" name="L1190"></a>1190             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21291.html" title="Multiple defined in 12 places.">getOwner</a>();
<a id="L1191" name="L1191"></a>1191             <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() + ((<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> == <strong class="reserved">null</strong>) ?
<a id="L1192" name="L1192"></a>1192                                        "[Unlocked]" :
<a id="L1193" name="L1193"></a>1193                                        "[Locked by thread " + <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>() + "]");
<a id="L1194" name="L1194"></a>1194         <em class="brace">}</em>
<a id="L1195" name="L1195"></a>1195 
<div class="comment">
          Queries if this write lock is held by the current thread.
          Identical in effect to {@link
          ReentrantReadWriteLock#isWriteLockedByCurrentThread}.
          @return <code>true</code> if the current thread holds this lock and
                  <code>false</code> otherwise
          @since 1.6</div>
<a id="L1205" name="L1205"></a>1205         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> isHeldByCurrentThread() <em class="brace">{</em>
<a id="L1206" name="L1206"></a>1206             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>();
<a id="L1207" name="L1207"></a>1207         <em class="brace">}</em>
<a id="L1208" name="L1208"></a>1208 
<div class="comment">
          Queries the number of holds on this write lock by the current
          thread.  A thread has a hold on a lock for each lock action
          that is not matched by an unlock action.  Identical in effect
          to {@link ReentrantReadWriteLock#getWriteHoldCount}.
          @return the number of holds on this lock by the current thread,
                  or zero if this lock is not held by the current thread
          @since 1.6</div>
<a id="L1219" name="L1219"></a>1219         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../S/1047.html#L533" title="Referred from 533 in src/java/util/concurrent/locks/ReentrantLock.java.">getHoldCount</a>() <em class="brace">{</em>
<a id="L1220" name="L1220"></a>1220             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/23730.html" title="Multiple defined in 2 places.">getWriteHoldCount</a>();
<a id="L1221" name="L1221"></a>1221         <em class="brace">}</em>
<a id="L1222" name="L1222"></a>1222     <em class="brace">}</em>
<a id="L1223" name="L1223"></a>1223 
<a id="L1224" name="L1224"></a>1224     <em class="comment">// Instrumentation and status</em>
<a id="L1225" name="L1225"></a>1225 
<div class="comment">
      Returns <code>true</code> if this lock has fairness set true.
      @return <code>true</code> if this lock has fairness set true</div>
<a id="L1231" name="L1231"></a>1231     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> isFair() <em class="brace">{</em>
<a id="L1232" name="L1232"></a>1232         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a> <strong class="reserved">instanceof</strong> <a href="../D/3129.html" title="Multiple defined in 3 places.">FairSync</a>;
<a id="L1233" name="L1233"></a>1233     <em class="brace">}</em>
<a id="L1234" name="L1234"></a>1234 
<div class="comment">
      Returns the thread that currently owns the write lock, or
      <code>null</code> if not owned. When this method is called by a
      thread that is not the owner, the return value reflects a
      best-effort approximation of current lock status. For example,
      the owner may be momentarily <code>null</code> even if there are
      threads trying to acquire the lock but have not yet done so.
      This method is designed to facilitate construction of
      subclasses that provide more extensive lock monitoring
      facilities.
      @return the owner, or <code>null</code> if not owned</div>
<a id="L1248" name="L1248"></a>1248     <strong class="reserved">protected</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../R/18200.html" title="Multiple referred from 29 places.">getOwner</a>() <em class="brace">{</em>
<a id="L1249" name="L1249"></a>1249         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21291.html" title="Multiple defined in 12 places.">getOwner</a>();
<a id="L1250" name="L1250"></a>1250     <em class="brace">}</em>
<a id="L1251" name="L1251"></a>1251 
<div class="comment">
      Queries the number of read locks held for this lock. This
      method is designed for use in monitoring system state, not for
      synchronization control.
      @return the number of read locks held</div>
<a id="L1258" name="L1258"></a>1258     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/18607.html" title="Multiple referred from 5 places.">getReadLockCount</a>() <em class="brace">{</em>
<a id="L1259" name="L1259"></a>1259         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21870.html" title="Multiple defined in 4 places.">getReadLockCount</a>();
<a id="L1260" name="L1260"></a>1260     <em class="brace">}</em>
<a id="L1261" name="L1261"></a>1261 
<div class="comment">
      Queries if the write lock is held by any thread. This method is
      designed for use in monitoring system state, not for
      synchronization control.
      @return <code>true</code> if any thread holds the write lock and
              <code>false</code> otherwise</div>
<a id="L1270" name="L1270"></a>1270     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L1271" title="Referred from 1271 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">isWriteLocked</a>() <em class="brace">{</em>
<a id="L1271" name="L1271"></a>1271         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/26523.html" title="Multiple defined in 3 places.">isWriteLocked</a>();
<a id="L1272" name="L1272"></a>1272     <em class="brace">}</em>
<a id="L1273" name="L1273"></a>1273 
<div class="comment">
      Queries if the write lock is held by the current thread.
      @return <code>true</code> if the current thread holds the write lock and
              <code>false</code> otherwise</div>
<a id="L1280" name="L1280"></a>1280     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> isWriteLockedByCurrentThread() <em class="brace">{</em>
<a id="L1281" name="L1281"></a>1281         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>();
<a id="L1282" name="L1282"></a>1282     <em class="brace">}</em>
<a id="L1283" name="L1283"></a>1283 
<div class="comment">
      Queries the number of reentrant write holds on this lock by the
      current thread.  A writer thread has a hold on a lock for
      each lock action that is not matched by an unlock action.
      @return the number of holds on the write lock by the current thread,
              or zero if the write lock is not held by the current thread</div>
<a id="L1292" name="L1292"></a>1292     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/19896.html" title="Multiple referred from 2 places.">getWriteHoldCount</a>() <em class="brace">{</em>
<a id="L1293" name="L1293"></a>1293         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/23730.html" title="Multiple defined in 2 places.">getWriteHoldCount</a>();
<a id="L1294" name="L1294"></a>1294     <em class="brace">}</em>
<a id="L1295" name="L1295"></a>1295 
<div class="comment">
      Queries the number of reentrant read holds on this lock by the
      current thread.  A reader thread has a hold on a lock for
      each lock action that is not matched by an unlock action.
      @return the number of holds on the read lock by the current thread,
              or zero if the read lock is not held by the current thread
      @since 1.6</div>
<a id="L1305" name="L1305"></a>1305     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../S/1043.html#L1306" title="Referred from 1306 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">getReadHoldCount</a>() <em class="brace">{</em>
<a id="L1306" name="L1306"></a>1306         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21869.html" title="Multiple defined in 2 places.">getReadHoldCount</a>();
<a id="L1307" name="L1307"></a>1307     <em class="brace">}</em>
<a id="L1308" name="L1308"></a>1308 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire the write lock.  Because the actual set of threads may
      change dynamically while constructing this result, the returned
      collection is only a best-effort estimate.  The elements of the
      returned collection are in no particular order.  This method is
      designed to facilitate construction of subclasses that provide
      more extensive lock monitoring facilities.
      @return the collection of threads</div>
<a id="L1320" name="L1320"></a>1320     <strong class="reserved">protected</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; getQueuedWriterThreads() <em class="brace">{</em>
<a id="L1321" name="L1321"></a>1321         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/18913.html" title="Multiple defined in 2 places.">getExclusiveQueuedThreads</a>();
<a id="L1322" name="L1322"></a>1322     <em class="brace">}</em>
<a id="L1323" name="L1323"></a>1323 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire the read lock.  Because the actual set of threads may
      change dynamically while constructing this result, the returned
      collection is only a best-effort estimate.  The elements of the
      returned collection are in no particular order.  This method is
      designed to facilitate construction of subclasses that provide
      more extensive lock monitoring facilities.
      @return the collection of threads</div>
<a id="L1335" name="L1335"></a>1335     <strong class="reserved">protected</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; getQueuedReaderThreads() <em class="brace">{</em>
<a id="L1336" name="L1336"></a>1336         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/22468.html" title="Multiple defined in 2 places.">getSharedQueuedThreads</a>();
<a id="L1337" name="L1337"></a>1337     <em class="brace">}</em>
<a id="L1338" name="L1338"></a>1338 
<div class="comment">
      Queries whether any threads are waiting to acquire the read or
      write lock. Note that because cancellations may occur at any
      time, a <code>true</code> return does not guarantee that any other
      thread will ever acquire a lock.  This method is designed
      primarily for use in monitoring of the system state.
      @return <code>true</code> if there may be other threads waiting to
              acquire the lock</div>
<a id="L1349" name="L1349"></a>1349     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20258.html" title="Multiple referred from 5 places.">hasQueuedThreads</a>() <em class="brace">{</em>
<a id="L1350" name="L1350"></a>1350         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/24168.html" title="Multiple defined in 5 places.">hasQueuedThreads</a>();
<a id="L1351" name="L1351"></a>1351     <em class="brace">}</em>
<a id="L1352" name="L1352"></a>1352 
<div class="comment">
      Queries whether the given thread is waiting to acquire either
      the read or write lock. Note that because cancellations may
      occur at any time, a <code>true</code> return does not guarantee
      that this thread will ever acquire a lock.  This method is
      designed primarily for use in monitoring of the system state.
      @param thread the thread
      @return <code>true</code> if the given thread is queued waiting for this lock
      @throws NullPointerException if the thread is null</div>
<a id="L1364" name="L1364"></a>1364     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> hasQueuedThread(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread) <em class="brace">{</em>
<a id="L1365" name="L1365"></a>1365         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/26120.html" title="Multiple defined in 2 places.">isQueued</a>(thread);
<a id="L1366" name="L1366"></a>1366     <em class="brace">}</em>
<a id="L1367" name="L1367"></a>1367 
<div class="comment">
      Returns an estimate of the number of threads waiting to acquire
      either the read or write lock.  The value is only an estimate
      because the number of threads may change dynamically while this
      method traverses internal data structures.  This method is
      designed for use in monitoring of the system state, not for
      synchronization control.
      @return the estimated number of threads waiting for this lock</div>
<a id="L1378" name="L1378"></a>1378     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/18572.html" title="Multiple referred from 3 places.">getQueueLength</a>() <em class="brace">{</em>
<a id="L1379" name="L1379"></a>1379         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21806.html" title="Multiple defined in 5 places.">getQueueLength</a>();
<a id="L1380" name="L1380"></a>1380     <em class="brace">}</em>
<a id="L1381" name="L1381"></a>1381 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire either the read or write lock.  Because the actual set
      of threads may change dynamically while constructing this
      result, the returned collection is only a best-effort estimate.
      The elements of the returned collection are in no particular
      order.  This method is designed to facilitate construction of
      subclasses that provide more extensive monitoring facilities.
      @return the collection of threads</div>
<a id="L1393" name="L1393"></a>1393     <strong class="reserved">protected</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/18573.html" title="Multiple referred from 3 places.">getQueuedThreads</a>() <em class="brace">{</em>
<a id="L1394" name="L1394"></a>1394         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/21810.html" title="Multiple defined in 5 places.">getQueuedThreads</a>();
<a id="L1395" name="L1395"></a>1395     <em class="brace">}</em>
<a id="L1396" name="L1396"></a>1396 
<div class="comment">
      Queries whether any threads are waiting on the given condition
      associated with the write lock. Note that because timeouts and
      interrupts may occur at any time, a <code>true</code> return does
      not guarantee that a future <code>signal</code> will awaken any
      threads.  This method is designed primarily for use in
      monitoring of the system state.
      @param condition the condition
      @return <code>true</code> if there are any waiting threads
      @throws IllegalMonitorStateException if this lock is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this lock
      @throws NullPointerException if the condition is null</div>
<a id="L1412" name="L1412"></a>1412     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/20290.html" title="Multiple referred from 6 places.">hasWaiters</a>(<a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> condition) <em class="brace">{</em>
<a id="L1413" name="L1413"></a>1413         <strong class="reserved">if</strong> (condition == <strong class="reserved">null</strong>)
<a id="L1414" name="L1414"></a>1414             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1415" name="L1415"></a>1415         <strong class="reserved">if</strong> (!(condition <strong class="reserved">instanceof</strong> <a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>))
<a id="L1416" name="L1416"></a>1416             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("not owner");
<a id="L1417" name="L1417"></a>1417         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/24209.html" title="Multiple defined in 6 places.">hasWaiters</a>((<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>)condition);
<a id="L1418" name="L1418"></a>1418     <em class="brace">}</em>
<a id="L1419" name="L1419"></a>1419 
<div class="comment">
      Returns an estimate of the number of threads waiting on the
      given condition associated with the write lock. Note that because
      timeouts and interrupts may occur at any time, the estimate
      serves only as an upper bound on the actual number of waiters.
      This method is designed for use in monitoring of the system
      state, not for synchronization control.
      @param condition the condition
      @return the estimated number of waiting threads
      @throws IllegalMonitorStateException if this lock is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this lock
      @throws NullPointerException if the condition is null</div>
<a id="L1435" name="L1435"></a>1435     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/19840.html" title="Multiple referred from 4 places.">getWaitQueueLength</a>(<a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> condition) <em class="brace">{</em>
<a id="L1436" name="L1436"></a>1436         <strong class="reserved">if</strong> (condition == <strong class="reserved">null</strong>)
<a id="L1437" name="L1437"></a>1437             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1438" name="L1438"></a>1438         <strong class="reserved">if</strong> (!(condition <strong class="reserved">instanceof</strong> <a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>))
<a id="L1439" name="L1439"></a>1439             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("not owner");
<a id="L1440" name="L1440"></a>1440         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/23651.html" title="Multiple defined in 6 places.">getWaitQueueLength</a>((<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>)condition);
<a id="L1441" name="L1441"></a>1441     <em class="brace">}</em>
<a id="L1442" name="L1442"></a>1442 
<div class="comment">
      Returns a collection containing those threads that may be
      waiting on the given condition associated with the write lock.
      Because the actual set of threads may change dynamically while
      constructing this result, the returned collection is only a
      best-effort estimate. The elements of the returned collection
      are in no particular order.  This method is designed to
      facilitate construction of subclasses that provide more
      extensive condition monitoring facilities.
      @param condition the condition
      @return the collection of threads
      @throws IllegalMonitorStateException if this lock is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this lock
      @throws NullPointerException if the condition is null</div>
<a id="L1460" name="L1460"></a>1460     <strong class="reserved">protected</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/19841.html" title="Multiple referred from 4 places.">getWaitingThreads</a>(<a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> condition) <em class="brace">{</em>
<a id="L1461" name="L1461"></a>1461         <strong class="reserved">if</strong> (condition == <strong class="reserved">null</strong>)
<a id="L1462" name="L1462"></a>1462             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1463" name="L1463"></a>1463         <strong class="reserved">if</strong> (!(condition <strong class="reserved">instanceof</strong> <a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>))
<a id="L1464" name="L1464"></a>1464             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("not owner");
<a id="L1465" name="L1465"></a>1465         <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/23655.html" title="Multiple defined in 6 places.">getWaitingThreads</a>((<a href="../S/1046.html#L289" title="Defined at 289 in src/java/util/concurrent/locks/AbstractQueuedSynchronizer.java.">AbstractQueuedSynchronizer</a>.<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a>)condition);
<a id="L1466" name="L1466"></a>1466     <em class="brace">}</em>
<a id="L1467" name="L1467"></a>1467 
<div class="comment">
      Returns a string identifying this lock, as well as its lock state.
      The state, in brackets, includes the String <code>"Write locks ="</code>
      followed by the number of reentrantly held write locks, and the
      String <code>"Read locks ="</code> followed by the number of held
      read locks.
      @return a string identifying this lock, as well as its lock state</div>
<a id="L1477" name="L1477"></a>1477     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L1478" name="L1478"></a>1478         <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>.<a href="../D/18032.html" title="Multiple defined in 16 places.">getCount</a>();
<a id="L1479" name="L1479"></a>1479         <strong class="reserved">int</strong> w = <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a>.<a href="../S/1043.html#L270" title="Defined at 270 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">exclusiveCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L1480" name="L1480"></a>1480         <strong class="reserved">int</strong> r = <a href="../D/8573.html" title="Multiple defined in 5 places.">Sync</a>.<a href="../S/1043.html#L268" title="Defined at 268 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">sharedCount</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L1481" name="L1481"></a>1481 
<a id="L1482" name="L1482"></a>1482         <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L1483" name="L1483"></a>1483             "[Write locks = " + w + ", Read locks = " + r + "]";
<a id="L1484" name="L1484"></a>1484     <em class="brace">}</em>
<a id="L1485" name="L1485"></a>1485 
<div class="comment">
      Returns the thread id for the given thread.  We must access
      this directly rather than via method Thread.getId() because
      getId() is not final, and has been known to be overridden in
      ways that do not preserve unique mappings.</div>
<a id="L1492" name="L1492"></a>1492     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../R/19459.html" title="Multiple referred from 8 places.">getThreadId</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread) <em class="brace">{</em>
<a id="L1493" name="L1493"></a>1493         <strong class="reserved">return</strong> UNSAFE.getLongVolatile(thread, TID_OFFSET);
<a id="L1494" name="L1494"></a>1494     <em class="brace">}</em>
<a id="L1495" name="L1495"></a>1495 
<a id="L1496" name="L1496"></a>1496     <em class="comment">// Unsafe mechanics</em>
<a id="L1497" name="L1497"></a>1497     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> sun.misc.Unsafe UNSAFE;
<a id="L1498" name="L1498"></a>1498     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> TID_OFFSET;
<a id="L1499" name="L1499"></a>1499     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L1500" name="L1500"></a>1500         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1501" name="L1501"></a>1501             UNSAFE = sun.misc.Unsafe.getUnsafe();
<a id="L1502" name="L1502"></a>1502             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; tk = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<strong class="reserved">class</strong>;
<a id="L1503" name="L1503"></a>1503             TID_OFFSET = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1504" name="L1504"></a>1504                 (tk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("tid"));
<a id="L1505" name="L1505"></a>1505         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L1506" name="L1506"></a>1506             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(e);
<a id="L1507" name="L1507"></a>1507         <em class="brace">}</em>
<a id="L1508" name="L1508"></a>1508     <em class="brace">}</em>
<a id="L1509" name="L1509"></a>1509 
<a id="L1510" name="L1510"></a>1510 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L245">[^]</a><a href="#L1492">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>