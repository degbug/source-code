<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/io/BufferedInputStream.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L156">[^]</a><a href="#L476">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L156" title="Defined at 156.">getInIfOpen</a></li>
<li><a href="#L167" title="Defined at 167.">getBufIfOpen</a></li>
<li><a href="#L213" title="Defined at 213.">fill</a></li>
<li><a href="#L263" title="Defined at 263.">read</a></li>
<li><a href="#L276" title="Defined at 276.">read1</a></li>
<li><a href="#L333" title="Defined at 333.">read</a></li>
<li><a href="#L367" title="Defined at 367.">skip</a></li>
<li><a href="#L408" title="Defined at 408.">available</a></li>
<li><a href="#L424" title="Defined at 424.">mark</a></li>
<li><a href="#L445" title="Defined at 445.">reset</a></li>
<li><a href="#L463" title="Defined at 463.">markSupported</a></li>
<li><a href="#L476" title="Defined at 476.">close</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1994, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io;
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.util.concurrent.atomic.AtomicReferenceFieldUpdater;
<a id="L28" name="L28"></a>  28 
<div class="comment">
  A <code>BufferedInputStream</code> adds
  functionality to another input stream-namely,
  the ability to buffer the input and to
  support the <code>mark</code> and <code>reset</code>
  methods. When  the <code>BufferedInputStream</code>
  is created, an internal buffer array is
  created. As bytes  from the stream are read
  or skipped, the internal buffer is refilled
  as necessary  from the contained input stream,
  many bytes at a time. The <code>mark</code>
  operation  remembers a point in the input
  stream and the <code>reset</code> operation
  causes all the  bytes read since the most
  recent <code>mark</code> operation to be
  reread before new bytes are  taken from
  the contained input stream.
  @author  Arthur van Hoff
  @since   JDK1.0</div>
<a id="L50" name="L50"></a>  50 <strong class="reserved">public</strong>
<a id="L51" name="L51"></a>  51 <strong class="reserved">class</strong> <a href="../R/927.html" title="Multiple referred from 45 places.">BufferedInputStream</a> <strong class="reserved">extends</strong> <a href="../S/1442.html#L46" title="Defined at 46 in src/java/io/FilterInputStream.java.">FilterInputStream</a> <em class="brace">{</em>
<a id="L52" name="L52"></a>  52 
<a id="L53" name="L53"></a>  53     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> DEFAULT_BUFFER_SIZE = 8192;
<a id="L54" name="L54"></a>  54 
<div class="comment">
      The maximum size of array to allocate.
      Some VMs reserve some header words in an array.
      Attempts to allocate larger arrays may result in
      OutOfMemoryError: Requested array size exceeds VM limit</div>
<a id="L61" name="L61"></a>  61     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> MAX_BUFFER_SIZE = <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE - 8;
<a id="L62" name="L62"></a>  62 
<div class="comment">
      The internal buffer array where the data is stored. When necessary,
      it may be replaced by another array of
      a different size.</div>
<a id="L68" name="L68"></a>  68     <strong class="reserved">protected</strong> <strong class="reserved">volatile</strong> <strong class="reserved">byte</strong> <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>[];
<a id="L69" name="L69"></a>  69 
<div class="comment">
      Atomic updater to provide compareAndSet for buf. This is
      necessary because closes can be asynchronous. We use nullness
      of buf[] as primary indicator that this stream is closed. (The
      "in" field is also nulled out on close.)</div>
<a id="L76" name="L76"></a>  76     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong>
<a id="L77" name="L77"></a>  77         <a href="../S/1086.html#L84" title="Defined at 84 in src/java/util/concurrent/atomic/AtomicReferenceFieldUpdater.java.">AtomicReferenceFieldUpdater</a>&lt;<a href="../S/1411.html#L51" title="Defined at 51 in src/java/io/BufferedInputStream.java.">BufferedInputStream</a>, <strong class="reserved">byte</strong>[]&gt; bufUpdater =
<a id="L78" name="L78"></a>  78         <a href="../S/1086.html#L84" title="Defined at 84 in src/java/util/concurrent/atomic/AtomicReferenceFieldUpdater.java.">AtomicReferenceFieldUpdater</a>.<a href="../D/28107.html" title="Multiple defined in 3 places.">newUpdater</a>
<a id="L79" name="L79"></a>  79         (<a href="../S/1411.html#L51" title="Defined at 51 in src/java/io/BufferedInputStream.java.">BufferedInputStream</a>.<strong class="reserved">class</strong>,  <strong class="reserved">byte</strong>[].<strong class="reserved">class</strong>, "buf");
<a id="L80" name="L80"></a>  80 
<div class="comment">
      The index one greater than the index of the last valid byte in
      the buffer.
      This value is always
      in the range <code>0</code> through <code>buf.length</code>;
      elements <code>buf[0]</code>  through <code>buf[count-1]
      </code>contain buffered input data obtained
      from the underlying  input stream.</div>
<a id="L90" name="L90"></a>  90     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L91" name="L91"></a>  91 
<div class="comment">
      The current position in the buffer. This is the index of the next
      character to be read from the <code>buf</code> array.
      <p>
      This value is always in the range <code>0</code>
      through <code>count</code>. If it is less
      than <code>count</code>, then  <code>buf[pos]</code>
      is the next byte to be supplied as input;
      if it is equal to <code>count</code>, then
      the  next <code>read</code> or <code>skip</code>
      operation will require more bytes to be
      read from the contained  input stream.
      @see     java.io.BufferedInputStream#buf</p></div>
<a id="L107" name="L107"></a> 107     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> pos;
<a id="L108" name="L108"></a> 108 
<div class="comment">
      The value of the <code>pos</code> field at the time the last
      <code>mark</code> method was called.
      <p>
      This value is always
      in the range <code>-1</code> through <code>pos</code>.
      If there is no marked position in  the input
      stream, this field is <code>-1</code>. If
      there is a marked position in the input
      stream,  then <code>buf[markpos]</code>
      is the first byte to be supplied as input
      after a <code>reset</code> operation. If
      <code>markpos</code> is not <code>-1</code>,
      then all bytes from positions <code>buf[markpos]</code>
      through  <code>buf[pos-1]</code> must remain
      in the buffer array (though they may be
      moved to  another place in the buffer array,
      with suitable adjustments to the values
      of <code>count</code>,  <code>pos</code>,
      and <code>markpos</code>); they may not
      be discarded unless and until the difference
      between <code>pos</code> and <code>markpos</code>
      exceeds <code>marklimit</code>.
      @see     java.io.BufferedInputStream#mark(int)
      @see     java.io.BufferedInputStream#pos</p></div>
<a id="L136" name="L136"></a> 136     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> markpos = -1;
<a id="L137" name="L137"></a> 137 
<div class="comment">
      The maximum read ahead allowed after a call to the
      <code>mark</code> method before subsequent calls to the
      <code>reset</code> method fail.
      Whenever the difference between <code>pos</code>
      and <code>markpos</code> exceeds <code>marklimit</code>,
      then the  mark may be dropped by setting
      <code>markpos</code> to <code>-1</code>.
      @see     java.io.BufferedInputStream#mark(int)
      @see     java.io.BufferedInputStream#reset()</div>
<a id="L150" name="L150"></a> 150     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> marklimit;
<a id="L151" name="L151"></a> 151 
<div class="comment">
      Check to make sure that underlying input stream has not been
      nulled out due to close; if not return it;</div>
<a id="L156" name="L156"></a> 156     <strong class="reserved">private</strong> <a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../R/17017.html" title="Multiple referred from 4 places.">getInIfOpen</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L157" name="L157"></a> 157         <a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> = <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>;
<a id="L158" name="L158"></a> 158         <strong class="reserved">if</strong> (<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> == <strong class="reserved">null</strong>)
<a id="L159" name="L159"></a> 159             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>("Stream closed");
<a id="L160" name="L160"></a> 160         <strong class="reserved">return</strong> <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a>;
<a id="L161" name="L161"></a> 161     <em class="brace">}</em>
<a id="L162" name="L162"></a> 162 
<div class="comment">
      Check to make sure that buffer has not been nulled out due to
      close; if not return it;</div>
<a id="L167" name="L167"></a> 167     <strong class="reserved">private</strong> <strong class="reserved">byte</strong>[] <a href="../R/15340.html" title="Multiple referred from 7 places.">getBufIfOpen</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L168" name="L168"></a> 168         <strong class="reserved">byte</strong>[] <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> = <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>;
<a id="L169" name="L169"></a> 169         <strong class="reserved">if</strong> (<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> == <strong class="reserved">null</strong>)
<a id="L170" name="L170"></a> 170             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>("Stream closed");
<a id="L171" name="L171"></a> 171         <strong class="reserved">return</strong> <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<a id="L172" name="L172"></a> 172     <em class="brace">}</em>
<a id="L173" name="L173"></a> 173 
<div class="comment">
      Creates a <code>BufferedInputStream</code>
      and saves its  argument, the input stream
      <code>in</code>, for later use. An internal
      buffer array is created and  stored in <code>buf</code>.
      @param   in   the underlying input stream.</div>
<a id="L182" name="L182"></a> 182     <strong class="reserved">public</strong> BufferedInputStream(<a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>) <em class="brace">{</em>
<a id="L183" name="L183"></a> 183         <strong class="reserved">this</strong>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>, DEFAULT_BUFFER_SIZE);
<a id="L184" name="L184"></a> 184     <em class="brace">}</em>
<a id="L185" name="L185"></a> 185 
<div class="comment">
      Creates a <code>BufferedInputStream</code>
      with the specified buffer size,
      and saves its  argument, the input stream
      <code>in</code>, for later use.  An internal
      buffer array of length  <code>size</code>
      is created and stored in <code>buf</code>.
      @param   in     the underlying input stream.
      @param   size   the buffer size.
      @exception IllegalArgumentException if <code>size &lt;= 0</code>.</div>
<a id="L198" name="L198"></a> 198     <strong class="reserved">public</strong> BufferedInputStream(<a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>, <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>) <em class="brace">{</em>
<a id="L199" name="L199"></a> 199         <strong class="reserved">super</strong>(<a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>);
<a id="L200" name="L200"></a> 200         <strong class="reserved">if</strong> (<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> &lt;= 0) <em class="brace">{</em>
<a id="L201" name="L201"></a> 201             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Buffer size &lt;= 0");
<a id="L202" name="L202"></a> 202         <em class="brace">}</em>
<a id="L203" name="L203"></a> 203         <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> = <strong class="reserved">new</strong> <strong class="reserved">byte</strong>[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>];
<a id="L204" name="L204"></a> 204     <em class="brace">}</em>
<a id="L205" name="L205"></a> 205 
<div class="comment">
      Fills the buffer with more data, taking into account
      shuffling and other tricks for dealing with marks.
      Assumes that it is being called by a synchronized method.
      This method also assumes that all data has already been read in,
      hence pos &gt; count.</div>
<a id="L213" name="L213"></a> 213     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/14291.html" title="Multiple referred from 1747 places.">fill</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L214" name="L214"></a> 214         <strong class="reserved">byte</strong>[] <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> = <a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>();
<a id="L215" name="L215"></a> 215         <strong class="reserved">if</strong> (markpos &lt; 0)
<div class="comment">
             pos = 0;            /* no mark: throw away the buffer */</div>
<a id="L217" name="L217"></a> 217         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (pos &gt;= <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>.<div class="comment">
/* no room left in buffer */</div>
<a id="L218" name="L218"></a> 218             <strong class="reserved">if</strong> (markpos &gt; 0) <div class="comment">
/* can throw away early part of the buffer */</div>
<a id="L219" name="L219"></a> 219                 <strong class="reserved">int</strong> sz = pos - markpos;
<a id="L220" name="L220"></a> 220                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, markpos, <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, 0, sz);
<a id="L221" name="L221"></a> 221                 pos = sz;
<a id="L222" name="L222"></a> 222                 markpos = 0;
<a id="L223" name="L223"></a> 223             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;= marklimit) <em class="brace">{</em>
<div class="comment">
                 markpos = -1;   /* buffer got too big, invalidate mark */</div>
<div class="comment">
                 pos = 0;        /* drop buffer contents */</div>
<a id="L226" name="L226"></a> 226             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;= MAX_BUFFER_SIZE) <em class="brace">{</em>
<a id="L227" name="L227"></a> 227                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1597.html#L41" title="Defined at 41 in src/java/lang/OutOfMemoryError.java.">OutOfMemoryError</a>("Required array size too large");
<a id="L228" name="L228"></a> 228             <em class="brace">}</em> <strong class="reserved">else</strong> <div class="comment">
/* grow buffer */</div>
<a id="L229" name="L229"></a> 229                 <strong class="reserved">int</strong> nsz = (pos &lt;= MAX_BUFFER_SIZE - pos) ?
<a id="L230" name="L230"></a> 230                         pos * 2 : MAX_BUFFER_SIZE;
<a id="L231" name="L231"></a> 231                 <strong class="reserved">if</strong> (nsz &gt; marklimit)
<a id="L232" name="L232"></a> 232                     nsz = marklimit;
<a id="L233" name="L233"></a> 233                 <strong class="reserved">byte</strong> nbuf[] = <strong class="reserved">new</strong> <strong class="reserved">byte</strong>[nsz];
<a id="L234" name="L234"></a> 234                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, 0, nbuf, 0, pos);
<a id="L235" name="L235"></a> 235                 <strong class="reserved">if</strong> (!bufUpdater.<a href="../D/13035.html" title="Multiple defined in 16 places.">compareAndSet</a>(<strong class="reserved">this</strong>, <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, nbuf)) <em class="brace">{</em>
<a id="L236" name="L236"></a> 236                     <em class="comment">// Can't replace buf if there was an async close.</em>
<a id="L237" name="L237"></a> 237                     <em class="comment">// Note: This would need to be changed if fill()</em>
<a id="L238" name="L238"></a> 238                     <em class="comment">// is ever made accessible to multiple threads.</em>
<a id="L239" name="L239"></a> 239                     <em class="comment">// But for now, the only way CAS can fail is via close.</em>
<a id="L240" name="L240"></a> 240                     <em class="comment">// assert buf == null;</em>
<a id="L241" name="L241"></a> 241                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>("Stream closed");
<a id="L242" name="L242"></a> 242                 <em class="brace">}</em>
<a id="L243" name="L243"></a> 243                 <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> = nbuf;
<a id="L244" name="L244"></a> 244             <em class="brace">}</em>
<a id="L245" name="L245"></a> 245         <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = pos;
<a id="L246" name="L246"></a> 246         <strong class="reserved">int</strong> n = <a href="../S/1411.html#L156" title="Defined at 156 in src/java/io/BufferedInputStream.java.">getInIfOpen</a>().<a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, pos, <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - pos);
<a id="L247" name="L247"></a> 247         <strong class="reserved">if</strong> (n &gt; 0)
<a id="L248" name="L248"></a> 248             <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = n + pos;
<a id="L249" name="L249"></a> 249     <em class="brace">}</em>
<a id="L250" name="L250"></a> 250 
<div class="comment">
      See
      the general contract of the <code>read</code>
      method of <code>InputStream</code>.
      @return     the next byte of data, or <code>-1</code> if the end of the
                  stream is reached.
      @exception  IOException  if this input stream has been closed by
                               invoking its {@link #close()} method,
                               or an I/O error occurs.
      @see        java.io.FilterInputStream#in</div>
<a id="L263" name="L263"></a> 263     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">int</strong> <a href="../R/25407.html" title="Multiple referred from 1300 places.">read</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L264" name="L264"></a> 264         <strong class="reserved">if</strong> (pos &gt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>) <em class="brace">{</em>
<a id="L265" name="L265"></a> 265             <a href="../D/16028.html" title="Multiple defined in 25 places.">fill</a>();
<a id="L266" name="L266"></a> 266             <strong class="reserved">if</strong> (pos &gt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>)
<a id="L267" name="L267"></a> 267                 <strong class="reserved">return</strong> -1;
<a id="L268" name="L268"></a> 268         <em class="brace">}</em>
<a id="L269" name="L269"></a> 269         <strong class="reserved">return</strong> <a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>()[pos++] &amp; 0xff;
<a id="L270" name="L270"></a> 270     <em class="brace">}</em>
<a id="L271" name="L271"></a> 271 
<div class="comment">
      Read characters into a portion of an array, reading from the underlying
      stream at most once if necessary.</div>
<a id="L276" name="L276"></a> 276     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/25409.html" title="Multiple referred from 3 places.">read1</a>(<strong class="reserved">byte</strong>[] b, <strong class="reserved">int</strong> off, <strong class="reserved">int</strong> len) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L277" name="L277"></a> 277         <strong class="reserved">int</strong> avail = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - pos;
<a id="L278" name="L278"></a> 278         <strong class="reserved">if</strong> (avail &lt;= 0) <em class="brace">{</em>
<div class="comment">
 If the requested length is at least as large as the buffer, and
               if there is no mark/reset activity, do not bother to copy the
               bytes into the local buffer.  In this way buffered streams will
               cascade harmlessly. </div>
<a id="L283" name="L283"></a> 283             <strong class="reserved">if</strong> (len &gt;= <a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>().<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &amp;&amp; markpos &lt; 0) <em class="brace">{</em>
<a id="L284" name="L284"></a> 284                 <strong class="reserved">return</strong> <a href="../S/1411.html#L156" title="Defined at 156 in src/java/io/BufferedInputStream.java.">getInIfOpen</a>().<a href="../D/30105.html" title="Multiple defined in 434 places.">read</a>(b, off, len);
<a id="L285" name="L285"></a> 285             <em class="brace">}</em>
<a id="L286" name="L286"></a> 286             <a href="../D/16028.html" title="Multiple defined in 25 places.">fill</a>();
<a id="L287" name="L287"></a> 287             avail = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - pos;
<a id="L288" name="L288"></a> 288             <strong class="reserved">if</strong> (avail &lt;= 0) <strong class="reserved">return</strong> -1;
<a id="L289" name="L289"></a> 289         <em class="brace">}</em>
<a id="L290" name="L290"></a> 290         <strong class="reserved">int</strong> cnt = (avail &lt; len) ? avail : len;
<a id="L291" name="L291"></a> 291         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>(), pos, b, off, cnt);
<a id="L292" name="L292"></a> 292         pos += cnt;
<a id="L293" name="L293"></a> 293         <strong class="reserved">return</strong> cnt;
<a id="L294" name="L294"></a> 294     <em class="brace">}</em>
<a id="L295" name="L295"></a> 295 
<div class="comment">
      Reads bytes from this byte-input stream into the specified byte array,
      starting at the given offset.
      <p> This method implements the general contract of the corresponding
      <code>{@link InputStream#read(byte[], int, int) read}</code> method of
      the <code><a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a></code> class.  As an additional
      convenience, it attempts to read as many bytes as possible by repeatedly
      invoking the <code>read</code> method of the underlying stream.  This
      iterated <code>read</code> continues until one of the following
      conditions becomes true: </p><ul><li> The specified number of bytes have been read,
        </li><li> The <code>read</code> method of the underlying stream returns
        <code>-1</code>, indicating end-of-file, or
        </li><li> The <code>available</code> method of the underlying stream
        returns zero, indicating that further input requests would block.
      </li></ul> If the first <code>read</code> on the underlying stream returns
      <code>-1</code> to indicate end-of-file then this method returns
      <code>-1</code>.  Otherwise this method returns the number of bytes
      actually read.
      <p> Subclasses of this class are encouraged, but not required, to
      attempt to read as many bytes as possible in the same fashion.
      @param      b     destination buffer.
      @param      off   offset at which to start storing bytes.
      @param      len   maximum number of bytes to read.
      @return     the number of bytes read, or <code>-1</code> if the end of
                  the stream has been reached.
      @exception  IOException  if this input stream has been closed by
                               invoking its {@link #close()} method,
                               or an I/O error occurs.</p></div>
<a id="L333" name="L333"></a> 333     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">int</strong> <a href="../R/25407.html" title="Multiple referred from 1300 places.">read</a>(<strong class="reserved">byte</strong> b[], <strong class="reserved">int</strong> off, <strong class="reserved">int</strong> len)
<a id="L334" name="L334"></a> 334         <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>
<a id="L335" name="L335"></a> 335     <em class="brace">{</em>
<a id="L336" name="L336"></a> 336         <a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>(); <em class="comment">// Check for closed stream</em>
<a id="L337" name="L337"></a> 337         <strong class="reserved">if</strong> ((off | len | (off + len) | (b.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - (off + len))) &lt; 0) <em class="brace">{</em>
<a id="L338" name="L338"></a> 338             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1778.html#L38" title="Defined at 38 in src/java/lang/IndexOutOfBoundsException.java.">IndexOutOfBoundsException</a>();
<a id="L339" name="L339"></a> 339         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (len == 0) <em class="brace">{</em>
<a id="L340" name="L340"></a> 340             <strong class="reserved">return</strong> 0;
<a id="L341" name="L341"></a> 341         <em class="brace">}</em>
<a id="L342" name="L342"></a> 342 
<a id="L343" name="L343"></a> 343         <strong class="reserved">int</strong> n = 0;
<a id="L344" name="L344"></a> 344         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L345" name="L345"></a> 345             <strong class="reserved">int</strong> nread = <a href="../D/30107.html" title="Multiple defined in 2 places.">read1</a>(b, off + n, len - n);
<a id="L346" name="L346"></a> 346             <strong class="reserved">if</strong> (nread &lt;= 0)
<a id="L347" name="L347"></a> 347                 <strong class="reserved">return</strong> (n == 0) ? nread : n;
<a id="L348" name="L348"></a> 348             n += nread;
<a id="L349" name="L349"></a> 349             <strong class="reserved">if</strong> (n &gt;= len)
<a id="L350" name="L350"></a> 350                 <strong class="reserved">return</strong> n;
<a id="L351" name="L351"></a> 351             <em class="comment">// if not closed but no bytes available, return</em>
<a id="L352" name="L352"></a> 352             <a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> = <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>;
<a id="L353" name="L353"></a> 353             <strong class="reserved">if</strong> (<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a>.<a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>() &lt;= 0)
<a id="L354" name="L354"></a> 354                 <strong class="reserved">return</strong> n;
<a id="L355" name="L355"></a> 355         <em class="brace">}</em>
<a id="L356" name="L356"></a> 356     <em class="brace">}</em>
<a id="L357" name="L357"></a> 357 
<div class="comment">
      See the general contract of the <code>skip</code>
      method of <code>InputStream</code>.
      @exception  IOException  if the stream does not support seek,
                               or if this input stream has been closed by
                               invoking its {@link #close()} method, or an
                               I/O error occurs.</div>
<a id="L367" name="L367"></a> 367     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">long</strong> <a href="../R/28643.html" title="Multiple referred from 174 places.">skip</a>(<strong class="reserved">long</strong> n) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L368" name="L368"></a> 368         <a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>(); <em class="comment">// Check for closed stream</em>
<a id="L369" name="L369"></a> 369         <strong class="reserved">if</strong> (n &lt;= 0) <em class="brace">{</em>
<a id="L370" name="L370"></a> 370             <strong class="reserved">return</strong> 0;
<a id="L371" name="L371"></a> 371         <em class="brace">}</em>
<a id="L372" name="L372"></a> 372         <strong class="reserved">long</strong> avail = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - pos;
<a id="L373" name="L373"></a> 373 
<a id="L374" name="L374"></a> 374         <strong class="reserved">if</strong> (avail &lt;= 0) <em class="brace">{</em>
<a id="L375" name="L375"></a> 375             <em class="comment">// If no mark position set then don't keep in buffer</em>
<a id="L376" name="L376"></a> 376             <strong class="reserved">if</strong> (markpos &lt;0)
<a id="L377" name="L377"></a> 377                 <strong class="reserved">return</strong> <a href="../S/1411.html#L156" title="Defined at 156 in src/java/io/BufferedInputStream.java.">getInIfOpen</a>().<a href="../D/34598.html" title="Multiple defined in 46 places.">skip</a>(n);
<a id="L378" name="L378"></a> 378 
<a id="L379" name="L379"></a> 379             <em class="comment">// Fill in buffer to save bytes for reset</em>
<a id="L380" name="L380"></a> 380             <a href="../D/16028.html" title="Multiple defined in 25 places.">fill</a>();
<a id="L381" name="L381"></a> 381             avail = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - pos;
<a id="L382" name="L382"></a> 382             <strong class="reserved">if</strong> (avail &lt;= 0)
<a id="L383" name="L383"></a> 383                 <strong class="reserved">return</strong> 0;
<a id="L384" name="L384"></a> 384         <em class="brace">}</em>
<a id="L385" name="L385"></a> 385 
<a id="L386" name="L386"></a> 386         <strong class="reserved">long</strong> <a href="../S/1947.html#L101" title="Defined at 101 in src/java/nio/file/FileTreeWalker.java.">skipped</a> = (avail &lt; n) ? avail : n;
<a id="L387" name="L387"></a> 387         pos += <a href="../S/1947.html#L101" title="Defined at 101 in src/java/nio/file/FileTreeWalker.java.">skipped</a>;
<a id="L388" name="L388"></a> 388         <strong class="reserved">return</strong> <a href="../S/1947.html#L101" title="Defined at 101 in src/java/nio/file/FileTreeWalker.java.">skipped</a>;
<a id="L389" name="L389"></a> 389     <em class="brace">}</em>
<a id="L390" name="L390"></a> 390 
<div class="comment">
      Returns an estimate of the number of bytes that can be read (or
      skipped over) from this input stream without blocking by the next
      invocation of a method for this input stream. The next invocation might be
      the same thread or another thread.  A single read or skip of this
      many bytes will not block, but may read or skip fewer bytes.
      <p>
      This method returns the sum of the number of bytes remaining to be read in
      the buffer (<code>count&nbsp;- pos</code>) and the result of calling the
      {@link java.io.FilterInputStream#in in}.available().
      @return     an estimate of the number of bytes that can be read (or skipped
                  over) from this input stream without blocking.
      @exception  IOException  if this input stream has been closed by
                               invoking its {@link #close()} method,
                               or an I/O error occurs.</p></div>
<a id="L408" name="L408"></a> 408     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">int</strong> <a href="../R/10425.html" title="Multiple referred from 160 places.">available</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L409" name="L409"></a> 409         <strong class="reserved">int</strong> n = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - pos;
<a id="L410" name="L410"></a> 410         <strong class="reserved">int</strong> avail = <a href="../S/1411.html#L156" title="Defined at 156 in src/java/io/BufferedInputStream.java.">getInIfOpen</a>().<a href="../D/11656.html" title="Multiple defined in 33 places.">available</a>();
<a id="L411" name="L411"></a> 411         <strong class="reserved">return</strong> n &gt; (<a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE - avail)
<a id="L412" name="L412"></a> 412                     ? <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE
<a id="L413" name="L413"></a> 413                     : n + avail;
<a id="L414" name="L414"></a> 414     <em class="brace">}</em>
<a id="L415" name="L415"></a> 415 
<div class="comment">
      See the general contract of the <code>mark</code>
      method of <code>InputStream</code>.
      @param   readlimit   the maximum limit of bytes that can be read before
                           the mark position becomes invalid.
      @see     java.io.BufferedInputStream#reset()</div>
<a id="L424" name="L424"></a> 424     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/23088.html" title="Multiple referred from 334 places.">mark</a>(<strong class="reserved">int</strong> readlimit) <em class="brace">{</em>
<a id="L425" name="L425"></a> 425         marklimit = readlimit;
<a id="L426" name="L426"></a> 426         markpos = pos;
<a id="L427" name="L427"></a> 427     <em class="brace">}</em>
<a id="L428" name="L428"></a> 428 
<div class="comment">
      See the general contract of the <code>reset</code>
      method of <code>InputStream</code>.
      <p>
      If <code>markpos</code> is <code>-1</code>
      (no mark has been set or the mark has been
      invalidated), an <code>IOException</code>
      is thrown. Otherwise, <code>pos</code> is
      set equal to <code>markpos</code>.
      @exception  IOException  if this stream has not been marked or,
                       if the mark has been invalidated, or the stream
                       has been closed by invoking its {@link #close()}
                       method, or an I/O error occurs.
      @see        java.io.BufferedInputStream#mark(int)</p></div>
<a id="L445" name="L445"></a> 445     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/26238.html" title="Multiple referred from 619 places.">reset</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L446" name="L446"></a> 446         <a href="../S/1411.html#L167" title="Defined at 167 in src/java/io/BufferedInputStream.java.">getBufIfOpen</a>(); <em class="comment">// Cause exception if closed</em>
<a id="L447" name="L447"></a> 447         <strong class="reserved">if</strong> (markpos &lt; 0)
<a id="L448" name="L448"></a> 448             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>("Resetting to invalid mark");
<a id="L449" name="L449"></a> 449         pos = markpos;
<a id="L450" name="L450"></a> 450     <em class="brace">}</em>
<a id="L451" name="L451"></a> 451 
<div class="comment">
      Tests if this input stream supports the <code>mark</code>
      and <code>reset</code> methods. The <code>markSupported</code>
      method of <code>BufferedInputStream</code> returns
      <code>true</code>.
      @return  a <code>boolean</code> indicating if this stream type supports
               the <code>mark</code> and <code>reset</code> methods.
      @see     java.io.InputStream#mark(int)
      @see     java.io.InputStream#reset()</div>
<a id="L463" name="L463"></a> 463     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/23104.html" title="Multiple referred from 12 places.">markSupported</a>() <em class="brace">{</em>
<a id="L464" name="L464"></a> 464         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L465" name="L465"></a> 465     <em class="brace">}</em>
<a id="L466" name="L466"></a> 466 
<div class="comment">
      Closes this input stream and releases any system resources
      associated with the stream.
      Once the stream has been closed, further read(), available(), reset(),
      or skip() invocations will throw an IOException.
      Closing a previously closed stream has no effect.
      @exception  IOException  if an I/O error occurs.</div>
<a id="L476" name="L476"></a> 476     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/11587.html" title="Multiple referred from 410 places.">close</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L477" name="L477"></a> 477         <strong class="reserved">byte</strong>[] <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>;
<a id="L478" name="L478"></a> 478         <strong class="reserved">while</strong> ( (<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> = <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L479" name="L479"></a> 479             <strong class="reserved">if</strong> (bufUpdater.<a href="../D/13035.html" title="Multiple defined in 16 places.">compareAndSet</a>(<strong class="reserved">this</strong>, <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L480" name="L480"></a> 480                 <a href="../D/4231.html" title="Multiple defined in 3 places.">InputStream</a> <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> = <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a>;
<a id="L481" name="L481"></a> 481                 <a href="../D/24395.html" title="Multiple defined in 2 places.">in</a> = <strong class="reserved">null</strong>;
<a id="L482" name="L482"></a> 482                 <strong class="reserved">if</strong> (<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> != <strong class="reserved">null</strong>)
<a id="L483" name="L483"></a> 483                     <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a>.<a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>();
<a id="L484" name="L484"></a> 484                 <strong class="reserved">return</strong>;
<a id="L485" name="L485"></a> 485             <em class="brace">}</em>
<a id="L486" name="L486"></a> 486             <em class="comment">// Else retry in case a new buf was CASed in fill()</em>
<a id="L487" name="L487"></a> 487         <em class="brace">}</em>
<a id="L488" name="L488"></a> 488     <em class="brace">}</em>
<a id="L489" name="L489"></a> 489 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L156">[^]</a><a href="#L476">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>