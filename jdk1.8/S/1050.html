<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/locks/StampedLock.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L350">[^]</a><a href="#L1312">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L350" title="Defined at 350.">writeLock</a></li>
<li><a href="#L363" title="Defined at 363.">tryWriteLock</a></li>
<li><a href="#L383" title="Defined at 383.">tryWriteLock</a></li>
<li><a href="#L410" title="Defined at 410.">writeLockInterruptibly</a></li>
<li><a href="#L424" title="Defined at 424.">readLock</a></li>
<li><a href="#L437" title="Defined at 437.">tryReadLock</a></li>
<li><a href="#L464" title="Defined at 464.">tryReadLock</a></li>
<li><a href="#L497" title="Defined at 497.">readLockInterruptibly</a></li>
<li><a href="#L511" title="Defined at 511.">tryOptimisticRead</a></li>
<li><a href="#L528" title="Defined at 528.">validate</a></li>
<li><a href="#L541" title="Defined at 541.">unlockWrite</a></li>
<li><a href="#L558" title="Defined at 558.">unlockRead</a></li>
<li><a href="#L584" title="Defined at 584.">unlock</a></li>
<li><a href="#L624" title="Defined at 624.">tryConvertToWriteLock</a></li>
<li><a href="#L660" title="Defined at 660.">tryConvertToReadLock</a></li>
<li><a href="#L699" title="Defined at 699.">tryConvertToOptimisticRead</a></li>
<li><a href="#L740" title="Defined at 740.">tryUnlockWrite</a></li>
<li><a href="#L758" title="Defined at 758.">tryUnlockRead</a></li>
<li><a href="#L780" title="Defined at 780.">getReadLockCount</a></li>
<li><a href="#L792" title="Defined at 792.">isWriteLocked</a></li>
<li><a href="#L801" title="Defined at 801.">isReadLocked</a></li>
<li><a href="#L811" title="Defined at 811.">getReadLockCount</a></li>
<li><a href="#L824" title="Defined at 824.">toString</a></li>
<li><a href="#L844" title="Defined at 844.">asReadLock</a></li>
<li><a href="#L860" title="Defined at 860.">asWriteLock</a></li>
<li><a href="#L874" title="Defined at 874.">asReadWriteLock</a></li>
<li><a href="#L883" title="Defined at 883.">lock</a></li>
<li><a href="#L884" title="Defined at 884.">lockInterruptibly</a></li>
<li><a href="#L887" title="Defined at 887.">tryLock</a></li>
<li><a href="#L888" title="Defined at 888.">tryLock</a></li>
<li><a href="#L892" title="Defined at 892.">unlock</a></li>
<li><a href="#L893" title="Defined at 893.">newCondition</a></li>
<li><a href="#L899" title="Defined at 899.">lock</a></li>
<li><a href="#L900" title="Defined at 900.">lockInterruptibly</a></li>
<li><a href="#L903" title="Defined at 903.">tryLock</a></li>
<li><a href="#L904" title="Defined at 904.">tryLock</a></li>
<li><a href="#L908" title="Defined at 908.">unlock</a></li>
<li><a href="#L909" title="Defined at 909.">newCondition</a></li>
<li><a href="#L915" title="Defined at 915.">readLock</a></li>
<li><a href="#L916" title="Defined at 916.">writeLock</a></li>
<li><a href="#L922" title="Defined at 922.">unstampedUnlockWrite</a></li>
<li><a href="#L931" title="Defined at 931.">unstampedUnlockRead</a></li>
<li><a href="#L948" title="Defined at 948.">readObject</a></li>
<li><a href="#L964" title="Defined at 964.">tryIncReaderOverflow</a></li>
<li><a href="#L985" title="Defined at 985.">tryDecReaderOverflow</a></li>
<li><a href="#L1013" title="Defined at 1013.">release</a></li>
<li><a href="#L1036" title="Defined at 1036.">acquireWrite</a></li>
<li><a href="#L1138" title="Defined at 1138.">acquireRead</a></li>
<li><a href="#L1312" title="Defined at 1312.">cancelWaiter</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent.locks;
<a id="L37" name="L37"></a>  37 
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.concurrent.TimeUnit;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.concurrent.locks.Lock;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.util.concurrent.locks.Condition;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.util.concurrent.locks.ReadWriteLock;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> java.util.concurrent.locks.LockSupport;
<a id="L43" name="L43"></a>  43 
<div class="comment">
  A capability-based lock with three modes for controlling read/write
  access.  The state of a StampedLock consists of a version and mode.
  Lock acquisition methods return a stamp that represents and
  controls access with respect to a lock state; "try" versions of
  these methods may instead return the special value zero to
  represent failure to acquire access. Lock release and conversion
  methods require stamps as arguments, and fail if they do not match
  the state of the lock. The three modes are:
  <ul><li><b>Writing.</b> Method {@link #writeLock} possibly blocks
    waiting for exclusive access, returning a stamp that can be used
    in method {@link #unlockWrite} to release the lock. Untimed and
    timed versions of <code>tryWriteLock</code> are also provided. When
    the lock is held in write mode, no read locks may be obtained,
    and all optimistic read validations will fail.  </li><li><b>Reading.</b> Method {@link #readLock} possibly blocks
    waiting for non-exclusive access, returning a stamp that can be
    used in method {@link #unlockRead} to release the lock. Untimed
    and timed versions of <code>tryReadLock</code> are also provided. </li><li><b>Optimistic Reading.</b> Method {@link #tryOptimisticRead}
    returns a non-zero stamp only if the lock is not currently held
    in write mode. Method {@link #validate} returns true if the lock
    has not been acquired in write mode since obtaining a given
    stamp.  This mode can be thought of as an extremely weak version
    of a read-lock, that can be broken by a writer at any time.  The
    use of optimistic mode for short read-only code segments often
    reduces contention and improves throughput.  However, its use is
    inherently fragile.  Optimistic read sections should only read
    fields and hold them in local variables for later use after
    validation. Fields read while in optimistic mode may be wildly
    inconsistent, so usage applies only when you are familiar enough
    with data representations to check consistency and/or repeatedly
    invoke method <code>validate()</code>.  For example, such steps are
    typically required when first reading an object or array
    reference, and then accessing one of its fields, elements or
    methods. </li>
  </ul>
  <p>This class also supports methods that conditionally provide
  conversions across the three modes. For example, method {@link
  #tryConvertToWriteLock} attempts to "upgrade" a mode, returning
  a valid write stamp if (1) already in writing mode (2) in reading
  mode and there are no other readers or (3) in optimistic mode and
  the lock is available. The forms of these methods are designed to
  help reduce some of the code bloat that otherwise occurs in
  retry-based designs.
  </p><p>StampedLocks are designed for use as internal utilities in the
  development of thread-safe components. Their use relies on
  knowledge of the internal properties of the data, objects, and
  methods they are protecting.  They are not reentrant, so locked
  bodies should not call other unknown methods that may try to
  re-acquire locks (although you may pass a stamp to other methods
  that can use or convert it).  The use of read lock modes relies on
  the associated code sections being side-effect-free.  Unvalidated
  optimistic read sections cannot call methods that are not known to
  tolerate potential inconsistencies.  Stamps use finite
  representations, and are not cryptographically secure (i.e., a
  valid stamp may be guessable). Stamp values may recycle after (no
  sooner than) one year of continuous operation. A stamp held without
  use or validation for longer than this period may fail to validate
  correctly.  StampedLocks are serializable, but always deserialize
  into initial unlocked state, so they are not useful for remote
  locking.
  </p><p>The scheduling policy of StampedLock does not consistently
  prefer readers over writers or vice versa.  All "try" methods are
  best-effort and do not necessarily conform to any scheduling or
  fairness policy. A zero return from any "try" method for acquiring
  or converting locks does not carry any information about the state
  of the lock; a subsequent invocation may succeed.
  </p><p>Because it supports coordinated usage across multiple lock
  modes, this class does not directly implement the {@link Lock} or
  {@link ReadWriteLock} interfaces. However, a StampedLock may be
  viewed {@link #asReadLock()}, {@link #asWriteLock()}, or {@link
  #asReadWriteLock()} in applications requiring only the associated
  set of functionality.
  </p><p><b>Sample Usage.</b> The following illustrates some usage idioms
  in a class that maintains simple two-dimensional points. The sample
  code illustrates some try/catch conventions even though they are
  not strictly needed here because no exceptions can occur in their
  bodies.<br>
   </p><pre>{@code
  class Point {
    private double x, y;
    private final StampedLock sl = new StampedLock();
    void move(double deltaX, double deltaY) { // an exclusively locked method
      long stamp = sl.writeLock();
      try {
        x += deltaX;
        y += deltaY;
      } finally {
        sl.unlockWrite(stamp);
      }
    }
    double distanceFromOrigin() { // A read-only method
      long stamp = sl.tryOptimisticRead();
      double currentX = x, currentY = y;
      if (!sl.validate(stamp)) {
         stamp = sl.readLock();
         try {
           currentX = x;
           currentY = y;
         } finally {
            sl.unlockRead(stamp);
         }
      }
      return Math.sqrt(currentX * currentX + currentY * currentY);
    }
    void moveIfAtOrigin(double newX, double newY) { // upgrade
      // Could instead start with optimistic, not read mode
      long stamp = sl.readLock();
      try {
        while (x == 0.0 &amp;&amp; y == 0.0) {
          long ws = sl.tryConvertToWriteLock(stamp);
          if (ws != 0L) {
            stamp = ws;
            x = newX;
            y = newY;
            break;
          }
          else {
            sl.unlockRead(stamp);
            stamp = sl.writeLock();
          }
        }
      } finally {
        sl.unlock(stamp);
      }
    }
  }}</pre>
  @since 1.8
  @author Doug Lea</div>
<a id="L191" name="L191"></a> 191 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../S/1050.html#L1392" title="Referred from 1392 in src/java/util/concurrent/locks/StampedLock.java.">StampedLock</a> <strong class="reserved">implements</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<div class="comment">
      Algorithmic notes:
      The design employs elements of Sequence locks
      (as used in linux kernels; see Lameter's
      http://www.lameter.com/gelato2005.pdf
      and elsewhere; see
      Boehm's http://www.hpl.hp.com/techreports/2012/HPL-2012-68.html)
      and Ordered RW locks (see Shirako et al
      http://dl.acm.org/citation.cfm?id=2312015)
      Conceptually, the primary state of the lock includes a sequence
      number that is odd when write-locked and even otherwise.
      However, this is offset by a reader count that is non-zero when
      read-locked.  The read count is ignored when validating
      "optimistic" seqlock-reader-style stamps.  Because we must use
      a small finite number of bits (currently 7) for readers, a
      supplementary reader overflow word is used when the number of
      readers exceeds the count field. We do this by treating the max
      reader count value (RBITS) as a spinlock protecting overflow
      updates.
      Waiters use a modified form of CLH lock used in
      AbstractQueuedSynchronizer (see its internal documentation for
      a fuller account), where each node is tagged (field mode) as
      either a reader or writer. Sets of waiting readers are grouped
      (linked) under a common node (field cowait) so act as a single
      node with respect to most CLH mechanics.  By virtue of the
      queue structure, wait nodes need not actually carry sequence
      numbers; we know each is greater than its predecessor.  This
      simplifies the scheduling policy to a mainly-FIFO scheme that
      incorporates elements of Phase-Fair locks (see Brandenburg &amp;
      Anderson, especially http://www.cs.unc.edu/~bbb/diss/).  In
      particular, we use the phase-fair anti-barging rule: If an
      incoming reader arrives while read lock is held but there is a
      queued writer, this incoming reader is queued.  (This rule is
      responsible for some of the complexity of method acquireRead,
      but without it, the lock becomes highly unfair.) Method release
      does not (and sometimes cannot) itself wake up cowaiters. This
      is done by the primary thread, but helped by any other threads
      with nothing better to do in methods acquireRead and
      acquireWrite.
      These rules apply to threads actually queued. All tryLock forms
      opportunistically try to acquire locks regardless of preference
      rules, and so may "barge" their way in.  Randomized spinning is
      used in the acquire methods to reduce (increasingly expensive)
      context switching while also avoiding sustained memory
      thrashing among many threads.  We limit spins to the head of
      queue. A thread spin-waits up to SPINS times (where each
      iteration decreases spin count with 50% probability) before
      blocking. If, upon wakening it fails to obtain lock, and is
      still (or becomes) the first waiting thread (which indicates
      that some other thread barged and obtained lock), it escalates
      spins (up to MAX_HEAD_SPINS) to reduce the likelihood of
      continually losing to barging threads.
      Nearly all of these mechanics are carried out in methods
      acquireWrite and acquireRead, that, as typical of such code,
      sprawl out because actions and retries rely on consistent sets
      of locally cached reads.
      As noted in Boehm's paper (above), sequence validation (mainly
      method validate()) requires stricter ordering rules than apply
      to normal volatile reads (of "state").  To force orderings of
      reads before a validation and the validation itself in those
      cases where this is not already forced, we use
      Unsafe.loadFence.
      The memory layout keeps lock state and queue pointers together
      (normally on the same cache line). This usually works well for
      read-mostly loads. In most other cases, the natural tendency of
      adaptive-spin CLH locks to reduce memory contention lessens
      motivation to further spread out contended locations, but might
      be subject to future improvements.</div>
<a id="L268" name="L268"></a> 268 
<a id="L269" name="L269"></a> 269     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -6001602636862214147L;
<a id="L270" name="L270"></a> 270 
<div class="comment">
     /** Number of processors, for spin control */</div>
<a id="L272" name="L272"></a> 272     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> NCPU = <a href="../S/1774.html#L46" title="Defined at 46 in src/java/lang/Runtime.java.">Runtime</a>.<a href="../S/1774.html#L57" title="Defined at 57 in src/java/lang/Runtime.java.">getRuntime</a>().<a href="../S/1774.html#L635" title="Defined at 635 in src/java/lang/Runtime.java.">availableProcessors</a>();
<a id="L273" name="L273"></a> 273 
<div class="comment">
     /** Maximum number of retries before enqueuing on acquisition */</div>
<a id="L275" name="L275"></a> 275     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SPINS = (NCPU &gt; 1) ? 1 &lt;&lt; 6 : 0;
<a id="L276" name="L276"></a> 276 
<div class="comment">
     /** Maximum number of retries before blocking at head on acquisition */</div>
<a id="L278" name="L278"></a> 278     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> HEAD_SPINS = (NCPU &gt; 1) ? 1 &lt;&lt; 10 : 0;
<a id="L279" name="L279"></a> 279 
<div class="comment">
     /** Maximum number of retries before re-blocking */</div>
<a id="L281" name="L281"></a> 281     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_HEAD_SPINS = (NCPU &gt; 1) ? 1 &lt;&lt; 16 : 0;
<a id="L282" name="L282"></a> 282 
<div class="comment">
     /** The period for yielding when waiting for overflow spinlock */</div>
<a id="L284" name="L284"></a> 284     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> OVERFLOW_YIELD_RATE = 7; <em class="comment">// must be power 2 - 1</em>
<a id="L285" name="L285"></a> 285 
<div class="comment">
     /** The number of bits to use for reader count before overflowing */</div>
<a id="L287" name="L287"></a> 287     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> LG_READERS = 7;
<a id="L288" name="L288"></a> 288 
<a id="L289" name="L289"></a> 289     <em class="comment">// Values for lock state and stamp operations</em>
<a id="L290" name="L290"></a> 290     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> RUNIT = 1L;
<a id="L291" name="L291"></a> 291     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> WBIT  = 1L &lt;&lt; LG_READERS;
<a id="L292" name="L292"></a> 292     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> RBITS = WBIT - 1L;
<a id="L293" name="L293"></a> 293     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> RFULL = RBITS - 1L;
<a id="L294" name="L294"></a> 294     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> ABITS = RBITS | WBIT;
<a id="L295" name="L295"></a> 295     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> SBITS = ~RBITS; <em class="comment">// note overlap with ABITS</em>
<a id="L296" name="L296"></a> 296 
<a id="L297" name="L297"></a> 297     <em class="comment">// Initial value for lock state; avoid failure value zero</em>
<a id="L298" name="L298"></a> 298     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> ORIGIN = WBIT &lt;&lt; 1;
<a id="L299" name="L299"></a> 299 
<a id="L300" name="L300"></a> 300     <em class="comment">// Special value from cancelled acquire methods so caller can throw IE</em>
<a id="L301" name="L301"></a> 301     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> INTERRUPTED = 1L;
<a id="L302" name="L302"></a> 302 
<a id="L303" name="L303"></a> 303     <em class="comment">// Values for node status; order matters</em>
<a id="L304" name="L304"></a> 304     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> WAITING   = -1;
<a id="L305" name="L305"></a> 305     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CANCELLED =  1;
<a id="L306" name="L306"></a> 306 
<a id="L307" name="L307"></a> 307     <em class="comment">// Modes for nodes (int not boolean to allow arithmetic)</em>
<a id="L308" name="L308"></a> 308     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> RMODE = 0;
<a id="L309" name="L309"></a> 309     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> WMODE = 1;
<a id="L310" name="L310"></a> 310 
<div class="comment">
     /** Wait nodes */</div>
<a id="L312" name="L312"></a> 312     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/8703.html" title="Multiple referred from 43 places.">WNode</a> <em class="brace">{</em>
<a id="L313" name="L313"></a> 313         <strong class="reserved">volatile</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> prev;
<a id="L314" name="L314"></a> 314         <strong class="reserved">volatile</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L315" name="L315"></a> 315         <strong class="reserved">volatile</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> cowait;    <em class="comment">// list of linked readers</em>
<a id="L316" name="L316"></a> 316         <strong class="reserved">volatile</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread;   <em class="comment">// non-null while possibly parked</em>
<a id="L317" name="L317"></a> 317         <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> <a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a>;      <em class="comment">// 0, WAITING, or CANCELLED</em>
<a id="L318" name="L318"></a> 318         <strong class="reserved">final</strong> <strong class="reserved">int</strong> mode;           <em class="comment">// RMODE or WMODE</em>
<a id="L319" name="L319"></a> 319         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a>(<strong class="reserved">int</strong> m, WNode p) <em class="brace">{</em> mode = m; prev = p; <em class="brace">}</em>
<a id="L320" name="L320"></a> 320     <em class="brace">}</em>
<a id="L321" name="L321"></a> 321 
<div class="comment">
     /** Head of CLH queue */</div>
<a id="L323" name="L323"></a> 323     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> whead;
<div class="comment">
     /** Tail (last) of CLH queue */</div>
<a id="L325" name="L325"></a> 325     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> wtail;
<a id="L326" name="L326"></a> 326 
<a id="L327" name="L327"></a> 327     <em class="comment">// views</em>
<a id="L328" name="L328"></a> 328     <strong class="reserved">transient</strong> <a href="../S/1050.html#L882" title="Defined at 882 in src/java/util/concurrent/locks/StampedLock.java.">ReadLockView</a> readLockView;
<a id="L329" name="L329"></a> 329     <strong class="reserved">transient</strong> <a href="../S/1050.html#L898" title="Defined at 898 in src/java/util/concurrent/locks/StampedLock.java.">WriteLockView</a> writeLockView;
<a id="L330" name="L330"></a> 330     <strong class="reserved">transient</strong> <a href="../S/1050.html#L914" title="Defined at 914 in src/java/util/concurrent/locks/StampedLock.java.">ReadWriteLockView</a> readWriteLockView;
<a id="L331" name="L331"></a> 331 
<div class="comment">
     /** Lock sequence/state */</div>
<a id="L333" name="L333"></a> 333     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <strong class="reserved">long</strong> <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>;
<div class="comment">
     /** extra reader count when state read count saturated */</div>
<a id="L335" name="L335"></a> 335     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">int</strong> readerOverflow;
<a id="L336" name="L336"></a> 336 
<div class="comment">
      Creates a new lock, initially in unlocked state.</div>
<a id="L340" name="L340"></a> 340     <strong class="reserved">public</strong> StampedLock() <em class="brace">{</em>
<a id="L341" name="L341"></a> 341         <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = ORIGIN;
<a id="L342" name="L342"></a> 342     <em class="brace">}</em>
<a id="L343" name="L343"></a> 343 
<div class="comment">
      Exclusively acquires the lock, blocking if necessary
      until available.
      @return a stamp that can be used to unlock or convert mode</div>
<a id="L350" name="L350"></a> 350     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/30659.html" title="Multiple referred from 42 places.">writeLock</a>() <em class="brace">{</em>
<a id="L351" name="L351"></a> 351         <strong class="reserved">long</strong> s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;  <em class="comment">// bypass acquireWrite in fully unlocked case only</em>
<a id="L352" name="L352"></a> 352         <strong class="reserved">return</strong> ((((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) == 0L &amp;&amp;
<a id="L353" name="L353"></a> 353                  U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + WBIT)) ?
<a id="L354" name="L354"></a> 354                 <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> : <a href="../S/1050.html#L1036" title="Defined at 1036 in src/java/util/concurrent/locks/StampedLock.java.">acquireWrite</a>(<strong class="reserved">false</strong>, 0L));
<a id="L355" name="L355"></a> 355     <em class="brace">}</em>
<a id="L356" name="L356"></a> 356 
<div class="comment">
      Exclusively acquires the lock if it is immediately available.
      @return a stamp that can be used to unlock or convert mode,
      or zero if the lock is not available</div>
<a id="L363" name="L363"></a> 363     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/29567.html" title="Multiple referred from 4 places.">tryWriteLock</a>() <em class="brace">{</em>
<a id="L364" name="L364"></a> 364         <strong class="reserved">long</strong> s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L365" name="L365"></a> 365         <strong class="reserved">return</strong> ((((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) == 0L &amp;&amp;
<a id="L366" name="L366"></a> 366                  U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + WBIT)) ?
<a id="L367" name="L367"></a> 367                 <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> : 0L);
<a id="L368" name="L368"></a> 368     <em class="brace">}</em>
<a id="L369" name="L369"></a> 369 
<div class="comment">
      Exclusively acquires the lock if it is available within the
      given time and the current thread has not been interrupted.
      Behavior under timeout and interruption matches that specified
      for method {@link Lock#tryLock(long,TimeUnit)}.
      @param time the maximum time to wait for the lock
      @param unit the time unit of the <code>time</code> argument
      @return a stamp that can be used to unlock or convert mode,
      or zero if the lock is not available
      @throws InterruptedException if the current thread is interrupted
      before acquiring the lock</div>
<a id="L383" name="L383"></a> 383     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/29567.html" title="Multiple referred from 4 places.">tryWriteLock</a>(<strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L384" name="L384"></a> 384         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L385" name="L385"></a> 385         <strong class="reserved">long</strong> nanos = unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);
<a id="L386" name="L386"></a> 386         <strong class="reserved">if</strong> (!<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>()) <em class="brace">{</em>
<a id="L387" name="L387"></a> 387             <strong class="reserved">long</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>, deadline;
<a id="L388" name="L388"></a> 388             <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/35746.html" title="Multiple defined in 3 places.">tryWriteLock</a>()) != 0L)
<a id="L389" name="L389"></a> 389                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L390" name="L390"></a> 390             <strong class="reserved">if</strong> (nanos &lt;= 0L)
<a id="L391" name="L391"></a> 391                 <strong class="reserved">return</strong> 0L;
<a id="L392" name="L392"></a> 392             <strong class="reserved">if</strong> ((deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanos) == 0L)
<a id="L393" name="L393"></a> 393                 deadline = 1L;
<a id="L394" name="L394"></a> 394             <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L1036" title="Defined at 1036 in src/java/util/concurrent/locks/StampedLock.java.">acquireWrite</a>(<strong class="reserved">true</strong>, deadline)) != INTERRUPTED)
<a id="L395" name="L395"></a> 395                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L396" name="L396"></a> 396         <em class="brace">}</em>
<a id="L397" name="L397"></a> 397         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L398" name="L398"></a> 398     <em class="brace">}</em>
<a id="L399" name="L399"></a> 399 
<div class="comment">
      Exclusively acquires the lock, blocking if necessary
      until available or the current thread is interrupted.
      Behavior under interruption matches that specified
      for method {@link Lock#lockInterruptibly()}.
      @return a stamp that can be used to unlock or convert mode
      @throws InterruptedException if the current thread is interrupted
      before acquiring the lock</div>
<a id="L410" name="L410"></a> 410     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../S/1050.html#L901" title="Referred from 901 in src/java/util/concurrent/locks/StampedLock.java.">writeLockInterruptibly</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L411" name="L411"></a> 411         <strong class="reserved">long</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L412" name="L412"></a> 412         <strong class="reserved">if</strong> (!<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>() &amp;&amp;
<a id="L413" name="L413"></a> 413             (<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L1036" title="Defined at 1036 in src/java/util/concurrent/locks/StampedLock.java.">acquireWrite</a>(<strong class="reserved">true</strong>, 0L)) != INTERRUPTED)
<a id="L414" name="L414"></a> 414             <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L415" name="L415"></a> 415         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L416" name="L416"></a> 416     <em class="brace">}</em>
<a id="L417" name="L417"></a> 417 
<div class="comment">
      Non-exclusively acquires the lock, blocking if necessary
      until available.
      @return a stamp that can be used to unlock or convert mode</div>
<a id="L424" name="L424"></a> 424     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/25503.html" title="Multiple referred from 51 places.">readLock</a>() <em class="brace">{</em>
<a id="L425" name="L425"></a> 425         <strong class="reserved">long</strong> s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;  <em class="comment">// bypass acquireRead on common uncontended case</em>
<a id="L426" name="L426"></a> 426         <strong class="reserved">return</strong> ((whead == wtail &amp;&amp; (s &amp; ABITS) &lt; RFULL &amp;&amp;
<a id="L427" name="L427"></a> 427                  U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + RUNIT)) ?
<a id="L428" name="L428"></a> 428                 <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> : <a href="../S/1050.html#L1138" title="Defined at 1138 in src/java/util/concurrent/locks/StampedLock.java.">acquireRead</a>(<strong class="reserved">false</strong>, 0L));
<a id="L429" name="L429"></a> 429     <em class="brace">}</em>
<a id="L430" name="L430"></a> 430 
<div class="comment">
      Non-exclusively acquires the lock if it is immediately available.
      @return a stamp that can be used to unlock or convert mode,
      or zero if the lock is not available</div>
<a id="L437" name="L437"></a> 437     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/29558.html" title="Multiple referred from 3 places.">tryReadLock</a>() <em class="brace">{</em>
<a id="L438" name="L438"></a> 438         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L439" name="L439"></a> 439             <strong class="reserved">long</strong> s, m, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L440" name="L440"></a> 440             <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) == WBIT)
<a id="L441" name="L441"></a> 441                 <strong class="reserved">return</strong> 0L;
<a id="L442" name="L442"></a> 442             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L443" name="L443"></a> 443                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + RUNIT))
<a id="L444" name="L444"></a> 444                     <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L445" name="L445"></a> 445             <em class="brace">}</em>
<a id="L446" name="L446"></a> 446             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L964" title="Defined at 964 in src/java/util/concurrent/locks/StampedLock.java.">tryIncReaderOverflow</a>(s)) != 0L)
<a id="L447" name="L447"></a> 447                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L448" name="L448"></a> 448         <em class="brace">}</em>
<a id="L449" name="L449"></a> 449     <em class="brace">}</em>
<a id="L450" name="L450"></a> 450 
<div class="comment">
      Non-exclusively acquires the lock if it is available within the
      given time and the current thread has not been interrupted.
      Behavior under timeout and interruption matches that specified
      for method {@link Lock#tryLock(long,TimeUnit)}.
      @param time the maximum time to wait for the lock
      @param unit the time unit of the <code>time</code> argument
      @return a stamp that can be used to unlock or convert mode,
      or zero if the lock is not available
      @throws InterruptedException if the current thread is interrupted
      before acquiring the lock</div>
<a id="L464" name="L464"></a> 464     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/29558.html" title="Multiple referred from 3 places.">tryReadLock</a>(<strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L465" name="L465"></a> 465         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L466" name="L466"></a> 466         <strong class="reserved">long</strong> s, m, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>, deadline;
<a id="L467" name="L467"></a> 467         <strong class="reserved">long</strong> nanos = unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);
<a id="L468" name="L468"></a> 468         <strong class="reserved">if</strong> (!<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>()) <em class="brace">{</em>
<a id="L469" name="L469"></a> 469             <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) != WBIT) <em class="brace">{</em>
<a id="L470" name="L470"></a> 470                 <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L471" name="L471"></a> 471                     <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + RUNIT))
<a id="L472" name="L472"></a> 472                         <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L473" name="L473"></a> 473                 <em class="brace">}</em>
<a id="L474" name="L474"></a> 474                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L964" title="Defined at 964 in src/java/util/concurrent/locks/StampedLock.java.">tryIncReaderOverflow</a>(s)) != 0L)
<a id="L475" name="L475"></a> 475                     <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L476" name="L476"></a> 476             <em class="brace">}</em>
<a id="L477" name="L477"></a> 477             <strong class="reserved">if</strong> (nanos &lt;= 0L)
<a id="L478" name="L478"></a> 478                 <strong class="reserved">return</strong> 0L;
<a id="L479" name="L479"></a> 479             <strong class="reserved">if</strong> ((deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanos) == 0L)
<a id="L480" name="L480"></a> 480                 deadline = 1L;
<a id="L481" name="L481"></a> 481             <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L1138" title="Defined at 1138 in src/java/util/concurrent/locks/StampedLock.java.">acquireRead</a>(<strong class="reserved">true</strong>, deadline)) != INTERRUPTED)
<a id="L482" name="L482"></a> 482                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L483" name="L483"></a> 483         <em class="brace">}</em>
<a id="L484" name="L484"></a> 484         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L485" name="L485"></a> 485     <em class="brace">}</em>
<a id="L486" name="L486"></a> 486 
<div class="comment">
      Non-exclusively acquires the lock, blocking if necessary
      until available or the current thread is interrupted.
      Behavior under interruption matches that specified
      for method {@link Lock#lockInterruptibly()}.
      @return a stamp that can be used to unlock or convert mode
      @throws InterruptedException if the current thread is interrupted
      before acquiring the lock</div>
<a id="L497" name="L497"></a> 497     <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../S/1050.html#L885" title="Referred from 885 in src/java/util/concurrent/locks/StampedLock.java.">readLockInterruptibly</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L498" name="L498"></a> 498         <strong class="reserved">long</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L499" name="L499"></a> 499         <strong class="reserved">if</strong> (!<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>() &amp;&amp;
<a id="L500" name="L500"></a> 500             (<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L1138" title="Defined at 1138 in src/java/util/concurrent/locks/StampedLock.java.">acquireRead</a>(<strong class="reserved">true</strong>, 0L)) != INTERRUPTED)
<a id="L501" name="L501"></a> 501             <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L502" name="L502"></a> 502         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L503" name="L503"></a> 503     <em class="brace">}</em>
<a id="L504" name="L504"></a> 504 
<div class="comment">
      Returns a stamp that can later be validated, or zero
      if exclusively locked.
      @return a stamp, or zero if exclusively locked</div>
<a id="L511" name="L511"></a> 511     <strong class="reserved">public</strong> <strong class="reserved">long</strong> tryOptimisticRead() <em class="brace">{</em>
<a id="L512" name="L512"></a> 512         <strong class="reserved">long</strong> s;
<a id="L513" name="L513"></a> 513         <strong class="reserved">return</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; WBIT) == 0L) ? (s &amp; SBITS) : 0L;
<a id="L514" name="L514"></a> 514     <em class="brace">}</em>
<a id="L515" name="L515"></a> 515 
<div class="comment">
      Returns true if the lock has not been exclusively acquired
      since issuance of the given stamp. Always returns false if the
      stamp is zero. Always returns true if the stamp represents a
      currently held lock. Invoking this method with a value not
      obtained from {@link #tryOptimisticRead} or a locking method
      for this lock has no defined effect or result.
      @param stamp a stamp
      @return <code>true</code> if the lock has not been exclusively acquired
      since issuance of the given stamp; else false</div>
<a id="L528" name="L528"></a> 528     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/30051.html" title="Multiple referred from 135 places.">validate</a>(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L529" name="L529"></a> 529         U.loadFence();
<a id="L530" name="L530"></a> 530         <strong class="reserved">return</strong> (stamp &amp; SBITS) == (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> &amp; SBITS);
<a id="L531" name="L531"></a> 531     <em class="brace">}</em>
<a id="L532" name="L532"></a> 532 
<div class="comment">
      If the lock state matches the given stamp, releases the
      exclusive lock.
      @param stamp a stamp returned by a write-lock operation
      @throws IllegalMonitorStateException if the stamp does
      not match the current state of this lock</div>
<a id="L541" name="L541"></a> 541     <strong class="reserved">public</strong> <strong class="reserved">void</strong> unlockWrite(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L542" name="L542"></a> 542         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L543" name="L543"></a> 543         <strong class="reserved">if</strong> (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> != stamp || (stamp &amp; WBIT) == 0L)
<a id="L544" name="L544"></a> 544             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L545" name="L545"></a> 545         <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = (stamp += WBIT) == 0L ? ORIGIN : stamp;
<a id="L546" name="L546"></a> 546         <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L547" name="L547"></a> 547             <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L548" name="L548"></a> 548     <em class="brace">}</em>
<a id="L549" name="L549"></a> 549 
<div class="comment">
      If the lock state matches the given stamp, releases the
      non-exclusive lock.
      @param stamp a stamp returned by a read-lock operation
      @throws IllegalMonitorStateException if the stamp does
      not match the current state of this lock</div>
<a id="L558" name="L558"></a> 558     <strong class="reserved">public</strong> <strong class="reserved">void</strong> unlockRead(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L559" name="L559"></a> 559         <strong class="reserved">long</strong> s, m; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L560" name="L560"></a> 560         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L561" name="L561"></a> 561             <strong class="reserved">if</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; SBITS) != (stamp &amp; SBITS) ||
<a id="L562" name="L562"></a> 562                 (stamp &amp; ABITS) == 0L || (m = s &amp; ABITS) == 0L || m == WBIT)
<a id="L563" name="L563"></a> 563                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L564" name="L564"></a> 564             <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L565" name="L565"></a> 565                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, s - RUNIT)) <em class="brace">{</em>
<a id="L566" name="L566"></a> 566                     <strong class="reserved">if</strong> (m == RUNIT &amp;&amp; (h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L567" name="L567"></a> 567                         <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L568" name="L568"></a> 568                     <strong class="reserved">break</strong>;
<a id="L569" name="L569"></a> 569                 <em class="brace">}</em>
<a id="L570" name="L570"></a> 570             <em class="brace">}</em>
<a id="L571" name="L571"></a> 571             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1050.html#L985" title="Defined at 985 in src/java/util/concurrent/locks/StampedLock.java.">tryDecReaderOverflow</a>(s) != 0L)
<a id="L572" name="L572"></a> 572                 <strong class="reserved">break</strong>;
<a id="L573" name="L573"></a> 573         <em class="brace">}</em>
<a id="L574" name="L574"></a> 574     <em class="brace">}</em>
<a id="L575" name="L575"></a> 575 
<div class="comment">
      If the lock state matches the given stamp, releases the
      corresponding mode of the lock.
      @param stamp a stamp returned by a lock operation
      @throws IllegalMonitorStateException if the stamp does
      not match the current state of this lock</div>
<a id="L584" name="L584"></a> 584     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/29713.html" title="Multiple referred from 276 places.">unlock</a>(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L585" name="L585"></a> 585         <strong class="reserved">long</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = stamp &amp; ABITS, m, s; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L586" name="L586"></a> 586         <strong class="reserved">while</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; SBITS) == (stamp &amp; SBITS)) <em class="brace">{</em>
<a id="L587" name="L587"></a> 587             <strong class="reserved">if</strong> ((m = s &amp; ABITS) == 0L)
<a id="L588" name="L588"></a> 588                 <strong class="reserved">break</strong>;
<a id="L589" name="L589"></a> 589             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m == WBIT) <em class="brace">{</em>
<a id="L590" name="L590"></a> 590                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != m)
<a id="L591" name="L591"></a> 591                     <strong class="reserved">break</strong>;
<a id="L592" name="L592"></a> 592                 <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = (s += WBIT) == 0L ? ORIGIN : s;
<a id="L593" name="L593"></a> 593                 <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L594" name="L594"></a> 594                     <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L595" name="L595"></a> 595                 <strong class="reserved">return</strong>;
<a id="L596" name="L596"></a> 596             <em class="brace">}</em>
<a id="L597" name="L597"></a> 597             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> == 0L || <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &gt;= WBIT)
<a id="L598" name="L598"></a> 598                 <strong class="reserved">break</strong>;
<a id="L599" name="L599"></a> 599             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L600" name="L600"></a> 600                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, s - RUNIT)) <em class="brace">{</em>
<a id="L601" name="L601"></a> 601                     <strong class="reserved">if</strong> (m == RUNIT &amp;&amp; (h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L602" name="L602"></a> 602                         <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L603" name="L603"></a> 603                     <strong class="reserved">return</strong>;
<a id="L604" name="L604"></a> 604                 <em class="brace">}</em>
<a id="L605" name="L605"></a> 605             <em class="brace">}</em>
<a id="L606" name="L606"></a> 606             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1050.html#L985" title="Defined at 985 in src/java/util/concurrent/locks/StampedLock.java.">tryDecReaderOverflow</a>(s) != 0L)
<a id="L607" name="L607"></a> 607                 <strong class="reserved">return</strong>;
<a id="L608" name="L608"></a> 608         <em class="brace">}</em>
<a id="L609" name="L609"></a> 609         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L610" name="L610"></a> 610     <em class="brace">}</em>
<a id="L611" name="L611"></a> 611 
<div class="comment">
      If the lock state matches the given stamp, performs one of
      the following actions. If the stamp represents holding a write
      lock, returns it.  Or, if a read lock, if the write lock is
      available, releases the read lock and returns a write stamp.
      Or, if an optimistic read, returns a write stamp only if
      immediately available. This method returns zero in all other
      cases.
      @param stamp a stamp
      @return a valid write stamp, or zero on failure</div>
<a id="L624" name="L624"></a> 624     <strong class="reserved">public</strong> <strong class="reserved">long</strong> tryConvertToWriteLock(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L625" name="L625"></a> 625         <strong class="reserved">long</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = stamp &amp; ABITS, m, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L626" name="L626"></a> 626         <strong class="reserved">while</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; SBITS) == (stamp &amp; SBITS)) <em class="brace">{</em>
<a id="L627" name="L627"></a> 627             <strong class="reserved">if</strong> ((m = s &amp; ABITS) == 0L) <em class="brace">{</em>
<a id="L628" name="L628"></a> 628                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != 0L)
<a id="L629" name="L629"></a> 629                     <strong class="reserved">break</strong>;
<a id="L630" name="L630"></a> 630                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + WBIT))
<a id="L631" name="L631"></a> 631                     <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L632" name="L632"></a> 632             <em class="brace">}</em>
<a id="L633" name="L633"></a> 633             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m == WBIT) <em class="brace">{</em>
<a id="L634" name="L634"></a> 634                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != m)
<a id="L635" name="L635"></a> 635                     <strong class="reserved">break</strong>;
<a id="L636" name="L636"></a> 636                 <strong class="reserved">return</strong> stamp;
<a id="L637" name="L637"></a> 637             <em class="brace">}</em>
<a id="L638" name="L638"></a> 638             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m == RUNIT &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != 0L) <em class="brace">{</em>
<a id="L639" name="L639"></a> 639                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s,
<a id="L640" name="L640"></a> 640                                          <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s - RUNIT + WBIT))
<a id="L641" name="L641"></a> 641                     <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L642" name="L642"></a> 642             <em class="brace">}</em>
<a id="L643" name="L643"></a> 643             <strong class="reserved">else</strong>
<a id="L644" name="L644"></a> 644                 <strong class="reserved">break</strong>;
<a id="L645" name="L645"></a> 645         <em class="brace">}</em>
<a id="L646" name="L646"></a> 646         <strong class="reserved">return</strong> 0L;
<a id="L647" name="L647"></a> 647     <em class="brace">}</em>
<a id="L648" name="L648"></a> 648 
<div class="comment">
      If the lock state matches the given stamp, performs one of
      the following actions. If the stamp represents holding a write
      lock, releases it and obtains a read lock.  Or, if a read lock,
      returns it. Or, if an optimistic read, acquires a read lock and
      returns a read stamp only if immediately available. This method
      returns zero in all other cases.
      @param stamp a stamp
      @return a valid read stamp, or zero on failure</div>
<a id="L660" name="L660"></a> 660     <strong class="reserved">public</strong> <strong class="reserved">long</strong> tryConvertToReadLock(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L661" name="L661"></a> 661         <strong class="reserved">long</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = stamp &amp; ABITS, m, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L662" name="L662"></a> 662         <strong class="reserved">while</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; SBITS) == (stamp &amp; SBITS)) <em class="brace">{</em>
<a id="L663" name="L663"></a> 663             <strong class="reserved">if</strong> ((m = s &amp; ABITS) == 0L) <em class="brace">{</em>
<a id="L664" name="L664"></a> 664                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != 0L)
<a id="L665" name="L665"></a> 665                     <strong class="reserved">break</strong>;
<a id="L666" name="L666"></a> 666                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L667" name="L667"></a> 667                     <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + RUNIT))
<a id="L668" name="L668"></a> 668                         <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L669" name="L669"></a> 669                 <em class="brace">}</em>
<a id="L670" name="L670"></a> 670                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L964" title="Defined at 964 in src/java/util/concurrent/locks/StampedLock.java.">tryIncReaderOverflow</a>(s)) != 0L)
<a id="L671" name="L671"></a> 671                     <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L672" name="L672"></a> 672             <em class="brace">}</em>
<a id="L673" name="L673"></a> 673             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m == WBIT) <em class="brace">{</em>
<a id="L674" name="L674"></a> 674                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != m)
<a id="L675" name="L675"></a> 675                     <strong class="reserved">break</strong>;
<a id="L676" name="L676"></a> 676                 <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s + (WBIT + RUNIT);
<a id="L677" name="L677"></a> 677                 <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L678" name="L678"></a> 678                     <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L679" name="L679"></a> 679                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L680" name="L680"></a> 680             <em class="brace">}</em>
<a id="L681" name="L681"></a> 681             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != 0L &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &lt; WBIT)
<a id="L682" name="L682"></a> 682                 <strong class="reserved">return</strong> stamp;
<a id="L683" name="L683"></a> 683             <strong class="reserved">else</strong>
<a id="L684" name="L684"></a> 684                 <strong class="reserved">break</strong>;
<a id="L685" name="L685"></a> 685         <em class="brace">}</em>
<a id="L686" name="L686"></a> 686         <strong class="reserved">return</strong> 0L;
<a id="L687" name="L687"></a> 687     <em class="brace">}</em>
<a id="L688" name="L688"></a> 688 
<div class="comment">
      If the lock state matches the given stamp then, if the stamp
      represents holding a lock, releases it and returns an
      observation stamp.  Or, if an optimistic read, returns it if
      validated. This method returns zero in all other cases, and so
      may be useful as a form of "tryUnlock".
      @param stamp a stamp
      @return a valid optimistic read stamp, or zero on failure</div>
<a id="L699" name="L699"></a> 699     <strong class="reserved">public</strong> <strong class="reserved">long</strong> tryConvertToOptimisticRead(<strong class="reserved">long</strong> stamp) <em class="brace">{</em>
<a id="L700" name="L700"></a> 700         <strong class="reserved">long</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = stamp &amp; ABITS, m, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L701" name="L701"></a> 701         U.loadFence();
<a id="L702" name="L702"></a> 702         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L703" name="L703"></a> 703             <strong class="reserved">if</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; SBITS) != (stamp &amp; SBITS))
<a id="L704" name="L704"></a> 704                 <strong class="reserved">break</strong>;
<a id="L705" name="L705"></a> 705             <strong class="reserved">if</strong> ((m = s &amp; ABITS) == 0L) <em class="brace">{</em>
<a id="L706" name="L706"></a> 706                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != 0L)
<a id="L707" name="L707"></a> 707                     <strong class="reserved">break</strong>;
<a id="L708" name="L708"></a> 708                 <strong class="reserved">return</strong> s;
<a id="L709" name="L709"></a> 709             <em class="brace">}</em>
<a id="L710" name="L710"></a> 710             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m == WBIT) <em class="brace">{</em>
<a id="L711" name="L711"></a> 711                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != m)
<a id="L712" name="L712"></a> 712                     <strong class="reserved">break</strong>;
<a id="L713" name="L713"></a> 713                 <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = (s += WBIT) == 0L ? ORIGIN : s;
<a id="L714" name="L714"></a> 714                 <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L715" name="L715"></a> 715                     <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L716" name="L716"></a> 716                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L717" name="L717"></a> 717             <em class="brace">}</em>
<a id="L718" name="L718"></a> 718             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> == 0L || <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &gt;= WBIT)
<a id="L719" name="L719"></a> 719                 <strong class="reserved">break</strong>;
<a id="L720" name="L720"></a> 720             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L721" name="L721"></a> 721                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s - RUNIT)) <em class="brace">{</em>
<a id="L722" name="L722"></a> 722                     <strong class="reserved">if</strong> (m == RUNIT &amp;&amp; (h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L723" name="L723"></a> 723                         <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L724" name="L724"></a> 724                     <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> &amp; SBITS;
<a id="L725" name="L725"></a> 725                 <em class="brace">}</em>
<a id="L726" name="L726"></a> 726             <em class="brace">}</em>
<a id="L727" name="L727"></a> 727             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../S/1050.html#L985" title="Defined at 985 in src/java/util/concurrent/locks/StampedLock.java.">tryDecReaderOverflow</a>(s)) != 0L)
<a id="L728" name="L728"></a> 728                 <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> &amp; SBITS;
<a id="L729" name="L729"></a> 729         <em class="brace">}</em>
<a id="L730" name="L730"></a> 730         <strong class="reserved">return</strong> 0L;
<a id="L731" name="L731"></a> 731     <em class="brace">}</em>
<a id="L732" name="L732"></a> 732 
<div class="comment">
      Releases the write lock if it is held, without requiring a
      stamp value. This method may be useful for recovery after
      errors.
      @return <code>true</code> if the lock was held, else false</div>
<a id="L740" name="L740"></a> 740     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> tryUnlockWrite() <em class="brace">{</em>
<a id="L741" name="L741"></a> 741         <strong class="reserved">long</strong> s; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L742" name="L742"></a> 742         <strong class="reserved">if</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; WBIT) != 0L) <em class="brace">{</em>
<a id="L743" name="L743"></a> 743             <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = (s += WBIT) == 0L ? ORIGIN : s;
<a id="L744" name="L744"></a> 744             <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L745" name="L745"></a> 745                 <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L746" name="L746"></a> 746             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L747" name="L747"></a> 747         <em class="brace">}</em>
<a id="L748" name="L748"></a> 748         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L749" name="L749"></a> 749     <em class="brace">}</em>
<a id="L750" name="L750"></a> 750 
<div class="comment">
      Releases one hold of the read lock if it is held, without
      requiring a stamp value. This method may be useful for recovery
      after errors.
      @return <code>true</code> if the read lock was held, else false</div>
<a id="L758" name="L758"></a> 758     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> tryUnlockRead() <em class="brace">{</em>
<a id="L759" name="L759"></a> 759         <strong class="reserved">long</strong> s, m; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L760" name="L760"></a> 760         <strong class="reserved">while</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) != 0L &amp;&amp; m &lt; WBIT) <em class="brace">{</em>
<a id="L761" name="L761"></a> 761             <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L762" name="L762"></a> 762                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, s - RUNIT)) <em class="brace">{</em>
<a id="L763" name="L763"></a> 763                     <strong class="reserved">if</strong> (m == RUNIT &amp;&amp; (h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L764" name="L764"></a> 764                         <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L765" name="L765"></a> 765                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L766" name="L766"></a> 766                 <em class="brace">}</em>
<a id="L767" name="L767"></a> 767             <em class="brace">}</em>
<a id="L768" name="L768"></a> 768             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1050.html#L985" title="Defined at 985 in src/java/util/concurrent/locks/StampedLock.java.">tryDecReaderOverflow</a>(s) != 0L)
<a id="L769" name="L769"></a> 769                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L770" name="L770"></a> 770         <em class="brace">}</em>
<a id="L771" name="L771"></a> 771         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L772" name="L772"></a> 772     <em class="brace">}</em>
<a id="L773" name="L773"></a> 773 
<a id="L774" name="L774"></a> 774     <em class="comment">// status monitoring methods</em>
<a id="L775" name="L775"></a> 775 
<div class="comment">
      Returns combined state-held and overflow read count for given
      state s.</div>
<a id="L780" name="L780"></a> 780     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/18607.html" title="Multiple referred from 5 places.">getReadLockCount</a>(<strong class="reserved">long</strong> s) <em class="brace">{</em>
<a id="L781" name="L781"></a> 781         <strong class="reserved">long</strong> readers;
<a id="L782" name="L782"></a> 782         <strong class="reserved">if</strong> ((readers = s &amp; RBITS) &gt;= RFULL)
<a id="L783" name="L783"></a> 783             readers = RFULL + readerOverflow;
<a id="L784" name="L784"></a> 784         <strong class="reserved">return</strong> (<strong class="reserved">int</strong>) readers;
<a id="L785" name="L785"></a> 785     <em class="brace">}</em>
<a id="L786" name="L786"></a> 786 
<div class="comment">
      Returns <code>true</code> if the lock is currently held exclusively.
      @return <code>true</code> if the lock is currently held exclusively</div>
<a id="L792" name="L792"></a> 792     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L1271" title="Referred from 1271 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">isWriteLocked</a>() <em class="brace">{</em>
<a id="L793" name="L793"></a> 793         <strong class="reserved">return</strong> (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> &amp; WBIT) != 0L;
<a id="L794" name="L794"></a> 794     <em class="brace">}</em>
<a id="L795" name="L795"></a> 795 
<div class="comment">
      Returns <code>true</code> if the lock is currently held non-exclusively.
      @return <code>true</code> if the lock is currently held non-exclusively</div>
<a id="L801" name="L801"></a> 801     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> isReadLocked() <em class="brace">{</em>
<a id="L802" name="L802"></a> 802         <strong class="reserved">return</strong> (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> &amp; RBITS) != 0L;
<a id="L803" name="L803"></a> 803     <em class="brace">}</em>
<a id="L804" name="L804"></a> 804 
<div class="comment">
      Queries the number of read locks held for this lock. This
      method is designed for use in monitoring system state, not for
      synchronization control.
      @return the number of read locks held</div>
<a id="L811" name="L811"></a> 811     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/18607.html" title="Multiple referred from 5 places.">getReadLockCount</a>() <em class="brace">{</em>
<a id="L812" name="L812"></a> 812         <strong class="reserved">return</strong> <a href="../D/21870.html" title="Multiple defined in 4 places.">getReadLockCount</a>(<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>);
<a id="L813" name="L813"></a> 813     <em class="brace">}</em>
<a id="L814" name="L814"></a> 814 
<div class="comment">
      Returns a string identifying this lock, as well as its lock
      state.  The state, in brackets, includes the String {@code
      "Unlocked"} or the String <code>"Write-locked"</code> or the String
      <code>"Read-locks:"</code> followed by the current number of
      read-locks held.
      @return a string identifying this lock, as well as its lock state</div>
<a id="L824" name="L824"></a> 824     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L825" name="L825"></a> 825         <strong class="reserved">long</strong> s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>;
<a id="L826" name="L826"></a> 826         <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L827" name="L827"></a> 827             ((s &amp; ABITS) == 0L ? "[Unlocked]" :
<a id="L828" name="L828"></a> 828              (s &amp; WBIT) != 0L ? "[Write-locked]" :
<a id="L829" name="L829"></a> 829              "[Read-locks:" + <a href="../D/21870.html" title="Multiple defined in 4 places.">getReadLockCount</a>(s) + "]");
<a id="L830" name="L830"></a> 830     <em class="brace">}</em>
<a id="L831" name="L831"></a> 831 
<a id="L832" name="L832"></a> 832     <em class="comment">// views</em>
<a id="L833" name="L833"></a> 833 
<div class="comment">
      Returns a plain {@link Lock} view of this StampedLock in which
      the {@link Lock#lock} method is mapped to {@link #readLock},
      and similarly for other methods. The returned Lock does not
      support a {@link Condition}; method {@link
      Lock#newCondition()} throws {@code
      UnsupportedOperationException}.
      @return the lock</div>
<a id="L844" name="L844"></a> 844     <strong class="reserved">public</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> <a href="../S/1050.html#L915" title="Referred from 915 in src/java/util/concurrent/locks/StampedLock.java.">asReadLock</a>() <em class="brace">{</em>
<a id="L845" name="L845"></a> 845         <a href="../S/1050.html#L882" title="Defined at 882 in src/java/util/concurrent/locks/StampedLock.java.">ReadLockView</a> v;
<a id="L846" name="L846"></a> 846         <strong class="reserved">return</strong> ((v = readLockView) != <strong class="reserved">null</strong> ? v :
<a id="L847" name="L847"></a> 847                 (readLockView = <strong class="reserved">new</strong> <a href="../S/1050.html#L882" title="Defined at 882 in src/java/util/concurrent/locks/StampedLock.java.">ReadLockView</a>()));
<a id="L848" name="L848"></a> 848     <em class="brace">}</em>
<a id="L849" name="L849"></a> 849 
<div class="comment">
      Returns a plain {@link Lock} view of this StampedLock in which
      the {@link Lock#lock} method is mapped to {@link #writeLock},
      and similarly for other methods. The returned Lock does not
      support a {@link Condition}; method {@link
      Lock#newCondition()} throws {@code
      UnsupportedOperationException}.
      @return the lock</div>
<a id="L860" name="L860"></a> 860     <strong class="reserved">public</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> <a href="../S/1050.html#L916" title="Referred from 916 in src/java/util/concurrent/locks/StampedLock.java.">asWriteLock</a>() <em class="brace">{</em>
<a id="L861" name="L861"></a> 861         <a href="../S/1050.html#L898" title="Defined at 898 in src/java/util/concurrent/locks/StampedLock.java.">WriteLockView</a> v;
<a id="L862" name="L862"></a> 862         <strong class="reserved">return</strong> ((v = writeLockView) != <strong class="reserved">null</strong> ? v :
<a id="L863" name="L863"></a> 863                 (writeLockView = <strong class="reserved">new</strong> <a href="../S/1050.html#L898" title="Defined at 898 in src/java/util/concurrent/locks/StampedLock.java.">WriteLockView</a>()));
<a id="L864" name="L864"></a> 864     <em class="brace">}</em>
<a id="L865" name="L865"></a> 865 
<div class="comment">
      Returns a {@link ReadWriteLock} view of this StampedLock in
      which the {@link ReadWriteLock#readLock()} method is mapped to
      {@link #asReadLock()}, and {@link ReadWriteLock#writeLock()} to
      {@link #asWriteLock()}.
      @return the lock</div>
<a id="L874" name="L874"></a> 874     <strong class="reserved">public</strong> <a href="../S/1042.html#L119" title="Defined at 119 in src/java/util/concurrent/locks/ReadWriteLock.java.">ReadWriteLock</a> asReadWriteLock() <em class="brace">{</em>
<a id="L875" name="L875"></a> 875         <a href="../S/1050.html#L914" title="Defined at 914 in src/java/util/concurrent/locks/StampedLock.java.">ReadWriteLockView</a> v;
<a id="L876" name="L876"></a> 876         <strong class="reserved">return</strong> ((v = readWriteLockView) != <strong class="reserved">null</strong> ? v :
<a id="L877" name="L877"></a> 877                 (readWriteLockView = <strong class="reserved">new</strong> <a href="../S/1050.html#L914" title="Defined at 914 in src/java/util/concurrent/locks/StampedLock.java.">ReadWriteLockView</a>()));
<a id="L878" name="L878"></a> 878     <em class="brace">}</em>
<a id="L879" name="L879"></a> 879 
<a id="L880" name="L880"></a> 880     <em class="comment">// view classes</em>
<a id="L881" name="L881"></a> 881 
<a id="L882" name="L882"></a> 882     <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/6486.html" title="Multiple referred from 3 places.">ReadLockView</a> <strong class="reserved">implements</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> <em class="brace">{</em>
<a id="L883" name="L883"></a> 883         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22669.html" title="Multiple referred from 810 places.">lock</a>() <em class="brace">{</em> <a href="../D/30215.html" title="Multiple defined in 5 places.">readLock</a>(); <em class="brace">}</em>
<a id="L884" name="L884"></a> 884         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22670.html" title="Multiple referred from 18 places.">lockInterruptibly</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L885" name="L885"></a> 885             <a href="../S/1050.html#L497" title="Defined at 497 in src/java/util/concurrent/locks/StampedLock.java.">readLockInterruptibly</a>();
<a id="L886" name="L886"></a> 886         <em class="brace">}</em>
<a id="L887" name="L887"></a> 887         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../D/35733.html" title="Multiple defined in 3 places.">tryReadLock</a>() != 0L; <em class="brace">}</em>
<a id="L888" name="L888"></a> 888         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>(<strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L889" name="L889"></a> 889             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L890" name="L890"></a> 890             <strong class="reserved">return</strong> <a href="../D/35733.html" title="Multiple defined in 3 places.">tryReadLock</a>(<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, unit) != 0L;
<a id="L891" name="L891"></a> 891         <em class="brace">}</em>
<a id="L892" name="L892"></a> 892         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/29713.html" title="Multiple referred from 276 places.">unlock</a>() <em class="brace">{</em> <a href="../S/1050.html#L931" title="Defined at 931 in src/java/util/concurrent/locks/StampedLock.java.">unstampedUnlockRead</a>(); <em class="brace">}</em>
<a id="L893" name="L893"></a> 893         <strong class="reserved">public</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> <a href="../R/23534.html" title="Multiple referred from 15 places.">newCondition</a>() <em class="brace">{</em>
<a id="L894" name="L894"></a> 894             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L895" name="L895"></a> 895         <em class="brace">}</em>
<a id="L896" name="L896"></a> 896     <em class="brace">}</em>
<a id="L897" name="L897"></a> 897 
<a id="L898" name="L898"></a> 898     <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/8887.html" title="Multiple referred from 3 places.">WriteLockView</a> <strong class="reserved">implements</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> <em class="brace">{</em>
<a id="L899" name="L899"></a> 899         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22669.html" title="Multiple referred from 810 places.">lock</a>() <em class="brace">{</em> <a href="../D/37100.html" title="Multiple defined in 7 places.">writeLock</a>(); <em class="brace">}</em>
<a id="L900" name="L900"></a> 900         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/22670.html" title="Multiple referred from 18 places.">lockInterruptibly</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L901" name="L901"></a> 901             <a href="../S/1050.html#L410" title="Defined at 410 in src/java/util/concurrent/locks/StampedLock.java.">writeLockInterruptibly</a>();
<a id="L902" name="L902"></a> 902         <em class="brace">}</em>
<a id="L903" name="L903"></a> 903         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../D/35746.html" title="Multiple defined in 3 places.">tryWriteLock</a>() != 0L; <em class="brace">}</em>
<a id="L904" name="L904"></a> 904         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29552.html" title="Multiple referred from 5 places.">tryLock</a>(<strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L905" name="L905"></a> 905             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L906" name="L906"></a> 906             <strong class="reserved">return</strong> <a href="../D/35746.html" title="Multiple defined in 3 places.">tryWriteLock</a>(<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, unit) != 0L;
<a id="L907" name="L907"></a> 907         <em class="brace">}</em>
<a id="L908" name="L908"></a> 908         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/29713.html" title="Multiple referred from 276 places.">unlock</a>() <em class="brace">{</em> <a href="../S/1050.html#L922" title="Defined at 922 in src/java/util/concurrent/locks/StampedLock.java.">unstampedUnlockWrite</a>(); <em class="brace">}</em>
<a id="L909" name="L909"></a> 909         <strong class="reserved">public</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> <a href="../R/23534.html" title="Multiple referred from 15 places.">newCondition</a>() <em class="brace">{</em>
<a id="L910" name="L910"></a> 910             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L911" name="L911"></a> 911         <em class="brace">}</em>
<a id="L912" name="L912"></a> 912     <em class="brace">}</em>
<a id="L913" name="L913"></a> 913 
<a id="L914" name="L914"></a> 914     <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/6496.html" title="Multiple referred from 3 places.">ReadWriteLockView</a> <strong class="reserved">implements</strong> <a href="../S/1042.html#L119" title="Defined at 119 in src/java/util/concurrent/locks/ReadWriteLock.java.">ReadWriteLock</a> <em class="brace">{</em>
<a id="L915" name="L915"></a> 915         <strong class="reserved">public</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> <a href="../R/25503.html" title="Multiple referred from 51 places.">readLock</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../S/1050.html#L844" title="Defined at 844 in src/java/util/concurrent/locks/StampedLock.java.">asReadLock</a>(); <em class="brace">}</em>
<a id="L916" name="L916"></a> 916         <strong class="reserved">public</strong> <a href="../D/5200.html" title="Multiple defined in 4 places.">Lock</a> <a href="../R/30659.html" title="Multiple referred from 42 places.">writeLock</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../S/1050.html#L860" title="Defined at 860 in src/java/util/concurrent/locks/StampedLock.java.">asWriteLock</a>(); <em class="brace">}</em>
<a id="L917" name="L917"></a> 917     <em class="brace">}</em>
<a id="L918" name="L918"></a> 918 
<a id="L919" name="L919"></a> 919     <em class="comment">// Unlock methods without stamp argument checks for view classes.</em>
<a id="L920" name="L920"></a> 920     <em class="comment">// Needed because view-class lock methods throw away stamps.</em>
<a id="L921" name="L921"></a> 921 
<a id="L922" name="L922"></a> 922     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../S/1050.html#L908" title="Referred from 908 in src/java/util/concurrent/locks/StampedLock.java.">unstampedUnlockWrite</a>() <em class="brace">{</em>
<a id="L923" name="L923"></a> 923         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h; <strong class="reserved">long</strong> s;
<a id="L924" name="L924"></a> 924         <strong class="reserved">if</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; WBIT) == 0L)
<a id="L925" name="L925"></a> 925             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L926" name="L926"></a> 926         <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = (s += WBIT) == 0L ? ORIGIN : s;
<a id="L927" name="L927"></a> 927         <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L928" name="L928"></a> 928             <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L929" name="L929"></a> 929     <em class="brace">}</em>
<a id="L930" name="L930"></a> 930 
<a id="L931" name="L931"></a> 931     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../S/1050.html#L892" title="Referred from 892 in src/java/util/concurrent/locks/StampedLock.java.">unstampedUnlockRead</a>() <em class="brace">{</em>
<a id="L932" name="L932"></a> 932         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L933" name="L933"></a> 933             <strong class="reserved">long</strong> s, m; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L934" name="L934"></a> 934             <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) == 0L || m &gt;= WBIT)
<a id="L935" name="L935"></a> 935                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L936" name="L936"></a> 936             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &lt; RFULL) <em class="brace">{</em>
<a id="L937" name="L937"></a> 937                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, s - RUNIT)) <em class="brace">{</em>
<a id="L938" name="L938"></a> 938                     <strong class="reserved">if</strong> (m == RUNIT &amp;&amp; (h = whead) != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != 0)
<a id="L939" name="L939"></a> 939                         <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L940" name="L940"></a> 940                     <strong class="reserved">break</strong>;
<a id="L941" name="L941"></a> 941                 <em class="brace">}</em>
<a id="L942" name="L942"></a> 942             <em class="brace">}</em>
<a id="L943" name="L943"></a> 943             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1050.html#L985" title="Defined at 985 in src/java/util/concurrent/locks/StampedLock.java.">tryDecReaderOverflow</a>(s) != 0L)
<a id="L944" name="L944"></a> 944                 <strong class="reserved">break</strong>;
<a id="L945" name="L945"></a> 945         <em class="brace">}</em>
<a id="L946" name="L946"></a> 946     <em class="brace">}</em>
<a id="L947" name="L947"></a> 947 
<a id="L948" name="L948"></a> 948     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25518.html" title="Multiple referred from 189 places.">readObject</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1378.html#L206" title="Defined at 206 in src/java/io/ObjectInputStream.java.">ObjectInputStream</a> s)
<a id="L949" name="L949"></a> 949         <strong class="reserved">throws</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/1705.html#L53" title="Defined at 53 in src/java/lang/ClassNotFoundException.java.">ClassNotFoundException</a> <em class="brace">{</em>
<a id="L950" name="L950"></a> 950         s.<a href="../D/14746.html" title="Multiple defined in 2 places.">defaultReadObject</a>();
<a id="L951" name="L951"></a> 951         <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = ORIGIN; <em class="comment">// reset to unlocked state</em>
<a id="L952" name="L952"></a> 952     <em class="brace">}</em>
<a id="L953" name="L953"></a> 953 
<a id="L954" name="L954"></a> 954     <em class="comment">// internals</em>
<a id="L955" name="L955"></a> 955 
<div class="comment">
      Tries to increment readerOverflow by first setting state
      access bits value to RBITS, indicating hold of spinlock,
      then updating, then releasing.
      @param s a reader overflow stamp: (s &amp; ABITS) &gt;= RFULL
      @return new stamp on success, else zero</div>
<a id="L964" name="L964"></a> 964     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../R/29550.html" title="Multiple referred from 6 places.">tryIncReaderOverflow</a>(<strong class="reserved">long</strong> s) <em class="brace">{</em>
<a id="L965" name="L965"></a> 965         <em class="comment">// assert (s &amp; ABITS) &gt;= RFULL;</em>
<a id="L966" name="L966"></a> 966         <strong class="reserved">if</strong> ((s &amp; ABITS) == RFULL) <em class="brace">{</em>
<a id="L967" name="L967"></a> 967             <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, s | RBITS)) <em class="brace">{</em>
<a id="L968" name="L968"></a> 968                 ++readerOverflow;
<a id="L969" name="L969"></a> 969                 <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = s;
<a id="L970" name="L970"></a> 970                 <strong class="reserved">return</strong> s;
<a id="L971" name="L971"></a> 971             <em class="brace">}</em>
<a id="L972" name="L972"></a> 972         <em class="brace">}</em>
<a id="L973" name="L973"></a> 973         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>() &amp;
<a id="L974" name="L974"></a> 974                   OVERFLOW_YIELD_RATE) == 0)
<a id="L975" name="L975"></a> 975             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>();
<a id="L976" name="L976"></a> 976         <strong class="reserved">return</strong> 0L;
<a id="L977" name="L977"></a> 977     <em class="brace">}</em>
<a id="L978" name="L978"></a> 978 
<div class="comment">
      Tries to decrement readerOverflow.
      @param s a reader overflow stamp: (s &amp; ABITS) &gt;= RFULL
      @return new stamp on success, else zero</div>
<a id="L985" name="L985"></a> 985     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../R/29546.html" title="Multiple referred from 5 places.">tryDecReaderOverflow</a>(<strong class="reserved">long</strong> s) <em class="brace">{</em>
<a id="L986" name="L986"></a> 986         <em class="comment">// assert (s &amp; ABITS) &gt;= RFULL;</em>
<a id="L987" name="L987"></a> 987         <strong class="reserved">if</strong> ((s &amp; ABITS) == RFULL) <em class="brace">{</em>
<a id="L988" name="L988"></a> 988             <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, s | RBITS)) <em class="brace">{</em>
<a id="L989" name="L989"></a> 989                 <strong class="reserved">int</strong> r; <strong class="reserved">long</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L990" name="L990"></a> 990                 <strong class="reserved">if</strong> ((r = readerOverflow) &gt; 0) <em class="brace">{</em>
<a id="L991" name="L991"></a> 991                     readerOverflow = r - 1;
<a id="L992" name="L992"></a> 992                     <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s;
<a id="L993" name="L993"></a> 993                 <em class="brace">}</em>
<a id="L994" name="L994"></a> 994                 <strong class="reserved">else</strong>
<a id="L995" name="L995"></a> 995                     <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = s - RUNIT;
<a id="L996" name="L996"></a> 996                  <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L997" name="L997"></a> 997                  <strong class="reserved">return</strong> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L998" name="L998"></a> 998             <em class="brace">}</em>
<a id="L999" name="L999"></a> 999         <em class="brace">}</em>
<a id="L1000" name="L1000"></a>1000         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>() &amp;
<a id="L1001" name="L1001"></a>1001                   OVERFLOW_YIELD_RATE) == 0)
<a id="L1002" name="L1002"></a>1002             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>();
<a id="L1003" name="L1003"></a>1003         <strong class="reserved">return</strong> 0L;
<a id="L1004" name="L1004"></a>1004     <em class="brace">}</em>
<a id="L1005" name="L1005"></a>1005 
<div class="comment">
      Wakes up the successor of h (normally whead). This is normally
      just h.next, but may require traversal from wtail if next
      pointers are lagging. This may fail to wake up an acquiring
      thread when one or more have been cancelled, but the cancel
      methods themselves provide extra safeguards to ensure liveness.</div>
<a id="L1013" name="L1013"></a>1013     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25846.html" title="Multiple referred from 40 places.">release</a>(<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h) <em class="brace">{</em>
<a id="L1014" name="L1014"></a>1014         <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1015" name="L1015"></a>1015             <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> q; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w;
<a id="L1016" name="L1016"></a>1016             U.compareAndSwapInt(h, WSTATUS, WAITING, 0);
<a id="L1017" name="L1017"></a>1017             <strong class="reserved">if</strong> ((q = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong> || q.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> == CANCELLED) <em class="brace">{</em>
<a id="L1018" name="L1018"></a>1018                 <strong class="reserved">for</strong> (<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> t = wtail; t != <strong class="reserved">null</strong> &amp;&amp; t != h; t = t.prev)
<a id="L1019" name="L1019"></a>1019                     <strong class="reserved">if</strong> (t.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt;= 0)
<a id="L1020" name="L1020"></a>1020                         q = t;
<a id="L1021" name="L1021"></a>1021             <em class="brace">}</em>
<a id="L1022" name="L1022"></a>1022             <strong class="reserved">if</strong> (q != <strong class="reserved">null</strong> &amp;&amp; (w = q.thread) != <strong class="reserved">null</strong>)
<a id="L1023" name="L1023"></a>1023                 U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);
<a id="L1024" name="L1024"></a>1024         <em class="brace">}</em>
<a id="L1025" name="L1025"></a>1025     <em class="brace">}</em>
<a id="L1026" name="L1026"></a>1026 
<div class="comment">
      See above for explanation.
      @param interruptible true if should check interrupts and if so
      return INTERRUPTED
      @param deadline if nonzero, the System.nanoTime value to timeout
      at (and return zero)
      @return next state, or INTERRUPTED</div>
<a id="L1036" name="L1036"></a>1036     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../R/9556.html" title="Multiple referred from 3 places.">acquireWrite</a>(<strong class="reserved">boolean</strong> interruptible, <strong class="reserved">long</strong> deadline) <em class="brace">{</em>
<a id="L1037" name="L1037"></a>1037         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">null</strong>, p;
<a id="L1038" name="L1038"></a>1038         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> spins = -1;;) <em class="brace">{</em> <em class="comment">// spin while enqueuing</em>
<a id="L1039" name="L1039"></a>1039             <strong class="reserved">long</strong> m, s, ns;
<a id="L1040" name="L1040"></a>1040             <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) == 0L) <em class="brace">{</em>
<a id="L1041" name="L1041"></a>1041                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, ns = s + WBIT))
<a id="L1042" name="L1042"></a>1042                     <strong class="reserved">return</strong> ns;
<a id="L1043" name="L1043"></a>1043             <em class="brace">}</em>
<a id="L1044" name="L1044"></a>1044             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &lt; 0)
<a id="L1045" name="L1045"></a>1045                 spins = (m == WBIT &amp;&amp; wtail == whead) ? SPINS : 0;
<a id="L1046" name="L1046"></a>1046             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &gt; 0) <em class="brace">{</em>
<a id="L1047" name="L1047"></a>1047                 <strong class="reserved">if</strong> (<a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>() &gt;= 0)
<a id="L1048" name="L1048"></a>1048                     --spins;
<a id="L1049" name="L1049"></a>1049             <em class="brace">}</em>
<a id="L1050" name="L1050"></a>1050             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((p = wtail) == <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// initialize queue</em>
<a id="L1051" name="L1051"></a>1051                 <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> hd = <strong class="reserved">new</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a>(WMODE, <strong class="reserved">null</strong>);
<a id="L1052" name="L1052"></a>1052                 <strong class="reserved">if</strong> (U.compareAndSwapObject(<strong class="reserved">this</strong>, WHEAD, <strong class="reserved">null</strong>, hd))
<a id="L1053" name="L1053"></a>1053                     wtail = hd;
<a id="L1054" name="L1054"></a>1054             <em class="brace">}</em>
<a id="L1055" name="L1055"></a>1055             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == <strong class="reserved">null</strong>)
<a id="L1056" name="L1056"></a>1056                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">new</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a>(WMODE, p);
<a id="L1057" name="L1057"></a>1057             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev != p)
<a id="L1058" name="L1058"></a>1058                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = p;
<a id="L1059" name="L1059"></a>1059             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (U.compareAndSwapObject(<strong class="reserved">this</strong>, WTAIL, p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1060" name="L1060"></a>1060                 p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1061" name="L1061"></a>1061                 <strong class="reserved">break</strong>;
<a id="L1062" name="L1062"></a>1062             <em class="brace">}</em>
<a id="L1063" name="L1063"></a>1063         <em class="brace">}</em>
<a id="L1064" name="L1064"></a>1064 
<a id="L1065" name="L1065"></a>1065         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> spins = -1;;) <em class="brace">{</em>
<a id="L1066" name="L1066"></a>1066             <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h, np, pp; <strong class="reserved">int</strong> ps;
<a id="L1067" name="L1067"></a>1067             <strong class="reserved">if</strong> ((h = whead) == p) <em class="brace">{</em>
<a id="L1068" name="L1068"></a>1068                 <strong class="reserved">if</strong> (spins &lt; 0)
<a id="L1069" name="L1069"></a>1069                     spins = HEAD_SPINS;
<a id="L1070" name="L1070"></a>1070                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &lt; MAX_HEAD_SPINS)
<a id="L1071" name="L1071"></a>1071                     spins &lt;&lt;= 1;
<a id="L1072" name="L1072"></a>1072                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = spins;;) <em class="brace">{</em> <em class="comment">// spin at head</em>
<a id="L1073" name="L1073"></a>1073                     <strong class="reserved">long</strong> s, ns;
<a id="L1074" name="L1074"></a>1074                     <strong class="reserved">if</strong> (((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) == 0L) <em class="brace">{</em>
<a id="L1075" name="L1075"></a>1075                         <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s,
<a id="L1076" name="L1076"></a>1076                                                  ns = s + WBIT)) <em class="brace">{</em>
<a id="L1077" name="L1077"></a>1077                             whead = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1078" name="L1078"></a>1078                             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <strong class="reserved">null</strong>;
<a id="L1079" name="L1079"></a>1079                             <strong class="reserved">return</strong> ns;
<a id="L1080" name="L1080"></a>1080                         <em class="brace">}</em>
<a id="L1081" name="L1081"></a>1081                     <em class="brace">}</em>
<a id="L1082" name="L1082"></a>1082                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>() &gt;= 0 &amp;&amp;
<a id="L1083" name="L1083"></a>1083                              --k &lt;= 0)
<a id="L1084" name="L1084"></a>1084                         <strong class="reserved">break</strong>;
<a id="L1085" name="L1085"></a>1085                 <em class="brace">}</em>
<a id="L1086" name="L1086"></a>1086             <em class="brace">}</em>
<a id="L1087" name="L1087"></a>1087             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// help release stale waiters</em>
<a id="L1088" name="L1088"></a>1088                 <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w;
<a id="L1089" name="L1089"></a>1089                 <strong class="reserved">while</strong> ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = h.cowait) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1090" name="L1090"></a>1090                     <strong class="reserved">if</strong> (U.compareAndSwapObject(h, WCOWAIT, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.cowait) &amp;&amp;
<a id="L1091" name="L1091"></a>1091                         (w = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.thread) != <strong class="reserved">null</strong>)
<a id="L1092" name="L1092"></a>1092                         U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);
<a id="L1093" name="L1093"></a>1093                 <em class="brace">}</em>
<a id="L1094" name="L1094"></a>1094             <em class="brace">}</em>
<a id="L1095" name="L1095"></a>1095             <strong class="reserved">if</strong> (whead == h) <em class="brace">{</em>
<a id="L1096" name="L1096"></a>1096                 <strong class="reserved">if</strong> ((np = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev) != p) <em class="brace">{</em>
<a id="L1097" name="L1097"></a>1097                     <strong class="reserved">if</strong> (np != <strong class="reserved">null</strong>)
<a id="L1098" name="L1098"></a>1098                         (p = np).<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;   <em class="comment">// stale</em>
<a id="L1099" name="L1099"></a>1099                 <em class="brace">}</em>
<a id="L1100" name="L1100"></a>1100                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((ps = p.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a>) == 0)
<a id="L1101" name="L1101"></a>1101                     U.compareAndSwapInt(p, WSTATUS, 0, WAITING);
<a id="L1102" name="L1102"></a>1102                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ps == CANCELLED) <em class="brace">{</em>
<a id="L1103" name="L1103"></a>1103                     <strong class="reserved">if</strong> ((pp = p.prev) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1104" name="L1104"></a>1104                         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = pp;
<a id="L1105" name="L1105"></a>1105                         pp.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1106" name="L1106"></a>1106                     <em class="brace">}</em>
<a id="L1107" name="L1107"></a>1107                 <em class="brace">}</em>
<a id="L1108" name="L1108"></a>1108                 <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1109" name="L1109"></a>1109                     <strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>; <em class="comment">// 0 argument to park means no timeout</em>
<a id="L1110" name="L1110"></a>1110                     <strong class="reserved">if</strong> (deadline == 0L)
<a id="L1111" name="L1111"></a>1111                         <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> = 0L;
<a id="L1112" name="L1112"></a>1112                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>()) &lt;= 0L)
<a id="L1113" name="L1113"></a>1113                         <strong class="reserved">return</strong> <a href="../S/1050.html#L1312" title="Defined at 1312 in src/java/util/concurrent/locks/StampedLock.java.">cancelWaiter</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">false</strong>);
<a id="L1114" name="L1114"></a>1114                     <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> wt = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L1115" name="L1115"></a>1115                     U.putObject(wt, PARKBLOCKER, <strong class="reserved">this</strong>);
<a id="L1116" name="L1116"></a>1116                     <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = wt;
<a id="L1117" name="L1117"></a>1117                     <strong class="reserved">if</strong> (p.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt; 0 &amp;&amp; (p != h || (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> &amp; ABITS) != 0L) &amp;&amp;
<a id="L1118" name="L1118"></a>1118                         whead == h &amp;&amp; <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev == p)
<a id="L1119" name="L1119"></a>1119                         U.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">false</strong>, <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);  <em class="comment">// emulate LockSupport.park</em>
<a id="L1120" name="L1120"></a>1120                     <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L1121" name="L1121"></a>1121                     U.putObject(wt, PARKBLOCKER, <strong class="reserved">null</strong>);
<a id="L1122" name="L1122"></a>1122                     <strong class="reserved">if</strong> (interruptible &amp;&amp; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1123" name="L1123"></a>1123                         <strong class="reserved">return</strong> <a href="../S/1050.html#L1312" title="Defined at 1312 in src/java/util/concurrent/locks/StampedLock.java.">cancelWaiter</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">true</strong>);
<a id="L1124" name="L1124"></a>1124                 <em class="brace">}</em>
<a id="L1125" name="L1125"></a>1125             <em class="brace">}</em>
<a id="L1126" name="L1126"></a>1126         <em class="brace">}</em>
<a id="L1127" name="L1127"></a>1127     <em class="brace">}</em>
<a id="L1128" name="L1128"></a>1128 
<div class="comment">
      See above for explanation.
      @param interruptible true if should check interrupts and if so
      return INTERRUPTED
      @param deadline if nonzero, the System.nanoTime value to timeout
      at (and return zero)
      @return next state, or INTERRUPTED</div>
<a id="L1138" name="L1138"></a>1138     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../R/9553.html" title="Multiple referred from 3 places.">acquireRead</a>(<strong class="reserved">boolean</strong> interruptible, <strong class="reserved">long</strong> deadline) <em class="brace">{</em>
<a id="L1139" name="L1139"></a>1139         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">null</strong>, p;
<a id="L1140" name="L1140"></a>1140         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> spins = -1;;) <em class="brace">{</em>
<a id="L1141" name="L1141"></a>1141             <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h;
<a id="L1142" name="L1142"></a>1142             <strong class="reserved">if</strong> ((h = whead) == (p = wtail)) <em class="brace">{</em>
<a id="L1143" name="L1143"></a>1143                 <strong class="reserved">for</strong> (<strong class="reserved">long</strong> m, s, ns;;) <em class="brace">{</em>
<a id="L1144" name="L1144"></a>1144                     <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) &lt; RFULL ?
<a id="L1145" name="L1145"></a>1145                         U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, ns = s + RUNIT) :
<a id="L1146" name="L1146"></a>1146                         (m &lt; WBIT &amp;&amp; (ns = <a href="../S/1050.html#L964" title="Defined at 964 in src/java/util/concurrent/locks/StampedLock.java.">tryIncReaderOverflow</a>(s)) != 0L))
<a id="L1147" name="L1147"></a>1147                         <strong class="reserved">return</strong> ns;
<a id="L1148" name="L1148"></a>1148                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &gt;= WBIT) <em class="brace">{</em>
<a id="L1149" name="L1149"></a>1149                         <strong class="reserved">if</strong> (spins &gt; 0) <em class="brace">{</em>
<a id="L1150" name="L1150"></a>1150                             <strong class="reserved">if</strong> (<a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>() &gt;= 0)
<a id="L1151" name="L1151"></a>1151                                 --spins;
<a id="L1152" name="L1152"></a>1152                         <em class="brace">}</em>
<a id="L1153" name="L1153"></a>1153                         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1154" name="L1154"></a>1154                             <strong class="reserved">if</strong> (spins == 0) <em class="brace">{</em>
<a id="L1155" name="L1155"></a>1155                                 <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> nh = whead, np = wtail;
<a id="L1156" name="L1156"></a>1156                                 <strong class="reserved">if</strong> ((nh == h &amp;&amp; np == p) || (h = nh) != (p = np))
<a id="L1157" name="L1157"></a>1157                                     <strong class="reserved">break</strong>;
<a id="L1158" name="L1158"></a>1158                             <em class="brace">}</em>
<a id="L1159" name="L1159"></a>1159                             spins = SPINS;
<a id="L1160" name="L1160"></a>1160                         <em class="brace">}</em>
<a id="L1161" name="L1161"></a>1161                     <em class="brace">}</em>
<a id="L1162" name="L1162"></a>1162                 <em class="brace">}</em>
<a id="L1163" name="L1163"></a>1163             <em class="brace">}</em>
<a id="L1164" name="L1164"></a>1164             <strong class="reserved">if</strong> (p == <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// initialize queue</em>
<a id="L1165" name="L1165"></a>1165                 <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> hd = <strong class="reserved">new</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a>(WMODE, <strong class="reserved">null</strong>);
<a id="L1166" name="L1166"></a>1166                 <strong class="reserved">if</strong> (U.compareAndSwapObject(<strong class="reserved">this</strong>, WHEAD, <strong class="reserved">null</strong>, hd))
<a id="L1167" name="L1167"></a>1167                     wtail = hd;
<a id="L1168" name="L1168"></a>1168             <em class="brace">}</em>
<a id="L1169" name="L1169"></a>1169             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == <strong class="reserved">null</strong>)
<a id="L1170" name="L1170"></a>1170                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">new</strong> <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a>(RMODE, p);
<a id="L1171" name="L1171"></a>1171             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (h == p || p.mode != RMODE) <em class="brace">{</em>
<a id="L1172" name="L1172"></a>1172                 <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev != p)
<a id="L1173" name="L1173"></a>1173                     <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = p;
<a id="L1174" name="L1174"></a>1174                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (U.compareAndSwapObject(<strong class="reserved">this</strong>, WTAIL, p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1175" name="L1175"></a>1175                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1176" name="L1176"></a>1176                     <strong class="reserved">break</strong>;
<a id="L1177" name="L1177"></a>1177                 <em class="brace">}</em>
<a id="L1178" name="L1178"></a>1178             <em class="brace">}</em>
<a id="L1179" name="L1179"></a>1179             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!U.compareAndSwapObject(p, WCOWAIT,
<a id="L1180" name="L1180"></a>1180                                              <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.cowait = p.cowait, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>))
<a id="L1181" name="L1181"></a>1181                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.cowait = <strong class="reserved">null</strong>;
<a id="L1182" name="L1182"></a>1182             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1183" name="L1183"></a>1183                 <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L1184" name="L1184"></a>1184                     <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> pp, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w;
<a id="L1185" name="L1185"></a>1185                     <strong class="reserved">if</strong> ((h = whead) != <strong class="reserved">null</strong> &amp;&amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = h.cowait) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1186" name="L1186"></a>1186                         U.compareAndSwapObject(h, WCOWAIT, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.cowait) &amp;&amp;
<a id="L1187" name="L1187"></a>1187                         (w = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.thread) != <strong class="reserved">null</strong>) <em class="comment">// help release</em>
<a id="L1188" name="L1188"></a>1188                         U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);
<a id="L1189" name="L1189"></a>1189                     <strong class="reserved">if</strong> (h == (pp = p.prev) || h == p || pp == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1190" name="L1190"></a>1190                         <strong class="reserved">long</strong> m, s, ns;
<a id="L1191" name="L1191"></a>1191                         <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1192" name="L1192"></a>1192                             <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) &lt; RFULL ?
<a id="L1193" name="L1193"></a>1193                                 U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s,
<a id="L1194" name="L1194"></a>1194                                                      ns = s + RUNIT) :
<a id="L1195" name="L1195"></a>1195                                 (m &lt; WBIT &amp;&amp;
<a id="L1196" name="L1196"></a>1196                                  (ns = <a href="../S/1050.html#L964" title="Defined at 964 in src/java/util/concurrent/locks/StampedLock.java.">tryIncReaderOverflow</a>(s)) != 0L))
<a id="L1197" name="L1197"></a>1197                                 <strong class="reserved">return</strong> ns;
<a id="L1198" name="L1198"></a>1198                         <em class="brace">}</em> <strong class="reserved">while</strong> (m &lt; WBIT);
<a id="L1199" name="L1199"></a>1199                     <em class="brace">}</em>
<a id="L1200" name="L1200"></a>1200                     <strong class="reserved">if</strong> (whead == h &amp;&amp; p.prev == pp) <em class="brace">{</em>
<a id="L1201" name="L1201"></a>1201                         <strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>;
<a id="L1202" name="L1202"></a>1202                         <strong class="reserved">if</strong> (pp == <strong class="reserved">null</strong> || h == p || p.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &gt; 0) <em class="brace">{</em>
<a id="L1203" name="L1203"></a>1203                             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">null</strong>; <em class="comment">// throw away</em>
<a id="L1204" name="L1204"></a>1204                             <strong class="reserved">break</strong>;
<a id="L1205" name="L1205"></a>1205                         <em class="brace">}</em>
<a id="L1206" name="L1206"></a>1206                         <strong class="reserved">if</strong> (deadline == 0L)
<a id="L1207" name="L1207"></a>1207                             <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> = 0L;
<a id="L1208" name="L1208"></a>1208                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>()) &lt;= 0L)
<a id="L1209" name="L1209"></a>1209                             <strong class="reserved">return</strong> <a href="../S/1050.html#L1312" title="Defined at 1312 in src/java/util/concurrent/locks/StampedLock.java.">cancelWaiter</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, p, <strong class="reserved">false</strong>);
<a id="L1210" name="L1210"></a>1210                         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> wt = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L1211" name="L1211"></a>1211                         U.putObject(wt, PARKBLOCKER, <strong class="reserved">this</strong>);
<a id="L1212" name="L1212"></a>1212                         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = wt;
<a id="L1213" name="L1213"></a>1213                         <strong class="reserved">if</strong> ((h != pp || (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> &amp; ABITS) == WBIT) &amp;&amp;
<a id="L1214" name="L1214"></a>1214                             whead == h &amp;&amp; p.prev == pp)
<a id="L1215" name="L1215"></a>1215                             U.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">false</strong>, <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);
<a id="L1216" name="L1216"></a>1216                         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L1217" name="L1217"></a>1217                         U.putObject(wt, PARKBLOCKER, <strong class="reserved">null</strong>);
<a id="L1218" name="L1218"></a>1218                         <strong class="reserved">if</strong> (interruptible &amp;&amp; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1219" name="L1219"></a>1219                             <strong class="reserved">return</strong> <a href="../S/1050.html#L1312" title="Defined at 1312 in src/java/util/concurrent/locks/StampedLock.java.">cancelWaiter</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, p, <strong class="reserved">true</strong>);
<a id="L1220" name="L1220"></a>1220                     <em class="brace">}</em>
<a id="L1221" name="L1221"></a>1221                 <em class="brace">}</em>
<a id="L1222" name="L1222"></a>1222             <em class="brace">}</em>
<a id="L1223" name="L1223"></a>1223         <em class="brace">}</em>
<a id="L1224" name="L1224"></a>1224 
<a id="L1225" name="L1225"></a>1225         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> spins = -1;;) <em class="brace">{</em>
<a id="L1226" name="L1226"></a>1226             <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h, np, pp; <strong class="reserved">int</strong> ps;
<a id="L1227" name="L1227"></a>1227             <strong class="reserved">if</strong> ((h = whead) == p) <em class="brace">{</em>
<a id="L1228" name="L1228"></a>1228                 <strong class="reserved">if</strong> (spins &lt; 0)
<a id="L1229" name="L1229"></a>1229                     spins = HEAD_SPINS;
<a id="L1230" name="L1230"></a>1230                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &lt; MAX_HEAD_SPINS)
<a id="L1231" name="L1231"></a>1231                     spins &lt;&lt;= 1;
<a id="L1232" name="L1232"></a>1232                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = spins;;) <em class="brace">{</em> <em class="comment">// spin at head</em>
<a id="L1233" name="L1233"></a>1233                     <strong class="reserved">long</strong> m, s, ns;
<a id="L1234" name="L1234"></a>1234                     <strong class="reserved">if</strong> ((m = (s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) &lt; RFULL ?
<a id="L1235" name="L1235"></a>1235                         U.compareAndSwapLong(<strong class="reserved">this</strong>, STATE, s, ns = s + RUNIT) :
<a id="L1236" name="L1236"></a>1236                         (m &lt; WBIT &amp;&amp; (ns = <a href="../S/1050.html#L964" title="Defined at 964 in src/java/util/concurrent/locks/StampedLock.java.">tryIncReaderOverflow</a>(s)) != 0L)) <em class="brace">{</em>
<a id="L1237" name="L1237"></a>1237                         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w;
<a id="L1238" name="L1238"></a>1238                         whead = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1239" name="L1239"></a>1239                         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <strong class="reserved">null</strong>;
<a id="L1240" name="L1240"></a>1240                         <strong class="reserved">while</strong> ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.cowait) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1241" name="L1241"></a>1241                             <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, WCOWAIT,
<a id="L1242" name="L1242"></a>1242                                                        <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.cowait) &amp;&amp;
<a id="L1243" name="L1243"></a>1243                                 (w = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.thread) != <strong class="reserved">null</strong>)
<a id="L1244" name="L1244"></a>1244                                 U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);
<a id="L1245" name="L1245"></a>1245                         <em class="brace">}</em>
<a id="L1246" name="L1246"></a>1246                         <strong class="reserved">return</strong> ns;
<a id="L1247" name="L1247"></a>1247                     <em class="brace">}</em>
<a id="L1248" name="L1248"></a>1248                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (m &gt;= WBIT &amp;&amp;
<a id="L1249" name="L1249"></a>1249                              <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>() &gt;= 0 &amp;&amp; --k &lt;= 0)
<a id="L1250" name="L1250"></a>1250                         <strong class="reserved">break</strong>;
<a id="L1251" name="L1251"></a>1251                 <em class="brace">}</em>
<a id="L1252" name="L1252"></a>1252             <em class="brace">}</em>
<a id="L1253" name="L1253"></a>1253             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1254" name="L1254"></a>1254                 <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w;
<a id="L1255" name="L1255"></a>1255                 <strong class="reserved">while</strong> ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = h.cowait) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1256" name="L1256"></a>1256                     <strong class="reserved">if</strong> (U.compareAndSwapObject(h, WCOWAIT, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.cowait) &amp;&amp;
<a id="L1257" name="L1257"></a>1257                         (w = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.thread) != <strong class="reserved">null</strong>)
<a id="L1258" name="L1258"></a>1258                         U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);
<a id="L1259" name="L1259"></a>1259                 <em class="brace">}</em>
<a id="L1260" name="L1260"></a>1260             <em class="brace">}</em>
<a id="L1261" name="L1261"></a>1261             <strong class="reserved">if</strong> (whead == h) <em class="brace">{</em>
<a id="L1262" name="L1262"></a>1262                 <strong class="reserved">if</strong> ((np = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev) != p) <em class="brace">{</em>
<a id="L1263" name="L1263"></a>1263                     <strong class="reserved">if</strong> (np != <strong class="reserved">null</strong>)
<a id="L1264" name="L1264"></a>1264                         (p = np).<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;   <em class="comment">// stale</em>
<a id="L1265" name="L1265"></a>1265                 <em class="brace">}</em>
<a id="L1266" name="L1266"></a>1266                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((ps = p.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a>) == 0)
<a id="L1267" name="L1267"></a>1267                     U.compareAndSwapInt(p, WSTATUS, 0, WAITING);
<a id="L1268" name="L1268"></a>1268                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ps == CANCELLED) <em class="brace">{</em>
<a id="L1269" name="L1269"></a>1269                     <strong class="reserved">if</strong> ((pp = p.prev) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1270" name="L1270"></a>1270                         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = pp;
<a id="L1271" name="L1271"></a>1271                         pp.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1272" name="L1272"></a>1272                     <em class="brace">}</em>
<a id="L1273" name="L1273"></a>1273                 <em class="brace">}</em>
<a id="L1274" name="L1274"></a>1274                 <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1275" name="L1275"></a>1275                     <strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>;
<a id="L1276" name="L1276"></a>1276                     <strong class="reserved">if</strong> (deadline == 0L)
<a id="L1277" name="L1277"></a>1277                         <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> = 0L;
<a id="L1278" name="L1278"></a>1278                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>()) &lt;= 0L)
<a id="L1279" name="L1279"></a>1279                         <strong class="reserved">return</strong> <a href="../S/1050.html#L1312" title="Defined at 1312 in src/java/util/concurrent/locks/StampedLock.java.">cancelWaiter</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">false</strong>);
<a id="L1280" name="L1280"></a>1280                     <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> wt = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L1281" name="L1281"></a>1281                     U.putObject(wt, PARKBLOCKER, <strong class="reserved">this</strong>);
<a id="L1282" name="L1282"></a>1282                     <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = wt;
<a id="L1283" name="L1283"></a>1283                     <strong class="reserved">if</strong> (p.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt; 0 &amp;&amp;
<a id="L1284" name="L1284"></a>1284                         (p != h || (<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> &amp; ABITS) == WBIT) &amp;&amp;
<a id="L1285" name="L1285"></a>1285                         whead == h &amp;&amp; <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev == p)
<a id="L1286" name="L1286"></a>1286                         U.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">false</strong>, <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);
<a id="L1287" name="L1287"></a>1287                     <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L1288" name="L1288"></a>1288                     U.putObject(wt, PARKBLOCKER, <strong class="reserved">null</strong>);
<a id="L1289" name="L1289"></a>1289                     <strong class="reserved">if</strong> (interruptible &amp;&amp; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1290" name="L1290"></a>1290                         <strong class="reserved">return</strong> <a href="../S/1050.html#L1312" title="Defined at 1312 in src/java/util/concurrent/locks/StampedLock.java.">cancelWaiter</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">true</strong>);
<a id="L1291" name="L1291"></a>1291                 <em class="brace">}</em>
<a id="L1292" name="L1292"></a>1292             <em class="brace">}</em>
<a id="L1293" name="L1293"></a>1293         <em class="brace">}</em>
<a id="L1294" name="L1294"></a>1294     <em class="brace">}</em>
<a id="L1295" name="L1295"></a>1295 
<div class="comment">
      If node non-null, forces cancel status and unsplices it from
      queue if possible and wakes up any cowaiters (of the node, or
      group, as applicable), and in any case helps release current
      first waiter if lock is free. (Calling with null arguments
      serves as a conditional form of release, which is not currently
      needed but may be needed under possible future cancellation
      policies). This is a variant of cancellation methods in
      AbstractQueuedSynchronizer (see its detailed explanation in AQS
      internal documentation).
      @param node if nonnull, the waiter
      @param group either node or the group node is cowaiting with
      @param interrupted if already interrupted
      @return INTERRUPTED if interrupted or Thread.interrupted, else zero</div>
<a id="L1312" name="L1312"></a>1312     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../R/10937.html" title="Multiple referred from 6 places.">cancelWaiter</a>(<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../D/23914.html" title="Multiple defined in 8 places.">group</a>, <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>) <em class="brace">{</em>
<a id="L1313" name="L1313"></a>1313         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/23914.html" title="Multiple defined in 8 places.">group</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1314" name="L1314"></a>1314             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w;
<a id="L1315" name="L1315"></a>1315             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> = CANCELLED;
<a id="L1316" name="L1316"></a>1316             <em class="comment">// unsplice cancelled nodes from group</em>
<a id="L1317" name="L1317"></a>1317             <strong class="reserved">for</strong> (<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> p = <a href="../D/23914.html" title="Multiple defined in 8 places.">group</a>, q; (q = p.cowait) != <strong class="reserved">null</strong>;) <em class="brace">{</em>
<a id="L1318" name="L1318"></a>1318                 <strong class="reserved">if</strong> (q.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> == CANCELLED) <em class="brace">{</em>
<a id="L1319" name="L1319"></a>1319                     U.compareAndSwapObject(p, WCOWAIT, q, q.cowait);
<a id="L1320" name="L1320"></a>1320                     p = <a href="../D/23914.html" title="Multiple defined in 8 places.">group</a>; <em class="comment">// restart</em>
<a id="L1321" name="L1321"></a>1321                 <em class="brace">}</em>
<a id="L1322" name="L1322"></a>1322                 <strong class="reserved">else</strong>
<a id="L1323" name="L1323"></a>1323                     p = q;
<a id="L1324" name="L1324"></a>1324             <em class="brace">}</em>
<a id="L1325" name="L1325"></a>1325             <strong class="reserved">if</strong> (<a href="../D/23914.html" title="Multiple defined in 8 places.">group</a> == <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1326" name="L1326"></a>1326                 <strong class="reserved">for</strong> (<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> r = <a href="../D/23914.html" title="Multiple defined in 8 places.">group</a>.cowait; r != <strong class="reserved">null</strong>; r = r.cowait) <em class="brace">{</em>
<a id="L1327" name="L1327"></a>1327                     <strong class="reserved">if</strong> ((w = r.thread) != <strong class="reserved">null</strong>)
<a id="L1328" name="L1328"></a>1328                         U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);       <em class="comment">// wake up uncancelled co-waiters</em>
<a id="L1329" name="L1329"></a>1329                 <em class="brace">}</em>
<a id="L1330" name="L1330"></a>1330                 <strong class="reserved">for</strong> (<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != <strong class="reserved">null</strong>; ) <em class="brace">{</em> <em class="comment">// unsplice</em>
<a id="L1331" name="L1331"></a>1331                     <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>, pp;        <em class="comment">// find valid successor</em>
<a id="L1332" name="L1332"></a>1332                     <strong class="reserved">while</strong> ((<a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong> ||
<a id="L1333" name="L1333"></a>1333                            <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> == CANCELLED) <em class="brace">{</em>
<a id="L1334" name="L1334"></a>1334                         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> q = <strong class="reserved">null</strong>;    <em class="comment">// find successor the slow way</em>
<a id="L1335" name="L1335"></a>1335                         <strong class="reserved">for</strong> (<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> t = wtail; t != <strong class="reserved">null</strong> &amp;&amp; t != <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>; t = t.prev)
<a id="L1336" name="L1336"></a>1336                             <strong class="reserved">if</strong> (t.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != CANCELLED)
<a id="L1337" name="L1337"></a>1337                                 q = t;     <em class="comment">// don't link if succ cancelled</em>
<a id="L1338" name="L1338"></a>1338                         <strong class="reserved">if</strong> (<a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a> == q ||   <em class="comment">// ensure accurate successor</em>
<a id="L1339" name="L1339"></a>1339                             U.compareAndSwapObject(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, WNEXT,
<a id="L1340" name="L1340"></a>1340                                                    <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>, <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a> = q)) <em class="brace">{</em>
<a id="L1341" name="L1341"></a>1341                             <strong class="reserved">if</strong> (<a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a> == <strong class="reserved">null</strong> &amp;&amp; <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == wtail)
<a id="L1342" name="L1342"></a>1342                                 U.compareAndSwapObject(<strong class="reserved">this</strong>, WTAIL, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>);
<a id="L1343" name="L1343"></a>1343                             <strong class="reserved">break</strong>;
<a id="L1344" name="L1344"></a>1344                         <em class="brace">}</em>
<a id="L1345" name="L1345"></a>1345                     <em class="brace">}</em>
<a id="L1346" name="L1346"></a>1346                     <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> == <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="comment">// unsplice pred link</em>
<a id="L1347" name="L1347"></a>1347                         U.compareAndSwapObject(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, WNEXT, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>);
<a id="L1348" name="L1348"></a>1348                     <strong class="reserved">if</strong> (<a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a> != <strong class="reserved">null</strong> &amp;&amp; (w = <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>.thread) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1349" name="L1349"></a>1349                         <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>.thread = <strong class="reserved">null</strong>;
<a id="L1350" name="L1350"></a>1350                         U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(w);       <em class="comment">// wake up succ to observe new pred</em>
<a id="L1351" name="L1351"></a>1351                     <em class="brace">}</em>
<a id="L1352" name="L1352"></a>1352                     <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> != CANCELLED || (pp = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.prev) == <strong class="reserved">null</strong>)
<a id="L1353" name="L1353"></a>1353                         <strong class="reserved">break</strong>;
<a id="L1354" name="L1354"></a>1354                     <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = pp;        <em class="comment">// repeat if new pred wrong/cancelled</em>
<a id="L1355" name="L1355"></a>1355                     U.compareAndSwapObject(pp, WNEXT, <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>);
<a id="L1356" name="L1356"></a>1356                     <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = pp;
<a id="L1357" name="L1357"></a>1357                 <em class="brace">}</em>
<a id="L1358" name="L1358"></a>1358             <em class="brace">}</em>
<a id="L1359" name="L1359"></a>1359         <em class="brace">}</em>
<a id="L1360" name="L1360"></a>1360         <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> h; <em class="comment">// Possibly release first waiter</em>
<a id="L1361" name="L1361"></a>1361         <strong class="reserved">while</strong> ((h = whead) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1362" name="L1362"></a>1362             <strong class="reserved">long</strong> s; <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> q; <em class="comment">// similar to release() but check eligibility</em>
<a id="L1363" name="L1363"></a>1363             <strong class="reserved">if</strong> ((q = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong> || q.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> == CANCELLED) <em class="brace">{</em>
<a id="L1364" name="L1364"></a>1364                 <strong class="reserved">for</strong> (<a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a> t = wtail; t != <strong class="reserved">null</strong> &amp;&amp; t != h; t = t.prev)
<a id="L1365" name="L1365"></a>1365                     <strong class="reserved">if</strong> (t.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt;= 0)
<a id="L1366" name="L1366"></a>1366                         q = t;
<a id="L1367" name="L1367"></a>1367             <em class="brace">}</em>
<a id="L1368" name="L1368"></a>1368             <strong class="reserved">if</strong> (h == whead) <em class="brace">{</em>
<a id="L1369" name="L1369"></a>1369                 <strong class="reserved">if</strong> (q != <strong class="reserved">null</strong> &amp;&amp; h.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> == 0 &amp;&amp;
<a id="L1370" name="L1370"></a>1370                     ((s = <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>) &amp; ABITS) != WBIT &amp;&amp; <em class="comment">// waiter is eligible</em>
<a id="L1371" name="L1371"></a>1371                     (s == 0L || q.mode == RMODE))
<a id="L1372" name="L1372"></a>1372                     <a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(h);
<a id="L1373" name="L1373"></a>1373                 <strong class="reserved">break</strong>;
<a id="L1374" name="L1374"></a>1374             <em class="brace">}</em>
<a id="L1375" name="L1375"></a>1375         <em class="brace">}</em>
<a id="L1376" name="L1376"></a>1376         <strong class="reserved">return</strong> (<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> || <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>()) ? INTERRUPTED : 0L;
<a id="L1377" name="L1377"></a>1377     <em class="brace">}</em>
<a id="L1378" name="L1378"></a>1378 
<a id="L1379" name="L1379"></a>1379     <em class="comment">// Unsafe mechanics</em>
<a id="L1380" name="L1380"></a>1380     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> sun.misc.Unsafe U;
<a id="L1381" name="L1381"></a>1381     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> STATE;
<a id="L1382" name="L1382"></a>1382     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> WHEAD;
<a id="L1383" name="L1383"></a>1383     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> WTAIL;
<a id="L1384" name="L1384"></a>1384     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> WNEXT;
<a id="L1385" name="L1385"></a>1385     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> WSTATUS;
<a id="L1386" name="L1386"></a>1386     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> WCOWAIT;
<a id="L1387" name="L1387"></a>1387     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> PARKBLOCKER;
<a id="L1388" name="L1388"></a>1388 
<a id="L1389" name="L1389"></a>1389     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L1390" name="L1390"></a>1390         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1391" name="L1391"></a>1391             U = sun.misc.Unsafe.getUnsafe();
<a id="L1392" name="L1392"></a>1392             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; k = <a href="../S/1050.html#L191" title="Defined at 191 in src/java/util/concurrent/locks/StampedLock.java.">StampedLock</a>.<strong class="reserved">class</strong>;
<a id="L1393" name="L1393"></a>1393             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; wk = <a href="../S/1050.html#L312" title="Defined at 312 in src/java/util/concurrent/locks/StampedLock.java.">WNode</a>.<strong class="reserved">class</strong>;
<a id="L1394" name="L1394"></a>1394             STATE = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1395" name="L1395"></a>1395                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("state"));
<a id="L1396" name="L1396"></a>1396             WHEAD = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1397" name="L1397"></a>1397                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("whead"));
<a id="L1398" name="L1398"></a>1398             WTAIL = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1399" name="L1399"></a>1399                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("wtail"));
<a id="L1400" name="L1400"></a>1400             WSTATUS = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1401" name="L1401"></a>1401                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("status"));
<a id="L1402" name="L1402"></a>1402             WNEXT = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1403" name="L1403"></a>1403                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("next"));
<a id="L1404" name="L1404"></a>1404             WCOWAIT = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1405" name="L1405"></a>1405                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("cowait"));
<a id="L1406" name="L1406"></a>1406             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; tk = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<strong class="reserved">class</strong>;
<a id="L1407" name="L1407"></a>1407             PARKBLOCKER = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1408" name="L1408"></a>1408                 (tk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("parkBlocker"));
<a id="L1409" name="L1409"></a>1409 
<a id="L1410" name="L1410"></a>1410         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L1411" name="L1411"></a>1411             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(e);
<a id="L1412" name="L1412"></a>1412         <em class="brace">}</em>
<a id="L1413" name="L1413"></a>1413     <em class="brace">}</em>
<a id="L1414" name="L1414"></a>1414 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L350">[^]</a><a href="#L1312">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>