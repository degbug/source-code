<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/ForkJoinPool.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L699">[^]</a><a href="#L3466">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L699" title="Defined at 699.">checkPermission</a></li>
<li><a href="#L721" title="Defined at 721.">newThread</a></li>
<li><a href="#L730" title="Defined at 730.">newThread</a></li>
<li><a href="#L744" title="Defined at 744.">getRawResult</a></li>
<li><a href="#L745" title="Defined at 745.">setRawResult</a></li>
<li><a href="#L746" title="Defined at 746.">exec</a></li>
<li><a href="#L826" title="Defined at 826.">getPoolIndex</a></li>
<li><a href="#L833" title="Defined at 833.">queueSize</a></li>
<li><a href="#L843" title="Defined at 843.">isEmpty</a></li>
<li><a href="#L859" title="Defined at 859.">push</a></li>
<li><a href="#L880" title="Defined at 880.">growArray</a></li>
<li><a href="#L907" title="Defined at 907.">pop</a></li>
<li><a href="#L928" title="Defined at 928.">pollAt</a></li>
<li><a href="#L944" title="Defined at 944.">poll</a></li>
<li><a href="#L966" title="Defined at 966.">nextLocalTask</a></li>
<li><a href="#L973" title="Defined at 973.">peek</a></li>
<li><a href="#L986" title="Defined at 986.">tryUnpush</a></li>
<li><a href="#L1000" title="Defined at 1000.">cancelAll</a></li>
<li><a href="#L1019" title="Defined at 1019.">pollAndExecAll</a></li>
<li><a href="#L1029" title="Defined at 1029.">execLocalTasks</a></li>
<li><a href="#L1053" title="Defined at 1053.">runTask</a></li>
<li><a href="#L1071" title="Defined at 1071.">transferStealCount</a></li>
<li><a href="#L1086" title="Defined at 1086.">tryRemoveAndExec</a></li>
<li><a href="#L1129" title="Defined at 1129.">popCC</a></li>
<li><a href="#L1173" title="Defined at 1173.">pollAndExecCC</a></li>
<li><a href="#L1210" title="Defined at 1210.">isApparentlyUnblocked</a></li>
<li><a href="#L1293" title="Defined at 1293.">nextPoolId</a></li>
<li><a href="#L1403" title="Defined at 1403.">lockRunState</a></li>
<li><a href="#L1414" title="Defined at 1414.">awaitRunStateLock</a></li>
<li><a href="#L1462" title="Defined at 1462.">unlockRunState</a></li>
<li><a href="#L1480" title="Defined at 1480.">createWorker</a></li>
<li><a href="#L1504" title="Defined at 1504.">tryAddWorker</a></li>
<li><a href="#L1531" title="Defined at 1531.">registerWorker</a></li>
<li><a href="#L1578" title="Defined at 1578.">deregisterWorker</a></li>
<li><a href="#L1629" title="Defined at 1629.">signalWork</a></li>
<li><a href="#L1667" title="Defined at 1667.">tryRelease</a></li>
<li><a href="#L1686" title="Defined at 1686.">runWorker</a></li>
<li><a href="#L1715" title="Defined at 1715.">scan</a></li>
<li><a href="#L1785" title="Defined at 1785.">awaitWork</a></li>
<li><a href="#L1856" title="Defined at 1856.">helpComplete</a></li>
<li><a href="#L1912" title="Defined at 1912.">helpStealer</a></li>
<li><a href="#L1981" title="Defined at 1981.">tryCompensate</a></li>
<li><a href="#L2034" title="Defined at 2034.">awaitJoin</a></li>
<li><a href="#L2074" title="Defined at 2074.">findNonEmptyStealQueue</a></li>
<li><a href="#L2101" title="Defined at 2101.">helpQuiescePool</a></li>
<li><a href="#L2137" title="Defined at 2137.">nextTaskFor</a></li>
<li><a href="#L2191" title="Defined at 2191.">getSurplusQueuedTaskCount</a></li>
<li><a href="#L2217" title="Defined at 2217.">tryTerminate</a></li>
<li><a href="#L2317" title="Defined at 2317.">externalSubmit</a></li>
<li><a href="#L2399" title="Defined at 2399.">externalPush</a></li>
<li><a href="#L2425" title="Defined at 2425.">commonSubmitterQueue</a></li>
<li><a href="#L2439" title="Defined at 2439.">tryExternalUnpush</a></li>
<li><a href="#L2463" title="Defined at 2463.">externalHelpComplete</a></li>
<li><a href="#L2544" title="Defined at 2544.">checkParallelism</a></li>
<li><a href="#L2588" title="Defined at 2588.">commonPool</a></li>
<li><a href="#L2612" title="Defined at 2612.">invoke</a></li>
<li><a href="#L2627" title="Defined at 2627.">execute</a></li>
<li><a href="#L2640" title="Defined at 2640.">execute</a></li>
<li><a href="#L2661" title="Defined at 2661.">submit</a></li>
<li><a href="#L2673" title="Defined at 2673.">submit</a></li>
<li><a href="#L2684" title="Defined at 2684.">submit</a></li>
<li><a href="#L2695" title="Defined at 2695.">submit</a></li>
<li><a href="#L2711" title="Defined at 2711.">invokeAll</a></li>
<li><a href="#L2740" title="Defined at 2740.">getFactory</a></li>
<li><a href="#L2750" title="Defined at 2750.">getUncaughtExceptionHandler</a></li>
<li><a href="#L2759" title="Defined at 2759.">getParallelism</a></li>
<li><a href="#L2770" title="Defined at 2770.">getCommonPoolParallelism</a></li>
<li><a href="#L2782" title="Defined at 2782.">getPoolSize</a></li>
<li><a href="#L2792" title="Defined at 2792.">getAsyncMode</a></li>
<li><a href="#L2804" title="Defined at 2804.">getRunningThreadCount</a></li>
<li><a href="#L2823" title="Defined at 2823.">getActiveThreadCount</a></li>
<li><a href="#L2839" title="Defined at 2839.">isQuiescent</a></li>
<li><a href="#L2854" title="Defined at 2854.">getStealCount</a></li>
<li><a href="#L2877" title="Defined at 2877.">getQueuedTaskCount</a></li>
<li><a href="#L2896" title="Defined at 2896.">getQueuedSubmissionCount</a></li>
<li><a href="#L2914" title="Defined at 2914.">hasQueuedSubmissions</a></li>
<li><a href="#L2932" title="Defined at 2932.">pollSubmission</a></li>
<li><a href="#L2960" title="Defined at 2960.">drainTasksTo</a></li>
<li><a href="#L2983" title="Defined at 2983.">toString</a></li>
<li><a href="#L3041" title="Defined at 3041.">shutdown</a></li>
<li><a href="#L3064" title="Defined at 3064.">shutdownNow</a></li>
<li><a href="#L3075" title="Defined at 3075.">isTerminated</a></li>
<li><a href="#L3092" title="Defined at 3092.">isTerminating</a></li>
<li><a href="#L3102" title="Defined at 3102.">isShutdown</a></li>
<li><a href="#L3120" title="Defined at 3120.">awaitTermination</a></li>
<li><a href="#L3158" title="Defined at 3158.">awaitQuiescence</a></li>
<li><a href="#L3197" title="Defined at 3197.">quiesceCommonPool</a></li>
<li><a href="#L3266" title="Defined at 3266.">block</a></li>
<li><a href="#L3272" title="Defined at 3272.">isReleasable</a></li>
<li><a href="#L3301" title="Defined at 3301.">managedBlock</a></li>
<li><a href="#L3331" title="Defined at 3331.">newTaskFor</a></li>
<li><a href="#L3335" title="Defined at 3335.">newTaskFor</a></li>
<li><a href="#L3407" title="Defined at 3407.">makeCommonPool</a></li>
<li><a href="#L3466" title="Defined at 3466.">newThread</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent;
<a id="L37" name="L37"></a>  37 
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.lang.Thread.UncaughtExceptionHandler;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.util.Arrays;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.util.Collection;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> java.util.Collections;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> java.util.List;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> java.util.concurrent.AbstractExecutorService;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> java.util.concurrent.Callable;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> java.util.concurrent.ExecutorService;
<a id="L47" name="L47"></a>  47 <strong class="reserved">import</strong> java.util.concurrent.Future;
<a id="L48" name="L48"></a>  48 <strong class="reserved">import</strong> java.util.concurrent.RejectedExecutionException;
<a id="L49" name="L49"></a>  49 <strong class="reserved">import</strong> java.util.concurrent.RunnableFuture;
<a id="L50" name="L50"></a>  50 <strong class="reserved">import</strong> java.util.concurrent.ThreadLocalRandom;
<a id="L51" name="L51"></a>  51 <strong class="reserved">import</strong> java.util.concurrent.TimeUnit;
<a id="L52" name="L52"></a>  52 <strong class="reserved">import</strong> java.util.concurrent.atomic.AtomicLong;
<a id="L53" name="L53"></a>  53 <strong class="reserved">import</strong> java.security.AccessControlContext;
<a id="L54" name="L54"></a>  54 <strong class="reserved">import</strong> java.security.ProtectionDomain;
<a id="L55" name="L55"></a>  55 <strong class="reserved">import</strong> java.security.Permissions;
<a id="L56" name="L56"></a>  56 
<div class="comment">
  An {@link ExecutorService} for running {@link ForkJoinTask}s.
  A <code>ForkJoinPool</code> provides the entry point for submissions
  from non-<code>ForkJoinTask</code> clients, as well as management and
  monitoring operations.
  <p>A <code>ForkJoinPool</code> differs from other kinds of {@link
  ExecutorService} mainly by virtue of employing
  <em>work-stealing</em>: all threads in the pool attempt to find and
  execute tasks submitted to the pool and/or created by other active
  tasks (eventually blocking waiting for work if none exist). This
  enables efficient processing when most tasks spawn other subtasks
  (as do most <code>ForkJoinTask</code>s), as well as when many small
  tasks are submitted to the pool from external clients.  Especially
  when setting <em>asyncMode</em> to true in constructors, {@code
  ForkJoinPool}s may also be appropriate for use with event-style
  tasks that are never joined.
  </p><p>A static {@link #commonPool()} is available and appropriate for
  most applications. The common pool is used by any ForkJoinTask that
  is not explicitly submitted to a specified pool. Using the common
  pool normally reduces resource usage (its threads are slowly
  reclaimed during periods of non-use, and reinstated upon subsequent
  use).
  </p><p>For applications that require separate or custom pools, a {@code
  ForkJoinPool} may be constructed with a given target parallelism
  level; by default, equal to the number of available processors.
  The pool attempts to maintain enough active (or available) threads
  by dynamically adding, suspending, or resuming internal worker
  threads, even if some tasks are stalled waiting to join others.
  However, no such adjustments are guaranteed in the face of blocked
  I/O or other unmanaged synchronization. The nested {@link
  ManagedBlocker} interface enables extension of the kinds of
  synchronization accommodated.
  </p><p>In addition to execution and lifecycle control methods, this
  class provides status check methods (for example
  {@link #getStealCount}) that are intended to aid in developing,
  tuning, and monitoring fork/join applications. Also, method
  {@link #toString} returns indications of pool state in a
  convenient form for informal monitoring.
  </p><p>As is the case with other ExecutorServices, there are three
  main task execution methods summarized in the following table.
  These are designed to be used primarily by clients not already
  engaged in fork/join computations in the current pool.  The main
  forms of these methods accept instances of <code>ForkJoinTask</code>,
  but overloaded forms also allow mixed execution of plain {@code
  Runnable}- or <code>Callable</code>- based activities as well.  However,
  tasks that are already executing in a pool should normally instead
  use the within-computation forms listed in the table unless using
  async event-style tasks that are not usually joined, in which case
  there is little difference among choice of methods.
  </p><table border cellpadding="3" cellspacing="1">
  <caption>Summary of task execution methods</caption>
   <tbody><tr>
     <td></td>
     <td align="CENTER"> <b>Call from non-fork/join clients</b></td>
     <td align="CENTER"> <b>Call from within fork/join computations</b></td>
   </tr>
   <tr>
     <td> <b>Arrange async execution</b></td>
     <td> {@link #execute(ForkJoinTask)}</td>
     <td> {@link ForkJoinTask#fork}</td>
   </tr>
   <tr>
     <td> <b>Await and obtain result</b></td>
     <td> {@link #invoke(ForkJoinTask)}</td>
     <td> {@link ForkJoinTask#invoke}</td>
   </tr>
   <tr>
     <td> <b>Arrange exec and obtain Future</b></td>
     <td> {@link #submit(ForkJoinTask)}</td>
     <td> {@link ForkJoinTask#fork} (ForkJoinTasks <em>are</em> Futures)</td>
   </tr>
  </tbody></table>
  <p>The common pool is by default constructed with default
  parameters, but these may be controlled by setting three
  {@linkplain System#getProperty system properties}:
  </p><ul><li><code>java.util.concurrent.ForkJoinPool.common.parallelism</code>
  - the parallelism level, a non-negative integer
  </li><li><code>java.util.concurrent.ForkJoinPool.common.threadFactory</code>
  - the class name of a {@link ForkJoinWorkerThreadFactory}
  </li><li><code>java.util.concurrent.ForkJoinPool.common.exceptionHandler</code>
  - the class name of a {@link UncaughtExceptionHandler}
  </li></ul>
  If a {@link SecurityManager} is present and no factory is
  specified, then the default pool uses a factory supplying
  threads that have no {@link Permissions} enabled.
  The system class loader is used to load these classes.
  Upon any error in establishing these settings, default parameters
  are used. It is possible to disable or limit the use of threads in
  the common pool by setting the parallelism property to zero, and/or
  using a factory that may return <code>null</code>. However doing so may
  cause unjoined tasks to never be executed.
  <p><b>Implementation notes</b>: This implementation restricts the
  maximum number of running threads to 32767. Attempts to create
  pools with greater than the maximum number result in
  <code>IllegalArgumentException</code>.
  </p><p>This implementation rejects submitted tasks (that is, by throwing
  {@link RejectedExecutionException}) only when the pool is shut down
  or internal resources have been exhausted.
  @since 1.7
  @author Doug Lea</p></div>
<a id="L169" name="L169"></a> 169 @sun.misc.<a href="../D/1850.html" title="Multiple defined in 3 places.">Contended</a>
<a id="L170" name="L170"></a> 170 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/3085.html" title="Multiple referred from 81 places.">ForkJoinPool</a> <strong class="reserved">extends</strong> <a href="../S/1105.html#L71" title="Defined at 71 in src/java/util/concurrent/AbstractExecutorService.java.">AbstractExecutorService</a> <em class="brace">{</em>
<a id="L171" name="L171"></a> 171 
<div class="comment">
      Implementation Overview
      This class and its nested classes provide the main
      functionality and control for a set of worker threads:
      Submissions from non-FJ threads enter into submission queues.
      Workers take these tasks and typically split them into subtasks
      that may be stolen by other workers.  Preference rules give
      first priority to processing tasks from their own queues (LIFO
      or FIFO, depending on mode), then to randomized FIFO steals of
      tasks in other queues.  This framework began as vehicle for
      supporting tree-structured parallelism using work-stealing.
      Over time, its scalability advantages led to extensions and
      changes to better support more diverse usage contexts.  Because
      most internal methods and nested classes are interrelated,
      their main rationale and descriptions are presented here;
      individual methods and nested classes contain only brief
      comments about details.
      WorkQueues
      ==========
      Most operations occur within work-stealing queues (in nested
      class WorkQueue).  These are special forms of Deques that
      support only three of the four possible end-operations -- push,
      pop, and poll (aka steal), under the further constraints that
      push and pop are called only from the owning thread (or, as
      extended here, under a lock), while poll may be called from
      other threads.  (If you are unfamiliar with them, you probably
      want to read Herlihy and Shavit's book "The Art of
      Multiprocessor programming", chapter 16 describing these in
      more detail before proceeding.)  The main work-stealing queue
      design is roughly similar to those in the papers "Dynamic
      Circular Work-Stealing Deque" by Chase and Lev, SPAA 2005
      (http://research.sun.com/scalable/pubs/index.html) and
      "Idempotent work stealing" by Michael, Saraswat, and Vechev,
      PPoPP 2009 (http://portal.acm.org/citation.cfm?id=1504186).
      The main differences ultimately stem from GC requirements that
      we null out taken slots as soon as we can, to maintain as small
      a footprint as possible even in programs generating huge
      numbers of tasks. To accomplish this, we shift the CAS
      arbitrating pop vs poll (steal) from being on the indices
      ("base" and "top") to the slots themselves.
      Adding tasks then takes the form of a classic array push(task):
         q.array[q.top] = task; ++q.top;
      (The actual code needs to null-check and size-check the array,
      properly fence the accesses, and possibly signal waiting
      workers to start scanning -- see below.)  Both a successful pop
      and poll mainly entail a CAS of a slot from non-null to null.
      The pop operation (always performed by owner) is:
        if ((base != top) and
             (the task at top slot is not null) and
             (CAS slot to null))
                decrement top and return task;
      And the poll operation (usually by a stealer) is
         if ((base != top) and
             (the task at base slot is not null) and
             (base has not changed) and
             (CAS slot to null))
                increment base and return task;
      Because we rely on CASes of references, we do not need tag bits
      on base or top.  They are simple ints as used in any circular
      array-based queue (see for example ArrayDeque).  Updates to the
      indices guarantee that top == base means the queue is empty,
      but otherwise may err on the side of possibly making the queue
      appear nonempty when a push, pop, or poll have not fully
      committed. (Method isEmpty() checks the case of a partially
      completed removal of the last element.)  Because of this, the
      poll operation, considered individually, is not wait-free. One
      thief cannot successfully continue until another in-progress
      one (or, if previously empty, a push) completes.  However, in
      the aggregate, we ensure at least probabilistic
      non-blockingness.  If an attempted steal fails, a thief always
      chooses a different random victim target to try next. So, in
      order for one thief to progress, it suffices for any
      in-progress poll or new push on any empty queue to
      complete. (This is why we normally use method pollAt and its
      variants that try once at the apparent base index, else
      consider alternative actions, rather than method poll, which
      retries.)
      This approach also enables support of a user mode in which
      local task processing is in FIFO, not LIFO order, simply by
      using poll rather than pop.  This can be useful in
      message-passing frameworks in which tasks are never joined.
      However neither mode considers affinities, loads, cache
      localities, etc, so rarely provide the best possible
      performance on a given machine, but portably provide good
      throughput by averaging over these factors.  Further, even if
      we did try to use such information, we do not usually have a
      basis for exploiting it.  For example, some sets of tasks
      profit from cache affinities, but others are harmed by cache
      pollution effects. Additionally, even though it requires
      scanning, long-term throughput is often best using random
      selection rather than directed selection policies, so cheap
      randomization of sufficient quality is used whenever
      applicable.  Various Marsaglia XorShifts (some with different
      shift constants) are inlined at use points.
      WorkQueues are also used in a similar way for tasks submitted
      to the pool. We cannot mix these tasks in the same queues used
      by workers. Instead, we randomly associate submission queues
      with submitting threads, using a form of hashing.  The
      ThreadLocalRandom probe value serves as a hash code for
      choosing existing queues, and may be randomly repositioned upon
      contention with other submitters.  In essence, submitters act
      like workers except that they are restricted to executing local
      tasks that they submitted (or in the case of CountedCompleters,
      others with the same root task).  Insertion of tasks in shared
      mode requires a lock (mainly to protect in the case of
      resizing) but we use only a simple spinlock (using field
      qlock), because submitters encountering a busy queue move on to
      try or create other queues -- they block only when creating and
      registering new queues. Additionally, "qlock" saturates to an
      unlockable value (-1) at shutdown. Unlocking still can be and
      is performed by cheaper ordered writes of "qlock" in successful
      cases, but uses CAS in unsuccessful cases.
      Management
      ==========
      The main throughput advantages of work-stealing stem from
      decentralized control -- workers mostly take tasks from
      themselves or each other, at rates that can exceed a billion
      per second.  The pool itself creates, activates (enables
      scanning for and running tasks), deactivates, blocks, and
      terminates threads, all with minimal central information.
      There are only a few properties that we can globally track or
      maintain, so we pack them into a small number of variables,
      often maintaining atomicity without blocking or locking.
      Nearly all essentially atomic control state is held in two
      volatile variables that are by far most often read (not
      written) as status and consistency checks. (Also, field
      "config" holds unchanging configuration state.)
      Field "ctl" contains 64 bits holding information needed to
      atomically decide to add, inactivate, enqueue (on an event
      queue), dequeue, and/or re-activate workers.  To enable this
      packing, we restrict maximum parallelism to (1&lt;&lt;15)-1 (which is
      far in excess of normal operating range) to allow ids, counts,
      and their negations (used for thresholding) to fit into 16bit
      subfields.
      Field "runState" holds lockable state bits (STARTED, STOP, etc)
      also protecting updates to the workQueues array.  When used as
      a lock, it is normally held only for a few instructions (the
      only exceptions are one-time array initialization and uncommon
      resizing), so is nearly always available after at most a brief
      spin. But to be extra-cautious, after spinning, method
      awaitRunStateLock (called only if an initial CAS fails), uses a
      wait/notify mechanics on a builtin monitor to block when
      (rarely) needed. This would be a terrible idea for a highly
      contended lock, but most pools run without the lock ever
      contending after the spin limit, so this works fine as a more
      conservative alternative. Because we don't otherwise have an
      internal Object to use as a monitor, the "stealCounter" (an
      AtomicLong) is used when available (it too must be lazily
      initialized; see externalSubmit).
      Usages of "runState" vs "ctl" interact in only one case:
      deciding to add a worker thread (see tryAddWorker), in which
      case the ctl CAS is performed while the lock is held.
      Recording WorkQueues.  WorkQueues are recorded in the
      "workQueues" array. The array is created upon first use (see
      externalSubmit) and expanded if necessary.  Updates to the
      array while recording new workers and unrecording terminated
      ones are protected from each other by the runState lock, but
      the array is otherwise concurrently readable, and accessed
      directly. We also ensure that reads of the array reference
      itself never become too stale. To simplify index-based
      operations, the array size is always a power of two, and all
      readers must tolerate null slots. Worker queues are at odd
      indices. Shared (submission) queues are at even indices, up to
      a maximum of 64 slots, to limit growth even if array needs to
      expand to add more workers. Grouping them together in this way
      simplifies and speeds up task scanning.
      All worker thread creation is on-demand, triggered by task
      submissions, replacement of terminated workers, and/or
      compensation for blocked workers. However, all other support
      code is set up to work with other policies.  To ensure that we
      do not hold on to worker references that would prevent GC, All
      accesses to workQueues are via indices into the workQueues
      array (which is one source of some of the messy code
      constructions here). In essence, the workQueues array serves as
      a weak reference mechanism. Thus for example the stack top
      subfield of ctl stores indices, not references.
      Queuing Idle Workers. Unlike HPC work-stealing frameworks, we
      cannot let workers spin indefinitely scanning for tasks when
      none can be found immediately, and we cannot start/resume
      workers unless there appear to be tasks available.  On the
      other hand, we must quickly prod them into action when new
      tasks are submitted or generated. In many usages, ramp-up time
      to activate workers is the main limiting factor in overall
      performance, which is compounded at program start-up by JIT
      compilation and allocation. So we streamline this as much as
      possible.
      The "ctl" field atomically maintains active and total worker
      counts as well as a queue to place waiting threads so they can
      be located for signalling. Active counts also play the role of
      quiescence indicators, so are decremented when workers believe
      that there are no more tasks to execute. The "queue" is
      actually a form of Treiber stack.  A stack is ideal for
      activating threads in most-recently used order. This improves
      performance and locality, outweighing the disadvantages of
      being prone to contention and inability to release a worker
      unless it is topmost on stack.  We park/unpark workers after
      pushing on the idle worker stack (represented by the lower
      32bit subfield of ctl) when they cannot find work.  The top
      stack state holds the value of the "scanState" field of the
      worker: its index and status, plus a version counter that, in
      addition to the count subfields (also serving as version
      stamps) provide protection against Treiber stack ABA effects.
      Field scanState is used by both workers and the pool to manage
      and track whether a worker is INACTIVE (possibly blocked
      waiting for a signal), or SCANNING for tasks (when neither hold
      it is busy running tasks).  When a worker is inactivated, its
      scanState field is set, and is prevented from executing tasks,
      even though it must scan once for them to avoid queuing
      races. Note that scanState updates lag queue CAS releases so
      usage requires care. When queued, the lower 16 bits of
      scanState must hold its pool index. So we place the index there
      upon initialization (see registerWorker) and otherwise keep it
      there or restore it when necessary.
      Memory ordering.  See "Correct and Efficient Work-Stealing for
      Weak Memory Models" by Le, Pop, Cohen, and Nardelli, PPoPP 2013
      (http://www.di.ens.fr/~zappa/readings/ppopp13.pdf) for an
      analysis of memory ordering requirements in work-stealing
      algorithms similar to the one used here.  We usually need
      stronger than minimal ordering because we must sometimes signal
      workers, requiring Dekker-like full-fences to avoid lost
      signals.  Arranging for enough ordering without expensive
      over-fencing requires tradeoffs among the supported means of
      expressing access constraints. The most central operations,
      taking from queues and updating ctl state, require full-fence
      CAS.  Array slots are read using the emulation of volatiles
      provided by Unsafe.  Access from other threads to WorkQueue
      base, top, and array requires a volatile load of the first of
      any of these read.  We use the convention of declaring the
      "base" index volatile, and always read it before other fields.
      The owner thread must ensure ordered updates, so writes use
      ordered intrinsics unless they can piggyback on those for other
      writes.  Similar conventions and rationales hold for other
      WorkQueue fields (such as "currentSteal") that are only written
      by owners but observed by others.
      Creating workers. To create a worker, we pre-increment total
      count (serving as a reservation), and attempt to construct a
      ForkJoinWorkerThread via its factory. Upon construction, the
      new thread invokes registerWorker, where it constructs a
      WorkQueue and is assigned an index in the workQueues array
      (expanding the array if necessary). The thread is then
      started. Upon any exception across these steps, or null return
      from factory, deregisterWorker adjusts counts and records
      accordingly.  If a null return, the pool continues running with
      fewer than the target number workers. If exceptional, the
      exception is propagated, generally to some external caller.
      Worker index assignment avoids the bias in scanning that would
      occur if entries were sequentially packed starting at the front
      of the workQueues array. We treat the array as a simple
      power-of-two hash table, expanding as needed. The seedIndex
      increment ensures no collisions until a resize is needed or a
      worker is deregistered and replaced, and thereafter keeps
      probability of collision low. We cannot use
      ThreadLocalRandom.getProbe() for similar purposes here because
      the thread has not started yet, but do so for creating
      submission queues for existing external threads.
      Deactivation and waiting. Queuing encounters several intrinsic
      races; most notably that a task-producing thread can miss
      seeing (and signalling) another thread that gave up looking for
      work but has not yet entered the wait queue.  When a worker
      cannot find a task to steal, it deactivates and enqueues. Very
      often, the lack of tasks is transient due to GC or OS
      scheduling. To reduce false-alarm deactivation, scanners
      compute checksums of queue states during sweeps.  (The
      stability checks used here and elsewhere are probabilistic
      variants of snapshot techniques -- see Herlihy &amp; Shavit.)
      Workers give up and try to deactivate only after the sum is
      stable across scans. Further, to avoid missed signals, they
      repeat this scanning process after successful enqueuing until
      again stable.  In this state, the worker cannot take/run a task
      it sees until it is released from the queue, so the worker
      itself eventually tries to release itself or any successor (see
      tryRelease).  Otherwise, upon an empty scan, a deactivated
      worker uses an adaptive local spin construction (see awaitWork)
      before blocking (via park). Note the unusual conventions about
      Thread.interrupts surrounding parking and other blocking:
      Because interrupts are used solely to alert threads to check
      termination, which is checked anyway upon blocking, we clear
      status (using Thread.interrupted) before any call to park, so
      that park does not immediately return due to status being set
      via some other unrelated call to interrupt in user code.
      Signalling and activation.  Workers are created or activated
      only when there appears to be at least one task they might be
      able to find and execute.  Upon push (either by a worker or an
      external submission) to a previously (possibly) empty queue,
      workers are signalled if idle, or created if fewer exist than
      the given parallelism level.  These primary signals are
      buttressed by others whenever other threads remove a task from
      a queue and notice that there are other tasks there as well.
      On most platforms, signalling (unpark) overhead time is
      noticeably long, and the time between signalling a thread and
      it actually making progress can be very noticeably long, so it
      is worth offloading these delays from critical paths as much as
      possible. Also, because inactive workers are often rescanning
      or spinning rather than blocking, we set and clear the "parker"
      field of WorkQueues to reduce unnecessary calls to unpark.
      (This requires a secondary recheck to avoid missed signals.)
      Trimming workers. To release resources after periods of lack of
      use, a worker starting to wait when the pool is quiescent will
      time out and terminate (see awaitWork) if the pool has remained
      quiescent for period IDLE_TIMEOUT, increasing the period as the
      number of threads decreases, eventually removing all workers.
      Also, when more than two spare threads exist, excess threads
      are immediately terminated at the next quiescent point.
      (Padding by two avoids hysteresis.)
      Shutdown and Termination. A call to shutdownNow invokes
      tryTerminate to atomically set a runState bit. The calling
      thread, as well as every other worker thereafter terminating,
      helps terminate others by setting their (qlock) status,
      cancelling their unprocessed tasks, and waking them up, doing
      so repeatedly until stable (but with a loop bounded by the
      number of workers).  Calls to non-abrupt shutdown() preface
      this by checking whether termination should commence. This
      relies primarily on the active count bits of "ctl" maintaining
      consensus -- tryTerminate is called from awaitWork whenever
      quiescent. However, external submitters do not take part in
      this consensus.  So, tryTerminate sweeps through queues (until
      stable) to ensure lack of in-flight submissions and workers
      about to process them before triggering the "STOP" phase of
      termination. (Note: there is an intrinsic conflict if
      helpQuiescePool is called when shutdown is enabled. Both wait
      for quiescence, but tryTerminate is biased to not trigger until
      helpQuiescePool completes.)
      Joining Tasks
      =============
      Any of several actions may be taken when one worker is waiting
      to join a task stolen (or always held) by another.  Because we
      are multiplexing many tasks on to a pool of workers, we can't
      just let them block (as in Thread.join).  We also cannot just
      reassign the joiner's run-time stack with another and replace
      it later, which would be a form of "continuation", that even if
      possible is not necessarily a good idea since we may need both
      an unblocked task and its continuation to progress.  Instead we
      combine two tactics:
        Helping: Arranging for the joiner to execute some task that it
           would be running if the steal had not occurred.
        Compensating: Unless there are already enough live threads,
           method tryCompensate() may create or re-activate a spare
           thread to compensate for blocked joiners until they unblock.
      A third form (implemented in tryRemoveAndExec) amounts to
      helping a hypothetical compensator: If we can readily tell that
      a possible action of a compensator is to steal and execute the
      task being joined, the joining thread can do so directly,
      without the need for a compensation thread (although at the
      expense of larger run-time stacks, but the tradeoff is
      typically worthwhile).
      The ManagedBlocker extension API can't use helping so relies
      only on compensation in method awaitBlocker.
      The algorithm in helpStealer entails a form of "linear
      helping".  Each worker records (in field currentSteal) the most
      recent task it stole from some other worker (or a submission).
      It also records (in field currentJoin) the task it is currently
      actively joining. Method helpStealer uses these markers to try
      to find a worker to help (i.e., steal back a task from and
      execute it) that could hasten completion of the actively joined
      task.  Thus, the joiner executes a task that would be on its
      own local deque had the to-be-joined task not been stolen. This
      is a conservative variant of the approach described in Wagner &amp;
      Calder "Leapfrogging: a portable technique for implementing
      efficient futures" SIGPLAN Notices, 1993
      (http://portal.acm.org/citation.cfm?id=155354). It differs in
      that: (1) We only maintain dependency links across workers upon
      steals, rather than use per-task bookkeeping.  This sometimes
      requires a linear scan of workQueues array to locate stealers,
      but often doesn't because stealers leave hints (that may become
      stale/wrong) of where to locate them.  It is only a hint
      because a worker might have had multiple steals and the hint
      records only one of them (usually the most current).  Hinting
      isolates cost to when it is needed, rather than adding to
      per-task overhead.  (2) It is "shallow", ignoring nesting and
      potentially cyclic mutual steals.  (3) It is intentionally
      racy: field currentJoin is updated only while actively joining,
      which means that we miss links in the chain during long-lived
      tasks, GC stalls etc (which is OK since blocking in such cases
      is usually a good idea).  (4) We bound the number of attempts
      to find work using checksums and fall back to suspending the
      worker and if necessary replacing it with another.
      Helping actions for CountedCompleters do not require tracking
      currentJoins: Method helpComplete takes and executes any task
      with the same root as the task being waited on (preferring
      local pops to non-local polls). However, this still entails
      some traversal of completer chains, so is less efficient than
      using CountedCompleters without explicit joins.
      Compensation does not aim to keep exactly the target
      parallelism number of unblocked threads running at any given
      time. Some previous versions of this class employed immediate
      compensations for any blocked join. However, in practice, the
      vast majority of blockages are transient byproducts of GC and
      other JVM or OS activities that are made worse by replacement.
      Currently, compensation is attempted only after validating that
      all purportedly active threads are processing tasks by checking
      field WorkQueue.scanState, which eliminates most false
      positives.  Also, compensation is bypassed (tolerating fewer
      threads) in the most common case in which it is rarely
      beneficial: when a worker with an empty queue (thus no
      continuation tasks) blocks on a join and there still remain
      enough threads to ensure liveness.
      The compensation mechanism may be bounded.  Bounds for the
      commonPool (see commonMaxSpares) better enable JVMs to cope
      with programming errors and abuse before running out of
      resources to do so. In other cases, users may supply factories
      that limit thread construction. The effects of bounding in this
      pool (like all others) is imprecise.  Total worker counts are
      decremented when threads deregister, not when they exit and
      resources are reclaimed by the JVM and OS. So the number of
      simultaneously live threads may transiently exceed bounds.
      Common Pool
      ===========
      The static common pool always exists after static
      initialization.  Since it (or any other created pool) need
      never be used, we minimize initial construction overhead and
      footprint to the setup of about a dozen fields, with no nested
      allocation. Most bootstrapping occurs within method
      externalSubmit during the first submission to the pool.
      When external threads submit to the common pool, they can
      perform subtask processing (see externalHelpComplete and
      related methods) upon joins.  This caller-helps policy makes it
      sensible to set common pool parallelism level to one (or more)
      less than the total number of available cores, or even zero for
      pure caller-runs.  We do not need to record whether external
      submissions are to the common pool -- if not, external help
      methods return quickly. These submitters would otherwise be
      blocked waiting for completion, so the extra effort (with
      liberally sprinkled task status checks) in inapplicable cases
      amounts to an odd form of limited spin-wait before blocking in
      ForkJoinTask.join.
      As a more appropriate default in managed environments, unless
      overridden by system properties, we use workers of subclass
      InnocuousForkJoinWorkerThread when there is a SecurityManager
      present. These workers have no permissions set, do not belong
      to any user-defined ThreadGroup, and erase all ThreadLocals
      after executing any top-level task (see WorkQueue.runTask).
      The associated mechanics (mainly in ForkJoinWorkerThread) may
      be JVM-dependent and must access particular Thread class fields
      to achieve this effect.
      Style notes
      ===========
      Memory ordering relies mainly on Unsafe intrinsics that carry
      the further responsibility of explicitly performing null- and
      bounds- checks otherwise carried out implicitly by JVMs.  This
      can be awkward and ugly, but also reflects the need to control
      outcomes across the unusual cases that arise in very racy code
      with very few invariants. So these explicit checks would exist
      in some form anyway.  All fields are read into locals before
      use, and null-checked if they are references.  This is usually
      done in a "C"-like style of listing declarations at the heads
      of methods or blocks, and using inline assignments on first
      encounter.  Array bounds-checks are usually performed by
      masking with array.length-1, which relies on the invariant that
      these arrays are created with positive lengths, which is itself
      paranoically checked. Nearly all explicit checks lead to
      bypass/return, not exception throws, because they may
      legitimately arise due to cancellation/revocation during
      shutdown.
      There is a lot of representation-level coupling among classes
      ForkJoinPool, ForkJoinWorkerThread, and ForkJoinTask.  The
      fields of WorkQueue maintain data structures managed by
      ForkJoinPool, so are directly accessed.  There is little point
      trying to reduce this, since any associated future changes in
      representations will need to be accompanied by algorithmic
      changes anyway. Several methods intrinsically sprawl because
      they must accumulate sets of consistent reads of fields held in
      local variables.  There are also other coding oddities
      (including several unnecessary-looking hoisted null checks)
      that help some methods perform reasonably even when interpreted
      (not compiled).
      The order of declarations in this file is (with a few exceptions):
      (1) Static utility functions
      (2) Nested (static) classes
      (3) Static fields
      (4) Fields, along with constants used when unpacking some of them
      (5) Internal control methods
      (6) Callbacks and other support for ForkJoinTask methods
      (7) Exported methods
      (8) Static block initializing statics in minimally dependent order</div>
<a id="L692" name="L692"></a> 692 
<a id="L693" name="L693"></a> 693     <em class="comment">// Static utilities</em>
<a id="L694" name="L694"></a> 694 
<div class="comment">
      If there is a security manager, makes sure caller has
      permission to modify threads.</div>
<a id="L699" name="L699"></a> 699     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/11295.html" title="Multiple referred from 248 places.">checkPermission</a>() <em class="brace">{</em>
<a id="L700" name="L700"></a> 700         <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> security = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L701" name="L701"></a> 701         <strong class="reserved">if</strong> (security != <strong class="reserved">null</strong>)
<a id="L702" name="L702"></a> 702             security.<a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>(modifyThreadPermission);
<a id="L703" name="L703"></a> 703     <em class="brace">}</em>
<a id="L704" name="L704"></a> 704 
<a id="L705" name="L705"></a> 705     <em class="comment">// Nested classes</em>
<a id="L706" name="L706"></a> 706 
<div class="comment">
      Factory for creating new {@link ForkJoinWorkerThread}s.
      A <code>ForkJoinWorkerThreadFactory</code> must be defined and used
      for <code>ForkJoinWorkerThread</code> subclasses that extend base
      functionality or initialize threads with different contexts.</div>
<a id="L713" name="L713"></a> 713     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">interface</strong> <a href="../R/3088.html" title="Multiple referred from 12 places.">ForkJoinWorkerThreadFactory</a> <em class="brace">{</em>
<div class="comment">
          Returns a new worker thread operating in the given pool.
          @param pool the pool this thread works in
          @return the new worker thread
          @throws NullPointerException if the pool is null</div>
<a id="L721" name="L721"></a> 721         <strong class="reserved">public</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> <a href="../R/23625.html" title="Multiple referred from 5 places.">newThread</a>(<a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> pool);
<a id="L722" name="L722"></a> 722     <em class="brace">}</em>
<a id="L723" name="L723"></a> 723 
<div class="comment">
      Default ForkJoinWorkerThreadFactory implementation; creates a
      new ForkJoinWorkerThread.</div>
<a id="L728" name="L728"></a> 728     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/1063.html#L3393" title="Referred from 3393 in src/java/util/concurrent/ForkJoinPool.java.">DefaultForkJoinWorkerThreadFactory</a>
<a id="L729" name="L729"></a> 729         <strong class="reserved">implements</strong> <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <em class="brace">{</em>
<a id="L730" name="L730"></a> 730         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> <a href="../R/23625.html" title="Multiple referred from 5 places.">newThread</a>(<a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> pool) <em class="brace">{</em>
<a id="L731" name="L731"></a> 731             <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>(pool);
<a id="L732" name="L732"></a> 732         <em class="brace">}</em>
<a id="L733" name="L733"></a> 733     <em class="brace">}</em>
<a id="L734" name="L734"></a> 734 
<div class="comment">
      Class for artificial tasks that are used to replace the target
      of local joins if they are removed from an interior queue slot
      in WorkQueue.tryRemoveAndExec. We don't need the proxy to
      actually do anything beyond having a unique identity.</div>
<a id="L741" name="L741"></a> 741     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/1063.html#L1105" title="Referred from 1105 in src/java/util/concurrent/ForkJoinPool.java.">EmptyTask</a> <strong class="reserved">extends</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <em class="brace">{</em>
<a id="L742" name="L742"></a> 742         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -7721805057305804111L;
<a id="L743" name="L743"></a> 743         EmptyTask() <em class="brace">{</em> <a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> = <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.NORMAL; <em class="brace">}</em> <em class="comment">// force done</em>
<a id="L744" name="L744"></a> 744         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../R/18601.html" title="Multiple referred from 4 places.">getRawResult</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <strong class="reserved">null</strong>; <em class="brace">}</em>
<a id="L745" name="L745"></a> 745         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/27997.html" title="Multiple referred from 2 places.">setRawResult</a>(<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <em class="brace">{</em><em class="brace">}</em>
<a id="L746" name="L746"></a> 746         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/14091.html" title="Multiple referred from 8 places.">exec</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <strong class="reserved">true</strong>; <em class="brace">}</em>
<a id="L747" name="L747"></a> 747     <em class="brace">}</em>
<a id="L748" name="L748"></a> 748 
<a id="L749" name="L749"></a> 749     <em class="comment">// Constants shared across ForkJoinPool and WorkQueue</em>
<a id="L750" name="L750"></a> 750 
<a id="L751" name="L751"></a> 751     <em class="comment">// Bounds</em>
<a id="L752" name="L752"></a> 752     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SMASK        = 0xffff;        <em class="comment">// short bits == max index</em>
<a id="L753" name="L753"></a> 753     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_CAP      = 0x7fff;        <em class="comment">// max #workers - 1</em>
<a id="L754" name="L754"></a> 754     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> EVENMASK     = 0xfffe;        <em class="comment">// even short bits</em>
<a id="L755" name="L755"></a> 755     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SQMASK       = 0x007e;        <em class="comment">// max 64 (even) slots</em>
<a id="L756" name="L756"></a> 756 
<a id="L757" name="L757"></a> 757     <em class="comment">// Masks and units for WorkQueue.scanState and ctl sp subfield</em>
<a id="L758" name="L758"></a> 758     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SCANNING     = 1;             <em class="comment">// false when running tasks</em>
<a id="L759" name="L759"></a> 759     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/480.html#L11" title="Defined at 11 in src/org/omg/PortableInterceptor/INACTIVE.java.">INACTIVE</a>     = 1 &lt;&lt; 31;       <em class="comment">// must be negative</em>
<a id="L760" name="L760"></a> 760     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SS_SEQ       = 1 &lt;&lt; 16;       <em class="comment">// version count</em>
<a id="L761" name="L761"></a> 761 
<a id="L762" name="L762"></a> 762     <em class="comment">// Mode bits for ForkJoinPool.config and WorkQueue.config</em>
<a id="L763" name="L763"></a> 763     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MODE_MASK    = 0xffff &lt;&lt; 16;  <em class="comment">// top half of int</em>
<a id="L764" name="L764"></a> 764     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> LIFO_QUEUE   = 0;
<a id="L765" name="L765"></a> 765     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> FIFO_QUEUE   = 1 &lt;&lt; 16;
<a id="L766" name="L766"></a> 766     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SHARED_QUEUE = 1 &lt;&lt; 31;       <em class="comment">// must be negative</em>
<a id="L767" name="L767"></a> 767 
<div class="comment">
      Queues supporting work-stealing as well as external task
      submission. See above for descriptions and algorithms.
      Performance on most platforms is very sensitive to placement of
      instances of both WorkQueues and their arrays -- we absolutely
      do not want multiple WorkQueue instances or multiple queue
      arrays sharing cache lines. The @Contended annotation alerts
      JVMs to try to keep instances apart.</div>
<a id="L777" name="L777"></a> 777     @sun.misc.<a href="../D/1850.html" title="Multiple defined in 3 places.">Contended</a>
<a id="L778" name="L778"></a> 778     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/8865.html" title="Multiple referred from 70 places.">WorkQueue</a> <em class="brace">{</em>
<a id="L779" name="L779"></a> 779 
<div class="comment">
          Capacity of work-stealing queue array upon initialization.
          Must be a power of two; at least 4, but should be larger to
          reduce or eliminate cacheline sharing among queues.
          Currently, it is much larger, as a partial workaround for
          the fact that JVMs often place arrays in locations that
          share GC bookkeeping (especially cardmarks) such that
          per-write accesses encounter serious memory contention.</div>
<a id="L789" name="L789"></a> 789         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> INITIAL_QUEUE_CAPACITY = 1 &lt;&lt; 13;
<a id="L790" name="L790"></a> 790 
<div class="comment">
          Maximum size for queue arrays. Must be a power of two less
          than or equal to 1 &lt;&lt; (31 - width of array entry) to ensure
          lack of wraparound of index calculations, but defined to a
          value a bit less than this to help users trap runaway
          programs before saturating systems.</div>
<a id="L798" name="L798"></a> 798         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAXIMUM_QUEUE_CAPACITY = 1 &lt;&lt; 26; <em class="comment">// 64M</em>
<a id="L799" name="L799"></a> 799 
<a id="L800" name="L800"></a> 800         <em class="comment">// Instance fields</em>
<a id="L801" name="L801"></a> 801         <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> scanState;    <em class="comment">// versioned, &lt;0: inactive; odd:scanning</em>
<a id="L802" name="L802"></a> 802         <strong class="reserved">int</strong> stackPred;             <em class="comment">// pool stack (ctl) predecessor</em>
<a id="L803" name="L803"></a> 803         <strong class="reserved">int</strong> nsteals;               <em class="comment">// number of steals</em>
<a id="L804" name="L804"></a> 804         <strong class="reserved">int</strong> hint;                  <em class="comment">// randomization and stealer index hint</em>
<a id="L805" name="L805"></a> 805         <strong class="reserved">int</strong> <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a>;                <em class="comment">// pool index and mode</em>
<a id="L806" name="L806"></a> 806         <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> qlock;        <em class="comment">// 1: locked, &lt; 0: terminate; else 0</em>
<a id="L807" name="L807"></a> 807         <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> base;         <em class="comment">// index of next slot for poll</em>
<a id="L808" name="L808"></a> 808         <strong class="reserved">int</strong> <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>;                   <em class="comment">// index of next slot for push</em>
<a id="L809" name="L809"></a> 809         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>;   <em class="comment">// the elements (initially unallocated)</em>
<a id="L810" name="L810"></a> 810         <strong class="reserved">final</strong> <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> pool;   <em class="comment">// the containing pool (may be null)</em>
<a id="L811" name="L811"></a> 811         <strong class="reserved">final</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> <a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a>; <em class="comment">// owning thread or null if shared</em>
<a id="L812" name="L812"></a> 812         <strong class="reserved">volatile</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> parker;    <em class="comment">// == owner during call to park; else null</em>
<a id="L813" name="L813"></a> 813         <strong class="reserved">volatile</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; currentJoin;  <em class="comment">// task being joined in awaitJoin</em>
<a id="L814" name="L814"></a> 814         <strong class="reserved">volatile</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; currentSteal; <em class="comment">// mainly used by helpStealer</em>
<a id="L815" name="L815"></a> 815 
<a id="L816" name="L816"></a> 816         WorkQueue(<a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> pool, <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> <a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a>) <em class="brace">{</em>
<a id="L817" name="L817"></a> 817             <strong class="reserved">this</strong>.pool = pool;
<a id="L818" name="L818"></a> 818             <strong class="reserved">this</strong>.<a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a> = <a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a>;
<a id="L819" name="L819"></a> 819             <em class="comment">// Place indices in the center of array (that is not yet allocated)</em>
<a id="L820" name="L820"></a> 820             base = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> = INITIAL_QUEUE_CAPACITY &gt;&gt;&gt; 1;
<a id="L821" name="L821"></a> 821         <em class="brace">}</em>
<a id="L822" name="L822"></a> 822 
<div class="comment">
          Returns an exportable index (used by ForkJoinWorkerThread).</div>
<a id="L826" name="L826"></a> 826         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/1113.html#L121" title="Referred from 121 in src/java/util/concurrent/ForkJoinWorkerThread.java.">getPoolIndex</a>() <em class="brace">{</em>
<a id="L827" name="L827"></a> 827             <strong class="reserved">return</strong> (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; 0xffff) &gt;&gt;&gt; 1; <em class="comment">// ignore odd/even tag bit</em>
<a id="L828" name="L828"></a> 828         <em class="brace">}</em>
<a id="L829" name="L829"></a> 829 
<div class="comment">
          Returns the approximate number of tasks in the queue.</div>
<a id="L833" name="L833"></a> 833         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/25378.html" title="Multiple referred from 22 places.">queueSize</a>() <em class="brace">{</em>
<a id="L834" name="L834"></a> 834             <strong class="reserved">int</strong> n = base - <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>;       <em class="comment">// non-owner callers must read base first</em>
<a id="L835" name="L835"></a> 835             <strong class="reserved">return</strong> (n &gt;= 0) ? 0 : -n; <em class="comment">// ignore transient negative</em>
<a id="L836" name="L836"></a> 836         <em class="brace">}</em>
<a id="L837" name="L837"></a> 837 
<div class="comment">
          Provides a more accurate estimate of whether this queue has
          any tasks than does queueSize, by checking whether a
          near-empty queue has at least one unclaimed task.</div>
<a id="L843" name="L843"></a> 843         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21404.html" title="Multiple referred from 435 places.">isEmpty</a>() <em class="brace">{</em>
<a id="L844" name="L844"></a> 844             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> n, m, s;
<a id="L845" name="L845"></a> 845             <strong class="reserved">return</strong> ((n = base - (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>)) &gt;= 0 ||
<a id="L846" name="L846"></a> 846                     (n == -1 &amp;&amp;           <em class="comment">// possibly one task</em>
<a id="L847" name="L847"></a> 847                      ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) == <strong class="reserved">null</strong> || (m = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt; 0 ||
<a id="L848" name="L848"></a> 848                       U.<a href="../D/21124.html" title="Multiple defined in 30 places.">getObject</a>
<a id="L849" name="L849"></a> 849                       (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, (<strong class="reserved">long</strong>)((m &amp; (s - 1)) &lt;&lt; ASHIFT) + ABASE) == <strong class="reserved">null</strong>)));
<a id="L850" name="L850"></a> 850         <em class="brace">}</em>
<a id="L851" name="L851"></a> 851 
<div class="comment">
          Pushes a task. Call only by owner in unshared queues.  (The
          shared-queue version is embedded in method externalPush.)
          @param task the task. Caller must ensure non-null.
          @throws RejectedExecutionException if array cannot be resized</div>
<a id="L859" name="L859"></a> 859         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/25256.html" title="Multiple referred from 281 places.">push</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L860" name="L860"></a> 860             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> p;
<a id="L861" name="L861"></a> 861             <strong class="reserved">int</strong> b = base, s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>, n;
<a id="L862" name="L862"></a> 862             <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>    <em class="comment">// ignore if queue removed</em>
<a id="L863" name="L863"></a> 863                 <strong class="reserved">int</strong> m = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1;     <em class="comment">// fenced write for task visibility</em>
<a id="L864" name="L864"></a> 864                 U.putOrderedObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, ((m &amp; s) &lt;&lt; ASHIFT) + ABASE, task);
<a id="L865" name="L865"></a> 865                 U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s + 1);
<a id="L866" name="L866"></a> 866                 <strong class="reserved">if</strong> ((n = s - b) &lt;= 1) <em class="brace">{</em>
<a id="L867" name="L867"></a> 867                     <strong class="reserved">if</strong> ((p = pool) != <strong class="reserved">null</strong>)
<a id="L868" name="L868"></a> 868                         p.<a href="../S/1063.html#L1629" title="Defined at 1629 in src/java/util/concurrent/ForkJoinPool.java.">signalWork</a>(p.workQueues, <strong class="reserved">this</strong>);
<a id="L869" name="L869"></a> 869                 <em class="brace">}</em>
<a id="L870" name="L870"></a> 870                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (n &gt;= m)
<a id="L871" name="L871"></a> 871                     <a href="../D/23922.html" title="Multiple defined in 2 places.">growArray</a>();
<a id="L872" name="L872"></a> 872             <em class="brace">}</em>
<a id="L873" name="L873"></a> 873         <em class="brace">}</em>
<a id="L874" name="L874"></a> 874 
<div class="comment">
          Initializes or doubles the capacity of array. Call either
          by owner or with lock held -- it is OK for base, but not
          top, to move while resizings are in progress.</div>
<a id="L880" name="L880"></a> 880         <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../R/20042.html" title="Multiple referred from 4 places.">growArray</a>() <em class="brace">{</em>
<a id="L881" name="L881"></a> 881             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] oldA = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>;
<a id="L882" name="L882"></a> 882             <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = oldA != <strong class="reserved">null</strong> ? oldA.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt;&lt; 1 : INITIAL_QUEUE_CAPACITY;
<a id="L883" name="L883"></a> 883             <strong class="reserved">if</strong> (<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> &gt; MAXIMUM_QUEUE_CAPACITY)
<a id="L884" name="L884"></a> 884                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1055.html#L45" title="Defined at 45 in src/java/util/concurrent/RejectedExecutionException.java.">RejectedExecutionException</a>("Queue capacity exceeded");
<a id="L885" name="L885"></a> 885             <strong class="reserved">int</strong> oldMask, t, b;
<a id="L886" name="L886"></a> 886             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a> = <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>];
<a id="L887" name="L887"></a> 887             <strong class="reserved">if</strong> (oldA != <strong class="reserved">null</strong> &amp;&amp; (oldMask = oldA.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0 &amp;&amp;
<a id="L888" name="L888"></a> 888                 (t = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) - (b = base) &gt; 0) <em class="brace">{</em>
<a id="L889" name="L889"></a> 889                 <strong class="reserved">int</strong> <a href="../S/915.html#L394" title="Defined at 394 in src/java/util/stream/StreamOpFlag.java.">mask</a> = <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> - 1;
<a id="L890" name="L890"></a> 890                 <strong class="reserved">do</strong> <em class="brace">{</em> <em class="comment">// emulate poll from old array, push to new array</em>
<a id="L891" name="L891"></a> 891                     <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>;
<a id="L892" name="L892"></a> 892                     <strong class="reserved">int</strong> oldj = ((b &amp; oldMask) &lt;&lt; ASHIFT) + ABASE;
<a id="L893" name="L893"></a> 893                     <strong class="reserved">int</strong> j    = ((b &amp;    <a href="../S/915.html#L394" title="Defined at 394 in src/java/util/stream/StreamOpFlag.java.">mask</a>) &lt;&lt; ASHIFT) + ABASE;
<a id="L894" name="L894"></a> 894                     <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.getObjectVolatile(oldA, oldj);
<a id="L895" name="L895"></a> 895                     <strong class="reserved">if</strong> (<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> != <strong class="reserved">null</strong> &amp;&amp;
<a id="L896" name="L896"></a> 896                         U.compareAndSwapObject(oldA, oldj, <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>, <strong class="reserved">null</strong>))
<a id="L897" name="L897"></a> 897                         U.putObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>);
<a id="L898" name="L898"></a> 898                 <em class="brace">}</em> <strong class="reserved">while</strong> (++b != t);
<a id="L899" name="L899"></a> 899             <em class="brace">}</em>
<a id="L900" name="L900"></a> 900             <strong class="reserved">return</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L901" name="L901"></a> 901         <em class="brace">}</em>
<a id="L902" name="L902"></a> 902 
<div class="comment">
          Takes next task, if one exists, in LIFO order.  Call only
          by owner in unshared queues.</div>
<a id="L907" name="L907"></a> 907         <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/24804.html" title="Multiple referred from 176 places.">pop</a>() <em class="brace">{</em>
<a id="L908" name="L908"></a> 908             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t; <strong class="reserved">int</strong> m;
<a id="L909" name="L909"></a> 909             <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong> &amp;&amp; (m = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0) <em class="brace">{</em>
<a id="L910" name="L910"></a> 910                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> s; (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> - 1) - base &gt;= 0;) <em class="brace">{</em>
<a id="L911" name="L911"></a> 911                     <strong class="reserved">long</strong> j = ((m &amp; s) &lt;&lt; ASHIFT) + ABASE;
<a id="L912" name="L912"></a> 912                     <strong class="reserved">if</strong> ((t = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.<a href="../D/21124.html" title="Multiple defined in 30 places.">getObject</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j)) == <strong class="reserved">null</strong>)
<a id="L913" name="L913"></a> 913                         <strong class="reserved">break</strong>;
<a id="L914" name="L914"></a> 914                     <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L915" name="L915"></a> 915                         U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s);
<a id="L916" name="L916"></a> 916                         <strong class="reserved">return</strong> t;
<a id="L917" name="L917"></a> 917                     <em class="brace">}</em>
<a id="L918" name="L918"></a> 918                 <em class="brace">}</em>
<a id="L919" name="L919"></a> 919             <em class="brace">}</em>
<a id="L920" name="L920"></a> 920             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L921" name="L921"></a> 921         <em class="brace">}</em>
<a id="L922" name="L922"></a> 922 
<div class="comment">
          Takes a task in FIFO order if b is base of queue and a task
          can be claimed without contention. Specialized versions
          appear in ForkJoinPool methods scan and helpStealer.</div>
<a id="L928" name="L928"></a> 928         <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/24798.html" title="Multiple referred from 3 places.">pollAt</a>(<strong class="reserved">int</strong> b) <em class="brace">{</em>
<a id="L929" name="L929"></a> 929             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L930" name="L930"></a> 930             <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L931" name="L931"></a> 931                 <strong class="reserved">int</strong> j = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; b) &lt;&lt; ASHIFT) + ABASE;
<a id="L932" name="L932"></a> 932                 <strong class="reserved">if</strong> ((t = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j)) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L933" name="L933"></a> 933                     base == b &amp;&amp; U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L934" name="L934"></a> 934                     base = b + 1;
<a id="L935" name="L935"></a> 935                     <strong class="reserved">return</strong> t;
<a id="L936" name="L936"></a> 936                 <em class="brace">}</em>
<a id="L937" name="L937"></a> 937             <em class="brace">}</em>
<a id="L938" name="L938"></a> 938             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L939" name="L939"></a> 939         <em class="brace">}</em>
<a id="L940" name="L940"></a> 940 
<div class="comment">
          Takes next task, if one exists, in FIFO order.</div>
<a id="L944" name="L944"></a> 944         <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/24795.html" title="Multiple referred from 51 places.">poll</a>() <em class="brace">{</em>
<a id="L945" name="L945"></a> 945             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> b; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;
<a id="L946" name="L946"></a> 946             <strong class="reserved">while</strong> ((b = base) - <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &lt; 0 &amp;&amp; (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L947" name="L947"></a> 947                 <strong class="reserved">int</strong> j = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; b) &lt;&lt; ASHIFT) + ABASE;
<a id="L948" name="L948"></a> 948                 t = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j);
<a id="L949" name="L949"></a> 949                 <strong class="reserved">if</strong> (base == b) <em class="brace">{</em>
<a id="L950" name="L950"></a> 950                     <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L951" name="L951"></a> 951                         <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L952" name="L952"></a> 952                             base = b + 1;
<a id="L953" name="L953"></a> 953                             <strong class="reserved">return</strong> t;
<a id="L954" name="L954"></a> 954                         <em class="brace">}</em>
<a id="L955" name="L955"></a> 955                     <em class="brace">}</em>
<a id="L956" name="L956"></a> 956                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (b + 1 == <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) <em class="comment">// now empty</em>
<a id="L957" name="L957"></a> 957                         <strong class="reserved">break</strong>;
<a id="L958" name="L958"></a> 958                 <em class="brace">}</em>
<a id="L959" name="L959"></a> 959             <em class="brace">}</em>
<a id="L960" name="L960"></a> 960             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L961" name="L961"></a> 961         <em class="brace">}</em>
<a id="L962" name="L962"></a> 962 
<div class="comment">
          Takes next task, if one exists, in order specified by mode.</div>
<a id="L966" name="L966"></a> 966         <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/23677.html" title="Multiple referred from 2 places.">nextLocalTask</a>() <em class="brace">{</em>
<a id="L967" name="L967"></a> 967             <strong class="reserved">return</strong> (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; FIFO_QUEUE) == 0 ? <a href="../D/29416.html" title="Multiple defined in 30 places.">pop</a>() : <a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>();
<a id="L968" name="L968"></a> 968         <em class="brace">}</em>
<a id="L969" name="L969"></a> 969 
<div class="comment">
          Returns next task, if one exists, in order specified by mode.</div>
<a id="L973" name="L973"></a> 973         <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/24689.html" title="Multiple referred from 168 places.">peek</a>() <em class="brace">{</em>
<a id="L974" name="L974"></a> 974             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>; <strong class="reserved">int</strong> m;
<a id="L975" name="L975"></a> 975             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> == <strong class="reserved">null</strong> || (m = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt; 0)
<a id="L976" name="L976"></a> 976                 <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L977" name="L977"></a> 977             <strong class="reserved">int</strong> i = (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; FIFO_QUEUE) == 0 ? <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> - 1 : base;
<a id="L978" name="L978"></a> 978             <strong class="reserved">int</strong> j = ((i &amp; m) &lt;&lt; ASHIFT) + ABASE;
<a id="L979" name="L979"></a> 979             <strong class="reserved">return</strong> (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j);
<a id="L980" name="L980"></a> 980         <em class="brace">}</em>
<a id="L981" name="L981"></a> 981 
<div class="comment">
          Pops the given task only if it is at the current top.
          (A shared version is available only via FJP.tryExternalUnpush)</div>
<a id="L986" name="L986"></a> 986         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29566.html" title="Multiple referred from 2 places.">tryUnpush</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t) <em class="brace">{</em>
<a id="L987" name="L987"></a> 987             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> s;
<a id="L988" name="L988"></a> 988             <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong> &amp;&amp; (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) != base &amp;&amp;
<a id="L989" name="L989"></a> 989                 U.compareAndSwapObject
<a id="L990" name="L990"></a> 990                 (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; --s) &lt;&lt; ASHIFT) + ABASE, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L991" name="L991"></a> 991                 U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s);
<a id="L992" name="L992"></a> 992                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L993" name="L993"></a> 993             <em class="brace">}</em>
<a id="L994" name="L994"></a> 994             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L995" name="L995"></a> 995         <em class="brace">}</em>
<a id="L996" name="L996"></a> 996 
<div class="comment">
          Removes and cancels all known tasks, ignoring any exceptions.</div>
<a id="L1000" name="L1000"></a>1000         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10920.html" title="Multiple referred from 2 places.">cancelAll</a>() <em class="brace">{</em>
<a id="L1001" name="L1001"></a>1001             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;
<a id="L1002" name="L1002"></a>1002             <strong class="reserved">if</strong> ((t = currentJoin) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1003" name="L1003"></a>1003                 currentJoin = <strong class="reserved">null</strong>;
<a id="L1004" name="L1004"></a>1004                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L509" title="Defined at 509 in src/java/util/concurrent/ForkJoinTask.java.">cancelIgnoringExceptions</a>(t);
<a id="L1005" name="L1005"></a>1005             <em class="brace">}</em>
<a id="L1006" name="L1006"></a>1006             <strong class="reserved">if</strong> ((t = currentSteal) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1007" name="L1007"></a>1007                 currentSteal = <strong class="reserved">null</strong>;
<a id="L1008" name="L1008"></a>1008                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L509" title="Defined at 509 in src/java/util/concurrent/ForkJoinTask.java.">cancelIgnoringExceptions</a>(t);
<a id="L1009" name="L1009"></a>1009             <em class="brace">}</em>
<a id="L1010" name="L1010"></a>1010             <strong class="reserved">while</strong> ((t = <a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>()) != <strong class="reserved">null</strong>)
<a id="L1011" name="L1011"></a>1011                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L509" title="Defined at 509 in src/java/util/concurrent/ForkJoinTask.java.">cancelIgnoringExceptions</a>(t);
<a id="L1012" name="L1012"></a>1012         <em class="brace">}</em>
<a id="L1013" name="L1013"></a>1013 
<a id="L1014" name="L1014"></a>1014         <em class="comment">// Specialized execution methods</em>
<a id="L1015" name="L1015"></a>1015 
<div class="comment">
          Polls and runs tasks until empty.</div>
<a id="L1019" name="L1019"></a>1019         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../S/1063.html#L1046" title="Referred from 1046 in src/java/util/concurrent/ForkJoinPool.java.">pollAndExecAll</a>() <em class="brace">{</em>
<a id="L1020" name="L1020"></a>1020             <strong class="reserved">for</strong> (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t; (t = <a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>()) != <strong class="reserved">null</strong>;)
<a id="L1021" name="L1021"></a>1021                 t.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L1022" name="L1022"></a>1022         <em class="brace">}</em>
<a id="L1023" name="L1023"></a>1023 
<div class="comment">
          Removes and executes all local tasks. If LIFO, invokes
          pollAndExecAll. Otherwise implements a specialized pop loop
          to exec until empty.</div>
<a id="L1029" name="L1029"></a>1029         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14092.html" title="Multiple referred from 2 places.">execLocalTasks</a>() <em class="brace">{</em>
<a id="L1030" name="L1030"></a>1030             <strong class="reserved">int</strong> b = base, m, s;
<a id="L1031" name="L1031"></a>1031             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>;
<a id="L1032" name="L1032"></a>1032             <strong class="reserved">if</strong> (b - (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> - 1) &lt;= 0 &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1033" name="L1033"></a>1033                 (m = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0) <em class="brace">{</em>
<a id="L1034" name="L1034"></a>1034                 <strong class="reserved">if</strong> ((<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; FIFO_QUEUE) == 0) <em class="brace">{</em>
<a id="L1035" name="L1035"></a>1035                     <strong class="reserved">for</strong> (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;;) <em class="brace">{</em>
<a id="L1036" name="L1036"></a>1036                         <strong class="reserved">if</strong> ((t = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.getAndSetObject
<a id="L1037" name="L1037"></a>1037                              (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, ((m &amp; s) &lt;&lt; ASHIFT) + ABASE, <strong class="reserved">null</strong>)) == <strong class="reserved">null</strong>)
<a id="L1038" name="L1038"></a>1038                             <strong class="reserved">break</strong>;
<a id="L1039" name="L1039"></a>1039                         U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s);
<a id="L1040" name="L1040"></a>1040                         t.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L1041" name="L1041"></a>1041                         <strong class="reserved">if</strong> (base - (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> - 1) &gt; 0)
<a id="L1042" name="L1042"></a>1042                             <strong class="reserved">break</strong>;
<a id="L1043" name="L1043"></a>1043                     <em class="brace">}</em>
<a id="L1044" name="L1044"></a>1044                 <em class="brace">}</em>
<a id="L1045" name="L1045"></a>1045                 <strong class="reserved">else</strong>
<a id="L1046" name="L1046"></a>1046                     <a href="../S/1063.html#L1019" title="Defined at 1019 in src/java/util/concurrent/ForkJoinPool.java.">pollAndExecAll</a>();
<a id="L1047" name="L1047"></a>1047             <em class="brace">}</em>
<a id="L1048" name="L1048"></a>1048         <em class="brace">}</em>
<a id="L1049" name="L1049"></a>1049 
<div class="comment">
          Executes the given task and any remaining local tasks.</div>
<a id="L1053" name="L1053"></a>1053         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../S/1063.html#L1692" title="Referred from 1692 in src/java/util/concurrent/ForkJoinPool.java.">runTask</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L1054" name="L1054"></a>1054             <strong class="reserved">if</strong> (task != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1055" name="L1055"></a>1055                 scanState &amp;= ~SCANNING; <em class="comment">// mark as busy</em>
<a id="L1056" name="L1056"></a>1056                 (currentSteal = task).<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L1057" name="L1057"></a>1057                 U.putOrderedObject(<strong class="reserved">this</strong>, QCURRENTSTEAL, <strong class="reserved">null</strong>); <em class="comment">// release for GC</em>
<a id="L1058" name="L1058"></a>1058                 <a href="../S/1063.html#L1029" title="Defined at 1029 in src/java/util/concurrent/ForkJoinPool.java.">execLocalTasks</a>();
<a id="L1059" name="L1059"></a>1059                 <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> thread = <a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a>;
<a id="L1060" name="L1060"></a>1060                 <strong class="reserved">if</strong> (++nsteals &lt; 0)      <em class="comment">// collect on overflow</em>
<a id="L1061" name="L1061"></a>1061                     <a href="../S/1063.html#L1071" title="Defined at 1071 in src/java/util/concurrent/ForkJoinPool.java.">transferStealCount</a>(pool);
<a id="L1062" name="L1062"></a>1062                 scanState |= SCANNING;
<a id="L1063" name="L1063"></a>1063                 <strong class="reserved">if</strong> (thread != <strong class="reserved">null</strong>)
<a id="L1064" name="L1064"></a>1064                     thread.<a href="../D/11267.html" title="Multiple defined in 2 places.">afterTopLevelExec</a>();
<a id="L1065" name="L1065"></a>1065             <em class="brace">}</em>
<a id="L1066" name="L1066"></a>1066         <em class="brace">}</em>
<a id="L1067" name="L1067"></a>1067 
<div class="comment">
          Adds steal count to pool stealCounter if it exists, and resets.</div>
<a id="L1071" name="L1071"></a>1071         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/29424.html" title="Multiple referred from 3 places.">transferStealCount</a>(<a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> p) <em class="brace">{</em>
<a id="L1072" name="L1072"></a>1072             <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a> sc;
<a id="L1073" name="L1073"></a>1073             <strong class="reserved">if</strong> (p != <strong class="reserved">null</strong> &amp;&amp; (sc = p.stealCounter) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1074" name="L1074"></a>1074                 <strong class="reserved">int</strong> s = nsteals;
<a id="L1075" name="L1075"></a>1075                 nsteals = 0;            <em class="comment">// if negative, correct for overflow</em>
<a id="L1076" name="L1076"></a>1076                 sc.<a href="../D/16937.html" title="Multiple defined in 8 places.">getAndAdd</a>((<strong class="reserved">long</strong>)(s &lt; 0 ? <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE : s));
<a id="L1077" name="L1077"></a>1077             <em class="brace">}</em>
<a id="L1078" name="L1078"></a>1078         <em class="brace">}</em>
<a id="L1079" name="L1079"></a>1079 
<div class="comment">
          If present, removes from queue and executes the given task,
          or any other cancelled task. Used only by awaitJoin.
          @return true if queue empty and task not known to be done</div>
<a id="L1086" name="L1086"></a>1086         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1063.html#L2046" title="Referred from 2046 in src/java/util/concurrent/ForkJoinPool.java.">tryRemoveAndExec</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L1087" name="L1087"></a>1087             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> m, s, b, n;
<a id="L1088" name="L1088"></a>1088             <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong> &amp;&amp; (m = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0 &amp;&amp;
<a id="L1089" name="L1089"></a>1089                 task != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1090" name="L1090"></a>1090                 <strong class="reserved">while</strong> ((n = (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) - (b = base)) &gt; 0) <em class="brace">{</em>
<a id="L1091" name="L1091"></a>1091                     <strong class="reserved">for</strong> (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;;) <em class="brace">{</em>      <em class="comment">// traverse from s to b</em>
<a id="L1092" name="L1092"></a>1092                         <strong class="reserved">long</strong> j = ((--s &amp; m) &lt;&lt; ASHIFT) + ABASE;
<a id="L1093" name="L1093"></a>1093                         <strong class="reserved">if</strong> ((t = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)U.<a href="../D/21124.html" title="Multiple defined in 30 places.">getObject</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j)) == <strong class="reserved">null</strong>)
<a id="L1094" name="L1094"></a>1094                             <strong class="reserved">return</strong> s + 1 == <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>;     <em class="comment">// shorter than expected</em>
<a id="L1095" name="L1095"></a>1095                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (t == task) <em class="brace">{</em>
<a id="L1096" name="L1096"></a>1096                             <strong class="reserved">boolean</strong> removed = <strong class="reserved">false</strong>;
<a id="L1097" name="L1097"></a>1097                             <strong class="reserved">if</strong> (s + 1 == <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) <em class="brace">{</em>      <em class="comment">// pop</em>
<a id="L1098" name="L1098"></a>1098                                 <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, task, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1099" name="L1099"></a>1099                                     U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s);
<a id="L1100" name="L1100"></a>1100                                     removed = <strong class="reserved">true</strong>;
<a id="L1101" name="L1101"></a>1101                                 <em class="brace">}</em>
<a id="L1102" name="L1102"></a>1102                             <em class="brace">}</em>
<a id="L1103" name="L1103"></a>1103                             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (base == b)      <em class="comment">// replace with proxy</em>
<a id="L1104" name="L1104"></a>1104                                 removed = U.compareAndSwapObject(
<a id="L1105" name="L1105"></a>1105                                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, task, <strong class="reserved">new</strong> <a href="../S/1063.html#L741" title="Defined at 741 in src/java/util/concurrent/ForkJoinPool.java.">EmptyTask</a>());
<a id="L1106" name="L1106"></a>1106                             <strong class="reserved">if</strong> (removed)
<a id="L1107" name="L1107"></a>1107                                 task.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L1108" name="L1108"></a>1108                             <strong class="reserved">break</strong>;
<a id="L1109" name="L1109"></a>1109                         <em class="brace">}</em>
<a id="L1110" name="L1110"></a>1110                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (t.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt; 0 &amp;&amp; s + 1 == <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) <em class="brace">{</em>
<a id="L1111" name="L1111"></a>1111                             <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>))
<a id="L1112" name="L1112"></a>1112                                 U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s);
<a id="L1113" name="L1113"></a>1113                             <strong class="reserved">break</strong>;                  <em class="comment">// was cancelled</em>
<a id="L1114" name="L1114"></a>1114                         <em class="brace">}</em>
<a id="L1115" name="L1115"></a>1115                         <strong class="reserved">if</strong> (--n == 0)
<a id="L1116" name="L1116"></a>1116                             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1117" name="L1117"></a>1117                     <em class="brace">}</em>
<a id="L1118" name="L1118"></a>1118                     <strong class="reserved">if</strong> (task.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt; 0)
<a id="L1119" name="L1119"></a>1119                         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1120" name="L1120"></a>1120                 <em class="brace">}</em>
<a id="L1121" name="L1121"></a>1121             <em class="brace">}</em>
<a id="L1122" name="L1122"></a>1122             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1123" name="L1123"></a>1123         <em class="brace">}</em>
<a id="L1124" name="L1124"></a>1124 
<div class="comment">
          Pops task if in the same CC computation as the given task,
          in either shared or owned mode. Used only by helpComplete.</div>
<a id="L1129" name="L1129"></a>1129         <strong class="reserved">final</strong> <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; <a href="../S/1063.html#L1869" title="Referred from 1869 in src/java/util/concurrent/ForkJoinPool.java.">popCC</a>(<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; task, <strong class="reserved">int</strong> mode) <em class="brace">{</em>
<a id="L1130" name="L1130"></a>1130             <strong class="reserved">int</strong> s; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L1131" name="L1131"></a>1131             <strong class="reserved">if</strong> (base - (s = <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) &lt; 0 &amp;&amp; (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1132" name="L1132"></a>1132                 <strong class="reserved">long</strong> j = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; (s - 1)) &lt;&lt; ASHIFT) + ABASE;
<a id="L1133" name="L1133"></a>1133                 <strong class="reserved">if</strong> ((<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j)) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1134" name="L1134"></a>1134                     (<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> <strong class="reserved">instanceof</strong> <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>)) <em class="brace">{</em>
<a id="L1135" name="L1135"></a>1135                     <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; t = (<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt;)<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L1136" name="L1136"></a>1136                     <strong class="reserved">for</strong> (<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; r = t;;) <em class="brace">{</em>
<a id="L1137" name="L1137"></a>1137                         <strong class="reserved">if</strong> (r == task) <em class="brace">{</em>
<a id="L1138" name="L1138"></a>1138                             <strong class="reserved">if</strong> (mode &lt; 0) <em class="brace">{</em> <em class="comment">// must lock</em>
<a id="L1139" name="L1139"></a>1139                                 <strong class="reserved">if</strong> (U.compareAndSwapInt(<strong class="reserved">this</strong>, QLOCK, 0, 1)) <em class="brace">{</em>
<a id="L1140" name="L1140"></a>1140                                     <strong class="reserved">if</strong> (<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> == s &amp;&amp; <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a> == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &amp;&amp;
<a id="L1141" name="L1141"></a>1141                                         U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1142" name="L1142"></a>1142                                         U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s - 1);
<a id="L1143" name="L1143"></a>1143                                         U.putOrderedInt(<strong class="reserved">this</strong>, QLOCK, 0);
<a id="L1144" name="L1144"></a>1144                                         <strong class="reserved">return</strong> t;
<a id="L1145" name="L1145"></a>1145                                     <em class="brace">}</em>
<a id="L1146" name="L1146"></a>1146                                     U.compareAndSwapInt(<strong class="reserved">this</strong>, QLOCK, 1, 0);
<a id="L1147" name="L1147"></a>1147                                 <em class="brace">}</em>
<a id="L1148" name="L1148"></a>1148                             <em class="brace">}</em>
<a id="L1149" name="L1149"></a>1149                             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1150" name="L1150"></a>1150                                 U.putOrderedInt(<strong class="reserved">this</strong>, QTOP, s - 1);
<a id="L1151" name="L1151"></a>1151                                 <strong class="reserved">return</strong> t;
<a id="L1152" name="L1152"></a>1152                             <em class="brace">}</em>
<a id="L1153" name="L1153"></a>1153                             <strong class="reserved">break</strong>;
<a id="L1154" name="L1154"></a>1154                         <em class="brace">}</em>
<a id="L1155" name="L1155"></a>1155                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((r = r.completer) == <strong class="reserved">null</strong>) <em class="comment">// try parent</em>
<a id="L1156" name="L1156"></a>1156                             <strong class="reserved">break</strong>;
<a id="L1157" name="L1157"></a>1157                     <em class="brace">}</em>
<a id="L1158" name="L1158"></a>1158                 <em class="brace">}</em>
<a id="L1159" name="L1159"></a>1159             <em class="brace">}</em>
<a id="L1160" name="L1160"></a>1160             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L1161" name="L1161"></a>1161         <em class="brace">}</em>
<a id="L1162" name="L1162"></a>1162 
<div class="comment">
          Steals and runs a task in the same CC computation as the
          given task if one exists and can be taken without
          contention. Otherwise returns a checksum/control value for
          use by method helpComplete.
          @return 1 if successful, 2 if retryable (lost to another
          stealer), -1 if non-empty but no matching task found, else
          the base index, forced negative.</div>
<a id="L1173" name="L1173"></a>1173         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/1063.html#L1879" title="Referred from 1879 in src/java/util/concurrent/ForkJoinPool.java.">pollAndExecCC</a>(<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L1174" name="L1174"></a>1174             <strong class="reserved">int</strong> b, h; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L1175" name="L1175"></a>1175             <strong class="reserved">if</strong> ((b = base) - <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &gt;= 0 || (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) == <strong class="reserved">null</strong>)
<a id="L1176" name="L1176"></a>1176                 h = b | <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MIN_VALUE;  <em class="comment">// to sense movement on re-poll</em>
<a id="L1177" name="L1177"></a>1177             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1178" name="L1178"></a>1178                 <strong class="reserved">long</strong> j = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; b) &lt;&lt; ASHIFT) + ABASE;
<a id="L1179" name="L1179"></a>1179                 <strong class="reserved">if</strong> ((<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j)) == <strong class="reserved">null</strong>)
<a id="L1180" name="L1180"></a>1180                     h = 2;                  <em class="comment">// retryable</em>
<a id="L1181" name="L1181"></a>1181                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!(<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> <strong class="reserved">instanceof</strong> <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>))
<a id="L1182" name="L1182"></a>1182                     h = -1;                 <em class="comment">// unmatchable</em>
<a id="L1183" name="L1183"></a>1183                 <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1184" name="L1184"></a>1184                     <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; t = (<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt;)<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L1185" name="L1185"></a>1185                     <strong class="reserved">for</strong> (<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; r = t;;) <em class="brace">{</em>
<a id="L1186" name="L1186"></a>1186                         <strong class="reserved">if</strong> (r == task) <em class="brace">{</em>
<a id="L1187" name="L1187"></a>1187                             <strong class="reserved">if</strong> (base == b &amp;&amp;
<a id="L1188" name="L1188"></a>1188                                 U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1189" name="L1189"></a>1189                                 base = b + 1;
<a id="L1190" name="L1190"></a>1190                                 t.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L1191" name="L1191"></a>1191                                 h = 1;      <em class="comment">// success</em>
<a id="L1192" name="L1192"></a>1192                             <em class="brace">}</em>
<a id="L1193" name="L1193"></a>1193                             <strong class="reserved">else</strong>
<a id="L1194" name="L1194"></a>1194                                 h = 2;      <em class="comment">// lost CAS</em>
<a id="L1195" name="L1195"></a>1195                             <strong class="reserved">break</strong>;
<a id="L1196" name="L1196"></a>1196                         <em class="brace">}</em>
<a id="L1197" name="L1197"></a>1197                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((r = r.completer) == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1198" name="L1198"></a>1198                             h = -1;         <em class="comment">// unmatched</em>
<a id="L1199" name="L1199"></a>1199                             <strong class="reserved">break</strong>;
<a id="L1200" name="L1200"></a>1200                         <em class="brace">}</em>
<a id="L1201" name="L1201"></a>1201                     <em class="brace">}</em>
<a id="L1202" name="L1202"></a>1202                 <em class="brace">}</em>
<a id="L1203" name="L1203"></a>1203             <em class="brace">}</em>
<a id="L1204" name="L1204"></a>1204             <strong class="reserved">return</strong> h;
<a id="L1205" name="L1205"></a>1205         <em class="brace">}</em>
<a id="L1206" name="L1206"></a>1206 
<div class="comment">
          Returns true if owned and not known to be blocked.</div>
<a id="L1210" name="L1210"></a>1210         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21170.html" title="Multiple referred from 2 places.">isApparentlyUnblocked</a>() <em class="brace">{</em>
<a id="L1211" name="L1211"></a>1211             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> wt; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../D/8356.html" title="Multiple defined in 12 places.">State</a> s;
<a id="L1212" name="L1212"></a>1212             <strong class="reserved">return</strong> (scanState &gt;= 0 &amp;&amp;
<a id="L1213" name="L1213"></a>1213                     (wt = <a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1214" name="L1214"></a>1214                     (s = wt.<a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>()) != <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../D/8356.html" title="Multiple defined in 12 places.">State</a>.BLOCKED &amp;&amp;
<a id="L1215" name="L1215"></a>1215                     s != <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../D/8356.html" title="Multiple defined in 12 places.">State</a>.WAITING &amp;&amp;
<a id="L1216" name="L1216"></a>1216                     s != <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../D/8356.html" title="Multiple defined in 12 places.">State</a>.TIMED_WAITING);
<a id="L1217" name="L1217"></a>1217         <em class="brace">}</em>
<a id="L1218" name="L1218"></a>1218 
<a id="L1219" name="L1219"></a>1219         <em class="comment">// Unsafe mechanics. Note that some are (and must be) the same as in FJP</em>
<a id="L1220" name="L1220"></a>1220         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> sun.misc.Unsafe U;
<a id="L1221" name="L1221"></a>1221         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  ABASE;
<a id="L1222" name="L1222"></a>1222         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  ASHIFT;
<a id="L1223" name="L1223"></a>1223         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QTOP;
<a id="L1224" name="L1224"></a>1224         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QLOCK;
<a id="L1225" name="L1225"></a>1225         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QCURRENTSTEAL;
<a id="L1226" name="L1226"></a>1226         <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L1227" name="L1227"></a>1227             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1228" name="L1228"></a>1228                 U = sun.misc.Unsafe.getUnsafe();
<a id="L1229" name="L1229"></a>1229                 <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; wk = <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>.<strong class="reserved">class</strong>;
<a id="L1230" name="L1230"></a>1230                 <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; ak = <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>[].<strong class="reserved">class</strong>;
<a id="L1231" name="L1231"></a>1231                 QTOP = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1232" name="L1232"></a>1232                     (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("top"));
<a id="L1233" name="L1233"></a>1233                 QLOCK = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1234" name="L1234"></a>1234                     (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("qlock"));
<a id="L1235" name="L1235"></a>1235                 QCURRENTSTEAL = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1236" name="L1236"></a>1236                     (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("currentSteal"));
<a id="L1237" name="L1237"></a>1237                 ABASE = U.arrayBaseOffset(ak);
<a id="L1238" name="L1238"></a>1238                 <strong class="reserved">int</strong> <a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a> = U.arrayIndexScale(ak);
<a id="L1239" name="L1239"></a>1239                 <strong class="reserved">if</strong> ((<a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a> &amp; (<a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a> - 1)) != 0)
<a id="L1240" name="L1240"></a>1240                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>("data type scale not a power of two");
<a id="L1241" name="L1241"></a>1241                 ASHIFT = 31 - <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.<a href="../D/28378.html" title="Multiple defined in 2 places.">numberOfLeadingZeros</a>(<a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a>);
<a id="L1242" name="L1242"></a>1242             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L1243" name="L1243"></a>1243                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(e);
<a id="L1244" name="L1244"></a>1244             <em class="brace">}</em>
<a id="L1245" name="L1245"></a>1245         <em class="brace">}</em>
<a id="L1246" name="L1246"></a>1246     <em class="brace">}</em>
<a id="L1247" name="L1247"></a>1247 
<a id="L1248" name="L1248"></a>1248     <em class="comment">// static fields (initialized in static initializer below)</em>
<a id="L1249" name="L1249"></a>1249 
<div class="comment">
      Creates a new ForkJoinWorkerThread. This factory is used unless
      overridden in ForkJoinPool constructors.</div>
<a id="L1254" name="L1254"></a>1254     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a>
<a id="L1255" name="L1255"></a>1255         defaultForkJoinWorkerThreadFactory;
<a id="L1256" name="L1256"></a>1256 
<div class="comment">
      Permission required for callers of methods that may start or
      kill threads.</div>
<a id="L1261" name="L1261"></a>1261     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1764.html#L349" title="Defined at 349 in src/java/lang/RuntimePermission.java.">RuntimePermission</a> modifyThreadPermission;
<a id="L1262" name="L1262"></a>1262 
<div class="comment">
      Common (static) pool. Non-null for public use unless a static
      construction exception, but internal usages null-check on use
      to paranoically avoid potential initialization circularities
      as well as to simplify generated code.</div>
<a id="L1269" name="L1269"></a>1269     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> common;
<a id="L1270" name="L1270"></a>1270 
<div class="comment">
      Common pool parallelism. To allow simpler use and management
      when common pool threads are disabled, we allow the underlying
      common.parallelism field to be zero, but in that case still report
      parallelism as 1 to reflect resulting caller-runs mechanics.</div>
<a id="L1277" name="L1277"></a>1277     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> commonParallelism;
<a id="L1278" name="L1278"></a>1278 
<div class="comment">
      Limit on spare thread construction in tryCompensate.</div>
<a id="L1282" name="L1282"></a>1282     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> commonMaxSpares;
<a id="L1283" name="L1283"></a>1283 
<div class="comment">
      Sequence number for creating workerNamePrefix.</div>
<a id="L1287" name="L1287"></a>1287     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> poolNumberSequence;
<a id="L1288" name="L1288"></a>1288 
<div class="comment">
      Returns the next sequence number. We don't expect this to
      ever contend, so use simple builtin sync.</div>
<a id="L1293" name="L1293"></a>1293     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">int</strong> <a href="../S/1063.html#L2540" title="Referred from 2540 in src/java/util/concurrent/ForkJoinPool.java.">nextPoolId</a>() <em class="brace">{</em>
<a id="L1294" name="L1294"></a>1294         <strong class="reserved">return</strong> ++poolNumberSequence;
<a id="L1295" name="L1295"></a>1295     <em class="brace">}</em>
<a id="L1296" name="L1296"></a>1296 
<a id="L1297" name="L1297"></a>1297     <em class="comment">// static configuration constants</em>
<a id="L1298" name="L1298"></a>1298 
<div class="comment">
      Initial timeout value (in nanoseconds) for the thread
      triggering quiescence to park waiting for new work. On timeout,
      the thread will instead try to shrink the number of
      workers. The value should be large enough to avoid overly
      aggressive shrinkage during most transient stalls (long GCs
      etc).</div>
<a id="L1307" name="L1307"></a>1307     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> IDLE_TIMEOUT = 2000L * 1000L * 1000L; <em class="comment">// 2sec</em>
<a id="L1308" name="L1308"></a>1308 
<div class="comment">
      Tolerance for idle timeouts, to cope with timer undershoots</div>
<a id="L1312" name="L1312"></a>1312     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> TIMEOUT_SLOP = 20L * 1000L * 1000L;  <em class="comment">// 20ms</em>
<a id="L1313" name="L1313"></a>1313 
<div class="comment">
      The initial value for commonMaxSpares during static
      initialization. The value is far in excess of normal
      requirements, but also far short of MAX_CAP and typical
      OS thread limits, so allows JVMs to catch misuse/abuse
      before running out of resources needed to do so.</div>
<a id="L1321" name="L1321"></a>1321     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> DEFAULT_COMMON_MAX_SPARES = 256;
<a id="L1322" name="L1322"></a>1322 
<div class="comment">
      Number of times to spin-wait before blocking. The spins (in
      awaitRunStateLock and awaitWork) currently use randomized
      spins. Currently set to zero to reduce CPU usage.
      If greater than zero the value of SPINS must be a power
      of two, at least 4.  A value of 2048 causes spinning for a
      small fraction of typical context-switch times.
      If/when MWAIT-like intrinsics becomes available, they
      may allow quieter spinning.</div>
<a id="L1335" name="L1335"></a>1335     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SPINS  = 0;
<a id="L1336" name="L1336"></a>1336 
<div class="comment">
      Increment for seed generators. See class ThreadLocal for
      explanation.</div>
<a id="L1341" name="L1341"></a>1341     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SEED_INCREMENT = 0x9e3779b9;
<a id="L1342" name="L1342"></a>1342 
<div class="comment">
      Bits and masks for field ctl, packed with 4 16 bit subfields:
      AC: Number of active running workers minus target parallelism
      TC: Number of total workers minus target parallelism
      SS: version count and status of top waiting thread
      ID: poolIndex of top of Treiber stack of waiters
      When convenient, we can extract the lower 32 stack top bits
      (including version bits) as sp=(int)ctl.  The offsets of counts
      by the target parallelism and the positionings of fields makes
      it possible to perform the most common checks via sign tests of
      fields: When ac is negative, there are not enough active
      workers, when tc is negative, there are not enough total
      workers.  When sp is non-zero, there are waiting workers.  To
      deal with possibly negative fields, we use casts in and out of
      "short" and/or signed shifts to maintain signedness.
      Because it occupies uppermost bits, we can add one active count
      using getAndAddLong of AC_UNIT, rather than CAS, when returning
      from a blocked join.  Other updates entail multiple subfields
      and masking, requiring CAS.</div>
<a id="L1365" name="L1365"></a>1365 
<a id="L1366" name="L1366"></a>1366     <em class="comment">// Lower and upper word masks</em>
<a id="L1367" name="L1367"></a>1367     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> SP_MASK    = 0xffffffffL;
<a id="L1368" name="L1368"></a>1368     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> UC_MASK    = ~SP_MASK;
<a id="L1369" name="L1369"></a>1369 
<a id="L1370" name="L1370"></a>1370     <em class="comment">// Active counts</em>
<a id="L1371" name="L1371"></a>1371     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  AC_SHIFT   = 48;
<a id="L1372" name="L1372"></a>1372     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> AC_UNIT    = 0x0001L &lt;&lt; AC_SHIFT;
<a id="L1373" name="L1373"></a>1373     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> AC_MASK    = 0xffffL &lt;&lt; AC_SHIFT;
<a id="L1374" name="L1374"></a>1374 
<a id="L1375" name="L1375"></a>1375     <em class="comment">// Total counts</em>
<a id="L1376" name="L1376"></a>1376     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  TC_SHIFT   = 32;
<a id="L1377" name="L1377"></a>1377     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> TC_UNIT    = 0x0001L &lt;&lt; TC_SHIFT;
<a id="L1378" name="L1378"></a>1378     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> TC_MASK    = 0xffffL &lt;&lt; TC_SHIFT;
<a id="L1379" name="L1379"></a>1379     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> ADD_WORKER = 0x0001L &lt;&lt; (TC_SHIFT + 15); <em class="comment">// sign</em>
<a id="L1380" name="L1380"></a>1380 
<a id="L1381" name="L1381"></a>1381     <em class="comment">// runState bits: SHUTDOWN must be negative, others arbitrary powers of two</em>
<a id="L1382" name="L1382"></a>1382     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  RSLOCK     = 1;
<a id="L1383" name="L1383"></a>1383     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  RSIGNAL    = 1 &lt;&lt; 1;
<a id="L1384" name="L1384"></a>1384     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  STARTED    = 1 &lt;&lt; 2;
<a id="L1385" name="L1385"></a>1385     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  STOP       = 1 &lt;&lt; 29;
<a id="L1386" name="L1386"></a>1386     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  TERMINATED = 1 &lt;&lt; 30;
<a id="L1387" name="L1387"></a>1387     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  SHUTDOWN   = 1 &lt;&lt; 31;
<a id="L1388" name="L1388"></a>1388 
<a id="L1389" name="L1389"></a>1389     <em class="comment">// Instance fields</em>
<a id="L1390" name="L1390"></a>1390     <strong class="reserved">volatile</strong> <strong class="reserved">long</strong> ctl;                   <em class="comment">// main pool control</em>
<a id="L1391" name="L1391"></a>1391     <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> runState;               <em class="comment">// lockable status</em>
<a id="L1392" name="L1392"></a>1392     <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a>;                    <em class="comment">// parallelism, mode</em>
<a id="L1393" name="L1393"></a>1393     <strong class="reserved">int</strong> indexSeed;                       <em class="comment">// to generate worker index</em>
<a id="L1394" name="L1394"></a>1394     <strong class="reserved">volatile</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] workQueues;     <em class="comment">// main registry</em>
<a id="L1395" name="L1395"></a>1395     <strong class="reserved">final</strong> <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>;
<a id="L1396" name="L1396"></a>1396     <strong class="reserved">final</strong> <a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a> ueh;  <em class="comment">// per-worker UEH</em>
<a id="L1397" name="L1397"></a>1397     <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> workerNamePrefix;       <em class="comment">// to create worker name string</em>
<a id="L1398" name="L1398"></a>1398     <strong class="reserved">volatile</strong> <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a> stealCounter;    <em class="comment">// also used as sync monitor</em>
<a id="L1399" name="L1399"></a>1399 
<div class="comment">
      Acquires the runState lock; returns current (locked) runState.</div>
<a id="L1403" name="L1403"></a>1403     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/22673.html" title="Multiple referred from 9 places.">lockRunState</a>() <em class="brace">{</em>
<a id="L1404" name="L1404"></a>1404         <strong class="reserved">int</strong> rs;
<a id="L1405" name="L1405"></a>1405         <strong class="reserved">return</strong> ((((rs = runState) &amp; RSLOCK) != 0 ||
<a id="L1406" name="L1406"></a>1406                  !U.compareAndSwapInt(<strong class="reserved">this</strong>, RUNSTATE, rs, rs |= RSLOCK)) ?
<a id="L1407" name="L1407"></a>1407                 <a href="../S/1063.html#L1414" title="Defined at 1414 in src/java/util/concurrent/ForkJoinPool.java.">awaitRunStateLock</a>() : rs);
<a id="L1408" name="L1408"></a>1408     <em class="brace">}</em>
<a id="L1409" name="L1409"></a>1409 
<div class="comment">
      Spins and/or blocks until runstate lock is available.  See
      above for explanation.</div>
<a id="L1414" name="L1414"></a>1414     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/1063.html#L1407" title="Referred from 1407 in src/java/util/concurrent/ForkJoinPool.java.">awaitRunStateLock</a>() <em class="brace">{</em>
<a id="L1415" name="L1415"></a>1415         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>;
<a id="L1416" name="L1416"></a>1416         <strong class="reserved">boolean</strong> wasInterrupted = <strong class="reserved">false</strong>;
<a id="L1417" name="L1417"></a>1417         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> spins = SPINS, r = 0, rs, ns;;) <em class="brace">{</em>
<a id="L1418" name="L1418"></a>1418             <strong class="reserved">if</strong> (((rs = runState) &amp; RSLOCK) == 0) <em class="brace">{</em>
<a id="L1419" name="L1419"></a>1419                 <strong class="reserved">if</strong> (U.compareAndSwapInt(<strong class="reserved">this</strong>, RUNSTATE, rs, ns = rs | RSLOCK)) <em class="brace">{</em>
<a id="L1420" name="L1420"></a>1420                     <strong class="reserved">if</strong> (wasInterrupted) <em class="brace">{</em>
<a id="L1421" name="L1421"></a>1421                         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1422" name="L1422"></a>1422                             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>().<a href="../D/24969.html" title="Multiple defined in 3 places.">interrupt</a>();
<a id="L1423" name="L1423"></a>1423                         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1580.html#L34" title="Defined at 34 in src/java/lang/SecurityException.java.">SecurityException</a> <a href="../D/24317.html" title="Multiple defined in 3 places.">ignore</a>) <em class="brace">{</em>
<a id="L1424" name="L1424"></a>1424                         <em class="brace">}</em>
<a id="L1425" name="L1425"></a>1425                     <em class="brace">}</em>
<a id="L1426" name="L1426"></a>1426                     <strong class="reserved">return</strong> ns;
<a id="L1427" name="L1427"></a>1427                 <em class="brace">}</em>
<a id="L1428" name="L1428"></a>1428             <em class="brace">}</em>
<a id="L1429" name="L1429"></a>1429             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (r == 0)
<a id="L1430" name="L1430"></a>1430                 r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>();
<a id="L1431" name="L1431"></a>1431             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &gt; 0) <em class="brace">{</em>
<a id="L1432" name="L1432"></a>1432                 r ^= r &lt;&lt; 6; r ^= r &gt;&gt;&gt; 21; r ^= r &lt;&lt; 7; <em class="comment">// xorshift</em>
<a id="L1433" name="L1433"></a>1433                 <strong class="reserved">if</strong> (r &gt;= 0)
<a id="L1434" name="L1434"></a>1434                     --spins;
<a id="L1435" name="L1435"></a>1435             <em class="brace">}</em>
<a id="L1436" name="L1436"></a>1436             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((rs &amp; STARTED) == 0 || (<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = stealCounter) == <strong class="reserved">null</strong>)
<a id="L1437" name="L1437"></a>1437                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>();   <em class="comment">// initialization race</em>
<a id="L1438" name="L1438"></a>1438             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (U.compareAndSwapInt(<strong class="reserved">this</strong>, RUNSTATE, rs, rs | RSIGNAL)) <em class="brace">{</em>
<a id="L1439" name="L1439"></a>1439                 <strong class="reserved">synchronized</strong> (<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L1440" name="L1440"></a>1440                     <strong class="reserved">if</strong> ((runState &amp; RSIGNAL) != 0) <em class="brace">{</em>
<a id="L1441" name="L1441"></a>1441                         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1442" name="L1442"></a>1442                             <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/36778.html" title="Multiple defined in 3 places.">wait</a>();
<a id="L1443" name="L1443"></a>1443                         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> ie) <em class="brace">{</em>
<a id="L1444" name="L1444"></a>1444                             <strong class="reserved">if</strong> (!(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>() <strong class="reserved">instanceof</strong>
<a id="L1445" name="L1445"></a>1445                                   <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>))
<a id="L1446" name="L1446"></a>1446                                 wasInterrupted = <strong class="reserved">true</strong>;
<a id="L1447" name="L1447"></a>1447                         <em class="brace">}</em>
<a id="L1448" name="L1448"></a>1448                     <em class="brace">}</em>
<a id="L1449" name="L1449"></a>1449                     <strong class="reserved">else</strong>
<a id="L1450" name="L1450"></a>1450                         <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../S/1724.html#L295" title="Defined at 295 in src/java/lang/Object.java.">notifyAll</a>();
<a id="L1451" name="L1451"></a>1451                 <em class="brace">}</em>
<a id="L1452" name="L1452"></a>1452             <em class="brace">}</em>
<a id="L1453" name="L1453"></a>1453         <em class="brace">}</em>
<a id="L1454" name="L1454"></a>1454     <em class="brace">}</em>
<a id="L1455" name="L1455"></a>1455 
<div class="comment">
      Unlocks and sets runState to newRunState.
      @param oldRunState a value returned from lockRunState
      @param newRunState the next value (must have lock bit clear).</div>
<a id="L1462" name="L1462"></a>1462     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/29716.html" title="Multiple referred from 9 places.">unlockRunState</a>(<strong class="reserved">int</strong> oldRunState, <strong class="reserved">int</strong> newRunState) <em class="brace">{</em>
<a id="L1463" name="L1463"></a>1463         <strong class="reserved">if</strong> (!U.compareAndSwapInt(<strong class="reserved">this</strong>, RUNSTATE, oldRunState, newRunState)) <em class="brace">{</em>
<a id="L1464" name="L1464"></a>1464             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = stealCounter;
<a id="L1465" name="L1465"></a>1465             runState = newRunState;              <em class="comment">// clears RSIGNAL bit</em>
<a id="L1466" name="L1466"></a>1466             <strong class="reserved">if</strong> (<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> != <strong class="reserved">null</strong>)
<a id="L1467" name="L1467"></a>1467                 <strong class="reserved">synchronized</strong> (<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../S/1724.html#L295" title="Defined at 295 in src/java/lang/Object.java.">notifyAll</a>(); <em class="brace">}</em>
<a id="L1468" name="L1468"></a>1468         <em class="brace">}</em>
<a id="L1469" name="L1469"></a>1469     <em class="brace">}</em>
<a id="L1470" name="L1470"></a>1470 
<a id="L1471" name="L1471"></a>1471     <em class="comment">// Creating, registering and deregistering workers</em>
<a id="L1472" name="L1472"></a>1472 
<div class="comment">
      Tries to construct and start one worker. Assumes that total
      count has already been incremented as a reservation.  Invokes
      deregisterWorker on any failure.
      @return true if successful</div>
<a id="L1480" name="L1480"></a>1480     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/12791.html" title="Multiple referred from 2 places.">createWorker</a>() <em class="brace">{</em>
<a id="L1481" name="L1481"></a>1481         <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> fac = <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>;
<a id="L1482" name="L1482"></a>1482         <a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a> = <strong class="reserved">null</strong>;
<a id="L1483" name="L1483"></a>1483         <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt = <strong class="reserved">null</strong>;
<a id="L1484" name="L1484"></a>1484         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1485" name="L1485"></a>1485             <strong class="reserved">if</strong> (fac != <strong class="reserved">null</strong> &amp;&amp; (wt = fac.<a href="../D/28094.html" title="Multiple defined in 7 places.">newThread</a>(<strong class="reserved">this</strong>)) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1486" name="L1486"></a>1486                 wt.<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>();
<a id="L1487" name="L1487"></a>1487                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1488" name="L1488"></a>1488             <em class="brace">}</em>
<a id="L1489" name="L1489"></a>1489         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> rex) <em class="brace">{</em>
<a id="L1490" name="L1490"></a>1490             <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a> = rex;
<a id="L1491" name="L1491"></a>1491         <em class="brace">}</em>
<a id="L1492" name="L1492"></a>1492         <a href="../S/1063.html#L1578" title="Defined at 1578 in src/java/util/concurrent/ForkJoinPool.java.">deregisterWorker</a>(wt, <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L1493" name="L1493"></a>1493         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1494" name="L1494"></a>1494     <em class="brace">}</em>
<a id="L1495" name="L1495"></a>1495 
<div class="comment">
      Tries to add one worker, incrementing ctl counts before doing
      so, relying on createWorker to back out on failure.
      @param c incoming ctl value, with total count negative and no
      idle workers.  On CAS failure, c is refreshed and retried if
      this holds (otherwise, a new worker is not needed).</div>
<a id="L1504" name="L1504"></a>1504     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/29540.html" title="Multiple referred from 2 places.">tryAddWorker</a>(<strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L1505" name="L1505"></a>1505         <strong class="reserved">boolean</strong> <a href="../D/10632.html" title="Multiple defined in 301 places.">add</a> = <strong class="reserved">false</strong>;
<a id="L1506" name="L1506"></a>1506         <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1507" name="L1507"></a>1507             <strong class="reserved">long</strong> nc = ((AC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + AC_UNIT)) |
<a id="L1508" name="L1508"></a>1508                        (TC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + TC_UNIT)));
<a id="L1509" name="L1509"></a>1509             <strong class="reserved">if</strong> (ctl == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L1510" name="L1510"></a>1510                 <strong class="reserved">int</strong> rs, <a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a>;                 <em class="comment">// check if terminating</em>
<a id="L1511" name="L1511"></a>1511                 <strong class="reserved">if</strong> ((<a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> = (rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>()) &amp; STOP) == 0)
<a id="L1512" name="L1512"></a>1512                     <a href="../D/10632.html" title="Multiple defined in 301 places.">add</a> = U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc);
<a id="L1513" name="L1513"></a>1513                 <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, rs &amp; ~RSLOCK);
<a id="L1514" name="L1514"></a>1514                 <strong class="reserved">if</strong> (<a href="../D/34877.html" title="Multiple defined in 25 places.">stop</a> != 0)
<a id="L1515" name="L1515"></a>1515                     <strong class="reserved">break</strong>;
<a id="L1516" name="L1516"></a>1516                 <strong class="reserved">if</strong> (<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>) <em class="brace">{</em>
<a id="L1517" name="L1517"></a>1517                     <a href="../S/1063.html#L1480" title="Defined at 1480 in src/java/util/concurrent/ForkJoinPool.java.">createWorker</a>();
<a id="L1518" name="L1518"></a>1518                     <strong class="reserved">break</strong>;
<a id="L1519" name="L1519"></a>1519                 <em class="brace">}</em>
<a id="L1520" name="L1520"></a>1520             <em class="brace">}</em>
<a id="L1521" name="L1521"></a>1521         <em class="brace">}</em> <strong class="reserved">while</strong> (((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl) &amp; ADD_WORKER) != 0L &amp;&amp; (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == 0);
<a id="L1522" name="L1522"></a>1522     <em class="brace">}</em>
<a id="L1523" name="L1523"></a>1523 
<div class="comment">
      Callback from ForkJoinWorkerThread constructor to establish and
      record its WorkQueue.
      @param wt the worker thread
      @return the worker's queue</div>
<a id="L1531" name="L1531"></a>1531     <strong class="reserved">final</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> <a href="../R/25829.html" title="Multiple referred from 2 places.">registerWorker</a>(<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt) <em class="brace">{</em>
<a id="L1532" name="L1532"></a>1532         <a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a> <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>;
<a id="L1533" name="L1533"></a>1533         wt.<a href="../D/32347.html" title="Multiple defined in 2 places.">setDaemon</a>(<strong class="reserved">true</strong>);                           <em class="comment">// configure thread</em>
<a id="L1534" name="L1534"></a>1534         <strong class="reserved">if</strong> ((<a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a> = ueh) != <strong class="reserved">null</strong>)
<a id="L1535" name="L1535"></a>1535             wt.<a href="../D/34212.html" title="Multiple defined in 2 places.">setUncaughtExceptionHandler</a>(<a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>);
<a id="L1536" name="L1536"></a>1536         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w = <strong class="reserved">new</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>(<strong class="reserved">this</strong>, wt);
<a id="L1537" name="L1537"></a>1537         <strong class="reserved">int</strong> i = 0;                                    <em class="comment">// assign a pool index</em>
<a id="L1538" name="L1538"></a>1538         <strong class="reserved">int</strong> mode = <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; MODE_MASK;
<a id="L1539" name="L1539"></a>1539         <strong class="reserved">int</strong> rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();
<a id="L1540" name="L1540"></a>1540         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1541" name="L1541"></a>1541             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> n;                    <em class="comment">// skip if no array</em>
<a id="L1542" name="L1542"></a>1542             <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; (n = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) &gt; 0) <em class="brace">{</em>
<a id="L1543" name="L1543"></a>1543                 <strong class="reserved">int</strong> s = indexSeed += SEED_INCREMENT;  <em class="comment">// unlikely to collide</em>
<a id="L1544" name="L1544"></a>1544                 <strong class="reserved">int</strong> m = n - 1;
<a id="L1545" name="L1545"></a>1545                 i = ((s &lt;&lt; 1) | 1) &amp; m;               <em class="comment">// odd-numbered indices</em>
<a id="L1546" name="L1546"></a>1546                 <strong class="reserved">if</strong> (ws[i] != <strong class="reserved">null</strong>) <em class="brace">{</em>                  <em class="comment">// collision</em>
<a id="L1547" name="L1547"></a>1547                     <strong class="reserved">int</strong> probes = 0;                   <em class="comment">// step by approx half n</em>
<a id="L1548" name="L1548"></a>1548                     <strong class="reserved">int</strong> <a href="../D/34874.html" title="Multiple defined in 3 places.">step</a> = (n &lt;= 4) ? 2 : ((n &gt;&gt;&gt; 1) &amp; EVENMASK) + 2;
<a id="L1549" name="L1549"></a>1549                     <strong class="reserved">while</strong> (ws[i = (i + <a href="../D/34874.html" title="Multiple defined in 3 places.">step</a>) &amp; m] != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1550" name="L1550"></a>1550                         <strong class="reserved">if</strong> (++probes &gt;= n) <em class="brace">{</em>
<a id="L1551" name="L1551"></a>1551                             workQueues = ws = <a href="../S/1150.html#L71" title="Defined at 71 in src/java/util/Arrays.java.">Arrays</a>.<a href="../D/13512.html" title="Multiple defined in 12 places.">copyOf</a>(ws, n &lt;&lt;= 1);
<a id="L1552" name="L1552"></a>1552                             m = n - 1;
<a id="L1553" name="L1553"></a>1553                             probes = 0;
<a id="L1554" name="L1554"></a>1554                         <em class="brace">}</em>
<a id="L1555" name="L1555"></a>1555                     <em class="brace">}</em>
<a id="L1556" name="L1556"></a>1556                 <em class="brace">}</em>
<a id="L1557" name="L1557"></a>1557                 w.hint = s;                           <em class="comment">// use as random seed</em>
<a id="L1558" name="L1558"></a>1558                 w.<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> = i | mode;
<a id="L1559" name="L1559"></a>1559                 w.scanState = i;                      <em class="comment">// publication fence</em>
<a id="L1560" name="L1560"></a>1560                 ws[i] = w;
<a id="L1561" name="L1561"></a>1561             <em class="brace">}</em>
<a id="L1562" name="L1562"></a>1562         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L1563" name="L1563"></a>1563             <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, rs &amp; ~RSLOCK);
<a id="L1564" name="L1564"></a>1564         <em class="brace">}</em>
<a id="L1565" name="L1565"></a>1565         wt.<a href="../D/33314.html" title="Multiple defined in 37 places.">setName</a>(workerNamePrefix.<a href="../D/13207.html" title="Multiple defined in 11 places.">concat</a>(<a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(i &gt;&gt;&gt; 1)));
<a id="L1566" name="L1566"></a>1566         <strong class="reserved">return</strong> w;
<a id="L1567" name="L1567"></a>1567     <em class="brace">}</em>
<a id="L1568" name="L1568"></a>1568 
<div class="comment">
      Final callback from terminating worker, as well as upon failure
      to construct or start a worker.  Removes record of worker from
      array, and adjusts counts. If pool is shutting down, tries to
      complete termination.
      @param wt the worker thread, or null if construction failed
      @param ex the exception causing failure, or null if none</div>
<a id="L1578" name="L1578"></a>1578     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/13237.html" title="Multiple referred from 2 places.">deregisterWorker</a>(<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt, <a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L1579" name="L1579"></a>1579         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w = <strong class="reserved">null</strong>;
<a id="L1580" name="L1580"></a>1580         <strong class="reserved">if</strong> (wt != <strong class="reserved">null</strong> &amp;&amp; (w = wt.workQueue) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1581" name="L1581"></a>1581             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws;                           <em class="comment">// remove index from array</em>
<a id="L1582" name="L1582"></a>1582             <strong class="reserved">int</strong> idx = w.<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK;
<a id="L1583" name="L1583"></a>1583             <strong class="reserved">int</strong> rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();
<a id="L1584" name="L1584"></a>1584             <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt; idx &amp;&amp; ws[idx] == w)
<a id="L1585" name="L1585"></a>1585                 ws[idx] = <strong class="reserved">null</strong>;
<a id="L1586" name="L1586"></a>1586             <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, rs &amp; ~RSLOCK);
<a id="L1587" name="L1587"></a>1587         <em class="brace">}</em>
<a id="L1588" name="L1588"></a>1588         <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;                                       <em class="comment">// decrement counts</em>
<a id="L1589" name="L1589"></a>1589         <strong class="reserved">do</strong> <em class="brace">{</em><em class="brace">}</em> <strong class="reserved">while</strong> (!U.compareAndSwapLong
<a id="L1590" name="L1590"></a>1590                      (<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl, ((AC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> - AC_UNIT)) |
<a id="L1591" name="L1591"></a>1591                                            (TC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> - TC_UNIT)) |
<a id="L1592" name="L1592"></a>1592                                            (SP_MASK &amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>))));
<a id="L1593" name="L1593"></a>1593         <strong class="reserved">if</strong> (w != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1594" name="L1594"></a>1594             w.qlock = -1;                             <em class="comment">// ensure set</em>
<a id="L1595" name="L1595"></a>1595             w.<a href="../S/1063.html#L1071" title="Defined at 1071 in src/java/util/concurrent/ForkJoinPool.java.">transferStealCount</a>(<strong class="reserved">this</strong>);
<a id="L1596" name="L1596"></a>1596             w.<a href="../S/1063.html#L1000" title="Defined at 1000 in src/java/util/concurrent/ForkJoinPool.java.">cancelAll</a>();                            <em class="comment">// cancel remaining tasks</em>
<a id="L1597" name="L1597"></a>1597         <em class="brace">}</em>
<a id="L1598" name="L1598"></a>1598         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>                                    <em class="comment">// possibly replace</em>
<a id="L1599" name="L1599"></a>1599             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> m, sp;
<a id="L1600" name="L1600"></a>1600             <strong class="reserved">if</strong> (<a href="../D/35739.html" title="Multiple defined in 2 places.">tryTerminate</a>(<strong class="reserved">false</strong>, <strong class="reserved">false</strong>) || w == <strong class="reserved">null</strong> || w.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a> == <strong class="reserved">null</strong> ||
<a id="L1601" name="L1601"></a>1601                 (runState &amp; STOP) != 0 || (ws = workQueues) == <strong class="reserved">null</strong> ||
<a id="L1602" name="L1602"></a>1602                 (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt; 0)              <em class="comment">// already terminating</em>
<a id="L1603" name="L1603"></a>1603                 <strong class="reserved">break</strong>;
<a id="L1604" name="L1604"></a>1604             <strong class="reserved">if</strong> ((sp = (<strong class="reserved">int</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl)) != 0) <em class="brace">{</em>         <em class="comment">// wake up replacement</em>
<a id="L1605" name="L1605"></a>1605                 <strong class="reserved">if</strong> (<a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, ws[sp &amp; m], AC_UNIT))
<a id="L1606" name="L1606"></a>1606                     <strong class="reserved">break</strong>;
<a id="L1607" name="L1607"></a>1607             <em class="brace">}</em>
<a id="L1608" name="L1608"></a>1608             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a> != <strong class="reserved">null</strong> &amp;&amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &amp; ADD_WORKER) != 0L) <em class="brace">{</em>
<a id="L1609" name="L1609"></a>1609                 <a href="../S/1063.html#L1504" title="Defined at 1504 in src/java/util/concurrent/ForkJoinPool.java.">tryAddWorker</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);                      <em class="comment">// create replacement</em>
<a id="L1610" name="L1610"></a>1610                 <strong class="reserved">break</strong>;
<a id="L1611" name="L1611"></a>1611             <em class="brace">}</em>
<a id="L1612" name="L1612"></a>1612             <strong class="reserved">else</strong>                                      <em class="comment">// don't need replacement</em>
<a id="L1613" name="L1613"></a>1613                 <strong class="reserved">break</strong>;
<a id="L1614" name="L1614"></a>1614         <em class="brace">}</em>
<a id="L1615" name="L1615"></a>1615         <strong class="reserved">if</strong> (<a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a> == <strong class="reserved">null</strong>)                               <em class="comment">// help clean on way out</em>
<a id="L1616" name="L1616"></a>1616             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L641" title="Defined at 641 in src/java/util/concurrent/ForkJoinTask.java.">helpExpungeStaleExceptions</a>();
<a id="L1617" name="L1617"></a>1617         <strong class="reserved">else</strong>                                          <em class="comment">// rethrow</em>
<a id="L1618" name="L1618"></a>1618             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../D/31380.html" title="Multiple defined in 2 places.">rethrow</a>(<a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L1619" name="L1619"></a>1619     <em class="brace">}</em>
<a id="L1620" name="L1620"></a>1620 
<a id="L1621" name="L1621"></a>1621     <em class="comment">// Signalling</em>
<a id="L1622" name="L1622"></a>1622 
<div class="comment">
      Tries to create or activate a worker if too few are active.
      @param ws the worker array to use to find signallees
      @param q a WorkQueue --if non-null, don't retry if now empty</div>
<a id="L1629" name="L1629"></a>1629     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28612.html" title="Multiple referred from 4 places.">signalWork</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws, <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q) <em class="brace">{</em>
<a id="L1630" name="L1630"></a>1630         <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <strong class="reserved">int</strong> sp, i; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> v; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> p;
<a id="L1631" name="L1631"></a>1631         <strong class="reserved">while</strong> ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl) &lt; 0L) <em class="brace">{</em>                       <em class="comment">// too few active</em>
<a id="L1632" name="L1632"></a>1632             <strong class="reserved">if</strong> ((sp = (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) == 0) <em class="brace">{</em>                  <em class="comment">// no idle workers</em>
<a id="L1633" name="L1633"></a>1633                 <strong class="reserved">if</strong> ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &amp; ADD_WORKER) != 0L)            <em class="comment">// too few workers</em>
<a id="L1634" name="L1634"></a>1634                     <a href="../S/1063.html#L1504" title="Defined at 1504 in src/java/util/concurrent/ForkJoinPool.java.">tryAddWorker</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L1635" name="L1635"></a>1635                 <strong class="reserved">break</strong>;
<a id="L1636" name="L1636"></a>1636             <em class="brace">}</em>
<a id="L1637" name="L1637"></a>1637             <strong class="reserved">if</strong> (ws == <strong class="reserved">null</strong>)                            <em class="comment">// unstarted/terminated</em>
<a id="L1638" name="L1638"></a>1638                 <strong class="reserved">break</strong>;
<a id="L1639" name="L1639"></a>1639             <strong class="reserved">if</strong> (ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt;= (i = sp &amp; SMASK))         <em class="comment">// terminated</em>
<a id="L1640" name="L1640"></a>1640                 <strong class="reserved">break</strong>;
<a id="L1641" name="L1641"></a>1641             <strong class="reserved">if</strong> ((v = ws[i]) == <strong class="reserved">null</strong>)                   <em class="comment">// terminating</em>
<a id="L1642" name="L1642"></a>1642                 <strong class="reserved">break</strong>;
<a id="L1643" name="L1643"></a>1643             <strong class="reserved">int</strong> vs = (sp + SS_SEQ) &amp; ~<a href="../S/480.html#L11" title="Defined at 11 in src/org/omg/PortableInterceptor/INACTIVE.java.">INACTIVE</a>;        <em class="comment">// next scanState</em>
<a id="L1644" name="L1644"></a>1644             <strong class="reserved">int</strong> d = sp - v.scanState;                  <em class="comment">// screen CAS</em>
<a id="L1645" name="L1645"></a>1645             <strong class="reserved">long</strong> nc = (UC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + AC_UNIT)) | (SP_MASK &amp; v.stackPred);
<a id="L1646" name="L1646"></a>1646             <strong class="reserved">if</strong> (d == 0 &amp;&amp; U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc)) <em class="brace">{</em>
<a id="L1647" name="L1647"></a>1647                 v.scanState = vs;                      <em class="comment">// activate v</em>
<a id="L1648" name="L1648"></a>1648                 <strong class="reserved">if</strong> ((p = v.parker) != <strong class="reserved">null</strong>)
<a id="L1649" name="L1649"></a>1649                     U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(p);
<a id="L1650" name="L1650"></a>1650                 <strong class="reserved">break</strong>;
<a id="L1651" name="L1651"></a>1651             <em class="brace">}</em>
<a id="L1652" name="L1652"></a>1652             <strong class="reserved">if</strong> (q != <strong class="reserved">null</strong> &amp;&amp; q.base == q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>)          <em class="comment">// no more work</em>
<a id="L1653" name="L1653"></a>1653                 <strong class="reserved">break</strong>;
<a id="L1654" name="L1654"></a>1654         <em class="brace">}</em>
<a id="L1655" name="L1655"></a>1655     <em class="brace">}</em>
<a id="L1656" name="L1656"></a>1656 
<div class="comment">
      Signals and releases worker v if it is top of idle worker
      stack.  This performs a one-shot version of signalWork only if
      there is (apparently) at least one idle worker.
      @param c incoming ctl value
      @param v if non-null, a worker
      @param inc the increment to active count (zero when compensating)
      @return true if successful</div>
<a id="L1667" name="L1667"></a>1667     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/29560.html" title="Multiple referred from 7 places.">tryRelease</a>(<strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> v, <strong class="reserved">long</strong> inc) <em class="brace">{</em>
<a id="L1668" name="L1668"></a>1668         <strong class="reserved">int</strong> sp = (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, vs = (sp + SS_SEQ) &amp; ~<a href="../S/480.html#L11" title="Defined at 11 in src/org/omg/PortableInterceptor/INACTIVE.java.">INACTIVE</a>; <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> p;
<a id="L1669" name="L1669"></a>1669         <strong class="reserved">if</strong> (v != <strong class="reserved">null</strong> &amp;&amp; v.scanState == sp) <em class="brace">{</em>          <em class="comment">// v is at top of stack</em>
<a id="L1670" name="L1670"></a>1670             <strong class="reserved">long</strong> nc = (UC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + inc)) | (SP_MASK &amp; v.stackPred);
<a id="L1671" name="L1671"></a>1671             <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc)) <em class="brace">{</em>
<a id="L1672" name="L1672"></a>1672                 v.scanState = vs;
<a id="L1673" name="L1673"></a>1673                 <strong class="reserved">if</strong> ((p = v.parker) != <strong class="reserved">null</strong>)
<a id="L1674" name="L1674"></a>1674                     U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(p);
<a id="L1675" name="L1675"></a>1675                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1676" name="L1676"></a>1676             <em class="brace">}</em>
<a id="L1677" name="L1677"></a>1677         <em class="brace">}</em>
<a id="L1678" name="L1678"></a>1678         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1679" name="L1679"></a>1679     <em class="brace">}</em>
<a id="L1680" name="L1680"></a>1680 
<a id="L1681" name="L1681"></a>1681     <em class="comment">// Scanning for tasks</em>
<a id="L1682" name="L1682"></a>1682 
<div class="comment">
      Top-level runloop for workers, called by ForkJoinWorkerThread.run.</div>
<a id="L1686" name="L1686"></a>1686     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/26563.html" title="Multiple referred from 2 places.">runWorker</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w) <em class="brace">{</em>
<a id="L1687" name="L1687"></a>1687         w.<a href="../D/23922.html" title="Multiple defined in 2 places.">growArray</a>();                   <em class="comment">// allocate queue</em>
<a id="L1688" name="L1688"></a>1688         <strong class="reserved">int</strong> seed = w.hint;               <em class="comment">// initially holds randomization hint</em>
<a id="L1689" name="L1689"></a>1689         <strong class="reserved">int</strong> r = (seed == 0) ? 1 : seed;  <em class="comment">// avoid 0 for xorShift</em>
<a id="L1690" name="L1690"></a>1690         <strong class="reserved">for</strong> (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;;) <em class="brace">{</em>
<a id="L1691" name="L1691"></a>1691             <strong class="reserved">if</strong> ((t = <a href="../D/31557.html" title="Multiple defined in 18 places.">scan</a>(w, r)) != <strong class="reserved">null</strong>)
<a id="L1692" name="L1692"></a>1692                 w.<a href="../S/1063.html#L1053" title="Defined at 1053 in src/java/util/concurrent/ForkJoinPool.java.">runTask</a>(t);
<a id="L1693" name="L1693"></a>1693             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!<a href="../S/1063.html#L1785" title="Defined at 1785 in src/java/util/concurrent/ForkJoinPool.java.">awaitWork</a>(w, r))
<a id="L1694" name="L1694"></a>1694                 <strong class="reserved">break</strong>;
<a id="L1695" name="L1695"></a>1695             r ^= r &lt;&lt; 13; r ^= r &gt;&gt;&gt; 17; r ^= r &lt;&lt; 5; <em class="comment">// xorshift</em>
<a id="L1696" name="L1696"></a>1696         <em class="brace">}</em>
<a id="L1697" name="L1697"></a>1697     <em class="brace">}</em>
<a id="L1698" name="L1698"></a>1698 
<div class="comment">
      Scans for and tries to steal a top-level task. Scans start at a
      random location, randomly moving on apparent contention,
      otherwise continuing linearly until reaching two consecutive
      empty passes over all queues with the same checksum (summing
      each base index of each queue, that moves on each steal), at
      which point the worker tries to inactivate and then re-scans,
      attempting to re-activate (itself or some other worker) if
      finding a task; otherwise returning null to await work.  Scans
      otherwise touch as little memory as possible, to reduce
      disruption on other scanning threads.
      @param w the worker (via its WorkQueue)
      @param r a random seed
      @return a task, or null if none found</div>
<a id="L1715" name="L1715"></a>1715     <strong class="reserved">private</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/26607.html" title="Multiple referred from 130 places.">scan</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w, <strong class="reserved">int</strong> r) <em class="brace">{</em>
<a id="L1716" name="L1716"></a>1716         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> m;
<a id="L1717" name="L1717"></a>1717         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt; 0 &amp;&amp; w != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1718" name="L1718"></a>1718             <strong class="reserved">int</strong> ss = w.scanState;                     <em class="comment">// initially non-negative</em>
<a id="L1719" name="L1719"></a>1719             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> origin = r &amp; m, k = origin, oldSum = 0, checkSum = 0;;) <em class="brace">{</em>
<a id="L1720" name="L1720"></a>1720                 <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;
<a id="L1721" name="L1721"></a>1721                 <strong class="reserved">int</strong> b, n; <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L1722" name="L1722"></a>1722                 <strong class="reserved">if</strong> ((q = ws[k]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1723" name="L1723"></a>1723                     <strong class="reserved">if</strong> ((n = (b = q.base) - q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) &lt; 0 &amp;&amp;
<a id="L1724" name="L1724"></a>1724                         (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = q.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>      <em class="comment">// non-empty</em>
<a id="L1725" name="L1725"></a>1725                         <strong class="reserved">long</strong> i = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; b) &lt;&lt; ASHIFT) + ABASE;
<a id="L1726" name="L1726"></a>1726                         <strong class="reserved">if</strong> ((t = ((<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)
<a id="L1727" name="L1727"></a>1727                                   U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, i))) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1728" name="L1728"></a>1728                             q.base == b) <em class="brace">{</em>
<a id="L1729" name="L1729"></a>1729                             <strong class="reserved">if</strong> (ss &gt;= 0) <em class="brace">{</em>
<a id="L1730" name="L1730"></a>1730                                 <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, i, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1731" name="L1731"></a>1731                                     q.base = b + 1;
<a id="L1732" name="L1732"></a>1732                                     <strong class="reserved">if</strong> (n &lt; -1)       <em class="comment">// signal others</em>
<a id="L1733" name="L1733"></a>1733                                         <a href="../S/1063.html#L1629" title="Defined at 1629 in src/java/util/concurrent/ForkJoinPool.java.">signalWork</a>(ws, q);
<a id="L1734" name="L1734"></a>1734                                     <strong class="reserved">return</strong> t;
<a id="L1735" name="L1735"></a>1735                                 <em class="brace">}</em>
<a id="L1736" name="L1736"></a>1736                             <em class="brace">}</em>
<a id="L1737" name="L1737"></a>1737                             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (oldSum == 0 &amp;&amp;   <em class="comment">// try to activate</em>
<a id="L1738" name="L1738"></a>1738                                      w.scanState &lt; 0)
<a id="L1739" name="L1739"></a>1739                                 <a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl, ws[m &amp; (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>], AC_UNIT);
<a id="L1740" name="L1740"></a>1740                         <em class="brace">}</em>
<a id="L1741" name="L1741"></a>1741                         <strong class="reserved">if</strong> (ss &lt; 0)                   <em class="comment">// refresh</em>
<a id="L1742" name="L1742"></a>1742                             ss = w.scanState;
<a id="L1743" name="L1743"></a>1743                         r ^= r &lt;&lt; 1; r ^= r &gt;&gt;&gt; 3; r ^= r &lt;&lt; 10;
<a id="L1744" name="L1744"></a>1744                         origin = k = r &amp; m;           <em class="comment">// move and rescan</em>
<a id="L1745" name="L1745"></a>1745                         oldSum = checkSum = 0;
<a id="L1746" name="L1746"></a>1746                         <strong class="reserved">continue</strong>;
<a id="L1747" name="L1747"></a>1747                     <em class="brace">}</em>
<a id="L1748" name="L1748"></a>1748                     checkSum += b;
<a id="L1749" name="L1749"></a>1749                 <em class="brace">}</em>
<a id="L1750" name="L1750"></a>1750                 <strong class="reserved">if</strong> ((k = (k + 1) &amp; m) == origin) <em class="brace">{</em>    <em class="comment">// continue until stable</em>
<a id="L1751" name="L1751"></a>1751                     <strong class="reserved">if</strong> ((ss &gt;= 0 || (ss == (ss = w.scanState))) &amp;&amp;
<a id="L1752" name="L1752"></a>1752                         oldSum == (oldSum = checkSum)) <em class="brace">{</em>
<a id="L1753" name="L1753"></a>1753                         <strong class="reserved">if</strong> (ss &lt; 0 || w.qlock &lt; 0)    <em class="comment">// already inactive</em>
<a id="L1754" name="L1754"></a>1754                             <strong class="reserved">break</strong>;
<a id="L1755" name="L1755"></a>1755                         <strong class="reserved">int</strong> ns = ss | <a href="../S/480.html#L11" title="Defined at 11 in src/org/omg/PortableInterceptor/INACTIVE.java.">INACTIVE</a>;       <em class="comment">// try to inactivate</em>
<a id="L1756" name="L1756"></a>1756                         <strong class="reserved">long</strong> nc = ((SP_MASK &amp; ns) |
<a id="L1757" name="L1757"></a>1757                                    (UC_MASK &amp; ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl) - AC_UNIT)));
<a id="L1758" name="L1758"></a>1758                         w.stackPred = (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;         <em class="comment">// hold prev stack top</em>
<a id="L1759" name="L1759"></a>1759                         U.<a href="../D/30009.html" title="Multiple defined in 17 places.">putInt</a>(w, QSCANSTATE, ns);
<a id="L1760" name="L1760"></a>1760                         <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc))
<a id="L1761" name="L1761"></a>1761                             ss = ns;
<a id="L1762" name="L1762"></a>1762                         <strong class="reserved">else</strong>
<a id="L1763" name="L1763"></a>1763                             w.scanState = ss;         <em class="comment">// back out</em>
<a id="L1764" name="L1764"></a>1764                     <em class="brace">}</em>
<a id="L1765" name="L1765"></a>1765                     checkSum = 0;
<a id="L1766" name="L1766"></a>1766                 <em class="brace">}</em>
<a id="L1767" name="L1767"></a>1767             <em class="brace">}</em>
<a id="L1768" name="L1768"></a>1768         <em class="brace">}</em>
<a id="L1769" name="L1769"></a>1769         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L1770" name="L1770"></a>1770     <em class="brace">}</em>
<a id="L1771" name="L1771"></a>1771 
<div class="comment">
      Possibly blocks worker w waiting for a task to steal, or
      returns false if the worker should terminate.  If inactivating
      w has caused the pool to become quiescent, checks for pool
      termination, and, so long as this is not the only worker, waits
      for up to a given duration.  On timeout, if ctl has not
      changed, terminates the worker, which will in turn wake up
      another worker to possibly repeat this process.
      @param w the calling worker
      @param r a random seed (for spins)
      @return false if the worker should terminate</div>
<a id="L1785" name="L1785"></a>1785     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/1063.html#L1693" title="Referred from 1693 in src/java/util/concurrent/ForkJoinPool.java.">awaitWork</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w, <strong class="reserved">int</strong> r) <em class="brace">{</em>
<a id="L1786" name="L1786"></a>1786         <strong class="reserved">if</strong> (w == <strong class="reserved">null</strong> || w.qlock &lt; 0)                 <em class="comment">// w is terminating</em>
<a id="L1787" name="L1787"></a>1787             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1788" name="L1788"></a>1788         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = w.stackPred, spins = SPINS, ss;;) <em class="brace">{</em>
<a id="L1789" name="L1789"></a>1789             <strong class="reserved">if</strong> ((ss = w.scanState) &gt;= 0)
<a id="L1790" name="L1790"></a>1790                 <strong class="reserved">break</strong>;
<a id="L1791" name="L1791"></a>1791             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &gt; 0) <em class="brace">{</em>
<a id="L1792" name="L1792"></a>1792                 r ^= r &lt;&lt; 6; r ^= r &gt;&gt;&gt; 21; r ^= r &lt;&lt; 7;
<a id="L1793" name="L1793"></a>1793                 <strong class="reserved">if</strong> (r &gt;= 0 &amp;&amp; --spins == 0) <em class="brace">{</em>         <em class="comment">// randomize spins</em>
<a id="L1794" name="L1794"></a>1794                     <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> v; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> s, j; <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a> sc;
<a id="L1795" name="L1795"></a>1795                     <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != 0 &amp;&amp; (ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1796" name="L1796"></a>1796                         (j = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> &amp; SMASK) &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &amp;&amp;
<a id="L1797" name="L1797"></a>1797                         (v = ws[j]) != <strong class="reserved">null</strong> &amp;&amp;        <em class="comment">// see if pred parking</em>
<a id="L1798" name="L1798"></a>1798                         (v.parker == <strong class="reserved">null</strong> || v.scanState &gt;= 0))
<a id="L1799" name="L1799"></a>1799                         spins = SPINS;                <em class="comment">// continue spinning</em>
<a id="L1800" name="L1800"></a>1800                 <em class="brace">}</em>
<a id="L1801" name="L1801"></a>1801             <em class="brace">}</em>
<a id="L1802" name="L1802"></a>1802             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (w.qlock &lt; 0)                     <em class="comment">// recheck after spins</em>
<a id="L1803" name="L1803"></a>1803                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1804" name="L1804"></a>1804             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>()) <em class="brace">{</em>
<a id="L1805" name="L1805"></a>1805                 <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, prevctl, parkTime, deadline;
<a id="L1806" name="L1806"></a>1806                 <strong class="reserved">int</strong> ac = (<strong class="reserved">int</strong>)((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl) &gt;&gt; AC_SHIFT) + (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK);
<a id="L1807" name="L1807"></a>1807                 <strong class="reserved">if</strong> ((ac &lt;= 0 &amp;&amp; <a href="../D/35739.html" title="Multiple defined in 2 places.">tryTerminate</a>(<strong class="reserved">false</strong>, <strong class="reserved">false</strong>)) ||
<a id="L1808" name="L1808"></a>1808                     (runState &amp; STOP) != 0)           <em class="comment">// pool terminating</em>
<a id="L1809" name="L1809"></a>1809                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1810" name="L1810"></a>1810                 <strong class="reserved">if</strong> (ac &lt;= 0 &amp;&amp; ss == (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>        <em class="comment">// is last waiter</em>
<a id="L1811" name="L1811"></a>1811                     prevctl = (UC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + AC_UNIT)) | (SP_MASK &amp; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>);
<a id="L1812" name="L1812"></a>1812                     <strong class="reserved">int</strong> t = (<strong class="reserved">short</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt;&gt; TC_SHIFT);  <em class="comment">// shrink excess spares</em>
<a id="L1813" name="L1813"></a>1813                     <strong class="reserved">if</strong> (t &gt; 2 &amp;&amp; U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, prevctl))
<a id="L1814" name="L1814"></a>1814                         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;                 <em class="comment">// else use timed wait</em>
<a id="L1815" name="L1815"></a>1815                     parkTime = IDLE_TIMEOUT * ((t &gt;= 0) ? 1 : 1 - t);
<a id="L1816" name="L1816"></a>1816                     deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + parkTime - TIMEOUT_SLOP;
<a id="L1817" name="L1817"></a>1817                 <em class="brace">}</em>
<a id="L1818" name="L1818"></a>1818                 <strong class="reserved">else</strong>
<a id="L1819" name="L1819"></a>1819                     prevctl = parkTime = deadline = 0L;
<a id="L1820" name="L1820"></a>1820                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> wt = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L1821" name="L1821"></a>1821                 U.putObject(wt, PARKBLOCKER, <strong class="reserved">this</strong>);   <em class="comment">// emulate LockSupport</em>
<a id="L1822" name="L1822"></a>1822                 w.parker = wt;
<a id="L1823" name="L1823"></a>1823                 <strong class="reserved">if</strong> (w.scanState &lt; 0 &amp;&amp; ctl == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)      <em class="comment">// recheck before park</em>
<a id="L1824" name="L1824"></a>1824                     U.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">false</strong>, parkTime);
<a id="L1825" name="L1825"></a>1825                 U.putOrderedObject(w, QPARKER, <strong class="reserved">null</strong>);
<a id="L1826" name="L1826"></a>1826                 U.putObject(wt, PARKBLOCKER, <strong class="reserved">null</strong>);
<a id="L1827" name="L1827"></a>1827                 <strong class="reserved">if</strong> (w.scanState &gt;= 0)
<a id="L1828" name="L1828"></a>1828                     <strong class="reserved">break</strong>;
<a id="L1829" name="L1829"></a>1829                 <strong class="reserved">if</strong> (parkTime != 0L &amp;&amp; ctl == <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &amp;&amp;
<a id="L1830" name="L1830"></a>1830                     deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() &lt;= 0L &amp;&amp;
<a id="L1831" name="L1831"></a>1831                     U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, prevctl))
<a id="L1832" name="L1832"></a>1832                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;                     <em class="comment">// shrink pool</em>
<a id="L1833" name="L1833"></a>1833             <em class="brace">}</em>
<a id="L1834" name="L1834"></a>1834         <em class="brace">}</em>
<a id="L1835" name="L1835"></a>1835         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1836" name="L1836"></a>1836     <em class="brace">}</em>
<a id="L1837" name="L1837"></a>1837 
<a id="L1838" name="L1838"></a>1838     <em class="comment">// Joining tasks</em>
<a id="L1839" name="L1839"></a>1839 
<div class="comment">
      Tries to steal and run tasks within the target's computation.
      Uses a variant of the top-level algorithm, restricted to tasks
      with the given task as ancestor: It prefers taking and running
      eligible tasks popped from the worker's own queue (via
      popCC). Otherwise it scans others, randomly moving on
      contention or execution, deciding to give up based on a
      checksum (via return codes frob pollAndExecCC). The maxTasks
      argument supports external usages; internal calls use zero,
      allowing unbounded steps (external calls trap non-positive
      values).
      @param w caller
      @param maxTasks if non-zero, the maximum number of other tasks to run
      @return task status on exit</div>
<a id="L1856" name="L1856"></a>1856     <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/20310.html" title="Multiple referred from 3 places.">helpComplete</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w, <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; task,
<a id="L1857" name="L1857"></a>1857                            <strong class="reserved">int</strong> maxTasks) <em class="brace">{</em>
<a id="L1858" name="L1858"></a>1858         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> s = 0, m;
<a id="L1859" name="L1859"></a>1859         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0 &amp;&amp;
<a id="L1860" name="L1860"></a>1860             task != <strong class="reserved">null</strong> &amp;&amp; w != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1861" name="L1861"></a>1861             <strong class="reserved">int</strong> mode = w.<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a>;                 <em class="comment">// for popCC</em>
<a id="L1862" name="L1862"></a>1862             <strong class="reserved">int</strong> r = w.hint ^ w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>;              <em class="comment">// arbitrary seed for origin</em>
<a id="L1863" name="L1863"></a>1863             <strong class="reserved">int</strong> origin = r &amp; m;                  <em class="comment">// first queue to scan</em>
<a id="L1864" name="L1864"></a>1864             <strong class="reserved">int</strong> h = 1;                           <em class="comment">// 1:ran, &gt;1:contended, &lt;0:hash</em>
<a id="L1865" name="L1865"></a>1865             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = origin, oldSum = 0, checkSum = 0;;) <em class="brace">{</em>
<a id="L1866" name="L1866"></a>1866                 <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; p; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q;
<a id="L1867" name="L1867"></a>1867                 <strong class="reserved">if</strong> ((s = task.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a>) &lt; 0)
<a id="L1868" name="L1868"></a>1868                     <strong class="reserved">break</strong>;
<a id="L1869" name="L1869"></a>1869                 <strong class="reserved">if</strong> (h == 1 &amp;&amp; (p = w.<a href="../S/1063.html#L1129" title="Defined at 1129 in src/java/util/concurrent/ForkJoinPool.java.">popCC</a>(task, mode)) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1870" name="L1870"></a>1870                     p.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();                  <em class="comment">// run local task</em>
<a id="L1871" name="L1871"></a>1871                     <strong class="reserved">if</strong> (maxTasks != 0 &amp;&amp; --maxTasks == 0)
<a id="L1872" name="L1872"></a>1872                         <strong class="reserved">break</strong>;
<a id="L1873" name="L1873"></a>1873                     origin = k;                  <em class="comment">// reset</em>
<a id="L1874" name="L1874"></a>1874                     oldSum = checkSum = 0;
<a id="L1875" name="L1875"></a>1875                 <em class="brace">}</em>
<a id="L1876" name="L1876"></a>1876                 <strong class="reserved">else</strong> <em class="brace">{</em>                           <em class="comment">// poll other queues</em>
<a id="L1877" name="L1877"></a>1877                     <strong class="reserved">if</strong> ((q = ws[k]) == <strong class="reserved">null</strong>)
<a id="L1878" name="L1878"></a>1878                         h = 0;
<a id="L1879" name="L1879"></a>1879                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((h = q.<a href="../S/1063.html#L1173" title="Defined at 1173 in src/java/util/concurrent/ForkJoinPool.java.">pollAndExecCC</a>(task)) &lt; 0)
<a id="L1880" name="L1880"></a>1880                         checkSum += h;
<a id="L1881" name="L1881"></a>1881                     <strong class="reserved">if</strong> (h &gt; 0) <em class="brace">{</em>
<a id="L1882" name="L1882"></a>1882                         <strong class="reserved">if</strong> (h == 1 &amp;&amp; maxTasks != 0 &amp;&amp; --maxTasks == 0)
<a id="L1883" name="L1883"></a>1883                             <strong class="reserved">break</strong>;
<a id="L1884" name="L1884"></a>1884                         r ^= r &lt;&lt; 13; r ^= r &gt;&gt;&gt; 17; r ^= r &lt;&lt; 5; <em class="comment">// xorshift</em>
<a id="L1885" name="L1885"></a>1885                         origin = k = r &amp; m;      <em class="comment">// move and restart</em>
<a id="L1886" name="L1886"></a>1886                         oldSum = checkSum = 0;
<a id="L1887" name="L1887"></a>1887                     <em class="brace">}</em>
<a id="L1888" name="L1888"></a>1888                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((k = (k + 1) &amp; m) == origin) <em class="brace">{</em>
<a id="L1889" name="L1889"></a>1889                         <strong class="reserved">if</strong> (oldSum == (oldSum = checkSum))
<a id="L1890" name="L1890"></a>1890                             <strong class="reserved">break</strong>;
<a id="L1891" name="L1891"></a>1891                         checkSum = 0;
<a id="L1892" name="L1892"></a>1892                     <em class="brace">}</em>
<a id="L1893" name="L1893"></a>1893                 <em class="brace">}</em>
<a id="L1894" name="L1894"></a>1894             <em class="brace">}</em>
<a id="L1895" name="L1895"></a>1895         <em class="brace">}</em>
<a id="L1896" name="L1896"></a>1896         <strong class="reserved">return</strong> s;
<a id="L1897" name="L1897"></a>1897     <em class="brace">}</em>
<a id="L1898" name="L1898"></a>1898 
<div class="comment">
      Tries to locate and execute tasks for a stealer of the given
      task, or in turn one of its stealers, Traces currentSteal -&gt;
      currentJoin links looking for a thread working on a descendant
      of the given task and with a non-empty queue to steal back and
      execute tasks from. The first call to this method upon a
      waiting join will often entail scanning/search, (which is OK
      because the joiner has nothing better to do), but this method
      leaves hints in workers to speed up subsequent calls.
      @param w caller
      @param task the task to join</div>
<a id="L1912" name="L1912"></a>1912     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/1063.html#L2047" title="Referred from 2047 in src/java/util/concurrent/ForkJoinPool.java.">helpStealer</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w, <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L1913" name="L1913"></a>1913         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws = workQueues;
<a id="L1914" name="L1914"></a>1914         <strong class="reserved">int</strong> oldSum = 0, checkSum, m;
<a id="L1915" name="L1915"></a>1915         <strong class="reserved">if</strong> (ws != <strong class="reserved">null</strong> &amp;&amp; (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0 &amp;&amp; w != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1916" name="L1916"></a>1916             task != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1917" name="L1917"></a>1917             <strong class="reserved">do</strong> <em class="brace">{</em>                                       <em class="comment">// restart point</em>
<a id="L1918" name="L1918"></a>1918                 checkSum = 0;                          <em class="comment">// for stability check</em>
<a id="L1919" name="L1919"></a>1919                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; subtask;
<a id="L1920" name="L1920"></a>1920                 <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> j = w, v;                    <em class="comment">// v is subtask stealer</em>
<a id="L1921" name="L1921"></a>1921                 descent: <strong class="reserved">for</strong> (subtask = task; subtask.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &gt;= 0; ) <em class="brace">{</em>
<a id="L1922" name="L1922"></a>1922                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> h = j.hint | 1, k = 0, i; ; k += 2) <em class="brace">{</em>
<a id="L1923" name="L1923"></a>1923                         <strong class="reserved">if</strong> (k &gt; m)                     <em class="comment">// can't find stealer</em>
<a id="L1924" name="L1924"></a>1924                             <strong class="reserved">break</strong> descent;
<a id="L1925" name="L1925"></a>1925                         <strong class="reserved">if</strong> ((v = ws[i = (h + k) &amp; m]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1926" name="L1926"></a>1926                             <strong class="reserved">if</strong> (v.currentSteal == subtask) <em class="brace">{</em>
<a id="L1927" name="L1927"></a>1927                                 j.hint = i;
<a id="L1928" name="L1928"></a>1928                                 <strong class="reserved">break</strong>;
<a id="L1929" name="L1929"></a>1929                             <em class="brace">}</em>
<a id="L1930" name="L1930"></a>1930                             checkSum += v.base;
<a id="L1931" name="L1931"></a>1931                         <em class="brace">}</em>
<a id="L1932" name="L1932"></a>1932                     <em class="brace">}</em>
<a id="L1933" name="L1933"></a>1933                     <strong class="reserved">for</strong> (;;) <em class="brace">{</em>                         <em class="comment">// help v or descend</em>
<a id="L1934" name="L1934"></a>1934                         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> b;
<a id="L1935" name="L1935"></a>1935                         checkSum += (b = v.base);
<a id="L1936" name="L1936"></a>1936                         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = v.currentJoin;
<a id="L1937" name="L1937"></a>1937                         <strong class="reserved">if</strong> (subtask.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &lt; 0 || j.currentJoin != subtask ||
<a id="L1938" name="L1938"></a>1938                             v.currentSteal != subtask) <em class="comment">// stale</em>
<a id="L1939" name="L1939"></a>1939                             <strong class="reserved">break</strong> descent;
<a id="L1940" name="L1940"></a>1940                         <strong class="reserved">if</strong> (b - v.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &gt;= 0 || (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = v.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1941" name="L1941"></a>1941                             <strong class="reserved">if</strong> ((subtask = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong>)
<a id="L1942" name="L1942"></a>1942                                 <strong class="reserved">break</strong> descent;
<a id="L1943" name="L1943"></a>1943                             j = v;
<a id="L1944" name="L1944"></a>1944                             <strong class="reserved">break</strong>;
<a id="L1945" name="L1945"></a>1945                         <em class="brace">}</em>
<a id="L1946" name="L1946"></a>1946                         <strong class="reserved">int</strong> i = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; b) &lt;&lt; ASHIFT) + ABASE;
<a id="L1947" name="L1947"></a>1947                         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t = ((<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)
<a id="L1948" name="L1948"></a>1948                                              U.getObjectVolatile(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, i));
<a id="L1949" name="L1949"></a>1949                         <strong class="reserved">if</strong> (v.base == b) <em class="brace">{</em>
<a id="L1950" name="L1950"></a>1950                             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>)             <em class="comment">// stale</em>
<a id="L1951" name="L1951"></a>1951                                 <strong class="reserved">break</strong> descent;
<a id="L1952" name="L1952"></a>1952                             <strong class="reserved">if</strong> (U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, i, t, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1953" name="L1953"></a>1953                                 v.base = b + 1;
<a id="L1954" name="L1954"></a>1954                                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; ps = w.currentSteal;
<a id="L1955" name="L1955"></a>1955                                 <strong class="reserved">int</strong> <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> = w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>;
<a id="L1956" name="L1956"></a>1956                                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1957" name="L1957"></a>1957                                     U.putOrderedObject(w, QCURRENTSTEAL, t);
<a id="L1958" name="L1958"></a>1958                                     t.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();        <em class="comment">// clear local tasks too</em>
<a id="L1959" name="L1959"></a>1959                                 <em class="brace">}</em> <strong class="reserved">while</strong> (task.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &gt;= 0 &amp;&amp;
<a id="L1960" name="L1960"></a>1960                                          w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> != <a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &amp;&amp;
<a id="L1961" name="L1961"></a>1961                                          (t = w.<a href="../D/29416.html" title="Multiple defined in 30 places.">pop</a>()) != <strong class="reserved">null</strong>);
<a id="L1962" name="L1962"></a>1962                                 U.putOrderedObject(w, QCURRENTSTEAL, ps);
<a id="L1963" name="L1963"></a>1963                                 <strong class="reserved">if</strong> (w.base != w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>)
<a id="L1964" name="L1964"></a>1964                                     <strong class="reserved">return</strong>;            <em class="comment">// can't further help</em>
<a id="L1965" name="L1965"></a>1965                             <em class="brace">}</em>
<a id="L1966" name="L1966"></a>1966                         <em class="brace">}</em>
<a id="L1967" name="L1967"></a>1967                     <em class="brace">}</em>
<a id="L1968" name="L1968"></a>1968                 <em class="brace">}</em>
<a id="L1969" name="L1969"></a>1969             <em class="brace">}</em> <strong class="reserved">while</strong> (task.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a> &gt;= 0 &amp;&amp; oldSum != (oldSum = checkSum));
<a id="L1970" name="L1970"></a>1970         <em class="brace">}</em>
<a id="L1971" name="L1971"></a>1971     <em class="brace">}</em>
<a id="L1972" name="L1972"></a>1972 
<div class="comment">
      Tries to decrement active count (sometimes implicitly) and
      possibly release or create a compensating worker in preparation
      for blocking. Returns false (retryable by caller), on
      contention, detected staleness, instability, or termination.
      @param w caller</div>
<a id="L1981" name="L1981"></a>1981     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/29544.html" title="Multiple referred from 2 places.">tryCompensate</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w) <em class="brace">{</em>
<a id="L1982" name="L1982"></a>1982         <strong class="reserved">boolean</strong> canBlock;
<a id="L1983" name="L1983"></a>1983         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <strong class="reserved">int</strong> m, pc, sp;
<a id="L1984" name="L1984"></a>1984         <strong class="reserved">if</strong> (w == <strong class="reserved">null</strong> || w.qlock &lt; 0 ||           <em class="comment">// caller terminating</em>
<a id="L1985" name="L1985"></a>1985             (ws = workQueues) == <strong class="reserved">null</strong> || (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt;= 0 ||
<a id="L1986" name="L1986"></a>1986             (pc = <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) == 0)           <em class="comment">// parallelism disabled</em>
<a id="L1987" name="L1987"></a>1987             canBlock = <strong class="reserved">false</strong>;
<a id="L1988" name="L1988"></a>1988         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((sp = (<strong class="reserved">int</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl)) != 0)      <em class="comment">// release idle worker</em>
<a id="L1989" name="L1989"></a>1989             canBlock = <a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, ws[sp &amp; m], 0L);
<a id="L1990" name="L1990"></a>1990         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1991" name="L1991"></a>1991             <strong class="reserved">int</strong> ac = (<strong class="reserved">int</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt; AC_SHIFT) + pc;
<a id="L1992" name="L1992"></a>1992             <strong class="reserved">int</strong> tc = (<strong class="reserved">short</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt; TC_SHIFT) + pc;
<a id="L1993" name="L1993"></a>1993             <strong class="reserved">int</strong> nbusy = 0;                        <em class="comment">// validate saturation</em>
<a id="L1994" name="L1994"></a>1994             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt;= m; ++i) <em class="brace">{</em>        <em class="comment">// two passes of odd indices</em>
<a id="L1995" name="L1995"></a>1995                 <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> v;
<a id="L1996" name="L1996"></a>1996                 <strong class="reserved">if</strong> ((v = ws[((i &lt;&lt; 1) | 1) &amp; m]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1997" name="L1997"></a>1997                     <strong class="reserved">if</strong> ((v.scanState &amp; SCANNING) != 0)
<a id="L1998" name="L1998"></a>1998                         <strong class="reserved">break</strong>;
<a id="L1999" name="L1999"></a>1999                     ++nbusy;
<a id="L2000" name="L2000"></a>2000                 <em class="brace">}</em>
<a id="L2001" name="L2001"></a>2001             <em class="brace">}</em>
<a id="L2002" name="L2002"></a>2002             <strong class="reserved">if</strong> (nbusy != (tc &lt;&lt; 1) || ctl != <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>)
<a id="L2003" name="L2003"></a>2003                 canBlock = <strong class="reserved">false</strong>;                 <em class="comment">// unstable or stale</em>
<a id="L2004" name="L2004"></a>2004             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (tc &gt;= pc &amp;&amp; ac &gt; 1 &amp;&amp; w.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L2005" name="L2005"></a>2005                 <strong class="reserved">long</strong> nc = ((AC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> - AC_UNIT)) |
<a id="L2006" name="L2006"></a>2006                            (~AC_MASK &amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>));       <em class="comment">// uncompensated</em>
<a id="L2007" name="L2007"></a>2007                 canBlock = U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc);
<a id="L2008" name="L2008"></a>2008             <em class="brace">}</em>
<a id="L2009" name="L2009"></a>2009             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (tc &gt;= MAX_CAP ||
<a id="L2010" name="L2010"></a>2010                      (<strong class="reserved">this</strong> == common &amp;&amp; tc &gt;= pc + commonMaxSpares))
<a id="L2011" name="L2011"></a>2011                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1055.html#L45" title="Defined at 45 in src/java/util/concurrent/RejectedExecutionException.java.">RejectedExecutionException</a>(
<a id="L2012" name="L2012"></a>2012                     "Thread limit exceeded replacing blocked worker");
<a id="L2013" name="L2013"></a>2013             <strong class="reserved">else</strong> <em class="brace">{</em>                                <em class="comment">// similar to tryAddWorker</em>
<a id="L2014" name="L2014"></a>2014                 <strong class="reserved">boolean</strong> <a href="../D/10632.html" title="Multiple defined in 301 places.">add</a> = <strong class="reserved">false</strong>; <strong class="reserved">int</strong> rs;      <em class="comment">// CAS within lock</em>
<a id="L2015" name="L2015"></a>2015                 <strong class="reserved">long</strong> nc = ((AC_MASK &amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) |
<a id="L2016" name="L2016"></a>2016                            (TC_MASK &amp; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + TC_UNIT)));
<a id="L2017" name="L2017"></a>2017                 <strong class="reserved">if</strong> (((rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>()) &amp; STOP) == 0)
<a id="L2018" name="L2018"></a>2018                     <a href="../D/10632.html" title="Multiple defined in 301 places.">add</a> = U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc);
<a id="L2019" name="L2019"></a>2019                 <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, rs &amp; ~RSLOCK);
<a id="L2020" name="L2020"></a>2020                 canBlock = <a href="../D/10632.html" title="Multiple defined in 301 places.">add</a> &amp;&amp; <a href="../S/1063.html#L1480" title="Defined at 1480 in src/java/util/concurrent/ForkJoinPool.java.">createWorker</a>(); <em class="comment">// throws on exception</em>
<a id="L2021" name="L2021"></a>2021             <em class="brace">}</em>
<a id="L2022" name="L2022"></a>2022         <em class="brace">}</em>
<a id="L2023" name="L2023"></a>2023         <strong class="reserved">return</strong> canBlock;
<a id="L2024" name="L2024"></a>2024     <em class="brace">}</em>
<a id="L2025" name="L2025"></a>2025 
<div class="comment">
      Helps and/or blocks until the given task is done or timeout.
      @param w caller
      @param task the task
      @param deadline for timed waits, if nonzero
      @return task status on exit</div>
<a id="L2034" name="L2034"></a>2034     <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/10435.html" title="Multiple referred from 3 places.">awaitJoin</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w, <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task, <strong class="reserved">long</strong> deadline) <em class="brace">{</em>
<a id="L2035" name="L2035"></a>2035         <strong class="reserved">int</strong> s = 0;
<a id="L2036" name="L2036"></a>2036         <strong class="reserved">if</strong> (task != <strong class="reserved">null</strong> &amp;&amp; w != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2037" name="L2037"></a>2037             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; prevJoin = w.currentJoin;
<a id="L2038" name="L2038"></a>2038             U.putOrderedObject(w, QCURRENTJOIN, task);
<a id="L2039" name="L2039"></a>2039             <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; cc = (task <strong class="reserved">instanceof</strong> <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>) ?
<a id="L2040" name="L2040"></a>2040                 (<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt;)task : <strong class="reserved">null</strong>;
<a id="L2041" name="L2041"></a>2041             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L2042" name="L2042"></a>2042                 <strong class="reserved">if</strong> ((s = task.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a>) &lt; 0)
<a id="L2043" name="L2043"></a>2043                     <strong class="reserved">break</strong>;
<a id="L2044" name="L2044"></a>2044                 <strong class="reserved">if</strong> (cc != <strong class="reserved">null</strong>)
<a id="L2045" name="L2045"></a>2045                     <a href="../D/24232.html" title="Multiple defined in 2 places.">helpComplete</a>(w, cc, 0);
<a id="L2046" name="L2046"></a>2046                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (w.base == w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> || w.<a href="../S/1063.html#L1086" title="Defined at 1086 in src/java/util/concurrent/ForkJoinPool.java.">tryRemoveAndExec</a>(task))
<a id="L2047" name="L2047"></a>2047                     <a href="../S/1063.html#L1912" title="Defined at 1912 in src/java/util/concurrent/ForkJoinPool.java.">helpStealer</a>(w, task);
<a id="L2048" name="L2048"></a>2048                 <strong class="reserved">if</strong> ((s = task.<a href="../S/2277.html#L669" title="Defined at 669 in src/java/awt/image/PixelGrabber.java.">status</a>) &lt; 0)
<a id="L2049" name="L2049"></a>2049                     <strong class="reserved">break</strong>;
<a id="L2050" name="L2050"></a>2050                 <strong class="reserved">long</strong> ms, ns;
<a id="L2051" name="L2051"></a>2051                 <strong class="reserved">if</strong> (deadline == 0L)
<a id="L2052" name="L2052"></a>2052                     ms = 0L;
<a id="L2053" name="L2053"></a>2053                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((ns = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>()) &lt;= 0L)
<a id="L2054" name="L2054"></a>2054                     <strong class="reserved">break</strong>;
<a id="L2055" name="L2055"></a>2055                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((ms = <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a>.NANOSECONDS.<a href="../D/35444.html" title="Multiple defined in 3 places.">toMillis</a>(ns)) &lt;= 0L)
<a id="L2056" name="L2056"></a>2056                     ms = 1L;
<a id="L2057" name="L2057"></a>2057                 <strong class="reserved">if</strong> (<a href="../S/1063.html#L1981" title="Defined at 1981 in src/java/util/concurrent/ForkJoinPool.java.">tryCompensate</a>(w)) <em class="brace">{</em>
<a id="L2058" name="L2058"></a>2058                     task.<a href="../S/1101.html#L305" title="Defined at 305 in src/java/util/concurrent/ForkJoinTask.java.">internalWait</a>(ms);
<a id="L2059" name="L2059"></a>2059                     U.getAndAddLong(<strong class="reserved">this</strong>, CTL, AC_UNIT);
<a id="L2060" name="L2060"></a>2060                 <em class="brace">}</em>
<a id="L2061" name="L2061"></a>2061             <em class="brace">}</em>
<a id="L2062" name="L2062"></a>2062             U.putOrderedObject(w, QCURRENTJOIN, prevJoin);
<a id="L2063" name="L2063"></a>2063         <em class="brace">}</em>
<a id="L2064" name="L2064"></a>2064         <strong class="reserved">return</strong> s;
<a id="L2065" name="L2065"></a>2065     <em class="brace">}</em>
<a id="L2066" name="L2066"></a>2066 
<a id="L2067" name="L2067"></a>2067     <em class="comment">// Specialized scanning</em>
<a id="L2068" name="L2068"></a>2068 
<div class="comment">
      Returns a (probably) non-empty steal queue, if one is found
      during a scan, else null.  This method must be retried by
      caller if, by the time it tries to use the queue, it is empty.</div>
<a id="L2074" name="L2074"></a>2074     <strong class="reserved">private</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> <a href="../R/14446.html" title="Multiple referred from 2 places.">findNonEmptyStealQueue</a>() <em class="brace">{</em>
<a id="L2075" name="L2075"></a>2075         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> m;  <em class="comment">// one-shot version of scan loop</em>
<a id="L2076" name="L2076"></a>2076         <strong class="reserved">int</strong> r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/28179.html" title="Multiple defined in 2 places.">nextSecondarySeed</a>();
<a id="L2077" name="L2077"></a>2077         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0) <em class="brace">{</em>
<a id="L2078" name="L2078"></a>2078             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> origin = r &amp; m, k = origin, oldSum = 0, checkSum = 0;;) <em class="brace">{</em>
<a id="L2079" name="L2079"></a>2079                 <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <strong class="reserved">int</strong> b;
<a id="L2080" name="L2080"></a>2080                 <strong class="reserved">if</strong> ((q = ws[k]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2081" name="L2081"></a>2081                     <strong class="reserved">if</strong> ((b = q.base) - q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &lt; 0)
<a id="L2082" name="L2082"></a>2082                         <strong class="reserved">return</strong> q;
<a id="L2083" name="L2083"></a>2083                     checkSum += b;
<a id="L2084" name="L2084"></a>2084                 <em class="brace">}</em>
<a id="L2085" name="L2085"></a>2085                 <strong class="reserved">if</strong> ((k = (k + 1) &amp; m) == origin) <em class="brace">{</em>
<a id="L2086" name="L2086"></a>2086                     <strong class="reserved">if</strong> (oldSum == (oldSum = checkSum))
<a id="L2087" name="L2087"></a>2087                         <strong class="reserved">break</strong>;
<a id="L2088" name="L2088"></a>2088                     checkSum = 0;
<a id="L2089" name="L2089"></a>2089                 <em class="brace">}</em>
<a id="L2090" name="L2090"></a>2090             <em class="brace">}</em>
<a id="L2091" name="L2091"></a>2091         <em class="brace">}</em>
<a id="L2092" name="L2092"></a>2092         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L2093" name="L2093"></a>2093     <em class="brace">}</em>
<a id="L2094" name="L2094"></a>2094 
<div class="comment">
      Runs tasks until <code>isQuiescent()</code>. We piggyback on
      active count ctl maintenance, but rather than blocking
      when tasks cannot be found, we rescan until all others cannot
      find tasks either.</div>
<a id="L2101" name="L2101"></a>2101     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/20313.html" title="Multiple referred from 2 places.">helpQuiescePool</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w) <em class="brace">{</em>
<a id="L2102" name="L2102"></a>2102         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; ps = w.currentSteal; <em class="comment">// save context</em>
<a id="L2103" name="L2103"></a>2103         <strong class="reserved">for</strong> (<strong class="reserved">boolean</strong> <a href="../D/10612.html" title="Multiple defined in 4 places.">active</a> = <strong class="reserved">true</strong>;;) <em class="brace">{</em>
<a id="L2104" name="L2104"></a>2104             <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t; <strong class="reserved">int</strong> b;
<a id="L2105" name="L2105"></a>2105             w.<a href="../S/1063.html#L1029" title="Defined at 1029 in src/java/util/concurrent/ForkJoinPool.java.">execLocalTasks</a>();     <em class="comment">// run locals before each scan</em>
<a id="L2106" name="L2106"></a>2106             <strong class="reserved">if</strong> ((q = <a href="../S/1063.html#L2074" title="Defined at 2074 in src/java/util/concurrent/ForkJoinPool.java.">findNonEmptyStealQueue</a>()) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2107" name="L2107"></a>2107                 <strong class="reserved">if</strong> (!<a href="../D/10612.html" title="Multiple defined in 4 places.">active</a>) <em class="brace">{</em>      <em class="comment">// re-establish active count</em>
<a id="L2108" name="L2108"></a>2108                     <a href="../D/10612.html" title="Multiple defined in 4 places.">active</a> = <strong class="reserved">true</strong>;
<a id="L2109" name="L2109"></a>2109                     U.getAndAddLong(<strong class="reserved">this</strong>, CTL, AC_UNIT);
<a id="L2110" name="L2110"></a>2110                 <em class="brace">}</em>
<a id="L2111" name="L2111"></a>2111                 <strong class="reserved">if</strong> ((b = q.base) - q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &lt; 0 &amp;&amp; (t = q.<a href="../S/1063.html#L928" title="Defined at 928 in src/java/util/concurrent/ForkJoinPool.java.">pollAt</a>(b)) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2112" name="L2112"></a>2112                     U.putOrderedObject(w, QCURRENTSTEAL, t);
<a id="L2113" name="L2113"></a>2113                     t.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L2114" name="L2114"></a>2114                     <strong class="reserved">if</strong> (++w.nsteals &lt; 0)
<a id="L2115" name="L2115"></a>2115                         w.<a href="../S/1063.html#L1071" title="Defined at 1071 in src/java/util/concurrent/ForkJoinPool.java.">transferStealCount</a>(<strong class="reserved">this</strong>);
<a id="L2116" name="L2116"></a>2116                 <em class="brace">}</em>
<a id="L2117" name="L2117"></a>2117             <em class="brace">}</em>
<a id="L2118" name="L2118"></a>2118             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10612.html" title="Multiple defined in 4 places.">active</a>) <em class="brace">{</em>      <em class="comment">// decrement active count without queuing</em>
<a id="L2119" name="L2119"></a>2119                 <strong class="reserved">long</strong> nc = (AC_MASK &amp; ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl) - AC_UNIT)) | (~AC_MASK &amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L2120" name="L2120"></a>2120                 <strong class="reserved">if</strong> ((<strong class="reserved">int</strong>)(nc &gt;&gt; AC_SHIFT) + (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) &lt;= 0)
<a id="L2121" name="L2121"></a>2121                     <strong class="reserved">break</strong>;          <em class="comment">// bypass decrement-then-increment</em>
<a id="L2122" name="L2122"></a>2122                 <strong class="reserved">if</strong> (U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, nc))
<a id="L2123" name="L2123"></a>2123                     <a href="../D/10612.html" title="Multiple defined in 4 places.">active</a> = <strong class="reserved">false</strong>;
<a id="L2124" name="L2124"></a>2124             <em class="brace">}</em>
<a id="L2125" name="L2125"></a>2125             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((<strong class="reserved">int</strong>)((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl) &gt;&gt; AC_SHIFT) + (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) &lt;= 0 &amp;&amp;
<a id="L2126" name="L2126"></a>2126                      U.compareAndSwapLong(<strong class="reserved">this</strong>, CTL, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> + AC_UNIT))
<a id="L2127" name="L2127"></a>2127                 <strong class="reserved">break</strong>;
<a id="L2128" name="L2128"></a>2128         <em class="brace">}</em>
<a id="L2129" name="L2129"></a>2129         U.putOrderedObject(w, QCURRENTSTEAL, ps);
<a id="L2130" name="L2130"></a>2130     <em class="brace">}</em>
<a id="L2131" name="L2131"></a>2131 
<div class="comment">
      Gets and removes a local or stolen task for the given worker.
      @return a task, if available</div>
<a id="L2137" name="L2137"></a>2137     <strong class="reserved">final</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../S/1101.html#L1298" title="Referred from 1298 in src/java/util/concurrent/ForkJoinTask.java.">nextTaskFor</a>(<a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w) <em class="brace">{</em>
<a id="L2138" name="L2138"></a>2138         <strong class="reserved">for</strong> (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;;) <em class="brace">{</em>
<a id="L2139" name="L2139"></a>2139             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <strong class="reserved">int</strong> b;
<a id="L2140" name="L2140"></a>2140             <strong class="reserved">if</strong> ((t = w.<a href="../S/1063.html#L966" title="Defined at 966 in src/java/util/concurrent/ForkJoinPool.java.">nextLocalTask</a>()) != <strong class="reserved">null</strong>)
<a id="L2141" name="L2141"></a>2141                 <strong class="reserved">return</strong> t;
<a id="L2142" name="L2142"></a>2142             <strong class="reserved">if</strong> ((q = <a href="../S/1063.html#L2074" title="Defined at 2074 in src/java/util/concurrent/ForkJoinPool.java.">findNonEmptyStealQueue</a>()) == <strong class="reserved">null</strong>)
<a id="L2143" name="L2143"></a>2143                 <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L2144" name="L2144"></a>2144             <strong class="reserved">if</strong> ((b = q.base) - q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &lt; 0 &amp;&amp; (t = q.<a href="../S/1063.html#L928" title="Defined at 928 in src/java/util/concurrent/ForkJoinPool.java.">pollAt</a>(b)) != <strong class="reserved">null</strong>)
<a id="L2145" name="L2145"></a>2145                 <strong class="reserved">return</strong> t;
<a id="L2146" name="L2146"></a>2146         <em class="brace">}</em>
<a id="L2147" name="L2147"></a>2147     <em class="brace">}</em>
<a id="L2148" name="L2148"></a>2148 
<div class="comment">
      Returns a cheap heuristic guide for task partitioning when
      programmers, frameworks, tools, or languages have little or no
      idea about task granularity.  In essence, by offering this
      method, we ask users only about tradeoffs in overhead vs
      expected throughput and its variance, rather than how finely to
      partition tasks.
      In a steady state strict (tree-structured) computation, each
      thread makes available for stealing enough tasks for other
      threads to remain active. Inductively, if all threads play by
      the same rules, each thread should make available only a
      constant number of tasks.
      The minimum useful constant is just 1. But using a value of 1
      would require immediate replenishment upon each steal to
      maintain enough tasks, which is infeasible.  Further,
      partitionings/granularities of offered tasks should minimize
      steal rates, which in general means that threads nearer the top
      of computation tree should generate more than those nearer the
      bottom. In perfect steady state, each thread is at
      approximately the same level of computation tree. However,
      producing extra tasks amortizes the uncertainty of progress and
      diffusion assumptions.
      So, users will want to use values larger (but not much larger)
      than 1 to both smooth over transient shortages and hedge
      against uneven progress; as traded off against the cost of
      extra task overhead. We leave the user to pick a threshold
      value to compare with the results of this call to guide
      decisions, but recommend values such as 3.
      When all threads are active, it is on average OK to estimate
      surplus strictly locally. In steady-state, if one thread is
      maintaining say 2 surplus tasks, then so are others. So we can
      just use estimated queue length.  However, this strategy alone
      leads to serious mis-estimates in some non-steady-state
      conditions (ramp-up, ramp-down, other stalls). We can detect
      many of these by further considering the number of "idle"
      threads, that are known to have zero queued tasks, so
      compensate by a factor of (#idle/#active) threads.</div>
<a id="L2191" name="L2191"></a>2191     <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../S/1101.html#L1204" title="Referred from 1204 in src/java/util/concurrent/ForkJoinTask.java.">getSurplusQueuedTaskCount</a>() <em class="brace">{</em>
<a id="L2192" name="L2192"></a>2192         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t; <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt; <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> pool; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q;
<a id="L2193" name="L2193"></a>2193         <strong class="reserved">if</strong> (((t = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>()) <strong class="reserved">instanceof</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>)) <em class="brace">{</em>
<a id="L2194" name="L2194"></a>2194             <strong class="reserved">int</strong> p = (pool = (wt = (<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>)t).pool).
<a id="L2195" name="L2195"></a>2195                 <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK;
<a id="L2196" name="L2196"></a>2196             <strong class="reserved">int</strong> n = (q = wt.workQueue).<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> - q.base;
<a id="L2197" name="L2197"></a>2197             <strong class="reserved">int</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = (<strong class="reserved">int</strong>)(pool.ctl &gt;&gt; AC_SHIFT) + p;
<a id="L2198" name="L2198"></a>2198             <strong class="reserved">return</strong> n - (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &gt; (p &gt;&gt;&gt;= 1) ? 0 :
<a id="L2199" name="L2199"></a>2199                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &gt; (p &gt;&gt;&gt;= 1) ? 1 :
<a id="L2200" name="L2200"></a>2200                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &gt; (p &gt;&gt;&gt;= 1) ? 2 :
<a id="L2201" name="L2201"></a>2201                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &gt; (p &gt;&gt;&gt;= 1) ? 4 :
<a id="L2202" name="L2202"></a>2202                         8);
<a id="L2203" name="L2203"></a>2203         <em class="brace">}</em>
<a id="L2204" name="L2204"></a>2204         <strong class="reserved">return</strong> 0;
<a id="L2205" name="L2205"></a>2205     <em class="brace">}</em>
<a id="L2206" name="L2206"></a>2206 
<a id="L2207" name="L2207"></a>2207     <em class="comment">//  Termination</em>
<a id="L2208" name="L2208"></a>2208 
<div class="comment">
      Possibly initiates and/or completes termination.
      @param now if true, unconditionally terminate, else only
      if no work and no active workers
      @param enable if true, enable shutdown when next possible
      @return true if now terminating or terminated</div>
<a id="L2217" name="L2217"></a>2217     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/29564.html" title="Multiple referred from 12 places.">tryTerminate</a>(<strong class="reserved">boolean</strong> <a href="../D/28344.html" title="Multiple defined in 43 places.">now</a>, <strong class="reserved">boolean</strong> <a href="../D/15371.html" title="Multiple defined in 6 places.">enable</a>) <em class="brace">{</em>
<a id="L2218" name="L2218"></a>2218         <strong class="reserved">int</strong> rs;
<a id="L2219" name="L2219"></a>2219         <strong class="reserved">if</strong> (<strong class="reserved">this</strong> == common)                       <em class="comment">// cannot shut down</em>
<a id="L2220" name="L2220"></a>2220             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L2221" name="L2221"></a>2221         <strong class="reserved">if</strong> ((rs = runState) &gt;= 0) <em class="brace">{</em>
<a id="L2222" name="L2222"></a>2222             <strong class="reserved">if</strong> (!<a href="../D/15371.html" title="Multiple defined in 6 places.">enable</a>)
<a id="L2223" name="L2223"></a>2223                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L2224" name="L2224"></a>2224             rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();                  <em class="comment">// enter SHUTDOWN phase</em>
<a id="L2225" name="L2225"></a>2225             <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, (rs &amp; ~RSLOCK) | SHUTDOWN);
<a id="L2226" name="L2226"></a>2226         <em class="brace">}</em>
<a id="L2227" name="L2227"></a>2227 
<a id="L2228" name="L2228"></a>2228         <strong class="reserved">if</strong> ((rs &amp; STOP) == 0) <em class="brace">{</em>
<a id="L2229" name="L2229"></a>2229             <strong class="reserved">if</strong> (!<a href="../D/28344.html" title="Multiple defined in 43 places.">now</a>) <em class="brace">{</em>                           <em class="comment">// check quiescence</em>
<a id="L2230" name="L2230"></a>2230                 <strong class="reserved">for</strong> (<strong class="reserved">long</strong> oldSum = 0L;;) <em class="brace">{</em>        <em class="comment">// repeat until stable</em>
<a id="L2231" name="L2231"></a>2231                     <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w; <strong class="reserved">int</strong> m, b; <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L2232" name="L2232"></a>2232                     <strong class="reserved">long</strong> checkSum = ctl;
<a id="L2233" name="L2233"></a>2233                     <strong class="reserved">if</strong> ((<strong class="reserved">int</strong>)(checkSum &gt;&gt; AC_SHIFT) + (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) &gt; 0)
<a id="L2234" name="L2234"></a>2234                         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;             <em class="comment">// still active workers</em>
<a id="L2235" name="L2235"></a>2235                     <strong class="reserved">if</strong> ((ws = workQueues) == <strong class="reserved">null</strong> || (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt;= 0)
<a id="L2236" name="L2236"></a>2236                         <strong class="reserved">break</strong>;                    <em class="comment">// check queues</em>
<a id="L2237" name="L2237"></a>2237                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt;= m; ++i) <em class="brace">{</em>
<a id="L2238" name="L2238"></a>2238                         <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2239" name="L2239"></a>2239                             <strong class="reserved">if</strong> ((b = w.base) != w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> || w.scanState &gt;= 0 ||
<a id="L2240" name="L2240"></a>2240                                 w.currentSteal != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2241" name="L2241"></a>2241                                 <a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl, ws[m &amp; (<strong class="reserved">int</strong>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>], AC_UNIT);
<a id="L2242" name="L2242"></a>2242                                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;     <em class="comment">// arrange for recheck</em>
<a id="L2243" name="L2243"></a>2243                             <em class="brace">}</em>
<a id="L2244" name="L2244"></a>2244                             checkSum += b;
<a id="L2245" name="L2245"></a>2245                             <strong class="reserved">if</strong> ((i &amp; 1) == 0)
<a id="L2246" name="L2246"></a>2246                                 w.qlock = -1;     <em class="comment">// try to disable external</em>
<a id="L2247" name="L2247"></a>2247                         <em class="brace">}</em>
<a id="L2248" name="L2248"></a>2248                     <em class="brace">}</em>
<a id="L2249" name="L2249"></a>2249                     <strong class="reserved">if</strong> (oldSum == (oldSum = checkSum))
<a id="L2250" name="L2250"></a>2250                         <strong class="reserved">break</strong>;
<a id="L2251" name="L2251"></a>2251                 <em class="brace">}</em>
<a id="L2252" name="L2252"></a>2252             <em class="brace">}</em>
<a id="L2253" name="L2253"></a>2253             <strong class="reserved">if</strong> ((runState &amp; STOP) == 0) <em class="brace">{</em>
<a id="L2254" name="L2254"></a>2254                 rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();              <em class="comment">// enter STOP phase</em>
<a id="L2255" name="L2255"></a>2255                 <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, (rs &amp; ~RSLOCK) | STOP);
<a id="L2256" name="L2256"></a>2256             <em class="brace">}</em>
<a id="L2257" name="L2257"></a>2257         <em class="brace">}</em>
<a id="L2258" name="L2258"></a>2258 
<a id="L2259" name="L2259"></a>2259         <strong class="reserved">int</strong> pass = 0;                             <em class="comment">// 3 passes to help terminate</em>
<a id="L2260" name="L2260"></a>2260         <strong class="reserved">for</strong> (<strong class="reserved">long</strong> oldSum = 0L;;) <em class="brace">{</em>                <em class="comment">// or until done or stable</em>
<a id="L2261" name="L2261"></a>2261             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w; <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt; <strong class="reserved">int</strong> m;
<a id="L2262" name="L2262"></a>2262             <strong class="reserved">long</strong> checkSum = ctl;
<a id="L2263" name="L2263"></a>2263             <strong class="reserved">if</strong> ((<strong class="reserved">short</strong>)(checkSum &gt;&gt;&gt; TC_SHIFT) + (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) &lt;= 0 ||
<a id="L2264" name="L2264"></a>2264                 (ws = workQueues) == <strong class="reserved">null</strong> || (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt;= 0) <em class="brace">{</em>
<a id="L2265" name="L2265"></a>2265                 <strong class="reserved">if</strong> ((runState &amp; TERMINATED) == 0) <em class="brace">{</em>
<a id="L2266" name="L2266"></a>2266                     rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();          <em class="comment">// done</em>
<a id="L2267" name="L2267"></a>2267                     <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, (rs &amp; ~RSLOCK) | TERMINATED);
<a id="L2268" name="L2268"></a>2268                     <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em> <a href="../S/1724.html#L295" title="Defined at 295 in src/java/lang/Object.java.">notifyAll</a>(); <em class="brace">}</em> <em class="comment">// for awaitTermination</em>
<a id="L2269" name="L2269"></a>2269                 <em class="brace">}</em>
<a id="L2270" name="L2270"></a>2270                 <strong class="reserved">break</strong>;
<a id="L2271" name="L2271"></a>2271             <em class="brace">}</em>
<a id="L2272" name="L2272"></a>2272             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt;= m; ++i) <em class="brace">{</em>
<a id="L2273" name="L2273"></a>2273                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2274" name="L2274"></a>2274                     checkSum += w.base;
<a id="L2275" name="L2275"></a>2275                     w.qlock = -1;                 <em class="comment">// try to disable</em>
<a id="L2276" name="L2276"></a>2276                     <strong class="reserved">if</strong> (pass &gt; 0) <em class="brace">{</em>
<a id="L2277" name="L2277"></a>2277                         w.<a href="../S/1063.html#L1000" title="Defined at 1000 in src/java/util/concurrent/ForkJoinPool.java.">cancelAll</a>();            <em class="comment">// clear queue</em>
<a id="L2278" name="L2278"></a>2278                         <strong class="reserved">if</strong> (pass &gt; 1 &amp;&amp; (wt = w.<a href="../D/28636.html" title="Multiple defined in 2 places.">owner</a>) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2279" name="L2279"></a>2279                             <strong class="reserved">if</strong> (!wt.<a href="../D/25738.html" title="Multiple defined in 2 places.">isInterrupted</a>()) <em class="brace">{</em>
<a id="L2280" name="L2280"></a>2280                                 <strong class="reserved">try</strong> <em class="brace">{</em>             <em class="comment">// unblock join</em>
<a id="L2281" name="L2281"></a>2281                                     wt.<a href="../D/24969.html" title="Multiple defined in 3 places.">interrupt</a>();
<a id="L2282" name="L2282"></a>2282                                 <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> <a href="../D/24317.html" title="Multiple defined in 3 places.">ignore</a>) <em class="brace">{</em>
<a id="L2283" name="L2283"></a>2283                                 <em class="brace">}</em>
<a id="L2284" name="L2284"></a>2284                             <em class="brace">}</em>
<a id="L2285" name="L2285"></a>2285                             <strong class="reserved">if</strong> (w.scanState &lt; 0)
<a id="L2286" name="L2286"></a>2286                                 U.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(wt);     <em class="comment">// wake up</em>
<a id="L2287" name="L2287"></a>2287                         <em class="brace">}</em>
<a id="L2288" name="L2288"></a>2288                     <em class="brace">}</em>
<a id="L2289" name="L2289"></a>2289                 <em class="brace">}</em>
<a id="L2290" name="L2290"></a>2290             <em class="brace">}</em>
<a id="L2291" name="L2291"></a>2291             <strong class="reserved">if</strong> (checkSum != oldSum) <em class="brace">{</em>             <em class="comment">// unstable</em>
<a id="L2292" name="L2292"></a>2292                 oldSum = checkSum;
<a id="L2293" name="L2293"></a>2293                 pass = 0;
<a id="L2294" name="L2294"></a>2294             <em class="brace">}</em>
<a id="L2295" name="L2295"></a>2295             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (pass &gt; 3 &amp;&amp; pass &gt; m)        <em class="comment">// can't further help</em>
<a id="L2296" name="L2296"></a>2296                 <strong class="reserved">break</strong>;
<a id="L2297" name="L2297"></a>2297             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (++pass &gt; 1) <em class="brace">{</em>                <em class="comment">// try to dequeue</em>
<a id="L2298" name="L2298"></a>2298                 <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>; <strong class="reserved">int</strong> j = 0, sp;            <em class="comment">// bound attempts</em>
<a id="L2299" name="L2299"></a>2299                 <strong class="reserved">while</strong> (j++ &lt;= m &amp;&amp; (sp = (<strong class="reserved">int</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl)) != 0)
<a id="L2300" name="L2300"></a>2300                     <a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, ws[sp &amp; m], AC_UNIT);
<a id="L2301" name="L2301"></a>2301             <em class="brace">}</em>
<a id="L2302" name="L2302"></a>2302         <em class="brace">}</em>
<a id="L2303" name="L2303"></a>2303         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L2304" name="L2304"></a>2304     <em class="brace">}</em>
<a id="L2305" name="L2305"></a>2305 
<a id="L2306" name="L2306"></a>2306     <em class="comment">// External operations</em>
<a id="L2307" name="L2307"></a>2307 
<div class="comment">
      Full version of externalPush, handling uncommon cases, as well
      as performing secondary initialization upon the first
      submission of the first task to the pool.  It also detects
      first submission by an external thread and creates a new shared
      queue if the one at index if empty or contended.
      @param task the task. Caller must ensure non-null.</div>
<a id="L2317" name="L2317"></a>2317     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/1063.html#L2419" title="Referred from 2419 in src/java/util/concurrent/ForkJoinPool.java.">externalSubmit</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L2318" name="L2318"></a>2318         <strong class="reserved">int</strong> r;                                    <em class="comment">// initialize caller's probe</em>
<a id="L2319" name="L2319"></a>2319         <strong class="reserved">if</strong> ((r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/21692.html" title="Multiple defined in 2 places.">getProbe</a>()) == 0) <em class="brace">{</em>
<a id="L2320" name="L2320"></a>2320             <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../S/1056.html#L207" title="Defined at 207 in src/java/util/concurrent/ThreadLocalRandom.java.">localInit</a>();
<a id="L2321" name="L2321"></a>2321             r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/21692.html" title="Multiple defined in 2 places.">getProbe</a>();
<a id="L2322" name="L2322"></a>2322         <em class="brace">}</em>
<a id="L2323" name="L2323"></a>2323         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L2324" name="L2324"></a>2324             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <strong class="reserved">int</strong> rs, m, k;
<a id="L2325" name="L2325"></a>2325             <strong class="reserved">boolean</strong> <a href="../D/27802.html" title="Multiple defined in 8 places.">move</a> = <strong class="reserved">false</strong>;
<a id="L2326" name="L2326"></a>2326             <strong class="reserved">if</strong> ((rs = runState) &lt; 0) <em class="brace">{</em>
<a id="L2327" name="L2327"></a>2327                 <a href="../D/35739.html" title="Multiple defined in 2 places.">tryTerminate</a>(<strong class="reserved">false</strong>, <strong class="reserved">false</strong>);     <em class="comment">// help terminate</em>
<a id="L2328" name="L2328"></a>2328                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1055.html#L45" title="Defined at 45 in src/java/util/concurrent/RejectedExecutionException.java.">RejectedExecutionException</a>();
<a id="L2329" name="L2329"></a>2329             <em class="brace">}</em>
<a id="L2330" name="L2330"></a>2330             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((rs &amp; STARTED) == 0 ||     <em class="comment">// initialize</em>
<a id="L2331" name="L2331"></a>2331                      ((ws = workQueues) == <strong class="reserved">null</strong> || (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &lt; 0)) <em class="brace">{</em>
<a id="L2332" name="L2332"></a>2332                 <strong class="reserved">int</strong> ns = 0;
<a id="L2333" name="L2333"></a>2333                 rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();
<a id="L2334" name="L2334"></a>2334                 <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L2335" name="L2335"></a>2335                     <strong class="reserved">if</strong> ((rs &amp; STARTED) == 0) <em class="brace">{</em>
<a id="L2336" name="L2336"></a>2336                         U.compareAndSwapObject(<strong class="reserved">this</strong>, STEALCOUNTER, <strong class="reserved">null</strong>,
<a id="L2337" name="L2337"></a>2337                                                <strong class="reserved">new</strong> <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a>());
<a id="L2338" name="L2338"></a>2338                         <em class="comment">// create workQueues array with size a power of two</em>
<a id="L2339" name="L2339"></a>2339                         <strong class="reserved">int</strong> p = <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK; <em class="comment">// ensure at least 2 slots</em>
<a id="L2340" name="L2340"></a>2340                         <strong class="reserved">int</strong> n = (p &gt; 1) ? p - 1 : 1;
<a id="L2341" name="L2341"></a>2341                         n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2;  n |= n &gt;&gt;&gt; 4;
<a id="L2342" name="L2342"></a>2342                         n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; n = (n + 1) &lt;&lt; 1;
<a id="L2343" name="L2343"></a>2343                         workQueues = <strong class="reserved">new</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[n];
<a id="L2344" name="L2344"></a>2344                         ns = STARTED;
<a id="L2345" name="L2345"></a>2345                     <em class="brace">}</em>
<a id="L2346" name="L2346"></a>2346                 <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L2347" name="L2347"></a>2347                     <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, (rs &amp; ~RSLOCK) | ns);
<a id="L2348" name="L2348"></a>2348                 <em class="brace">}</em>
<a id="L2349" name="L2349"></a>2349             <em class="brace">}</em>
<a id="L2350" name="L2350"></a>2350             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((q = ws[k = r &amp; m &amp; SQMASK]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2351" name="L2351"></a>2351                 <strong class="reserved">if</strong> (q.qlock == 0 &amp;&amp; U.compareAndSwapInt(q, QLOCK, 0, 1)) <em class="brace">{</em>
<a id="L2352" name="L2352"></a>2352                     <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = q.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>;
<a id="L2353" name="L2353"></a>2353                     <strong class="reserved">int</strong> s = q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>;
<a id="L2354" name="L2354"></a>2354                     <strong class="reserved">boolean</strong> submitted = <strong class="reserved">false</strong>; <em class="comment">// initial submission or resizing</em>
<a id="L2355" name="L2355"></a>2355                     <strong class="reserved">try</strong> <em class="brace">{</em>                      <em class="comment">// locked version of push</em>
<a id="L2356" name="L2356"></a>2356                         <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt; s + 1 - q.base) ||
<a id="L2357" name="L2357"></a>2357                             (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = q.<a href="../D/23922.html" title="Multiple defined in 2 places.">growArray</a>()) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2358" name="L2358"></a>2358                             <strong class="reserved">int</strong> j = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; s) &lt;&lt; ASHIFT) + ABASE;
<a id="L2359" name="L2359"></a>2359                             U.putOrderedObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, task);
<a id="L2360" name="L2360"></a>2360                             U.putOrderedInt(q, QTOP, s + 1);
<a id="L2361" name="L2361"></a>2361                             submitted = <strong class="reserved">true</strong>;
<a id="L2362" name="L2362"></a>2362                         <em class="brace">}</em>
<a id="L2363" name="L2363"></a>2363                     <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L2364" name="L2364"></a>2364                         U.compareAndSwapInt(q, QLOCK, 1, 0);
<a id="L2365" name="L2365"></a>2365                     <em class="brace">}</em>
<a id="L2366" name="L2366"></a>2366                     <strong class="reserved">if</strong> (submitted) <em class="brace">{</em>
<a id="L2367" name="L2367"></a>2367                         <a href="../S/1063.html#L1629" title="Defined at 1629 in src/java/util/concurrent/ForkJoinPool.java.">signalWork</a>(ws, q);
<a id="L2368" name="L2368"></a>2368                         <strong class="reserved">return</strong>;
<a id="L2369" name="L2369"></a>2369                     <em class="brace">}</em>
<a id="L2370" name="L2370"></a>2370                 <em class="brace">}</em>
<a id="L2371" name="L2371"></a>2371                 <a href="../D/27802.html" title="Multiple defined in 8 places.">move</a> = <strong class="reserved">true</strong>;                   <em class="comment">// move on failure</em>
<a id="L2372" name="L2372"></a>2372             <em class="brace">}</em>
<a id="L2373" name="L2373"></a>2373             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (((rs = runState) &amp; RSLOCK) == 0) <em class="brace">{</em> <em class="comment">// create new queue</em>
<a id="L2374" name="L2374"></a>2374                 q = <strong class="reserved">new</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>(<strong class="reserved">this</strong>, <strong class="reserved">null</strong>);
<a id="L2375" name="L2375"></a>2375                 q.hint = r;
<a id="L2376" name="L2376"></a>2376                 q.<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> = k | SHARED_QUEUE;
<a id="L2377" name="L2377"></a>2377                 q.scanState = <a href="../S/480.html#L11" title="Defined at 11 in src/org/omg/PortableInterceptor/INACTIVE.java.">INACTIVE</a>;
<a id="L2378" name="L2378"></a>2378                 rs = <a href="../S/1063.html#L1403" title="Defined at 1403 in src/java/util/concurrent/ForkJoinPool.java.">lockRunState</a>();           <em class="comment">// publish index</em>
<a id="L2379" name="L2379"></a>2379                 <strong class="reserved">if</strong> (rs &gt; 0 &amp;&amp;  (ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L2380" name="L2380"></a>2380                     k &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &amp;&amp; ws[k] == <strong class="reserved">null</strong>)
<a id="L2381" name="L2381"></a>2381                     ws[k] = q;                 <em class="comment">// else terminated</em>
<a id="L2382" name="L2382"></a>2382                 <a href="../S/1063.html#L1462" title="Defined at 1462 in src/java/util/concurrent/ForkJoinPool.java.">unlockRunState</a>(rs, rs &amp; ~RSLOCK);
<a id="L2383" name="L2383"></a>2383             <em class="brace">}</em>
<a id="L2384" name="L2384"></a>2384             <strong class="reserved">else</strong>
<a id="L2385" name="L2385"></a>2385                 <a href="../D/27802.html" title="Multiple defined in 8 places.">move</a> = <strong class="reserved">true</strong>;                   <em class="comment">// move if busy</em>
<a id="L2386" name="L2386"></a>2386             <strong class="reserved">if</strong> (<a href="../D/27802.html" title="Multiple defined in 8 places.">move</a>)
<a id="L2387" name="L2387"></a>2387                 r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/11251.html" title="Multiple defined in 2 places.">advanceProbe</a>(r);
<a id="L2388" name="L2388"></a>2388         <em class="brace">}</em>
<a id="L2389" name="L2389"></a>2389     <em class="brace">}</em>
<a id="L2390" name="L2390"></a>2390 
<div class="comment">
      Tries to add the given task to a submission queue at
      submitter's current queue. Only the (vastly) most common path
      is directly handled in this method, while screening for need
      for externalSubmit.
      @param task the task. Caller must ensure non-null.</div>
<a id="L2399" name="L2399"></a>2399     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14192.html" title="Multiple referred from 9 places.">externalPush</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L2400" name="L2400"></a>2400         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <strong class="reserved">int</strong> m;
<a id="L2401" name="L2401"></a>2401         <strong class="reserved">int</strong> r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/21692.html" title="Multiple defined in 2 places.">getProbe</a>();
<a id="L2402" name="L2402"></a>2402         <strong class="reserved">int</strong> rs = runState;
<a id="L2403" name="L2403"></a>2403         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; (m = (ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1)) &gt;= 0 &amp;&amp;
<a id="L2404" name="L2404"></a>2404             (q = ws[m &amp; r &amp; SQMASK]) != <strong class="reserved">null</strong> &amp;&amp; r != 0 &amp;&amp; rs &gt; 0 &amp;&amp;
<a id="L2405" name="L2405"></a>2405             U.compareAndSwapInt(q, QLOCK, 0, 1)) <em class="brace">{</em>
<a id="L2406" name="L2406"></a>2406             <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> am, n, s;
<a id="L2407" name="L2407"></a>2407             <strong class="reserved">if</strong> ((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = q.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L2408" name="L2408"></a>2408                 (am = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt; (n = (s = q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) - q.base)) <em class="brace">{</em>
<a id="L2409" name="L2409"></a>2409                 <strong class="reserved">int</strong> j = ((am &amp; s) &lt;&lt; ASHIFT) + ABASE;
<a id="L2410" name="L2410"></a>2410                 U.putOrderedObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, task);
<a id="L2411" name="L2411"></a>2411                 U.putOrderedInt(q, QTOP, s + 1);
<a id="L2412" name="L2412"></a>2412                 U.putIntVolatile(q, QLOCK, 0);
<a id="L2413" name="L2413"></a>2413                 <strong class="reserved">if</strong> (n &lt;= 1)
<a id="L2414" name="L2414"></a>2414                     <a href="../S/1063.html#L1629" title="Defined at 1629 in src/java/util/concurrent/ForkJoinPool.java.">signalWork</a>(ws, q);
<a id="L2415" name="L2415"></a>2415                 <strong class="reserved">return</strong>;
<a id="L2416" name="L2416"></a>2416             <em class="brace">}</em>
<a id="L2417" name="L2417"></a>2417             U.compareAndSwapInt(q, QLOCK, 1, 0);
<a id="L2418" name="L2418"></a>2418         <em class="brace">}</em>
<a id="L2419" name="L2419"></a>2419         <a href="../S/1063.html#L2317" title="Defined at 2317 in src/java/util/concurrent/ForkJoinPool.java.">externalSubmit</a>(task);
<a id="L2420" name="L2420"></a>2420     <em class="brace">}</em>
<a id="L2421" name="L2421"></a>2421 
<div class="comment">
      Returns common pool queue for an external thread.</div>
<a id="L2425" name="L2425"></a>2425     <strong class="reserved">static</strong> <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> <a href="../R/11679.html" title="Multiple referred from 2 places.">commonSubmitterQueue</a>() <em class="brace">{</em>
<a id="L2426" name="L2426"></a>2426         <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> p = common;
<a id="L2427" name="L2427"></a>2427         <strong class="reserved">int</strong> r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/21692.html" title="Multiple defined in 2 places.">getProbe</a>();
<a id="L2428" name="L2428"></a>2428         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> m;
<a id="L2429" name="L2429"></a>2429         <strong class="reserved">return</strong> (p != <strong class="reserved">null</strong> &amp;&amp; (ws = p.workQueues) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L2430" name="L2430"></a>2430                 (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0) ?
<a id="L2431" name="L2431"></a>2431             ws[m &amp; r &amp; SQMASK] : <strong class="reserved">null</strong>;
<a id="L2432" name="L2432"></a>2432     <em class="brace">}</em>
<a id="L2433" name="L2433"></a>2433 
<div class="comment">
      Performs tryUnpush for an external submitter: Finds queue,
      locks if apparently non-empty, validates upon locking, and
      adjusts top. Each check can fail but rarely does.</div>
<a id="L2439" name="L2439"></a>2439     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29547.html" title="Multiple referred from 4 places.">tryExternalUnpush</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L2440" name="L2440"></a>2440         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <strong class="reserved">int</strong> m, s;
<a id="L2441" name="L2441"></a>2441         <strong class="reserved">int</strong> r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/21692.html" title="Multiple defined in 2 places.">getProbe</a>();
<a id="L2442" name="L2442"></a>2442         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp; (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0 &amp;&amp;
<a id="L2443" name="L2443"></a>2443             (w = ws[m &amp; r &amp; SQMASK]) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L2444" name="L2444"></a>2444             (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = w.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a>) != <strong class="reserved">null</strong> &amp;&amp; (s = w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a>) != w.base) <em class="brace">{</em>
<a id="L2445" name="L2445"></a>2445             <strong class="reserved">long</strong> j = (((<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &amp; (s - 1)) &lt;&lt; ASHIFT) + ABASE;
<a id="L2446" name="L2446"></a>2446             <strong class="reserved">if</strong> (U.compareAndSwapInt(w, QLOCK, 0, 1)) <em class="brace">{</em>
<a id="L2447" name="L2447"></a>2447                 <strong class="reserved">if</strong> (w.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> == s &amp;&amp; w.<a href="../D/11496.html" title="Multiple defined in 19 places.">array</a> == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> &amp;&amp;
<a id="L2448" name="L2448"></a>2448                     U.<a href="../D/21124.html" title="Multiple defined in 30 places.">getObject</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j) == task &amp;&amp;
<a id="L2449" name="L2449"></a>2449                     U.compareAndSwapObject(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, j, task, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L2450" name="L2450"></a>2450                     U.putOrderedInt(w, QTOP, s - 1);
<a id="L2451" name="L2451"></a>2451                     U.putOrderedInt(w, QLOCK, 0);
<a id="L2452" name="L2452"></a>2452                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L2453" name="L2453"></a>2453                 <em class="brace">}</em>
<a id="L2454" name="L2454"></a>2454                 U.compareAndSwapInt(w, QLOCK, 1, 0);
<a id="L2455" name="L2455"></a>2455             <em class="brace">}</em>
<a id="L2456" name="L2456"></a>2456         <em class="brace">}</em>
<a id="L2457" name="L2457"></a>2457         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L2458" name="L2458"></a>2458     <em class="brace">}</em>
<a id="L2459" name="L2459"></a>2459 
<div class="comment">
      Performs helpComplete for an external submitter.</div>
<a id="L2463" name="L2463"></a>2463     <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/14190.html" title="Multiple referred from 4 places.">externalHelpComplete</a>(<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; task, <strong class="reserved">int</strong> maxTasks) <em class="brace">{</em>
<a id="L2464" name="L2464"></a>2464         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <strong class="reserved">int</strong> n;
<a id="L2465" name="L2465"></a>2465         <strong class="reserved">int</strong> r = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/21692.html" title="Multiple defined in 2 places.">getProbe</a>();
<a id="L2466" name="L2466"></a>2466         <strong class="reserved">return</strong> ((ws = workQueues) == <strong class="reserved">null</strong> || (n = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) == 0) ? 0 :
<a id="L2467" name="L2467"></a>2467             <a href="../D/24232.html" title="Multiple defined in 2 places.">helpComplete</a>(ws[(n - 1) &amp; r &amp; SQMASK], task, maxTasks);
<a id="L2468" name="L2468"></a>2468     <em class="brace">}</em>
<a id="L2469" name="L2469"></a>2469 
<a id="L2470" name="L2470"></a>2470     <em class="comment">// Exported methods</em>
<a id="L2471" name="L2471"></a>2471 
<a id="L2472" name="L2472"></a>2472     <em class="comment">// Constructors</em>
<a id="L2473" name="L2473"></a>2473 
<div class="comment">
      Creates a <code>ForkJoinPool</code> with parallelism equal to {@link
      java.lang.Runtime#availableProcessors}, using the {@linkplain
      #defaultForkJoinWorkerThreadFactory default thread factory},
      no UncaughtExceptionHandler, and non-async LIFO processing mode.
      @throws SecurityException if a security manager exists and
              the caller is not permitted to modify threads
              because it does not hold {@link
              java.lang.RuntimePermission}<code>("modifyThread")</code></div>
<a id="L2485" name="L2485"></a>2485     <strong class="reserved">public</strong> ForkJoinPool() <em class="brace">{</em>
<a id="L2486" name="L2486"></a>2486         <strong class="reserved">this</strong>(<a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27697.html" title="Multiple defined in 28 places.">min</a>(MAX_CAP, <a href="../S/1774.html#L46" title="Defined at 46 in src/java/lang/Runtime.java.">Runtime</a>.<a href="../S/1774.html#L57" title="Defined at 57 in src/java/lang/Runtime.java.">getRuntime</a>().<a href="../S/1774.html#L635" title="Defined at 635 in src/java/lang/Runtime.java.">availableProcessors</a>()),
<a id="L2487" name="L2487"></a>2487              defaultForkJoinWorkerThreadFactory, <strong class="reserved">null</strong>, <strong class="reserved">false</strong>);
<a id="L2488" name="L2488"></a>2488     <em class="brace">}</em>
<a id="L2489" name="L2489"></a>2489 
<div class="comment">
      Creates a <code>ForkJoinPool</code> with the indicated parallelism
      level, the {@linkplain
      #defaultForkJoinWorkerThreadFactory default thread factory},
      no UncaughtExceptionHandler, and non-async LIFO processing mode.
      @param parallelism the parallelism level
      @throws IllegalArgumentException if parallelism less than or
              equal to zero, or greater than implementation limit
      @throws SecurityException if a security manager exists and
              the caller is not permitted to modify threads
              because it does not hold {@link
              java.lang.RuntimePermission}<code>("modifyThread")</code></div>
<a id="L2504" name="L2504"></a>2504     <strong class="reserved">public</strong> ForkJoinPool(<strong class="reserved">int</strong> parallelism) <em class="brace">{</em>
<a id="L2505" name="L2505"></a>2505         <strong class="reserved">this</strong>(parallelism, defaultForkJoinWorkerThreadFactory, <strong class="reserved">null</strong>, <strong class="reserved">false</strong>);
<a id="L2506" name="L2506"></a>2506     <em class="brace">}</em>
<a id="L2507" name="L2507"></a>2507 
<div class="comment">
      Creates a <code>ForkJoinPool</code> with the given parameters.
      @param parallelism the parallelism level. For default value,
      use {@link java.lang.Runtime#availableProcessors}.
      @param factory the factory for creating new threads. For default value,
      use {@link #defaultForkJoinWorkerThreadFactory}.
      @param handler the handler for internal worker threads that
      terminate due to unrecoverable errors encountered while executing
      tasks. For default value, use <code>null</code>.
      @param asyncMode if true,
      establishes local first-in-first-out scheduling mode for forked
      tasks that are never joined. This mode may be more appropriate
      than default locally stack-based mode in applications in which
      worker threads only process event-style asynchronous tasks.
      For default value, use <code>false</code>.
      @throws IllegalArgumentException if parallelism less than or
              equal to zero, or greater than implementation limit
      @throws NullPointerException if the factory is null
      @throws SecurityException if a security manager exists and
              the caller is not permitted to modify threads
              because it does not hold {@link
              java.lang.RuntimePermission}<code>("modifyThread")</code></div>
<a id="L2532" name="L2532"></a>2532     <strong class="reserved">public</strong> ForkJoinPool(<strong class="reserved">int</strong> parallelism,
<a id="L2533" name="L2533"></a>2533                         <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>,
<a id="L2534" name="L2534"></a>2534                         <a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a> <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>,
<a id="L2535" name="L2535"></a>2535                         <strong class="reserved">boolean</strong> asyncMode) <em class="brace">{</em>
<a id="L2536" name="L2536"></a>2536         <strong class="reserved">this</strong>(<a href="../S/1063.html#L2544" title="Defined at 2544 in src/java/util/concurrent/ForkJoinPool.java.">checkParallelism</a>(parallelism),
<a id="L2537" name="L2537"></a>2537              <a href="../S/1063.html#L2550" title="Defined at 2550 in src/java/util/concurrent/ForkJoinPool.java.">checkFactory</a>(<a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>),
<a id="L2538" name="L2538"></a>2538              <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>,
<a id="L2539" name="L2539"></a>2539              asyncMode ? FIFO_QUEUE : LIFO_QUEUE,
<a id="L2540" name="L2540"></a>2540              "ForkJoinPool-" + <a href="../S/1063.html#L1293" title="Defined at 1293 in src/java/util/concurrent/ForkJoinPool.java.">nextPoolId</a>() + "-worker-");
<a id="L2541" name="L2541"></a>2541         <a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>();
<a id="L2542" name="L2542"></a>2542     <em class="brace">}</em>
<a id="L2543" name="L2543"></a>2543 
<a id="L2544" name="L2544"></a>2544     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../S/1063.html#L2536" title="Referred from 2536 in src/java/util/concurrent/ForkJoinPool.java.">checkParallelism</a>(<strong class="reserved">int</strong> parallelism) <em class="brace">{</em>
<a id="L2545" name="L2545"></a>2545         <strong class="reserved">if</strong> (parallelism &lt;= 0 || parallelism &gt; MAX_CAP)
<a id="L2546" name="L2546"></a>2546             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>();
<a id="L2547" name="L2547"></a>2547         <strong class="reserved">return</strong> parallelism;
<a id="L2548" name="L2548"></a>2548     <em class="brace">}</em>
<a id="L2549" name="L2549"></a>2549 
<a id="L2550" name="L2550"></a>2550     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../S/1063.html#L2537" title="Referred from 2537 in src/java/util/concurrent/ForkJoinPool.java.">checkFactory</a>
<a id="L2551" name="L2551"></a>2551         (<a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>) <em class="brace">{</em>
<a id="L2552" name="L2552"></a>2552         <strong class="reserved">if</strong> (<a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> == <strong class="reserved">null</strong>)
<a id="L2553" name="L2553"></a>2553             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L2554" name="L2554"></a>2554         <strong class="reserved">return</strong> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>;
<a id="L2555" name="L2555"></a>2555     <em class="brace">}</em>
<a id="L2556" name="L2556"></a>2556 
<div class="comment">
      Creates a <code>ForkJoinPool</code> with the given parameters, without
      any security checks or parameter validation.  Invoked directly by
      makeCommonPool.</div>
<a id="L2562" name="L2562"></a>2562     <strong class="reserved">private</strong> ForkJoinPool(<strong class="reserved">int</strong> parallelism,
<a id="L2563" name="L2563"></a>2563                          <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>,
<a id="L2564" name="L2564"></a>2564                          <a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a> <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>,
<a id="L2565" name="L2565"></a>2565                          <strong class="reserved">int</strong> mode,
<a id="L2566" name="L2566"></a>2566                          <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> workerNamePrefix) <em class="brace">{</em>
<a id="L2567" name="L2567"></a>2567         <strong class="reserved">this</strong>.workerNamePrefix = workerNamePrefix;
<a id="L2568" name="L2568"></a>2568         <strong class="reserved">this</strong>.<a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> = <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>;
<a id="L2569" name="L2569"></a>2569         <strong class="reserved">this</strong>.ueh = <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>;
<a id="L2570" name="L2570"></a>2570         <strong class="reserved">this</strong>.<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> = (parallelism &amp; SMASK) | mode;
<a id="L2571" name="L2571"></a>2571         <strong class="reserved">long</strong> np = (<strong class="reserved">long</strong>)(-parallelism); <em class="comment">// offset ctl counts</em>
<a id="L2572" name="L2572"></a>2572         <strong class="reserved">this</strong>.ctl = ((np &lt;&lt; AC_SHIFT) &amp; AC_MASK) | ((np &lt;&lt; TC_SHIFT) &amp; TC_MASK);
<a id="L2573" name="L2573"></a>2573     <em class="brace">}</em>
<a id="L2574" name="L2574"></a>2574 
<div class="comment">
      Returns the common pool instance. This pool is statically
      constructed; its run state is unaffected by attempts to {@link
      #shutdown} or {@link #shutdownNow}. However this pool and any
      ongoing processing are automatically terminated upon program
      {@link System#exit}.  Any program that relies on asynchronous
      task processing to complete before program termination should
      invoke <code>commonPool().</code>{@link #awaitQuiescence awaitQuiescence},
      before exit.
      @return the common pool instance
      @since 1.8</div>
<a id="L2588" name="L2588"></a>2588     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> <a href="../R/11678.html" title="Multiple referred from 2 places.">commonPool</a>() <em class="brace">{</em>
<a id="L2589" name="L2589"></a>2589         <em class="comment">// assert common != null : "static init error";</em>
<a id="L2590" name="L2590"></a>2590         <strong class="reserved">return</strong> common;
<a id="L2591" name="L2591"></a>2591     <em class="brace">}</em>
<a id="L2592" name="L2592"></a>2592 
<a id="L2593" name="L2593"></a>2593     <em class="comment">// Execution methods</em>
<a id="L2594" name="L2594"></a>2594 
<div class="comment">
      Performs the given task, returning its result upon completion.
      If the computation encounters an unchecked Exception or Error,
      it is rethrown as the outcome of this invocation.  Rethrown
      exceptions behave in the same way as regular exceptions, but,
      when possible, contain stack traces (as displayed for example
      using <code>ex.printStackTrace()</code>) of both the current thread
      as well as the thread actually encountering the exception;
      minimally only the latter.
      @param task the task
      @param <t> the type of the task's result
      @return the task's result
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</t></div>
<a id="L2612" name="L2612"></a>2612     <strong class="reserved">public</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../R/21052.html" title="Multiple referred from 440 places.">invoke</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; task) <em class="brace">{</em>
<a id="L2613" name="L2613"></a>2613         <strong class="reserved">if</strong> (task == <strong class="reserved">null</strong>)
<a id="L2614" name="L2614"></a>2614             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L2615" name="L2615"></a>2615         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(task);
<a id="L2616" name="L2616"></a>2616         <strong class="reserved">return</strong> task.<a href="../D/26697.html" title="Multiple defined in 17 places.">join</a>();
<a id="L2617" name="L2617"></a>2617     <em class="brace">}</em>
<a id="L2618" name="L2618"></a>2618 
<div class="comment">
      Arranges for (asynchronous) execution of the given task.
      @param task the task
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</div>
<a id="L2627" name="L2627"></a>2627     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/14093.html" title="Multiple referred from 117 places.">execute</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; task) <em class="brace">{</em>
<a id="L2628" name="L2628"></a>2628         <strong class="reserved">if</strong> (task == <strong class="reserved">null</strong>)
<a id="L2629" name="L2629"></a>2629             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L2630" name="L2630"></a>2630         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(task);
<a id="L2631" name="L2631"></a>2631     <em class="brace">}</em>
<a id="L2632" name="L2632"></a>2632 
<a id="L2633" name="L2633"></a>2633     <em class="comment">// AbstractExecutorService methods</em>
<a id="L2634" name="L2634"></a>2634 
<div class="comment">
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</div>
<a id="L2640" name="L2640"></a>2640     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/14093.html" title="Multiple referred from 117 places.">execute</a>(<a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> task) <em class="brace">{</em>
<a id="L2641" name="L2641"></a>2641         <strong class="reserved">if</strong> (task == <strong class="reserved">null</strong>)
<a id="L2642" name="L2642"></a>2642             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L2643" name="L2643"></a>2643         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; job;
<a id="L2644" name="L2644"></a>2644         <strong class="reserved">if</strong> (task <strong class="reserved">instanceof</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;) <em class="comment">// avoid re-wrap</em>
<a id="L2645" name="L2645"></a>2645             job = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;) task;
<a id="L2646" name="L2646"></a>2646         <strong class="reserved">else</strong>
<a id="L2647" name="L2647"></a>2647             job = <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1394" title="Defined at 1394 in src/java/util/concurrent/ForkJoinTask.java.">RunnableExecuteAction</a>(task);
<a id="L2648" name="L2648"></a>2648         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(job);
<a id="L2649" name="L2649"></a>2649     <em class="brace">}</em>
<a id="L2650" name="L2650"></a>2650 
<div class="comment">
      Submits a ForkJoinTask for execution.
      @param task the task to submit
      @param <t> the type of the task's result
      @return the task
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</t></div>
<a id="L2661" name="L2661"></a>2661     <strong class="reserved">public</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../R/29011.html" title="Multiple referred from 11 places.">submit</a>(<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; task) <em class="brace">{</em>
<a id="L2662" name="L2662"></a>2662         <strong class="reserved">if</strong> (task == <strong class="reserved">null</strong>)
<a id="L2663" name="L2663"></a>2663             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L2664" name="L2664"></a>2664         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(task);
<a id="L2665" name="L2665"></a>2665         <strong class="reserved">return</strong> task;
<a id="L2666" name="L2666"></a>2666     <em class="brace">}</em>
<a id="L2667" name="L2667"></a>2667 
<div class="comment">
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</div>
<a id="L2673" name="L2673"></a>2673     <strong class="reserved">public</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../R/29011.html" title="Multiple referred from 11 places.">submit</a>(<a href="../S/1040.html#L58" title="Defined at 58 in src/java/util/concurrent/Callable.java.">Callable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; task) <em class="brace">{</em>
<a id="L2674" name="L2674"></a>2674         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; job = <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1412" title="Defined at 1412 in src/java/util/concurrent/ForkJoinTask.java.">AdaptedCallable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;(task);
<a id="L2675" name="L2675"></a>2675         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(job);
<a id="L2676" name="L2676"></a>2676         <strong class="reserved">return</strong> job;
<a id="L2677" name="L2677"></a>2677     <em class="brace">}</em>
<a id="L2678" name="L2678"></a>2678 
<div class="comment">
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</div>
<a id="L2684" name="L2684"></a>2684     <strong class="reserved">public</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../R/29011.html" title="Multiple referred from 11 places.">submit</a>(<a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> task, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>) <em class="brace">{</em>
<a id="L2685" name="L2685"></a>2685         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; job = <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1358" title="Defined at 1358 in src/java/util/concurrent/ForkJoinTask.java.">AdaptedRunnable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;(task, <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>);
<a id="L2686" name="L2686"></a>2686         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(job);
<a id="L2687" name="L2687"></a>2687         <strong class="reserved">return</strong> job;
<a id="L2688" name="L2688"></a>2688     <em class="brace">}</em>
<a id="L2689" name="L2689"></a>2689 
<div class="comment">
      @throws NullPointerException if the task is null
      @throws RejectedExecutionException if the task cannot be
              scheduled for execution</div>
<a id="L2695" name="L2695"></a>2695     <strong class="reserved">public</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; <a href="../R/29011.html" title="Multiple referred from 11 places.">submit</a>(<a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> task) <em class="brace">{</em>
<a id="L2696" name="L2696"></a>2696         <strong class="reserved">if</strong> (task == <strong class="reserved">null</strong>)
<a id="L2697" name="L2697"></a>2697             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L2698" name="L2698"></a>2698         <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; job;
<a id="L2699" name="L2699"></a>2699         <strong class="reserved">if</strong> (task <strong class="reserved">instanceof</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;) <em class="comment">// avoid re-wrap</em>
<a id="L2700" name="L2700"></a>2700             job = (<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;) task;
<a id="L2701" name="L2701"></a>2701         <strong class="reserved">else</strong>
<a id="L2702" name="L2702"></a>2702             job = <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1377" title="Defined at 1377 in src/java/util/concurrent/ForkJoinTask.java.">AdaptedRunnableAction</a>(task);
<a id="L2703" name="L2703"></a>2703         <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(job);
<a id="L2704" name="L2704"></a>2704         <strong class="reserved">return</strong> job;
<a id="L2705" name="L2705"></a>2705     <em class="brace">}</em>
<a id="L2706" name="L2706"></a>2706 
<div class="comment">
      @throws NullPointerException       {@inheritDoc}
      @throws RejectedExecutionException {@inheritDoc}</div>
<a id="L2711" name="L2711"></a>2711     <strong class="reserved">public</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/5090.html" title="Multiple defined in 5 places.">List</a>&lt;<a href="../D/3465.html" title="Multiple defined in 2 places.">Future</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;&gt; <a href="../R/21054.html" title="Multiple referred from 3 places.">invokeAll</a>(<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;? <strong class="reserved">extends</strong> <a href="../S/1040.html#L58" title="Defined at 58 in src/java/util/concurrent/Callable.java.">Callable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;&gt; tasks) <em class="brace">{</em>
<a id="L2712" name="L2712"></a>2712         <em class="comment">// In previous versions of this class, this method constructed</em>
<a id="L2713" name="L2713"></a>2713         <em class="comment">// a task to run ForkJoinTask.invokeAll, but now external</em>
<a id="L2714" name="L2714"></a>2714         <em class="comment">// invocation of multiple tasks is at least as efficient.</em>
<a id="L2715" name="L2715"></a>2715         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../D/3465.html" title="Multiple defined in 2 places.">Future</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;&gt; futures = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;&gt;(tasks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>());
<a id="L2716" name="L2716"></a>2716 
<a id="L2717" name="L2717"></a>2717         <strong class="reserved">boolean</strong> <a href="../D/15117.html" title="Multiple defined in 10 places.">done</a> = <strong class="reserved">false</strong>;
<a id="L2718" name="L2718"></a>2718         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L2719" name="L2719"></a>2719             <strong class="reserved">for</strong> (<a href="../S/1040.html#L58" title="Defined at 58 in src/java/util/concurrent/Callable.java.">Callable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; t : tasks) <em class="brace">{</em>
<a id="L2720" name="L2720"></a>2720                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; f = <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1412" title="Defined at 1412 in src/java/util/concurrent/ForkJoinTask.java.">AdaptedCallable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;(t);
<a id="L2721" name="L2721"></a>2721                 futures.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(f);
<a id="L2722" name="L2722"></a>2722                 <a href="../S/1063.html#L2399" title="Defined at 2399 in src/java/util/concurrent/ForkJoinPool.java.">externalPush</a>(f);
<a id="L2723" name="L2723"></a>2723             <em class="brace">}</em>
<a id="L2724" name="L2724"></a>2724             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0, <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = futures.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i &lt; <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>; i++)
<a id="L2725" name="L2725"></a>2725                 ((<a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;)futures.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i)).<a href="../S/1101.html#L1078" title="Defined at 1078 in src/java/util/concurrent/ForkJoinTask.java.">quietlyJoin</a>();
<a id="L2726" name="L2726"></a>2726             <a href="../D/15117.html" title="Multiple defined in 10 places.">done</a> = <strong class="reserved">true</strong>;
<a id="L2727" name="L2727"></a>2727             <strong class="reserved">return</strong> futures;
<a id="L2728" name="L2728"></a>2728         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L2729" name="L2729"></a>2729             <strong class="reserved">if</strong> (!<a href="../D/15117.html" title="Multiple defined in 10 places.">done</a>)
<a id="L2730" name="L2730"></a>2730                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0, <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = futures.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i &lt; <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>; i++)
<a id="L2731" name="L2731"></a>2731                     futures.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i).<a href="../D/12192.html" title="Multiple defined in 21 places.">cancel</a>(<strong class="reserved">false</strong>);
<a id="L2732" name="L2732"></a>2732         <em class="brace">}</em>
<a id="L2733" name="L2733"></a>2733     <em class="brace">}</em>
<a id="L2734" name="L2734"></a>2734 
<div class="comment">
      Returns the factory used for constructing new workers.
      @return the factory used for constructing new workers</div>
<a id="L2740" name="L2740"></a>2740     <strong class="reserved">public</strong> <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../R/16527.html" title="Multiple referred from 30 places.">getFactory</a>() <em class="brace">{</em>
<a id="L2741" name="L2741"></a>2741         <strong class="reserved">return</strong> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>;
<a id="L2742" name="L2742"></a>2742     <em class="brace">}</em>
<a id="L2743" name="L2743"></a>2743 
<div class="comment">
      Returns the handler for internal worker threads that terminate
      due to unrecoverable errors encountered while executing tasks.
      @return the handler, or <code>null</code> if none</div>
<a id="L2750" name="L2750"></a>2750     <strong class="reserved">public</strong> <a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a> <a href="../R/19669.html" title="Multiple referred from 2 places.">getUncaughtExceptionHandler</a>() <em class="brace">{</em>
<a id="L2751" name="L2751"></a>2751         <strong class="reserved">return</strong> ueh;
<a id="L2752" name="L2752"></a>2752     <em class="brace">}</em>
<a id="L2753" name="L2753"></a>2753 
<div class="comment">
      Returns the targeted parallelism level of this pool.
      @return the targeted parallelism level of this pool</div>
<a id="L2759" name="L2759"></a>2759     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getParallelism() <em class="brace">{</em>
<a id="L2760" name="L2760"></a>2760         <strong class="reserved">int</strong> par;
<a id="L2761" name="L2761"></a>2761         <strong class="reserved">return</strong> ((par = <a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) &gt; 0) ? par : 1;
<a id="L2762" name="L2762"></a>2762     <em class="brace">}</em>
<a id="L2763" name="L2763"></a>2763 
<div class="comment">
      Returns the targeted parallelism level of the common pool.
      @return the targeted parallelism level of the common pool
      @since 1.8</div>
<a id="L2770" name="L2770"></a>2770     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/15698.html" title="Multiple referred from 25 places.">getCommonPoolParallelism</a>() <em class="brace">{</em>
<a id="L2771" name="L2771"></a>2771         <strong class="reserved">return</strong> commonParallelism;
<a id="L2772" name="L2772"></a>2772     <em class="brace">}</em>
<a id="L2773" name="L2773"></a>2773 
<div class="comment">
      Returns the number of worker threads that have started but not
      yet terminated.  The result returned by this method may differ
      from {@link #getParallelism} when threads are created to
      maintain parallelism when others are cooperatively blocked.
      @return the number of worker threads</div>
<a id="L2782" name="L2782"></a>2782     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getPoolSize() <em class="brace">{</em>
<a id="L2783" name="L2783"></a>2783         <strong class="reserved">return</strong> (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) + (<strong class="reserved">short</strong>)(ctl &gt;&gt;&gt; TC_SHIFT);
<a id="L2784" name="L2784"></a>2784     <em class="brace">}</em>
<a id="L2785" name="L2785"></a>2785 
<div class="comment">
      Returns <code>true</code> if this pool uses local first-in-first-out
      scheduling mode for forked tasks that are never joined.
      @return <code>true</code> if this pool uses async mode</div>
<a id="L2792" name="L2792"></a>2792     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> getAsyncMode() <em class="brace">{</em>
<a id="L2793" name="L2793"></a>2793         <strong class="reserved">return</strong> (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; FIFO_QUEUE) != 0;
<a id="L2794" name="L2794"></a>2794     <em class="brace">}</em>
<a id="L2795" name="L2795"></a>2795 
<div class="comment">
      Returns an estimate of the number of worker threads that are
      not blocked waiting to join tasks or for other managed
      synchronization. This method may overestimate the
      number of running threads.
      @return the number of worker threads</div>
<a id="L2804" name="L2804"></a>2804     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getRunningThreadCount() <em class="brace">{</em>
<a id="L2805" name="L2805"></a>2805         <strong class="reserved">int</strong> rc = 0;
<a id="L2806" name="L2806"></a>2806         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w;
<a id="L2807" name="L2807"></a>2807         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2808" name="L2808"></a>2808             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 1; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i += 2) <em class="brace">{</em>
<a id="L2809" name="L2809"></a>2809                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong> &amp;&amp; w.<a href="../S/1063.html#L1210" title="Defined at 1210 in src/java/util/concurrent/ForkJoinPool.java.">isApparentlyUnblocked</a>())
<a id="L2810" name="L2810"></a>2810                     ++rc;
<a id="L2811" name="L2811"></a>2811             <em class="brace">}</em>
<a id="L2812" name="L2812"></a>2812         <em class="brace">}</em>
<a id="L2813" name="L2813"></a>2813         <strong class="reserved">return</strong> rc;
<a id="L2814" name="L2814"></a>2814     <em class="brace">}</em>
<a id="L2815" name="L2815"></a>2815 
<div class="comment">
      Returns an estimate of the number of threads that are currently
      stealing or executing tasks. This method may overestimate the
      number of active threads.
      @return the number of active threads</div>
<a id="L2823" name="L2823"></a>2823     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getActiveThreadCount() <em class="brace">{</em>
<a id="L2824" name="L2824"></a>2824         <strong class="reserved">int</strong> r = (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) + (<strong class="reserved">int</strong>)(ctl &gt;&gt; AC_SHIFT);
<a id="L2825" name="L2825"></a>2825         <strong class="reserved">return</strong> (r &lt;= 0) ? 0 : r; <em class="comment">// suppress momentarily negative values</em>
<a id="L2826" name="L2826"></a>2826     <em class="brace">}</em>
<a id="L2827" name="L2827"></a>2827 
<div class="comment">
      Returns <code>true</code> if all worker threads are currently idle.
      An idle worker is one that cannot obtain a task to execute
      because none are available to steal from other threads, and
      there are no pending submissions to the pool. This method is
      conservative; it might not return <code>true</code> immediately upon
      idleness of all threads, but will eventually become true if
      threads remain inactive.
      @return <code>true</code> if all threads are currently idle</div>
<a id="L2839" name="L2839"></a>2839     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/1063.html#L3171" title="Referred from 3171 in src/java/util/concurrent/ForkJoinPool.java.">isQuiescent</a>() <em class="brace">{</em>
<a id="L2840" name="L2840"></a>2840         <strong class="reserved">return</strong> (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK) + (<strong class="reserved">int</strong>)(ctl &gt;&gt; AC_SHIFT) &lt;= 0;
<a id="L2841" name="L2841"></a>2841     <em class="brace">}</em>
<a id="L2842" name="L2842"></a>2842 
<div class="comment">
      Returns an estimate of the total number of tasks stolen from
      one thread's work queue by another. The reported value
      underestimates the actual total number of steals when the pool
      is not quiescent. This value may be useful for monitoring and
      tuning fork/join programs: in general, steal counts should be
      high enough to keep threads busy, but low enough to avoid
      overhead and contention across threads.
      @return the number of steals</div>
<a id="L2854" name="L2854"></a>2854     <strong class="reserved">public</strong> <strong class="reserved">long</strong> getStealCount() <em class="brace">{</em>
<a id="L2855" name="L2855"></a>2855         <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a> sc = stealCounter;
<a id="L2856" name="L2856"></a>2856         <strong class="reserved">long</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = (sc == <strong class="reserved">null</strong>) ? 0L : sc.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L2857" name="L2857"></a>2857         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w;
<a id="L2858" name="L2858"></a>2858         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2859" name="L2859"></a>2859             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 1; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i += 2) <em class="brace">{</em>
<a id="L2860" name="L2860"></a>2860                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>)
<a id="L2861" name="L2861"></a>2861                     <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> += w.nsteals;
<a id="L2862" name="L2862"></a>2862             <em class="brace">}</em>
<a id="L2863" name="L2863"></a>2863         <em class="brace">}</em>
<a id="L2864" name="L2864"></a>2864         <strong class="reserved">return</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L2865" name="L2865"></a>2865     <em class="brace">}</em>
<a id="L2866" name="L2866"></a>2866 
<div class="comment">
      Returns an estimate of the total number of tasks currently held
      in queues by worker threads (but not including tasks submitted
      to the pool that have not begun executing). This value is only
      an approximation, obtained by iterating across all threads in
      the pool. This method may be useful for tuning task
      granularities.
      @return the number of queued tasks</div>
<a id="L2877" name="L2877"></a>2877     <strong class="reserved">public</strong> <strong class="reserved">long</strong> getQueuedTaskCount() <em class="brace">{</em>
<a id="L2878" name="L2878"></a>2878         <strong class="reserved">long</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L2879" name="L2879"></a>2879         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w;
<a id="L2880" name="L2880"></a>2880         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2881" name="L2881"></a>2881             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 1; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i += 2) <em class="brace">{</em>
<a id="L2882" name="L2882"></a>2882                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>)
<a id="L2883" name="L2883"></a>2883                     <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> += w.<a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>();
<a id="L2884" name="L2884"></a>2884             <em class="brace">}</em>
<a id="L2885" name="L2885"></a>2885         <em class="brace">}</em>
<a id="L2886" name="L2886"></a>2886         <strong class="reserved">return</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L2887" name="L2887"></a>2887     <em class="brace">}</em>
<a id="L2888" name="L2888"></a>2888 
<div class="comment">
      Returns an estimate of the number of tasks submitted to this
      pool that have not yet begun executing.  This method may take
      time proportional to the number of submissions.
      @return the number of queued submissions</div>
<a id="L2896" name="L2896"></a>2896     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getQueuedSubmissionCount() <em class="brace">{</em>
<a id="L2897" name="L2897"></a>2897         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L2898" name="L2898"></a>2898         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w;
<a id="L2899" name="L2899"></a>2899         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2900" name="L2900"></a>2900             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i += 2) <em class="brace">{</em>
<a id="L2901" name="L2901"></a>2901                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>)
<a id="L2902" name="L2902"></a>2902                     <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> += w.<a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>();
<a id="L2903" name="L2903"></a>2903             <em class="brace">}</em>
<a id="L2904" name="L2904"></a>2904         <em class="brace">}</em>
<a id="L2905" name="L2905"></a>2905         <strong class="reserved">return</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L2906" name="L2906"></a>2906     <em class="brace">}</em>
<a id="L2907" name="L2907"></a>2907 
<div class="comment">
      Returns <code>true</code> if there are any tasks submitted to this
      pool that have not yet begun executing.
      @return <code>true</code> if there are any queued submissions</div>
<a id="L2914" name="L2914"></a>2914     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> hasQueuedSubmissions() <em class="brace">{</em>
<a id="L2915" name="L2915"></a>2915         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w;
<a id="L2916" name="L2916"></a>2916         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2917" name="L2917"></a>2917             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i += 2) <em class="brace">{</em>
<a id="L2918" name="L2918"></a>2918                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong> &amp;&amp; !w.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L2919" name="L2919"></a>2919                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L2920" name="L2920"></a>2920             <em class="brace">}</em>
<a id="L2921" name="L2921"></a>2921         <em class="brace">}</em>
<a id="L2922" name="L2922"></a>2922         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L2923" name="L2923"></a>2923     <em class="brace">}</em>
<a id="L2924" name="L2924"></a>2924 
<div class="comment">
      Removes and returns the next unexecuted submission if one is
      available.  This method may be useful in extensions to this
      class that re-assign work in systems with multiple pools.
      @return the next submission, or <code>null</code> if none</div>
<a id="L2932" name="L2932"></a>2932     <strong class="reserved">protected</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; pollSubmission() <em class="brace">{</em>
<a id="L2933" name="L2933"></a>2933         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;
<a id="L2934" name="L2934"></a>2934         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2935" name="L2935"></a>2935             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i += 2) <em class="brace">{</em>
<a id="L2936" name="L2936"></a>2936                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong> &amp;&amp; (t = w.<a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>()) != <strong class="reserved">null</strong>)
<a id="L2937" name="L2937"></a>2937                     <strong class="reserved">return</strong> t;
<a id="L2938" name="L2938"></a>2938             <em class="brace">}</em>
<a id="L2939" name="L2939"></a>2939         <em class="brace">}</em>
<a id="L2940" name="L2940"></a>2940         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L2941" name="L2941"></a>2941     <em class="brace">}</em>
<a id="L2942" name="L2942"></a>2942 
<div class="comment">
      Removes all available unexecuted submitted and forked tasks
      from scheduling queues and adds them to the given collection,
      without altering their execution status. These may include
      artificially generated or wrapped tasks. This method is
      designed to be invoked only when the pool is known to be
      quiescent. Invocations at other times may not remove all
      tasks. A failure encountered while attempting to add elements
      to collection <code>c</code> may result in elements being in
      neither, either or both collections when the associated
      exception is thrown.  The behavior of this operation is
      undefined if the specified collection is modified while the
      operation is in progress.
      @param c the collection to transfer elements into
      @return the number of elements transferred</div>
<a id="L2960" name="L2960"></a>2960     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> drainTasksTo(<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;? <strong class="reserved">super</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt;&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L2961" name="L2961"></a>2961         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L2962" name="L2962"></a>2962         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w; <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t;
<a id="L2963" name="L2963"></a>2963         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2964" name="L2964"></a>2964             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; ++i) <em class="brace">{</em>
<a id="L2965" name="L2965"></a>2965                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2966" name="L2966"></a>2966                     <strong class="reserved">while</strong> ((t = w.<a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>()) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2967" name="L2967"></a>2967                         <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L2968" name="L2968"></a>2968                         ++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L2969" name="L2969"></a>2969                     <em class="brace">}</em>
<a id="L2970" name="L2970"></a>2970                 <em class="brace">}</em>
<a id="L2971" name="L2971"></a>2971             <em class="brace">}</em>
<a id="L2972" name="L2972"></a>2972         <em class="brace">}</em>
<a id="L2973" name="L2973"></a>2973         <strong class="reserved">return</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L2974" name="L2974"></a>2974     <em class="brace">}</em>
<a id="L2975" name="L2975"></a>2975 
<div class="comment">
      Returns a string identifying this pool, as well as its state,
      including indications of run state, parallelism level, and
      worker and task counts.
      @return a string identifying this pool, as well as its state</div>
<a id="L2983" name="L2983"></a>2983     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L2984" name="L2984"></a>2984         <em class="comment">// Use a single pass through workQueues to collect counts</em>
<a id="L2985" name="L2985"></a>2985         <strong class="reserved">long</strong> qt = 0L, qs = 0L; <strong class="reserved">int</strong> rc = 0;
<a id="L2986" name="L2986"></a>2986         <a href="../S/1088.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicLong.java.">AtomicLong</a> sc = stealCounter;
<a id="L2987" name="L2987"></a>2987         <strong class="reserved">long</strong> st = (sc == <strong class="reserved">null</strong>) ? 0L : sc.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L2988" name="L2988"></a>2988         <strong class="reserved">long</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ctl;
<a id="L2989" name="L2989"></a>2989         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w;
<a id="L2990" name="L2990"></a>2990         <strong class="reserved">if</strong> ((ws = workQueues) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2991" name="L2991"></a>2991             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; ++i) <em class="brace">{</em>
<a id="L2992" name="L2992"></a>2992                 <strong class="reserved">if</strong> ((w = ws[i]) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2993" name="L2993"></a>2993                     <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = w.<a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>();
<a id="L2994" name="L2994"></a>2994                     <strong class="reserved">if</strong> ((i &amp; 1) == 0)
<a id="L2995" name="L2995"></a>2995                         qs += <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L2996" name="L2996"></a>2996                     <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2997" name="L2997"></a>2997                         qt += <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L2998" name="L2998"></a>2998                         st += w.nsteals;
<a id="L2999" name="L2999"></a>2999                         <strong class="reserved">if</strong> (w.<a href="../S/1063.html#L1210" title="Defined at 1210 in src/java/util/concurrent/ForkJoinPool.java.">isApparentlyUnblocked</a>())
<a id="L3000" name="L3000"></a>3000                             ++rc;
<a id="L3001" name="L3001"></a>3001                     <em class="brace">}</em>
<a id="L3002" name="L3002"></a>3002                 <em class="brace">}</em>
<a id="L3003" name="L3003"></a>3003             <em class="brace">}</em>
<a id="L3004" name="L3004"></a>3004         <em class="brace">}</em>
<a id="L3005" name="L3005"></a>3005         <strong class="reserved">int</strong> pc = (<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK);
<a id="L3006" name="L3006"></a>3006         <strong class="reserved">int</strong> tc = pc + (<strong class="reserved">short</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt;&gt; TC_SHIFT);
<a id="L3007" name="L3007"></a>3007         <strong class="reserved">int</strong> ac = pc + (<strong class="reserved">int</strong>)(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt; AC_SHIFT);
<a id="L3008" name="L3008"></a>3008         <strong class="reserved">if</strong> (ac &lt; 0) <em class="comment">// ignore transient negative</em>
<a id="L3009" name="L3009"></a>3009             ac = 0;
<a id="L3010" name="L3010"></a>3010         <strong class="reserved">int</strong> rs = runState;
<a id="L3011" name="L3011"></a>3011         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> level = ((rs &amp; TERMINATED) != 0 ? "Terminated" :
<a id="L3012" name="L3012"></a>3012                         (rs &amp; STOP)       != 0 ? "Terminating" :
<a id="L3013" name="L3013"></a>3013                         (rs &amp; SHUTDOWN)   != 0 ? "Shutting down" :
<a id="L3014" name="L3014"></a>3014                         "Running");
<a id="L3015" name="L3015"></a>3015         <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L3016" name="L3016"></a>3016             "[" + level +
<a id="L3017" name="L3017"></a>3017             ", parallelism = " + pc +
<a id="L3018" name="L3018"></a>3018             ", size = " + tc +
<a id="L3019" name="L3019"></a>3019             ", active = " + ac +
<a id="L3020" name="L3020"></a>3020             ", running = " + rc +
<a id="L3021" name="L3021"></a>3021             ", steals = " + st +
<a id="L3022" name="L3022"></a>3022             ", tasks = " + qt +
<a id="L3023" name="L3023"></a>3023             ", submissions = " + qs +
<a id="L3024" name="L3024"></a>3024             "]";
<a id="L3025" name="L3025"></a>3025     <em class="brace">}</em>
<a id="L3026" name="L3026"></a>3026 
<div class="comment">
      Possibly initiates an orderly shutdown in which previously
      submitted tasks are executed, but no new tasks will be
      accepted. Invocation has no effect on execution state if this
      is the {@link #commonPool()}, and no additional effect if
      already shut down.  Tasks that are in the process of being
      submitted concurrently during the course of this method may or
      may not be rejected.
      @throws SecurityException if a security manager exists and
              the caller is not permitted to modify threads
              because it does not hold {@link
              java.lang.RuntimePermission}<code>("modifyThread")</code></div>
<a id="L3041" name="L3041"></a>3041     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/28585.html" title="Multiple referred from 25 places.">shutdown</a>() <em class="brace">{</em>
<a id="L3042" name="L3042"></a>3042         <a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>();
<a id="L3043" name="L3043"></a>3043         <a href="../D/35739.html" title="Multiple defined in 2 places.">tryTerminate</a>(<strong class="reserved">false</strong>, <strong class="reserved">true</strong>);
<a id="L3044" name="L3044"></a>3044     <em class="brace">}</em>
<a id="L3045" name="L3045"></a>3045 
<div class="comment">
      Possibly attempts to cancel and/or stop all tasks, and reject
      all subsequently submitted tasks.  Invocation has no effect on
      execution state if this is the {@link #commonPool()}, and no
      additional effect if already shut down. Otherwise, tasks that
      are in the process of being submitted or executed concurrently
      during the course of this method may or may not be
      rejected. This method cancels both existing and unexecuted
      tasks, in order to permit termination in the presence of task
      dependencies. So the method always returns an empty list
      (unlike the case for some other Executors).
      @return an empty list
      @throws SecurityException if a security manager exists and
              the caller is not permitted to modify threads
              because it does not hold {@link
              java.lang.RuntimePermission}<code>("modifyThread")</code></div>
<a id="L3064" name="L3064"></a>3064     <strong class="reserved">public</strong> <a href="../D/5090.html" title="Multiple defined in 5 places.">List</a>&lt;<a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a>&gt; <a href="../R/28588.html" title="Multiple referred from 2 places.">shutdownNow</a>() <em class="brace">{</em>
<a id="L3065" name="L3065"></a>3065         <a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>();
<a id="L3066" name="L3066"></a>3066         <a href="../D/35739.html" title="Multiple defined in 2 places.">tryTerminate</a>(<strong class="reserved">true</strong>, <strong class="reserved">true</strong>);
<a id="L3067" name="L3067"></a>3067         <strong class="reserved">return</strong> <a href="../S/1147.html#L80" title="Defined at 80 in src/java/util/Collections.java.">Collections</a>.<a href="../S/1147.html#L4420" title="Defined at 4420 in src/java/util/Collections.java.">emptyList</a>();
<a id="L3068" name="L3068"></a>3068     <em class="brace">}</em>
<a id="L3069" name="L3069"></a>3069 
<div class="comment">
      Returns <code>true</code> if all tasks have completed following shut down.
      @return <code>true</code> if all tasks have completed following shut down</div>
<a id="L3075" name="L3075"></a>3075     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22100.html" title="Multiple referred from 3 places.">isTerminated</a>() <em class="brace">{</em>
<a id="L3076" name="L3076"></a>3076         <strong class="reserved">return</strong> (runState &amp; TERMINATED) != 0;
<a id="L3077" name="L3077"></a>3077     <em class="brace">}</em>
<a id="L3078" name="L3078"></a>3078 
<div class="comment">
      Returns <code>true</code> if the process of termination has
      commenced but not yet completed.  This method may be useful for
      debugging. A return of <code>true</code> reported a sufficient
      period after shutdown may indicate that submitted tasks have
      ignored or suppressed interruption, or are waiting for I/O,
      causing this executor not to properly terminate. (See the
      advisory notes for class {@link ForkJoinTask} stating that
      tasks should not normally entail blocking operations.  But if
      they do, they must abort them on interrupt.)
      @return <code>true</code> if terminating but not yet terminated</div>
<a id="L3092" name="L3092"></a>3092     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> isTerminating() <em class="brace">{</em>
<a id="L3093" name="L3093"></a>3093         <strong class="reserved">int</strong> rs = runState;
<a id="L3094" name="L3094"></a>3094         <strong class="reserved">return</strong> (rs &amp; STOP) != 0 &amp;&amp; (rs &amp; TERMINATED) == 0;
<a id="L3095" name="L3095"></a>3095     <em class="brace">}</em>
<a id="L3096" name="L3096"></a>3096 
<div class="comment">
      Returns <code>true</code> if this pool has been shut down.
      @return <code>true</code> if this pool has been shut down</div>
<a id="L3102" name="L3102"></a>3102     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22020.html" title="Multiple referred from 12 places.">isShutdown</a>() <em class="brace">{</em>
<a id="L3103" name="L3103"></a>3103         <strong class="reserved">return</strong> (runState &amp; SHUTDOWN) != 0;
<a id="L3104" name="L3104"></a>3104     <em class="brace">}</em>
<a id="L3105" name="L3105"></a>3105 
<div class="comment">
      Blocks until all tasks have completed execution after a
      shutdown request, or the timeout occurs, or the current thread
      is interrupted, whichever happens first. Because the {@link
      #commonPool()} never terminates until program shutdown, when
      applied to the common pool, this method is equivalent to {@link
      #awaitQuiescence(long, TimeUnit)} but always returns <code>false</code>.
      @param timeout the maximum time to wait
      @param unit the time unit of the timeout argument
      @return <code>true</code> if this executor terminated and
              <code>false</code> if the timeout elapsed before termination
      @throws InterruptedException if interrupted while waiting</div>
<a id="L3120" name="L3120"></a>3120     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/1124.html#L675" title="Referred from 675 in src/java/util/concurrent/Executors.java.">awaitTermination</a>(<strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L3121" name="L3121"></a>3121         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L3122" name="L3122"></a>3122         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L3123" name="L3123"></a>3123             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L3124" name="L3124"></a>3124         <strong class="reserved">if</strong> (<strong class="reserved">this</strong> == common) <em class="brace">{</em>
<a id="L3125" name="L3125"></a>3125             <a href="../S/1063.html#L3158" title="Defined at 3158 in src/java/util/concurrent/ForkJoinPool.java.">awaitQuiescence</a>(timeout, unit);
<a id="L3126" name="L3126"></a>3126             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L3127" name="L3127"></a>3127         <em class="brace">}</em>
<a id="L3128" name="L3128"></a>3128         <strong class="reserved">long</strong> nanos = unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout);
<a id="L3129" name="L3129"></a>3129         <strong class="reserved">if</strong> (<a href="../D/26345.html" title="Multiple defined in 6 places.">isTerminated</a>())
<a id="L3130" name="L3130"></a>3130             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L3131" name="L3131"></a>3131         <strong class="reserved">if</strong> (nanos &lt;= 0L)
<a id="L3132" name="L3132"></a>3132             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L3133" name="L3133"></a>3133         <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanos;
<a id="L3134" name="L3134"></a>3134         <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L3135" name="L3135"></a>3135             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L3136" name="L3136"></a>3136                 <strong class="reserved">if</strong> (<a href="../D/26345.html" title="Multiple defined in 6 places.">isTerminated</a>())
<a id="L3137" name="L3137"></a>3137                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L3138" name="L3138"></a>3138                 <strong class="reserved">if</strong> (nanos &lt;= 0L)
<a id="L3139" name="L3139"></a>3139                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L3140" name="L3140"></a>3140                 <strong class="reserved">long</strong> <a href="../D/27696.html" title="Multiple defined in 5 places.">millis</a> = <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a>.NANOSECONDS.<a href="../D/35444.html" title="Multiple defined in 3 places.">toMillis</a>(nanos);
<a id="L3141" name="L3141"></a>3141                 <a href="../D/36778.html" title="Multiple defined in 3 places.">wait</a>(<a href="../D/27696.html" title="Multiple defined in 5 places.">millis</a> &gt; 0L ? <a href="../D/27696.html" title="Multiple defined in 5 places.">millis</a> : 1L);
<a id="L3142" name="L3142"></a>3142                 nanos = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L3143" name="L3143"></a>3143             <em class="brace">}</em>
<a id="L3144" name="L3144"></a>3144         <em class="brace">}</em>
<a id="L3145" name="L3145"></a>3145     <em class="brace">}</em>
<a id="L3146" name="L3146"></a>3146 
<div class="comment">
      If called by a ForkJoinTask operating in this pool, equivalent
      in effect to {@link ForkJoinTask#helpQuiesce}. Otherwise,
      waits and/or attempts to assist performing tasks until this
      pool {@link #isQuiescent} or the indicated timeout elapses.
      @param timeout the maximum time to wait
      @param unit the time unit of the timeout argument
      @return <code>true</code> if quiescent; <code>false</code> if the
      timeout elapsed.</div>
<a id="L3158" name="L3158"></a>3158     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/10438.html" title="Multiple referred from 2 places.">awaitQuiescence</a>(<strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit) <em class="brace">{</em>
<a id="L3159" name="L3159"></a>3159         <strong class="reserved">long</strong> nanos = unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout);
<a id="L3160" name="L3160"></a>3160         <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt;
<a id="L3161" name="L3161"></a>3161         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L3162" name="L3162"></a>3162         <strong class="reserved">if</strong> ((thread <strong class="reserved">instanceof</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>) &amp;&amp;
<a id="L3163" name="L3163"></a>3163             (wt = (<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>)thread).pool == <strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L3164" name="L3164"></a>3164             <a href="../S/1063.html#L2101" title="Defined at 2101 in src/java/util/concurrent/ForkJoinPool.java.">helpQuiescePool</a>(wt.workQueue);
<a id="L3165" name="L3165"></a>3165             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L3166" name="L3166"></a>3166         <em class="brace">}</em>
<a id="L3167" name="L3167"></a>3167         <strong class="reserved">long</strong> startTime = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L3168" name="L3168"></a>3168         <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>[] ws;
<a id="L3169" name="L3169"></a>3169         <strong class="reserved">int</strong> r = 0, m;
<a id="L3170" name="L3170"></a>3170         <strong class="reserved">boolean</strong> found = <strong class="reserved">true</strong>;
<a id="L3171" name="L3171"></a>3171         <strong class="reserved">while</strong> (!<a href="../S/1063.html#L2839" title="Defined at 2839 in src/java/util/concurrent/ForkJoinPool.java.">isQuiescent</a>() &amp;&amp; (ws = workQueues) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L3172" name="L3172"></a>3172                (m = ws.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1) &gt;= 0) <em class="brace">{</em>
<a id="L3173" name="L3173"></a>3173             <strong class="reserved">if</strong> (!found) <em class="brace">{</em>
<a id="L3174" name="L3174"></a>3174                 <strong class="reserved">if</strong> ((<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() - startTime) &gt; nanos)
<a id="L3175" name="L3175"></a>3175                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L3176" name="L3176"></a>3176                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>(); <em class="comment">// cannot block</em>
<a id="L3177" name="L3177"></a>3177             <em class="brace">}</em>
<a id="L3178" name="L3178"></a>3178             found = <strong class="reserved">false</strong>;
<a id="L3179" name="L3179"></a>3179             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = (m + 1) &lt;&lt; 2; j &gt;= 0; --j) <em class="brace">{</em>
<a id="L3180" name="L3180"></a>3180                 <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>&lt;?&gt; t; <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> q; <strong class="reserved">int</strong> b, k;
<a id="L3181" name="L3181"></a>3181                 <strong class="reserved">if</strong> ((k = r++ &amp; m) &lt;= m &amp;&amp; k &gt;= 0 &amp;&amp; (q = ws[k]) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L3182" name="L3182"></a>3182                     (b = q.base) - q.<a href="../D/35554.html" title="Multiple defined in 2 places.">top</a> &lt; 0) <em class="brace">{</em>
<a id="L3183" name="L3183"></a>3183                     found = <strong class="reserved">true</strong>;
<a id="L3184" name="L3184"></a>3184                     <strong class="reserved">if</strong> ((t = q.<a href="../S/1063.html#L928" title="Defined at 928 in src/java/util/concurrent/ForkJoinPool.java.">pollAt</a>(b)) != <strong class="reserved">null</strong>)
<a id="L3185" name="L3185"></a>3185                         t.<a href="../S/1101.html#L285" title="Defined at 285 in src/java/util/concurrent/ForkJoinTask.java.">doExec</a>();
<a id="L3186" name="L3186"></a>3186                     <strong class="reserved">break</strong>;
<a id="L3187" name="L3187"></a>3187                 <em class="brace">}</em>
<a id="L3188" name="L3188"></a>3188             <em class="brace">}</em>
<a id="L3189" name="L3189"></a>3189         <em class="brace">}</em>
<a id="L3190" name="L3190"></a>3190         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L3191" name="L3191"></a>3191     <em class="brace">}</em>
<a id="L3192" name="L3192"></a>3192 
<div class="comment">
      Waits and/or attempts to assist performing tasks indefinitely
      until the {@link #commonPool()} {@link #isQuiescent}.</div>
<a id="L3197" name="L3197"></a>3197     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../S/1101.html#L1105" title="Referred from 1105 in src/java/util/concurrent/ForkJoinTask.java.">quiesceCommonPool</a>() <em class="brace">{</em>
<a id="L3198" name="L3198"></a>3198         common.<a href="../S/1063.html#L3158" title="Defined at 3158 in src/java/util/concurrent/ForkJoinPool.java.">awaitQuiescence</a>(<a href="../S/1720.html#L54" title="Defined at 54 in src/java/lang/Long.java.">Long</a>.MAX_VALUE, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a>.NANOSECONDS);
<a id="L3199" name="L3199"></a>3199     <em class="brace">}</em>
<a id="L3200" name="L3200"></a>3200 
<div class="comment">
      Interface for extending managed parallelism for tasks running
      in {@link ForkJoinPool}s.
      <p>A <code>ManagedBlocker</code> provides two methods.  Method
      {@link #isReleasable} must return <code>true</code> if blocking is
      not necessary. Method {@link #block} blocks the current thread
      if necessary (perhaps internally invoking <code>isReleasable</code>
      before actually blocking). These actions are performed by any
      thread invoking {@link ForkJoinPool#managedBlock(ManagedBlocker)}.
      The unusual methods in this API accommodate synchronizers that
      may, but don't usually, block for long periods. Similarly, they
      allow more efficient internal handling of cases in which
      additional workers may be, but usually are not, needed to
      ensure sufficient parallelism.  Toward this end,
      implementations of method <code>isReleasable</code> must be amenable
      to repeated invocation.
      </p><p>For example, here is a ManagedBlocker based on a
      ReentrantLock:
       </p><pre> {@code
      class ManagedLocker implements ManagedBlocker {
        final ReentrantLock lock;
        boolean hasLock = false;
        ManagedLocker(ReentrantLock lock) { this.lock = lock; }
        public boolean block() {
          if (!hasLock)
            lock.lock();
          return true;
        }
        public boolean isReleasable() {
          return hasLock || (hasLock = lock.tryLock());
        }
      }}</pre>
      <p>Here is a class that possibly blocks waiting for an
      item on a given queue:
       </p><pre> {@code
      class QueueTaker<e> implements ManagedBlocker {
        final BlockingQueue<e> queue;
        volatile E item = null;
        QueueTaker(BlockingQueue<e> q) { this.queue = q; }
        public boolean block() throws InterruptedException {
          if (item == null)
            item = queue.take();
          return true;
        }
        public boolean isReleasable() {
          return item != null || (item = queue.poll()) != null;
        }
        public E getItem() { // call after pool.managedBlock completes
          return item;
        }
      }}</e></e></e></pre></div>
<a id="L3256" name="L3256"></a>3256     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">interface</strong> <a href="../R/4906.html" title="Multiple referred from 3 places.">ManagedBlocker</a> <em class="brace">{</em>
<div class="comment">
          Possibly blocks the current thread, for example waiting for
          a lock or condition.
          @return <code>true</code> if no additional blocking is necessary
          (i.e., if isReleasable would return true)
          @throws InterruptedException if interrupted while waiting
          (the method is not required to do so, but is allowed to)</div>
<a id="L3266" name="L3266"></a>3266         <strong class="reserved">boolean</strong> <a href="../R/10632.html" title="Multiple referred from 165 places.">block</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>;
<a id="L3267" name="L3267"></a>3267 
<div class="comment">
          Returns <code>true</code> if blocking is unnecessary.
          @return <code>true</code> if blocking is unnecessary</div>
<a id="L3272" name="L3272"></a>3272         <strong class="reserved">boolean</strong> <a href="../R/21942.html" title="Multiple referred from 8 places.">isReleasable</a>();
<a id="L3273" name="L3273"></a>3273     <em class="brace">}</em>
<a id="L3274" name="L3274"></a>3274 
<div class="comment">
      Runs the given possibly blocking task.  When {@linkplain
      ForkJoinTask#inForkJoinPool() running in a ForkJoinPool}, this
      method possibly arranges for a spare thread to be activated if
      necessary to ensure sufficient parallelism while the current
      thread is blocked in {@link ManagedBlocker#block blocker.block()}.
      <p>This method repeatedly calls <code>blocker.isReleasable()</code> and
      <code>blocker.block()</code> until either method returns <code>true</code>.
      Every call to <code>blocker.block()</code> is preceded by a call to
      <code>blocker.isReleasable()</code> that returned <code>false</code>.
      </p><p>If not running in a ForkJoinPool, this method is
      behaviorally equivalent to
       </p><pre> {@code
      while (!blocker.isReleasable())
        if (blocker.block())
          break;}</pre>
      If running in a ForkJoinPool, the pool may first be expanded to
      ensure sufficient parallelism available during the call to
      <code>blocker.block()</code>.
      @param blocker the blocker task
      @throws InterruptedException if <code>blocker.block()</code> did so</div>
<a id="L3301" name="L3301"></a>3301     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/23032.html" title="Multiple referred from 3 places.">managedBlock</a>(<a href="../S/1063.html#L3256" title="Defined at 3256 in src/java/util/concurrent/ForkJoinPool.java.">ManagedBlocker</a> blocker)
<a id="L3302" name="L3302"></a>3302         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L3303" name="L3303"></a>3303         <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> p;
<a id="L3304" name="L3304"></a>3304         <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> wt;
<a id="L3305" name="L3305"></a>3305         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L3306" name="L3306"></a>3306         <strong class="reserved">if</strong> ((t <strong class="reserved">instanceof</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>) &amp;&amp;
<a id="L3307" name="L3307"></a>3307             (p = (wt = (<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>)t).pool) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L3308" name="L3308"></a>3308             <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a> w = wt.workQueue;
<a id="L3309" name="L3309"></a>3309             <strong class="reserved">while</strong> (!blocker.<a href="../D/26148.html" title="Multiple defined in 3 places.">isReleasable</a>()) <em class="brace">{</em>
<a id="L3310" name="L3310"></a>3310                 <strong class="reserved">if</strong> (p.<a href="../S/1063.html#L1981" title="Defined at 1981 in src/java/util/concurrent/ForkJoinPool.java.">tryCompensate</a>(w)) <em class="brace">{</em>
<a id="L3311" name="L3311"></a>3311                     <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L3312" name="L3312"></a>3312                         <strong class="reserved">do</strong> <em class="brace">{</em><em class="brace">}</em> <strong class="reserved">while</strong> (!blocker.<a href="../D/26148.html" title="Multiple defined in 3 places.">isReleasable</a>() &amp;&amp;
<a id="L3313" name="L3313"></a>3313                                      !blocker.<a href="../D/11878.html" title="Multiple defined in 4 places.">block</a>());
<a id="L3314" name="L3314"></a>3314                     <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L3315" name="L3315"></a>3315                         U.getAndAddLong(p, CTL, AC_UNIT);
<a id="L3316" name="L3316"></a>3316                     <em class="brace">}</em>
<a id="L3317" name="L3317"></a>3317                     <strong class="reserved">break</strong>;
<a id="L3318" name="L3318"></a>3318                 <em class="brace">}</em>
<a id="L3319" name="L3319"></a>3319             <em class="brace">}</em>
<a id="L3320" name="L3320"></a>3320         <em class="brace">}</em>
<a id="L3321" name="L3321"></a>3321         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L3322" name="L3322"></a>3322             <strong class="reserved">do</strong> <em class="brace">{</em><em class="brace">}</em> <strong class="reserved">while</strong> (!blocker.<a href="../D/26148.html" title="Multiple defined in 3 places.">isReleasable</a>() &amp;&amp;
<a id="L3323" name="L3323"></a>3323                          !blocker.<a href="../D/11878.html" title="Multiple defined in 4 places.">block</a>());
<a id="L3324" name="L3324"></a>3324         <em class="brace">}</em>
<a id="L3325" name="L3325"></a>3325     <em class="brace">}</em>
<a id="L3326" name="L3326"></a>3326 
<a id="L3327" name="L3327"></a>3327     <em class="comment">// AbstractExecutorService overrides.  These rely on undocumented</em>
<a id="L3328" name="L3328"></a>3328     <em class="comment">// fact that ForkJoinTask.adapt returns ForkJoinTasks that also</em>
<a id="L3329" name="L3329"></a>3329     <em class="comment">// implement RunnableFuture.</em>
<a id="L3330" name="L3330"></a>3330 
<a id="L3331" name="L3331"></a>3331     <strong class="reserved">protected</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/1099.html#L48" title="Defined at 48 in src/java/util/concurrent/RunnableFuture.java.">RunnableFuture</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../R/23622.html" title="Multiple referred from 9 places.">newTaskFor</a>(<a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> runnable, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>) <em class="brace">{</em>
<a id="L3332" name="L3332"></a>3332         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1358" title="Defined at 1358 in src/java/util/concurrent/ForkJoinTask.java.">AdaptedRunnable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;(runnable, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L3333" name="L3333"></a>3333     <em class="brace">}</em>
<a id="L3334" name="L3334"></a>3334 
<a id="L3335" name="L3335"></a>3335     <strong class="reserved">protected</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/1099.html#L48" title="Defined at 48 in src/java/util/concurrent/RunnableFuture.java.">RunnableFuture</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../R/23622.html" title="Multiple referred from 9 places.">newTaskFor</a>(<a href="../S/1040.html#L58" title="Defined at 58 in src/java/util/concurrent/Callable.java.">Callable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/12117.html" title="Multiple defined in 4 places.">callable</a>) <em class="brace">{</em>
<a id="L3336" name="L3336"></a>3336         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>.<a href="../S/1101.html#L1412" title="Defined at 1412 in src/java/util/concurrent/ForkJoinTask.java.">AdaptedCallable</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;(<a href="../D/12117.html" title="Multiple defined in 4 places.">callable</a>);
<a id="L3337" name="L3337"></a>3337     <em class="brace">}</em>
<a id="L3338" name="L3338"></a>3338 
<a id="L3339" name="L3339"></a>3339     <em class="comment">// Unsafe mechanics</em>
<a id="L3340" name="L3340"></a>3340     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> sun.misc.Unsafe U;
<a id="L3341" name="L3341"></a>3341     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  ABASE;
<a id="L3342" name="L3342"></a>3342     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  ASHIFT;
<a id="L3343" name="L3343"></a>3343     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> CTL;
<a id="L3344" name="L3344"></a>3344     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> RUNSTATE;
<a id="L3345" name="L3345"></a>3345     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> STEALCOUNTER;
<a id="L3346" name="L3346"></a>3346     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> PARKBLOCKER;
<a id="L3347" name="L3347"></a>3347     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QTOP;
<a id="L3348" name="L3348"></a>3348     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QLOCK;
<a id="L3349" name="L3349"></a>3349     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QSCANSTATE;
<a id="L3350" name="L3350"></a>3350     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QPARKER;
<a id="L3351" name="L3351"></a>3351     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QCURRENTSTEAL;
<a id="L3352" name="L3352"></a>3352     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> QCURRENTJOIN;
<a id="L3353" name="L3353"></a>3353 
<a id="L3354" name="L3354"></a>3354     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L3355" name="L3355"></a>3355         <em class="comment">// initialize field offsets for CAS etc</em>
<a id="L3356" name="L3356"></a>3356         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L3357" name="L3357"></a>3357             U = sun.misc.Unsafe.getUnsafe();
<a id="L3358" name="L3358"></a>3358             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; k = <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a>.<strong class="reserved">class</strong>;
<a id="L3359" name="L3359"></a>3359             CTL = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3360" name="L3360"></a>3360                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("ctl"));
<a id="L3361" name="L3361"></a>3361             RUNSTATE = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3362" name="L3362"></a>3362                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("runState"));
<a id="L3363" name="L3363"></a>3363             STEALCOUNTER = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3364" name="L3364"></a>3364                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("stealCounter"));
<a id="L3365" name="L3365"></a>3365             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; tk = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<strong class="reserved">class</strong>;
<a id="L3366" name="L3366"></a>3366             PARKBLOCKER = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3367" name="L3367"></a>3367                 (tk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("parkBlocker"));
<a id="L3368" name="L3368"></a>3368             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; wk = <a href="../D/9763.html" title="Multiple defined in 2 places.">WorkQueue</a>.<strong class="reserved">class</strong>;
<a id="L3369" name="L3369"></a>3369             QTOP = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3370" name="L3370"></a>3370                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("top"));
<a id="L3371" name="L3371"></a>3371             QLOCK = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3372" name="L3372"></a>3372                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("qlock"));
<a id="L3373" name="L3373"></a>3373             QSCANSTATE = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3374" name="L3374"></a>3374                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("scanState"));
<a id="L3375" name="L3375"></a>3375             QPARKER = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3376" name="L3376"></a>3376                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("parker"));
<a id="L3377" name="L3377"></a>3377             QCURRENTSTEAL = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3378" name="L3378"></a>3378                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("currentSteal"));
<a id="L3379" name="L3379"></a>3379             QCURRENTJOIN = U.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L3380" name="L3380"></a>3380                 (wk.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("currentJoin"));
<a id="L3381" name="L3381"></a>3381             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; ak = <a href="../S/1101.html#L212" title="Defined at 212 in src/java/util/concurrent/ForkJoinTask.java.">ForkJoinTask</a>[].<strong class="reserved">class</strong>;
<a id="L3382" name="L3382"></a>3382             ABASE = U.arrayBaseOffset(ak);
<a id="L3383" name="L3383"></a>3383             <strong class="reserved">int</strong> <a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a> = U.arrayIndexScale(ak);
<a id="L3384" name="L3384"></a>3384             <strong class="reserved">if</strong> ((<a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a> &amp; (<a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a> - 1)) != 0)
<a id="L3385" name="L3385"></a>3385                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>("data type scale not a power of two");
<a id="L3386" name="L3386"></a>3386             ASHIFT = 31 - <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.<a href="../D/28378.html" title="Multiple defined in 2 places.">numberOfLeadingZeros</a>(<a href="../D/31554.html" title="Multiple defined in 10 places.">scale</a>);
<a id="L3387" name="L3387"></a>3387         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L3388" name="L3388"></a>3388             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(e);
<a id="L3389" name="L3389"></a>3389         <em class="brace">}</em>
<a id="L3390" name="L3390"></a>3390 
<a id="L3391" name="L3391"></a>3391         commonMaxSpares = DEFAULT_COMMON_MAX_SPARES;
<a id="L3392" name="L3392"></a>3392         defaultForkJoinWorkerThreadFactory =
<a id="L3393" name="L3393"></a>3393             <strong class="reserved">new</strong> <a href="../S/1063.html#L728" title="Defined at 728 in src/java/util/concurrent/ForkJoinPool.java.">DefaultForkJoinWorkerThreadFactory</a>();
<a id="L3394" name="L3394"></a>3394         modifyThreadPermission = <strong class="reserved">new</strong> <a href="../S/1764.html#L349" title="Defined at 349 in src/java/lang/RuntimePermission.java.">RuntimePermission</a>("modifyThread");
<a id="L3395" name="L3395"></a>3395 
<a id="L3396" name="L3396"></a>3396         common = <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.security.<a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>
<a id="L3397" name="L3397"></a>3397             (<strong class="reserved">new</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.security.<a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a>&gt;() <em class="brace">{</em>
<a id="L3398" name="L3398"></a>3398                 <strong class="reserved">public</strong> <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../S/1063.html#L3407" title="Defined at 3407 in src/java/util/concurrent/ForkJoinPool.java.">makeCommonPool</a>(); <em class="brace">}</em><em class="brace">}</em>);
<a id="L3399" name="L3399"></a>3399         <strong class="reserved">int</strong> par = common.<a href="../D/13217.html" title="Multiple defined in 5 places.">config</a> &amp; SMASK; <em class="comment">// report 1 even if threads disabled</em>
<a id="L3400" name="L3400"></a>3400         commonParallelism = par &gt; 0 ? par : 1;
<a id="L3401" name="L3401"></a>3401     <em class="brace">}</em>
<a id="L3402" name="L3402"></a>3402 
<div class="comment">
      Creates and returns the common pool, respecting user settings
      specified via system properties.</div>
<a id="L3407" name="L3407"></a>3407     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> <a href="../S/1063.html#L3398" title="Referred from 3398 in src/java/util/concurrent/ForkJoinPool.java.">makeCommonPool</a>() <em class="brace">{</em>
<a id="L3408" name="L3408"></a>3408         <strong class="reserved">int</strong> parallelism = -1;
<a id="L3409" name="L3409"></a>3409         <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> = <strong class="reserved">null</strong>;
<a id="L3410" name="L3410"></a>3410         <a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a> <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a> = <strong class="reserved">null</strong>;
<a id="L3411" name="L3411"></a>3411         <strong class="reserved">try</strong> <em class="brace">{</em>  <em class="comment">// ignore exceptions in accessing/parsing properties</em>
<a id="L3412" name="L3412"></a>3412             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> pp = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>
<a id="L3413" name="L3413"></a>3413                 ("java.util.concurrent.ForkJoinPool.common.parallelism");
<a id="L3414" name="L3414"></a>3414             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> fp = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>
<a id="L3415" name="L3415"></a>3415                 ("java.util.concurrent.ForkJoinPool.common.threadFactory");
<a id="L3416" name="L3416"></a>3416             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> hp = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>
<a id="L3417" name="L3417"></a>3417                 ("java.util.concurrent.ForkJoinPool.common.exceptionHandler");
<a id="L3418" name="L3418"></a>3418             <strong class="reserved">if</strong> (pp != <strong class="reserved">null</strong>)
<a id="L3419" name="L3419"></a>3419                 parallelism = <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.<a href="../D/29148.html" title="Multiple defined in 9 places.">parseInt</a>(pp);
<a id="L3420" name="L3420"></a>3420             <strong class="reserved">if</strong> (fp != <strong class="reserved">null</strong>)
<a id="L3421" name="L3421"></a>3421                 <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> = ((<a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a>)<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a>.
<a id="L3422" name="L3422"></a>3422                            <a href="../D/22895.html" title="Multiple defined in 7 places.">getSystemClassLoader</a>().<a href="../D/26901.html" title="Multiple defined in 49 places.">loadClass</a>(fp).<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>());
<a id="L3423" name="L3423"></a>3423             <strong class="reserved">if</strong> (hp != <strong class="reserved">null</strong>)
<a id="L3424" name="L3424"></a>3424                 <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a> = ((<a href="../S/1769.html#L1838" title="Defined at 1838 in src/java/lang/Thread.java.">UncaughtExceptionHandler</a>)<a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a>.
<a id="L3425" name="L3425"></a>3425                            <a href="../D/22895.html" title="Multiple defined in 7 places.">getSystemClassLoader</a>().<a href="../D/26901.html" title="Multiple defined in 49 places.">loadClass</a>(hp).<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>());
<a id="L3426" name="L3426"></a>3426         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <a href="../D/24317.html" title="Multiple defined in 3 places.">ignore</a>) <em class="brace">{</em>
<a id="L3427" name="L3427"></a>3427         <em class="brace">}</em>
<a id="L3428" name="L3428"></a>3428         <strong class="reserved">if</strong> (<a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L3429" name="L3429"></a>3429             <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>() == <strong class="reserved">null</strong>)
<a id="L3430" name="L3430"></a>3430                 <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> = defaultForkJoinWorkerThreadFactory;
<a id="L3431" name="L3431"></a>3431             <strong class="reserved">else</strong> <em class="comment">// use security-managed default</em>
<a id="L3432" name="L3432"></a>3432                 <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> = <strong class="reserved">new</strong> <a href="../S/1063.html#L3446" title="Defined at 3446 in src/java/util/concurrent/ForkJoinPool.java.">InnocuousForkJoinWorkerThreadFactory</a>();
<a id="L3433" name="L3433"></a>3433         <em class="brace">}</em>
<a id="L3434" name="L3434"></a>3434         <strong class="reserved">if</strong> (parallelism &lt; 0 &amp;&amp; <em class="comment">// default 1 less than #cores</em>
<a id="L3435" name="L3435"></a>3435             (parallelism = <a href="../S/1774.html#L46" title="Defined at 46 in src/java/lang/Runtime.java.">Runtime</a>.<a href="../S/1774.html#L57" title="Defined at 57 in src/java/lang/Runtime.java.">getRuntime</a>().<a href="../S/1774.html#L635" title="Defined at 635 in src/java/lang/Runtime.java.">availableProcessors</a>() - 1) &lt;= 0)
<a id="L3436" name="L3436"></a>3436             parallelism = 1;
<a id="L3437" name="L3437"></a>3437         <strong class="reserved">if</strong> (parallelism &gt; MAX_CAP)
<a id="L3438" name="L3438"></a>3438             parallelism = MAX_CAP;
<a id="L3439" name="L3439"></a>3439         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a>(parallelism, <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>, <a href="../S/5398.html#L302" title="Defined at 302 in src/com/sun/org/apache/xerces/internal/jaxp/JAXPValidatorComponent.java.">handler</a>, LIFO_QUEUE,
<a id="L3440" name="L3440"></a>3440                                 "ForkJoinPool.commonPool-worker-");
<a id="L3441" name="L3441"></a>3441     <em class="brace">}</em>
<a id="L3442" name="L3442"></a>3442 
<div class="comment">
      Factory for innocuous worker threads</div>
<a id="L3446" name="L3446"></a>3446     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/1063.html#L3432" title="Referred from 3432 in src/java/util/concurrent/ForkJoinPool.java.">InnocuousForkJoinWorkerThreadFactory</a>
<a id="L3447" name="L3447"></a>3447         <strong class="reserved">implements</strong> <a href="../S/1063.html#L713" title="Defined at 713 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinWorkerThreadFactory</a> <em class="brace">{</em>
<a id="L3448" name="L3448"></a>3448 
<div class="comment">
          An ACC to restrict permissions for the factory itself.
          The constructed workers have no permissions set.</div>
<a id="L3453" name="L3453"></a>3453         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> innocuousAcc;
<a id="L3454" name="L3454"></a>3454         <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L3455" name="L3455"></a>3455             <a href="../S/1353.html#L81" title="Defined at 81 in src/java/security/Permissions.java.">Permissions</a> innocuousPerms = <strong class="reserved">new</strong> <a href="../S/1353.html#L81" title="Defined at 81 in src/java/security/Permissions.java.">Permissions</a>();
<a id="L3456" name="L3456"></a>3456             innocuousPerms.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(modifyThreadPermission);
<a id="L3457" name="L3457"></a>3457             innocuousPerms.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<strong class="reserved">new</strong> <a href="../S/1764.html#L349" title="Defined at 349 in src/java/lang/RuntimePermission.java.">RuntimePermission</a>(
<a id="L3458" name="L3458"></a>3458                                    "enableContextClassLoaderOverride"));
<a id="L3459" name="L3459"></a>3459             innocuousPerms.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<strong class="reserved">new</strong> <a href="../S/1764.html#L349" title="Defined at 349 in src/java/lang/RuntimePermission.java.">RuntimePermission</a>(
<a id="L3460" name="L3460"></a>3460                                    "modifyThreadGroup"));
<a id="L3461" name="L3461"></a>3461             innocuousAcc = <strong class="reserved">new</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a>(<strong class="reserved">new</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] <em class="brace">{</em>
<a id="L3462" name="L3462"></a>3462                     <strong class="reserved">new</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>(<strong class="reserved">null</strong>, innocuousPerms)
<a id="L3463" name="L3463"></a>3463                 <em class="brace">}</em>);
<a id="L3464" name="L3464"></a>3464         <em class="brace">}</em>
<a id="L3465" name="L3465"></a>3465 
<a id="L3466" name="L3466"></a>3466         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> <a href="../R/23625.html" title="Multiple referred from 5 places.">newThread</a>(<a href="../S/1063.html#L170" title="Defined at 170 in src/java/util/concurrent/ForkJoinPool.java.">ForkJoinPool</a> pool) <em class="brace">{</em>
<a id="L3467" name="L3467"></a>3467             <strong class="reserved">return</strong> (<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>.<a href="../S/1113.html#L213" title="Defined at 213 in src/java/util/concurrent/ForkJoinWorkerThread.java.">InnocuousForkJoinWorkerThread</a>)
<a id="L3468" name="L3468"></a>3468                 <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.security.<a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(
<a id="L3469" name="L3469"></a>3469                     <strong class="reserved">new</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.security.<a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>&gt;() <em class="brace">{</em>
<a id="L3470" name="L3470"></a>3470                     <strong class="reserved">public</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L3471" name="L3471"></a>3471                         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1113.html#L55" title="Defined at 55 in src/java/util/concurrent/ForkJoinWorkerThread.java.">ForkJoinWorkerThread</a>.
<a id="L3472" name="L3472"></a>3472                             <a href="../S/1113.html#L213" title="Defined at 213 in src/java/util/concurrent/ForkJoinWorkerThread.java.">InnocuousForkJoinWorkerThread</a>(pool);
<a id="L3473" name="L3473"></a>3473                     <em class="brace">}</em><em class="brace">}</em>, innocuousAcc);
<a id="L3474" name="L3474"></a>3474         <em class="brace">}</em>
<a id="L3475" name="L3475"></a>3475     <em class="brace">}</em>
<a id="L3476" name="L3476"></a>3476 
<a id="L3477" name="L3477"></a>3477 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L699">[^]</a><a href="#L3466">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>