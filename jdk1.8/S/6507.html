<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L122">[^]</a><a href="#L832">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L122" title="Defined at 122.">getNotificationBuffer</a></li>
<li><a href="#L161" title="Defined at 161.">removeNotificationBuffer</a></li>
<li><a href="#L167" title="Defined at 167.">addSharer</a></li>
<li><a href="#L177" title="Defined at 177.">removeSharer</a></li>
<li><a href="#L205" title="Defined at 205.">resize</a></li>
<li><a href="#L221" title="Defined at 221.">fetchNotifications</a></li>
<li><a href="#L231" title="Defined at 231.">dispose</a></li>
<li><a href="#L235" title="Defined at 235.">getSize</a></li>
<li><a href="#L261" title="Defined at 261.">isDisposed</a></li>
<li><a href="#L268" title="Defined at 268.">dispose</a></li>
<li><a href="#L300" title="Defined at 300.">fetchNotifications</a></li>
<li><a href="#L503" title="Defined at 503.">earliestSequenceNumber</a></li>
<li><a href="#L507" title="Defined at 507.">nextSequenceNumber</a></li>
<li><a href="#L511" title="Defined at 511.">addNotification</a></li>
<li><a href="#L530" title="Defined at 530.">dropNotification</a></li>
<li><a href="#L535" title="Defined at 535.">notificationAt</a></li>
<li><a href="#L552" title="Defined at 552.">getObjectName</a></li>
<li><a href="#L556" title="Defined at 556.">getNotification</a></li>
<li><a href="#L560" title="Defined at 560.">toString</a></li>
<li><a href="#L600" title="Defined at 600.">createListeners</a></li>
<li><a href="#L635" title="Defined at 635.">addBufferListener</a></li>
<li><a href="#L649" title="Defined at 649.">removeBufferListener</a></li>
<li><a href="#L660" title="Defined at 660.">addNotificationListener</a></li>
<li><a href="#L680" title="Defined at 680.">removeNotificationListener</a></li>
<li><a href="#L695" title="Defined at 695.">queryNames</a></li>
<li><a href="#L712" title="Defined at 712.">isInstanceOf</a></li>
<li><a href="#L738" title="Defined at 738.">createdNotification</a></li>
<li><a href="#L765" title="Defined at 765.">handleNotification</a></li>
<li><a href="#L781" title="Defined at 781.">apply</a></li>
<li><a href="#L804" title="Defined at 804.">destroyListeners</a></li>
<li><a href="#L823" title="Defined at 823.">checkNoLocks</a></li>
<li><a href="#L832" title="Defined at 832.">extractException</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> com.sun.jmx.remote.internal;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.security.AccessController;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.security.PrivilegedAction;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.security.PrivilegedActionException;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.security.PrivilegedExceptionAction;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.util.Collection;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> java.util.Collections;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> java.util.HashSet;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.util.List;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.Set;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.HashMap;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.Map;
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> javax.management.InstanceNotFoundException;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> javax.management.MBeanServer;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> javax.management.MBeanServerDelegate;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> javax.management.MBeanServerNotification;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> javax.management.Notification;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> javax.management.NotificationBroadcaster;
<a id="L47" name="L47"></a>  47 <strong class="reserved">import</strong> javax.management.NotificationFilter;
<a id="L48" name="L48"></a>  48 <strong class="reserved">import</strong> javax.management.NotificationFilterSupport;
<a id="L49" name="L49"></a>  49 <strong class="reserved">import</strong> javax.management.NotificationListener;
<a id="L50" name="L50"></a>  50 <strong class="reserved">import</strong> javax.management.ObjectName;
<a id="L51" name="L51"></a>  51 <strong class="reserved">import</strong> javax.management.QueryEval;
<a id="L52" name="L52"></a>  52 <strong class="reserved">import</strong> javax.management.QueryExp;
<a id="L53" name="L53"></a>  53 
<a id="L54" name="L54"></a>  54 <strong class="reserved">import</strong> javax.management.remote.NotificationResult;
<a id="L55" name="L55"></a>  55 <strong class="reserved">import</strong> javax.management.remote.TargetedNotification;
<a id="L56" name="L56"></a>  56 
<a id="L57" name="L57"></a>  57 <strong class="reserved">import</strong> com.sun.jmx.remote.util.EnvHelp;
<a id="L58" name="L58"></a>  58 <strong class="reserved">import</strong> com.sun.jmx.remote.util.ClassLogger;
<a id="L59" name="L59"></a>  59 
<div class="comment">
 /** A circular buffer of notifications received from an MBean server. */</div>
<div class="comment">
  There is one instance of ArrayNotificationBuffer for every
  MBeanServer object that has an attached ConnectorServer.  Then, for
  every ConnectorServer attached to a given MBeanServer, there is an
  instance of the inner class ShareBuffer.  So for example with two
  ConnectorServers it looks like this:
  ConnectorServer1 -&gt; ShareBuffer1 -\
                                     }-&gt; ArrayNotificationBuffer
  ConnectorServer2 -&gt; ShareBuffer2 -/              |
                                                   |
                                                   v
                                              MBeanServer
  The ArrayNotificationBuffer has a circular buffer of
  NamedNotification objects.  Each ConnectorServer defines a
  notification buffer size, and this size is recorded by the
  corresponding ShareBuffer.  The buffer size of the
  ArrayNotificationBuffer is the maximum of all of its ShareBuffers.
  When a ShareBuffer is added or removed, the ArrayNotificationBuffer
  size is adjusted accordingly.
  An ArrayNotificationBuffer also has a BufferListener (which is a
  NotificationListener) registered on every NotificationBroadcaster
  MBean in the MBeanServer to which it is attached.  The cost of this
  potentially large set of listeners is the principal motivation for
  sharing the ArrayNotificationBuffer between ConnectorServers, and
  also the reason that we are careful to discard the
  ArrayNotificationBuffer (and its BufferListeners) when there are no
  longer any ConnectorServers using it.
  The synchronization of this class is inherently complex.  In an attempt
  to limit the complexity, we use just two locks:
  - globalLock controls access to the mapping between an MBeanServer
    and its ArrayNotificationBuffer and to the set of ShareBuffers for
    each ArrayNotificationBuffer.
  - the instance lock of each ArrayNotificationBuffer controls access
    to the array of notifications, including its size, and to the
    dispose flag of the ArrayNotificationBuffer.  The wait/notify
    mechanism is used to indicate changes to the array.
  If both locks are held at the same time, the globalLock must be
  taken first.
  Since adding or removing a BufferListener to an MBean can involve
  calling user code, we are careful not to hold any locks while it is
  done.</div>
<a id="L111" name="L111"></a> 111 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/457.html" title="Multiple referred from 8 places.">ArrayNotificationBuffer</a> <strong class="reserved">implements</strong> <a href="../S/6509.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBuffer.java.">NotificationBuffer</a> <em class="brace">{</em>
<a id="L112" name="L112"></a> 112     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> disposed = <strong class="reserved">false</strong>;
<a id="L113" name="L113"></a> 113 
<a id="L114" name="L114"></a> 114     <em class="comment">// FACTORY STUFF, INCLUDING SHARING</em>
<a id="L115" name="L115"></a> 115 
<a id="L116" name="L116"></a> 116     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> globalLock = <strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>();
<a id="L117" name="L117"></a> 117     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong>
<a id="L118" name="L118"></a> 118         <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>&lt;<a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a>,<a href="../S/6507.html#L111" title="Defined at 111 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ArrayNotificationBuffer</a>&gt; mbsToBuffer =
<a id="L119" name="L119"></a> 119         <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>&lt;<a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a>,<a href="../S/6507.html#L111" title="Defined at 111 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ArrayNotificationBuffer</a>&gt;(1);
<a id="L120" name="L120"></a> 120     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/6507.html#L214" title="Defined at 214 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ShareBuffer</a>&gt; sharers = <strong class="reserved">new</strong> <a href="../S/1136.html#L89" title="Defined at 89 in src/java/util/HashSet.java.">HashSet</a>&lt;<a href="../S/6507.html#L214" title="Defined at 214 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ShareBuffer</a>&gt;(1);
<a id="L121" name="L121"></a> 121 
<a id="L122" name="L122"></a> 122     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/6509.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBuffer.java.">NotificationBuffer</a> <a href="../S/3627.html#L526" title="Referred from 526 in src/javax/management/remote/rmi/RMIServerImpl.java.">getNotificationBuffer</a>(
<a id="L123" name="L123"></a> 123             <a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a> mbs, <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, ?&gt; <a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>) <em class="brace">{</em>
<a id="L124" name="L124"></a> 124 
<a id="L125" name="L125"></a> 125         <strong class="reserved">if</strong> (<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a> == <strong class="reserved">null</strong>)
<a id="L126" name="L126"></a> 126             <a href="../D/15665.html" title="Multiple defined in 2 places.">env</a> = <a href="../S/1147.html#L80" title="Defined at 80 in src/java/util/Collections.java.">Collections</a>.<a href="../S/1147.html#L4519" title="Defined at 4519 in src/java/util/Collections.java.">emptyMap</a>();
<a id="L127" name="L127"></a> 127 
<a id="L128" name="L128"></a> 128         <em class="comment">//Find out queue size</em>
<a id="L129" name="L129"></a> 129         <strong class="reserved">int</strong> <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a> = <a href="../S/6493.html#L55" title="Defined at 55 in src/com/sun/jmx/remote/util/EnvHelp.java.">EnvHelp</a>.<a href="../S/6493.html#L268" title="Defined at 268 in src/com/sun/jmx/remote/util/EnvHelp.java.">getNotifBufferSize</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>);
<a id="L130" name="L130"></a> 130 
<a id="L131" name="L131"></a> 131         <a href="../S/6507.html#L111" title="Defined at 111 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ArrayNotificationBuffer</a> <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>;
<a id="L132" name="L132"></a> 132         <strong class="reserved">boolean</strong> <a href="../D/13587.html" title="Multiple defined in 90 places.">create</a>;
<a id="L133" name="L133"></a> 133         <a href="../S/6509.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBuffer.java.">NotificationBuffer</a> sharer;
<a id="L134" name="L134"></a> 134         <strong class="reserved">synchronized</strong> (globalLock) <em class="brace">{</em>
<a id="L135" name="L135"></a> 135             <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> = mbsToBuffer.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(mbs);
<a id="L136" name="L136"></a> 136             <a href="../D/13587.html" title="Multiple defined in 90 places.">create</a> = (<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> == <strong class="reserved">null</strong>);
<a id="L137" name="L137"></a> 137             <strong class="reserved">if</strong> (<a href="../D/13587.html" title="Multiple defined in 90 places.">create</a>) <em class="brace">{</em>
<a id="L138" name="L138"></a> 138                 <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> = <strong class="reserved">new</strong> <a href="../S/6507.html#L111" title="Defined at 111 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ArrayNotificationBuffer</a>(mbs, <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>);
<a id="L139" name="L139"></a> 139                 mbsToBuffer.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(mbs, <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>);
<a id="L140" name="L140"></a> 140             <em class="brace">}</em>
<a id="L141" name="L141"></a> 141             sharer = <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>.<strong class="reserved">new</strong> <a href="../S/6507.html#L214" title="Defined at 214 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ShareBuffer</a>(<a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>);
<a id="L142" name="L142"></a> 142         <em class="brace">}</em>
<div class="comment">
 We avoid holding any locks while calling createListeners.
          This prevents possible deadlocks involving user code, but
          does mean that a second ConnectorServer created and started
          in this window will return before all the listeners are ready,
          which could lead to surprising behaviour.  The alternative
          would be to block the second ConnectorServer until the first
          one has finished adding all the listeners, but that would then
          be subject to deadlock.</div>
<a id="L152" name="L152"></a> 152         <strong class="reserved">if</strong> (<a href="../D/13587.html" title="Multiple defined in 90 places.">create</a>)
<a id="L153" name="L153"></a> 153             <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>.<a href="../S/6507.html#L600" title="Defined at 600 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">createListeners</a>();
<a id="L154" name="L154"></a> 154         <strong class="reserved">return</strong> sharer;
<a id="L155" name="L155"></a> 155     <em class="brace">}</em>
<a id="L156" name="L156"></a> 156 
<div class="comment">
 Ensure that this buffer is no longer the one that will be returned by
      getNotificationBuffer.  This method is idempotent - calling it more
      than once has no effect beyond that of calling it once.</div>
<a id="L161" name="L161"></a> 161     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../S/6507.html#L183" title="Referred from 183 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">removeNotificationBuffer</a>(<a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a> mbs) <em class="brace">{</em>
<a id="L162" name="L162"></a> 162         <strong class="reserved">synchronized</strong> (globalLock) <em class="brace">{</em>
<a id="L163" name="L163"></a> 163             mbsToBuffer.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(mbs);
<a id="L164" name="L164"></a> 164         <em class="brace">}</em>
<a id="L165" name="L165"></a> 165     <em class="brace">}</em>
<a id="L166" name="L166"></a> 166 
<a id="L167" name="L167"></a> 167     <strong class="reserved">void</strong> <a href="../S/6507.html#L217" title="Referred from 217 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">addSharer</a>(<a href="../S/6507.html#L214" title="Defined at 214 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ShareBuffer</a> sharer) <em class="brace">{</em>
<a id="L168" name="L168"></a> 168         <strong class="reserved">synchronized</strong> (globalLock) <em class="brace">{</em>
<a id="L169" name="L169"></a> 169             <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L170" name="L170"></a> 170                 <strong class="reserved">if</strong> (sharer.<a href="../D/22527.html" title="Multiple defined in 76 places.">getSize</a>() &gt; <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>)
<a id="L171" name="L171"></a> 171                     <a href="../D/31231.html" title="Multiple defined in 41 places.">resize</a>(sharer.<a href="../D/22527.html" title="Multiple defined in 76 places.">getSize</a>());
<a id="L172" name="L172"></a> 172             <em class="brace">}</em>
<a id="L173" name="L173"></a> 173             sharers.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(sharer);
<a id="L174" name="L174"></a> 174         <em class="brace">}</em>
<a id="L175" name="L175"></a> 175     <em class="brace">}</em>
<a id="L176" name="L176"></a> 176 
<a id="L177" name="L177"></a> 177     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/6507.html#L232" title="Referred from 232 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">removeSharer</a>(<a href="../S/6507.html#L214" title="Defined at 214 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ShareBuffer</a> sharer) <em class="brace">{</em>
<a id="L178" name="L178"></a> 178         <strong class="reserved">boolean</strong> <a href="../D/15347.html" title="Multiple defined in 24 places.">empty</a>;
<a id="L179" name="L179"></a> 179         <strong class="reserved">synchronized</strong> (globalLock) <em class="brace">{</em>
<a id="L180" name="L180"></a> 180             sharers.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(sharer);
<a id="L181" name="L181"></a> 181             <a href="../D/15347.html" title="Multiple defined in 24 places.">empty</a> = sharers.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>();
<a id="L182" name="L182"></a> 182             <strong class="reserved">if</strong> (<a href="../D/15347.html" title="Multiple defined in 24 places.">empty</a>)
<a id="L183" name="L183"></a> 183                 <a href="../S/6507.html#L161" title="Defined at 161 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">removeNotificationBuffer</a>(mBeanServer);
<a id="L184" name="L184"></a> 184             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L185" name="L185"></a> 185                 <strong class="reserved">int</strong> <a href="../D/27569.html" title="Multiple defined in 28 places.">max</a> = 0;
<a id="L186" name="L186"></a> 186                 <strong class="reserved">for</strong> (<a href="../S/6507.html#L214" title="Defined at 214 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ShareBuffer</a> <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> : sharers) <em class="brace">{</em>
<a id="L187" name="L187"></a> 187                     <strong class="reserved">int</strong> bufsize = <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>.<a href="../D/22527.html" title="Multiple defined in 76 places.">getSize</a>();
<a id="L188" name="L188"></a> 188                     <strong class="reserved">if</strong> (bufsize &gt; <a href="../D/27569.html" title="Multiple defined in 28 places.">max</a>)
<a id="L189" name="L189"></a> 189                         <a href="../D/27569.html" title="Multiple defined in 28 places.">max</a> = bufsize;
<a id="L190" name="L190"></a> 190                 <em class="brace">}</em>
<a id="L191" name="L191"></a> 191                 <strong class="reserved">if</strong> (<a href="../D/27569.html" title="Multiple defined in 28 places.">max</a> &lt; <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>)
<a id="L192" name="L192"></a> 192                     <a href="../D/31231.html" title="Multiple defined in 41 places.">resize</a>(<a href="../D/27569.html" title="Multiple defined in 28 places.">max</a>);
<a id="L193" name="L193"></a> 193             <em class="brace">}</em>
<a id="L194" name="L194"></a> 194         <em class="brace">}</em>
<a id="L195" name="L195"></a> 195         <strong class="reserved">if</strong> (<a href="../D/15347.html" title="Multiple defined in 24 places.">empty</a>) <em class="brace">{</em>
<a id="L196" name="L196"></a> 196             <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L197" name="L197"></a> 197                 disposed = <strong class="reserved">true</strong>;
<a id="L198" name="L198"></a> 198                 <em class="comment">// Notify potential waiting fetchNotification call</em>
<a id="L199" name="L199"></a> 199                 <a href="../S/1724.html#L295" title="Defined at 295 in src/java/lang/Object.java.">notifyAll</a>();
<a id="L200" name="L200"></a> 200             <em class="brace">}</em>
<a id="L201" name="L201"></a> 201             <a href="../S/6507.html#L804" title="Defined at 804 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">destroyListeners</a>();
<a id="L202" name="L202"></a> 202         <em class="brace">}</em>
<a id="L203" name="L203"></a> 203     <em class="brace">}</em>
<a id="L204" name="L204"></a> 204 
<a id="L205" name="L205"></a> 205     <strong class="reserved">private</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/26311.html" title="Multiple referred from 88 places.">resize</a>(<strong class="reserved">int</strong> newSize) <em class="brace">{</em>
<a id="L206" name="L206"></a> 206         <strong class="reserved">if</strong> (newSize == <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>)
<a id="L207" name="L207"></a> 207             <strong class="reserved">return</strong>;
<a id="L208" name="L208"></a> 208         <strong class="reserved">while</strong> (queue.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() &gt; newSize)
<a id="L209" name="L209"></a> 209             <a href="../S/6507.html#L530" title="Defined at 530 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">dropNotification</a>();
<a id="L210" name="L210"></a> 210         queue.<a href="../D/31231.html" title="Multiple defined in 41 places.">resize</a>(newSize);
<a id="L211" name="L211"></a> 211         <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a> = newSize;
<a id="L212" name="L212"></a> 212     <em class="brace">}</em>
<a id="L213" name="L213"></a> 213 
<a id="L214" name="L214"></a> 214     <strong class="reserved">private</strong> <strong class="reserved">class</strong> <a href="../R/7185.html" title="Multiple referred from 5 places.">ShareBuffer</a> <strong class="reserved">implements</strong> <a href="../S/6509.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBuffer.java.">NotificationBuffer</a> <em class="brace">{</em>
<a id="L215" name="L215"></a> 215         ShareBuffer(<strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>) <em class="brace">{</em>
<a id="L216" name="L216"></a> 216             <strong class="reserved">this</strong>.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L217" name="L217"></a> 217             <a href="../S/6507.html#L167" title="Defined at 167 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">addSharer</a>(<strong class="reserved">this</strong>);
<a id="L218" name="L218"></a> 218         <em class="brace">}</em>
<a id="L219" name="L219"></a> 219 
<a id="L220" name="L220"></a> 220         <strong class="reserved">public</strong> <a href="../S/3614.html#L59" title="Defined at 59 in src/javax/management/remote/NotificationResult.java.">NotificationResult</a>
<a id="L221" name="L221"></a> 221             <a href="../R/14265.html" title="Multiple referred from 4 places.">fetchNotifications</a>(<a href="../S/6504.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBufferFilter.java.">NotificationBufferFilter</a> <a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a>,
<a id="L222" name="L222"></a> 222                                <strong class="reserved">long</strong> startSequenceNumber,
<a id="L223" name="L223"></a> 223                                <strong class="reserved">long</strong> timeout,
<a id="L224" name="L224"></a> 224                                <strong class="reserved">int</strong> maxNotifications)
<a id="L225" name="L225"></a> 225                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L226" name="L226"></a> 226             <a href="../S/6509.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBuffer.java.">NotificationBuffer</a> <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> = <a href="../S/6507.html#L111" title="Defined at 111 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ArrayNotificationBuffer</a>.<strong class="reserved">this</strong>;
<a id="L227" name="L227"></a> 227             <strong class="reserved">return</strong> <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>.<a href="../D/15997.html" title="Multiple defined in 5 places.">fetchNotifications</a>(<a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a>, startSequenceNumber,
<a id="L228" name="L228"></a> 228                                           timeout, maxNotifications);
<a id="L229" name="L229"></a> 229         <em class="brace">}</em>
<a id="L230" name="L230"></a> 230 
<a id="L231" name="L231"></a> 231         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/13337.html" title="Multiple referred from 363 places.">dispose</a>() <em class="brace">{</em>
<a id="L232" name="L232"></a> 232             <a href="../S/6507.html#L111" title="Defined at 111 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">ArrayNotificationBuffer</a>.<strong class="reserved">this</strong>.<a href="../S/6507.html#L177" title="Defined at 177 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">removeSharer</a>(<strong class="reserved">this</strong>);
<a id="L233" name="L233"></a> 233         <em class="brace">}</em>
<a id="L234" name="L234"></a> 234 
<a id="L235" name="L235"></a> 235         <strong class="reserved">int</strong> <a href="../R/19054.html" title="Multiple referred from 291 places.">getSize</a>() <em class="brace">{</em>
<a id="L236" name="L236"></a> 236             <strong class="reserved">return</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L237" name="L237"></a> 237         <em class="brace">}</em>
<a id="L238" name="L238"></a> 238 
<a id="L239" name="L239"></a> 239         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L240" name="L240"></a> 240     <em class="brace">}</em>
<a id="L241" name="L241"></a> 241 
<a id="L242" name="L242"></a> 242 
<a id="L243" name="L243"></a> 243     <em class="comment">// ARRAYNOTIFICATIONBUFFER IMPLEMENTATION</em>
<a id="L244" name="L244"></a> 244 
<a id="L245" name="L245"></a> 245     <strong class="reserved">private</strong> ArrayNotificationBuffer(<a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a> mbs, <strong class="reserved">int</strong> <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>) <em class="brace">{</em>
<a id="L246" name="L246"></a> 246         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L61" title="Defined at 61 in src/com/sun/jmx/remote/util/ClassLogger.java.">traceOn</a>())
<a id="L247" name="L247"></a> 247             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("Constructor", "queueSize=" + <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>);
<a id="L248" name="L248"></a> 248 
<a id="L249" name="L249"></a> 249         <strong class="reserved">if</strong> (mbs == <strong class="reserved">null</strong> || <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a> &lt; 1)
<a id="L250" name="L250"></a> 250             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Bad args");
<a id="L251" name="L251"></a> 251 
<a id="L252" name="L252"></a> 252         <strong class="reserved">this</strong>.mBeanServer = mbs;
<a id="L253" name="L253"></a> 253         <strong class="reserved">this</strong>.<a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a> = <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>;
<a id="L254" name="L254"></a> 254         <strong class="reserved">this</strong>.queue = <strong class="reserved">new</strong> <a href="../S/6505.html#L31" title="Defined at 31 in src/com/sun/jmx/remote/internal/ArrayQueue.java.">ArrayQueue</a>&lt;<a href="../S/6507.html#L546" title="Defined at 546 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">NamedNotification</a>&gt;(<a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>);
<a id="L255" name="L255"></a> 255         <strong class="reserved">this</strong>.<a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a> = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>();
<a id="L256" name="L256"></a> 256         <strong class="reserved">this</strong>.<a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a> = <strong class="reserved">this</strong>.<a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>;
<a id="L257" name="L257"></a> 257 
<a id="L258" name="L258"></a> 258         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("Constructor", "ends");
<a id="L259" name="L259"></a> 259     <em class="brace">}</em>
<a id="L260" name="L260"></a> 260 
<a id="L261" name="L261"></a> 261     <strong class="reserved">private</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">boolean</strong> <a href="../R/21370.html" title="Multiple referred from 11 places.">isDisposed</a>() <em class="brace">{</em>
<a id="L262" name="L262"></a> 262         <strong class="reserved">return</strong> disposed;
<a id="L263" name="L263"></a> 263     <em class="brace">}</em>
<a id="L264" name="L264"></a> 264 
<a id="L265" name="L265"></a> 265     <em class="comment">// We no longer support calling this method from outside.</em>
<a id="L266" name="L266"></a> 266     <em class="comment">// The JDK doesn't contain any such calls and users are not</em>
<a id="L267" name="L267"></a> 267     <em class="comment">// supposed to be accessing this class.</em>
<a id="L268" name="L268"></a> 268     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/13337.html" title="Multiple referred from 363 places.">dispose</a>() <em class="brace">{</em>
<a id="L269" name="L269"></a> 269         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L270" name="L270"></a> 270     <em class="brace">}</em>
<a id="L271" name="L271"></a> 271 
<div class="comment">
      <p>Fetch notifications that match the given listeners.</p>
      <p>The operation only considers notifications with a sequence
      number at least <code>startSequenceNumber</code>.  It will take
      no longer than <code>timeout</code>, and will return no more
      than <code>maxNotifications</code> different notifications.</p>
      <p>If there are no notifications matching the criteria, the
      operation will block until one arrives, subject to the
      timeout.</p>
      @param filter an object that will add notifications to a
      <code>List<targetednotification></targetednotification></code> if they match the current
      listeners with their filters.
      @param startSequenceNumber the first sequence number to
      consider.
      @param timeout the maximum time to wait.  May be 0 to indicate
      not to wait if there are no notifications.
      @param maxNotifications the maximum number of notifications to
      return.  May be 0 to indicate a wait for eligible notifications
      that will return a usable <code>nextSequenceNumber</code>.  The
      {@link TargetedNotification} array in the returned {@link
      NotificationResult} may contain more than this number of
      elements but will not contain more than this number of
      different notifications.</div>
<a id="L299" name="L299"></a> 299     <strong class="reserved">public</strong> <a href="../S/3614.html#L59" title="Defined at 59 in src/javax/management/remote/NotificationResult.java.">NotificationResult</a>
<a id="L300" name="L300"></a> 300         <a href="../R/14265.html" title="Multiple referred from 4 places.">fetchNotifications</a>(<a href="../S/6504.html#L33" title="Defined at 33 in src/com/sun/jmx/remote/internal/NotificationBufferFilter.java.">NotificationBufferFilter</a> <a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a>,
<a id="L301" name="L301"></a> 301                            <strong class="reserved">long</strong> startSequenceNumber,
<a id="L302" name="L302"></a> 302                            <strong class="reserved">long</strong> timeout,
<a id="L303" name="L303"></a> 303                            <strong class="reserved">int</strong> maxNotifications)
<a id="L304" name="L304"></a> 304             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L305" name="L305"></a> 305 
<a id="L306" name="L306"></a> 306         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("fetchNotifications", "starts");
<a id="L307" name="L307"></a> 307 
<a id="L308" name="L308"></a> 308         <strong class="reserved">if</strong> (startSequenceNumber &lt; 0 || <a href="../D/25453.html" title="Multiple defined in 2 places.">isDisposed</a>()) <em class="brace">{</em>
<a id="L309" name="L309"></a> 309             <strong class="reserved">synchronized</strong>(<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L310" name="L310"></a> 310                 <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/3614.html#L59" title="Defined at 59 in src/javax/management/remote/NotificationResult.java.">NotificationResult</a>(<a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>(),
<a id="L311" name="L311"></a> 311                                               <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>(),
<a id="L312" name="L312"></a> 312                                               <strong class="reserved">new</strong> <a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>[0]);
<a id="L313" name="L313"></a> 313             <em class="brace">}</em>
<a id="L314" name="L314"></a> 314         <em class="brace">}</em>
<a id="L315" name="L315"></a> 315 
<a id="L316" name="L316"></a> 316         <em class="comment">// Check arg validity</em>
<a id="L317" name="L317"></a> 317         <strong class="reserved">if</strong> (<a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a> == <strong class="reserved">null</strong>
<a id="L318" name="L318"></a> 318             || startSequenceNumber &lt; 0 || timeout &lt; 0
<a id="L319" name="L319"></a> 319             || maxNotifications &lt; 0) <em class="brace">{</em>
<a id="L320" name="L320"></a> 320             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("fetchNotifications", "Bad args");
<a id="L321" name="L321"></a> 321             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Bad args to fetch");
<a id="L322" name="L322"></a> 322         <em class="brace">}</em>
<a id="L323" name="L323"></a> 323 
<a id="L324" name="L324"></a> 324         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L325" name="L325"></a> 325             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("fetchNotifications",
<a id="L326" name="L326"></a> 326                   "filter=" + <a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a> + "; startSeq=" +
<a id="L327" name="L327"></a> 327                   startSequenceNumber + "; timeout=" + timeout +
<a id="L328" name="L328"></a> 328                   "; max=" + maxNotifications);
<a id="L329" name="L329"></a> 329         <em class="brace">}</em>
<a id="L330" name="L330"></a> 330 
<a id="L331" name="L331"></a> 331         <strong class="reserved">if</strong> (startSequenceNumber &gt; <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>()) <em class="brace">{</em>
<a id="L332" name="L332"></a> 332             <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> = "Start sequence number too big: " +
<a id="L333" name="L333"></a> 333                 startSequenceNumber + " &gt; " + <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>();
<a id="L334" name="L334"></a> 334             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("fetchNotifications", <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L335" name="L335"></a> 335             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L336" name="L336"></a> 336         <em class="brace">}</em>
<a id="L337" name="L337"></a> 337 
<div class="comment">
 Determine the end time corresponding to the timeout value.
           Caller may legitimately supply Long.MAX_VALUE to indicate no
           timeout.  In that case the addition will overflow and produce
           a negative end time.  Set end time to Long.MAX_VALUE in that
           case.  We assume System.currentTimeMillis() is positive.  </div>
<a id="L343" name="L343"></a> 343         <strong class="reserved">long</strong> endTime = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>() + timeout;
<a id="L344" name="L344"></a> 344         <strong class="reserved">if</strong> (endTime &lt; 0) <em class="comment">// overflow</em>
<a id="L345" name="L345"></a> 345             endTime = <a href="../S/1720.html#L54" title="Defined at 54 in src/java/lang/Long.java.">Long</a>.MAX_VALUE;
<a id="L346" name="L346"></a> 346 
<a id="L347" name="L347"></a> 347         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L348" name="L348"></a> 348             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "endTime=" + endTime);
<a id="L349" name="L349"></a> 349 
<div class="comment">
 We set earliestSeq the first time through the loop.  If we
           set it here, notifications could be dropped before we
           started examining them, so earliestSeq might not correspond
           to the earliest notification we examined.  </div>
<a id="L354" name="L354"></a> 354         <strong class="reserved">long</strong> earliestSeq = -1;
<a id="L355" name="L355"></a> 355         <strong class="reserved">long</strong> nextSeq = startSequenceNumber;
<a id="L356" name="L356"></a> 356         <a href="../D/5090.html" title="Multiple defined in 5 places.">List</a>&lt;<a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>&gt; notifs =
<a id="L357" name="L357"></a> 357             <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>&gt;();
<a id="L358" name="L358"></a> 358 
<div class="comment">
 On exit from this loop, notifs, earliestSeq, and nextSeq must
           all be correct values for the returned NotificationResult.  </div>
<a id="L361" name="L361"></a> 361         <strong class="reserved">while</strong> (<strong class="reserved">true</strong>) <em class="brace">{</em>
<a id="L362" name="L362"></a> 362             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "main loop starts");
<a id="L363" name="L363"></a> 363 
<a id="L364" name="L364"></a> 364             <a href="../S/6507.html#L546" title="Defined at 546 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">NamedNotification</a> candidate;
<a id="L365" name="L365"></a> 365 
<div class="comment">
 Get the next available notification regardless of filters,
               or wait for one to arrive if there is none.  </div>
<a id="L368" name="L368"></a> 368             <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L369" name="L369"></a> 369 
<div class="comment">
 First time through.  The current earliestSequenceNumber
                   is the first one we could have examined.  </div>
<a id="L372" name="L372"></a> 372                 <strong class="reserved">if</strong> (earliestSeq &lt; 0) <em class="brace">{</em>
<a id="L373" name="L373"></a> 373                     earliestSeq = <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>();
<a id="L374" name="L374"></a> 374                     <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L375" name="L375"></a> 375                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L376" name="L376"></a> 376                               "earliestSeq=" + earliestSeq);
<a id="L377" name="L377"></a> 377                     <em class="brace">}</em>
<a id="L378" name="L378"></a> 378                     <strong class="reserved">if</strong> (nextSeq &lt; earliestSeq) <em class="brace">{</em>
<a id="L379" name="L379"></a> 379                         nextSeq = earliestSeq;
<a id="L380" name="L380"></a> 380                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L381" name="L381"></a> 381                                      "nextSeq=earliestSeq");
<a id="L382" name="L382"></a> 382                     <em class="brace">}</em>
<a id="L383" name="L383"></a> 383                 <em class="brace">}</em> <strong class="reserved">else</strong>
<a id="L384" name="L384"></a> 384                     earliestSeq = <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>();
<a id="L385" name="L385"></a> 385 
<div class="comment">
 If many notifications have been dropped since the
                   last time through, nextSeq could now be earlier
                   than the current earliest.  If so, notifications
                   may have been lost and we return now so the caller
                   can see this next time it calls.  </div>
<a id="L391" name="L391"></a> 391                 <strong class="reserved">if</strong> (nextSeq &lt; earliestSeq) <em class="brace">{</em>
<a id="L392" name="L392"></a> 392                     <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("fetchNotifications",
<a id="L393" name="L393"></a> 393                           "nextSeq=" + nextSeq + " &lt; " + "earliestSeq=" +
<a id="L394" name="L394"></a> 394                           earliestSeq + " so may have lost notifs");
<a id="L395" name="L395"></a> 395                     <strong class="reserved">break</strong>;
<a id="L396" name="L396"></a> 396                 <em class="brace">}</em>
<a id="L397" name="L397"></a> 397 
<a id="L398" name="L398"></a> 398                 <strong class="reserved">if</strong> (nextSeq &lt; <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>()) <em class="brace">{</em>
<a id="L399" name="L399"></a> 399                     candidate = <a href="../S/6507.html#L535" title="Defined at 535 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">notificationAt</a>(nextSeq);
<a id="L400" name="L400"></a> 400                     <em class="comment">// Skip security check if NotificationBufferFilter is not overloaded</em>
<a id="L401" name="L401"></a> 401                     <strong class="reserved">if</strong> (!(<a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a> <strong class="reserved">instanceof</strong> <a href="../S/6508.html#L59" title="Defined at 59 in src/com/sun/jmx/remote/internal/ServerNotifForwarder.java.">ServerNotifForwarder</a>.<a href="../S/6508.html#L231" title="Defined at 231 in src/com/sun/jmx/remote/internal/ServerNotifForwarder.java.">NotifForwarderBufferFilter</a>)) <em class="brace">{</em>
<a id="L402" name="L402"></a> 402                         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L403" name="L403"></a> 403                             <a href="../S/6508.html#L59" title="Defined at 59 in src/com/sun/jmx/remote/internal/ServerNotifForwarder.java.">ServerNotifForwarder</a>.<a href="../D/12526.html" title="Multiple defined in 7 places.">checkMBeanPermission</a>(<strong class="reserved">this</strong>.mBeanServer,
<a id="L404" name="L404"></a> 404                                                       candidate.<a href="../D/21151.html" title="Multiple defined in 7 places.">getObjectName</a>(),"addNotificationListener");
<a id="L405" name="L405"></a> 405                         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3436.html#L34" title="Defined at 34 in src/javax/management/InstanceNotFoundException.java.">InstanceNotFoundException</a> | <a href="../S/1580.html#L34" title="Defined at 34 in src/java/lang/SecurityException.java.">SecurityException</a> e) <em class="brace">{</em>
<a id="L406" name="L406"></a> 406                             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L407" name="L407"></a> 407                                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "candidate: " + candidate + " skipped. exception " + e);
<a id="L408" name="L408"></a> 408                             <em class="brace">}</em>
<a id="L409" name="L409"></a> 409                             ++nextSeq;
<a id="L410" name="L410"></a> 410                             <strong class="reserved">continue</strong>;
<a id="L411" name="L411"></a> 411                         <em class="brace">}</em>
<a id="L412" name="L412"></a> 412                     <em class="brace">}</em>
<a id="L413" name="L413"></a> 413 
<a id="L414" name="L414"></a> 414                     <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L415" name="L415"></a> 415                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "candidate: " +
<a id="L416" name="L416"></a> 416                                      candidate);
<a id="L417" name="L417"></a> 417                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "nextSeq now " +
<a id="L418" name="L418"></a> 418                                      nextSeq);
<a id="L419" name="L419"></a> 419                     <em class="brace">}</em>
<a id="L420" name="L420"></a> 420                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
 nextSeq is the largest sequence number.  If we
                       already got notifications, return them now.
                       Otherwise wait for some to arrive, with
                       timeout.  </div>
<a id="L425" name="L425"></a> 425                     <strong class="reserved">if</strong> (notifs.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() &gt; 0) <em class="brace">{</em>
<a id="L426" name="L426"></a> 426                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L427" name="L427"></a> 427                               "no more notifs but have some so don't wait");
<a id="L428" name="L428"></a> 428                         <strong class="reserved">break</strong>;
<a id="L429" name="L429"></a> 429                     <em class="brace">}</em>
<a id="L430" name="L430"></a> 430                     <strong class="reserved">long</strong> toWait = endTime - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>();
<a id="L431" name="L431"></a> 431                     <strong class="reserved">if</strong> (toWait &lt;= 0) <em class="brace">{</em>
<a id="L432" name="L432"></a> 432                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "timeout");
<a id="L433" name="L433"></a> 433                         <strong class="reserved">break</strong>;
<a id="L434" name="L434"></a> 434                     <em class="brace">}</em>
<a id="L435" name="L435"></a> 435 
<div class="comment">
                     /* dispose called */</div>
<a id="L437" name="L437"></a> 437                     <strong class="reserved">if</strong> (<a href="../D/25453.html" title="Multiple defined in 2 places.">isDisposed</a>()) <em class="brace">{</em>
<a id="L438" name="L438"></a> 438                         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L439" name="L439"></a> 439                             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L440" name="L440"></a> 440                                          "dispose callled, no wait");
<a id="L441" name="L441"></a> 441                         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/3614.html#L59" title="Defined at 59 in src/javax/management/remote/NotificationResult.java.">NotificationResult</a>(<a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>(),
<a id="L442" name="L442"></a> 442                                                   <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>(),
<a id="L443" name="L443"></a> 443                                                   <strong class="reserved">new</strong> <a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>[0]);
<a id="L444" name="L444"></a> 444                     <em class="brace">}</em>
<a id="L445" name="L445"></a> 445 
<a id="L446" name="L446"></a> 446                     <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L447" name="L447"></a> 447                         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L448" name="L448"></a> 448                                      "wait(" + toWait + ")");
<a id="L449" name="L449"></a> 449                     <a href="../D/36778.html" title="Multiple defined in 3 places.">wait</a>(toWait);
<a id="L450" name="L450"></a> 450 
<a id="L451" name="L451"></a> 451                     <strong class="reserved">continue</strong>;
<a id="L452" name="L452"></a> 452                 <em class="brace">}</em>
<a id="L453" name="L453"></a> 453             <em class="brace">}</em>
<a id="L454" name="L454"></a> 454 
<div class="comment">
 We have a candidate notification.  See if it matches
               our filters.  We do this outside the synchronized block
               so we don't hold up everyone accessing the buffer
               (including notification senders) while we evaluate
               potentially slow filters.  </div>
<a id="L460" name="L460"></a> 460             <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> = candidate.<a href="../D/21151.html" title="Multiple defined in 7 places.">getObjectName</a>();
<a id="L461" name="L461"></a> 461             <a href="../S/3507.html#L57" title="Defined at 57 in src/javax/management/Notification.java.">Notification</a> notif = candidate.<a href="../D/21029.html" title="Multiple defined in 4 places.">getNotification</a>();
<a id="L462" name="L462"></a> 462             <a href="../D/5090.html" title="Multiple defined in 5 places.">List</a>&lt;<a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>&gt; matchedNotifs =
<a id="L463" name="L463"></a> 463                 <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>&gt;();
<a id="L464" name="L464"></a> 464             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L465" name="L465"></a> 465                          "applying filter to candidate");
<a id="L466" name="L466"></a> 466             <a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a>.<a href="../D/11441.html" title="Multiple defined in 32 places.">apply</a>(matchedNotifs, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, notif);
<a id="L467" name="L467"></a> 467 
<a id="L468" name="L468"></a> 468             <strong class="reserved">if</strong> (matchedNotifs.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() &gt; 0) <em class="brace">{</em>
<div class="comment">
 We only check the max size now, so that our
                   returned nextSeq is as large as possible.  This
                   prevents the caller from thinking it missed
                   interesting notifications when in fact we knew they
                   weren't.  </div>
<a id="L474" name="L474"></a> 474                 <strong class="reserved">if</strong> (maxNotifications &lt;= 0) <em class="brace">{</em>
<a id="L475" name="L475"></a> 475                     <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications",
<a id="L476" name="L476"></a> 476                                  "reached maxNotifications");
<a id="L477" name="L477"></a> 477                     <strong class="reserved">break</strong>;
<a id="L478" name="L478"></a> 478                 <em class="brace">}</em>
<a id="L479" name="L479"></a> 479                 --maxNotifications;
<a id="L480" name="L480"></a> 480                 <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L481" name="L481"></a> 481                     <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", "add: " +
<a id="L482" name="L482"></a> 482                                  matchedNotifs);
<a id="L483" name="L483"></a> 483                 notifs.<a href="../D/10646.html" title="Multiple defined in 78 places.">addAll</a>(matchedNotifs);
<a id="L484" name="L484"></a> 484             <em class="brace">}</em>
<a id="L485" name="L485"></a> 485 
<a id="L486" name="L486"></a> 486             ++nextSeq;
<a id="L487" name="L487"></a> 487         <em class="brace">}</em> <em class="comment">// end while</em>
<a id="L488" name="L488"></a> 488 
<div class="comment">
         /* Construct and return the result.  */</div>
<a id="L490" name="L490"></a> 490         <strong class="reserved">int</strong> nnotifs = notifs.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L491" name="L491"></a> 491         <a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>[] resultNotifs =
<a id="L492" name="L492"></a> 492             <strong class="reserved">new</strong> <a href="../S/3618.html#L42" title="Defined at 42 in src/javax/management/remote/TargetedNotification.java.">TargetedNotification</a>[nnotifs];
<a id="L493" name="L493"></a> 493         notifs.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(resultNotifs);
<a id="L494" name="L494"></a> 494         <a href="../S/3614.html#L59" title="Defined at 59 in src/javax/management/remote/NotificationResult.java.">NotificationResult</a> nr =
<a id="L495" name="L495"></a> 495             <strong class="reserved">new</strong> <a href="../S/3614.html#L59" title="Defined at 59 in src/javax/management/remote/NotificationResult.java.">NotificationResult</a>(earliestSeq, nextSeq, resultNotifs);
<a id="L496" name="L496"></a> 496         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L497" name="L497"></a> 497             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("fetchNotifications", nr.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L498" name="L498"></a> 498         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("fetchNotifications", "ends");
<a id="L499" name="L499"></a> 499 
<a id="L500" name="L500"></a> 500         <strong class="reserved">return</strong> nr;
<a id="L501" name="L501"></a> 501     <em class="brace">}</em>
<a id="L502" name="L502"></a> 502 
<a id="L503" name="L503"></a> 503     <strong class="reserved">synchronized</strong> <strong class="reserved">long</strong> <a href="../R/13618.html" title="Multiple referred from 20 places.">earliestSequenceNumber</a>() <em class="brace">{</em>
<a id="L504" name="L504"></a> 504         <strong class="reserved">return</strong> <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>;
<a id="L505" name="L505"></a> 505     <em class="brace">}</em>
<a id="L506" name="L506"></a> 506 
<a id="L507" name="L507"></a> 507     <strong class="reserved">synchronized</strong> <strong class="reserved">long</strong> <a href="../R/23690.html" title="Multiple referred from 19 places.">nextSequenceNumber</a>() <em class="brace">{</em>
<a id="L508" name="L508"></a> 508         <strong class="reserved">return</strong> <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>;
<a id="L509" name="L509"></a> 509     <em class="brace">}</em>
<a id="L510" name="L510"></a> 510 
<a id="L511" name="L511"></a> 511     <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/9879.html" title="Multiple referred from 4 places.">addNotification</a>(<a href="../S/6507.html#L546" title="Defined at 546 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">NamedNotification</a> notif) <em class="brace">{</em>
<a id="L512" name="L512"></a> 512         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L61" title="Defined at 61 in src/com/sun/jmx/remote/util/ClassLogger.java.">traceOn</a>())
<a id="L513" name="L513"></a> 513             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("addNotification", notif.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L514" name="L514"></a> 514 
<a id="L515" name="L515"></a> 515         <strong class="reserved">while</strong> (queue.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() &gt;= <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>) <em class="brace">{</em>
<a id="L516" name="L516"></a> 516             <a href="../S/6507.html#L530" title="Defined at 530 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">dropNotification</a>();
<a id="L517" name="L517"></a> 517             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L518" name="L518"></a> 518                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("addNotification",
<a id="L519" name="L519"></a> 519                       "dropped oldest notif, earliestSeq=" +
<a id="L520" name="L520"></a> 520                       <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>);
<a id="L521" name="L521"></a> 521             <em class="brace">}</em>
<a id="L522" name="L522"></a> 522         <em class="brace">}</em>
<a id="L523" name="L523"></a> 523         queue.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(notif);
<a id="L524" name="L524"></a> 524         <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>++;
<a id="L525" name="L525"></a> 525         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L526" name="L526"></a> 526             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("addNotification", "nextSeq=" + <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>);
<a id="L527" name="L527"></a> 527         <a href="../S/1724.html#L295" title="Defined at 295 in src/java/lang/Object.java.">notifyAll</a>();
<a id="L528" name="L528"></a> 528     <em class="brace">}</em>
<a id="L529" name="L529"></a> 529 
<a id="L530" name="L530"></a> 530     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13591.html" title="Multiple referred from 2 places.">dropNotification</a>() <em class="brace">{</em>
<a id="L531" name="L531"></a> 531         queue.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(0);
<a id="L532" name="L532"></a> 532         <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>++;
<a id="L533" name="L533"></a> 533     <em class="brace">}</em>
<a id="L534" name="L534"></a> 534 
<a id="L535" name="L535"></a> 535     <strong class="reserved">synchronized</strong> <a href="../S/6507.html#L546" title="Defined at 546 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">NamedNotification</a> <a href="../S/6507.html#L399" title="Referred from 399 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">notificationAt</a>(<strong class="reserved">long</strong> seqNo) <em class="brace">{</em>
<a id="L536" name="L536"></a> 536         <strong class="reserved">long</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = seqNo - <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>;
<a id="L537" name="L537"></a> 537         <strong class="reserved">if</strong> (<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &lt; 0 || <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &gt; <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE) <em class="brace">{</em>
<a id="L538" name="L538"></a> 538             <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> = "Bad sequence number: " + seqNo + " (earliest "
<a id="L539" name="L539"></a> 539                 + <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a> + ")";
<a id="L540" name="L540"></a> 540             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("notificationAt", <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L541" name="L541"></a> 541             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L542" name="L542"></a> 542         <em class="brace">}</em>
<a id="L543" name="L543"></a> 543         <strong class="reserved">return</strong> queue.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>((<strong class="reserved">int</strong>) <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L544" name="L544"></a> 544     <em class="brace">}</em>
<a id="L545" name="L545"></a> 545 
<a id="L546" name="L546"></a> 546     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/5437.html" title="Multiple referred from 6 places.">NamedNotification</a> <em class="brace">{</em>
<a id="L547" name="L547"></a> 547         NamedNotification(<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> sender, <a href="../S/3507.html#L57" title="Defined at 57 in src/javax/management/Notification.java.">Notification</a> notif) <em class="brace">{</em>
<a id="L548" name="L548"></a> 548             <strong class="reserved">this</strong>.sender = sender;
<a id="L549" name="L549"></a> 549             <strong class="reserved">this</strong>.notification = notif;
<a id="L550" name="L550"></a> 550         <em class="brace">}</em>
<a id="L551" name="L551"></a> 551 
<a id="L552" name="L552"></a> 552         <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../R/18101.html" title="Multiple referred from 18 places.">getObjectName</a>() <em class="brace">{</em>
<a id="L553" name="L553"></a> 553             <strong class="reserved">return</strong> sender;
<a id="L554" name="L554"></a> 554         <em class="brace">}</em>
<a id="L555" name="L555"></a> 555 
<a id="L556" name="L556"></a> 556         <a href="../S/3507.html#L57" title="Defined at 57 in src/javax/management/Notification.java.">Notification</a> <a href="../R/18019.html" title="Multiple referred from 10 places.">getNotification</a>() <em class="brace">{</em>
<a id="L557" name="L557"></a> 557             <strong class="reserved">return</strong> notification;
<a id="L558" name="L558"></a> 558         <em class="brace">}</em>
<a id="L559" name="L559"></a> 559 
<a id="L560" name="L560"></a> 560         <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L561" name="L561"></a> 561             <strong class="reserved">return</strong> "NamedNotification(" + sender + ", " + notification + ")";
<a id="L562" name="L562"></a> 562         <em class="brace">}</em>
<a id="L563" name="L563"></a> 563 
<a id="L564" name="L564"></a> 564         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> sender;
<a id="L565" name="L565"></a> 565         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/3507.html#L57" title="Defined at 57 in src/javax/management/Notification.java.">Notification</a> notification;
<a id="L566" name="L566"></a> 566     <em class="brace">}</em>
<a id="L567" name="L567"></a> 567 
<div class="comment">
      Add our listener to every NotificationBroadcaster MBean
      currently in the MBean server and to every
      NotificationBroadcaster later created.
      It would be really nice if we could just do
      mbs.addNotificationListener(new ObjectName("*:*"), ...);
      Definitely something for the next version of JMX.
      There is a nasty race condition that we must handle.  We
      first register for MBean-creation notifications so we can add
      listeners to new MBeans, then we query the existing MBeans to
      add listeners to them.  The problem is that a new MBean could
      arrive after we register for creations but before the query has
      completed.  Then we could see the MBean both in the query and
      in an MBean-creation notification, and we would end up
      registering our listener twice.
      To solve this problem, we arrange for new MBeans that arrive
      while the query is being done to be added to the Set createdDuringQuery
      and we do not add a listener immediately.  When the query is done,
      we atomically turn off the addition of new names to createdDuringQuery
      and add all the names that were there to the result of the query.
      Since we are dealing with Sets, the result is the same whether or not
      the newly-created MBean was included in the query result.
      It is important not to hold any locks during the operation of adding
      listeners to MBeans.  An MBean's addNotificationListener can be
      arbitrary user code, and this could deadlock with any locks we hold
      (see bug 6239400).  The corollary is that we must not do any operations
      in this method or the methods it calls that require locks.</div>
<a id="L600" name="L600"></a> 600     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/6507.html#L153" title="Referred from 153 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">createListeners</a>() <em class="brace">{</em>
<a id="L601" name="L601"></a> 601         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("createListeners", "starts");
<a id="L602" name="L602"></a> 602 
<a id="L603" name="L603"></a> 603         <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L604" name="L604"></a> 604             createdDuringQuery = <strong class="reserved">new</strong> <a href="../S/1136.html#L89" title="Defined at 89 in src/java/util/HashSet.java.">HashSet</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt;();
<a id="L605" name="L605"></a> 605         <em class="brace">}</em>
<a id="L606" name="L606"></a> 606 
<a id="L607" name="L607"></a> 607         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L608" name="L608"></a> 608             <a href="../D/10974.html" title="Multiple defined in 26 places.">addNotificationListener</a>(<a href="../S/3539.html#L39" title="Defined at 39 in src/javax/management/MBeanServerDelegate.java.">MBeanServerDelegate</a>.DELEGATE_NAME,
<a id="L609" name="L609"></a> 609                                     creationListener, creationFilter, <strong class="reserved">null</strong>);
<a id="L610" name="L610"></a> 610             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("createListeners", "added creationListener");
<a id="L611" name="L611"></a> 611         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612             <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> = "Can't add listener to MBean server delegate: ";
<a id="L613" name="L613"></a> 613             <a href="../S/1723.html#L43" title="Defined at 43 in src/java/lang/RuntimeException.java.">RuntimeException</a> re = <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> + e);
<a id="L614" name="L614"></a> 614             <a href="../S/6493.html#L55" title="Defined at 55 in src/com/sun/jmx/remote/util/EnvHelp.java.">EnvHelp</a>.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(re, e);
<a id="L615" name="L615"></a> 615             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/16274.html" title="Multiple defined in 5 places.">fine</a>("createListeners", <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> + e);
<a id="L616" name="L616"></a> 616             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("createListeners", e);
<a id="L617" name="L617"></a> 617             <strong class="reserved">throw</strong> re;
<a id="L618" name="L618"></a> 618         <em class="brace">}</em>
<a id="L619" name="L619"></a> 619 
<div class="comment">
 Spec doesn't say whether Set returned by QueryNames can be modified
           so we clone it. </div>
<a id="L622" name="L622"></a> 622         <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt; names = <a href="../D/30064.html" title="Multiple defined in 9 places.">queryNames</a>(<strong class="reserved">null</strong>, broadcasterQuery);
<a id="L623" name="L623"></a> 623         names = <strong class="reserved">new</strong> <a href="../S/1136.html#L89" title="Defined at 89 in src/java/util/HashSet.java.">HashSet</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt;(names);
<a id="L624" name="L624"></a> 624 
<a id="L625" name="L625"></a> 625         <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L626" name="L626"></a> 626             names.<a href="../D/10646.html" title="Multiple defined in 78 places.">addAll</a>(createdDuringQuery);
<a id="L627" name="L627"></a> 627             createdDuringQuery = <strong class="reserved">null</strong>;
<a id="L628" name="L628"></a> 628         <em class="brace">}</em>
<a id="L629" name="L629"></a> 629 
<a id="L630" name="L630"></a> 630         <strong class="reserved">for</strong> (<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> : names)
<a id="L631" name="L631"></a> 631             <a href="../S/6507.html#L635" title="Defined at 635 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">addBufferListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L632" name="L632"></a> 632         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("createListeners", "ends");
<a id="L633" name="L633"></a> 633     <em class="brace">}</em>
<a id="L634" name="L634"></a> 634 
<a id="L635" name="L635"></a> 635     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/9628.html" title="Multiple referred from 2 places.">addBufferListener</a>(<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L636" name="L636"></a> 636         <a href="../S/6507.html#L823" title="Defined at 823 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">checkNoLocks</a>();
<a id="L637" name="L637"></a> 637         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L638" name="L638"></a> 638             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("addBufferListener", <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L639" name="L639"></a> 639         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L640" name="L640"></a> 640             <a href="../D/10974.html" title="Multiple defined in 26 places.">addNotificationListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, bufferListener, <strong class="reserved">null</strong>, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L641" name="L641"></a> 641         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L642" name="L642"></a> 642             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("addBufferListener", e);
<div class="comment">
 This can happen if the MBean was unregistered just
               after the query.  Or user NotificationBroadcaster might
               throw unexpected exception.  </div>
<a id="L646" name="L646"></a> 646         <em class="brace">}</em>
<a id="L647" name="L647"></a> 647     <em class="brace">}</em>
<a id="L648" name="L648"></a> 648 
<a id="L649" name="L649"></a> 649     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25914.html" title="Multiple referred from 2 places.">removeBufferListener</a>(<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L650" name="L650"></a> 650         <a href="../S/6507.html#L823" title="Defined at 823 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">checkNoLocks</a>();
<a id="L651" name="L651"></a> 651         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L652" name="L652"></a> 652             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("removeBufferListener", <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L653" name="L653"></a> 653         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L654" name="L654"></a> 654             <a href="../D/30900.html" title="Multiple defined in 49 places.">removeNotificationListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, bufferListener);
<a id="L655" name="L655"></a> 655         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L656" name="L656"></a> 656             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/35559.html" title="Multiple defined in 6 places.">trace</a>("removeBufferListener", e);
<a id="L657" name="L657"></a> 657         <em class="brace">}</em>
<a id="L658" name="L658"></a> 658     <em class="brace">}</em>
<a id="L659" name="L659"></a> 659 
<a id="L660" name="L660"></a> 660     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/9880.html" title="Multiple referred from 25 places.">addNotificationListener</a>(<strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>,
<a id="L661" name="L661"></a> 661                                          <strong class="reserved">final</strong> <a href="../S/3533.html#L34" title="Defined at 34 in src/javax/management/NotificationListener.java.">NotificationListener</a> listener,
<a id="L662" name="L662"></a> 662                                          <strong class="reserved">final</strong> <a href="../S/3548.html#L35" title="Defined at 35 in src/javax/management/NotificationFilter.java.">NotificationFilter</a> <a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a>,
<a id="L663" name="L663"></a> 663                                          <strong class="reserved">final</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> handback)
<a id="L664" name="L664"></a> 664             <strong class="reserved">throws</strong> <a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <em class="brace">{</em>
<a id="L665" name="L665"></a> 665         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L666" name="L666"></a> 666             <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(<strong class="reserved">new</strong> <a href="../S/1263.html#L45" title="Defined at 45 in src/java/security/PrivilegedExceptionAction.java.">PrivilegedExceptionAction</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt;() <em class="brace">{</em>
<a id="L667" name="L667"></a> 667                 <strong class="reserved">public</strong> <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <strong class="reserved">throws</strong> <a href="../S/3436.html#L34" title="Defined at 34 in src/javax/management/InstanceNotFoundException.java.">InstanceNotFoundException</a> <em class="brace">{</em>
<a id="L668" name="L668"></a> 668                     mBeanServer.<a href="../D/10974.html" title="Multiple defined in 26 places.">addNotificationListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>,
<a id="L669" name="L669"></a> 669                                                         listener,
<a id="L670" name="L670"></a> 670                                                         <a href="../D/16061.html" title="Multiple defined in 29 places.">filter</a>,
<a id="L671" name="L671"></a> 671                                                         handback);
<a id="L672" name="L672"></a> 672                     <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L673" name="L673"></a> 673                 <em class="brace">}</em>
<a id="L674" name="L674"></a> 674             <em class="brace">}</em>);
<a id="L675" name="L675"></a> 675         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L676" name="L676"></a> 676             <strong class="reserved">throw</strong> <a href="../D/15928.html" title="Multiple defined in 3 places.">extractException</a>(e);
<a id="L677" name="L677"></a> 677         <em class="brace">}</em>
<a id="L678" name="L678"></a> 678     <em class="brace">}</em>
<a id="L679" name="L679"></a> 679 
<a id="L680" name="L680"></a> 680     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/26036.html" title="Multiple referred from 45 places.">removeNotificationListener</a>(<strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>,
<a id="L681" name="L681"></a> 681                                             <strong class="reserved">final</strong> <a href="../S/3533.html#L34" title="Defined at 34 in src/javax/management/NotificationListener.java.">NotificationListener</a> listener)
<a id="L682" name="L682"></a> 682             <strong class="reserved">throws</strong> <a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <em class="brace">{</em>
<a id="L683" name="L683"></a> 683         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L684" name="L684"></a> 684             <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(<strong class="reserved">new</strong> <a href="../S/1263.html#L45" title="Defined at 45 in src/java/security/PrivilegedExceptionAction.java.">PrivilegedExceptionAction</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt;() <em class="brace">{</em>
<a id="L685" name="L685"></a> 685                 <strong class="reserved">public</strong> <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <strong class="reserved">throws</strong> <a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <em class="brace">{</em>
<a id="L686" name="L686"></a> 686                     mBeanServer.<a href="../D/30900.html" title="Multiple defined in 49 places.">removeNotificationListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, listener);
<a id="L687" name="L687"></a> 687                     <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L688" name="L688"></a> 688                 <em class="brace">}</em>
<a id="L689" name="L689"></a> 689             <em class="brace">}</em>);
<a id="L690" name="L690"></a> 690         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L691" name="L691"></a> 691             <strong class="reserved">throw</strong> <a href="../D/15928.html" title="Multiple defined in 3 places.">extractException</a>(e);
<a id="L692" name="L692"></a> 692         <em class="brace">}</em>
<a id="L693" name="L693"></a> 693     <em class="brace">}</em>
<a id="L694" name="L694"></a> 694 
<a id="L695" name="L695"></a> 695     <strong class="reserved">private</strong> <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt; <a href="../R/25369.html" title="Multiple referred from 10 places.">queryNames</a>(<strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>,
<a id="L696" name="L696"></a> 696                                        <strong class="reserved">final</strong> <a href="../S/3572.html#L46" title="Defined at 46 in src/javax/management/QueryExp.java.">QueryExp</a> <a href="../D/30057.html" title="Multiple defined in 20 places.">query</a>) <em class="brace">{</em>
<a id="L697" name="L697"></a> 697         <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt;&gt; act =
<a id="L698" name="L698"></a> 698             <strong class="reserved">new</strong> <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt;&gt;() <em class="brace">{</em>
<a id="L699" name="L699"></a> 699                 <strong class="reserved">public</strong> <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L700" name="L700"></a> 700                     <strong class="reserved">return</strong> mBeanServer.<a href="../D/30064.html" title="Multiple defined in 9 places.">queryNames</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/30057.html" title="Multiple defined in 20 places.">query</a>);
<a id="L701" name="L701"></a> 701                 <em class="brace">}</em>
<a id="L702" name="L702"></a> 702             <em class="brace">}</em>;
<a id="L703" name="L703"></a> 703         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L704" name="L704"></a> 704             <strong class="reserved">return</strong> <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(act);
<a id="L705" name="L705"></a> 705         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1723.html#L43" title="Defined at 43 in src/java/lang/RuntimeException.java.">RuntimeException</a> e) <em class="brace">{</em>
<a id="L706" name="L706"></a> 706             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/16274.html" title="Multiple defined in 5 places.">fine</a>("queryNames", "Failed to query names: " + e);
<a id="L707" name="L707"></a> 707             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("queryNames", e);
<a id="L708" name="L708"></a> 708             <strong class="reserved">throw</strong> e;
<a id="L709" name="L709"></a> 709         <em class="brace">}</em>
<a id="L710" name="L710"></a> 710     <em class="brace">}</em>
<a id="L711" name="L711"></a> 711 
<a id="L712" name="L712"></a> 712     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> <a href="../R/21598.html" title="Multiple referred from 28 places.">isInstanceOf</a>(<strong class="reserved">final</strong> <a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a> mbs,
<a id="L713" name="L713"></a> 713                                         <strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>,
<a id="L714" name="L714"></a> 714                                         <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/12779.html" title="Multiple defined in 4 places.">className</a>) <em class="brace">{</em>
<a id="L715" name="L715"></a> 715         <a href="../S/1263.html#L45" title="Defined at 45 in src/java/security/PrivilegedExceptionAction.java.">PrivilegedExceptionAction</a>&lt;<a href="../S/1770.html#L43" title="Defined at 43 in src/java/lang/Boolean.java.">Boolean</a>&gt; act =
<a id="L716" name="L716"></a> 716             <strong class="reserved">new</strong> <a href="../S/1263.html#L45" title="Defined at 45 in src/java/security/PrivilegedExceptionAction.java.">PrivilegedExceptionAction</a>&lt;<a href="../S/1770.html#L43" title="Defined at 43 in src/java/lang/Boolean.java.">Boolean</a>&gt;() <em class="brace">{</em>
<a id="L717" name="L717"></a> 717                 <strong class="reserved">public</strong> <a href="../S/1770.html#L43" title="Defined at 43 in src/java/lang/Boolean.java.">Boolean</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <strong class="reserved">throws</strong> <a href="../S/3436.html#L34" title="Defined at 34 in src/javax/management/InstanceNotFoundException.java.">InstanceNotFoundException</a> <em class="brace">{</em>
<a id="L718" name="L718"></a> 718                     <strong class="reserved">return</strong> mbs.<a href="../D/25730.html" title="Multiple defined in 12 places.">isInstanceOf</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/12779.html" title="Multiple defined in 4 places.">className</a>);
<a id="L719" name="L719"></a> 719                 <em class="brace">}</em>
<a id="L720" name="L720"></a> 720             <em class="brace">}</em>;
<a id="L721" name="L721"></a> 721         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L722" name="L722"></a> 722             <strong class="reserved">return</strong> <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(act);
<a id="L723" name="L723"></a> 723         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L724" name="L724"></a> 724             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/16274.html" title="Multiple defined in 5 places.">fine</a>("isInstanceOf", "failed: " + e);
<a id="L725" name="L725"></a> 725             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("isInstanceOf", e);
<a id="L726" name="L726"></a> 726             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L727" name="L727"></a> 727         <em class="brace">}</em>
<a id="L728" name="L728"></a> 728     <em class="brace">}</em>
<a id="L729" name="L729"></a> 729 
<div class="comment">
 This method must not be synchronized.  See the comment on the
      createListeners method.
      The notification could arrive after our buffer has been destroyed
      or even during its destruction.  So we always add our listener
      (without synchronization), then we check if the buffer has been
      destroyed and if so remove the listener we just added.</div>
<a id="L738" name="L738"></a> 738     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/6507.html#L800" title="Referred from 800 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">createdNotification</a>(<a href="../S/3447.html#L98" title="Defined at 98 in src/javax/management/MBeanServerNotification.java.">MBeanServerNotification</a> n) <em class="brace">{</em>
<a id="L739" name="L739"></a> 739         <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> shouldEqual =
<a id="L740" name="L740"></a> 740             <a href="../S/3447.html#L98" title="Defined at 98 in src/javax/management/MBeanServerNotification.java.">MBeanServerNotification</a>.REGISTRATION_NOTIFICATION;
<a id="L741" name="L741"></a> 741         <strong class="reserved">if</strong> (!n.<a href="../D/23311.html" title="Multiple defined in 232 places.">getType</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(shouldEqual)) <em class="brace">{</em>
<a id="L742" name="L742"></a> 742             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/36831.html" title="Multiple defined in 36 places.">warning</a>("createNotification", "bad type: " + n.<a href="../D/23311.html" title="Multiple defined in 232 places.">getType</a>());
<a id="L743" name="L743"></a> 743             <strong class="reserved">return</strong>;
<a id="L744" name="L744"></a> 744         <em class="brace">}</em>
<a id="L745" name="L745"></a> 745 
<a id="L746" name="L746"></a> 746         <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> = n.<a href="../S/3447.html#L148" title="Defined at 148 in src/javax/management/MBeanServerNotification.java.">getMBeanName</a>();
<a id="L747" name="L747"></a> 747         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L748" name="L748"></a> 748             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("createdNotification", "for: " + <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L749" name="L749"></a> 749 
<a id="L750" name="L750"></a> 750         <strong class="reserved">synchronized</strong> (<strong class="reserved">this</strong>) <em class="brace">{</em>
<a id="L751" name="L751"></a> 751             <strong class="reserved">if</strong> (createdDuringQuery != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L752" name="L752"></a> 752                 createdDuringQuery.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L753" name="L753"></a> 753                 <strong class="reserved">return</strong>;
<a id="L754" name="L754"></a> 754             <em class="brace">}</em>
<a id="L755" name="L755"></a> 755         <em class="brace">}</em>
<a id="L756" name="L756"></a> 756 
<a id="L757" name="L757"></a> 757         <strong class="reserved">if</strong> (<a href="../D/25730.html" title="Multiple defined in 12 places.">isInstanceOf</a>(mBeanServer, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, broadcasterClass)) <em class="brace">{</em>
<a id="L758" name="L758"></a> 758             <a href="../S/6507.html#L635" title="Defined at 635 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">addBufferListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L759" name="L759"></a> 759             <strong class="reserved">if</strong> (<a href="../D/25453.html" title="Multiple defined in 2 places.">isDisposed</a>())
<a id="L760" name="L760"></a> 760                 <a href="../S/6507.html#L649" title="Defined at 649 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">removeBufferListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L761" name="L761"></a> 761         <em class="brace">}</em>
<a id="L762" name="L762"></a> 762     <em class="brace">}</em>
<a id="L763" name="L763"></a> 763 
<a id="L764" name="L764"></a> 764     <strong class="reserved">private</strong> <strong class="reserved">class</strong> <a href="../S/6507.html#L775" title="Referred from 775 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">BufferListener</a> <strong class="reserved">implements</strong> <a href="../S/3533.html#L34" title="Defined at 34 in src/javax/management/NotificationListener.java.">NotificationListener</a> <em class="brace">{</em>
<a id="L765" name="L765"></a> 765         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/20121.html" title="Multiple referred from 6 places.">handleNotification</a>(<a href="../S/3507.html#L57" title="Defined at 57 in src/javax/management/Notification.java.">Notification</a> notif, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> handback) <em class="brace">{</em>
<a id="L766" name="L766"></a> 766             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L767" name="L767"></a> 767                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("BufferListener.handleNotification",
<a id="L768" name="L768"></a> 768                       "notif=" + notif + "; handback=" + handback);
<a id="L769" name="L769"></a> 769             <em class="brace">}</em>
<a id="L770" name="L770"></a> 770             <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> = (<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>) handback;
<a id="L771" name="L771"></a> 771             <a href="../D/10973.html" title="Multiple defined in 9 places.">addNotification</a>(<strong class="reserved">new</strong> <a href="../S/6507.html#L546" title="Defined at 546 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">NamedNotification</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, notif));
<a id="L772" name="L772"></a> 772         <em class="brace">}</em>
<a id="L773" name="L773"></a> 773     <em class="brace">}</em>
<a id="L774" name="L774"></a> 774 
<a id="L775" name="L775"></a> 775     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/3533.html#L34" title="Defined at 34 in src/javax/management/NotificationListener.java.">NotificationListener</a> bufferListener = <strong class="reserved">new</strong> <a href="../S/6507.html#L764" title="Defined at 764 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">BufferListener</a>();
<a id="L776" name="L776"></a> 776 
<a id="L777" name="L777"></a> 777     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../S/6507.html#L786" title="Referred from 786 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">BroadcasterQuery</a>
<a id="L778" name="L778"></a> 778             <strong class="reserved">extends</strong> <a href="../S/3500.html#L36" title="Defined at 36 in src/javax/management/QueryEval.java.">QueryEval</a> <strong class="reserved">implements</strong> <a href="../S/3572.html#L46" title="Defined at 46 in src/javax/management/QueryExp.java.">QueryExp</a> <em class="brace">{</em>
<a id="L779" name="L779"></a> 779         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 7378487660587592048L;
<a id="L780" name="L780"></a> 780 
<a id="L781" name="L781"></a> 781         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/10262.html" title="Multiple referred from 190 places.">apply</a>(<strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L782" name="L782"></a> 782             <strong class="reserved">final</strong> <a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a> mbs = <a href="../S/3500.html#L36" title="Defined at 36 in src/javax/management/QueryEval.java.">QueryEval</a>.<a href="../D/20324.html" title="Multiple defined in 8 places.">getMBeanServer</a>();
<a id="L783" name="L783"></a> 783             <strong class="reserved">return</strong> <a href="../D/25730.html" title="Multiple defined in 12 places.">isInstanceOf</a>(mbs, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, broadcasterClass);
<a id="L784" name="L784"></a> 784         <em class="brace">}</em>
<a id="L785" name="L785"></a> 785     <em class="brace">}</em>
<a id="L786" name="L786"></a> 786     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/3572.html#L46" title="Defined at 46 in src/javax/management/QueryExp.java.">QueryExp</a> broadcasterQuery = <strong class="reserved">new</strong> <a href="../S/6507.html#L777" title="Defined at 777 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">BroadcasterQuery</a>();
<a id="L787" name="L787"></a> 787 
<a id="L788" name="L788"></a> 788     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/3548.html#L35" title="Defined at 35 in src/javax/management/NotificationFilter.java.">NotificationFilter</a> creationFilter;
<a id="L789" name="L789"></a> 789     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L790" name="L790"></a> 790         <a href="../S/3531.html#L58" title="Defined at 58 in src/javax/management/NotificationFilterSupport.java.">NotificationFilterSupport</a> nfs = <strong class="reserved">new</strong> <a href="../S/3531.html#L58" title="Defined at 58 in src/javax/management/NotificationFilterSupport.java.">NotificationFilterSupport</a>();
<a id="L791" name="L791"></a> 791         nfs.<a href="../S/3531.html#L124" title="Defined at 124 in src/javax/management/NotificationFilterSupport.java.">enableType</a>(<a href="../S/3447.html#L98" title="Defined at 98 in src/javax/management/MBeanServerNotification.java.">MBeanServerNotification</a>.REGISTRATION_NOTIFICATION);
<a id="L792" name="L792"></a> 792         creationFilter = nfs;
<a id="L793" name="L793"></a> 793     <em class="brace">}</em>
<a id="L794" name="L794"></a> 794 
<a id="L795" name="L795"></a> 795     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/3533.html#L34" title="Defined at 34 in src/javax/management/NotificationListener.java.">NotificationListener</a> creationListener =
<a id="L796" name="L796"></a> 796         <strong class="reserved">new</strong> <a href="../S/3533.html#L34" title="Defined at 34 in src/javax/management/NotificationListener.java.">NotificationListener</a>() <em class="brace">{</em>
<a id="L797" name="L797"></a> 797             <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../D/24009.html" title="Multiple defined in 5 places.">handleNotification</a>(<a href="../S/3507.html#L57" title="Defined at 57 in src/javax/management/Notification.java.">Notification</a> notif,
<a id="L798" name="L798"></a> 798                                            <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> handback) <em class="brace">{</em>
<a id="L799" name="L799"></a> 799                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("creationListener", "handleNotification called");
<a id="L800" name="L800"></a> 800                 <a href="../S/6507.html#L738" title="Defined at 738 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">createdNotification</a>((<a href="../S/3447.html#L98" title="Defined at 98 in src/javax/management/MBeanServerNotification.java.">MBeanServerNotification</a>) notif);
<a id="L801" name="L801"></a> 801             <em class="brace">}</em>
<a id="L802" name="L802"></a> 802         <em class="brace">}</em>;
<a id="L803" name="L803"></a> 803 
<a id="L804" name="L804"></a> 804     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/6507.html#L201" title="Referred from 201 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">destroyListeners</a>() <em class="brace">{</em>
<a id="L805" name="L805"></a> 805         <a href="../S/6507.html#L823" title="Defined at 823 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">checkNoLocks</a>();
<a id="L806" name="L806"></a> 806         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("destroyListeners", "starts");
<a id="L807" name="L807"></a> 807         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L808" name="L808"></a> 808             <a href="../D/30900.html" title="Multiple defined in 49 places.">removeNotificationListener</a>(<a href="../S/3539.html#L39" title="Defined at 39 in src/javax/management/MBeanServerDelegate.java.">MBeanServerDelegate</a>.DELEGATE_NAME,
<a id="L809" name="L809"></a> 809                                        creationListener);
<a id="L810" name="L810"></a> 810         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L811" name="L811"></a> 811             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/36831.html" title="Multiple defined in 36 places.">warning</a>("remove listener from MBeanServer delegate", e);
<a id="L812" name="L812"></a> 812         <em class="brace">}</em>
<a id="L813" name="L813"></a> 813         <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt; names = <a href="../D/30064.html" title="Multiple defined in 9 places.">queryNames</a>(<strong class="reserved">null</strong>, broadcasterQuery);
<a id="L814" name="L814"></a> 814         <strong class="reserved">for</strong> (<strong class="reserved">final</strong> <a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> : names) <em class="brace">{</em>
<a id="L815" name="L815"></a> 815             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>())
<a id="L816" name="L816"></a> 816                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("destroyListeners",
<a id="L817" name="L817"></a> 817                              "remove listener from " + <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L818" name="L818"></a> 818             <a href="../S/6507.html#L649" title="Defined at 649 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">removeBufferListener</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L819" name="L819"></a> 819         <em class="brace">}</em>
<a id="L820" name="L820"></a> 820         <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("destroyListeners", "ends");
<a id="L821" name="L821"></a> 821     <em class="brace">}</em>
<a id="L822" name="L822"></a> 822 
<a id="L823" name="L823"></a> 823     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/11260.html" title="Multiple referred from 3 places.">checkNoLocks</a>() <em class="brace">{</em>
<a id="L824" name="L824"></a> 824         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L1488" title="Defined at 1488 in src/java/lang/Thread.java.">holdsLock</a>(<strong class="reserved">this</strong>) || <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L1488" title="Defined at 1488 in src/java/lang/Thread.java.">holdsLock</a>(globalLock))
<a id="L825" name="L825"></a> 825             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/36831.html" title="Multiple defined in 36 places.">warning</a>("checkNoLocks", "lock protocol violation");
<a id="L826" name="L826"></a> 826     <em class="brace">}</em>
<a id="L827" name="L827"></a> 827 
<div class="comment">
      Iterate until we extract the real exception
      from a stack of PrivilegedActionExceptions.</div>
<a id="L832" name="L832"></a> 832     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <a href="../R/14201.html" title="Multiple referred from 32 places.">extractException</a>(<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L833" name="L833"></a> 833         <strong class="reserved">while</strong> (e <strong class="reserved">instanceof</strong> <a href="../S/1259.html#L50" title="Defined at 50 in src/java/security/PrivilegedActionException.java.">PrivilegedActionException</a>) <em class="brace">{</em>
<a id="L834" name="L834"></a> 834             e = ((<a href="../S/1259.html#L50" title="Defined at 50 in src/java/security/PrivilegedActionException.java.">PrivilegedActionException</a>)e).<a href="../D/18894.html" title="Multiple defined in 26 places.">getException</a>();
<a id="L835" name="L835"></a> 835         <em class="brace">}</em>
<a id="L836" name="L836"></a> 836         <strong class="reserved">return</strong> e;
<a id="L837" name="L837"></a> 837     <em class="brace">}</em>
<a id="L838" name="L838"></a> 838 
<a id="L839" name="L839"></a> 839     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/6492.html#L30" title="Defined at 30 in src/com/sun/jmx/remote/util/ClassLogger.java.">ClassLogger</a> <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a> =
<a id="L840" name="L840"></a> 840         <strong class="reserved">new</strong> <a href="../S/6492.html#L30" title="Defined at 30 in src/com/sun/jmx/remote/util/ClassLogger.java.">ClassLogger</a>("javax.management.remote.misc",
<a id="L841" name="L841"></a> 841                         "ArrayNotificationBuffer");
<a id="L842" name="L842"></a> 842 
<a id="L843" name="L843"></a> 843     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/3578.html#L260" title="Defined at 260 in src/javax/management/MBeanServer.java.">MBeanServer</a> mBeanServer;
<a id="L844" name="L844"></a> 844     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/6505.html#L31" title="Defined at 31 in src/com/sun/jmx/remote/internal/ArrayQueue.java.">ArrayQueue</a>&lt;<a href="../S/6507.html#L546" title="Defined at 546 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">NamedNotification</a>&gt; queue;
<a id="L845" name="L845"></a> 845     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/1063.html#L833" title="Defined at 833 in src/java/util/concurrent/ForkJoinPool.java.">queueSize</a>;
<a id="L846" name="L846"></a> 846     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../S/6507.html#L503" title="Defined at 503 in src/com/sun/jmx/remote/internal/ArrayNotificationBuffer.java.">earliestSequenceNumber</a>;
<a id="L847" name="L847"></a> 847     <strong class="reserved">private</strong> <strong class="reserved">long</strong> <a href="../D/28181.html" title="Multiple defined in 2 places.">nextSequenceNumber</a>;
<a id="L848" name="L848"></a> 848     <strong class="reserved">private</strong> <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3486.html#L223" title="Defined at 223 in src/javax/management/ObjectName.java.">ObjectName</a>&gt; createdDuringQuery;
<a id="L849" name="L849"></a> 849 
<a id="L850" name="L850"></a> 850     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> broadcasterClass =
<a id="L851" name="L851"></a> 851         <a href="../S/3441.html#L73" title="Defined at 73 in src/javax/management/NotificationBroadcaster.java.">NotificationBroadcaster</a>.<strong class="reserved">class</strong>.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L852" name="L852"></a> 852 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L122">[^]</a><a href="#L832">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>