<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L423">[^]</a><a href="#L867">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L423" title="Defined at 423.">setId</a></li>
<li><a href="#L435" title="Defined at 435.">getId</a></li>
<li><a href="#L444" title="Defined at 444.">getSignedInfo</a></li>
<li><a href="#L455" title="Defined at 455.">getSignatureValue</a></li>
<li><a href="#L469" title="Defined at 469.">setSignatureValueElement</a></li>
<li><a href="#L493" title="Defined at 493.">getKeyInfo</a></li>
<li><a href="#L529" title="Defined at 529.">appendObject</a></li>
<li><a href="#L551" title="Defined at 551.">getObjectItem</a></li>
<li><a href="#L569" title="Defined at 569.">getObjectLength</a></li>
<li><a href="#L581" title="Defined at 581.">sign</a></li>
<li><a href="#L635" title="Defined at 635.">addResourceResolver</a></li>
<li><a href="#L644" title="Defined at 644.">addResourceResolver</a></li>
<li><a href="#L659" title="Defined at 659.">checkSignatureValue</a></li>
<li><a href="#L681" title="Defined at 681.">checkSignatureValue</a></li>
<li><a href="#L753" title="Defined at 753.">addDocument</a></li>
<li><a href="#L774" title="Defined at 774.">addDocument</a></li>
<li><a href="#L790" title="Defined at 790.">addDocument</a></li>
<li><a href="#L804" title="Defined at 804.">addDocument</a></li>
<li><a href="#L818" title="Defined at 818.">addKeyInfo</a></li>
<li><a href="#L831" title="Defined at 831.">addKeyInfo</a></li>
<li><a href="#L844" title="Defined at 844.">createSecretKey</a></li>
<li><a href="#L858" title="Defined at 858.">setFollowNestedManifests</a></li>
<li><a href="#L867" title="Defined at 867.">getBaseLocalName</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<div class="comment">
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements. See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership. The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License. You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied. See the License for the
  specific language governing permissions and limitations
  under the License.</div>
<a id="L23" name="L23"></a>  23 <strong class="reserved">package</strong> com.sun.org.apache.xml.internal.security.<a href="../S/7698.html#L129" title="Defined at 129 in src/com/sun/javadoc/ExecutableMemberDoc.java.">signature</a>;
<a id="L24" name="L24"></a>  24 
<a id="L25" name="L25"></a>  25 <strong class="reserved">import</strong> java.io.IOException;
<a id="L26" name="L26"></a>  26 <strong class="reserved">import</strong> java.io.OutputStream;
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.security.Key;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.security.PublicKey;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.security.cert.X509Certificate;
<a id="L30" name="L30"></a>  30 
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> javax.crypto.SecretKey;
<a id="L32" name="L32"></a>  32 
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.algorithms.SignatureAlgorithm;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.c14n.CanonicalizationException;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.c14n.Canonicalizer;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.c14n.InvalidCanonicalizerException;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.exceptions.Base64DecodingException;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityException;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.keys.KeyInfo;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.keys.content.X509Data;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.transforms.Transforms;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.Base64;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.Constants;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.I18n;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.SignatureElementProxy;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.SignerOutputStream;
<a id="L47" name="L47"></a>  47 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.UnsyncBufferedOutputStream;
<a id="L48" name="L48"></a>  48 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.XMLUtils;
<a id="L49" name="L49"></a>  49 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.resolver.ResourceResolver;
<a id="L50" name="L50"></a>  50 <strong class="reserved">import</strong> com.sun.org.apache.xml.internal.security.utils.resolver.ResourceResolverSpi;
<a id="L51" name="L51"></a>  51 <strong class="reserved">import</strong> org.w3c.dom.Attr;
<a id="L52" name="L52"></a>  52 <strong class="reserved">import</strong> org.w3c.dom.Document;
<a id="L53" name="L53"></a>  53 <strong class="reserved">import</strong> org.w3c.dom.Element;
<a id="L54" name="L54"></a>  54 <strong class="reserved">import</strong> org.w3c.dom.Node;
<a id="L55" name="L55"></a>  55 <strong class="reserved">import</strong> org.w3c.dom.NodeList;
<a id="L56" name="L56"></a>  56 <strong class="reserved">import</strong> org.w3c.dom.Text;
<a id="L57" name="L57"></a>  57 
<div class="comment">
  Handles <code>&lt;ds:Signature&gt;</code> elements.
  This is the main class that deals with creating and verifying signatures.
  <p>There are 2 types of constructors for this class. The ones that take a
  document, baseURI and 1 or more Java Objects. This is mostly used for
  signing purposes.
  The other constructor is the one that takes a DOM Element and a baseURI.
  This is used mostly with for verifying, when you have a SignatureElement.
  There are a few different types of methods:
  </p><ul><li>The addDocument* methods are used to add References with optional
  transforms during signing. </li><li>addKeyInfo* methods are to add Certificates and Keys to the
  KeyInfo tags during signing. </li><li>appendObject allows a user to add any XML Structure as an
  ObjectContainer during signing.</li><li>sign and checkSignatureValue methods are used to sign and validate the
  signature. </li></ul></div>
<a id="L78" name="L78"></a>  78 <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/9063.html" title="Multiple referred from 67 places.">XMLSignature</a> <strong class="reserved">extends</strong> <a href="../S/5675.html#L34" title="Defined at 34 in src/com/sun/org/apache/xml/internal/security/utils/SignatureElementProxy.java.">SignatureElementProxy</a> <em class="brace">{</em>
<a id="L79" name="L79"></a>  79 
<div class="comment">
     /** MAC - Required HMAC-SHA1 */</div>
<a id="L81" name="L81"></a>  81     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_MAC_HMAC_SHA1 =
<a id="L82" name="L82"></a>  82         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS + "hmac-sha1";
<a id="L83" name="L83"></a>  83 
<div class="comment">
     /** Signature - Required DSAwithSHA1 (DSS) */</div>
<a id="L85" name="L85"></a>  85     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_DSA =
<a id="L86" name="L86"></a>  86         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS + "dsa-sha1";
<a id="L87" name="L87"></a>  87 
<div class="comment">
     /** Signature - Recommended RSAwithSHA1 */</div>
<a id="L89" name="L89"></a>  89     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_RSA =
<a id="L90" name="L90"></a>  90         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS + "rsa-sha1";
<a id="L91" name="L91"></a>  91 
<div class="comment">
     /** Signature - Recommended RSAwithSHA1 */</div>
<a id="L93" name="L93"></a>  93     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_RSA_SHA1 =
<a id="L94" name="L94"></a>  94         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS + "rsa-sha1";
<a id="L95" name="L95"></a>  95 
<div class="comment">
     /** Signature - NOT Recommended RSAwithMD5 */</div>
<a id="L97" name="L97"></a>  97     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_NOT_RECOMMENDED_RSA_MD5 =
<a id="L98" name="L98"></a>  98         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "rsa-md5";
<a id="L99" name="L99"></a>  99 
<div class="comment">
     /** Signature - Optional RSAwithRIPEMD160 */</div>
<a id="L101" name="L101"></a> 101     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_RSA_RIPEMD160 =
<a id="L102" name="L102"></a> 102         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "rsa-ripemd160";
<a id="L103" name="L103"></a> 103 
<div class="comment">
     /** Signature - Optional RSAwithSHA256 */</div>
<a id="L105" name="L105"></a> 105     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_RSA_SHA256 =
<a id="L106" name="L106"></a> 106         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "rsa-sha256";
<a id="L107" name="L107"></a> 107 
<div class="comment">
     /** Signature - Optional RSAwithSHA384 */</div>
<a id="L109" name="L109"></a> 109     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_RSA_SHA384 =
<a id="L110" name="L110"></a> 110         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "rsa-sha384";
<a id="L111" name="L111"></a> 111 
<div class="comment">
     /** Signature - Optional RSAwithSHA512 */</div>
<a id="L113" name="L113"></a> 113     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_RSA_SHA512 =
<a id="L114" name="L114"></a> 114         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "rsa-sha512";
<a id="L115" name="L115"></a> 115 
<div class="comment">
     /** HMAC - NOT Recommended HMAC-MD5 */</div>
<a id="L117" name="L117"></a> 117     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_MAC_HMAC_NOT_RECOMMENDED_MD5 =
<a id="L118" name="L118"></a> 118         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "hmac-md5";
<a id="L119" name="L119"></a> 119 
<div class="comment">
     /** HMAC - Optional HMAC-RIPEMD160 */</div>
<a id="L121" name="L121"></a> 121     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_MAC_HMAC_RIPEMD160 =
<a id="L122" name="L122"></a> 122         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "hmac-ripemd160";
<a id="L123" name="L123"></a> 123 
<div class="comment">
     /** HMAC - Optional HMAC-SHA256 */</div>
<a id="L125" name="L125"></a> 125     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_MAC_HMAC_SHA256 =
<a id="L126" name="L126"></a> 126         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "hmac-sha256";
<a id="L127" name="L127"></a> 127 
<div class="comment">
     /** HMAC - Optional HMAC-SHA284 */</div>
<a id="L129" name="L129"></a> 129     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_MAC_HMAC_SHA384 =
<a id="L130" name="L130"></a> 130         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "hmac-sha384";
<a id="L131" name="L131"></a> 131 
<div class="comment">
     /** HMAC - Optional HMAC-SHA512 */</div>
<a id="L133" name="L133"></a> 133     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_MAC_HMAC_SHA512 =
<a id="L134" name="L134"></a> 134         <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.MoreAlgorithmsSpecNS + "hmac-sha512";
<a id="L135" name="L135"></a> 135 
<div class="comment">
     /**Signature - Optional ECDSAwithSHA1 */</div>
<a id="L137" name="L137"></a> 137     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_ECDSA_SHA1 =
<a id="L138" name="L138"></a> 138         "http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1";
<a id="L139" name="L139"></a> 139 
<div class="comment">
     /**Signature - Optional ECDSAwithSHA256 */</div>
<a id="L141" name="L141"></a> 141     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_ECDSA_SHA256 =
<a id="L142" name="L142"></a> 142         "http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256";
<a id="L143" name="L143"></a> 143 
<div class="comment">
     /**Signature - Optional ECDSAwithSHA384 */</div>
<a id="L145" name="L145"></a> 145     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_ECDSA_SHA384 =
<a id="L146" name="L146"></a> 146         "http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384";
<a id="L147" name="L147"></a> 147 
<div class="comment">
     /**Signature - Optional ECDSAwithSHA512 */</div>
<a id="L149" name="L149"></a> 149     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ALGO_ID_SIGNATURE_ECDSA_SHA512 =
<a id="L150" name="L150"></a> 150         "http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512";
<a id="L151" name="L151"></a> 151 
<div class="comment">
     /** {@link org.apache.commons.logging} logging facility */</div>
<a id="L153" name="L153"></a> 153     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1170.html#L218" title="Defined at 218 in src/java/util/logging/Logger.java.">Logger</a> <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a> =
<a id="L154" name="L154"></a> 154         <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1170.html#L218" title="Defined at 218 in src/java/util/logging/Logger.java.">Logger</a>.<a href="../D/20268.html" title="Multiple defined in 6 places.">getLogger</a>(<a href="../D/10005.html" title="Multiple defined in 2 places.">XMLSignature</a>.<strong class="reserved">class</strong>.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L155" name="L155"></a> 155 
<div class="comment">
     /** ds:Signature.ds:SignedInfo element */</div>
<a id="L157" name="L157"></a> 157     <strong class="reserved">private</strong> <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a> signedInfo;
<a id="L158" name="L158"></a> 158 
<div class="comment">
     /** ds:Signature.ds:KeyInfo */</div>
<a id="L160" name="L160"></a> 160     <strong class="reserved">private</strong> <a href="../D/4801.html" title="Multiple defined in 2 places.">KeyInfo</a> keyInfo;
<a id="L161" name="L161"></a> 161 
<div class="comment">
      Checking the digests in References in a Signature are mandatory, but for
      References inside a Manifest it is application specific. This boolean is
      to indicate that the References inside Manifests should be validated.</div>
<a id="L167" name="L167"></a> 167     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> followManifestsDuringValidation = <strong class="reserved">false</strong>;
<a id="L168" name="L168"></a> 168 
<a id="L169" name="L169"></a> 169     <strong class="reserved">private</strong> <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> signatureValueElement;
<a id="L170" name="L170"></a> 170 
<a id="L171" name="L171"></a> 171     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MODE_SIGN = 0;
<a id="L172" name="L172"></a> 172     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MODE_VERIFY = 1;
<a id="L173" name="L173"></a> 173     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = MODE_SIGN;
<a id="L174" name="L174"></a> 174 
<div class="comment">
      This creates a new <code>ds:Signature</code> Element and adds an empty
      <code>ds:SignedInfo</code>.
      The <code>ds:SignedInfo</code> is initialized with the specified Signature
      algorithm and Canonicalizer.ALGO_ID_C14N_OMIT_COMMENTS which is REQUIRED
      by the spec. This method's main use is for creating a new signature.
      @param doc Document in which the signature will be appended after creation.
      @param baseURI URI to be used as context for all relative URIs.
      @param signatureMethodURI signature algorithm to use.
      @throws XMLSecurityException</div>
<a id="L187" name="L187"></a> 187     <strong class="reserved">public</strong> XMLSignature(<a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> signatureMethodURI)
<a id="L188" name="L188"></a> 188         <strong class="reserved">throws</strong> <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L189" name="L189"></a> 189         <strong class="reserved">this</strong>(doc, baseURI, signatureMethodURI, 0, <a href="../S/5607.html#L54" title="Defined at 54 in src/com/sun/org/apache/xml/internal/security/c14n/Canonicalizer.java.">Canonicalizer</a>.ALGO_ID_C14N_OMIT_COMMENTS);
<a id="L190" name="L190"></a> 190     <em class="brace">}</em>
<a id="L191" name="L191"></a> 191 
<div class="comment">
      Constructor XMLSignature
      @param doc
      @param baseURI
      @param signatureMethodURI the Signature method to be used.
      @param hmacOutputLength
      @throws XMLSecurityException</div>
<a id="L201" name="L201"></a> 201     <strong class="reserved">public</strong> XMLSignature(<a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> signatureMethodURI,
<a id="L202" name="L202"></a> 202                         <strong class="reserved">int</strong> hmacOutputLength) <strong class="reserved">throws</strong> <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L203" name="L203"></a> 203         <strong class="reserved">this</strong>(
<a id="L204" name="L204"></a> 204             doc, baseURI, signatureMethodURI, hmacOutputLength,
<a id="L205" name="L205"></a> 205             <a href="../S/5607.html#L54" title="Defined at 54 in src/com/sun/org/apache/xml/internal/security/c14n/Canonicalizer.java.">Canonicalizer</a>.ALGO_ID_C14N_OMIT_COMMENTS
<a id="L206" name="L206"></a> 206         );
<a id="L207" name="L207"></a> 207     <em class="brace">}</em>
<a id="L208" name="L208"></a> 208 
<div class="comment">
      Constructor XMLSignature
      @param doc
      @param baseURI
      @param signatureMethodURI the Signature method to be used.
      @param canonicalizationMethodURI the canonicalization algorithm to be
      used to c14nize the SignedInfo element.
      @throws XMLSecurityException</div>
<a id="L219" name="L219"></a> 219     <strong class="reserved">public</strong> XMLSignature(
<a id="L220" name="L220"></a> 220         <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc,
<a id="L221" name="L221"></a> 221         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI,
<a id="L222" name="L222"></a> 222         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> signatureMethodURI,
<a id="L223" name="L223"></a> 223         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> canonicalizationMethodURI
<a id="L224" name="L224"></a> 224     ) <strong class="reserved">throws</strong> <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L225" name="L225"></a> 225         <strong class="reserved">this</strong>(doc, baseURI, signatureMethodURI, 0, canonicalizationMethodURI);
<a id="L226" name="L226"></a> 226     <em class="brace">}</em>
<a id="L227" name="L227"></a> 227 
<div class="comment">
      Constructor XMLSignature
      @param doc
      @param baseURI
      @param signatureMethodURI
      @param hmacOutputLength
      @param canonicalizationMethodURI
      @throws XMLSecurityException</div>
<a id="L238" name="L238"></a> 238     <strong class="reserved">public</strong> XMLSignature(
<a id="L239" name="L239"></a> 239         <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc,
<a id="L240" name="L240"></a> 240         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI,
<a id="L241" name="L241"></a> 241         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> signatureMethodURI,
<a id="L242" name="L242"></a> 242         <strong class="reserved">int</strong> hmacOutputLength,
<a id="L243" name="L243"></a> 243         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> canonicalizationMethodURI
<a id="L244" name="L244"></a> 244     ) <strong class="reserved">throws</strong> <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L245" name="L245"></a> 245         <strong class="reserved">super</strong>(doc);
<a id="L246" name="L246"></a> 246 
<a id="L247" name="L247"></a> 247         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> xmlnsDsPrefix = <a href="../S/5696.html#L517" title="Defined at 517 in src/com/sun/org/apache/xml/internal/security/utils/ElementProxy.java.">getDefaultPrefix</a>(<a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS);
<a id="L248" name="L248"></a> 248         <strong class="reserved">if</strong> (xmlnsDsPrefix == <strong class="reserved">null</strong> || xmlnsDsPrefix.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 0) <em class="brace">{</em>
<a id="L249" name="L249"></a> 249             <strong class="reserved">this</strong>.constructionElement.<a href="../D/31944.html" title="Multiple defined in 6 places.">setAttributeNS</a>(
<a id="L250" name="L250"></a> 250                 <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.NamespaceSpecNS, "xmlns", <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS
<a id="L251" name="L251"></a> 251             );
<a id="L252" name="L252"></a> 252         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L253" name="L253"></a> 253             <strong class="reserved">this</strong>.constructionElement.<a href="../D/31944.html" title="Multiple defined in 6 places.">setAttributeNS</a>(
<a id="L254" name="L254"></a> 254                 <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.NamespaceSpecNS, "xmlns:" + xmlnsDsPrefix, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS
<a id="L255" name="L255"></a> 255             );
<a id="L256" name="L256"></a> 256         <em class="brace">}</em>
<a id="L257" name="L257"></a> 257         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L258" name="L258"></a> 258 
<a id="L259" name="L259"></a> 259         <strong class="reserved">this</strong>.baseURI = baseURI;
<a id="L260" name="L260"></a> 260         <strong class="reserved">this</strong>.signedInfo =
<a id="L261" name="L261"></a> 261             <strong class="reserved">new</strong> <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a>(
<a id="L262" name="L262"></a> 262                 <strong class="reserved">this</strong>.doc, signatureMethodURI, hmacOutputLength, canonicalizationMethodURI
<a id="L263" name="L263"></a> 263             );
<a id="L264" name="L264"></a> 264 
<a id="L265" name="L265"></a> 265         <strong class="reserved">this</strong>.constructionElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(<strong class="reserved">this</strong>.signedInfo.<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>());
<a id="L266" name="L266"></a> 266         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L267" name="L267"></a> 267 
<a id="L268" name="L268"></a> 268         <em class="comment">// create an empty SignatureValue; this is filled by setSignatureValueElement</em>
<a id="L269" name="L269"></a> 269         signatureValueElement =
<a id="L270" name="L270"></a> 270             <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../S/5680.html#L296" title="Defined at 296 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">createElementInSignatureSpace</a>(<strong class="reserved">this</strong>.doc, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNATUREVALUE);
<a id="L271" name="L271"></a> 271 
<a id="L272" name="L272"></a> 272         <strong class="reserved">this</strong>.constructionElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(signatureValueElement);
<a id="L273" name="L273"></a> 273         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L274" name="L274"></a> 274     <em class="brace">}</em>
<a id="L275" name="L275"></a> 275 
<div class="comment">
       Creates a XMLSignature in a Document
      @param doc
      @param baseURI
      @param SignatureMethodElem
      @param CanonicalizationMethodElem
      @throws XMLSecurityException</div>
<a id="L284" name="L284"></a> 284     <strong class="reserved">public</strong> XMLSignature(
<a id="L285" name="L285"></a> 285         <a href="../D/2543.html" title="Multiple defined in 2 places.">Document</a> doc,
<a id="L286" name="L286"></a> 286         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI,
<a id="L287" name="L287"></a> 287         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> SignatureMethodElem,
<a id="L288" name="L288"></a> 288         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> CanonicalizationMethodElem
<a id="L289" name="L289"></a> 289     ) <strong class="reserved">throws</strong> <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L290" name="L290"></a> 290         <strong class="reserved">super</strong>(doc);
<a id="L291" name="L291"></a> 291 
<a id="L292" name="L292"></a> 292         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> xmlnsDsPrefix = <a href="../S/5696.html#L517" title="Defined at 517 in src/com/sun/org/apache/xml/internal/security/utils/ElementProxy.java.">getDefaultPrefix</a>(<a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS);
<a id="L293" name="L293"></a> 293         <strong class="reserved">if</strong> (xmlnsDsPrefix == <strong class="reserved">null</strong> || xmlnsDsPrefix.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 0) <em class="brace">{</em>
<a id="L294" name="L294"></a> 294             <strong class="reserved">this</strong>.constructionElement.<a href="../D/31944.html" title="Multiple defined in 6 places.">setAttributeNS</a>(
<a id="L295" name="L295"></a> 295                 <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.NamespaceSpecNS, "xmlns", <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS
<a id="L296" name="L296"></a> 296             );
<a id="L297" name="L297"></a> 297         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L298" name="L298"></a> 298             <strong class="reserved">this</strong>.constructionElement.<a href="../D/31944.html" title="Multiple defined in 6 places.">setAttributeNS</a>(
<a id="L299" name="L299"></a> 299                 <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.NamespaceSpecNS, "xmlns:" + xmlnsDsPrefix, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS
<a id="L300" name="L300"></a> 300             );
<a id="L301" name="L301"></a> 301         <em class="brace">}</em>
<a id="L302" name="L302"></a> 302         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L303" name="L303"></a> 303 
<a id="L304" name="L304"></a> 304         <strong class="reserved">this</strong>.baseURI = baseURI;
<a id="L305" name="L305"></a> 305         <strong class="reserved">this</strong>.signedInfo =
<a id="L306" name="L306"></a> 306             <strong class="reserved">new</strong> <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a>(<strong class="reserved">this</strong>.doc, SignatureMethodElem, CanonicalizationMethodElem);
<a id="L307" name="L307"></a> 307 
<a id="L308" name="L308"></a> 308         <strong class="reserved">this</strong>.constructionElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(<strong class="reserved">this</strong>.signedInfo.<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>());
<a id="L309" name="L309"></a> 309         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L310" name="L310"></a> 310 
<a id="L311" name="L311"></a> 311         <em class="comment">// create an empty SignatureValue; this is filled by setSignatureValueElement</em>
<a id="L312" name="L312"></a> 312         signatureValueElement =
<a id="L313" name="L313"></a> 313             <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../S/5680.html#L296" title="Defined at 296 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">createElementInSignatureSpace</a>(<strong class="reserved">this</strong>.doc, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNATUREVALUE);
<a id="L314" name="L314"></a> 314 
<a id="L315" name="L315"></a> 315         <strong class="reserved">this</strong>.constructionElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(signatureValueElement);
<a id="L316" name="L316"></a> 316         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L317" name="L317"></a> 317     <em class="brace">}</em>
<a id="L318" name="L318"></a> 318 
<div class="comment">
      This will parse the element and construct the Java Objects.
      That will allow a user to validate the signature.
      @param element ds:Signature element that contains the whole signature
      @param baseURI URI to be prepended to all relative URIs
      @throws XMLSecurityException
      @throws XMLSignatureException if the signature is badly formatted</div>
<a id="L328" name="L328"></a> 328     <strong class="reserved">public</strong> XMLSignature(<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> <a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI)
<a id="L329" name="L329"></a> 329         <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>, <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L330" name="L330"></a> 330         <strong class="reserved">this</strong>(<a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>, baseURI, <strong class="reserved">false</strong>);
<a id="L331" name="L331"></a> 331     <em class="brace">}</em>
<a id="L332" name="L332"></a> 332 
<div class="comment">
      This will parse the element and construct the Java Objects.
      That will allow a user to validate the signature.
      @param element ds:Signature element that contains the whole signature
      @param baseURI URI to be prepended to all relative URIs
      @param secureValidation whether secure secureValidation is enabled or not
      @throws XMLSecurityException
      @throws XMLSignatureException if the signature is badly formatted</div>
<a id="L343" name="L343"></a> 343     <strong class="reserved">public</strong> XMLSignature(<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> <a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> baseURI, <strong class="reserved">boolean</strong> secureValidation)
<a id="L344" name="L344"></a> 344         <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>, <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L345" name="L345"></a> 345         <strong class="reserved">super</strong>(<a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>, baseURI);
<a id="L346" name="L346"></a> 346 
<a id="L347" name="L347"></a> 347         <em class="comment">// check out SignedInfo child</em>
<a id="L348" name="L348"></a> 348         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> signedInfoElem = <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/20896.html" title="Multiple defined in 2 places.">getNextElement</a>(<a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>.<a href="../D/19088.html" title="Multiple defined in 18 places.">getFirstChild</a>());
<a id="L349" name="L349"></a> 349 
<a id="L350" name="L350"></a> 350         <em class="comment">// check to see if it is there</em>
<a id="L351" name="L351"></a> 351         <strong class="reserved">if</strong> (signedInfoElem == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L352" name="L352"></a> 352             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> exArgs[] = <em class="brace">{</em> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNEDINFO, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNATURE <em class="brace">}</em>;
<a id="L353" name="L353"></a> 353             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("xml.WrongContent", exArgs);
<a id="L354" name="L354"></a> 354         <em class="brace">}</em>
<a id="L355" name="L355"></a> 355 
<a id="L356" name="L356"></a> 356         <em class="comment">// create a SignedInfo object from that element</em>
<a id="L357" name="L357"></a> 357         <strong class="reserved">this</strong>.signedInfo = <strong class="reserved">new</strong> <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a>(signedInfoElem, baseURI, secureValidation);
<a id="L358" name="L358"></a> 358         <em class="comment">// get signedInfoElem again in case it has changed</em>
<a id="L359" name="L359"></a> 359         signedInfoElem = <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/20896.html" title="Multiple defined in 2 places.">getNextElement</a>(<a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>.<a href="../D/19088.html" title="Multiple defined in 18 places.">getFirstChild</a>());
<a id="L360" name="L360"></a> 360 
<a id="L361" name="L361"></a> 361         <em class="comment">// check out SignatureValue child</em>
<a id="L362" name="L362"></a> 362         <strong class="reserved">this</strong>.signatureValueElement =
<a id="L363" name="L363"></a> 363             <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/20896.html" title="Multiple defined in 2 places.">getNextElement</a>(signedInfoElem.<a href="../D/20935.html" title="Multiple defined in 22 places.">getNextSibling</a>());
<a id="L364" name="L364"></a> 364 
<a id="L365" name="L365"></a> 365         <em class="comment">// check to see if it exists</em>
<a id="L366" name="L366"></a> 366         <strong class="reserved">if</strong> (signatureValueElement == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L367" name="L367"></a> 367             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> exArgs[] = <em class="brace">{</em> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNATUREVALUE, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNATURE <em class="brace">}</em>;
<a id="L368" name="L368"></a> 368             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("xml.WrongContent", exArgs);
<a id="L369" name="L369"></a> 369         <em class="brace">}</em>
<a id="L370" name="L370"></a> 370         <a href="../S/54.html#L186" title="Defined at 186 in src/org/w3c/dom/Attr.java.">Attr</a> signatureValueAttr = signatureValueElement.<a href="../D/17095.html" title="Multiple defined in 7 places.">getAttributeNodeNS</a>(<strong class="reserved">null</strong>, "Id");
<a id="L371" name="L371"></a> 371         <strong class="reserved">if</strong> (signatureValueAttr != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L372" name="L372"></a> 372             signatureValueElement.<a href="../D/32887.html" title="Multiple defined in 7 places.">setIdAttributeNode</a>(signatureValueAttr, <strong class="reserved">true</strong>);
<a id="L373" name="L373"></a> 373         <em class="brace">}</em>
<a id="L374" name="L374"></a> 374 
<a id="L375" name="L375"></a> 375         <em class="comment">// &lt;element ref="ds:KeyInfo" minOccurs="0"/&gt;</em>
<a id="L376" name="L376"></a> 376         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> keyInfoElem =
<a id="L377" name="L377"></a> 377             <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/20896.html" title="Multiple defined in 2 places.">getNextElement</a>(signatureValueElement.<a href="../D/20935.html" title="Multiple defined in 22 places.">getNextSibling</a>());
<a id="L378" name="L378"></a> 378 
<a id="L379" name="L379"></a> 379         <em class="comment">// If it exists use it, but it's not mandatory</em>
<a id="L380" name="L380"></a> 380         <strong class="reserved">if</strong> (keyInfoElem != <strong class="reserved">null</strong>
<a id="L381" name="L381"></a> 381             &amp;&amp; keyInfoElem.<a href="../D/20828.html" title="Multiple defined in 47 places.">getNamespaceURI</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS)
<a id="L382" name="L382"></a> 382             &amp;&amp; keyInfoElem.<a href="../D/20201.html" title="Multiple defined in 44 places.">getLocalName</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_KEYINFO)) <em class="brace">{</em>
<a id="L383" name="L383"></a> 383             <strong class="reserved">this</strong>.keyInfo = <strong class="reserved">new</strong> <a href="../D/4801.html" title="Multiple defined in 2 places.">KeyInfo</a>(keyInfoElem, baseURI);
<a id="L384" name="L384"></a> 384             <strong class="reserved">this</strong>.keyInfo.<a href="../D/33834.html" title="Multiple defined in 5 places.">setSecureValidation</a>(secureValidation);
<a id="L385" name="L385"></a> 385         <em class="brace">}</em>
<a id="L386" name="L386"></a> 386 
<a id="L387" name="L387"></a> 387         <em class="comment">// &lt;element ref="ds:Object" minOccurs="0" maxOccurs="unbounded"/&gt;</em>
<a id="L388" name="L388"></a> 388         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> objectElem =
<a id="L389" name="L389"></a> 389             <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/20896.html" title="Multiple defined in 2 places.">getNextElement</a>(signatureValueElement.<a href="../D/20935.html" title="Multiple defined in 22 places.">getNextSibling</a>());
<a id="L390" name="L390"></a> 390         <strong class="reserved">while</strong> (objectElem != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L391" name="L391"></a> 391             <a href="../S/54.html#L186" title="Defined at 186 in src/org/w3c/dom/Attr.java.">Attr</a> objectAttr = objectElem.<a href="../D/17095.html" title="Multiple defined in 7 places.">getAttributeNodeNS</a>(<strong class="reserved">null</strong>, "Id");
<a id="L392" name="L392"></a> 392             <strong class="reserved">if</strong> (objectAttr != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L393" name="L393"></a> 393                 objectElem.<a href="../D/32887.html" title="Multiple defined in 7 places.">setIdAttributeNode</a>(objectAttr, <strong class="reserved">true</strong>);
<a id="L394" name="L394"></a> 394             <em class="brace">}</em>
<a id="L395" name="L395"></a> 395 
<a id="L396" name="L396"></a> 396             <a href="../S/115.html#L52" title="Defined at 52 in src/org/w3c/dom/NodeList.java.">NodeList</a> nodes = objectElem.<a href="../D/17640.html" title="Multiple defined in 11 places.">getChildNodes</a>();
<a id="L397" name="L397"></a> 397             <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = nodes.<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>();
<a id="L398" name="L398"></a> 398             <em class="comment">// Register Ids of the Object child elements</em>
<a id="L399" name="L399"></a> 399             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L400" name="L400"></a> 400                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> child = nodes.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>(i);
<a id="L401" name="L401"></a> 401                 <strong class="reserved">if</strong> (child.<a href="../D/20988.html" title="Multiple defined in 34 places.">getNodeType</a>() == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.ELEMENT_NODE) <em class="brace">{</em>
<a id="L402" name="L402"></a> 402                     <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> childElem = (<a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a>)child;
<a id="L403" name="L403"></a> 403                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> tag = childElem.<a href="../D/20201.html" title="Multiple defined in 44 places.">getLocalName</a>();
<a id="L404" name="L404"></a> 404                     <strong class="reserved">if</strong> (tag.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("Manifest")) <em class="brace">{</em>
<a id="L405" name="L405"></a> 405                         <strong class="reserved">new</strong> <a href="../D/5397.html" title="Multiple defined in 3 places.">Manifest</a>(childElem, baseURI);
<a id="L406" name="L406"></a> 406                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (tag.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("SignatureProperties")) <em class="brace">{</em>
<a id="L407" name="L407"></a> 407                         <strong class="reserved">new</strong> <a href="../D/7962.html" title="Multiple defined in 2 places.">SignatureProperties</a>(childElem, baseURI);
<a id="L408" name="L408"></a> 408                     <em class="brace">}</em>
<a id="L409" name="L409"></a> 409                 <em class="brace">}</em>
<a id="L410" name="L410"></a> 410             <em class="brace">}</em>
<a id="L411" name="L411"></a> 411 
<a id="L412" name="L412"></a> 412             objectElem = <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/20896.html" title="Multiple defined in 2 places.">getNextElement</a>(objectElem.<a href="../D/20935.html" title="Multiple defined in 22 places.">getNextSibling</a>());
<a id="L413" name="L413"></a> 413         <em class="brace">}</em>
<a id="L414" name="L414"></a> 414 
<a id="L415" name="L415"></a> 415         <strong class="reserved">this</strong>.<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = MODE_VERIFY;
<a id="L416" name="L416"></a> 416     <em class="brace">}</em>
<a id="L417" name="L417"></a> 417 
<div class="comment">
      Sets the <code>Id</code> attribute
      @param id Id value for the id attribute on the Signature Element</div>
<a id="L423" name="L423"></a> 423     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/27527.html" title="Multiple referred from 22 places.">setId</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/24291.html" title="Multiple defined in 202 places.">id</a>) <em class="brace">{</em>
<a id="L424" name="L424"></a> 424         <strong class="reserved">if</strong> (<a href="../D/24291.html" title="Multiple defined in 202 places.">id</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L425" name="L425"></a> 425             <strong class="reserved">this</strong>.constructionElement.<a href="../D/31944.html" title="Multiple defined in 6 places.">setAttributeNS</a>(<strong class="reserved">null</strong>, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._ATT_ID, <a href="../D/24291.html" title="Multiple defined in 202 places.">id</a>);
<a id="L426" name="L426"></a> 426             <strong class="reserved">this</strong>.constructionElement.<a href="../D/32886.html" title="Multiple defined in 7 places.">setIdAttributeNS</a>(<strong class="reserved">null</strong>, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._ATT_ID, <strong class="reserved">true</strong>);
<a id="L427" name="L427"></a> 427         <em class="brace">}</em>
<a id="L428" name="L428"></a> 428     <em class="brace">}</em>
<a id="L429" name="L429"></a> 429 
<div class="comment">
      Returns the <code>Id</code> attribute
      @return the <code>Id</code> attribute</div>
<a id="L435" name="L435"></a> 435     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/16968.html" title="Multiple referred from 227 places.">getId</a>() <em class="brace">{</em>
<a id="L436" name="L436"></a> 436         <strong class="reserved">return</strong> <strong class="reserved">this</strong>.constructionElement.<a href="../D/17089.html" title="Multiple defined in 7 places.">getAttributeNS</a>(<strong class="reserved">null</strong>, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._ATT_ID);
<a id="L437" name="L437"></a> 437     <em class="brace">}</em>
<a id="L438" name="L438"></a> 438 
<div class="comment">
      Returns the completely parsed <code>SignedInfo</code> object.
      @return the completely parsed <code>SignedInfo</code> object.</div>
<a id="L444" name="L444"></a> 444     <strong class="reserved">public</strong> <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a> <a href="../R/19043.html" title="Multiple referred from 5 places.">getSignedInfo</a>() <em class="brace">{</em>
<a id="L445" name="L445"></a> 445         <strong class="reserved">return</strong> <strong class="reserved">this</strong>.signedInfo;
<a id="L446" name="L446"></a> 446     <em class="brace">}</em>
<a id="L447" name="L447"></a> 447 
<div class="comment">
      Returns the octet value of the SignatureValue element.
      Throws an XMLSignatureException if it has no or wrong content.
      @return the value of the SignatureValue element.
      @throws XMLSignatureException If there is no content</div>
<a id="L455" name="L455"></a> 455     <strong class="reserved">public</strong> <strong class="reserved">byte</strong>[] <a href="../S/5654.html#L715" title="Referred from 715 in src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java.">getSignatureValue</a>() <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L456" name="L456"></a> 456         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L457" name="L457"></a> 457             <strong class="reserved">return</strong> <a href="../D/720.html" title="Multiple defined in 4 places.">Base64</a>.<a href="../D/14516.html" title="Multiple defined in 39 places.">decode</a>(signatureValueElement);
<a id="L458" name="L458"></a> 458         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5714.html#L30" title="Defined at 30 in src/com/sun/org/apache/xml/internal/security/exceptions/Base64DecodingException.java.">Base64DecodingException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L459" name="L459"></a> 459             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L460" name="L460"></a> 460         <em class="brace">}</em>
<a id="L461" name="L461"></a> 461     <em class="brace">}</em>
<a id="L462" name="L462"></a> 462 
<div class="comment">
      Base64 encodes and sets the bytes as the content of the SignatureValue
      Node.
      @param bytes bytes to be used by SignatureValue before Base64 encoding</div>
<a id="L469" name="L469"></a> 469     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/5654.html#L618" title="Referred from 618 in src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java.">setSignatureValueElement</a>(<strong class="reserved">byte</strong>[] bytes) <em class="brace">{</em>
<a id="L470" name="L470"></a> 470 
<a id="L471" name="L471"></a> 471         <strong class="reserved">while</strong> (signatureValueElement.<a href="../D/24077.html" title="Multiple defined in 16 places.">hasChildNodes</a>()) <em class="brace">{</em>
<a id="L472" name="L472"></a> 472             signatureValueElement.<a href="../D/30731.html" title="Multiple defined in 14 places.">removeChild</a>(signatureValueElement.<a href="../D/19088.html" title="Multiple defined in 18 places.">getFirstChild</a>());
<a id="L473" name="L473"></a> 473         <em class="brace">}</em>
<a id="L474" name="L474"></a> 474 
<a id="L475" name="L475"></a> 475         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> base64codedValue = <a href="../D/720.html" title="Multiple defined in 4 places.">Base64</a>.<a href="../D/15393.html" title="Multiple defined in 39 places.">encode</a>(bytes);
<a id="L476" name="L476"></a> 476 
<a id="L477" name="L477"></a> 477         <strong class="reserved">if</strong> (base64codedValue.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 76 &amp;&amp; !<a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../S/5680.html#L902" title="Defined at 902 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">ignoreLineBreaks</a>()) <em class="brace">{</em>
<a id="L478" name="L478"></a> 478             base64codedValue = "\n" + base64codedValue + "\n";
<a id="L479" name="L479"></a> 479         <em class="brace">}</em>
<a id="L480" name="L480"></a> 480 
<a id="L481" name="L481"></a> 481         <a href="../D/8891.html" title="Multiple defined in 3 places.">Text</a> t = <strong class="reserved">this</strong>.doc.<a href="../D/14246.html" title="Multiple defined in 5 places.">createTextNode</a>(base64codedValue);
<a id="L482" name="L482"></a> 482         signatureValueElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(t);
<a id="L483" name="L483"></a> 483     <em class="brace">}</em>
<a id="L484" name="L484"></a> 484 
<div class="comment">
      Returns the KeyInfo child. If we are in signing mode and the KeyInfo
      does not exist yet, it is created on demand and added to the Signature.
      <br>
      This allows to add arbitrary content to the KeyInfo during signing.
      @return the KeyInfo object</div>
<a id="L493" name="L493"></a> 493     <strong class="reserved">public</strong> <a href="../D/4801.html" title="Multiple defined in 2 places.">KeyInfo</a> <a href="../R/17233.html" title="Multiple referred from 8 places.">getKeyInfo</a>() <em class="brace">{</em>
<a id="L494" name="L494"></a> 494         <em class="comment">// check to see if we are signing and if we have to create a keyinfo</em>
<a id="L495" name="L495"></a> 495         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> == MODE_SIGN &amp;&amp; <strong class="reserved">this</strong>.keyInfo == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L496" name="L496"></a> 496 
<a id="L497" name="L497"></a> 497             <em class="comment">// create the KeyInfo</em>
<a id="L498" name="L498"></a> 498             <strong class="reserved">this</strong>.keyInfo = <strong class="reserved">new</strong> <a href="../D/4801.html" title="Multiple defined in 2 places.">KeyInfo</a>(<strong class="reserved">this</strong>.doc);
<a id="L499" name="L499"></a> 499 
<a id="L500" name="L500"></a> 500             <em class="comment">// get the Element from KeyInfo</em>
<a id="L501" name="L501"></a> 501             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> keyInfoElement = <strong class="reserved">this</strong>.keyInfo.<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>();
<a id="L502" name="L502"></a> 502             <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> <a href="../S/2716.html#L1440" title="Defined at 1440 in src/javax/swing/tree/DefaultMutableTreeNode.java.">firstObject</a> =
<a id="L503" name="L503"></a> 503                 <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../S/5680.html#L654" title="Defined at 654 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">selectDsNode</a>(
<a id="L504" name="L504"></a> 504                     <strong class="reserved">this</strong>.constructionElement.<a href="../D/19088.html" title="Multiple defined in 18 places.">getFirstChild</a>(), <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_OBJECT, 0
<a id="L505" name="L505"></a> 505                 );
<a id="L506" name="L506"></a> 506 
<a id="L507" name="L507"></a> 507             <strong class="reserved">if</strong> (<a href="../S/2716.html#L1440" title="Defined at 1440 in src/javax/swing/tree/DefaultMutableTreeNode.java.">firstObject</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L508" name="L508"></a> 508                 <em class="comment">// add it before the object</em>
<a id="L509" name="L509"></a> 509                 <strong class="reserved">this</strong>.constructionElement.<a href="../D/24733.html" title="Multiple defined in 12 places.">insertBefore</a>(keyInfoElement, <a href="../S/2716.html#L1440" title="Defined at 1440 in src/javax/swing/tree/DefaultMutableTreeNode.java.">firstObject</a>);
<a id="L510" name="L510"></a> 510                 <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../S/5680.html#L528" title="Defined at 528 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">addReturnBeforeChild</a>(<strong class="reserved">this</strong>.constructionElement, <a href="../S/2716.html#L1440" title="Defined at 1440 in src/javax/swing/tree/DefaultMutableTreeNode.java.">firstObject</a>);
<a id="L511" name="L511"></a> 511             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L512" name="L512"></a> 512                 <em class="comment">// add it as the last element to the signature</em>
<a id="L513" name="L513"></a> 513                 <strong class="reserved">this</strong>.constructionElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(keyInfoElement);
<a id="L514" name="L514"></a> 514                 <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L515" name="L515"></a> 515             <em class="brace">}</em>
<a id="L516" name="L516"></a> 516         <em class="brace">}</em>
<a id="L517" name="L517"></a> 517 
<a id="L518" name="L518"></a> 518         <strong class="reserved">return</strong> <strong class="reserved">this</strong>.keyInfo;
<a id="L519" name="L519"></a> 519     <em class="brace">}</em>
<a id="L520" name="L520"></a> 520 
<div class="comment">
      Appends an Object (not a <code>java.lang.Object</code> but an Object
      element) to the Signature. Please note that this is only possible
      when signing.
      @param object ds:Object to be appended.
      @throws XMLSignatureException When this object is used to verify.</div>
<a id="L529" name="L529"></a> 529     <strong class="reserved">public</strong> <strong class="reserved">void</strong> appendObject(<a href="../S/5658.html#L40" title="Defined at 40 in src/com/sun/org/apache/xml/internal/security/signature/ObjectContainer.java.">ObjectContainer</a> <a href="../D/28389.html" title="Multiple defined in 8 places.">object</a>) <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L530" name="L530"></a> 530         <em class="comment">//try {</em>
<a id="L531" name="L531"></a> 531         <em class="comment">//if (this.state != MODE_SIGN) {</em>
<a id="L532" name="L532"></a> 532         <em class="comment">// throw new XMLSignatureException(</em>
<a id="L533" name="L533"></a> 533         <em class="comment">//  "signature.operationOnlyBeforeSign");</em>
<a id="L534" name="L534"></a> 534         <em class="comment">//}</em>
<a id="L535" name="L535"></a> 535 
<a id="L536" name="L536"></a> 536         <strong class="reserved">this</strong>.constructionElement.<a href="../D/11365.html" title="Multiple defined in 17 places.">appendChild</a>(<a href="../D/28389.html" title="Multiple defined in 8 places.">object</a>.<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>());
<a id="L537" name="L537"></a> 537         <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../D/11052.html" title="Multiple defined in 2 places.">addReturnToElement</a>(<strong class="reserved">this</strong>.constructionElement);
<a id="L538" name="L538"></a> 538         <em class="comment">//} catch (XMLSecurityException ex) {</em>
<a id="L539" name="L539"></a> 539         <em class="comment">// throw new XMLSignatureException("empty", ex);</em>
<a id="L540" name="L540"></a> 540         <em class="comment">//}</em>
<a id="L541" name="L541"></a> 541     <em class="brace">}</em>
<a id="L542" name="L542"></a> 542 
<div class="comment">
      Returns the <code>i<code>th <code>ds:Object</code> child of the signature
      or null if no such <code>ds:Object</code> element exists.
      @param i
      @return the <code>i<code>th <code>ds:Object</code> child of the signature
      or null if no such <code>ds:Object</code> element exists.</code></code></code></code></div>
<a id="L551" name="L551"></a> 551     <strong class="reserved">public</strong> <a href="../S/5658.html#L40" title="Defined at 40 in src/com/sun/org/apache/xml/internal/security/signature/ObjectContainer.java.">ObjectContainer</a> getObjectItem(<strong class="reserved">int</strong> i) <em class="brace">{</em>
<a id="L552" name="L552"></a> 552         <a href="../D/2794.html" title="Multiple defined in 8 places.">Element</a> objElem =
<a id="L553" name="L553"></a> 553             <a href="../S/5680.html#L52" title="Defined at 52 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">XMLUtils</a>.<a href="../S/5680.html#L654" title="Defined at 654 in src/com/sun/org/apache/xml/internal/security/utils/XMLUtils.java.">selectDsNode</a>(
<a id="L554" name="L554"></a> 554                 <strong class="reserved">this</strong>.constructionElement.<a href="../D/19088.html" title="Multiple defined in 18 places.">getFirstChild</a>(), <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_OBJECT, i
<a id="L555" name="L555"></a> 555             );
<a id="L556" name="L556"></a> 556 
<a id="L557" name="L557"></a> 557         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L558" name="L558"></a> 558             <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/5658.html#L40" title="Defined at 40 in src/com/sun/org/apache/xml/internal/security/signature/ObjectContainer.java.">ObjectContainer</a>(objElem, <strong class="reserved">this</strong>.baseURI);
<a id="L559" name="L559"></a> 559         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L560" name="L560"></a> 560             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L561" name="L561"></a> 561         <em class="brace">}</em>
<a id="L562" name="L562"></a> 562     <em class="brace">}</em>
<a id="L563" name="L563"></a> 563 
<div class="comment">
      Returns the number of all <code>ds:Object</code> elements.
      @return the number of all <code>ds:Object</code> elements.</div>
<a id="L569" name="L569"></a> 569     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getObjectLength() <em class="brace">{</em>
<a id="L570" name="L570"></a> 570         <strong class="reserved">return</strong> <strong class="reserved">this</strong>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>(<a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.SignatureSpecNS, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_OBJECT);
<a id="L571" name="L571"></a> 571     <em class="brace">}</em>
<a id="L572" name="L572"></a> 572 
<div class="comment">
      Digests all References in the SignedInfo, calculates the signature value
      and sets it in the SignatureValue Element.
      @param signingKey the {@link java.security.PrivateKey} or
      {@link javax.crypto.SecretKey} that is used to sign.
      @throws XMLSignatureException</div>
<a id="L581" name="L581"></a> 581     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/28601.html" title="Multiple referred from 231 places.">sign</a>(<a href="../D/4780.html" title="Multiple defined in 5 places.">Key</a> signingKey) <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L582" name="L582"></a> 582 
<a id="L583" name="L583"></a> 583         <strong class="reserved">if</strong> (signingKey <strong class="reserved">instanceof</strong> <a href="../S/1329.html#L46" title="Defined at 46 in src/java/security/PublicKey.java.">PublicKey</a>) <em class="brace">{</em>
<a id="L584" name="L584"></a> 584             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L585" name="L585"></a> 585                 <a href="../S/5691.html#L34" title="Defined at 34 in src/com/sun/org/apache/xml/internal/security/utils/I18n.java.">I18n</a>.<a href="../D/35598.html" title="Multiple defined in 116 places.">translate</a>("algorithms.operationOnlyVerification")
<a id="L586" name="L586"></a> 586             );
<a id="L587" name="L587"></a> 587         <em class="brace">}</em>
<a id="L588" name="L588"></a> 588 
<a id="L589" name="L589"></a> 589         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L590" name="L590"></a> 590             <em class="comment">//Create a SignatureAlgorithm object</em>
<a id="L591" name="L591"></a> 591             <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a> si = <strong class="reserved">this</strong>.<a href="../D/22514.html" title="Multiple defined in 2 places.">getSignedInfo</a>();
<a id="L592" name="L592"></a> 592             <a href="../S/5665.html#L51" title="Defined at 51 in src/com/sun/org/apache/xml/internal/security/algorithms/SignatureAlgorithm.java.">SignatureAlgorithm</a> sa = si.<a href="../S/5650.html#L361" title="Defined at 361 in src/com/sun/org/apache/xml/internal/security/signature/SignedInfo.java.">getSignatureAlgorithm</a>();
<a id="L593" name="L593"></a> 593             <a href="../D/6445.html" title="Multiple defined in 3 places.">OutputStream</a> so = <strong class="reserved">null</strong>;
<a id="L594" name="L594"></a> 594             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L595" name="L595"></a> 595                 <em class="comment">// initialize SignatureAlgorithm for signing</em>
<a id="L596" name="L596"></a> 596                 sa.<a href="../D/24611.html" title="Multiple defined in 5 places.">initSign</a>(signingKey);
<a id="L597" name="L597"></a> 597 
<a id="L598" name="L598"></a> 598                 <em class="comment">// generate digest values for all References in this SignedInfo</em>
<a id="L599" name="L599"></a> 599                 si.<a href="../S/5649.html#L205" title="Defined at 205 in src/com/sun/org/apache/xml/internal/security/signature/Manifest.java.">generateDigestValues</a>();
<a id="L600" name="L600"></a> 600                 so = <strong class="reserved">new</strong> <a href="../S/5693.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/security/utils/UnsyncBufferedOutputStream.java.">UnsyncBufferedOutputStream</a>(<strong class="reserved">new</strong> <a href="../S/5684.html#L34" title="Defined at 34 in src/com/sun/org/apache/xml/internal/security/utils/SignerOutputStream.java.">SignerOutputStream</a>(sa));
<a id="L601" name="L601"></a> 601                 <em class="comment">// get the canonicalized bytes from SignedInfo</em>
<a id="L602" name="L602"></a> 602                 si.<a href="../S/5650.html#L295" title="Defined at 295 in src/com/sun/org/apache/xml/internal/security/signature/SignedInfo.java.">signInOctetStream</a>(so);
<a id="L603" name="L603"></a> 603             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L604" name="L604"></a> 604                 <strong class="reserved">throw</strong> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>;
<a id="L605" name="L605"></a> 605             <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L606" name="L606"></a> 606                 <strong class="reserved">if</strong> (so != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L607" name="L607"></a> 607                     <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L608" name="L608"></a> 608                         so.<a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>();
<a id="L609" name="L609"></a> 609                     <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L610" name="L610"></a> 610                         <strong class="reserved">if</strong> (<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/25833.html" title="Multiple defined in 6 places.">isLoggable</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE)) <em class="brace">{</em>
<a id="L611" name="L611"></a> 611                             <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE, <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>(), <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L612" name="L612"></a> 612                         <em class="brace">}</em>
<a id="L613" name="L613"></a> 613                     <em class="brace">}</em>
<a id="L614" name="L614"></a> 614                 <em class="brace">}</em>
<a id="L615" name="L615"></a> 615             <em class="brace">}</em>
<a id="L616" name="L616"></a> 616 
<a id="L617" name="L617"></a> 617             <em class="comment">// set them on the SignatureValue element</em>
<a id="L618" name="L618"></a> 618             <strong class="reserved">this</strong>.<a href="../S/5654.html#L469" title="Defined at 469 in src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java.">setSignatureValueElement</a>(sa.<a href="../D/34554.html" title="Multiple defined in 7 places.">sign</a>());
<a id="L619" name="L619"></a> 619         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L620" name="L620"></a> 620             <strong class="reserved">throw</strong> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>;
<a id="L621" name="L621"></a> 621         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5608.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/security/c14n/CanonicalizationException.java.">CanonicalizationException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L622" name="L622"></a> 622             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L623" name="L623"></a> 623         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5622.html#L27" title="Defined at 27 in src/com/sun/org/apache/xml/internal/security/c14n/InvalidCanonicalizerException.java.">InvalidCanonicalizerException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L624" name="L624"></a> 624             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L625" name="L625"></a> 625         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L626" name="L626"></a> 626             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L627" name="L627"></a> 627         <em class="brace">}</em>
<a id="L628" name="L628"></a> 628     <em class="brace">}</em>
<a id="L629" name="L629"></a> 629 
<div class="comment">
      Adds a {@link ResourceResolver} to enable the retrieval of resources.
      @param resolver</div>
<a id="L635" name="L635"></a> 635     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9939.html" title="Multiple referred from 2 places.">addResourceResolver</a>(<a href="../S/5704.html#L43" title="Defined at 43 in src/com/sun/org/apache/xml/internal/security/utils/resolver/ResourceResolver.java.">ResourceResolver</a> resolver) <em class="brace">{</em>
<a id="L636" name="L636"></a> 636         <strong class="reserved">this</strong>.<a href="../D/22514.html" title="Multiple defined in 2 places.">getSignedInfo</a>().<a href="../D/11047.html" title="Multiple defined in 4 places.">addResourceResolver</a>(resolver);
<a id="L637" name="L637"></a> 637     <em class="brace">}</em>
<a id="L638" name="L638"></a> 638 
<div class="comment">
      Adds a {@link ResourceResolverSpi} to enable the retrieval of resources.
      @param resolver</div>
<a id="L644" name="L644"></a> 644     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9939.html" title="Multiple referred from 2 places.">addResourceResolver</a>(<a href="../S/5702.html#L36" title="Defined at 36 in src/com/sun/org/apache/xml/internal/security/utils/resolver/ResourceResolverSpi.java.">ResourceResolverSpi</a> resolver) <em class="brace">{</em>
<a id="L645" name="L645"></a> 645         <strong class="reserved">this</strong>.<a href="../D/22514.html" title="Multiple defined in 2 places.">getSignedInfo</a>().<a href="../D/11047.html" title="Multiple defined in 4 places.">addResourceResolver</a>(resolver);
<a id="L646" name="L646"></a> 646     <em class="brace">}</em>
<a id="L647" name="L647"></a> 647 
<div class="comment">
      Extracts the public key from the certificate and verifies if the signature
      is valid by re-digesting all References, comparing those against the
      stored DigestValues and then checking to see if the Signatures match on
      the SignedInfo.
      @param cert Certificate that contains the public key part of the keypair
      that was used to sign.
      @return true if the signature is valid, false otherwise
      @throws XMLSignatureException</div>
<a id="L659" name="L659"></a> 659     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/5654.html#L664" title="Referred from 664 in src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java.">checkSignatureValue</a>(<a href="../D/9813.html" title="Multiple defined in 2 places.">X509Certificate</a> cert)
<a id="L660" name="L660"></a> 660         <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L661" name="L661"></a> 661         <em class="comment">// see if cert is null</em>
<a id="L662" name="L662"></a> 662         <strong class="reserved">if</strong> (cert != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L663" name="L663"></a> 663             <em class="comment">// check the values with the public key from the cert</em>
<a id="L664" name="L664"></a> 664             <strong class="reserved">return</strong> <strong class="reserved">this</strong>.<a href="../D/12660.html" title="Multiple defined in 2 places.">checkSignatureValue</a>(cert.<a href="../D/21782.html" title="Multiple defined in 14 places.">getPublicKey</a>());
<a id="L665" name="L665"></a> 665         <em class="brace">}</em>
<a id="L666" name="L666"></a> 666 
<a id="L667" name="L667"></a> 667         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> exArgs[] = <em class="brace">{</em> "Didn't get a certificate" <em class="brace">}</em>;
<a id="L668" name="L668"></a> 668         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", exArgs);
<a id="L669" name="L669"></a> 669     <em class="brace">}</em>
<a id="L670" name="L670"></a> 670 
<div class="comment">
      Verifies if the signature is valid by redigesting all References,
      comparing those against the stored DigestValues and then checking to see
      if the Signatures match on the SignedInfo.
      @param pk {@link java.security.PublicKey} part of the keypair or
      {@link javax.crypto.SecretKey} that was used to sign
      @return true if the signature is valid, false otherwise
      @throws XMLSignatureException</div>
<a id="L681" name="L681"></a> 681     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/5654.html#L664" title="Referred from 664 in src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java.">checkSignatureValue</a>(<a href="../D/4780.html" title="Multiple defined in 5 places.">Key</a> pk) <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L682" name="L682"></a> 682         <em class="comment">//COMMENT: pk suggests it can only be a public key?</em>
<a id="L683" name="L683"></a> 683         <em class="comment">//check to see if the key is not null</em>
<a id="L684" name="L684"></a> 684         <strong class="reserved">if</strong> (pk == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L685" name="L685"></a> 685             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> exArgs[] = <em class="brace">{</em> "Didn't get a key" <em class="brace">}</em>;
<a id="L686" name="L686"></a> 686             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", exArgs);
<a id="L687" name="L687"></a> 687         <em class="brace">}</em>
<a id="L688" name="L688"></a> 688         <em class="comment">// all references inside the signedinfo need to be dereferenced and</em>
<a id="L689" name="L689"></a> 689         <em class="comment">// digested again to see if the outcome matches the stored value in the</em>
<a id="L690" name="L690"></a> 690         <em class="comment">// SignedInfo.</em>
<a id="L691" name="L691"></a> 691         <em class="comment">// If followManifestsDuringValidation is true it will do the same for</em>
<a id="L692" name="L692"></a> 692         <em class="comment">// References inside a Manifest.</em>
<a id="L693" name="L693"></a> 693         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L694" name="L694"></a> 694             <a href="../D/7972.html" title="Multiple defined in 2 places.">SignedInfo</a> si = <strong class="reserved">this</strong>.<a href="../D/22514.html" title="Multiple defined in 2 places.">getSignedInfo</a>();
<a id="L695" name="L695"></a> 695             <em class="comment">//create a SignatureAlgorithms from the SignatureMethod inside</em>
<a id="L696" name="L696"></a> 696             <em class="comment">//SignedInfo. This is used to validate the signature.</em>
<a id="L697" name="L697"></a> 697             <a href="../S/5665.html#L51" title="Defined at 51 in src/com/sun/org/apache/xml/internal/security/algorithms/SignatureAlgorithm.java.">SignatureAlgorithm</a> sa = si.<a href="../S/5650.html#L361" title="Defined at 361 in src/com/sun/org/apache/xml/internal/security/signature/SignedInfo.java.">getSignatureAlgorithm</a>();
<a id="L698" name="L698"></a> 698             <strong class="reserved">if</strong> (<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/25833.html" title="Multiple defined in 6 places.">isLoggable</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE)) <em class="brace">{</em>
<a id="L699" name="L699"></a> 699                 <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE, "signatureMethodURI = " + sa.<a href="../S/5666.html#L63" title="Defined at 63 in src/com/sun/org/apache/xml/internal/security/algorithms/Algorithm.java.">getAlgorithmURI</a>());
<a id="L700" name="L700"></a> 700                 <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE, "jceSigAlgorithm    = " + sa.<a href="../D/19869.html" title="Multiple defined in 2 places.">getJCEAlgorithmString</a>());
<a id="L701" name="L701"></a> 701                 <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE, "jceSigProvider     = " + sa.<a href="../S/5665.html#L195" title="Defined at 195 in src/com/sun/org/apache/xml/internal/security/algorithms/SignatureAlgorithm.java.">getJCEProviderName</a>());
<a id="L702" name="L702"></a> 702                 <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE, "PublicKey = " + pk);
<a id="L703" name="L703"></a> 703             <em class="brace">}</em>
<a id="L704" name="L704"></a> 704             <strong class="reserved">byte</strong> sigBytes[] = <strong class="reserved">null</strong>;
<a id="L705" name="L705"></a> 705             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L706" name="L706"></a> 706                 sa.<a href="../D/24632.html" title="Multiple defined in 3 places.">initVerify</a>(pk);
<a id="L707" name="L707"></a> 707 
<a id="L708" name="L708"></a> 708                 <em class="comment">// Get the canonicalized (normalized) SignedInfo</em>
<a id="L709" name="L709"></a> 709                 <a href="../S/5684.html#L34" title="Defined at 34 in src/com/sun/org/apache/xml/internal/security/utils/SignerOutputStream.java.">SignerOutputStream</a> so = <strong class="reserved">new</strong> <a href="../S/5684.html#L34" title="Defined at 34 in src/com/sun/org/apache/xml/internal/security/utils/SignerOutputStream.java.">SignerOutputStream</a>(sa);
<a id="L710" name="L710"></a> 710                 <a href="../D/6445.html" title="Multiple defined in 3 places.">OutputStream</a> bos = <strong class="reserved">new</strong> <a href="../S/5693.html#L32" title="Defined at 32 in src/com/sun/org/apache/xml/internal/security/utils/UnsyncBufferedOutputStream.java.">UnsyncBufferedOutputStream</a>(so);
<a id="L711" name="L711"></a> 711 
<a id="L712" name="L712"></a> 712                 si.<a href="../S/5650.html#L295" title="Defined at 295 in src/com/sun/org/apache/xml/internal/security/signature/SignedInfo.java.">signInOctetStream</a>(bos);
<a id="L713" name="L713"></a> 713                 bos.<a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>();
<a id="L714" name="L714"></a> 714                 <em class="comment">// retrieve the byte[] from the stored signature</em>
<a id="L715" name="L715"></a> 715                 sigBytes = <strong class="reserved">this</strong>.<a href="../D/22511.html" title="Multiple defined in 2 places.">getSignatureValue</a>();
<a id="L716" name="L716"></a> 716             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L717" name="L717"></a> 717                 <strong class="reserved">if</strong> (<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/25833.html" title="Multiple defined in 6 places.">isLoggable</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE)) <em class="brace">{</em>
<a id="L718" name="L718"></a> 718                     <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.FINE, <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>(), <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L719" name="L719"></a> 719                 <em class="brace">}</em>
<a id="L720" name="L720"></a> 720                 <em class="comment">// Impossible...</em>
<a id="L721" name="L721"></a> 721             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L722" name="L722"></a> 722                 <strong class="reserved">throw</strong> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>;
<a id="L723" name="L723"></a> 723             <em class="brace">}</em>
<a id="L724" name="L724"></a> 724 
<a id="L725" name="L725"></a> 725             <em class="comment">// have SignatureAlgorithm sign the input bytes and compare them to</em>
<a id="L726" name="L726"></a> 726             <em class="comment">// the bytes that were stored in the signature.</em>
<a id="L727" name="L727"></a> 727             <strong class="reserved">if</strong> (!sa.<a href="../D/36390.html" title="Multiple defined in 23 places.">verify</a>(sigBytes)) <em class="brace">{</em>
<a id="L728" name="L728"></a> 728                 <a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>.<a href="../D/27040.html" title="Multiple defined in 16 places.">log</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.logging.<a href="../S/1180.html#L66" title="Defined at 66 in src/java/util/logging/Level.java.">Level</a>.WARNING, "Signature verification failed.");
<a id="L729" name="L729"></a> 729                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L730" name="L730"></a> 730             <em class="brace">}</em>
<a id="L731" name="L731"></a> 731 
<a id="L732" name="L732"></a> 732             <strong class="reserved">return</strong> si.<a href="../D/36390.html" title="Multiple defined in 23 places.">verify</a>(<strong class="reserved">this</strong>.followManifestsDuringValidation);
<a id="L733" name="L733"></a> 733         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L734" name="L734"></a> 734             <strong class="reserved">throw</strong> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>;
<a id="L735" name="L735"></a> 735         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L736" name="L736"></a> 736             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a>("empty", <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>);
<a id="L737" name="L737"></a> 737         <em class="brace">}</em>
<a id="L738" name="L738"></a> 738     <em class="brace">}</em>
<a id="L739" name="L739"></a> 739 
<div class="comment">
      Add a Reference with full parameters to this Signature
      @param referenceURI URI of the resource to be signed. Can be null in
      which case the dereferencing is application specific. Can be "" in which
      it's the parent node (or parent document?). There can only be one "" in
      each signature.
      @param trans Optional list of transformations to be done before digesting
      @param digestURI Mandatory URI of the digesting algorithm to use.
      @param referenceId Optional id attribute for this Reference
      @param referenceType Optional mimetype for the URI
      @throws XMLSignatureException</div>
<a id="L753" name="L753"></a> 753     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9694.html" title="Multiple referred from 7 places.">addDocument</a>(
<a id="L754" name="L754"></a> 754         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> referenceURI,
<a id="L755" name="L755"></a> 755         <a href="../D/9094.html" title="Multiple defined in 2 places.">Transforms</a> trans,
<a id="L756" name="L756"></a> 756         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> digestURI,
<a id="L757" name="L757"></a> 757         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> referenceId,
<a id="L758" name="L758"></a> 758         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/4565.html#L200" title="Defined at 200 in src/com/sun/org/apache/bcel/internal/util/Class2HTML.java.">referenceType</a>
<a id="L759" name="L759"></a> 759     ) <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L760" name="L760"></a> 760         <strong class="reserved">this</strong>.signedInfo.<a href="../D/10760.html" title="Multiple defined in 9 places.">addDocument</a>(
<a id="L761" name="L761"></a> 761             <strong class="reserved">this</strong>.baseURI, referenceURI, trans, digestURI, referenceId, <a href="../S/4565.html#L200" title="Defined at 200 in src/com/sun/org/apache/bcel/internal/util/Class2HTML.java.">referenceType</a>
<a id="L762" name="L762"></a> 762         );
<a id="L763" name="L763"></a> 763     <em class="brace">}</em>
<a id="L764" name="L764"></a> 764 
<div class="comment">
      This method is a proxy method for the {@link Manifest#addDocument} method.
      @param referenceURI URI according to the XML Signature specification.
      @param trans List of transformations to be applied.
      @param digestURI URI of the digest algorithm to be used.
      @see Manifest#addDocument
      @throws XMLSignatureException</div>
<a id="L774" name="L774"></a> 774     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9694.html" title="Multiple referred from 7 places.">addDocument</a>(
<a id="L775" name="L775"></a> 775         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> referenceURI,
<a id="L776" name="L776"></a> 776         <a href="../D/9094.html" title="Multiple defined in 2 places.">Transforms</a> trans,
<a id="L777" name="L777"></a> 777         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> digestURI
<a id="L778" name="L778"></a> 778     ) <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L779" name="L779"></a> 779         <strong class="reserved">this</strong>.signedInfo.<a href="../D/10760.html" title="Multiple defined in 9 places.">addDocument</a>(<strong class="reserved">this</strong>.baseURI, referenceURI, trans, digestURI, <strong class="reserved">null</strong>, <strong class="reserved">null</strong>);
<a id="L780" name="L780"></a> 780     <em class="brace">}</em>
<a id="L781" name="L781"></a> 781 
<div class="comment">
      Adds a Reference with just the URI and the transforms. This used the
      SHA1 algorithm as a default digest algorithm.
      @param referenceURI URI according to the XML Signature specification.
      @param trans List of transformations to be applied.
      @throws XMLSignatureException</div>
<a id="L790" name="L790"></a> 790     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9694.html" title="Multiple referred from 7 places.">addDocument</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> referenceURI, <a href="../D/9094.html" title="Multiple defined in 2 places.">Transforms</a> trans)
<a id="L791" name="L791"></a> 791         <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L792" name="L792"></a> 792         <strong class="reserved">this</strong>.signedInfo.<a href="../D/10760.html" title="Multiple defined in 9 places.">addDocument</a>(
<a id="L793" name="L793"></a> 793             <strong class="reserved">this</strong>.baseURI, referenceURI, trans, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.ALGO_ID_DIGEST_SHA1, <strong class="reserved">null</strong>, <strong class="reserved">null</strong>
<a id="L794" name="L794"></a> 794         );
<a id="L795" name="L795"></a> 795     <em class="brace">}</em>
<a id="L796" name="L796"></a> 796 
<div class="comment">
      Add a Reference with just this URI. It uses SHA1 by default as the digest
      algorithm
      @param referenceURI URI according to the XML Signature specification.
      @throws XMLSignatureException</div>
<a id="L804" name="L804"></a> 804     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9694.html" title="Multiple referred from 7 places.">addDocument</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> referenceURI) <strong class="reserved">throws</strong> <a href="../D/10006.html" title="Multiple defined in 2 places.">XMLSignatureException</a> <em class="brace">{</em>
<a id="L805" name="L805"></a> 805         <strong class="reserved">this</strong>.signedInfo.<a href="../D/10760.html" title="Multiple defined in 9 places.">addDocument</a>(
<a id="L806" name="L806"></a> 806             <strong class="reserved">this</strong>.baseURI, referenceURI, <strong class="reserved">null</strong>, <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.ALGO_ID_DIGEST_SHA1, <strong class="reserved">null</strong>, <strong class="reserved">null</strong>
<a id="L807" name="L807"></a> 807         );
<a id="L808" name="L808"></a> 808     <em class="brace">}</em>
<a id="L809" name="L809"></a> 809 
<div class="comment">
      Add an X509 Certificate to the KeyInfo. This will include the whole cert
      inside X509Data/X509Certificate tags.
      @param cert Certificate to be included. This should be the certificate of
      the key that was used to sign.
      @throws XMLSecurityException</div>
<a id="L818" name="L818"></a> 818     <strong class="reserved">public</strong> <strong class="reserved">void</strong> addKeyInfo(<a href="../D/9813.html" title="Multiple defined in 2 places.">X509Certificate</a> cert) <strong class="reserved">throws</strong> <a href="../S/5715.html#L64" title="Defined at 64 in src/com/sun/org/apache/xml/internal/security/exceptions/XMLSecurityException.java.">XMLSecurityException</a> <em class="brace">{</em>
<a id="L819" name="L819"></a> 819         <a href="../D/9815.html" title="Multiple defined in 2 places.">X509Data</a> x509data = <strong class="reserved">new</strong> <a href="../D/9815.html" title="Multiple defined in 2 places.">X509Data</a>(<strong class="reserved">this</strong>.doc);
<a id="L820" name="L820"></a> 820 
<a id="L821" name="L821"></a> 821         x509data.<a href="../D/10696.html" title="Multiple defined in 3 places.">addCertificate</a>(cert);
<a id="L822" name="L822"></a> 822         <strong class="reserved">this</strong>.<a href="../D/19933.html" title="Multiple defined in 4 places.">getKeyInfo</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(x509data);
<a id="L823" name="L823"></a> 823     <em class="brace">}</em>
<a id="L824" name="L824"></a> 824 
<div class="comment">
      Add this public key to the KeyInfo. This will include the complete key in
      the KeyInfo structure.
      @param pk</div>
<a id="L831" name="L831"></a> 831     <strong class="reserved">public</strong> <strong class="reserved">void</strong> addKeyInfo(<a href="../S/1329.html#L46" title="Defined at 46 in src/java/security/PublicKey.java.">PublicKey</a> pk) <em class="brace">{</em>
<a id="L832" name="L832"></a> 832         <strong class="reserved">this</strong>.<a href="../D/19933.html" title="Multiple defined in 4 places.">getKeyInfo</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(pk);
<a id="L833" name="L833"></a> 833     <em class="brace">}</em>
<a id="L834" name="L834"></a> 834 
<div class="comment">
      Proxy method for {@link SignedInfo#createSecretKey(byte[])}. If you want
      to create a MAC, this method helps you to obtain the
      {@link javax.crypto.SecretKey} from octets.
      @param secretKeyBytes
      @return the secret key created.
      @see SignedInfo#createSecretKey(byte[])</div>
<a id="L844" name="L844"></a> 844     <strong class="reserved">public</strong> SecretKey <a href="../S/5654.html#L845" title="Referred from 845 in src/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java.">createSecretKey</a>(<strong class="reserved">byte</strong>[] secretKeyBytes) <em class="brace">{</em>
<a id="L845" name="L845"></a> 845         <strong class="reserved">return</strong> <strong class="reserved">this</strong>.<a href="../D/22514.html" title="Multiple defined in 2 places.">getSignedInfo</a>().<a href="../D/14186.html" title="Multiple defined in 2 places.">createSecretKey</a>(secretKeyBytes);
<a id="L846" name="L846"></a> 846     <em class="brace">}</em>
<a id="L847" name="L847"></a> 847 
<div class="comment">
      Signal whether Manifest should be automatically validated.
      Checking the digests in References in a Signature are mandatory, but for
      References inside a Manifest it is application specific. This boolean is
      to indicate that the References inside Manifests should be validated.
      @param followManifests
      @see <a href="http://www.w3.org/TR/xmldsig-core/#sec-CoreValidation">
      Core validation section in the XML Signature Rec.</a></div>
<a id="L858" name="L858"></a> 858     <strong class="reserved">public</strong> <strong class="reserved">void</strong> setFollowNestedManifests(<strong class="reserved">boolean</strong> followManifests) <em class="brace">{</em>
<a id="L859" name="L859"></a> 859         <strong class="reserved">this</strong>.followManifestsDuringValidation = followManifests;
<a id="L860" name="L860"></a> 860     <em class="brace">}</em>
<a id="L861" name="L861"></a> 861 
<div class="comment">
      Get the local name of this element
      @return Constants._TAG_SIGNATURE</div>
<a id="L867" name="L867"></a> 867     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/15224.html" title="Multiple referred from 7 places.">getBaseLocalName</a>() <em class="brace">{</em>
<a id="L868" name="L868"></a> 868         <strong class="reserved">return</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>._TAG_SIGNATURE;
<a id="L869" name="L869"></a> 869     <em class="brace">}</em>
<a id="L870" name="L870"></a> 870 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L423">[^]</a><a href="#L867">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>