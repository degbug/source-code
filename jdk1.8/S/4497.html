<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/security/auth/module/Krb5LoginModule.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L464">[^]</a><a href="#L1253">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L464" title="Defined at 464.">SuppressWarnings</a></li>
<li><a href="#L465" title="Defined at 465.">initialize</a></li>
<li><a href="#L546" title="Defined at 546.">login</a></li>
<li><a href="#L640" title="Defined at 640.">attemptAuthentication</a></li>
<li><a href="#L814" title="Defined at 814.">promptForName</a></li>
<li><a href="#L876" title="Defined at 876.">promptForPass</a></li>
<li><a href="#L948" title="Defined at 948.">validateConfiguration</a></li>
<li><a href="#L987" title="Defined at 987.">isCurrent</a></li>
<li><a href="#L996" title="Defined at 996.">renewCredentials</a></li>
<li><a href="#L1042" title="Defined at 1042.">commit</a></li>
<li><a href="#L1165" title="Defined at 1165.">abort</a></li>
<li><a href="#L1193" title="Defined at 1193.">logout</a></li>
<li><a href="#L1231" title="Defined at 1231.">cleanKerberosCred</a></li>
<li><a href="#L1253" title="Defined at 1253.">cleanState</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 
<a id="L27" name="L27"></a>  27 <strong class="reserved">package</strong> com.sun.security.auth.module;
<a id="L28" name="L28"></a>  28 
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.io.*;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.security.AccessController;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.security.PrivilegedAction;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.text.MessageFormat;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.util.*;
<a id="L34" name="L34"></a>  34 
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> javax.security.auth.*;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> javax.security.auth.kerberos.*;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> javax.security.auth.callback.*;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> javax.security.auth.login.*;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> javax.security.auth.spi.*;
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> sun.security.krb5.*;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> sun.security.jgss.krb5.Krb5Util;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> sun.security.krb5.Credentials;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> sun.misc.HexDumpEncoder;
<a id="L45" name="L45"></a>  45 
<div class="comment">
  <p> This <code>LoginModule</code> authenticates users using
  Kerberos protocols.
  </p><p> The configuration entry for <code>Krb5LoginModule</code> has
  several options that control the authentication process and
  additions to the <code>Subject</code>'s private credential
  set. Irrespective of these options, the <code>Subject</code>'s
  principal set and private credentials set are updated only when
  <code>commit</code> is called.
  When <code>commit</code> is called, the <code>KerberosPrincipal</code>
  is added to the <code>Subject</code>'s principal set (unless the
  <code>principal</code> is specified as "*"). If <code>isInitiator</code>
  is true, the <code>KerberosTicket</code> is
  added to the <code>Subject</code>'s private credentials.
  </p><p> If the configuration entry for <code>KerberosLoginModule</code>
  has the option <code>storeKey</code> set to true, then
  <code>KerberosKey</code> or <code>KeyTab</code> will also be added to the
  subject's private credentials. <code>KerberosKey</code>, the principal's
  key(s) will be derived from user's password, and <code>KeyTab</code> is
  the keytab used when <code>useKeyTab</code> is set to true. The
  <code>KeyTab</code> object is restricted to be used by the specified
  principal unless the principal value is "*".
  </p><p> This <code>LoginModule</code> recognizes the <code>doNotPrompt</code>
  option. If set to true the user will not be prompted for the password.
  </p><p> The user can  specify the location of the ticket cache by using
  the option <code>ticketCache</code> in the configuration entry.
  </p><p>The user can specify the keytab location by using
  the option <code>keyTab</code>
  in the configuration entry.
  </p><p> The principal name can be specified in the configuration entry
  by using the option <code>principal</code>. The principal name
  can either be a simple user name, a service name such as
  <code>host/mission.eng.sun.com</code>, or "*". The principal can also
  be set using the system property <code>sun.security.krb5.principal</code>.
  This property is checked during login. If this property is not set, then
  the principal name from the configuration is used. In the
  case where the principal property is not set and the principal
  entry also does not exist, the user is prompted for the name.
  When this property of entry is set, and <code>useTicketCache</code>
  is set to true, only TGT belonging to this principal is used.
  </p><p> The following is a list of configuration options supported
  for <code>Krb5LoginModule</code>:
  </p><blockquote><dl>
  <dt><b><code>refreshKrb5Config</code></b>:</dt>
  <dd> Set this to true, if you want the configuration
  to be refreshed before the <code>login</code> method is called.</dd>
  <dt><b><code>useTicketCache</code></b>:</dt>
  <dd>Set this to true, if you want the
  TGT to be obtained
  from the ticket cache. Set this option
  to false if you do not want this module to use the ticket cache.
  (Default is False).
  This module will
  search for the ticket
  cache in the following locations:
  On Solaris and Linux
  it will look for the ticket cache in /tmp/krb5cc_<code>uid</code>
  where the uid is numeric user
  identifier. If the ticket cache is
  not available in the above location, or if we are on a
  Windows platform, it will look for the cache as
  {user.home}{file.separator}krb5cc_{user.name}.
  You can override the ticket cache location by using
  <code>ticketCache</code>.
  For Windows, if a ticket cannot be retrieved from the file ticket cache,
  it will use Local Security Authority (LSA) API to get the TGT.
  </dd><dt><b><code>ticketCache</code></b>:</dt>
  <dd>Set this to the name of the ticket
  cache that  contains user's TGT.
  If this is set,  <code>useTicketCache</code>
  must also be set to true; Otherwise a configuration error will
  be returned.</dd>
  <dt><b><code>renewTGT</code></b>:</dt>
  <dd>Set this to true, if you want to renew
  the TGT. If this is set, <code>useTicketCache</code> must also be
  set to true; otherwise a configuration error will be returned.</dd>
  <dt><b><code>doNotPrompt</code></b>:</dt>
  <dd>Set this to true if you do not want to be
  prompted for the password
  if credentials can not be obtained from the cache, the keytab,
  or through shared state.(Default is false)
  If set to true, credential must be obtained through cache, keytab,
  or shared state. Otherwise, authentication will fail.</dd>
  <dt><b><code>useKeyTab</code></b>:</dt>
  <dd>Set this to true if you
  want the module to get the principal's key from the
  the keytab.(default value is False)
  If <code>keytab</code>
  is not set then
  the module will locate the keytab from the
  Kerberos configuration file.
  If it is not specified in the Kerberos configuration file
  then it will look for the file
  <code>{user.home}{file.separator}</code>krb5.keytab.</dd>
  <dt><b><code>keyTab</code></b>:</dt>
  <dd>Set this to the file name of the
  keytab to get principal's secret key.</dd>
  <dt><b><code>storeKey</code></b>:</dt>
  <dd>Set this to true to if you want the keytab or the
  principal's key to be stored in the Subject's private credentials.
  For <code>isInitiator</code> being false, if <code>principal</code>
  is "*", the <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a> stored can be used by anyone, otherwise,
  it's restricted to be used by the specified principal only.</dd>
  <dt><b><code>principal</code></b>:</dt>
  <dd>The name of the principal that should
  be used. The principal can be a simple username such as
  "<code>testuser</code>" or a service name such as
  "<code>host/testhost.eng.sun.com</code>". You can use the
  <code>principal</code>  option to set the principal when there are
  credentials for multiple principals in the
  <code>keyTab</code> or when you want a specific ticket cache only.
  The principal can also be set using the system property
  <code>sun.security.krb5.principal</code>. In addition, if this
  system property is defined, then it will be used. If this property
  is not set, then the principal name from the configuration will be
  used.
  The principal name can be set to "*" when <code>isInitiator</code> is false.
  In this case, the acceptor is not bound to a single principal. It can
  act as any principal an initiator requests if keys for that principal
  can be found. When <code>isInitiator</code> is true, the principal name
  cannot be set to "*".
  </dd>
  <dt><b><code>isInitiator</code></b>:</dt>
  <dd>Set this to true, if initiator. Set this to false, if acceptor only.
  (Default is true).
  Note: Do not set this value to false for initiators.</dd>
  </dl></blockquote>
  <p> This <code>LoginModule</code> also recognizes the following additional
  <code>Configuration</code>
  options that enable you to share username and passwords across different
  authentication modules:
  </p><blockquote><dl>
     <dt><b><code>useFirstPass</code></b>:</dt>
                    <dd>if, true, this LoginModule retrieves the
                    username and password from the module's shared state,
                    using "javax.security.auth.login.name" and
                    "javax.security.auth.login.password" as the respective
                    keys. The retrieved values are used for authentication.
                    If authentication fails, no attempt for a retry
                    is made, and the failure is reported back to the
                    calling application.</dd>
     <dt><b><code>tryFirstPass</code></b>:</dt>
                    <dd>if, true, this LoginModule retrieves the
                    the username and password from the module's shared
                    state using "javax.security.auth.login.name" and
                    "javax.security.auth.login.password" as the respective
                    keys.  The retrieved values are used for
                    authentication.
                    If authentication fails, the module uses the
                    CallbackHandler to retrieve a new username
                    and password, and another attempt to authenticate
                    is made. If the authentication fails,
                    the failure is reported back to the calling application</dd>
     <dt><b><code>storePass</code></b>:</dt>
                    <dd>if, true, this LoginModule stores the username and
                    password obtained from the CallbackHandler in the
                    modules shared state, using
                    "javax.security.auth.login.name" and
                    "javax.security.auth.login.password" as the respective
                    keys.  This is not performed if existing values already
                    exist for the username and password in the shared
                    state, or if authentication fails.</dd>
     <dt><b><code>clearPass</code></b>:</dt>
                    <dd>if, true, this LoginModule clears the
                    username and password stored in the module's shared
                    state  after both phases of authentication
                    (login and commit) have completed.</dd>
  </dl></blockquote>
  <p>If the principal system property or key is already provided, the value of
  "javax.security.auth.login.name" in the shared state is ignored.
  </p><p>When multiple mechanisms to retrieve a ticket or key is provided, the
  preference order is:
  </p><ol>
  <li>ticket cache
  </li><li>keytab
  </li><li>shared state
  </li><li>user prompt
  </li></ol>
  <p>Note that if any step fails, it will fallback to the next step.
  There's only one exception, if the shared state step fails and
  <code>useFirstPass</code>=true, no user prompt is made.
  </p><p>Examples of some configuration values for Krb5LoginModule in
  JAAS config file and the results are:
  </p><ul>
  <p> <code>doNotPrompt</code>=true;
  </p></ul>
  <p> This is an illegal combination since none of <code>useTicketCache</code>,
  <code>useKeyTab</code>, <code>useFirstPass</code> and <code>tryFirstPass</code>
  is set and the user can not be prompted for the password.
 </p><ul>
  <p> <code>ticketCache</code> = &lt;filename&gt;;
 </p></ul>
  <p> This is an illegal combination since <code>useTicketCache</code>
  is not set to true and the ticketCache is set. A configuration error
  will occur.
  </p><ul>
  <p> <code>renewTGT</code>=true;
 </p></ul>
  <p> This is an illegal combination since <code>useTicketCache</code> is
  not set to true and renewTGT is set. A configuration error will occur.
  </p><ul>
  <p> <code>storeKey</code>=true
  <code>useTicketCache</code> = true
  <code>doNotPrompt</code>=true;;
 </p></ul>
  <p> This is an illegal combination since  <code>storeKey</code> is set to
  true but the key can not be obtained either by prompting the user or from
  the keytab, or from the shared state. A configuration error will occur.
  </p><ul>
  <p>  <code>keyTab</code> = &lt;filename&gt; <code>doNotPrompt</code>=true ;
  </p></ul>
  <p>This is an illegal combination since useKeyTab is not set to true and
  the keyTab is set. A configuration error will occur.
  </p><ul>
  <p> <code>debug=true </code>
 </p></ul>
  <p> Prompt the user for the principal name and the password.
  Use the authentication exchange to get TGT from the KDC and
  populate the <code>Subject</code> with the principal and TGT.
  Output debug messages.
  </p><ul>
  <p> <code>useTicketCache</code> = true <code>doNotPrompt</code>=true;
 </p></ul>
  <p>Check the default cache for TGT and populate the <code>Subject</code>
  with the principal and TGT. If the TGT is not available,
  do not prompt the user, instead fail the authentication.
  </p><ul>
  <p><code>principal</code>=&lt;name&gt;<code>useTicketCache</code> = true
  <code>doNotPrompt</code>=true;
 </p></ul>
  <p> Get the TGT from the default cache for the principal and populate the
  Subject's principal and private creds set. If ticket cache is
  not available or does not contain the principal's TGT
  authentication will fail.
  </p><ul>
  <p> <code>useTicketCache</code> = true
  <code>ticketCache</code>=&lt;file name&gt;<code>useKeyTab</code> = true
  <code> keyTab</code>=&lt;keytab filename&gt;
  <code>principal</code> = &lt;principal name&gt;
  <code>doNotPrompt</code>=true;
 </p></ul>
  <p>  Search the cache for the principal's TGT. If it is not available
  use the key in the keytab to perform authentication exchange with the
  KDC and acquire the TGT.
  The Subject will be populated with the principal and the TGT.
  If the key is not available or valid then authentication will fail.
  </p><ul>
  <p><code>useTicketCache</code> = true
  <code>ticketCache</code>=&lt;file name&gt;
 </p></ul>
  <p> The TGT will be obtained from the cache specified.
  The Kerberos principal name used will be the principal name in
  the Ticket cache. If the TGT is not available in the
  ticket cache the user will be prompted for the principal name
  and the password. The TGT will be obtained using the authentication
  exchange with the KDC.
  The Subject will be populated with the TGT.
 </p><ul>
  <p> <code>useKeyTab</code> = true
  <code>keyTab</code>=&lt;keytab filename&gt;
  <code>principal</code>= &lt;principal name&gt;
  <code>storeKey</code>=true;
 </p></ul>
  <p>  The key for the principal will be retrieved from the keytab.
  If the key is not available in the keytab the user will be prompted
  for the principal's password. The Subject will be populated
  with the principal's key either from the keytab or derived from the
  password entered.
  </p><ul>
  <p> <code>useKeyTab</code> = true
  <code>keyTab</code>=&lt;keytabname&gt;
  <code>storeKey</code>=true
  <code>doNotPrompt</code>=false;
 </p></ul>
  <p>The user will be prompted for the service principal name.
  If the principal's
  longterm key is available in the keytab , it will be added to the
  Subject's private credentials. An authentication exchange will be
  attempted with the principal name and the key from the Keytab.
  If successful the TGT will be added to the
  Subject's private credentials set. Otherwise the authentication will
  fail.
  </p><ul>
  <p> <code>isInitiator</code> = false <code>useKeyTab</code> = true
  <code>keyTab</code>=&lt;keytabname&gt;
  <code>storeKey</code>=true
  <code>principal</code>=*;
 </p></ul>
  <p>The acceptor will be an unbound acceptor and it can act as any principal
  as long that principal has keys in the keytab.
 </p><ul>
  <p>
  <code>useTicketCache</code>=true
  <code>ticketCache</code>=&lt;file name&gt;;
  <code>useKeyTab</code> = true
  <code>keyTab</code>=&lt;file name&gt; <code>storeKey</code>=true
  <code>principal</code>= &lt;principal name&gt;
 </p></ul>
  <p>
  The client's TGT will be retrieved from the ticket cache and added to the
  <code>Subject</code>'s private credentials. If the TGT is not available
  in the ticket cache, or the TGT's client name does not match the principal
  name, Java will use a secret key to obtain the TGT using the authentication
  exchange and added to the Subject's private credentials.
  This secret key will be first retrieved from the keytab. If the key
  is not available, the user will be prompted for the password. In either
  case, the key derived from the password will be added to the
  Subject's private credentials set.
  </p><ul>
  <p><code>isInitiator</code> = false
 </p></ul>
  <p>Configured to act as acceptor only, credentials are not acquired
  via AS exchange. For acceptors only, set this value to false.
  For initiators, do not set this value to false.
  </p><ul>
  <p><code>isInitiator</code> = true
 </p></ul>
  <p>Configured to act as initiator, credentials are acquired
  via AS exchange. For initiators, set this value to true, or leave this
  option unset, in which case default value (true) will be used.
  @author Ram Marti</p></div>
<a id="L381" name="L381"></a> 381 
<a id="L382" name="L382"></a> 382 @jdk.<a href="../D/3043.html" title="Multiple defined in 7 places.">Exported</a>
<a id="L383" name="L383"></a> 383 <strong class="reserved">public</strong> <strong class="reserved">class</strong> Krb5LoginModule <strong class="reserved">implements</strong> <a href="../S/2646.html#L129" title="Defined at 129 in src/javax/security/auth/spi/LoginModule.java.">LoginModule</a> <em class="brace">{</em>
<a id="L384" name="L384"></a> 384 
<a id="L385" name="L385"></a> 385     <em class="comment">// initial state</em>
<a id="L386" name="L386"></a> 386     <strong class="reserved">private</strong> <a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a> subject;
<a id="L387" name="L387"></a> 387     <strong class="reserved">private</strong> <a href="../S/2659.html#L68" title="Defined at 68 in src/javax/security/auth/callback/CallbackHandler.java.">CallbackHandler</a> callbackHandler;
<a id="L388" name="L388"></a> 388     <strong class="reserved">private</strong> <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt; sharedState;
<a id="L389" name="L389"></a> 389     <strong class="reserved">private</strong> <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, ?&gt; <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>;
<a id="L390" name="L390"></a> 390 
<a id="L391" name="L391"></a> 391     <em class="comment">// configurable option</em>
<a id="L392" name="L392"></a> 392     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> = <strong class="reserved">false</strong>;
<a id="L393" name="L393"></a> 393     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> storeKey = <strong class="reserved">false</strong>;
<a id="L394" name="L394"></a> 394     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> doNotPrompt = <strong class="reserved">false</strong>;
<a id="L395" name="L395"></a> 395     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> useTicketCache = <strong class="reserved">false</strong>;
<a id="L396" name="L396"></a> 396     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> useKeyTab = <strong class="reserved">false</strong>;
<a id="L397" name="L397"></a> 397     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> ticketCacheName = <strong class="reserved">null</strong>;
<a id="L398" name="L398"></a> 398     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> keyTabName = <strong class="reserved">null</strong>;
<a id="L399" name="L399"></a> 399     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> princName = <strong class="reserved">null</strong>;
<a id="L400" name="L400"></a> 400 
<a id="L401" name="L401"></a> 401     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> useFirstPass = <strong class="reserved">false</strong>;
<a id="L402" name="L402"></a> 402     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> tryFirstPass = <strong class="reserved">false</strong>;
<a id="L403" name="L403"></a> 403     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> storePass = <strong class="reserved">false</strong>;
<a id="L404" name="L404"></a> 404     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> clearPass = <strong class="reserved">false</strong>;
<a id="L405" name="L405"></a> 405     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> refreshKrb5Config = <strong class="reserved">false</strong>;
<a id="L406" name="L406"></a> 406     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> renewTGT = <strong class="reserved">false</strong>;
<a id="L407" name="L407"></a> 407 
<a id="L408" name="L408"></a> 408     <em class="comment">// specify if initiator.</em>
<a id="L409" name="L409"></a> 409     <em class="comment">// perform authentication exchange if initiator</em>
<a id="L410" name="L410"></a> 410     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a> = <strong class="reserved">true</strong>;
<a id="L411" name="L411"></a> 411 
<a id="L412" name="L412"></a> 412     <em class="comment">// the authentication status</em>
<a id="L413" name="L413"></a> 413     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> succeeded = <strong class="reserved">false</strong>;
<a id="L414" name="L414"></a> 414     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> commitSucceeded = <strong class="reserved">false</strong>;
<a id="L415" name="L415"></a> 415     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> username;
<a id="L416" name="L416"></a> 416 
<a id="L417" name="L417"></a> 417     <em class="comment">// Encryption keys calculated from password. Assigned when storekey == true</em>
<a id="L418" name="L418"></a> 418     <em class="comment">// and useKeyTab == false (or true but not found)</em>
<a id="L419" name="L419"></a> 419     <strong class="reserved">private</strong> EncryptionKey[] encKeys = <strong class="reserved">null</strong>;
<a id="L420" name="L420"></a> 420 
<a id="L421" name="L421"></a> 421     <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a> ktab = <strong class="reserved">null</strong>;
<a id="L422" name="L422"></a> 422 
<a id="L423" name="L423"></a> 423     <strong class="reserved">private</strong> Credentials cred = <strong class="reserved">null</strong>;
<a id="L424" name="L424"></a> 424 
<a id="L425" name="L425"></a> 425     <strong class="reserved">private</strong> PrincipalName <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> = <strong class="reserved">null</strong>;
<a id="L426" name="L426"></a> 426     <strong class="reserved">private</strong> <a href="../S/2636.html#L41" title="Defined at 41 in src/javax/security/auth/kerberos/KerberosPrincipal.java.">KerberosPrincipal</a> kerbClientPrinc = <strong class="reserved">null</strong>;
<a id="L427" name="L427"></a> 427     <strong class="reserved">private</strong> <a href="../S/2634.html#L79" title="Defined at 79 in src/javax/security/auth/kerberos/KerberosTicket.java.">KerberosTicket</a> kerbTicket = <strong class="reserved">null</strong>;
<a id="L428" name="L428"></a> 428     <strong class="reserved">private</strong> <a href="../S/2631.html#L60" title="Defined at 60 in src/javax/security/auth/kerberos/KerberosKey.java.">KerberosKey</a>[] kerbKeys = <strong class="reserved">null</strong>;
<a id="L429" name="L429"></a> 429     <strong class="reserved">private</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> krb5PrincName = <strong class="reserved">null</strong>;
<a id="L430" name="L430"></a> 430     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> unboundServer = <strong class="reserved">false</strong>;
<a id="L431" name="L431"></a> 431     <strong class="reserved">private</strong> <strong class="reserved">char</strong>[] password = <strong class="reserved">null</strong>;
<a id="L432" name="L432"></a> 432 
<a id="L433" name="L433"></a> 433     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> NAME = "javax.security.auth.login.name";
<a id="L434" name="L434"></a> 434     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> PWD = "javax.security.auth.login.password";
<a id="L435" name="L435"></a> 435     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a> rb = <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(
<a id="L436" name="L436"></a> 436             <strong class="reserved">new</strong> <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a>&gt;() <em class="brace">{</em>
<a id="L437" name="L437"></a> 437                 <strong class="reserved">public</strong> <a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L438" name="L438"></a> 438                     <strong class="reserved">return</strong> <a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a>.<a href="../D/17375.html" title="Multiple defined in 6 places.">getBundle</a>(
<a id="L439" name="L439"></a> 439                             "sun.security.util.AuthResources");
<a id="L440" name="L440"></a> 440                 <em class="brace">}</em>
<a id="L441" name="L441"></a> 441             <em class="brace">}</em>
<a id="L442" name="L442"></a> 442     );
<a id="L443" name="L443"></a> 443 
<div class="comment">
      Initialize this <code>LoginModule</code>.
      <p>
      @param subject the <code>Subject</code> to be authenticated. </p><p>
      @param callbackHandler a <code>CallbackHandler</code> for
                       communication with the end user (prompting for
                       usernames and passwords, for example). </p><p>
      @param sharedState shared <code>LoginModule</code> state. </p><p>
      @param options options specified in the login
                       <code>Configuration</code> for this particular
                       <code>LoginModule</code>.</p></div>
<a id="L460" name="L460"></a> 460     <em class="comment">// Unchecked warning from (Map&lt;String, Object&gt;)sharedState is safe</em>
<a id="L461" name="L461"></a> 461     <em class="comment">// since javax.security.auth.login.LoginContext passes a raw HashMap.</em>
<a id="L462" name="L462"></a> 462     <em class="comment">// Unchecked warnings from options.get(String) are safe since we are</em>
<a id="L463" name="L463"></a> 463     <em class="comment">// passing known keys.</em>
<a id="L464" name="L464"></a> 464     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L465" name="L465"></a> 465     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/20681.html" title="Multiple referred from 99 places.">initialize</a>(<a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a> subject,
<a id="L466" name="L466"></a> 466                            <a href="../S/2659.html#L68" title="Defined at 68 in src/javax/security/auth/callback/CallbackHandler.java.">CallbackHandler</a> callbackHandler,
<a id="L467" name="L467"></a> 467                            <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, ?&gt; sharedState,
<a id="L468" name="L468"></a> 468                            <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, ?&gt; <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>) <em class="brace">{</em>
<a id="L469" name="L469"></a> 469 
<a id="L470" name="L470"></a> 470         <strong class="reserved">this</strong>.subject = subject;
<a id="L471" name="L471"></a> 471         <strong class="reserved">this</strong>.callbackHandler = callbackHandler;
<a id="L472" name="L472"></a> 472         <strong class="reserved">this</strong>.sharedState = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt;)sharedState;
<a id="L473" name="L473"></a> 473         <strong class="reserved">this</strong>.<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a> = <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>;
<a id="L474" name="L474"></a> 474 
<a id="L475" name="L475"></a> 475         <em class="comment">// initialize any configured options</em>
<a id="L476" name="L476"></a> 476 
<a id="L477" name="L477"></a> 477         <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("debug"));
<a id="L478" name="L478"></a> 478         storeKey = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("storeKey"));
<a id="L479" name="L479"></a> 479         doNotPrompt = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>
<a id="L480" name="L480"></a> 480                                               ("doNotPrompt"));
<a id="L481" name="L481"></a> 481         useTicketCache = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>
<a id="L482" name="L482"></a> 482                                                  ("useTicketCache"));
<a id="L483" name="L483"></a> 483         useKeyTab = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("useKeyTab"));
<a id="L484" name="L484"></a> 484         ticketCacheName = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("ticketCache");
<a id="L485" name="L485"></a> 485         keyTabName = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("keyTab");
<a id="L486" name="L486"></a> 486         <strong class="reserved">if</strong> (keyTabName != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L487" name="L487"></a> 487             keyTabName = sun.security.krb5.internal.ktab.<a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a>.<a href="../D/28279.html" title="Multiple defined in 40 places.">normalize</a>(
<a id="L488" name="L488"></a> 488                          keyTabName);
<a id="L489" name="L489"></a> 489         <em class="brace">}</em>
<a id="L490" name="L490"></a> 490         princName = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("principal");
<a id="L491" name="L491"></a> 491         refreshKrb5Config =
<a id="L492" name="L492"></a> 492             "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("refreshKrb5Config"));
<a id="L493" name="L493"></a> 493         renewTGT =
<a id="L494" name="L494"></a> 494             "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("renewTGT"));
<a id="L495" name="L495"></a> 495 
<a id="L496" name="L496"></a> 496         <em class="comment">// check isInitiator value</em>
<a id="L497" name="L497"></a> 497         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> isInitiatorValue = ((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("isInitiator"));
<a id="L498" name="L498"></a> 498         <strong class="reserved">if</strong> (isInitiatorValue == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L499" name="L499"></a> 499             <em class="comment">// use default, if value not set</em>
<a id="L500" name="L500"></a> 500         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L501" name="L501"></a> 501             <a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a> = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>(isInitiatorValue);
<a id="L502" name="L502"></a> 502         <em class="brace">}</em>
<a id="L503" name="L503"></a> 503 
<a id="L504" name="L504"></a> 504         tryFirstPass =
<a id="L505" name="L505"></a> 505             "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>
<a id="L506" name="L506"></a> 506             ((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("tryFirstPass"));
<a id="L507" name="L507"></a> 507         useFirstPass =
<a id="L508" name="L508"></a> 508             "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>
<a id="L509" name="L509"></a> 509             ((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("useFirstPass"));
<a id="L510" name="L510"></a> 510         storePass =
<a id="L511" name="L511"></a> 511             "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("storePass"));
<a id="L512" name="L512"></a> 512         clearPass =
<a id="L513" name="L513"></a> 513             "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("clearPass"));
<a id="L514" name="L514"></a> 514         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L515" name="L515"></a> 515             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("Debug is  " + <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>
<a id="L516" name="L516"></a> 516                              + " storeKey " + storeKey
<a id="L517" name="L517"></a> 517                              + " useTicketCache " + useTicketCache
<a id="L518" name="L518"></a> 518                              + " useKeyTab " + useKeyTab
<a id="L519" name="L519"></a> 519                              + " doNotPrompt " + doNotPrompt
<a id="L520" name="L520"></a> 520                              + " ticketCache is " + ticketCacheName
<a id="L521" name="L521"></a> 521                              + " isInitiator " + <a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>
<a id="L522" name="L522"></a> 522                              + " KeyTab is " + keyTabName
<a id="L523" name="L523"></a> 523                              + " refreshKrb5Config is " + refreshKrb5Config
<a id="L524" name="L524"></a> 524                              + " principal is " + princName
<a id="L525" name="L525"></a> 525                              + " tryFirstPass is " + tryFirstPass
<a id="L526" name="L526"></a> 526                              + " useFirstPass is " + useFirstPass
<a id="L527" name="L527"></a> 527                              + " storePass is " + storePass
<a id="L528" name="L528"></a> 528                              + " clearPass is " + clearPass + "\n");
<a id="L529" name="L529"></a> 529         <em class="brace">}</em>
<a id="L530" name="L530"></a> 530     <em class="brace">}</em>
<a id="L531" name="L531"></a> 531 
<a id="L532" name="L532"></a> 532 
<div class="comment">
      Authenticate the user
      <p>
      @return true in all cases since this <code>LoginModule</code>
               should not be ignored.
      @exception FailedLoginException if the authentication fails. </p><p>
      @exception LoginException if this <code>LoginModule</code>
               is unable to perform the authentication.</p></div>
<a id="L546" name="L546"></a> 546     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22690.html" title="Multiple referred from 35 places.">login</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L547" name="L547"></a> 547 
<a id="L548" name="L548"></a> 548         <strong class="reserved">if</strong> (refreshKrb5Config) <em class="brace">{</em>
<a id="L549" name="L549"></a> 549             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L550" name="L550"></a> 550                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L551" name="L551"></a> 551                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Refreshing Kerberos configuration");
<a id="L552" name="L552"></a> 552                 <em class="brace">}</em>
<a id="L553" name="L553"></a> 553                 sun.security.krb5.Config.<a href="../D/30505.html" title="Multiple defined in 17 places.">refresh</a>();
<a id="L554" name="L554"></a> 554             <em class="brace">}</em> <strong class="reserved">catch</strong> (KrbException ke) <em class="brace">{</em>
<a id="L555" name="L555"></a> 555                 <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(ke.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L556" name="L556"></a> 556                 le.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(ke);
<a id="L557" name="L557"></a> 557                 <strong class="reserved">throw</strong> le;
<a id="L558" name="L558"></a> 558             <em class="brace">}</em>
<a id="L559" name="L559"></a> 559         <em class="brace">}</em>
<a id="L560" name="L560"></a> 560         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> principalProperty = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>
<a id="L561" name="L561"></a> 561             ("sun.security.krb5.principal");
<a id="L562" name="L562"></a> 562         <strong class="reserved">if</strong> (principalProperty != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L563" name="L563"></a> 563             krb5PrincName = <strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>(principalProperty);
<a id="L564" name="L564"></a> 564         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L565" name="L565"></a> 565             <strong class="reserved">if</strong> (princName != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L566" name="L566"></a> 566                 krb5PrincName = <strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>(princName);
<a id="L567" name="L567"></a> 567             <em class="brace">}</em>
<a id="L568" name="L568"></a> 568         <em class="brace">}</em>
<a id="L569" name="L569"></a> 569 
<a id="L570" name="L570"></a> 570         <a href="../S/4497.html#L948" title="Defined at 948 in src/com/sun/security/auth/module/Krb5LoginModule.java.">validateConfiguration</a>();
<a id="L571" name="L571"></a> 571 
<a id="L572" name="L572"></a> 572         <strong class="reserved">if</strong> (krb5PrincName != <strong class="reserved">null</strong> &amp;&amp; krb5PrincName.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("*")) <em class="brace">{</em>
<a id="L573" name="L573"></a> 573             unboundServer = <strong class="reserved">true</strong>;
<a id="L574" name="L574"></a> 574         <em class="brace">}</em>
<a id="L575" name="L575"></a> 575 
<a id="L576" name="L576"></a> 576         <strong class="reserved">if</strong> (tryFirstPass) <em class="brace">{</em>
<a id="L577" name="L577"></a> 577             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L578" name="L578"></a> 578                 <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">true</strong>);
<a id="L579" name="L579"></a> 579                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L580" name="L580"></a> 580                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule] " +
<a id="L581" name="L581"></a> 581                                        "authentication succeeded");
<a id="L582" name="L582"></a> 582                 succeeded = <strong class="reserved">true</strong>;
<a id="L583" name="L583"></a> 583                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L584" name="L584"></a> 584                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L585" name="L585"></a> 585             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L586" name="L586"></a> 586                 <em class="comment">// authentication failed -- try again below by prompting</em>
<a id="L587" name="L587"></a> 587                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L588" name="L588"></a> 588                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L589" name="L589"></a> 589                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule] " +
<a id="L590" name="L590"></a> 590                                        "tryFirstPass failed with:" +
<a id="L591" name="L591"></a> 591                                        le.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L592" name="L592"></a> 592                 <em class="brace">}</em>
<a id="L593" name="L593"></a> 593             <em class="brace">}</em>
<a id="L594" name="L594"></a> 594         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (useFirstPass) <em class="brace">{</em>
<a id="L595" name="L595"></a> 595             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L596" name="L596"></a> 596                 <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">true</strong>);
<a id="L597" name="L597"></a> 597                 succeeded = <strong class="reserved">true</strong>;
<a id="L598" name="L598"></a> 598                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L599" name="L599"></a> 599                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L600" name="L600"></a> 600             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> e) <em class="brace">{</em>
<a id="L601" name="L601"></a> 601                 <em class="comment">// authentication failed -- clean out state</em>
<a id="L602" name="L602"></a> 602                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L603" name="L603"></a> 603                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule] " +
<a id="L604" name="L604"></a> 604                                        "authentication failed \n" +
<a id="L605" name="L605"></a> 605                                        e.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L606" name="L606"></a> 606                 <em class="brace">}</em>
<a id="L607" name="L607"></a> 607                 succeeded = <strong class="reserved">false</strong>;
<a id="L608" name="L608"></a> 608                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L609" name="L609"></a> 609                 <strong class="reserved">throw</strong> e;
<a id="L610" name="L610"></a> 610             <em class="brace">}</em>
<a id="L611" name="L611"></a> 611         <em class="brace">}</em>
<a id="L612" name="L612"></a> 612 
<a id="L613" name="L613"></a> 613         <em class="comment">// attempt the authentication by getting the username and pwd</em>
<a id="L614" name="L614"></a> 614         <em class="comment">// by prompting or configuration i.e. not from shared state</em>
<a id="L615" name="L615"></a> 615 
<a id="L616" name="L616"></a> 616         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L617" name="L617"></a> 617             <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">false</strong>);
<a id="L618" name="L618"></a> 618             succeeded = <strong class="reserved">true</strong>;
<a id="L619" name="L619"></a> 619             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L620" name="L620"></a> 620             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L621" name="L621"></a> 621         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> e) <em class="brace">{</em>
<a id="L622" name="L622"></a> 622             <em class="comment">// authentication failed -- clean out state</em>
<a id="L623" name="L623"></a> 623             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L624" name="L624"></a> 624                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule] " +
<a id="L625" name="L625"></a> 625                                    "authentication failed \n" +
<a id="L626" name="L626"></a> 626                                    e.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L627" name="L627"></a> 627             <em class="brace">}</em>
<a id="L628" name="L628"></a> 628             succeeded = <strong class="reserved">false</strong>;
<a id="L629" name="L629"></a> 629             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L630" name="L630"></a> 630             <strong class="reserved">throw</strong> e;
<a id="L631" name="L631"></a> 631         <em class="brace">}</em>
<a id="L632" name="L632"></a> 632     <em class="brace">}</em>
<div class="comment">
      process the configuration options
      Get the TGT either out of
      cache or from the KDC using the password entered
      Check the  permission before getting the TGT</div>
<a id="L639" name="L639"></a> 639 
<a id="L640" name="L640"></a> 640     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10399.html" title="Multiple referred from 12 places.">attemptAuthentication</a>(<strong class="reserved">boolean</strong> getPasswdFromSharedState)
<a id="L641" name="L641"></a> 641         <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L642" name="L642"></a> 642 
<div class="comment">
          Check the creds cache to see whether
          we have TGT for this client principal</div>
<a id="L647" name="L647"></a> 647         <strong class="reserved">if</strong> (krb5PrincName != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L648" name="L648"></a> 648             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L649" name="L649"></a> 649                 <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> = <strong class="reserved">new</strong> PrincipalName
<a id="L650" name="L650"></a> 650                     (krb5PrincName.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(),
<a id="L651" name="L651"></a> 651                      PrincipalName.KRB_NT_PRINCIPAL);
<a id="L652" name="L652"></a> 652             <em class="brace">}</em> <strong class="reserved">catch</strong> (KrbException e) <em class="brace">{</em>
<a id="L653" name="L653"></a> 653                 <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(e.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L654" name="L654"></a> 654                 le.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(e);
<a id="L655" name="L655"></a> 655                 <strong class="reserved">throw</strong> le;
<a id="L656" name="L656"></a> 656             <em class="brace">}</em>
<a id="L657" name="L657"></a> 657         <em class="brace">}</em>
<a id="L658" name="L658"></a> 658 
<a id="L659" name="L659"></a> 659         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L660" name="L660"></a> 660             <strong class="reserved">if</strong> (useTicketCache) <em class="brace">{</em>
<a id="L661" name="L661"></a> 661                 <em class="comment">// ticketCacheName == null implies the default cache</em>
<a id="L662" name="L662"></a> 662                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L663" name="L663"></a> 663                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Acquire TGT from Cache");
<a id="L664" name="L664"></a> 664                 cred  = Credentials.acquireTGTFromCache
<a id="L665" name="L665"></a> 665                     (<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>, ticketCacheName);
<a id="L666" name="L666"></a> 666 
<a id="L667" name="L667"></a> 667                 <strong class="reserved">if</strong> (cred != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L668" name="L668"></a> 668                     <em class="comment">// check to renew credentials</em>
<a id="L669" name="L669"></a> 669                     <strong class="reserved">if</strong> (!<a href="../D/25382.html" title="Multiple defined in 3 places.">isCurrent</a>(cred)) <em class="brace">{</em>
<a id="L670" name="L670"></a> 670                         <strong class="reserved">if</strong> (renewTGT) <em class="brace">{</em>
<a id="L671" name="L671"></a> 671                             cred = <a href="../S/4497.html#L996" title="Defined at 996 in src/com/sun/security/auth/module/Krb5LoginModule.java.">renewCredentials</a>(cred);
<a id="L672" name="L672"></a> 672                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L673" name="L673"></a> 673                             <em class="comment">// credentials have expired</em>
<a id="L674" name="L674"></a> 674                             cred = <strong class="reserved">null</strong>;
<a id="L675" name="L675"></a> 675                             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L676" name="L676"></a> 676                                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Credentials are" +
<a id="L677" name="L677"></a> 677                                                 " no longer valid");
<a id="L678" name="L678"></a> 678                         <em class="brace">}</em>
<a id="L679" name="L679"></a> 679                     <em class="brace">}</em>
<a id="L680" name="L680"></a> 680                 <em class="brace">}</em>
<a id="L681" name="L681"></a> 681 
<a id="L682" name="L682"></a> 682                 <strong class="reserved">if</strong> (cred != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L683" name="L683"></a> 683                    <em class="comment">// get the principal name from the ticket cache</em>
<a id="L684" name="L684"></a> 684                    <strong class="reserved">if</strong> (<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L685" name="L685"></a> 685                         <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> = cred.<a href="../S/2634.html#L335" title="Defined at 335 in src/javax/security/auth/kerberos/KerberosTicket.java.">getClient</a>();
<a id="L686" name="L686"></a> 686                    <em class="brace">}</em>
<a id="L687" name="L687"></a> 687                 <em class="brace">}</em>
<a id="L688" name="L688"></a> 688                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L689" name="L689"></a> 689                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Principal is " + <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>);
<a id="L690" name="L690"></a> 690                     <strong class="reserved">if</strong> (cred == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L691" name="L691"></a> 691                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L692" name="L692"></a> 692                             ("null credentials from Ticket Cache");
<a id="L693" name="L693"></a> 693                     <em class="brace">}</em>
<a id="L694" name="L694"></a> 694                 <em class="brace">}</em>
<a id="L695" name="L695"></a> 695             <em class="brace">}</em>
<a id="L696" name="L696"></a> 696 
<a id="L697" name="L697"></a> 697             <em class="comment">// cred = null indicates that we didn't get the creds</em>
<a id="L698" name="L698"></a> 698             <em class="comment">// from the cache or useTicketCache was false</em>
<a id="L699" name="L699"></a> 699 
<a id="L700" name="L700"></a> 700             <strong class="reserved">if</strong> (cred == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L701" name="L701"></a> 701                 <em class="comment">// We need the principal name whether we use keytab</em>
<a id="L702" name="L702"></a> 702                 <em class="comment">// or AS Exchange</em>
<a id="L703" name="L703"></a> 703                 <strong class="reserved">if</strong> (<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L704" name="L704"></a> 704                     <a href="../S/4497.html#L814" title="Defined at 814 in src/com/sun/security/auth/module/Krb5LoginModule.java.">promptForName</a>(getPasswdFromSharedState);
<a id="L705" name="L705"></a> 705                     <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> = <strong class="reserved">new</strong> PrincipalName
<a id="L706" name="L706"></a> 706                         (krb5PrincName.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(),
<a id="L707" name="L707"></a> 707                          PrincipalName.KRB_NT_PRINCIPAL);
<a id="L708" name="L708"></a> 708                 <em class="brace">}</em>
<a id="L709" name="L709"></a> 709 
<div class="comment">
                  Before dynamic KeyTab support (6894072), here we check if
                  the keytab contains keys for the principal. If no, keytab
                  will not be used and password is prompted for.
                  After 6894072, we normally don't check it, and expect the
                  keys can be populated until a real connection is made. The
                  check is still done when isInitiator == true, where the keys
                  will be used right now.
                  Probably tricky relations:
                  useKeyTab is config flag, but when it's true but the ktab
                  does not contains keys for principal, we would use password
                  and keep the flag unchanged (for reuse?). In this method,
                  we use (ktab != null) to check whether keytab is used.
                  After this method (and when storeKey == true), we use
                  (encKeys == null) to check.</div>
<a id="L729" name="L729"></a> 729                 <strong class="reserved">if</strong> (useKeyTab) <em class="brace">{</em>
<a id="L730" name="L730"></a> 730                     <strong class="reserved">if</strong> (!unboundServer) <em class="brace">{</em>
<a id="L731" name="L731"></a> 731                         <a href="../S/2636.html#L41" title="Defined at 41 in src/javax/security/auth/kerberos/KerberosPrincipal.java.">KerberosPrincipal</a> kp =
<a id="L732" name="L732"></a> 732                                 <strong class="reserved">new</strong> <a href="../S/2636.html#L41" title="Defined at 41 in src/javax/security/auth/kerberos/KerberosPrincipal.java.">KerberosPrincipal</a>(<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L733" name="L733"></a> 733                         ktab = (keyTabName == <strong class="reserved">null</strong>)
<a id="L734" name="L734"></a> 734                                 ? <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a>.<a href="../D/19762.html" title="Multiple defined in 157 places.">getInstance</a>(kp)
<a id="L735" name="L735"></a> 735                                 : <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a>.<a href="../D/19762.html" title="Multiple defined in 157 places.">getInstance</a>(kp, <strong class="reserved">new</strong> <a href="../S/1433.html#L149" title="Defined at 149 in src/java/io/File.java.">File</a>(keyTabName));
<a id="L736" name="L736"></a> 736                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L737" name="L737"></a> 737                         ktab = (keyTabName == <strong class="reserved">null</strong>)
<a id="L738" name="L738"></a> 738                                 ? <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a>.<a href="../D/23394.html" title="Multiple defined in 2 places.">getUnboundInstance</a>()
<a id="L739" name="L739"></a> 739                                 : <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a>.<a href="../D/23394.html" title="Multiple defined in 2 places.">getUnboundInstance</a>(<strong class="reserved">new</strong> <a href="../S/1433.html#L149" title="Defined at 149 in src/java/io/File.java.">File</a>(keyTabName));
<a id="L740" name="L740"></a> 740                     <em class="brace">}</em>
<a id="L741" name="L741"></a> 741                     <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>) <em class="brace">{</em>
<a id="L742" name="L742"></a> 742                         <strong class="reserved">if</strong> (Krb5Util.keysFromJavaxKeyTab(ktab, <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>).<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>
<a id="L743" name="L743"></a> 743                                 == 0) <em class="brace">{</em>
<a id="L744" name="L744"></a> 744                             ktab = <strong class="reserved">null</strong>;
<a id="L745" name="L745"></a> 745                             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L746" name="L746"></a> 746                                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L747" name="L747"></a> 747                                     ("Key for the principal " +
<a id="L748" name="L748"></a> 748                                      <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>  +
<a id="L749" name="L749"></a> 749                                      " not available in " +
<a id="L750" name="L750"></a> 750                                      ((keyTabName == <strong class="reserved">null</strong>) ?
<a id="L751" name="L751"></a> 751                                       "default key tab" : keyTabName));
<a id="L752" name="L752"></a> 752                             <em class="brace">}</em>
<a id="L753" name="L753"></a> 753                         <em class="brace">}</em>
<a id="L754" name="L754"></a> 754                     <em class="brace">}</em>
<a id="L755" name="L755"></a> 755                 <em class="brace">}</em>
<a id="L756" name="L756"></a> 756 
<a id="L757" name="L757"></a> 757                 KrbAsReqBuilder <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a>;
<a id="L758" name="L758"></a> 758 
<a id="L759" name="L759"></a> 759                 <strong class="reserved">if</strong> (ktab == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L760" name="L760"></a> 760                     <a href="../S/4497.html#L876" title="Defined at 876 in src/com/sun/security/auth/module/Krb5LoginModule.java.">promptForPass</a>(getPasswdFromSharedState);
<a id="L761" name="L761"></a> 761                     <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a> = <strong class="reserved">new</strong> KrbAsReqBuilder(<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>, password);
<a id="L762" name="L762"></a> 762                     <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>) <em class="brace">{</em>
<a id="L763" name="L763"></a> 763                         <em class="comment">// XXX Even if isInitiator=false, it might be</em>
<a id="L764" name="L764"></a> 764                         <em class="comment">// better to do an AS-REQ so that keys can be</em>
<a id="L765" name="L765"></a> 765                         <em class="comment">// updated with PA info</em>
<a id="L766" name="L766"></a> 766                         cred = <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a>.<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>().getCreds();
<a id="L767" name="L767"></a> 767                     <em class="brace">}</em>
<a id="L768" name="L768"></a> 768                     <strong class="reserved">if</strong> (storeKey) <em class="brace">{</em>
<a id="L769" name="L769"></a> 769                         encKeys = <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a>.<a href="../D/19965.html" title="Multiple defined in 6 places.">getKeys</a>(<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>);
<a id="L770" name="L770"></a> 770                         <em class="comment">// When encKeys is empty, the login actually fails.</em>
<a id="L771" name="L771"></a> 771                         <em class="comment">// For compatibility, exception is thrown in commit().</em>
<a id="L772" name="L772"></a> 772                     <em class="brace">}</em>
<a id="L773" name="L773"></a> 773                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L774" name="L774"></a> 774                     <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a> = <strong class="reserved">new</strong> KrbAsReqBuilder(<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>, ktab);
<a id="L775" name="L775"></a> 775                     <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>) <em class="brace">{</em>
<a id="L776" name="L776"></a> 776                         cred = <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a>.<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>().getCreds();
<a id="L777" name="L777"></a> 777                     <em class="brace">}</em>
<a id="L778" name="L778"></a> 778                 <em class="brace">}</em>
<a id="L779" name="L779"></a> 779                 <a href="../D/11979.html" title="Multiple defined in 6 places.">builder</a>.<a href="../D/14870.html" title="Multiple defined in 55 places.">destroy</a>();
<a id="L780" name="L780"></a> 780 
<a id="L781" name="L781"></a> 781                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L782" name="L782"></a> 782                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("principal is " + <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>);
<a id="L783" name="L783"></a> 783                     HexDumpEncoder hd = <strong class="reserved">new</strong> HexDumpEncoder();
<a id="L784" name="L784"></a> 784                     <strong class="reserved">if</strong> (ktab != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L785" name="L785"></a> 785                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Will use keytab");
<a id="L786" name="L786"></a> 786                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (storeKey) <em class="brace">{</em>
<a id="L787" name="L787"></a> 787                         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; encKeys.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L788" name="L788"></a> 788                             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("EncryptionKey: keyType=" +
<a id="L789" name="L789"></a> 789                                 encKeys[i].getEType() +
<a id="L790" name="L790"></a> 790                                 " keyBytes (hex dump)=" +
<a id="L791" name="L791"></a> 791                                 hd.encodeBuffer(encKeys[i].<a href="../D/17415.html" title="Multiple defined in 35 places.">getBytes</a>()));
<a id="L792" name="L792"></a> 792                         <em class="brace">}</em>
<a id="L793" name="L793"></a> 793                     <em class="brace">}</em>
<a id="L794" name="L794"></a> 794                 <em class="brace">}</em>
<a id="L795" name="L795"></a> 795 
<a id="L796" name="L796"></a> 796                 <em class="comment">// we should hava a non-null cred</em>
<a id="L797" name="L797"></a> 797                 <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a> &amp;&amp; (cred == <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L798" name="L798"></a> 798                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L799" name="L799"></a> 799                         ("TGT Can not be obtained from the KDC ");
<a id="L800" name="L800"></a> 800                 <em class="brace">}</em>
<a id="L801" name="L801"></a> 801 
<a id="L802" name="L802"></a> 802             <em class="brace">}</em>
<a id="L803" name="L803"></a> 803         <em class="brace">}</em> <strong class="reserved">catch</strong> (KrbException e) <em class="brace">{</em>
<a id="L804" name="L804"></a> 804             <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(e.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L805" name="L805"></a> 805             le.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(e);
<a id="L806" name="L806"></a> 806             <strong class="reserved">throw</strong> le;
<a id="L807" name="L807"></a> 807         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> ioe) <em class="brace">{</em>
<a id="L808" name="L808"></a> 808             <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> ie = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(ioe.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L809" name="L809"></a> 809             ie.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(ioe);
<a id="L810" name="L810"></a> 810             <strong class="reserved">throw</strong> ie;
<a id="L811" name="L811"></a> 811         <em class="brace">}</em>
<a id="L812" name="L812"></a> 812     <em class="brace">}</em>
<a id="L813" name="L813"></a> 813 
<a id="L814" name="L814"></a> 814     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/4497.html#L704" title="Referred from 704 in src/com/sun/security/auth/module/Krb5LoginModule.java.">promptForName</a>(<strong class="reserved">boolean</strong> getPasswdFromSharedState)
<a id="L815" name="L815"></a> 815         <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L816" name="L816"></a> 816         krb5PrincName = <strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>("");
<a id="L817" name="L817"></a> 817         <strong class="reserved">if</strong> (getPasswdFromSharedState) <em class="brace">{</em>
<a id="L818" name="L818"></a> 818             <em class="comment">// use the name saved by the first module in the stack</em>
<a id="L819" name="L819"></a> 819             username = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)sharedState.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(NAME);
<a id="L820" name="L820"></a> 820             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L821" name="L821"></a> 821                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L822" name="L822"></a> 822                     ("username from shared state is " + username + "\n");
<a id="L823" name="L823"></a> 823             <em class="brace">}</em>
<a id="L824" name="L824"></a> 824             <strong class="reserved">if</strong> (username == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L825" name="L825"></a> 825                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L826" name="L826"></a> 826                     ("username from shared state is null\n");
<a id="L827" name="L827"></a> 827                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L828" name="L828"></a> 828                     ("Username can not be obtained from sharedstate ");
<a id="L829" name="L829"></a> 829             <em class="brace">}</em>
<a id="L830" name="L830"></a> 830             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L831" name="L831"></a> 831                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L832" name="L832"></a> 832                     ("username from shared state is " + username + "\n");
<a id="L833" name="L833"></a> 833             <em class="brace">}</em>
<a id="L834" name="L834"></a> 834             <strong class="reserved">if</strong> (username != <strong class="reserved">null</strong> &amp;&amp; username.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 0) <em class="brace">{</em>
<a id="L835" name="L835"></a> 835                 krb5PrincName.<a href="../D/24721.html" title="Multiple defined in 265 places.">insert</a>(0, username);
<a id="L836" name="L836"></a> 836                 <strong class="reserved">return</strong>;
<a id="L837" name="L837"></a> 837             <em class="brace">}</em>
<a id="L838" name="L838"></a> 838         <em class="brace">}</em>
<a id="L839" name="L839"></a> 839 
<a id="L840" name="L840"></a> 840         <strong class="reserved">if</strong> (doNotPrompt) <em class="brace">{</em>
<a id="L841" name="L841"></a> 841             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L842" name="L842"></a> 842                 ("Unable to obtain Principal Name for authentication ");
<a id="L843" name="L843"></a> 843         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L844" name="L844"></a> 844             <strong class="reserved">if</strong> (callbackHandler == <strong class="reserved">null</strong>)
<a id="L845" name="L845"></a> 845                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("No CallbackHandler "
<a id="L846" name="L846"></a> 846                                          + "available "
<a id="L847" name="L847"></a> 847                                          + "to garner authentication "
<a id="L848" name="L848"></a> 848                                          + "information from the user");
<a id="L849" name="L849"></a> 849             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L850" name="L850"></a> 850                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> defUsername = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>("user.name");
<a id="L851" name="L851"></a> 851 
<a id="L852" name="L852"></a> 852                 <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[] callbacks = <strong class="reserved">new</strong> <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[1];
<a id="L853" name="L853"></a> 853                 <a href="../S/2460.html#L344" title="Defined at 344 in src/java/text/MessageFormat.java.">MessageFormat</a> <a href="../S/1616.html#L125" title="Defined at 125 in src/java/lang/invoke/MethodType.java.">form</a> = <strong class="reserved">new</strong> <a href="../S/2460.html#L344" title="Defined at 344 in src/java/text/MessageFormat.java.">MessageFormat</a>(
<a id="L854" name="L854"></a> 854                                        rb.<a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(
<a id="L855" name="L855"></a> 855                                        "Kerberos.username.defUsername."));
<a id="L856" name="L856"></a> 856                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a> =  <em class="brace">{</em>defUsername<em class="brace">}</em>;
<a id="L857" name="L857"></a> 857                 callbacks[0] = <strong class="reserved">new</strong> <a href="../S/2650.html#L35" title="Defined at 35 in src/javax/security/auth/callback/NameCallback.java.">NameCallback</a>(<a href="../S/1616.html#L125" title="Defined at 125 in src/java/lang/invoke/MethodType.java.">form</a>.<a href="../D/16531.html" title="Multiple defined in 87 places.">format</a>(<a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>));
<a id="L858" name="L858"></a> 858                 callbackHandler.<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>(callbacks);
<a id="L859" name="L859"></a> 859                 username = ((<a href="../S/2650.html#L35" title="Defined at 35 in src/javax/security/auth/callback/NameCallback.java.">NameCallback</a>)callbacks[0]).<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L860" name="L860"></a> 860                 <strong class="reserved">if</strong> (username == <strong class="reserved">null</strong> || username.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 0)
<a id="L861" name="L861"></a> 861                     username = defUsername;
<a id="L862" name="L862"></a> 862                 krb5PrincName.<a href="../D/24721.html" title="Multiple defined in 265 places.">insert</a>(0, username);
<a id="L863" name="L863"></a> 863 
<a id="L864" name="L864"></a> 864             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> ioe) <em class="brace">{</em>
<a id="L865" name="L865"></a> 865                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(ioe.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L866" name="L866"></a> 866             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2652.html#L33" title="Defined at 33 in src/javax/security/auth/callback/UnsupportedCallbackException.java.">UnsupportedCallbackException</a> uce) <em class="brace">{</em>
<a id="L867" name="L867"></a> 867                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L868" name="L868"></a> 868                     (uce.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>()
<a id="L869" name="L869"></a> 869                      +" not available to garner "
<a id="L870" name="L870"></a> 870                      +" authentication information "
<a id="L871" name="L871"></a> 871                      +" from the user");
<a id="L872" name="L872"></a> 872             <em class="brace">}</em>
<a id="L873" name="L873"></a> 873         <em class="brace">}</em>
<a id="L874" name="L874"></a> 874     <em class="brace">}</em>
<a id="L875" name="L875"></a> 875 
<a id="L876" name="L876"></a> 876     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/4497.html#L760" title="Referred from 760 in src/com/sun/security/auth/module/Krb5LoginModule.java.">promptForPass</a>(<strong class="reserved">boolean</strong> getPasswdFromSharedState)
<a id="L877" name="L877"></a> 877         <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L878" name="L878"></a> 878 
<a id="L879" name="L879"></a> 879         <strong class="reserved">if</strong> (getPasswdFromSharedState) <em class="brace">{</em>
<a id="L880" name="L880"></a> 880             <em class="comment">// use the password saved by the first module in the stack</em>
<a id="L881" name="L881"></a> 881             password = (<strong class="reserved">char</strong>[])sharedState.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(PWD);
<a id="L882" name="L882"></a> 882             <strong class="reserved">if</strong> (password == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L883" name="L883"></a> 883                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L884" name="L884"></a> 884                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L885" name="L885"></a> 885                         ("Password from shared state is null");
<a id="L886" name="L886"></a> 886                 <em class="brace">}</em>
<a id="L887" name="L887"></a> 887                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L888" name="L888"></a> 888                     ("Password can not be obtained from sharedstate ");
<a id="L889" name="L889"></a> 889             <em class="brace">}</em>
<a id="L890" name="L890"></a> 890             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L891" name="L891"></a> 891                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>
<a id="L892" name="L892"></a> 892                     ("password is " + <strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>(password));
<a id="L893" name="L893"></a> 893             <em class="brace">}</em>
<a id="L894" name="L894"></a> 894             <strong class="reserved">return</strong>;
<a id="L895" name="L895"></a> 895         <em class="brace">}</em>
<a id="L896" name="L896"></a> 896         <strong class="reserved">if</strong> (doNotPrompt) <em class="brace">{</em>
<a id="L897" name="L897"></a> 897             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L898" name="L898"></a> 898                 ("Unable to obtain password from user\n");
<a id="L899" name="L899"></a> 899         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L900" name="L900"></a> 900             <strong class="reserved">if</strong> (callbackHandler == <strong class="reserved">null</strong>)
<a id="L901" name="L901"></a> 901                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("No CallbackHandler "
<a id="L902" name="L902"></a> 902                                          + "available "
<a id="L903" name="L903"></a> 903                                          + "to garner authentication "
<a id="L904" name="L904"></a> 904                                          + "information from the user");
<a id="L905" name="L905"></a> 905             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L906" name="L906"></a> 906                 <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[] callbacks = <strong class="reserved">new</strong> <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[1];
<a id="L907" name="L907"></a> 907                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> userName = krb5PrincName.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L908" name="L908"></a> 908                 <a href="../S/2460.html#L344" title="Defined at 344 in src/java/text/MessageFormat.java.">MessageFormat</a> <a href="../S/1616.html#L125" title="Defined at 125 in src/java/lang/invoke/MethodType.java.">form</a> = <strong class="reserved">new</strong> <a href="../S/2460.html#L344" title="Defined at 344 in src/java/text/MessageFormat.java.">MessageFormat</a>(
<a id="L909" name="L909"></a> 909                                          rb.<a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>(
<a id="L910" name="L910"></a> 910                                          "Kerberos.password.for.username."));
<a id="L911" name="L911"></a> 911                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a> = <em class="brace">{</em>userName<em class="brace">}</em>;
<a id="L912" name="L912"></a> 912                 callbacks[0] = <strong class="reserved">new</strong> <a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>(
<a id="L913" name="L913"></a> 913                                                     <a href="../S/1616.html#L125" title="Defined at 125 in src/java/lang/invoke/MethodType.java.">form</a>.<a href="../D/16531.html" title="Multiple defined in 87 places.">format</a>(<a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>),
<a id="L914" name="L914"></a> 914                                                     <strong class="reserved">false</strong>);
<a id="L915" name="L915"></a> 915                 callbackHandler.<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>(callbacks);
<a id="L916" name="L916"></a> 916                 <strong class="reserved">char</strong>[] tmpPassword = ((<a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>)
<a id="L917" name="L917"></a> 917                                       callbacks[0]).<a href="../D/21429.html" title="Multiple defined in 6 places.">getPassword</a>();
<a id="L918" name="L918"></a> 918                 <strong class="reserved">if</strong> (tmpPassword == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L919" name="L919"></a> 919                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("No password provided");
<a id="L920" name="L920"></a> 920                 <em class="brace">}</em>
<a id="L921" name="L921"></a> 921                 password = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L922" name="L922"></a> 922                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmpPassword, 0,
<a id="L923" name="L923"></a> 923                                  password, 0, tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L924" name="L924"></a> 924                 ((<a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>)callbacks[0]).<a href="../S/2651.html#L136" title="Defined at 136 in src/javax/security/auth/callback/PasswordCallback.java.">clearPassword</a>();
<a id="L925" name="L925"></a> 925 
<a id="L926" name="L926"></a> 926 
<a id="L927" name="L927"></a> 927                 <em class="comment">// clear tmpPassword</em>
<a id="L928" name="L928"></a> 928                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)
<a id="L929" name="L929"></a> 929                     tmpPassword[i] = ' ';
<a id="L930" name="L930"></a> 930                 tmpPassword = <strong class="reserved">null</strong>;
<a id="L931" name="L931"></a> 931                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L932" name="L932"></a> 932                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule] " +
<a id="L933" name="L933"></a> 933                                        "user entered username: " +
<a id="L934" name="L934"></a> 934                                        krb5PrincName);
<a id="L935" name="L935"></a> 935                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>();
<a id="L936" name="L936"></a> 936                 <em class="brace">}</em>
<a id="L937" name="L937"></a> 937             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> ioe) <em class="brace">{</em>
<a id="L938" name="L938"></a> 938                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(ioe.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L939" name="L939"></a> 939             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2652.html#L33" title="Defined at 33 in src/javax/security/auth/callback/UnsupportedCallbackException.java.">UnsupportedCallbackException</a> uce) <em class="brace">{</em>
<a id="L940" name="L940"></a> 940                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(uce.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>()
<a id="L941" name="L941"></a> 941                                          +" not available to garner "
<a id="L942" name="L942"></a> 942                                          +" authentication information "
<a id="L943" name="L943"></a> 943                                          + "from the user");
<a id="L944" name="L944"></a> 944             <em class="brace">}</em>
<a id="L945" name="L945"></a> 945         <em class="brace">}</em>
<a id="L946" name="L946"></a> 946     <em class="brace">}</em>
<a id="L947" name="L947"></a> 947 
<a id="L948" name="L948"></a> 948     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/4497.html#L570" title="Referred from 570 in src/com/sun/security/auth/module/Krb5LoginModule.java.">validateConfiguration</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L949" name="L949"></a> 949         <strong class="reserved">if</strong> (doNotPrompt &amp;&amp; !useTicketCache &amp;&amp; !useKeyTab
<a id="L950" name="L950"></a> 950                 &amp;&amp; !tryFirstPass &amp;&amp; !useFirstPass)
<a id="L951" name="L951"></a> 951             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L952" name="L952"></a> 952                 ("Configuration Error"
<a id="L953" name="L953"></a> 953                  + " - either doNotPrompt should be "
<a id="L954" name="L954"></a> 954                  + " false or at least one of useTicketCache, "
<a id="L955" name="L955"></a> 955                  + " useKeyTab, tryFirstPass and useFirstPass"
<a id="L956" name="L956"></a> 956                  + " should be true");
<a id="L957" name="L957"></a> 957         <strong class="reserved">if</strong> (ticketCacheName != <strong class="reserved">null</strong> &amp;&amp; !useTicketCache)
<a id="L958" name="L958"></a> 958             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L959" name="L959"></a> 959                 ("Configuration Error "
<a id="L960" name="L960"></a> 960                  + " - useTicketCache should be set "
<a id="L961" name="L961"></a> 961                  + "to true to use the ticket cache"
<a id="L962" name="L962"></a> 962                  + ticketCacheName);
<a id="L963" name="L963"></a> 963         <strong class="reserved">if</strong> (keyTabName != <strong class="reserved">null</strong> &amp; !useKeyTab)
<a id="L964" name="L964"></a> 964             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L965" name="L965"></a> 965                 ("Configuration Error - useKeyTab should be set to true "
<a id="L966" name="L966"></a> 966                  + "to use the keytab" + keyTabName);
<a id="L967" name="L967"></a> 967         <strong class="reserved">if</strong> (storeKey &amp;&amp; doNotPrompt &amp;&amp; !useKeyTab
<a id="L968" name="L968"></a> 968                 &amp;&amp; !tryFirstPass &amp;&amp; !useFirstPass)
<a id="L969" name="L969"></a> 969             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L970" name="L970"></a> 970                 ("Configuration Error - either doNotPrompt should be set to "
<a id="L971" name="L971"></a> 971                  + " false or at least one of tryFirstPass, useFirstPass "
<a id="L972" name="L972"></a> 972                  + "or useKeyTab must be set to true for storeKey option");
<a id="L973" name="L973"></a> 973         <strong class="reserved">if</strong> (renewTGT &amp;&amp; !useTicketCache)
<a id="L974" name="L974"></a> 974             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L975" name="L975"></a> 975                 ("Configuration Error"
<a id="L976" name="L976"></a> 976                  + " - either useTicketCache should be "
<a id="L977" name="L977"></a> 977                  + " true or renewTGT should be false");
<a id="L978" name="L978"></a> 978         <strong class="reserved">if</strong> (krb5PrincName != <strong class="reserved">null</strong> &amp;&amp; krb5PrincName.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("*")) <em class="brace">{</em>
<a id="L979" name="L979"></a> 979             <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>) <em class="brace">{</em>
<a id="L980" name="L980"></a> 980                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L981" name="L981"></a> 981                     ("Configuration Error"
<a id="L982" name="L982"></a> 982                     + " - principal cannot be * when isInitiator is true");
<a id="L983" name="L983"></a> 983             <em class="brace">}</em>
<a id="L984" name="L984"></a> 984         <em class="brace">}</em>
<a id="L985" name="L985"></a> 985     <em class="brace">}</em>
<a id="L986" name="L986"></a> 986 
<a id="L987" name="L987"></a> 987     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/4497.html#L669" title="Referred from 669 in src/com/sun/security/auth/module/Krb5LoginModule.java.">isCurrent</a>(Credentials creds)
<a id="L988" name="L988"></a> 988     <em class="brace">{</em>
<a id="L989" name="L989"></a> 989         <a href="../D/2208.html" title="Multiple defined in 2 places.">Date</a> endTime = creds.<a href="../S/2634.html#L481" title="Defined at 481 in src/javax/security/auth/kerberos/KerberosTicket.java.">getEndTime</a>();
<a id="L990" name="L990"></a> 990         <strong class="reserved">if</strong> (endTime != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L991" name="L991"></a> 991             <strong class="reserved">return</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>() &lt;= endTime.<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>());
<a id="L992" name="L992"></a> 992         <em class="brace">}</em>
<a id="L993" name="L993"></a> 993         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L994" name="L994"></a> 994     <em class="brace">}</em>
<a id="L995" name="L995"></a> 995 
<a id="L996" name="L996"></a> 996     <strong class="reserved">private</strong> Credentials <a href="../S/4497.html#L671" title="Referred from 671 in src/com/sun/security/auth/module/Krb5LoginModule.java.">renewCredentials</a>(Credentials creds)
<a id="L997" name="L997"></a> 997     <em class="brace">{</em>
<a id="L998" name="L998"></a> 998         Credentials lcreds;
<a id="L999" name="L999"></a> 999         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1000" name="L1000"></a>1000             <strong class="reserved">if</strong> (!creds.<a href="../S/2634.html#L430" title="Defined at 430 in src/javax/security/auth/kerberos/KerberosTicket.java.">isRenewable</a>())
<a id="L1001" name="L1001"></a>1001                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2640.html#L36" title="Defined at 36 in src/javax/security/auth/RefreshFailedException.java.">RefreshFailedException</a>("This ticket" +
<a id="L1002" name="L1002"></a>1002                                 " is not renewable");
<a id="L1003" name="L1003"></a>1003             <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>() &gt; cred.<a href="../S/2634.html#L491" title="Defined at 491 in src/javax/security/auth/kerberos/KerberosTicket.java.">getRenewTill</a>().<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>())
<a id="L1004" name="L1004"></a>1004                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2640.html#L36" title="Defined at 36 in src/javax/security/auth/RefreshFailedException.java.">RefreshFailedException</a>("This ticket is past "
<a id="L1005" name="L1005"></a>1005                                              + "its last renewal time.");
<a id="L1006" name="L1006"></a>1006             lcreds = creds.renew();
<a id="L1007" name="L1007"></a>1007             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L1008" name="L1008"></a>1008                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Renewed Kerberos Ticket");
<a id="L1009" name="L1009"></a>1009         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L1010" name="L1010"></a>1010             lcreds = <strong class="reserved">null</strong>;
<a id="L1011" name="L1011"></a>1011             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L1012" name="L1012"></a>1012                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Ticket could not be renewed : "
<a id="L1013" name="L1013"></a>1013                                 + e.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>());
<a id="L1014" name="L1014"></a>1014         <em class="brace">}</em>
<a id="L1015" name="L1015"></a>1015         <strong class="reserved">return</strong> lcreds;
<a id="L1016" name="L1016"></a>1016     <em class="brace">}</em>
<a id="L1017" name="L1017"></a>1017 
<div class="comment">
      <p> This method is called if the LoginContext's
      overall authentication succeeded
      (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
      LoginModules succeeded).
      </p><p> If this LoginModule's own authentication attempt
      succeeded (checked by retrieving the private state saved by the
      <code>login</code> method), then this method associates a
      <code>Krb5Principal</code>
      with the <code>Subject</code> located in the
      <code>LoginModule</code>. It adds Kerberos Credentials to the
       the Subject's private credentials set. If this LoginModule's own
      authentication attempted failed, then this method removes
      any state that was originally saved.
      </p><p>
      @exception LoginException if the commit fails.
      @return true if this LoginModule's own login and commit
               attempts succeeded, or false otherwise.</p></div>
<a id="L1041" name="L1041"></a>1041 
<a id="L1042" name="L1042"></a>1042     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/11674.html" title="Multiple referred from 3 places.">commit</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L1043" name="L1043"></a>1043 
<div class="comment">
          Let us add the Krb5 Creds to the Subject's
          private credentials. The credentials are of type
          KerberosKey or KerberosTicket</div>
<a id="L1049" name="L1049"></a>1049         <strong class="reserved">if</strong> (succeeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L1050" name="L1050"></a>1050             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1051" name="L1051"></a>1051         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1052" name="L1052"></a>1052 
<a id="L1053" name="L1053"></a>1053             <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a> &amp;&amp; (cred == <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1054" name="L1054"></a>1054                 succeeded = <strong class="reserved">false</strong>;
<a id="L1055" name="L1055"></a>1055                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Null Client Credential");
<a id="L1056" name="L1056"></a>1056             <em class="brace">}</em>
<a id="L1057" name="L1057"></a>1057 
<a id="L1058" name="L1058"></a>1058             <strong class="reserved">if</strong> (subject.<a href="../D/26131.html" title="Multiple defined in 90 places.">isReadOnly</a>()) <em class="brace">{</em>
<a id="L1059" name="L1059"></a>1059                 <a href="../S/4497.html#L1231" title="Defined at 1231 in src/com/sun/security/auth/module/Krb5LoginModule.java.">cleanKerberosCred</a>();
<a id="L1060" name="L1060"></a>1060                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Subject is Readonly");
<a id="L1061" name="L1061"></a>1061             <em class="brace">}</em>
<a id="L1062" name="L1062"></a>1062 
<div class="comment">
              Add the Principal (authenticated identity)
              to the Subject's principal set and
              add the credentials (TGT or Service key) to the
              Subject's private credentials</div>
<a id="L1069" name="L1069"></a>1069 
<a id="L1070" name="L1070"></a>1070             <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt; privCredSet =  subject.<a href="../D/21680.html" title="Multiple defined in 2 places.">getPrivateCredentials</a>();
<a id="L1071" name="L1071"></a>1071             <a href="../S/1160.html#L85" title="Defined at 85 in src/java/util/Set.java.">Set</a>&lt;<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.security.<a href="../D/6815.html" title="Multiple defined in 2 places.">Principal</a>&gt; princSet  = subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>();
<a id="L1072" name="L1072"></a>1072             kerbClientPrinc = <strong class="reserved">new</strong> <a href="../S/2636.html#L41" title="Defined at 41 in src/javax/security/auth/kerberos/KerberosPrincipal.java.">KerberosPrincipal</a>(<a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a>.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L1073" name="L1073"></a>1073 
<a id="L1074" name="L1074"></a>1074             <em class="comment">// create Kerberos Ticket</em>
<a id="L1075" name="L1075"></a>1075             <strong class="reserved">if</strong> (<a href="../S/701.html#L1346" title="Defined at 1346 in src/org/ietf/jgss/GSSContext.java.">isInitiator</a>) <em class="brace">{</em>
<a id="L1076" name="L1076"></a>1076                 kerbTicket = Krb5Util.credsToTicket(cred);
<a id="L1077" name="L1077"></a>1077             <em class="brace">}</em>
<a id="L1078" name="L1078"></a>1078 
<a id="L1079" name="L1079"></a>1079             <strong class="reserved">if</strong> (storeKey &amp;&amp; encKeys != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1080" name="L1080"></a>1080                 <strong class="reserved">if</strong> (encKeys.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 0) <em class="brace">{</em>
<a id="L1081" name="L1081"></a>1081                     succeeded = <strong class="reserved">false</strong>;
<a id="L1082" name="L1082"></a>1082                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Null Server Key ");
<a id="L1083" name="L1083"></a>1083                 <em class="brace">}</em>
<a id="L1084" name="L1084"></a>1084 
<a id="L1085" name="L1085"></a>1085                 kerbKeys = <strong class="reserved">new</strong> <a href="../S/2631.html#L60" title="Defined at 60 in src/javax/security/auth/kerberos/KerberosKey.java.">KerberosKey</a>[encKeys.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L1086" name="L1086"></a>1086                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; encKeys.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i ++) <em class="brace">{</em>
<a id="L1087" name="L1087"></a>1087                     <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a> temp = encKeys[i].getKeyVersionNumber();
<a id="L1088" name="L1088"></a>1088                     kerbKeys[i] = <strong class="reserved">new</strong> <a href="../S/2631.html#L60" title="Defined at 60 in src/javax/security/auth/kerberos/KerberosKey.java.">KerberosKey</a>(kerbClientPrinc,
<a id="L1089" name="L1089"></a>1089                                           encKeys[i].<a href="../D/17415.html" title="Multiple defined in 35 places.">getBytes</a>(),
<a id="L1090" name="L1090"></a>1090                                           encKeys[i].getEType(),
<a id="L1091" name="L1091"></a>1091                                           (temp == <strong class="reserved">null</strong>?
<a id="L1092" name="L1092"></a>1092                                           0: temp.<a href="../D/24897.html" title="Multiple defined in 21 places.">intValue</a>()));
<a id="L1093" name="L1093"></a>1093                 <em class="brace">}</em>
<a id="L1094" name="L1094"></a>1094 
<a id="L1095" name="L1095"></a>1095             <em class="brace">}</em>
<a id="L1096" name="L1096"></a>1096             <em class="comment">// Let us add the kerbClientPrinc,kerbTicket and KeyTab/KerbKey (if</em>
<a id="L1097" name="L1097"></a>1097             <em class="comment">// storeKey is true)</em>
<a id="L1098" name="L1098"></a>1098 
<a id="L1099" name="L1099"></a>1099             <em class="comment">// We won't add "*" as a KerberosPrincipal</em>
<a id="L1100" name="L1100"></a>1100             <strong class="reserved">if</strong> (!unboundServer &amp;&amp;
<a id="L1101" name="L1101"></a>1101                     !princSet.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(kerbClientPrinc)) <em class="brace">{</em>
<a id="L1102" name="L1102"></a>1102                 princSet.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(kerbClientPrinc);
<a id="L1103" name="L1103"></a>1103             <em class="brace">}</em>
<a id="L1104" name="L1104"></a>1104 
<a id="L1105" name="L1105"></a>1105             <em class="comment">// add the TGT</em>
<a id="L1106" name="L1106"></a>1106             <strong class="reserved">if</strong> (kerbTicket != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1107" name="L1107"></a>1107                 <strong class="reserved">if</strong> (!privCredSet.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(kerbTicket))
<a id="L1108" name="L1108"></a>1108                     privCredSet.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(kerbTicket);
<a id="L1109" name="L1109"></a>1109             <em class="brace">}</em>
<a id="L1110" name="L1110"></a>1110 
<a id="L1111" name="L1111"></a>1111             <strong class="reserved">if</strong> (storeKey) <em class="brace">{</em>
<a id="L1112" name="L1112"></a>1112                 <strong class="reserved">if</strong> (encKeys == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1113" name="L1113"></a>1113                     <strong class="reserved">if</strong> (ktab != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1114" name="L1114"></a>1114                         <strong class="reserved">if</strong> (!privCredSet.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(ktab)) <em class="brace">{</em>
<a id="L1115" name="L1115"></a>1115                             privCredSet.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(ktab);
<a id="L1116" name="L1116"></a>1116                         <em class="brace">}</em>
<a id="L1117" name="L1117"></a>1117                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1118" name="L1118"></a>1118                         succeeded = <strong class="reserved">false</strong>;
<a id="L1119" name="L1119"></a>1119                         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("No key to store");
<a id="L1120" name="L1120"></a>1120                     <em class="brace">}</em>
<a id="L1121" name="L1121"></a>1121                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1122" name="L1122"></a>1122                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; kerbKeys.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i ++) <em class="brace">{</em>
<a id="L1123" name="L1123"></a>1123                         <strong class="reserved">if</strong> (!privCredSet.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(kerbKeys[i])) <em class="brace">{</em>
<a id="L1124" name="L1124"></a>1124                             privCredSet.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(kerbKeys[i]);
<a id="L1125" name="L1125"></a>1125                         <em class="brace">}</em>
<a id="L1126" name="L1126"></a>1126                         encKeys[i].<a href="../D/14870.html" title="Multiple defined in 55 places.">destroy</a>();
<a id="L1127" name="L1127"></a>1127                         encKeys[i] = <strong class="reserved">null</strong>;
<a id="L1128" name="L1128"></a>1128                         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L1129" name="L1129"></a>1129                             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Added server's key"
<a id="L1130" name="L1130"></a>1130                                             + kerbKeys[i]);
<a id="L1131" name="L1131"></a>1131                             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule] " +
<a id="L1132" name="L1132"></a>1132                                            "added Krb5Principal  " +
<a id="L1133" name="L1133"></a>1133                                            kerbClientPrinc.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>()
<a id="L1134" name="L1134"></a>1134                                            + " to Subject");
<a id="L1135" name="L1135"></a>1135                         <em class="brace">}</em>
<a id="L1136" name="L1136"></a>1136                     <em class="brace">}</em>
<a id="L1137" name="L1137"></a>1137                 <em class="brace">}</em>
<a id="L1138" name="L1138"></a>1138             <em class="brace">}</em>
<a id="L1139" name="L1139"></a>1139         <em class="brace">}</em>
<a id="L1140" name="L1140"></a>1140         commitSucceeded = <strong class="reserved">true</strong>;
<a id="L1141" name="L1141"></a>1141         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L1142" name="L1142"></a>1142             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("Commit Succeeded \n");
<a id="L1143" name="L1143"></a>1143         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1144" name="L1144"></a>1144     <em class="brace">}</em>
<a id="L1145" name="L1145"></a>1145 
<div class="comment">
      <p> This method is called if the LoginContext's
      overall authentication failed.
      (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
      LoginModules did not succeed).
      </p><p> If this LoginModule's own authentication attempt
      succeeded (checked by retrieving the private state saved by the
      <code>login</code> and <code>commit</code> methods),
      then this method cleans up any state that was originally saved.
      </p><p>
      @exception LoginException if the abort fails.
      @return false if this LoginModule's own login and/or commit attempts
               failed, and true otherwise.</p></div>
<a id="L1164" name="L1164"></a>1164 
<a id="L1165" name="L1165"></a>1165     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/9495.html" title="Multiple referred from 10 places.">abort</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L1166" name="L1166"></a>1166         <strong class="reserved">if</strong> (succeeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L1167" name="L1167"></a>1167             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1168" name="L1168"></a>1168         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (succeeded == <strong class="reserved">true</strong> &amp;&amp; commitSucceeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L1169" name="L1169"></a>1169             <em class="comment">// login succeeded but overall authentication failed</em>
<a id="L1170" name="L1170"></a>1170             succeeded = <strong class="reserved">false</strong>;
<a id="L1171" name="L1171"></a>1171             <a href="../S/4497.html#L1231" title="Defined at 1231 in src/com/sun/security/auth/module/Krb5LoginModule.java.">cleanKerberosCred</a>();
<a id="L1172" name="L1172"></a>1172         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1173" name="L1173"></a>1173             <em class="comment">// overall authentication succeeded and commit succeeded,</em>
<a id="L1174" name="L1174"></a>1174             <em class="comment">// but someone else's commit failed</em>
<a id="L1175" name="L1175"></a>1175             <a href="../D/27060.html" title="Multiple defined in 11 places.">logout</a>();
<a id="L1176" name="L1176"></a>1176         <em class="brace">}</em>
<a id="L1177" name="L1177"></a>1177         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1178" name="L1178"></a>1178     <em class="brace">}</em>
<a id="L1179" name="L1179"></a>1179 
<div class="comment">
      Logout the user.
      <p> This method removes the <code>Krb5Principal</code>
      that was added by the <code>commit</code> method.
      </p><p>
      @exception LoginException if the logout fails.
      @return true in all cases since this <code>LoginModule</code>
               should not be ignored.</p></div>
<a id="L1193" name="L1193"></a>1193     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22691.html" title="Multiple referred from 8 places.">logout</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L1194" name="L1194"></a>1194 
<a id="L1195" name="L1195"></a>1195         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L1196" name="L1196"></a>1196             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule]: " +
<a id="L1197" name="L1197"></a>1197                 "Entering logout");
<a id="L1198" name="L1198"></a>1198         <em class="brace">}</em>
<a id="L1199" name="L1199"></a>1199 
<a id="L1200" name="L1200"></a>1200         <strong class="reserved">if</strong> (subject.<a href="../D/26131.html" title="Multiple defined in 90 places.">isReadOnly</a>()) <em class="brace">{</em>
<a id="L1201" name="L1201"></a>1201             <a href="../S/4497.html#L1231" title="Defined at 1231 in src/com/sun/security/auth/module/Krb5LoginModule.java.">cleanKerberosCred</a>();
<a id="L1202" name="L1202"></a>1202             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Subject is Readonly");
<a id="L1203" name="L1203"></a>1203         <em class="brace">}</em>
<a id="L1204" name="L1204"></a>1204 
<a id="L1205" name="L1205"></a>1205         subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(kerbClientPrinc);
<a id="L1206" name="L1206"></a>1206            <em class="comment">// Let us remove all Kerberos credentials stored in the Subject</em>
<a id="L1207" name="L1207"></a>1207         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a>&lt;<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt; it = subject.<a href="../D/21680.html" title="Multiple defined in 2 places.">getPrivateCredentials</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L1208" name="L1208"></a>1208         <strong class="reserved">while</strong> (it.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L1209" name="L1209"></a>1209             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = it.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L1210" name="L1210"></a>1210             <strong class="reserved">if</strong> (<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> <strong class="reserved">instanceof</strong> <a href="../S/2634.html#L79" title="Defined at 79 in src/javax/security/auth/kerberos/KerberosTicket.java.">KerberosTicket</a> ||
<a id="L1211" name="L1211"></a>1211                     <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> <strong class="reserved">instanceof</strong> <a href="../S/2631.html#L60" title="Defined at 60 in src/javax/security/auth/kerberos/KerberosKey.java.">KerberosKey</a> ||
<a id="L1212" name="L1212"></a>1212                     <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> <strong class="reserved">instanceof</strong> <a href="../S/2630.html#L73" title="Defined at 73 in src/javax/security/auth/kerberos/KeyTab.java.">KeyTab</a>) <em class="brace">{</em>
<a id="L1213" name="L1213"></a>1213                 it.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L1214" name="L1214"></a>1214             <em class="brace">}</em>
<a id="L1215" name="L1215"></a>1215         <em class="brace">}</em>
<a id="L1216" name="L1216"></a>1216         <em class="comment">// clean the kerberos ticket and keys</em>
<a id="L1217" name="L1217"></a>1217         <a href="../S/4497.html#L1231" title="Defined at 1231 in src/com/sun/security/auth/module/Krb5LoginModule.java.">cleanKerberosCred</a>();
<a id="L1218" name="L1218"></a>1218 
<a id="L1219" name="L1219"></a>1219         succeeded = <strong class="reserved">false</strong>;
<a id="L1220" name="L1220"></a>1220         commitSucceeded = <strong class="reserved">false</strong>;
<a id="L1221" name="L1221"></a>1221         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L1222" name="L1222"></a>1222             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[Krb5LoginModule]: " +
<a id="L1223" name="L1223"></a>1223                                "logged out Subject");
<a id="L1224" name="L1224"></a>1224         <em class="brace">}</em>
<a id="L1225" name="L1225"></a>1225         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1226" name="L1226"></a>1226     <em class="brace">}</em>
<a id="L1227" name="L1227"></a>1227 
<div class="comment">
      Clean Kerberos credentials</div>
<a id="L1231" name="L1231"></a>1231     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/11481.html" title="Multiple referred from 4 places.">cleanKerberosCred</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L1232" name="L1232"></a>1232         <em class="comment">// Clean the ticket and server key</em>
<a id="L1233" name="L1233"></a>1233         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1234" name="L1234"></a>1234             <strong class="reserved">if</strong> (kerbTicket != <strong class="reserved">null</strong>)
<a id="L1235" name="L1235"></a>1235                 kerbTicket.<a href="../D/14870.html" title="Multiple defined in 55 places.">destroy</a>();
<a id="L1236" name="L1236"></a>1236             <strong class="reserved">if</strong> (kerbKeys != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1237" name="L1237"></a>1237                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; kerbKeys.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1238" name="L1238"></a>1238                     kerbKeys[i].<a href="../D/14870.html" title="Multiple defined in 55 places.">destroy</a>();
<a id="L1239" name="L1239"></a>1239                 <em class="brace">}</em>
<a id="L1240" name="L1240"></a>1240             <em class="brace">}</em>
<a id="L1241" name="L1241"></a>1241         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2662.html#L36" title="Defined at 36 in src/javax/security/auth/DestroyFailedException.java.">DestroyFailedException</a> e) <em class="brace">{</em>
<a id="L1242" name="L1242"></a>1242             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L1243" name="L1243"></a>1243                 ("Destroy Failed on Kerberos Private Credentials");
<a id="L1244" name="L1244"></a>1244         <em class="brace">}</em>
<a id="L1245" name="L1245"></a>1245         kerbTicket = <strong class="reserved">null</strong>;
<a id="L1246" name="L1246"></a>1246         kerbKeys = <strong class="reserved">null</strong>;
<a id="L1247" name="L1247"></a>1247         kerbClientPrinc = <strong class="reserved">null</strong>;
<a id="L1248" name="L1248"></a>1248     <em class="brace">}</em>
<a id="L1249" name="L1249"></a>1249 
<div class="comment">
      Clean out the state</div>
<a id="L1253" name="L1253"></a>1253     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/11485.html" title="Multiple referred from 30 places.">cleanState</a>() <em class="brace">{</em>
<a id="L1254" name="L1254"></a>1254 
<a id="L1255" name="L1255"></a>1255         <em class="comment">// save input as shared state only if</em>
<a id="L1256" name="L1256"></a>1256         <em class="comment">// authentication succeeded</em>
<a id="L1257" name="L1257"></a>1257         <strong class="reserved">if</strong> (succeeded) <em class="brace">{</em>
<a id="L1258" name="L1258"></a>1258             <strong class="reserved">if</strong> (storePass &amp;&amp;
<a id="L1259" name="L1259"></a>1259                 !sharedState.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(NAME) &amp;&amp;
<a id="L1260" name="L1260"></a>1260                 !sharedState.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(PWD)) <em class="brace">{</em>
<a id="L1261" name="L1261"></a>1261                 sharedState.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(NAME, username);
<a id="L1262" name="L1262"></a>1262                 sharedState.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(PWD, password);
<a id="L1263" name="L1263"></a>1263             <em class="brace">}</em>
<a id="L1264" name="L1264"></a>1264         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1265" name="L1265"></a>1265             <em class="comment">// remove temp results for the next try</em>
<a id="L1266" name="L1266"></a>1266             encKeys = <strong class="reserved">null</strong>;
<a id="L1267" name="L1267"></a>1267             ktab = <strong class="reserved">null</strong>;
<a id="L1268" name="L1268"></a>1268             <a href="../S/1894.html#L297" title="Defined at 297 in src/java/nio/file/attribute/AclEntry.java.">principal</a> = <strong class="reserved">null</strong>;
<a id="L1269" name="L1269"></a>1269         <em class="brace">}</em>
<a id="L1270" name="L1270"></a>1270         username = <strong class="reserved">null</strong>;
<a id="L1271" name="L1271"></a>1271         password = <strong class="reserved">null</strong>;
<a id="L1272" name="L1272"></a>1272         <strong class="reserved">if</strong> (krb5PrincName != <strong class="reserved">null</strong> &amp;&amp; krb5PrincName.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() != 0)
<a id="L1273" name="L1273"></a>1273             krb5PrincName.<a href="../D/14793.html" title="Multiple defined in 25 places.">delete</a>(0, krb5PrincName.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>());
<a id="L1274" name="L1274"></a>1274         krb5PrincName = <strong class="reserved">null</strong>;
<a id="L1275" name="L1275"></a>1275         <strong class="reserved">if</strong> (clearPass) <em class="brace">{</em>
<a id="L1276" name="L1276"></a>1276             sharedState.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(NAME);
<a id="L1277" name="L1277"></a>1277             sharedState.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(PWD);
<a id="L1278" name="L1278"></a>1278         <em class="brace">}</em>
<a id="L1279" name="L1279"></a>1279     <em class="brace">}</em>
<a id="L1280" name="L1280"></a>1280 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L464">[^]</a><a href="#L1253">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>