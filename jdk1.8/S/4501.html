<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/security/auth/module/JndiLoginModule.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L231">[^]</a><a href="#L765">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L231" title="Defined at 231.">SuppressWarnings</a></li>
<li><a href="#L232" title="Defined at 232.">initialize</a></li>
<li><a href="#L271" title="Defined at 271.">login</a></li>
<li><a href="#L384" title="Defined at 384.">commit</a></li>
<li><a href="#L438" title="Defined at 438.">abort</a></li>
<li><a href="#L476" title="Defined at 476.">logout</a></li>
<li><a href="#L514" title="Defined at 514.">attemptAuthentication</a></li>
<li><a href="#L682" title="Defined at 682.">getUsernamePassword</a></li>
<li><a href="#L739" title="Defined at 739.">verifyPassword</a></li>
<li><a href="#L765" title="Defined at 765.">cleanState</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> com.sun.security.auth.module;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> javax.security.auth.*;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> javax.security.auth.callback.*;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> javax.security.auth.login.*;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> javax.security.auth.spi.*;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> javax.naming.*;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> javax.naming.directory.*;
<a id="L34" name="L34"></a>  34 
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> java.security.AccessController;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.security.PrivilegedAction;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.Map;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.LinkedList;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.ResourceBundle;
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> com.sun.security.auth.UnixPrincipal;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> com.sun.security.auth.UnixNumericUserPrincipal;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> com.sun.security.auth.UnixNumericGroupPrincipal;
<a id="L44" name="L44"></a>  44 
<a id="L45" name="L45"></a>  45 
<div class="comment">
  <p> The module prompts for a username and password
  and then verifies the password against the password stored in
  a directory service configured under JNDI.
  </p><p> This <code>LoginModule</code> interoperates with
  any conformant JNDI service provider.  To direct this
  <code>LoginModule</code> to use a specific JNDI service provider,
  two options must be specified in the login <code>Configuration</code>
  for this <code>LoginModule</code>.
  </p><pre>       user.provider.url=<b>name_service_url</b>
       group.provider.url=<b>name_service_url</b>
  </pre>
  <b>name_service_url</b> specifies
  the directory service and path where this <code>LoginModule</code>
  can access the relevant user and group information.  Because this
  <code>LoginModule</code> only performs one-level searches to
  find the relevant user information, the <code>URL</code>
  must point to a directory one level above where the user and group
  information is stored in the directory service.
  For example, to instruct this <code>LoginModule</code>
  to contact a NIS server, the following URLs must be specified:
  <pre>     user.provider.url="nis://<b>NISServerHostName</b>/<b>NISDomain</b>/user"
     group.provider.url="nis://<b>NISServerHostName</b>/<b>NISDomain</b>/system/group"
  </pre>
  <b>NISServerHostName</b> specifies the server host name of the
  NIS server (for example, <i>nis.sun.com</i>, and <b>NISDomain</b>
  specifies the domain for that NIS server (for example, <i>jaas.sun.com</i>.
  To contact an LDAP server, the following URLs must be specified:
  <pre>     user.provider.url="ldap://<b>LDAPServerHostName</b>/<b>LDAPName</b>"
     group.provider.url="ldap://<b>LDAPServerHostName</b>/<b>LDAPName</b>"
  </pre>
  <b>LDAPServerHostName</b> specifies the server host name of the
  LDAP server, which may include a port number
  (for example, <i>ldap.sun.com:389</i>),
  and <b>LDAPName</b> specifies the entry name in the LDAP directory
  (for example, <i>ou=People,o=Sun,c=US</i> and <i>ou=Groups,o=Sun,c=US</i>
  for user and group information, respectively).
  <p> The format in which the user's information must be stored in
  the directory service is specified in RFC 2307.  Specifically,
  this <code>LoginModule</code> will search for the user's entry in the
  directory service using the user's <i>uid</i> attribute,
  where <i>uid=<b>username</b></i>.  If the search succeeds,
  this <code>LoginModule</code> will then
  obtain the user's encrypted password from the retrieved entry
  using the <i>userPassword</i> attribute.
  This <code>LoginModule</code> assumes that the password is stored
  as a byte array, which when converted to a <code>String</code>,
  has the following format:
  </p><pre>       "{crypt}<b>encrypted_password</b>"
  </pre>
  The LDAP directory server must be configured
  to permit read access to the userPassword attribute.
  If the user entered a valid username and password,
  this <code>LoginModule</code> associates a
  <code>UnixPrincipal</code>, <code>UnixNumericUserPrincipal</code>,
  and the relevant UnixNumericGroupPrincipals with the
  <code>Subject</code>.
  <p> This LoginModule also recognizes the following <code>Configuration</code>
  options:
  </p><pre>     debug          if, true, debug messages are output to System.out.
     useFirstPass   if, true, this LoginModule retrieves the
                    username and password from the module's shared state,
                    using "javax.security.auth.login.name" and
                    "javax.security.auth.login.password" as the respective
                    keys.  The retrieved values are used for authentication.
                    If authentication fails, no attempt for a retry is made,
                    and the failure is reported back to the calling
                    application.
     tryFirstPass   if, true, this LoginModule retrieves the
                    the username and password from the module's shared state,
                    using "javax.security.auth.login.name" and
                    "javax.security.auth.login.password" as the respective
                    keys.  The retrieved values are used for authentication.
                    If authentication fails, the module uses the
                    CallbackHandler to retrieve a new username and password,
                    and another attempt to authenticate is made.
                    If the authentication fails, the failure is reported
                    back to the calling application.
     storePass      if, true, this LoginModule stores the username and password
                    obtained from the CallbackHandler in the module's
                    shared state, using "javax.security.auth.login.name" and
                    "javax.security.auth.login.password" as the respective
                    keys.  This is not performed if existing values already
                    exist for the username and password in the shared state,
                    or if authentication fails.
     clearPass     if, true, this <code>LoginModule</code> clears the
                   username and password stored in the module's shared state
                   after both phases of authentication (login and commit)
                   have completed.
  </pre></div>
<a id="L154" name="L154"></a> 154 @jdk.<a href="../D/3043.html" title="Multiple defined in 7 places.">Exported</a>
<a id="L155" name="L155"></a> 155 <strong class="reserved">public</strong> <strong class="reserved">class</strong> JndiLoginModule <strong class="reserved">implements</strong> <a href="../S/2646.html#L129" title="Defined at 129 in src/javax/security/auth/spi/LoginModule.java.">LoginModule</a> <em class="brace">{</em>
<a id="L156" name="L156"></a> 156 
<a id="L157" name="L157"></a> 157     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a> rb = <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(
<a id="L158" name="L158"></a> 158             <strong class="reserved">new</strong> <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a>&gt;() <em class="brace">{</em>
<a id="L159" name="L159"></a> 159                 <strong class="reserved">public</strong> <a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L160" name="L160"></a> 160                     <strong class="reserved">return</strong> <a href="../S/853.html#L287" title="Defined at 287 in src/java/util/ResourceBundle.java.">ResourceBundle</a>.<a href="../D/17375.html" title="Multiple defined in 6 places.">getBundle</a>(
<a id="L161" name="L161"></a> 161                             "sun.security.util.AuthResources");
<a id="L162" name="L162"></a> 162                 <em class="brace">}</em>
<a id="L163" name="L163"></a> 163             <em class="brace">}</em>
<a id="L164" name="L164"></a> 164     );
<a id="L165" name="L165"></a> 165 
<div class="comment">
     /** JNDI Provider */</div>
<a id="L167" name="L167"></a> 167     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> USER_PROVIDER = "user.provider.url";
<a id="L168" name="L168"></a> 168     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> GROUP_PROVIDER = "group.provider.url";
<a id="L169" name="L169"></a> 169 
<a id="L170" name="L170"></a> 170     <em class="comment">// configurable options</em>
<a id="L171" name="L171"></a> 171     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> = <strong class="reserved">false</strong>;
<a id="L172" name="L172"></a> 172     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> strongDebug = <strong class="reserved">false</strong>;
<a id="L173" name="L173"></a> 173     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> userProvider;
<a id="L174" name="L174"></a> 174     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> groupProvider;
<a id="L175" name="L175"></a> 175     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> useFirstPass = <strong class="reserved">false</strong>;
<a id="L176" name="L176"></a> 176     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> tryFirstPass = <strong class="reserved">false</strong>;
<a id="L177" name="L177"></a> 177     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> storePass = <strong class="reserved">false</strong>;
<a id="L178" name="L178"></a> 178     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> clearPass = <strong class="reserved">false</strong>;
<a id="L179" name="L179"></a> 179 
<a id="L180" name="L180"></a> 180     <em class="comment">// the authentication status</em>
<a id="L181" name="L181"></a> 181     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> succeeded = <strong class="reserved">false</strong>;
<a id="L182" name="L182"></a> 182     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> commitSucceeded = <strong class="reserved">false</strong>;
<a id="L183" name="L183"></a> 183 
<a id="L184" name="L184"></a> 184     <em class="comment">// username, password, and JNDI context</em>
<a id="L185" name="L185"></a> 185     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> username;
<a id="L186" name="L186"></a> 186     <strong class="reserved">private</strong> <strong class="reserved">char</strong>[] password;
<a id="L187" name="L187"></a> 187     <a href="../S/4302.html#L167" title="Defined at 167 in src/javax/naming/directory/DirContext.java.">DirContext</a> <a href="../D/14411.html" title="Multiple defined in 6 places.">ctx</a>;
<a id="L188" name="L188"></a> 188 
<a id="L189" name="L189"></a> 189     <em class="comment">// the user (assume it is a UnixPrincipal)</em>
<a id="L190" name="L190"></a> 190     <strong class="reserved">private</strong> <a href="../S/4513.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixPrincipal.java.">UnixPrincipal</a> userPrincipal;
<a id="L191" name="L191"></a> 191     <strong class="reserved">private</strong> <a href="../S/4519.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericUserPrincipal.java.">UnixNumericUserPrincipal</a> UIDPrincipal;
<a id="L192" name="L192"></a> 192     <strong class="reserved">private</strong> <a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a> GIDPrincipal;
<a id="L193" name="L193"></a> 193     <strong class="reserved">private</strong> <a href="../S/848.html#L83" title="Defined at 83 in src/java/util/LinkedList.java.">LinkedList</a>&lt;<a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a>&gt; supplementaryGroups =
<a id="L194" name="L194"></a> 194                                 <strong class="reserved">new</strong> <a href="../S/848.html#L83" title="Defined at 83 in src/java/util/LinkedList.java.">LinkedList</a>&lt;&gt;();
<a id="L195" name="L195"></a> 195 
<a id="L196" name="L196"></a> 196     <em class="comment">// initial state</em>
<a id="L197" name="L197"></a> 197     <strong class="reserved">private</strong> <a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a> subject;
<a id="L198" name="L198"></a> 198     <strong class="reserved">private</strong> <a href="../S/2659.html#L68" title="Defined at 68 in src/javax/security/auth/callback/CallbackHandler.java.">CallbackHandler</a> callbackHandler;
<a id="L199" name="L199"></a> 199     <strong class="reserved">private</strong> <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt; sharedState;
<a id="L200" name="L200"></a> 200     <strong class="reserved">private</strong> <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, ?&gt; <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>;
<a id="L201" name="L201"></a> 201 
<a id="L202" name="L202"></a> 202     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> CRYPT = "{crypt}";
<a id="L203" name="L203"></a> 203     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> USER_PWD = "userPassword";
<a id="L204" name="L204"></a> 204     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> USER_UID = "uidNumber";
<a id="L205" name="L205"></a> 205     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> USER_GID = "gidNumber";
<a id="L206" name="L206"></a> 206     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> GROUP_ID = "gidNumber";
<a id="L207" name="L207"></a> 207     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> NAME = "javax.security.auth.login.name";
<a id="L208" name="L208"></a> 208     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> PWD = "javax.security.auth.login.password";
<a id="L209" name="L209"></a> 209 
<div class="comment">
      Initialize this <code>LoginModule</code>.
      <p>
      @param subject the <code>Subject</code> to be authenticated. </p><p>
      @param callbackHandler a <code>CallbackHandler</code> for communicating
                       with the end user (prompting for usernames and
                       passwords, for example). </p><p>
      @param sharedState shared <code>LoginModule</code> state. </p><p>
      @param options options specified in the login
                       <code>Configuration</code> for this particular
                       <code>LoginModule</code>.</p></div>
<a id="L227" name="L227"></a> 227     <em class="comment">// Unchecked warning from (Map&lt;String, Object&gt;)sharedState is safe</em>
<a id="L228" name="L228"></a> 228     <em class="comment">// since javax.security.auth.login.LoginContext passes a raw HashMap.</em>
<a id="L229" name="L229"></a> 229     <em class="comment">// Unchecked warnings from options.get(String) are safe since we are</em>
<a id="L230" name="L230"></a> 230     <em class="comment">// passing known keys.</em>
<a id="L231" name="L231"></a> 231     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L232" name="L232"></a> 232     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/20681.html" title="Multiple referred from 99 places.">initialize</a>(<a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a> subject, <a href="../S/2659.html#L68" title="Defined at 68 in src/javax/security/auth/callback/CallbackHandler.java.">CallbackHandler</a> callbackHandler,
<a id="L233" name="L233"></a> 233                            <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>,?&gt; sharedState,
<a id="L234" name="L234"></a> 234                            <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>,?&gt; <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>) <em class="brace">{</em>
<a id="L235" name="L235"></a> 235 
<a id="L236" name="L236"></a> 236         <strong class="reserved">this</strong>.subject = subject;
<a id="L237" name="L237"></a> 237         <strong class="reserved">this</strong>.callbackHandler = callbackHandler;
<a id="L238" name="L238"></a> 238         <strong class="reserved">this</strong>.sharedState = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt;)sharedState;
<a id="L239" name="L239"></a> 239         <strong class="reserved">this</strong>.<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a> = <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>;
<a id="L240" name="L240"></a> 240 
<a id="L241" name="L241"></a> 241         <em class="comment">// initialize any configured options</em>
<a id="L242" name="L242"></a> 242         <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> = "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("debug"));
<a id="L243" name="L243"></a> 243         strongDebug =
<a id="L244" name="L244"></a> 244                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("strongDebug"));
<a id="L245" name="L245"></a> 245         userProvider = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(USER_PROVIDER);
<a id="L246" name="L246"></a> 246         groupProvider = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(GROUP_PROVIDER);
<a id="L247" name="L247"></a> 247         tryFirstPass =
<a id="L248" name="L248"></a> 248                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("tryFirstPass"));
<a id="L249" name="L249"></a> 249         useFirstPass =
<a id="L250" name="L250"></a> 250                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("useFirstPass"));
<a id="L251" name="L251"></a> 251         storePass =
<a id="L252" name="L252"></a> 252                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("storePass"));
<a id="L253" name="L253"></a> 253         clearPass =
<a id="L254" name="L254"></a> 254                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("clearPass"));
<a id="L255" name="L255"></a> 255     <em class="brace">}</em>
<a id="L256" name="L256"></a> 256 
<div class="comment">
      <p> Prompt for username and password.
      Verify the password against the relevant name service.
      </p><p>
      @return true always, since this <code>LoginModule</code>
               should not be ignored.
      @exception FailedLoginException if the authentication fails. </p><p>
      @exception LoginException if this <code>LoginModule</code>
               is unable to perform the authentication.</p></div>
<a id="L271" name="L271"></a> 271     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22690.html" title="Multiple referred from 35 places.">login</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L272" name="L272"></a> 272 
<a id="L273" name="L273"></a> 273         <strong class="reserved">if</strong> (userProvider == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L274" name="L274"></a> 274             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L275" name="L275"></a> 275                 ("Error: Unable to locate JNDI user provider");
<a id="L276" name="L276"></a> 276         <em class="brace">}</em>
<a id="L277" name="L277"></a> 277         <strong class="reserved">if</strong> (groupProvider == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L278" name="L278"></a> 278             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L279" name="L279"></a> 279                 ("Error: Unable to locate JNDI group provider");
<a id="L280" name="L280"></a> 280         <em class="brace">}</em>
<a id="L281" name="L281"></a> 281 
<a id="L282" name="L282"></a> 282         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L283" name="L283"></a> 283             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] user provider: " +
<a id="L284" name="L284"></a> 284                                 userProvider);
<a id="L285" name="L285"></a> 285             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] group provider: " +
<a id="L286" name="L286"></a> 286                                 groupProvider);
<a id="L287" name="L287"></a> 287         <em class="brace">}</em>
<a id="L288" name="L288"></a> 288 
<a id="L289" name="L289"></a> 289         <em class="comment">// attempt the authentication</em>
<a id="L290" name="L290"></a> 290         <strong class="reserved">if</strong> (tryFirstPass) <em class="brace">{</em>
<a id="L291" name="L291"></a> 291 
<a id="L292" name="L292"></a> 292             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L293" name="L293"></a> 293                 <em class="comment">// attempt the authentication by getting the</em>
<a id="L294" name="L294"></a> 294                 <em class="comment">// username and password from shared state</em>
<a id="L295" name="L295"></a> 295                 <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">true</strong>);
<a id="L296" name="L296"></a> 296 
<a id="L297" name="L297"></a> 297                 <em class="comment">// authentication succeeded</em>
<a id="L298" name="L298"></a> 298                 succeeded = <strong class="reserved">true</strong>;
<a id="L299" name="L299"></a> 299                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L300" name="L300"></a> 300                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L301" name="L301"></a> 301                                 "tryFirstPass succeeded");
<a id="L302" name="L302"></a> 302                 <em class="brace">}</em>
<a id="L303" name="L303"></a> 303                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L304" name="L304"></a> 304             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L305" name="L305"></a> 305                 <em class="comment">// authentication failed -- try again below by prompting</em>
<a id="L306" name="L306"></a> 306                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L307" name="L307"></a> 307                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L308" name="L308"></a> 308                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L309" name="L309"></a> 309                                 "tryFirstPass failed with:" +
<a id="L310" name="L310"></a> 310                                 le.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L311" name="L311"></a> 311                 <em class="brace">}</em>
<a id="L312" name="L312"></a> 312             <em class="brace">}</em>
<a id="L313" name="L313"></a> 313 
<a id="L314" name="L314"></a> 314         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (useFirstPass) <em class="brace">{</em>
<a id="L315" name="L315"></a> 315 
<a id="L316" name="L316"></a> 316             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L317" name="L317"></a> 317                 <em class="comment">// attempt the authentication by getting the</em>
<a id="L318" name="L318"></a> 318                 <em class="comment">// username and password from shared state</em>
<a id="L319" name="L319"></a> 319                 <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">true</strong>);
<a id="L320" name="L320"></a> 320 
<a id="L321" name="L321"></a> 321                 <em class="comment">// authentication succeeded</em>
<a id="L322" name="L322"></a> 322                 succeeded = <strong class="reserved">true</strong>;
<a id="L323" name="L323"></a> 323                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L324" name="L324"></a> 324                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L325" name="L325"></a> 325                                 "useFirstPass succeeded");
<a id="L326" name="L326"></a> 326                 <em class="brace">}</em>
<a id="L327" name="L327"></a> 327                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L328" name="L328"></a> 328             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L329" name="L329"></a> 329                 <em class="comment">// authentication failed</em>
<a id="L330" name="L330"></a> 330                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L331" name="L331"></a> 331                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L332" name="L332"></a> 332                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L333" name="L333"></a> 333                                 "useFirstPass failed");
<a id="L334" name="L334"></a> 334                 <em class="brace">}</em>
<a id="L335" name="L335"></a> 335                 <strong class="reserved">throw</strong> le;
<a id="L336" name="L336"></a> 336             <em class="brace">}</em>
<a id="L337" name="L337"></a> 337         <em class="brace">}</em>
<a id="L338" name="L338"></a> 338 
<a id="L339" name="L339"></a> 339         <em class="comment">// attempt the authentication by prompting for the username and pwd</em>
<a id="L340" name="L340"></a> 340         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L341" name="L341"></a> 341             <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">false</strong>);
<a id="L342" name="L342"></a> 342 
<a id="L343" name="L343"></a> 343             <em class="comment">// authentication succeeded</em>
<a id="L344" name="L344"></a> 344            succeeded = <strong class="reserved">true</strong>;
<a id="L345" name="L345"></a> 345             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L346" name="L346"></a> 346                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L347" name="L347"></a> 347                                 "regular authentication succeeded");
<a id="L348" name="L348"></a> 348             <em class="brace">}</em>
<a id="L349" name="L349"></a> 349             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L350" name="L350"></a> 350         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L351" name="L351"></a> 351             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L352" name="L352"></a> 352             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L353" name="L353"></a> 353                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L354" name="L354"></a> 354                                 "regular authentication failed");
<a id="L355" name="L355"></a> 355             <em class="brace">}</em>
<a id="L356" name="L356"></a> 356             <strong class="reserved">throw</strong> le;
<a id="L357" name="L357"></a> 357         <em class="brace">}</em>
<a id="L358" name="L358"></a> 358     <em class="brace">}</em>
<a id="L359" name="L359"></a> 359 
<div class="comment">
      Abstract method to commit the authentication process (phase 2).
      <p> This method is called if the LoginContext's
      overall authentication succeeded
      (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL LoginModules
      succeeded).
      </p><p> If this LoginModule's own authentication attempt
      succeeded (checked by retrieving the private state saved by the
      <code>login</code> method), then this method associates a
      <code>UnixPrincipal</code>
      with the <code>Subject</code> located in the
      <code>LoginModule</code>.  If this LoginModule's own
      authentication attempted failed, then this method removes
      any state that was originally saved.
      </p><p>
      @exception LoginException if the commit fails
      @return true if this LoginModule's own login and commit
               attempts succeeded, or false otherwise.</p></div>
<a id="L384" name="L384"></a> 384     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/11674.html" title="Multiple referred from 3 places.">commit</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L385" name="L385"></a> 385 
<a id="L386" name="L386"></a> 386         <strong class="reserved">if</strong> (succeeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L387" name="L387"></a> 387             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L388" name="L388"></a> 388         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L389" name="L389"></a> 389             <strong class="reserved">if</strong> (subject.<a href="../D/26131.html" title="Multiple defined in 90 places.">isReadOnly</a>()) <em class="brace">{</em>
<a id="L390" name="L390"></a> 390                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L391" name="L391"></a> 391                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> ("Subject is Readonly");
<a id="L392" name="L392"></a> 392             <em class="brace">}</em>
<a id="L393" name="L393"></a> 393             <em class="comment">// add Principals to the Subject</em>
<a id="L394" name="L394"></a> 394             <strong class="reserved">if</strong> (!subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(userPrincipal))
<a id="L395" name="L395"></a> 395                 subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(userPrincipal);
<a id="L396" name="L396"></a> 396             <strong class="reserved">if</strong> (!subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(UIDPrincipal))
<a id="L397" name="L397"></a> 397                 subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(UIDPrincipal);
<a id="L398" name="L398"></a> 398             <strong class="reserved">if</strong> (!subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(GIDPrincipal))
<a id="L399" name="L399"></a> 399                 subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(GIDPrincipal);
<a id="L400" name="L400"></a> 400             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; supplementaryGroups.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L401" name="L401"></a> 401                 <strong class="reserved">if</strong> (!subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>
<a id="L402" name="L402"></a> 402                         (supplementaryGroups.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i)))
<a id="L403" name="L403"></a> 403                     subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(supplementaryGroups.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i));
<a id="L404" name="L404"></a> 404             <em class="brace">}</em>
<a id="L405" name="L405"></a> 405 
<a id="L406" name="L406"></a> 406             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L407" name="L407"></a> 407                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule]: " +
<a id="L408" name="L408"></a> 408                                    "added UnixPrincipal,");
<a id="L409" name="L409"></a> 409                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t\t\tUnixNumericUserPrincipal,");
<a id="L410" name="L410"></a> 410                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t\t\tUnixNumericGroupPrincipal(s),");
<a id="L411" name="L411"></a> 411                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t\t to Subject");
<a id="L412" name="L412"></a> 412             <em class="brace">}</em>
<a id="L413" name="L413"></a> 413         <em class="brace">}</em>
<a id="L414" name="L414"></a> 414         <em class="comment">// in any case, clean out state</em>
<a id="L415" name="L415"></a> 415         <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L416" name="L416"></a> 416         commitSucceeded = <strong class="reserved">true</strong>;
<a id="L417" name="L417"></a> 417         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L418" name="L418"></a> 418     <em class="brace">}</em>
<a id="L419" name="L419"></a> 419 
<div class="comment">
      <p> This method is called if the LoginContext's
      overall authentication failed.
      (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL LoginModules
      did not succeed).
      </p><p> If this LoginModule's own authentication attempt
      succeeded (checked by retrieving the private state saved by the
      <code>login</code> and <code>commit</code> methods),
      then this method cleans up any state that was originally saved.
      </p><p>
      @exception LoginException if the abort fails.
      @return false if this LoginModule's own login and/or commit attempts
               failed, and true otherwise.</p></div>
<a id="L438" name="L438"></a> 438     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/9495.html" title="Multiple referred from 10 places.">abort</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L439" name="L439"></a> 439         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L440" name="L440"></a> 440             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule]: " +
<a id="L441" name="L441"></a> 441                 "aborted authentication failed");
<a id="L442" name="L442"></a> 442 
<a id="L443" name="L443"></a> 443         <strong class="reserved">if</strong> (succeeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L444" name="L444"></a> 444             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L445" name="L445"></a> 445         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (succeeded == <strong class="reserved">true</strong> &amp;&amp; commitSucceeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L446" name="L446"></a> 446 
<a id="L447" name="L447"></a> 447             <em class="comment">// Clean out state</em>
<a id="L448" name="L448"></a> 448             succeeded = <strong class="reserved">false</strong>;
<a id="L449" name="L449"></a> 449             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L450" name="L450"></a> 450 
<a id="L451" name="L451"></a> 451             userPrincipal = <strong class="reserved">null</strong>;
<a id="L452" name="L452"></a> 452             UIDPrincipal = <strong class="reserved">null</strong>;
<a id="L453" name="L453"></a> 453             GIDPrincipal = <strong class="reserved">null</strong>;
<a id="L454" name="L454"></a> 454             supplementaryGroups = <strong class="reserved">new</strong> <a href="../S/848.html#L83" title="Defined at 83 in src/java/util/LinkedList.java.">LinkedList</a>&lt;<a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a>&gt;();
<a id="L455" name="L455"></a> 455         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L456" name="L456"></a> 456             <em class="comment">// overall authentication succeeded and commit succeeded,</em>
<a id="L457" name="L457"></a> 457             <em class="comment">// but someone else's commit failed</em>
<a id="L458" name="L458"></a> 458             <a href="../D/27060.html" title="Multiple defined in 11 places.">logout</a>();
<a id="L459" name="L459"></a> 459         <em class="brace">}</em>
<a id="L460" name="L460"></a> 460         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L461" name="L461"></a> 461     <em class="brace">}</em>
<a id="L462" name="L462"></a> 462 
<div class="comment">
      Logout a user.
      <p> This method removes the Principals
      that were added by the <code>commit</code> method.
      </p><p>
      @exception LoginException if the logout fails.
      @return true in all cases since this <code>LoginModule</code>
               should not be ignored.</p></div>
<a id="L476" name="L476"></a> 476     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22691.html" title="Multiple referred from 8 places.">logout</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L477" name="L477"></a> 477         <strong class="reserved">if</strong> (subject.<a href="../D/26131.html" title="Multiple defined in 90 places.">isReadOnly</a>()) <em class="brace">{</em>
<a id="L478" name="L478"></a> 478             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L479" name="L479"></a> 479             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> ("Subject is Readonly");
<a id="L480" name="L480"></a> 480         <em class="brace">}</em>
<a id="L481" name="L481"></a> 481         subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(userPrincipal);
<a id="L482" name="L482"></a> 482         subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(UIDPrincipal);
<a id="L483" name="L483"></a> 483         subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(GIDPrincipal);
<a id="L484" name="L484"></a> 484         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; supplementaryGroups.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L485" name="L485"></a> 485             subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(supplementaryGroups.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i));
<a id="L486" name="L486"></a> 486         <em class="brace">}</em>
<a id="L487" name="L487"></a> 487 
<a id="L488" name="L488"></a> 488 
<a id="L489" name="L489"></a> 489         <em class="comment">// clean out state</em>
<a id="L490" name="L490"></a> 490         <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L491" name="L491"></a> 491         succeeded = <strong class="reserved">false</strong>;
<a id="L492" name="L492"></a> 492         commitSucceeded = <strong class="reserved">false</strong>;
<a id="L493" name="L493"></a> 493 
<a id="L494" name="L494"></a> 494         userPrincipal = <strong class="reserved">null</strong>;
<a id="L495" name="L495"></a> 495         UIDPrincipal = <strong class="reserved">null</strong>;
<a id="L496" name="L496"></a> 496         GIDPrincipal = <strong class="reserved">null</strong>;
<a id="L497" name="L497"></a> 497         supplementaryGroups = <strong class="reserved">new</strong> <a href="../S/848.html#L83" title="Defined at 83 in src/java/util/LinkedList.java.">LinkedList</a>&lt;<a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a>&gt;();
<a id="L498" name="L498"></a> 498 
<a id="L499" name="L499"></a> 499         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L500" name="L500"></a> 500             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule]: " +
<a id="L501" name="L501"></a> 501                 "logged out Subject");
<a id="L502" name="L502"></a> 502         <em class="brace">}</em>
<a id="L503" name="L503"></a> 503         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L504" name="L504"></a> 504     <em class="brace">}</em>
<a id="L505" name="L505"></a> 505 
<div class="comment">
      Attempt authentication
      <p>
      @param getPasswdFromSharedState boolean that tells this method whether
               to retrieve the password from the sharedState.</p></div>
<a id="L514" name="L514"></a> 514     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10399.html" title="Multiple referred from 12 places.">attemptAuthentication</a>(<strong class="reserved">boolean</strong> getPasswdFromSharedState)
<a id="L515" name="L515"></a> 515     <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L516" name="L516"></a> 516 
<a id="L517" name="L517"></a> 517         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> encryptedPassword = <strong class="reserved">null</strong>;
<a id="L518" name="L518"></a> 518 
<a id="L519" name="L519"></a> 519         <em class="comment">// first get the username and password</em>
<a id="L520" name="L520"></a> 520         <a href="../D/23505.html" title="Multiple defined in 3 places.">getUsernamePassword</a>(getPasswdFromSharedState);
<a id="L521" name="L521"></a> 521 
<a id="L522" name="L522"></a> 522         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L523" name="L523"></a> 523 
<a id="L524" name="L524"></a> 524             <em class="comment">// get the user's passwd entry from the user provider URL</em>
<a id="L525" name="L525"></a> 525             <a href="../S/4308.html#L131" title="Defined at 131 in src/javax/naming/InitialContext.java.">InitialContext</a> iCtx = <strong class="reserved">new</strong> <a href="../S/4308.html#L131" title="Defined at 131 in src/javax/naming/InitialContext.java.">InitialContext</a>();
<a id="L526" name="L526"></a> 526             <a href="../D/14411.html" title="Multiple defined in 6 places.">ctx</a> = (<a href="../S/4302.html#L167" title="Defined at 167 in src/javax/naming/directory/DirContext.java.">DirContext</a>)iCtx.<a href="../D/27095.html" title="Multiple defined in 22 places.">lookup</a>(userProvider);
<a id="L527" name="L527"></a> 527 
<div class="comment">
            SearchControls controls = new SearchControls
                                        (SearchControls.ONELEVEL_SCOPE,
                                        0,
                                        5000,
                                        new String[] { USER_PWD },
                                        false,
                                        false);</div>
<a id="L537" name="L537"></a> 537 
<a id="L538" name="L538"></a> 538             <a href="../S/4288.html#L43" title="Defined at 43 in src/javax/naming/directory/SearchControls.java.">SearchControls</a> controls = <strong class="reserved">new</strong> <a href="../S/4288.html#L43" title="Defined at 43 in src/javax/naming/directory/SearchControls.java.">SearchControls</a>();
<a id="L539" name="L539"></a> 539             <a href="../S/4244.html#L81" title="Defined at 81 in src/javax/naming/NamingEnumeration.java.">NamingEnumeration</a>&lt;<a href="../S/4293.html#L45" title="Defined at 45 in src/javax/naming/directory/SearchResult.java.">SearchResult</a>&gt; ne = <a href="../D/14411.html" title="Multiple defined in 6 places.">ctx</a>.<a href="../D/31650.html" title="Multiple defined in 35 places.">search</a>("",
<a id="L540" name="L540"></a> 540                                         "(uid=" + username + ")",
<a id="L541" name="L541"></a> 541                                         controls);
<a id="L542" name="L542"></a> 542             <strong class="reserved">if</strong> (ne.<a href="../D/24127.html" title="Multiple defined in 9 places.">hasMore</a>()) <em class="brace">{</em>
<a id="L543" name="L543"></a> 543                 <a href="../S/4293.html#L45" title="Defined at 45 in src/javax/naming/directory/SearchResult.java.">SearchResult</a> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = ne.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L544" name="L544"></a> 544                 <a href="../D/601.html" title="Multiple defined in 4 places.">Attributes</a> <a href="../S/1947.html#L156" title="Defined at 156 in src/java/nio/file/FileTreeWalker.java.">attributes</a> = <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>.<a href="../D/17112.html" title="Multiple defined in 109 places.">getAttributes</a>();
<a id="L545" name="L545"></a> 545 
<a id="L546" name="L546"></a> 546                 <em class="comment">// get the password</em>
<a id="L547" name="L547"></a> 547 
<a id="L548" name="L548"></a> 548                 <em class="comment">// this module works only if the LDAP directory server</em>
<a id="L549" name="L549"></a> 549                 <em class="comment">// is configured to permit read access to the userPassword</em>
<a id="L550" name="L550"></a> 550                 <em class="comment">// attribute. The directory administrator need to grant</em>
<a id="L551" name="L551"></a> 551                 <em class="comment">// this access.</em>
<a id="L552" name="L552"></a> 552                 <em class="comment">//</em>
<a id="L553" name="L553"></a> 553                 <em class="comment">// A workaround would be to make the server do authentication</em>
<a id="L554" name="L554"></a> 554                 <em class="comment">// by setting the Context.SECURITY_PRINCIPAL</em>
<a id="L555" name="L555"></a> 555                 <em class="comment">// and Context.SECURITY_CREDENTIALS property.</em>
<a id="L556" name="L556"></a> 556                 <em class="comment">// However, this would make it not work with systems that</em>
<a id="L557" name="L557"></a> 557                 <em class="comment">// don't do authentication at the server (like NIS).</em>
<a id="L558" name="L558"></a> 558                 <em class="comment">//</em>
<a id="L559" name="L559"></a> 559                 <em class="comment">// Setting the SECURITY_* properties and using "simple"</em>
<a id="L560" name="L560"></a> 560                 <em class="comment">// authentication for LDAP is recommended only for secure</em>
<a id="L561" name="L561"></a> 561                 <em class="comment">// channels. For nonsecure channels, SSL is recommended.</em>
<a id="L562" name="L562"></a> 562 
<a id="L563" name="L563"></a> 563                 <a href="../D/567.html" title="Multiple defined in 12 places.">Attribute</a> pwd = <a href="../S/1947.html#L156" title="Defined at 156 in src/java/nio/file/FileTreeWalker.java.">attributes</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(USER_PWD);
<a id="L564" name="L564"></a> 564                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> encryptedPwd = <strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>((<strong class="reserved">byte</strong>[])pwd.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(), "UTF8");
<a id="L565" name="L565"></a> 565                 encryptedPassword = encryptedPwd.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(CRYPT.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>());
<a id="L566" name="L566"></a> 566 
<a id="L567" name="L567"></a> 567                 <em class="comment">// check the password</em>
<a id="L568" name="L568"></a> 568                 <strong class="reserved">if</strong> (<a href="../S/4501.html#L739" title="Defined at 739 in src/com/sun/security/auth/module/JndiLoginModule.java.">verifyPassword</a>
<a id="L569" name="L569"></a> 569                     (encryptedPassword, <strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>(password)) == <strong class="reserved">true</strong>) <em class="brace">{</em>
<a id="L570" name="L570"></a> 570 
<a id="L571" name="L571"></a> 571                     <em class="comment">// authentication succeeded</em>
<a id="L572" name="L572"></a> 572                     <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L573" name="L573"></a> 573                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L574" name="L574"></a> 574                                 "attemptAuthentication() succeeded");
<a id="L575" name="L575"></a> 575 
<a id="L576" name="L576"></a> 576                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L577" name="L577"></a> 577                     <em class="comment">// authentication failed</em>
<a id="L578" name="L578"></a> 578                     <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>)
<a id="L579" name="L579"></a> 579                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L580" name="L580"></a> 580                                 "attemptAuthentication() failed");
<a id="L581" name="L581"></a> 581                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2668.html#L36" title="Defined at 36 in src/javax/security/auth/login/FailedLoginException.java.">FailedLoginException</a>("Login incorrect");
<a id="L582" name="L582"></a> 582                 <em class="brace">}</em>
<a id="L583" name="L583"></a> 583 
<a id="L584" name="L584"></a> 584                 <em class="comment">// save input as shared state only if</em>
<a id="L585" name="L585"></a> 585                 <em class="comment">// authentication succeeded</em>
<a id="L586" name="L586"></a> 586                 <strong class="reserved">if</strong> (storePass &amp;&amp;
<a id="L587" name="L587"></a> 587                     !sharedState.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(NAME) &amp;&amp;
<a id="L588" name="L588"></a> 588                     !sharedState.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(PWD)) <em class="brace">{</em>
<a id="L589" name="L589"></a> 589                     sharedState.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(NAME, username);
<a id="L590" name="L590"></a> 590                     sharedState.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(PWD, password);
<a id="L591" name="L591"></a> 591                 <em class="brace">}</em>
<a id="L592" name="L592"></a> 592 
<a id="L593" name="L593"></a> 593                 <em class="comment">// create the user principal</em>
<a id="L594" name="L594"></a> 594                 userPrincipal = <strong class="reserved">new</strong> <a href="../S/4513.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixPrincipal.java.">UnixPrincipal</a>(username);
<a id="L595" name="L595"></a> 595 
<a id="L596" name="L596"></a> 596                 <em class="comment">// get the UID</em>
<a id="L597" name="L597"></a> 597                 <a href="../D/567.html" title="Multiple defined in 12 places.">Attribute</a> uid = <a href="../S/1947.html#L156" title="Defined at 156 in src/java/nio/file/FileTreeWalker.java.">attributes</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(USER_UID);
<a id="L598" name="L598"></a> 598                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> uidNumber = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)uid.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L599" name="L599"></a> 599                 UIDPrincipal = <strong class="reserved">new</strong> <a href="../S/4519.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericUserPrincipal.java.">UnixNumericUserPrincipal</a>(uidNumber);
<a id="L600" name="L600"></a> 600                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> &amp;&amp; uidNumber != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L601" name="L601"></a> 601                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L602" name="L602"></a> 602                                 "user: '" + username + "' has UID: " +
<a id="L603" name="L603"></a> 603                                 uidNumber);
<a id="L604" name="L604"></a> 604                 <em class="brace">}</em>
<a id="L605" name="L605"></a> 605 
<a id="L606" name="L606"></a> 606                 <em class="comment">// get the GID</em>
<a id="L607" name="L607"></a> 607                 <a href="../D/567.html" title="Multiple defined in 12 places.">Attribute</a> gid = <a href="../S/1947.html#L156" title="Defined at 156 in src/java/nio/file/FileTreeWalker.java.">attributes</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(USER_GID);
<a id="L608" name="L608"></a> 608                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> gidNumber = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)gid.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L609" name="L609"></a> 609                 GIDPrincipal = <strong class="reserved">new</strong> <a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a>
<a id="L610" name="L610"></a> 610                                 (gidNumber, <strong class="reserved">true</strong>);
<a id="L611" name="L611"></a> 611                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> &amp;&amp; gidNumber != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L613" name="L613"></a> 613                                 "user: '" + username + "' has GID: " +
<a id="L614" name="L614"></a> 614                                 gidNumber);
<a id="L615" name="L615"></a> 615                 <em class="brace">}</em>
<a id="L616" name="L616"></a> 616 
<a id="L617" name="L617"></a> 617                 <em class="comment">// get the supplementary groups from the group provider URL</em>
<a id="L618" name="L618"></a> 618                 <a href="../D/14411.html" title="Multiple defined in 6 places.">ctx</a> = (<a href="../S/4302.html#L167" title="Defined at 167 in src/javax/naming/directory/DirContext.java.">DirContext</a>)iCtx.<a href="../D/27095.html" title="Multiple defined in 22 places.">lookup</a>(groupProvider);
<a id="L619" name="L619"></a> 619                 ne = <a href="../D/14411.html" title="Multiple defined in 6 places.">ctx</a>.<a href="../D/31650.html" title="Multiple defined in 35 places.">search</a>("", <strong class="reserved">new</strong> <a href="../S/4294.html#L71" title="Defined at 71 in src/javax/naming/directory/BasicAttributes.java.">BasicAttributes</a>("memberUid", username));
<a id="L620" name="L620"></a> 620 
<a id="L621" name="L621"></a> 621                 <strong class="reserved">while</strong> (ne.<a href="../D/24127.html" title="Multiple defined in 9 places.">hasMore</a>()) <em class="brace">{</em>
<a id="L622" name="L622"></a> 622                     <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = ne.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L623" name="L623"></a> 623                     <a href="../S/1947.html#L156" title="Defined at 156 in src/java/nio/file/FileTreeWalker.java.">attributes</a> = <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>.<a href="../D/17112.html" title="Multiple defined in 109 places.">getAttributes</a>();
<a id="L624" name="L624"></a> 624 
<a id="L625" name="L625"></a> 625                     gid = <a href="../S/1947.html#L156" title="Defined at 156 in src/java/nio/file/FileTreeWalker.java.">attributes</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(GROUP_ID);
<a id="L626" name="L626"></a> 626                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> suppGid = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)gid.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L627" name="L627"></a> 627                     <strong class="reserved">if</strong> (!gidNumber.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(suppGid)) <em class="brace">{</em>
<a id="L628" name="L628"></a> 628                         <a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a> suppPrincipal =
<a id="L629" name="L629"></a> 629                             <strong class="reserved">new</strong> <a href="../S/4510.html#L45" title="Defined at 45 in src/com/sun/security/auth/UnixNumericGroupPrincipal.java.">UnixNumericGroupPrincipal</a>(suppGid, <strong class="reserved">false</strong>);
<a id="L630" name="L630"></a> 630                         supplementaryGroups.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(suppPrincipal);
<a id="L631" name="L631"></a> 631                         <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> &amp;&amp; suppGid != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L632" name="L632"></a> 632                             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L633" name="L633"></a> 633                                 "user: '" + username +
<a id="L634" name="L634"></a> 634                                 "' has Supplementary Group: " +
<a id="L635" name="L635"></a> 635                                 suppGid);
<a id="L636" name="L636"></a> 636                         <em class="brace">}</em>
<a id="L637" name="L637"></a> 637                     <em class="brace">}</em>
<a id="L638" name="L638"></a> 638                 <em class="brace">}</em>
<a id="L639" name="L639"></a> 639 
<a id="L640" name="L640"></a> 640             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L641" name="L641"></a> 641                 <em class="comment">// bad username</em>
<a id="L642" name="L642"></a> 642                 <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L643" name="L643"></a> 643                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule]: User not found");
<a id="L644" name="L644"></a> 644                 <em class="brace">}</em>
<a id="L645" name="L645"></a> 645                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2668.html#L36" title="Defined at 36 in src/javax/security/auth/login/FailedLoginException.java.">FailedLoginException</a>("User not found");
<a id="L646" name="L646"></a> 646             <em class="brace">}</em>
<a id="L647" name="L647"></a> 647         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/4338.html#L60" title="Defined at 60 in src/javax/naming/NamingException.java.">NamingException</a> ne) <em class="brace">{</em>
<a id="L648" name="L648"></a> 648             <em class="comment">// bad username</em>
<a id="L649" name="L649"></a> 649             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L650" name="L650"></a> 650                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule]:  User not found");
<a id="L651" name="L651"></a> 651                 ne.<a href="../D/29703.html" title="Multiple defined in 46 places.">printStackTrace</a>();
<a id="L652" name="L652"></a> 652             <em class="brace">}</em>
<a id="L653" name="L653"></a> 653             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2668.html#L36" title="Defined at 36 in src/javax/security/auth/login/FailedLoginException.java.">FailedLoginException</a>("User not found");
<a id="L654" name="L654"></a> 654         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1372.html#L33" title="Defined at 33 in src/java/io/UnsupportedEncodingException.java.">UnsupportedEncodingException</a> uee) <em class="brace">{</em>
<a id="L655" name="L655"></a> 655             <em class="comment">// password stored in incorrect format</em>
<a id="L656" name="L656"></a> 656             <strong class="reserved">if</strong> (<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>) <em class="brace">{</em>
<a id="L657" name="L657"></a> 657                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule]:  " +
<a id="L658" name="L658"></a> 658                                 "password incorrectly encoded");
<a id="L659" name="L659"></a> 659                 uee.<a href="../D/29703.html" title="Multiple defined in 46 places.">printStackTrace</a>();
<a id="L660" name="L660"></a> 660             <em class="brace">}</em>
<a id="L661" name="L661"></a> 661             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Login failure due to incorrect " +
<a id="L662" name="L662"></a> 662                                 "password encoding in the password database");
<a id="L663" name="L663"></a> 663         <em class="brace">}</em>
<a id="L664" name="L664"></a> 664 
<a id="L665" name="L665"></a> 665         <em class="comment">// authentication succeeded</em>
<a id="L666" name="L666"></a> 666     <em class="brace">}</em>
<a id="L667" name="L667"></a> 667 
<div class="comment">
      Get the username and password.
      This method does not return any value.
      Instead, it sets global name and password variables.
      <p> Also note that this method will set the username and password
      values in the shared state in case subsequent LoginModules
      want to use them via use/tryFirstPass.
      </p><p>
      @param getPasswdFromSharedState boolean that tells this method whether
               to retrieve the password from the sharedState.</p></div>
<a id="L682" name="L682"></a> 682     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/19734.html" title="Multiple referred from 3 places.">getUsernamePassword</a>(<strong class="reserved">boolean</strong> getPasswdFromSharedState)
<a id="L683" name="L683"></a> 683     <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L684" name="L684"></a> 684 
<a id="L685" name="L685"></a> 685         <strong class="reserved">if</strong> (getPasswdFromSharedState) <em class="brace">{</em>
<a id="L686" name="L686"></a> 686             <em class="comment">// use the password saved by the first module in the stack</em>
<a id="L687" name="L687"></a> 687             username = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)sharedState.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(NAME);
<a id="L688" name="L688"></a> 688             password = (<strong class="reserved">char</strong>[])sharedState.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(PWD);
<a id="L689" name="L689"></a> 689             <strong class="reserved">return</strong>;
<a id="L690" name="L690"></a> 690         <em class="brace">}</em>
<a id="L691" name="L691"></a> 691 
<a id="L692" name="L692"></a> 692         <em class="comment">// prompt for a username and password</em>
<a id="L693" name="L693"></a> 693         <strong class="reserved">if</strong> (callbackHandler == <strong class="reserved">null</strong>)
<a id="L694" name="L694"></a> 694             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Error: no CallbackHandler available " +
<a id="L695" name="L695"></a> 695                 "to garner authentication information from the user");
<a id="L696" name="L696"></a> 696 
<a id="L697" name="L697"></a> 697         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> protocol = userProvider.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0, userProvider.<a href="../D/24468.html" title="Multiple defined in 74 places.">indexOf</a>(":"));
<a id="L698" name="L698"></a> 698 
<a id="L699" name="L699"></a> 699         <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[] callbacks = <strong class="reserved">new</strong> <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[2];
<a id="L700" name="L700"></a> 700         callbacks[0] = <strong class="reserved">new</strong> <a href="../S/2650.html#L35" title="Defined at 35 in src/javax/security/auth/callback/NameCallback.java.">NameCallback</a>(protocol + " "
<a id="L701" name="L701"></a> 701                                             + rb.<a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>("username."));
<a id="L702" name="L702"></a> 702         callbacks[1] = <strong class="reserved">new</strong> <a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>(protocol + " " +
<a id="L703" name="L703"></a> 703                                                 rb.<a href="../D/22769.html" title="Multiple defined in 35 places.">getString</a>("password."),
<a id="L704" name="L704"></a> 704                                             <strong class="reserved">false</strong>);
<a id="L705" name="L705"></a> 705 
<a id="L706" name="L706"></a> 706         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L707" name="L707"></a> 707             callbackHandler.<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>(callbacks);
<a id="L708" name="L708"></a> 708             username = ((<a href="../S/2650.html#L35" title="Defined at 35 in src/javax/security/auth/callback/NameCallback.java.">NameCallback</a>)callbacks[0]).<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L709" name="L709"></a> 709             <strong class="reserved">char</strong>[] tmpPassword = ((<a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>)callbacks[1]).<a href="../D/21429.html" title="Multiple defined in 6 places.">getPassword</a>();
<a id="L710" name="L710"></a> 710             password = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L711" name="L711"></a> 711             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmpPassword, 0,
<a id="L712" name="L712"></a> 712                                 password, 0, tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L713" name="L713"></a> 713             ((<a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>)callbacks[1]).<a href="../S/2651.html#L136" title="Defined at 136 in src/javax/security/auth/callback/PasswordCallback.java.">clearPassword</a>();
<a id="L714" name="L714"></a> 714 
<a id="L715" name="L715"></a> 715         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> ioe) <em class="brace">{</em>
<a id="L716" name="L716"></a> 716             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(ioe.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L717" name="L717"></a> 717         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2652.html#L33" title="Defined at 33 in src/javax/security/auth/callback/UnsupportedCallbackException.java.">UnsupportedCallbackException</a> uce) <em class="brace">{</em>
<a id="L718" name="L718"></a> 718             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Error: " + uce.<a href="../S/2652.html#L78" title="Defined at 78 in src/javax/security/auth/callback/UnsupportedCallbackException.java.">getCallback</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L719" name="L719"></a> 719                         " not available to garner authentication information " +
<a id="L720" name="L720"></a> 720                         "from the user");
<a id="L721" name="L721"></a> 721         <em class="brace">}</em>
<a id="L722" name="L722"></a> 722 
<a id="L723" name="L723"></a> 723         <em class="comment">// print debugging information</em>
<a id="L724" name="L724"></a> 724         <strong class="reserved">if</strong> (strongDebug) <em class="brace">{</em>
<a id="L725" name="L725"></a> 725             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("\t\t[JndiLoginModule] " +
<a id="L726" name="L726"></a> 726                                 "user entered username: " +
<a id="L727" name="L727"></a> 727                                 username);
<a id="L728" name="L728"></a> 728             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("\t\t[JndiLoginModule] " +
<a id="L729" name="L729"></a> 729                                 "user entered password: ");
<a id="L730" name="L730"></a> 730             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; password.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)
<a id="L731" name="L731"></a> 731                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(password[i]);
<a id="L732" name="L732"></a> 732             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>();
<a id="L733" name="L733"></a> 733         <em class="brace">}</em>
<a id="L734" name="L734"></a> 734     <em class="brace">}</em>
<a id="L735" name="L735"></a> 735 
<div class="comment">
      Verify a password against the encrypted passwd from /etc/shadow</div>
<a id="L739" name="L739"></a> 739     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/4501.html#L568" title="Referred from 568 in src/com/sun/security/auth/module/JndiLoginModule.java.">verifyPassword</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> encryptedPassword, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> password) <em class="brace">{</em>
<a id="L740" name="L740"></a> 740 
<a id="L741" name="L741"></a> 741         <strong class="reserved">if</strong> (encryptedPassword == <strong class="reserved">null</strong>)
<a id="L742" name="L742"></a> 742             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L743" name="L743"></a> 743 
<a id="L744" name="L744"></a> 744         <a href="../S/4495.html#L56" title="Defined at 56 in src/com/sun/security/auth/module/Crypt.java.">Crypt</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <strong class="reserved">new</strong> <a href="../S/4495.html#L56" title="Defined at 56 in src/com/sun/security/auth/module/Crypt.java.">Crypt</a>();
<a id="L745" name="L745"></a> 745         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L746" name="L746"></a> 746             <strong class="reserved">byte</strong> oldCrypt[] = encryptedPassword.<a href="../D/17415.html" title="Multiple defined in 35 places.">getBytes</a>("UTF8");
<a id="L747" name="L747"></a> 747             <strong class="reserved">byte</strong> newCrypt[] = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../S/4495.html#L301" title="Defined at 301 in src/com/sun/security/auth/module/Crypt.java.">crypt</a>(password.<a href="../D/17415.html" title="Multiple defined in 35 places.">getBytes</a>("UTF8"),
<a id="L748" name="L748"></a> 748                                       oldCrypt);
<a id="L749" name="L749"></a> 749             <strong class="reserved">if</strong> (newCrypt.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> != oldCrypt.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L750" name="L750"></a> 750                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L751" name="L751"></a> 751             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; newCrypt.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L752" name="L752"></a> 752                 <strong class="reserved">if</strong> (oldCrypt[i] != newCrypt[i])
<a id="L753" name="L753"></a> 753                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L754" name="L754"></a> 754             <em class="brace">}</em>
<a id="L755" name="L755"></a> 755         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1372.html#L33" title="Defined at 33 in src/java/io/UnsupportedEncodingException.java.">UnsupportedEncodingException</a> uee) <em class="brace">{</em>
<a id="L756" name="L756"></a> 756             <em class="comment">// cannot happen, but return false just to be safe</em>
<a id="L757" name="L757"></a> 757             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L758" name="L758"></a> 758         <em class="brace">}</em>
<a id="L759" name="L759"></a> 759         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L760" name="L760"></a> 760     <em class="brace">}</em>
<a id="L761" name="L761"></a> 761 
<div class="comment">
      Clean out state because of a failed authentication attempt</div>
<a id="L765" name="L765"></a> 765     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/11485.html" title="Multiple referred from 30 places.">cleanState</a>() <em class="brace">{</em>
<a id="L766" name="L766"></a> 766         username = <strong class="reserved">null</strong>;
<a id="L767" name="L767"></a> 767         <strong class="reserved">if</strong> (password != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L768" name="L768"></a> 768             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; password.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)
<a id="L769" name="L769"></a> 769                 password[i] = ' ';
<a id="L770" name="L770"></a> 770             password = <strong class="reserved">null</strong>;
<a id="L771" name="L771"></a> 771         <em class="brace">}</em>
<a id="L772" name="L772"></a> 772         <a href="../D/14411.html" title="Multiple defined in 6 places.">ctx</a> = <strong class="reserved">null</strong>;
<a id="L773" name="L773"></a> 773 
<a id="L774" name="L774"></a> 774         <strong class="reserved">if</strong> (clearPass) <em class="brace">{</em>
<a id="L775" name="L775"></a> 775             sharedState.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(NAME);
<a id="L776" name="L776"></a> 776             sharedState.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(PWD);
<a id="L777" name="L777"></a> 777         <em class="brace">}</em>
<a id="L778" name="L778"></a> 778     <em class="brace">}</em>
<a id="L779" name="L779"></a> 779 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L231">[^]</a><a href="#L765">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>