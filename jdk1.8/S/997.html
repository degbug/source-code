<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/Timer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L123">[^]</a><a href="#L716">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L123" title="Defined at 123.">serialNumber</a></li>
<li><a href="#L190" title="Defined at 190.">schedule</a></li>
<li><a href="#L207" title="Defined at 207.">schedule</a></li>
<li><a href="#L243" title="Defined at 243.">schedule</a></li>
<li><a href="#L284" title="Defined at 284.">schedule</a></li>
<li><a href="#L323" title="Defined at 323.">scheduleAtFixedRate</a></li>
<li><a href="#L366" title="Defined at 366.">scheduleAtFixedRate</a></li>
<li><a href="#L386" title="Defined at 386.">sched</a></li>
<li><a href="#L428" title="Defined at 428.">cancel</a></li>
<li><a href="#L456" title="Defined at 456.">purge</a></li>
<li><a href="#L503" title="Defined at 503.">run</a></li>
<li><a href="#L518" title="Defined at 518.">mainLoop</a></li>
<li><a href="#L589" title="Defined at 589.">size</a></li>
<li><a href="#L596" title="Defined at 596.">add</a></li>
<li><a href="#L609" title="Defined at 609.">getMin</a></li>
<li><a href="#L618" title="Defined at 618.">get</a></li>
<li><a href="#L625" title="Defined at 625.">removeMin</a></li>
<li><a href="#L636" title="Defined at 636.">quickRemove</a></li>
<li><a href="#L647" title="Defined at 647.">rescheduleMin</a></li>
<li><a href="#L655" title="Defined at 655.">isEmpty</a></li>
<li><a href="#L662" title="Defined at 662.">clear</a></li>
<li><a href="#L679" title="Defined at 679.">fixUp</a></li>
<li><a href="#L699" title="Defined at 699.">fixDown</a></li>
<li><a href="#L716" title="Defined at 716.">heapify</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1999, 2008, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util;
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.util.Date;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.concurrent.atomic.AtomicInteger;
<a id="L29" name="L29"></a>  29 
<div class="comment">
  A facility for threads to schedule tasks for future execution in a
  background thread.  Tasks may be scheduled for one-time execution, or for
  repeated execution at regular intervals.
  <p>Corresponding to each <tt>Timer</tt> object is a single background
  thread that is used to execute all of the timer's tasks, sequentially.
  Timer tasks should complete quickly.  If a timer task takes excessive time
  to complete, it "hogs" the timer's task execution thread.  This can, in
  turn, delay the execution of subsequent tasks, which may "bunch up" and
  execute in rapid succession when (and if) the offending task finally
  completes.
  </p><p>After the last live reference to a <tt>Timer</tt> object goes away
  <i>and</i> all outstanding tasks have completed execution, the timer's task
  execution thread terminates gracefully (and becomes subject to garbage
  collection).  However, this can take arbitrarily long to occur.  By
  default, the task execution thread does not run as a <i>daemon thread</i>,
  so it is capable of keeping an application from terminating.  If a caller
  wants to terminate a timer's task execution thread rapidly, the caller
  should invoke the timer's <tt>cancel</tt> method.
  </p><p>If the timer's task execution thread terminates unexpectedly, for
  example, because its <tt>stop</tt> method is invoked, any further
  attempt to schedule a task on the timer will result in an
  <tt>IllegalStateException</tt>, as if the timer's <tt>cancel</tt>
  method had been invoked.
  </p><p>This class is thread-safe: multiple threads can share a single
  <tt>Timer</tt> object without the need for external synchronization.
  </p><p>This class does <i>not</i> offer real-time guarantees: it schedules
  tasks using the <tt>Object.wait(long)</tt> method.
  </p><p>Java 5.0 introduced the <code>java.util.concurrent</code> package and
  one of the concurrency utilities therein is the {@link
  java.util.concurrent.ScheduledThreadPoolExecutor
  ScheduledThreadPoolExecutor} which is a thread pool for repeatedly
  executing tasks at a given rate or delay.  It is effectively a more
  versatile replacement for the <code>Timer</code>/<code>TimerTask</code>
  combination, as it allows multiple service threads, accepts various
  time units, and doesn't require subclassing <code>TimerTask</code> (just
  implement <code>Runnable</code>).  Configuring {@code
  ScheduledThreadPoolExecutor} with one thread makes it equivalent to
  <code>Timer</code>.
  </p><p>Implementation note: This class scales to large numbers of concurrently
  scheduled tasks (thousands should present no problem).  Internally,
  it uses a binary heap to represent its task queue, so the cost to schedule
  a task is O(log n), where n is the number of concurrently scheduled tasks.
  </p><p>Implementation note: All constructors start a timer thread.
  @author  Josh Bloch
  @see     TimerTask
  @see     Object#wait(long)
  @since   1.3</p></div>
<a id="L88" name="L88"></a>  88 
<a id="L89" name="L89"></a>  89 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/8168.html" title="Multiple referred from 88 places.">Timer</a> <em class="brace">{</em>
<div class="comment">
      The timer task queue.  This data structure is shared with the timer
      thread.  The timer produces tasks, via its various schedule calls,
      and the timer thread consumes, executing timer tasks as appropriate,
      and removing them from the queue when they're obsolete.</div>
<a id="L96" name="L96"></a>  96     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/997.html#L569" title="Defined at 569 in src/java/util/Timer.java.">TaskQueue</a> queue = <strong class="reserved">new</strong> <a href="../S/997.html#L569" title="Defined at 569 in src/java/util/Timer.java.">TaskQueue</a>();
<a id="L97" name="L97"></a>  97 
<div class="comment">
      The timer thread.</div>
<a id="L101" name="L101"></a> 101     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/997.html#L481" title="Defined at 481 in src/java/util/Timer.java.">TimerThread</a> thread = <strong class="reserved">new</strong> <a href="../S/997.html#L481" title="Defined at 481 in src/java/util/Timer.java.">TimerThread</a>(queue);
<a id="L102" name="L102"></a> 102 
<div class="comment">
      This object causes the timer's task execution thread to exit
      gracefully when there are no live references to the Timer object and no
      tasks in the timer queue.  It is used in preference to a finalizer on
      Timer as such a finalizer would be susceptible to a subclass's
      finalizer forgetting to call it.</div>
<a id="L110" name="L110"></a> 110     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> threadReaper = <strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>() <em class="brace">{</em>
<a id="L111" name="L111"></a> 111         <strong class="reserved">protected</strong> <strong class="reserved">void</strong> <a href="../D/16080.html" title="Multiple defined in 41 places.">finalize</a>() <strong class="reserved">throws</strong> <a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> <em class="brace">{</em>
<a id="L112" name="L112"></a> 112             <strong class="reserved">synchronized</strong>(queue) <em class="brace">{</em>
<a id="L113" name="L113"></a> 113                 thread.newTasksMayBeScheduled = <strong class="reserved">false</strong>;
<a id="L114" name="L114"></a> 114                 queue.<a href="../D/28321.html" title="Multiple defined in 5 places.">notify</a>(); <em class="comment">// In case queue is empty.</em>
<a id="L115" name="L115"></a> 115             <em class="brace">}</em>
<a id="L116" name="L116"></a> 116         <em class="brace">}</em>
<a id="L117" name="L117"></a> 117     <em class="brace">}</em>;
<a id="L118" name="L118"></a> 118 
<div class="comment">
      This ID is used to generate thread names.</div>
<a id="L122" name="L122"></a> 122     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <a href="../S/1089.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicInteger.java.">AtomicInteger</a> nextSerialNumber = <strong class="reserved">new</strong> <a href="../S/1089.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicInteger.java.">AtomicInteger</a>(0);
<a id="L123" name="L123"></a> 123     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/26807.html" title="Multiple referred from 11 places.">serialNumber</a>() <em class="brace">{</em>
<a id="L124" name="L124"></a> 124         <strong class="reserved">return</strong> nextSerialNumber.<a href="../D/16942.html" title="Multiple defined in 8 places.">getAndIncrement</a>();
<a id="L125" name="L125"></a> 125     <em class="brace">}</em>
<a id="L126" name="L126"></a> 126 
<div class="comment">
      Creates a new timer.  The associated thread does <i>not</i>
      {@linkplain Thread#setDaemon run as a daemon}.</div>
<a id="L131" name="L131"></a> 131     <strong class="reserved">public</strong> Timer() <em class="brace">{</em>
<a id="L132" name="L132"></a> 132         <strong class="reserved">this</strong>("Timer-" + <a href="../S/997.html#L123" title="Defined at 123 in src/java/util/Timer.java.">serialNumber</a>());
<a id="L133" name="L133"></a> 133     <em class="brace">}</em>
<a id="L134" name="L134"></a> 134 
<div class="comment">
      Creates a new timer whose associated thread may be specified to
      {@linkplain Thread#setDaemon run as a daemon}.
      A daemon thread is called for if the timer will be used to
      schedule repeating "maintenance activities", which must be
      performed as long as the application is running, but should not
      prolong the lifetime of the application.
      @param isDaemon true if the associated thread should run as a daemon.</div>
<a id="L145" name="L145"></a> 145     <strong class="reserved">public</strong> Timer(<strong class="reserved">boolean</strong> <a href="../D/25396.html" title="Multiple defined in 2 places.">isDaemon</a>) <em class="brace">{</em>
<a id="L146" name="L146"></a> 146         <strong class="reserved">this</strong>("Timer-" + <a href="../S/997.html#L123" title="Defined at 123 in src/java/util/Timer.java.">serialNumber</a>(), <a href="../D/25396.html" title="Multiple defined in 2 places.">isDaemon</a>);
<a id="L147" name="L147"></a> 147     <em class="brace">}</em>
<a id="L148" name="L148"></a> 148 
<div class="comment">
      Creates a new timer whose associated thread has the specified name.
      The associated thread does <i>not</i>
      {@linkplain Thread#setDaemon run as a daemon}.
      @param name the name of the associated thread
      @throws NullPointerException if <code>name</code> is null
      @since 1.5</div>
<a id="L158" name="L158"></a> 158     <strong class="reserved">public</strong> Timer(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L159" name="L159"></a> 159         thread.<a href="../D/33314.html" title="Multiple defined in 37 places.">setName</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L160" name="L160"></a> 160         thread.<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>();
<a id="L161" name="L161"></a> 161     <em class="brace">}</em>
<a id="L162" name="L162"></a> 162 
<div class="comment">
      Creates a new timer whose associated thread has the specified name,
      and may be specified to
      {@linkplain Thread#setDaemon run as a daemon}.
      @param name the name of the associated thread
      @param isDaemon true if the associated thread should run as a daemon
      @throws NullPointerException if <code>name</code> is null
      @since 1.5</div>
<a id="L173" name="L173"></a> 173     <strong class="reserved">public</strong> Timer(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <strong class="reserved">boolean</strong> <a href="../D/25396.html" title="Multiple defined in 2 places.">isDaemon</a>) <em class="brace">{</em>
<a id="L174" name="L174"></a> 174         thread.<a href="../D/33314.html" title="Multiple defined in 37 places.">setName</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L175" name="L175"></a> 175         thread.<a href="../D/32347.html" title="Multiple defined in 2 places.">setDaemon</a>(<a href="../D/25396.html" title="Multiple defined in 2 places.">isDaemon</a>);
<a id="L176" name="L176"></a> 176         thread.<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>();
<a id="L177" name="L177"></a> 177     <em class="brace">}</em>
<a id="L178" name="L178"></a> 178 
<div class="comment">
      Schedules the specified task for execution after the specified delay.
      @param task  task to be scheduled.
      @param delay delay in milliseconds before task is to be executed.
      @throws IllegalArgumentException if <tt>delay</tt> is negative, or
              <tt>delay + System.currentTimeMillis()</tt> is negative.
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> is null</div>
<a id="L190" name="L190"></a> 190     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26667.html" title="Multiple referred from 16 places.">schedule</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <strong class="reserved">long</strong> <a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a>) <em class="brace">{</em>
<a id="L191" name="L191"></a> 191         <strong class="reserved">if</strong> (<a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a> &lt; 0)
<a id="L192" name="L192"></a> 192             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Negative delay.");
<a id="L193" name="L193"></a> 193         <a href="../S/997.html#L386" title="Defined at 386 in src/java/util/Timer.java.">sched</a>(task, <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>()+<a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a>, 0);
<a id="L194" name="L194"></a> 194     <em class="brace">}</em>
<a id="L195" name="L195"></a> 195 
<div class="comment">
      Schedules the specified task for execution at the specified time.  If
      the time is in the past, the task is scheduled for immediate execution.
      @param task task to be scheduled.
      @param time time at which task is to be executed.
      @throws IllegalArgumentException if <tt>time.getTime()</tt> is negative.
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> or <code>time</code> is null</div>
<a id="L207" name="L207"></a> 207     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26667.html" title="Multiple referred from 16 places.">schedule</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <a href="../D/2208.html" title="Multiple defined in 2 places.">Date</a> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>) <em class="brace">{</em>
<a id="L208" name="L208"></a> 208         <a href="../S/997.html#L386" title="Defined at 386 in src/java/util/Timer.java.">sched</a>(task, <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>.<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>(), 0);
<a id="L209" name="L209"></a> 209     <em class="brace">}</em>
<a id="L210" name="L210"></a> 210 
<div class="comment">
      Schedules the specified task for repeated <i>fixed-delay execution</i>,
      beginning after the specified delay.  Subsequent executions take place
      at approximately regular intervals separated by the specified period.
      <p>In fixed-delay execution, each execution is scheduled relative to
      the actual execution time of the previous execution.  If an execution
      is delayed for any reason (such as garbage collection or other
      background activity), subsequent executions will be delayed as well.
      In the long run, the frequency of execution will generally be slightly
      lower than the reciprocal of the specified period (assuming the system
      clock underlying <tt>Object.wait(long)</tt> is accurate).
      </p><p>Fixed-delay execution is appropriate for recurring activities
      that require "smoothness."  In other words, it is appropriate for
      activities where it is more important to keep the frequency accurate
      in the short run than in the long run.  This includes most animation
      tasks, such as blinking a cursor at regular intervals.  It also includes
      tasks wherein regular activity is performed in response to human
      input, such as automatically repeating a character as long as a key
      is held down.
      @param task   task to be scheduled.
      @param delay  delay in milliseconds before task is to be executed.
      @param period time in milliseconds between successive task executions.
      @throws IllegalArgumentException if <code>delay &lt; 0</code>, or
              <code>delay + System.currentTimeMillis() &lt; 0</code>, or
              <code>period &lt;= 0</code>
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> is null</p></div>
<a id="L243" name="L243"></a> 243     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26667.html" title="Multiple referred from 16 places.">schedule</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <strong class="reserved">long</strong> <a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a>, <strong class="reserved">long</strong> <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>) <em class="brace">{</em>
<a id="L244" name="L244"></a> 244         <strong class="reserved">if</strong> (<a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a> &lt; 0)
<a id="L245" name="L245"></a> 245             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Negative delay.");
<a id="L246" name="L246"></a> 246         <strong class="reserved">if</strong> (<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> &lt;= 0)
<a id="L247" name="L247"></a> 247             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Non-positive period.");
<a id="L248" name="L248"></a> 248         <a href="../S/997.html#L386" title="Defined at 386 in src/java/util/Timer.java.">sched</a>(task, <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>()+<a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a>, -<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>);
<a id="L249" name="L249"></a> 249     <em class="brace">}</em>
<a id="L250" name="L250"></a> 250 
<div class="comment">
      Schedules the specified task for repeated <i>fixed-delay execution</i>,
      beginning at the specified time. Subsequent executions take place at
      approximately regular intervals, separated by the specified period.
      <p>In fixed-delay execution, each execution is scheduled relative to
      the actual execution time of the previous execution.  If an execution
      is delayed for any reason (such as garbage collection or other
      background activity), subsequent executions will be delayed as well.
      In the long run, the frequency of execution will generally be slightly
      lower than the reciprocal of the specified period (assuming the system
      clock underlying <tt>Object.wait(long)</tt> is accurate).  As a
      consequence of the above, if the scheduled first time is in the past,
      it is scheduled for immediate execution.
      </p><p>Fixed-delay execution is appropriate for recurring activities
      that require "smoothness."  In other words, it is appropriate for
      activities where it is more important to keep the frequency accurate
      in the short run than in the long run.  This includes most animation
      tasks, such as blinking a cursor at regular intervals.  It also includes
      tasks wherein regular activity is performed in response to human
      input, such as automatically repeating a character as long as a key
      is held down.
      @param task   task to be scheduled.
      @param firstTime First time at which task is to be executed.
      @param period time in milliseconds between successive task executions.
      @throws IllegalArgumentException if <code>firstTime.getTime() &lt; 0</code>, or
              <code>period &lt;= 0</code>
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> or <code>firstTime</code> is null</p></div>
<a id="L284" name="L284"></a> 284     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26667.html" title="Multiple referred from 16 places.">schedule</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <a href="../D/2208.html" title="Multiple defined in 2 places.">Date</a> firstTime, <strong class="reserved">long</strong> <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>) <em class="brace">{</em>
<a id="L285" name="L285"></a> 285         <strong class="reserved">if</strong> (<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> &lt;= 0)
<a id="L286" name="L286"></a> 286             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Non-positive period.");
<a id="L287" name="L287"></a> 287         <a href="../S/997.html#L386" title="Defined at 386 in src/java/util/Timer.java.">sched</a>(task, firstTime.<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>(), -<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>);
<a id="L288" name="L288"></a> 288     <em class="brace">}</em>
<a id="L289" name="L289"></a> 289 
<div class="comment">
      Schedules the specified task for repeated <i>fixed-rate execution</i>,
      beginning after the specified delay.  Subsequent executions take place
      at approximately regular intervals, separated by the specified period.
      <p>In fixed-rate execution, each execution is scheduled relative to the
      scheduled execution time of the initial execution.  If an execution is
      delayed for any reason (such as garbage collection or other background
      activity), two or more executions will occur in rapid succession to
      "catch up."  In the long run, the frequency of execution will be
      exactly the reciprocal of the specified period (assuming the system
      clock underlying <tt>Object.wait(long)</tt> is accurate).
      </p><p>Fixed-rate execution is appropriate for recurring activities that
      are sensitive to <i>absolute</i> time, such as ringing a chime every
      hour on the hour, or running scheduled maintenance every day at a
      particular time.  It is also appropriate for recurring activities
      where the total time to perform a fixed number of executions is
      important, such as a countdown timer that ticks once every second for
      ten seconds.  Finally, fixed-rate execution is appropriate for
      scheduling multiple repeating timer tasks that must remain synchronized
      with respect to one another.
      @param task   task to be scheduled.
      @param delay  delay in milliseconds before task is to be executed.
      @param period time in milliseconds between successive task executions.
      @throws IllegalArgumentException if <code>delay &lt; 0</code>, or
              <code>delay + System.currentTimeMillis() &lt; 0</code>, or
              <code>period &lt;= 0</code>
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> is null</p></div>
<a id="L323" name="L323"></a> 323     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../S/1124.html#L735" title="Referred from 735 in src/java/util/concurrent/Executors.java.">scheduleAtFixedRate</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <strong class="reserved">long</strong> <a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a>, <strong class="reserved">long</strong> <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>) <em class="brace">{</em>
<a id="L324" name="L324"></a> 324         <strong class="reserved">if</strong> (<a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a> &lt; 0)
<a id="L325" name="L325"></a> 325             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Negative delay.");
<a id="L326" name="L326"></a> 326         <strong class="reserved">if</strong> (<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> &lt;= 0)
<a id="L327" name="L327"></a> 327             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Non-positive period.");
<a id="L328" name="L328"></a> 328         <a href="../S/997.html#L386" title="Defined at 386 in src/java/util/Timer.java.">sched</a>(task, <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>()+<a href="../S/2171.html#L532" title="Defined at 532 in src/java/awt/Robot.java.">delay</a>, <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>);
<a id="L329" name="L329"></a> 329     <em class="brace">}</em>
<a id="L330" name="L330"></a> 330 
<div class="comment">
      Schedules the specified task for repeated <i>fixed-rate execution</i>,
      beginning at the specified time. Subsequent executions take place at
      approximately regular intervals, separated by the specified period.
      <p>In fixed-rate execution, each execution is scheduled relative to the
      scheduled execution time of the initial execution.  If an execution is
      delayed for any reason (such as garbage collection or other background
      activity), two or more executions will occur in rapid succession to
      "catch up."  In the long run, the frequency of execution will be
      exactly the reciprocal of the specified period (assuming the system
      clock underlying <tt>Object.wait(long)</tt> is accurate).  As a
      consequence of the above, if the scheduled first time is in the past,
      then any "missed" executions will be scheduled for immediate "catch up"
      execution.
      </p><p>Fixed-rate execution is appropriate for recurring activities that
      are sensitive to <i>absolute</i> time, such as ringing a chime every
      hour on the hour, or running scheduled maintenance every day at a
      particular time.  It is also appropriate for recurring activities
      where the total time to perform a fixed number of executions is
      important, such as a countdown timer that ticks once every second for
      ten seconds.  Finally, fixed-rate execution is appropriate for
      scheduling multiple repeating timer tasks that must remain synchronized
      with respect to one another.
      @param task   task to be scheduled.
      @param firstTime First time at which task is to be executed.
      @param period time in milliseconds between successive task executions.
      @throws IllegalArgumentException if <code>firstTime.getTime() &lt; 0</code> or
              <code>period &lt;= 0</code>
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> or <code>firstTime</code> is null</p></div>
<a id="L366" name="L366"></a> 366     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../S/1124.html#L735" title="Referred from 735 in src/java/util/concurrent/Executors.java.">scheduleAtFixedRate</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <a href="../D/2208.html" title="Multiple defined in 2 places.">Date</a> firstTime,
<a id="L367" name="L367"></a> 367                                     <strong class="reserved">long</strong> <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>) <em class="brace">{</em>
<a id="L368" name="L368"></a> 368         <strong class="reserved">if</strong> (<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> &lt;= 0)
<a id="L369" name="L369"></a> 369             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Non-positive period.");
<a id="L370" name="L370"></a> 370         <a href="../S/997.html#L386" title="Defined at 386 in src/java/util/Timer.java.">sched</a>(task, firstTime.<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>(), <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>);
<a id="L371" name="L371"></a> 371     <em class="brace">}</em>
<a id="L372" name="L372"></a> 372 
<div class="comment">
      Schedule the specified timer task for execution at the specified
      time with the specified period, in milliseconds.  If period is
      positive, the task is scheduled for repeated execution; if period is
      zero, the task is scheduled for one-time execution. Time is specified
      in Date.getTime() format.  This method checks timer state, task state,
      and initial execution time, but not period.
      @throws IllegalArgumentException if <tt>time</tt> is negative.
      @throws IllegalStateException if task was already scheduled or
              cancelled, timer was cancelled, or timer thread terminated.
      @throws NullPointerException if <code>task</code> is null</div>
<a id="L386" name="L386"></a> 386     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/26666.html" title="Multiple referred from 6 places.">sched</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task, <strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <strong class="reserved">long</strong> <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>) <em class="brace">{</em>
<a id="L387" name="L387"></a> 387         <strong class="reserved">if</strong> (<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a> &lt; 0)
<a id="L388" name="L388"></a> 388             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Illegal execution time.");
<a id="L389" name="L389"></a> 389 
<a id="L390" name="L390"></a> 390         <em class="comment">// Constrain value of period sufficiently to prevent numeric</em>
<a id="L391" name="L391"></a> 391         <em class="comment">// overflow while still being effectively infinitely large.</em>
<a id="L392" name="L392"></a> 392         <strong class="reserved">if</strong> (<a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/10523.html" title="Multiple defined in 14 places.">abs</a>(<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>) &gt; (<a href="../S/1720.html#L54" title="Defined at 54 in src/java/lang/Long.java.">Long</a>.MAX_VALUE &gt;&gt; 1))
<a id="L393" name="L393"></a> 393             <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> &gt;&gt;= 1;
<a id="L394" name="L394"></a> 394 
<a id="L395" name="L395"></a> 395         <strong class="reserved">synchronized</strong>(queue) <em class="brace">{</em>
<a id="L396" name="L396"></a> 396             <strong class="reserved">if</strong> (!thread.newTasksMayBeScheduled)
<a id="L397" name="L397"></a> 397                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>("Timer already cancelled.");
<a id="L398" name="L398"></a> 398 
<a id="L399" name="L399"></a> 399             <strong class="reserved">synchronized</strong>(task.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L400" name="L400"></a> 400                 <strong class="reserved">if</strong> (task.<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> != <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>.VIRGIN)
<a id="L401" name="L401"></a> 401                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(
<a id="L402" name="L402"></a> 402                         "Task already scheduled or cancelled");
<a id="L403" name="L403"></a> 403                 task.nextExecutionTime = <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>;
<a id="L404" name="L404"></a> 404                 task.<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> = <a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>;
<a id="L405" name="L405"></a> 405                 task.<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>.SCHEDULED;
<a id="L406" name="L406"></a> 406             <em class="brace">}</em>
<a id="L407" name="L407"></a> 407 
<a id="L408" name="L408"></a> 408             queue.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(task);
<a id="L409" name="L409"></a> 409             <strong class="reserved">if</strong> (queue.<a href="../D/20628.html" title="Multiple defined in 6 places.">getMin</a>() == task)
<a id="L410" name="L410"></a> 410                 queue.<a href="../D/28321.html" title="Multiple defined in 5 places.">notify</a>();
<a id="L411" name="L411"></a> 411         <em class="brace">}</em>
<a id="L412" name="L412"></a> 412     <em class="brace">}</em>
<a id="L413" name="L413"></a> 413 
<div class="comment">
      Terminates this timer, discarding any currently scheduled tasks.
      Does not interfere with a currently executing task (if it exists).
      Once a timer has been terminated, its execution thread terminates
      gracefully, and no more tasks may be scheduled on it.
      <p>Note that calling this method from within the run method of a
      timer task that was invoked by this timer absolutely guarantees that
      the ongoing task execution is the last task execution that will ever
      be performed by this timer.
      </p><p>This method may be called repeatedly; the second and subsequent
      calls have no effect.</p></div>
<a id="L428" name="L428"></a> 428     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/10918.html" title="Multiple referred from 41 places.">cancel</a>() <em class="brace">{</em>
<a id="L429" name="L429"></a> 429         <strong class="reserved">synchronized</strong>(queue) <em class="brace">{</em>
<a id="L430" name="L430"></a> 430             thread.newTasksMayBeScheduled = <strong class="reserved">false</strong>;
<a id="L431" name="L431"></a> 431             queue.<a href="../D/12817.html" title="Multiple defined in 199 places.">clear</a>();
<a id="L432" name="L432"></a> 432             queue.<a href="../D/28321.html" title="Multiple defined in 5 places.">notify</a>();  <em class="comment">// In case queue was already empty.</em>
<a id="L433" name="L433"></a> 433         <em class="brace">}</em>
<a id="L434" name="L434"></a> 434     <em class="brace">}</em>
<a id="L435" name="L435"></a> 435 
<div class="comment">
      Removes all cancelled tasks from this timer's task queue.  <i>Calling
      this method has no effect on the behavior of the timer</i>, but
      eliminates the references to the cancelled tasks from the queue.
      If there are no external references to these tasks, they become
      eligible for garbage collection.
      <p>Most programs will have no need to call this method.
      It is designed for use by the rare application that cancels a large
      number of tasks.  Calling this method trades time for space: the
      runtime of the method may be proportional to n + c log n, where n
      is the number of tasks in the queue and c is the number of cancelled
      tasks.
      </p><p>Note that it is permissible to call this method from within a
      a task scheduled on this timer.
      @return the number of tasks removed from the queue.
      @since 1.5</p></div>
<a id="L456" name="L456"></a> 456      <strong class="reserved">public</strong> <strong class="reserved">int</strong> purge() <em class="brace">{</em>
<a id="L457" name="L457"></a> 457          <strong class="reserved">int</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = 0;
<a id="L458" name="L458"></a> 458 
<a id="L459" name="L459"></a> 459          <strong class="reserved">synchronized</strong>(queue) <em class="brace">{</em>
<a id="L460" name="L460"></a> 460              <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = queue.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i &gt; 0; i--) <em class="brace">{</em>
<a id="L461" name="L461"></a> 461                  <strong class="reserved">if</strong> (queue.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i).<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> == <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>.CANCELLED) <em class="brace">{</em>
<a id="L462" name="L462"></a> 462                      queue.<a href="../S/997.html#L636" title="Defined at 636 in src/java/util/Timer.java.">quickRemove</a>(i);
<a id="L463" name="L463"></a> 463                      <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>++;
<a id="L464" name="L464"></a> 464                  <em class="brace">}</em>
<a id="L465" name="L465"></a> 465              <em class="brace">}</em>
<a id="L466" name="L466"></a> 466 
<a id="L467" name="L467"></a> 467              <strong class="reserved">if</strong> (<a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> != 0)
<a id="L468" name="L468"></a> 468                  queue.<a href="../D/24228.html" title="Multiple defined in 4 places.">heapify</a>();
<a id="L469" name="L469"></a> 469          <em class="brace">}</em>
<a id="L470" name="L470"></a> 470 
<a id="L471" name="L471"></a> 471          <strong class="reserved">return</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>;
<a id="L472" name="L472"></a> 472      <em class="brace">}</em>
<a id="L473" name="L473"></a> 473 <em class="brace">}</em>
<a id="L474" name="L474"></a> 474 
<div class="comment">
  This "helper class" implements the timer's task execution thread, which
  waits for tasks on the timer queue, executions them when they fire,
  reschedules repeating tasks, and removes cancelled tasks and spent
  non-repeating tasks from the queue.</div>
<a id="L481" name="L481"></a> 481 <strong class="reserved">class</strong> <a href="../S/997.html#L101" title="Referred from 101 in src/java/util/Timer.java.">TimerThread</a> <strong class="reserved">extends</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <em class="brace">{</em>
<div class="comment">
      This flag is set to false by the reaper to inform us that there
      are no more live references to our Timer object.  Once this flag
      is true and there are no more tasks in our queue, there is no
      work left for us to do, so we terminate gracefully.  Note that
      this field is protected by queue's monitor!</div>
<a id="L489" name="L489"></a> 489     <strong class="reserved">boolean</strong> newTasksMayBeScheduled = <strong class="reserved">true</strong>;
<a id="L490" name="L490"></a> 490 
<div class="comment">
      Our Timer's queue.  We store this reference in preference to
      a reference to the Timer so the reference graph remains acyclic.
      Otherwise, the Timer would never be garbage-collected and this
      thread would never go away.</div>
<a id="L497" name="L497"></a> 497     <strong class="reserved">private</strong> <a href="../S/997.html#L569" title="Defined at 569 in src/java/util/Timer.java.">TaskQueue</a> queue;
<a id="L498" name="L498"></a> 498 
<a id="L499" name="L499"></a> 499     TimerThread(<a href="../S/997.html#L569" title="Defined at 569 in src/java/util/Timer.java.">TaskQueue</a> queue) <em class="brace">{</em>
<a id="L500" name="L500"></a> 500         <strong class="reserved">this</strong>.queue = queue;
<a id="L501" name="L501"></a> 501     <em class="brace">}</em>
<a id="L502" name="L502"></a> 502 
<a id="L503" name="L503"></a> 503     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26539.html" title="Multiple referred from 715 places.">run</a>() <em class="brace">{</em>
<a id="L504" name="L504"></a> 504         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L505" name="L505"></a> 505             <a href="../S/997.html#L518" title="Defined at 518 in src/java/util/Timer.java.">mainLoop</a>();
<a id="L506" name="L506"></a> 506         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L507" name="L507"></a> 507             <em class="comment">// Someone killed this Thread, behave as if Timer cancelled</em>
<a id="L508" name="L508"></a> 508             <strong class="reserved">synchronized</strong>(queue) <em class="brace">{</em>
<a id="L509" name="L509"></a> 509                 newTasksMayBeScheduled = <strong class="reserved">false</strong>;
<a id="L510" name="L510"></a> 510                 queue.<a href="../D/12817.html" title="Multiple defined in 199 places.">clear</a>();  <em class="comment">// Eliminate obsolete references</em>
<a id="L511" name="L511"></a> 511             <em class="brace">}</em>
<a id="L512" name="L512"></a> 512         <em class="brace">}</em>
<a id="L513" name="L513"></a> 513     <em class="brace">}</em>
<a id="L514" name="L514"></a> 514 
<div class="comment">
      The main timer loop.  (See class comment.)</div>
<a id="L518" name="L518"></a> 518     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/22810.html" title="Multiple referred from 7 places.">mainLoop</a>() <em class="brace">{</em>
<a id="L519" name="L519"></a> 519         <strong class="reserved">while</strong> (<strong class="reserved">true</strong>) <em class="brace">{</em>
<a id="L520" name="L520"></a> 520             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L521" name="L521"></a> 521                 <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task;
<a id="L522" name="L522"></a> 522                 <strong class="reserved">boolean</strong> taskFired;
<a id="L523" name="L523"></a> 523                 <strong class="reserved">synchronized</strong>(queue) <em class="brace">{</em>
<a id="L524" name="L524"></a> 524                     <em class="comment">// Wait for queue to become non-empty</em>
<a id="L525" name="L525"></a> 525                     <strong class="reserved">while</strong> (queue.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>() &amp;&amp; newTasksMayBeScheduled)
<a id="L526" name="L526"></a> 526                         queue.<a href="../D/36778.html" title="Multiple defined in 3 places.">wait</a>();
<a id="L527" name="L527"></a> 527                     <strong class="reserved">if</strong> (queue.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L528" name="L528"></a> 528                         <strong class="reserved">break</strong>; <em class="comment">// Queue is empty and will forever remain; die</em>
<a id="L529" name="L529"></a> 529 
<a id="L530" name="L530"></a> 530                     <em class="comment">// Queue nonempty; look at first evt and do the right thing</em>
<a id="L531" name="L531"></a> 531                     <strong class="reserved">long</strong> currentTime, executionTime;
<a id="L532" name="L532"></a> 532                     task = queue.<a href="../D/20628.html" title="Multiple defined in 6 places.">getMin</a>();
<a id="L533" name="L533"></a> 533                     <strong class="reserved">synchronized</strong>(task.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>) <em class="brace">{</em>
<a id="L534" name="L534"></a> 534                         <strong class="reserved">if</strong> (task.<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> == <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>.CANCELLED) <em class="brace">{</em>
<a id="L535" name="L535"></a> 535                             queue.<a href="../S/997.html#L625" title="Defined at 625 in src/java/util/Timer.java.">removeMin</a>();
<a id="L536" name="L536"></a> 536                             <strong class="reserved">continue</strong>;  <em class="comment">// No action required, poll queue again</em>
<a id="L537" name="L537"></a> 537                         <em class="brace">}</em>
<a id="L538" name="L538"></a> 538                         currentTime = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>();
<a id="L539" name="L539"></a> 539                         executionTime = task.nextExecutionTime;
<a id="L540" name="L540"></a> 540                         <strong class="reserved">if</strong> (taskFired = (executionTime&lt;=currentTime)) <em class="brace">{</em>
<a id="L541" name="L541"></a> 541                             <strong class="reserved">if</strong> (task.<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a> == 0) <em class="brace">{</em> <em class="comment">// Non-repeating, remove</em>
<a id="L542" name="L542"></a> 542                                 queue.<a href="../S/997.html#L625" title="Defined at 625 in src/java/util/Timer.java.">removeMin</a>();
<a id="L543" name="L543"></a> 543                                 task.<a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>.EXECUTED;
<a id="L544" name="L544"></a> 544                             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Repeating task, reschedule</em>
<a id="L545" name="L545"></a> 545                                 queue.<a href="../S/997.html#L647" title="Defined at 647 in src/java/util/Timer.java.">rescheduleMin</a>(
<a id="L546" name="L546"></a> 546                                   task.<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>&lt;0 ? currentTime   - task.<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>
<a id="L547" name="L547"></a> 547                                                 : executionTime + task.<a href="../D/29329.html" title="Multiple defined in 2 places.">period</a>);
<a id="L548" name="L548"></a> 548                             <em class="brace">}</em>
<a id="L549" name="L549"></a> 549                         <em class="brace">}</em>
<a id="L550" name="L550"></a> 550                     <em class="brace">}</em>
<a id="L551" name="L551"></a> 551                     <strong class="reserved">if</strong> (!taskFired) <em class="comment">// Task hasn't yet fired; wait</em>
<a id="L552" name="L552"></a> 552                         queue.<a href="../D/36778.html" title="Multiple defined in 3 places.">wait</a>(executionTime - currentTime);
<a id="L553" name="L553"></a> 553                 <em class="brace">}</em>
<a id="L554" name="L554"></a> 554                 <strong class="reserved">if</strong> (taskFired)  <em class="comment">// Task fired; run it, holding no locks</em>
<a id="L555" name="L555"></a> 555                     task.<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>();
<a id="L556" name="L556"></a> 556             <em class="brace">}</em> <strong class="reserved">catch</strong>(<a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> e) <em class="brace">{</em>
<a id="L557" name="L557"></a> 557             <em class="brace">}</em>
<a id="L558" name="L558"></a> 558         <em class="brace">}</em>
<a id="L559" name="L559"></a> 559     <em class="brace">}</em>
<a id="L560" name="L560"></a> 560 <em class="brace">}</em>
<a id="L561" name="L561"></a> 561 
<div class="comment">
  This class represents a timer task queue: a priority queue of TimerTasks,
  ordered on nextExecutionTime.  Each Timer object has one of these, which it
  shares with its TimerThread.  Internally this class uses a heap, which
  offers log(n) performance for the add, removeMin and rescheduleMin
  operations, and constant time performance for the getMin operation.</div>
<a id="L569" name="L569"></a> 569 <strong class="reserved">class</strong> <a href="../R/8039.html" title="Multiple referred from 3 places.">TaskQueue</a> <em class="brace">{</em>
<div class="comment">
      Priority queue represented as a balanced binary heap: the two children
      of queue[n] are queue[2*n] and queue[2*n+1].  The priority queue is
      ordered on the nextExecutionTime field: The TimerTask with the lowest
      nextExecutionTime is in queue[1] (assuming the queue is nonempty).  For
      each node n in the heap, and each descendant of n, d,
      n.nextExecutionTime &lt;= d.nextExecutionTime.</div>
<a id="L578" name="L578"></a> 578     <strong class="reserved">private</strong> <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>[] queue = <strong class="reserved">new</strong> <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a>[128];
<a id="L579" name="L579"></a> 579 
<div class="comment">
      The number of tasks in the priority queue.  (The tasks are stored in
      queue[1] up to queue[size]).</div>
<a id="L584" name="L584"></a> 584     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = 0;
<a id="L585" name="L585"></a> 585 
<div class="comment">
      Returns the number of tasks currently on the queue.</div>
<a id="L589" name="L589"></a> 589     <strong class="reserved">int</strong> <a href="../R/28639.html" title="Multiple referred from 5617 places.">size</a>() <em class="brace">{</em>
<a id="L590" name="L590"></a> 590         <strong class="reserved">return</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L591" name="L591"></a> 591     <em class="brace">}</em>
<a id="L592" name="L592"></a> 592 
<div class="comment">
      Adds a new task to the priority queue.</div>
<a id="L596" name="L596"></a> 596     <strong class="reserved">void</strong> <a href="../R/9592.html" title="Multiple referred from 2612 places.">add</a>(<a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> task) <em class="brace">{</em>
<a id="L597" name="L597"></a> 597         <em class="comment">// Grow backing store if necessary</em>
<a id="L598" name="L598"></a> 598         <strong class="reserved">if</strong> (<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> + 1 == queue.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>)
<a id="L599" name="L599"></a> 599             queue = <a href="../S/1150.html#L71" title="Defined at 71 in src/java/util/Arrays.java.">Arrays</a>.<a href="../D/13512.html" title="Multiple defined in 12 places.">copyOf</a>(queue, 2*queue.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L600" name="L600"></a> 600 
<a id="L601" name="L601"></a> 601         queue[++<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>] = task;
<a id="L602" name="L602"></a> 602         <a href="../S/997.html#L679" title="Defined at 679 in src/java/util/Timer.java.">fixUp</a>(<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>);
<a id="L603" name="L603"></a> 603     <em class="brace">}</em>
<a id="L604" name="L604"></a> 604 
<div class="comment">
      Return the "head task" of the priority queue.  (The head task is an
      task with the lowest nextExecutionTime.)</div>
<a id="L609" name="L609"></a> 609     <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> <a href="../R/17709.html" title="Multiple referred from 24 places.">getMin</a>() <em class="brace">{</em>
<a id="L610" name="L610"></a> 610         <strong class="reserved">return</strong> queue[1];
<a id="L611" name="L611"></a> 611     <em class="brace">}</em>
<a id="L612" name="L612"></a> 612 
<div class="comment">
      Return the ith task in the priority queue, where i ranges from 1 (the
      head task, which is returned by getMin) to the number of tasks on the
      queue, inclusive.</div>
<a id="L618" name="L618"></a> 618     <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> <a href="../R/14874.html" title="Multiple referred from 4230 places.">get</a>(<strong class="reserved">int</strong> i) <em class="brace">{</em>
<a id="L619" name="L619"></a> 619         <strong class="reserved">return</strong> queue[i];
<a id="L620" name="L620"></a> 620     <em class="brace">}</em>
<a id="L621" name="L621"></a> 621 
<div class="comment">
      Remove the head task from the priority queue.</div>
<a id="L625" name="L625"></a> 625     <strong class="reserved">void</strong> <a href="../R/26022.html" title="Multiple referred from 2 places.">removeMin</a>() <em class="brace">{</em>
<a id="L626" name="L626"></a> 626         queue[1] = queue[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>];
<a id="L627" name="L627"></a> 627         queue[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>--] = <strong class="reserved">null</strong>;  <em class="comment">// Drop extra reference to prevent memory leak</em>
<a id="L628" name="L628"></a> 628         <a href="../S/997.html#L699" title="Defined at 699 in src/java/util/Timer.java.">fixDown</a>(1);
<a id="L629" name="L629"></a> 629     <em class="brace">}</em>
<a id="L630" name="L630"></a> 630 
<div class="comment">
      Removes the ith element from queue without regard for maintaining
      the heap invariant.  Recall that queue is one-based, so
      1 &lt;= i &lt;= size.</div>
<a id="L636" name="L636"></a> 636     <strong class="reserved">void</strong> <a href="../S/997.html#L462" title="Referred from 462 in src/java/util/Timer.java.">quickRemove</a>(<strong class="reserved">int</strong> i) <em class="brace">{</em>
<a id="L637" name="L637"></a> 637         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> i &lt;= <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L638" name="L638"></a> 638 
<a id="L639" name="L639"></a> 639         queue[i] = queue[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>];
<a id="L640" name="L640"></a> 640         queue[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>--] = <strong class="reserved">null</strong>;  <em class="comment">// Drop extra ref to prevent memory leak</em>
<a id="L641" name="L641"></a> 641     <em class="brace">}</em>
<a id="L642" name="L642"></a> 642 
<div class="comment">
      Sets the nextExecutionTime associated with the head task to the
      specified value, and adjusts priority queue accordingly.</div>
<a id="L647" name="L647"></a> 647     <strong class="reserved">void</strong> <a href="../S/997.html#L545" title="Referred from 545 in src/java/util/Timer.java.">rescheduleMin</a>(<strong class="reserved">long</strong> newTime) <em class="brace">{</em>
<a id="L648" name="L648"></a> 648         queue[1].nextExecutionTime = newTime;
<a id="L649" name="L649"></a> 649         <a href="../S/997.html#L699" title="Defined at 699 in src/java/util/Timer.java.">fixDown</a>(1);
<a id="L650" name="L650"></a> 650     <em class="brace">}</em>
<a id="L651" name="L651"></a> 651 
<div class="comment">
      Returns true if the priority queue contains no elements.</div>
<a id="L655" name="L655"></a> 655     <strong class="reserved">boolean</strong> <a href="../R/21404.html" title="Multiple referred from 435 places.">isEmpty</a>() <em class="brace">{</em>
<a id="L656" name="L656"></a> 656         <strong class="reserved">return</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>==0;
<a id="L657" name="L657"></a> 657     <em class="brace">}</em>
<a id="L658" name="L658"></a> 658 
<div class="comment">
      Removes all elements from the priority queue.</div>
<a id="L662" name="L662"></a> 662     <strong class="reserved">void</strong> <a href="../R/11497.html" title="Multiple referred from 522 places.">clear</a>() <em class="brace">{</em>
<a id="L663" name="L663"></a> 663         <em class="comment">// Null out task references to prevent memory leak</em>
<a id="L664" name="L664"></a> 664         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=1; i&lt;=<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>; i++)
<a id="L665" name="L665"></a> 665             queue[i] = <strong class="reserved">null</strong>;
<a id="L666" name="L666"></a> 666 
<a id="L667" name="L667"></a> 667         <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = 0;
<a id="L668" name="L668"></a> 668     <em class="brace">}</em>
<a id="L669" name="L669"></a> 669 
<div class="comment">
      Establishes the heap invariant (described above) assuming the heap
      satisfies the invariant except possibly for the leaf-node indexed by k
      (which may have a nextExecutionTime less than its parent's).
      This method functions by "promoting" queue[k] up the hierarchy
      (by swapping it with its parent) repeatedly until queue[k]'s
      nextExecutionTime is greater than or equal to that of its parent.</div>
<a id="L679" name="L679"></a> 679     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/997.html#L602" title="Referred from 602 in src/java/util/Timer.java.">fixUp</a>(<strong class="reserved">int</strong> k) <em class="brace">{</em>
<a id="L680" name="L680"></a> 680         <strong class="reserved">while</strong> (k &gt; 1) <em class="brace">{</em>
<a id="L681" name="L681"></a> 681             <strong class="reserved">int</strong> j = k &gt;&gt; 1;
<a id="L682" name="L682"></a> 682             <strong class="reserved">if</strong> (queue[j].nextExecutionTime &lt;= queue[k].nextExecutionTime)
<a id="L683" name="L683"></a> 683                 <strong class="reserved">break</strong>;
<a id="L684" name="L684"></a> 684             <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> tmp = queue[j];  queue[j] = queue[k]; queue[k] = tmp;
<a id="L685" name="L685"></a> 685             k = j;
<a id="L686" name="L686"></a> 686         <em class="brace">}</em>
<a id="L687" name="L687"></a> 687     <em class="brace">}</em>
<a id="L688" name="L688"></a> 688 
<div class="comment">
      Establishes the heap invariant (described above) in the subtree
      rooted at k, which is assumed to satisfy the heap invariant except
      possibly for node k itself (which may have a nextExecutionTime greater
      than its children's).
      This method functions by "demoting" queue[k] down the hierarchy
      (by swapping it with its smaller child) repeatedly until queue[k]'s
      nextExecutionTime is less than or equal to those of its children.</div>
<a id="L699" name="L699"></a> 699     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/14650.html" title="Multiple referred from 3 places.">fixDown</a>(<strong class="reserved">int</strong> k) <em class="brace">{</em>
<a id="L700" name="L700"></a> 700         <strong class="reserved">int</strong> j;
<a id="L701" name="L701"></a> 701         <strong class="reserved">while</strong> ((j = k &lt;&lt; 1) &lt;= <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> &amp;&amp; j &gt; 0) <em class="brace">{</em>
<a id="L702" name="L702"></a> 702             <strong class="reserved">if</strong> (j &lt; <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> &amp;&amp;
<a id="L703" name="L703"></a> 703                 queue[j].nextExecutionTime &gt; queue[j+1].nextExecutionTime)
<a id="L704" name="L704"></a> 704                 j++; <em class="comment">// j indexes smallest kid</em>
<a id="L705" name="L705"></a> 705             <strong class="reserved">if</strong> (queue[k].nextExecutionTime &lt;= queue[j].nextExecutionTime)
<a id="L706" name="L706"></a> 706                 <strong class="reserved">break</strong>;
<a id="L707" name="L707"></a> 707             <a href="../S/999.html#L36" title="Defined at 36 in src/java/util/TimerTask.java.">TimerTask</a> tmp = queue[j];  queue[j] = queue[k]; queue[k] = tmp;
<a id="L708" name="L708"></a> 708             k = j;
<a id="L709" name="L709"></a> 709         <em class="brace">}</em>
<a id="L710" name="L710"></a> 710     <em class="brace">}</em>
<a id="L711" name="L711"></a> 711 
<div class="comment">
      Establishes the heap invariant (described above) in the entire tree,
      assuming nothing about the order of the elements prior to the call.</div>
<a id="L716" name="L716"></a> 716     <strong class="reserved">void</strong> <a href="../R/20306.html" title="Multiple referred from 13 places.">heapify</a>() <em class="brace">{</em>
<a id="L717" name="L717"></a> 717         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>/2; i &gt;= 1; i--)
<a id="L718" name="L718"></a> 718             <a href="../S/997.html#L699" title="Defined at 699 in src/java/util/Timer.java.">fixDown</a>(i);
<a id="L719" name="L719"></a> 719     <em class="brace">}</em>
<a id="L720" name="L720"></a> 720 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L123">[^]</a><a href="#L716">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>