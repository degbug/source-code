<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/org/apache/xerces/internal/impl/dtd/models/DFAContentModel.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L291">[^]</a><a href="#L986">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L291" title="Defined at 291.">validate</a></li>
<li><a href="#L430" title="Defined at 430.">buildDFA</a></li>
<li><a href="#L801" title="Defined at 801.">calcFollowList</a></li>
<li><a href="#L905" title="Defined at 905.">dumpTree</a></li>
<li><a href="#L977" title="Defined at 977.">makeDefStateList</a></li>
<li><a href="#L986" title="Defined at 986.">postTreeBuildInit</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<div class="comment">
  The Apache Software License, Version 1.1
  Copyright (c) 1999-2002 The Apache Software Foundation.  All rights
  reserved.
  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions
  are met:
  1. Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.
  2. Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in
     the documentation and/or other materials provided with the
     distribution.
  3. The end-user documentation included with the redistribution,
     if any, must include the following acknowledgment:
        "This product includes software developed by the
         Apache Software Foundation (http://www.apache.org/)."
     Alternately, this acknowledgment may appear in the software itself,
     if and wherever such third-party acknowledgments normally appear.
  4. The names "Xerces" and "Apache Software Foundation" must
     not be used to endorse or promote products derived from this
     software without prior written permission. For written
     permission, please contact apache@apache.org.
  5. Products derived from this software may not be called "Apache",
     nor may "Apache" appear in their name, without prior written
     permission of the Apache Software Foundation.
  THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
  ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
  USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  SUCH DAMAGE.
  ====================================================================
  This software consists of voluntary contributions made by many
  individuals on behalf of the Apache Software Foundation and was
  originally based on software copyright (c) 1999, International
  Business Machines, Inc., http://www.apache.org.  For more
  information on the Apache Software Foundation, please see
  <http: www.apache.org />.</div>
<a id="L61" name="L61"></a>  61 
<a id="L62" name="L62"></a>  62 <strong class="reserved">package</strong> com.sun.org.apache.xerces.internal.<a href="../S/7010.html#L693" title="Defined at 693 in src/com/sun/corba/se/impl/encoding/CodeSetConversion.java.">impl</a>.dtd.models;
<a id="L63" name="L63"></a>  63 
<a id="L64" name="L64"></a>  64 <strong class="reserved">import</strong> java.util.HashMap;
<a id="L65" name="L65"></a>  65 
<a id="L66" name="L66"></a>  66 <strong class="reserved">import</strong> com.sun.org.apache.xerces.internal.impl.dtd.XMLContentSpec;
<a id="L67" name="L67"></a>  67 <strong class="reserved">import</strong> com.sun.org.apache.xerces.internal.xni.QName;
<a id="L68" name="L68"></a>  68 
<div class="comment">
  @version $Id: DFAContentModel.java,v 1.4 2010/08/06 23:49:43 joehw Exp $
  DFAContentModel is the derivative of ContentModel that does
  all of the non-trivial element content validation. This class does
  the conversion from the regular expression to the DFA that
  it then uses in its validation algorithm.
  <p>
  <b>Note:</b> Upstream work insures that this class will never see
  a content model with PCDATA in it. Any model with PCDATA is 'mixed'
  and is handled via the MixedContentModel class since mixed models
  are very constrained in form and easily handled via a special case.
  This also makes implementation of this class much easier.
  @xerces.internal
  @version $Id: DFAContentModel.java,v 1.4 2010/08/06 23:49:43 joehw Exp $</p></div>
<a id="L87" name="L87"></a>  87 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/1858.html" title="Multiple referred from 2 places.">DFAContentModel</a>
<a id="L88" name="L88"></a>  88     <strong class="reserved">implements</strong> <a href="../S/5150.html#L68" title="Defined at 68 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/ContentModelValidator.java.">ContentModelValidator</a> <em class="brace">{</em>
<a id="L89" name="L89"></a>  89 
<a id="L90" name="L90"></a>  90     <em class="comment">//</em>
<a id="L91" name="L91"></a>  91     <em class="comment">// Constants</em>
<a id="L92" name="L92"></a>  92     <em class="comment">//</em>
<a id="L93" name="L93"></a>  93     <em class="comment">// special strings</em>
<a id="L94" name="L94"></a>  94 
<div class="comment">
     /** Epsilon string. */</div>
<a id="L96" name="L96"></a>  96     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> fEpsilonString = "&lt;&lt;CMNODE_EPSILON&gt;&gt;";
<a id="L97" name="L97"></a>  97 
<div class="comment">
     /** End-of-content string. */</div>
<a id="L99" name="L99"></a>  99     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> fEOCString = "&lt;&lt;CMNODE_EOC&gt;&gt;";
<a id="L100" name="L100"></a> 100 
<div class="comment">
     /** initializing static members **/</div>
<a id="L102" name="L102"></a> 102     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L103" name="L103"></a> 103         fEpsilonString = fEpsilonString.<a href="../S/1729.html#L3167" title="Defined at 3167 in src/java/lang/String.java.">intern</a>();
<a id="L104" name="L104"></a> 104         fEOCString = fEOCString.<a href="../S/1729.html#L3167" title="Defined at 3167 in src/java/lang/String.java.">intern</a>();
<a id="L105" name="L105"></a> 105     <em class="brace">}</em>
<a id="L106" name="L106"></a> 106 
<a id="L107" name="L107"></a> 107     <em class="comment">// debugging</em>
<a id="L108" name="L108"></a> 108 
<div class="comment">
     /** Set to true to debug content model validation. */</div>
<a id="L110" name="L110"></a> 110     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> DEBUG_VALIDATE_CONTENT = <strong class="reserved">false</strong>;
<a id="L111" name="L111"></a> 111 
<a id="L112" name="L112"></a> 112     <em class="comment">//</em>
<a id="L113" name="L113"></a> 113     <em class="comment">// Data</em>
<a id="L114" name="L114"></a> 114     <em class="comment">//</em>
<a id="L115" name="L115"></a> 115 
<div class="comment">
     /* this is the EquivClassComparator object */</div>
<a id="L117" name="L117"></a> 117     <em class="comment">//private EquivClassComparator comparator = null;</em>
<a id="L118" name="L118"></a> 118 
<div class="comment">
      This is the map of unique input symbol elements to indices into
      each state's per-input symbol transition table entry. This is part
      of the built DFA information that must be kept around to do the
      actual validation.</div>
<a id="L125" name="L125"></a> 125     <strong class="reserved">private</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> fElemMap[] = <strong class="reserved">null</strong>;
<a id="L126" name="L126"></a> 126 
<div class="comment">
      This is a map of whether the element map contains information
      related to ANY models.</div>
<a id="L131" name="L131"></a> 131     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fElemMapType[] = <strong class="reserved">null</strong>;
<a id="L132" name="L132"></a> 132 
<div class="comment">
     /** The element map size. */</div>
<a id="L134" name="L134"></a> 134     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fElemMapSize = 0;
<a id="L135" name="L135"></a> 135 
<div class="comment">
     /** Boolean to distinguish Schema Mixed Content */</div>
<a id="L137" name="L137"></a> 137     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> fMixed;
<a id="L138" name="L138"></a> 138 
<div class="comment">
      The NFA position of the special EOC (end of content) node. This
      is saved away since it's used during the DFA build.</div>
<a id="L143" name="L143"></a> 143     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fEOCPos = 0;
<a id="L144" name="L144"></a> 144 
<a id="L145" name="L145"></a> 145 
<div class="comment">
      This is an array of booleans, one per state (there are
      fTransTableSize states in the DFA) that indicates whether that
      state is a final state.</div>
<a id="L151" name="L151"></a> 151     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> fFinalStateFlags[] = <strong class="reserved">null</strong>;
<a id="L152" name="L152"></a> 152 
<div class="comment">
      The list of follow positions for each NFA position (i.e. for each
      non-epsilon leaf node.) This is only used during the building of
      the DFA, and is let go afterwards.</div>
<a id="L158" name="L158"></a> 158     <strong class="reserved">private</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> fFollowList[] = <strong class="reserved">null</strong>;
<a id="L159" name="L159"></a> 159 
<div class="comment">
      This is the head node of our intermediate representation. It is
      only non-null during the building of the DFA (just so that it
      does not have to be passed all around.) Once the DFA is built,
      this is no longer required so its nulled out.</div>
<a id="L166" name="L166"></a> 166     <strong class="reserved">private</strong> <a href="../S/5151.html#L70" title="Defined at 70 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">CMNode</a> fHeadNode = <strong class="reserved">null</strong>;
<a id="L167" name="L167"></a> 167 
<div class="comment">
      The count of leaf nodes. This is an important number that set some
      limits on the sizes of data structures in the DFA process.</div>
<a id="L172" name="L172"></a> 172     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fLeafCount = 0;
<a id="L173" name="L173"></a> 173 
<div class="comment">
      An array of non-epsilon leaf nodes, which is used during the DFA
      build operation, then dropped.</div>
<a id="L178" name="L178"></a> 178     <strong class="reserved">private</strong> <a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a> fLeafList[] = <strong class="reserved">null</strong>;
<a id="L179" name="L179"></a> 179 
<div class="comment">
     /** Array mapping ANY types to the leaf list. */</div>
<a id="L181" name="L181"></a> 181     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fLeafListType[] = <strong class="reserved">null</strong>;
<a id="L182" name="L182"></a> 182 
<a id="L183" name="L183"></a> 183     <em class="comment">//private ContentLeafNameTypeVector fLeafNameTypeVector = null;</em>
<a id="L184" name="L184"></a> 184 
<div class="comment">
      The string pool of our parser session. This is set during construction
      and kept around.</div>
<a id="L189" name="L189"></a> 189     <em class="comment">//private StringPool fStringPool = null;</em>
<a id="L190" name="L190"></a> 190 
<div class="comment">
      This is the transition table that is the main by product of all
      of the effort here. It is an array of arrays of ints. The first
      dimension is the number of states we end up with in the DFA. The
      second dimensions is the number of unique elements in the content
      model (fElemMapSize). Each entry in the second dimension indicates
      the new state given that input for the first dimension's start
      state.
      <p>
      The fElemMap array handles mapping from element indexes to
      positions in the second dimension of the transition table.</p></div>
<a id="L203" name="L203"></a> 203     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fTransTable[][] = <strong class="reserved">null</strong>;
<a id="L204" name="L204"></a> 204 
<div class="comment">
      The number of valid entries in the transition table, and in the other
      related tables such as fFinalStateFlags.</div>
<a id="L209" name="L209"></a> 209     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fTransTableSize = 0;
<a id="L210" name="L210"></a> 210 
<div class="comment">
      Flag that indicates that even though we have a "complicated"
      content model, it is valid to have no content. In other words,
      all parts of the content model are optional. For example:
      <pre>           &lt;!ELEMENT AllOptional (Optional*,NotRequired?)&gt;
      </pre></div>
<a id="L219" name="L219"></a> 219     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> fEmptyContentIsValid = <strong class="reserved">false</strong>;
<a id="L220" name="L220"></a> 220 
<a id="L221" name="L221"></a> 221     <em class="comment">// temp variables</em>
<a id="L222" name="L222"></a> 222 
<div class="comment">
     /** Temporary qualified name. */</div>
<a id="L224" name="L224"></a> 224     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> fQName = <strong class="reserved">new</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a>();
<a id="L225" name="L225"></a> 225 
<a id="L226" name="L226"></a> 226     <em class="comment">//</em>
<a id="L227" name="L227"></a> 227     <em class="comment">// Constructors</em>
<a id="L228" name="L228"></a> 228     <em class="comment">//</em>
<a id="L229" name="L229"></a> 229 
<a id="L230" name="L230"></a> 230 
<a id="L231" name="L231"></a> 231     <em class="comment">//</em>
<a id="L232" name="L232"></a> 232     <em class="comment">// Constructors</em>
<a id="L233" name="L233"></a> 233     <em class="comment">//</em>
<a id="L234" name="L234"></a> 234 
<div class="comment">
      Constructs a DFA content model.
      @param syntaxTree    The syntax tree of the content model.
      @param leafCount     The number of leaves.
      @param mixed</div>
<a id="L243" name="L243"></a> 243     <strong class="reserved">public</strong> DFAContentModel(<a href="../S/5151.html#L70" title="Defined at 70 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">CMNode</a> syntaxTree, <strong class="reserved">int</strong> leafCount, <strong class="reserved">boolean</strong> mixed) <em class="brace">{</em>
<a id="L244" name="L244"></a> 244         <em class="comment">// Store away our index and pools in members</em>
<a id="L245" name="L245"></a> 245         <em class="comment">//fStringPool = stringPool;</em>
<a id="L246" name="L246"></a> 246         fLeafCount = leafCount;
<a id="L247" name="L247"></a> 247 
<a id="L248" name="L248"></a> 248 
<a id="L249" name="L249"></a> 249         <em class="comment">// this is for Schema Mixed Content</em>
<a id="L250" name="L250"></a> 250         fMixed = mixed;
<a id="L251" name="L251"></a> 251 
<a id="L252" name="L252"></a> 252         <em class="comment">//</em>
<a id="L253" name="L253"></a> 253         <em class="comment">//  Ok, so lets grind through the building of the DFA. This method</em>
<a id="L254" name="L254"></a> 254         <em class="comment">//  handles the high level logic of the algorithm, but it uses a</em>
<a id="L255" name="L255"></a> 255         <em class="comment">//  number of helper classes to do its thing.</em>
<a id="L256" name="L256"></a> 256         <em class="comment">//</em>
<a id="L257" name="L257"></a> 257         <em class="comment">//  In order to avoid having hundreds of references to the error and</em>
<a id="L258" name="L258"></a> 258         <em class="comment">//  string handlers around, this guy and all of his helper classes</em>
<a id="L259" name="L259"></a> 259         <em class="comment">//  just throw a simple exception and we then pass it along.</em>
<a id="L260" name="L260"></a> 260         <em class="comment">//</em>
<a id="L261" name="L261"></a> 261         <a href="../D/11945.html" title="Multiple defined in 2 places.">buildDFA</a>(syntaxTree);
<a id="L262" name="L262"></a> 262     <em class="brace">}</em>
<a id="L263" name="L263"></a> 263 
<a id="L264" name="L264"></a> 264     <em class="comment">//</em>
<a id="L265" name="L265"></a> 265     <em class="comment">// ContentModelValidator methods</em>
<a id="L266" name="L266"></a> 266     <em class="comment">//</em>
<a id="L267" name="L267"></a> 267 
<div class="comment">
      Check that the specified content is valid according to this
      content model. This method can also be called to do 'what if'
      testing of content models just to see if they would be valid.
      <p>
      A value of -1 in the children array indicates a PCDATA node. All other
      indexes will be positive and represent child elements. The count can be
      zero, since some elements have the EMPTY content model and that must be
      confirmed.
      @param children The children of this element.  Each integer is an index within
                      the <code>StringPool</code> of the child element name.  An index
                      of -1 is used to indicate an occurrence of non-whitespace character
                      data.
      @param offset Offset into the array where the children starts.
      @param length The number of entries in the <code>children</code> array.
      @return The value -1 if fully valid, else the 0 based index of the child
              that first failed. If the value returned is equal to the number
              of children, then the specified children are valid but additional
              content is required to reach a valid ending state.</p></div>
<a id="L291" name="L291"></a> 291     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/30051.html" title="Multiple referred from 135 places.">validate</a>(<a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a>[] <a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>, <strong class="reserved">int</strong> <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>, <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L292" name="L292"></a> 292 
<a id="L293" name="L293"></a> 293         <strong class="reserved">if</strong> (DEBUG_VALIDATE_CONTENT)
<a id="L294" name="L294"></a> 294             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("DFAContentModel#validateContent");
<a id="L295" name="L295"></a> 295 
<a id="L296" name="L296"></a> 296         <em class="comment">//</em>
<a id="L297" name="L297"></a> 297         <em class="comment">// A DFA content model must *always* have at least 1 child</em>
<a id="L298" name="L298"></a> 298         <em class="comment">// so a failure is given if no children present.</em>
<a id="L299" name="L299"></a> 299         <em class="comment">//</em>
<a id="L300" name="L300"></a> 300         <em class="comment">// Defect 782: This is an incorrect statement because a DFA</em>
<a id="L301" name="L301"></a> 301         <em class="comment">// content model is also used for constructions such as:</em>
<a id="L302" name="L302"></a> 302         <em class="comment">//</em>
<a id="L303" name="L303"></a> 303         <em class="comment">//     (Optional*,NotRequired?)</em>
<a id="L304" name="L304"></a> 304         <em class="comment">//</em>
<a id="L305" name="L305"></a> 305         <em class="comment">// where a perfectly valid content would be NO CHILDREN.</em>
<a id="L306" name="L306"></a> 306         <em class="comment">// Therefore, if there are no children, we must check to</em>
<a id="L307" name="L307"></a> 307         <em class="comment">// see if the CMNODE_EOC marker is a valid start state! -Ac</em>
<a id="L308" name="L308"></a> 308         <em class="comment">//</em>
<a id="L309" name="L309"></a> 309         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 0) <em class="brace">{</em>
<a id="L310" name="L310"></a> 310             <strong class="reserved">if</strong> (DEBUG_VALIDATE_CONTENT) <em class="brace">{</em>
<a id="L311" name="L311"></a> 311                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("!!! no children");
<a id="L312" name="L312"></a> 312                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("elemMap="+fElemMap);
<a id="L313" name="L313"></a> 313                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; fElemMap.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L314" name="L314"></a> 314                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> uri = fElemMap[i].uri;
<a id="L315" name="L315"></a> 315                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> localpart = fElemMap[i].localpart;
<a id="L316" name="L316"></a> 316 
<a id="L317" name="L317"></a> 317                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("fElemMap["+i+"]="+uri+","+
<a id="L318" name="L318"></a> 318                                        localpart+" ("+
<a id="L319" name="L319"></a> 319                                        uri+", "+
<a id="L320" name="L320"></a> 320                                        localpart+
<a id="L321" name="L321"></a> 321                                        ')');
<a id="L322" name="L322"></a> 322 
<a id="L323" name="L323"></a> 323                 <em class="brace">}</em>
<a id="L324" name="L324"></a> 324                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("EOCIndex="+fEOCString);
<a id="L325" name="L325"></a> 325             <em class="brace">}</em>
<a id="L326" name="L326"></a> 326 
<a id="L327" name="L327"></a> 327             <strong class="reserved">return</strong> fEmptyContentIsValid ? -1 : 0;
<a id="L328" name="L328"></a> 328 
<a id="L329" name="L329"></a> 329         <em class="brace">}</em> <em class="comment">// if child count == 0</em>
<a id="L330" name="L330"></a> 330 
<a id="L331" name="L331"></a> 331         <em class="comment">//</em>
<a id="L332" name="L332"></a> 332         <em class="comment">//  Lets loop through the children in the array and move our way</em>
<a id="L333" name="L333"></a> 333         <em class="comment">//  through the states. Note that we use the fElemMap array to map</em>
<a id="L334" name="L334"></a> 334         <em class="comment">//  an element index to a state index.</em>
<a id="L335" name="L335"></a> 335         <em class="comment">//</em>
<a id="L336" name="L336"></a> 336         <strong class="reserved">int</strong> curState = 0;
<a id="L337" name="L337"></a> 337         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> childIndex = 0; childIndex &lt; <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; childIndex++)
<a id="L338" name="L338"></a> 338         <em class="brace">{</em>
<a id="L339" name="L339"></a> 339             <em class="comment">// Get the current element index out</em>
<a id="L340" name="L340"></a> 340             <strong class="reserved">final</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> curElem = <a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>[<a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a> + childIndex];
<a id="L341" name="L341"></a> 341             <em class="comment">// ignore mixed text</em>
<a id="L342" name="L342"></a> 342             <strong class="reserved">if</strong> (fMixed &amp;&amp; curElem.localpart == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L343" name="L343"></a> 343                 <strong class="reserved">continue</strong>;
<a id="L344" name="L344"></a> 344             <em class="brace">}</em>
<a id="L345" name="L345"></a> 345 
<a id="L346" name="L346"></a> 346             <em class="comment">// Look up this child in our element map</em>
<a id="L347" name="L347"></a> 347             <strong class="reserved">int</strong> elemIndex = 0;
<a id="L348" name="L348"></a> 348             <strong class="reserved">for</strong> (; elemIndex &lt; fElemMapSize; elemIndex++)
<a id="L349" name="L349"></a> 349             <em class="brace">{</em>
<a id="L350" name="L350"></a> 350                 <strong class="reserved">int</strong> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> = fElemMapType[elemIndex] &amp; 0x0f ;
<a id="L351" name="L351"></a> 351                 <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_LEAF) <em class="brace">{</em>
<a id="L352" name="L352"></a> 352                     <em class="comment">//System.out.println("fElemMap["+elemIndex+"]: "+fElemMap[elemIndex]);</em>
<a id="L353" name="L353"></a> 353                     <strong class="reserved">if</strong> (fElemMap[elemIndex].rawname == curElem.rawname) <em class="brace">{</em>
<a id="L354" name="L354"></a> 354                         <strong class="reserved">break</strong>;
<a id="L355" name="L355"></a> 355                     <em class="brace">}</em>
<a id="L356" name="L356"></a> 356                 <em class="brace">}</em>
<a id="L357" name="L357"></a> 357                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ANY) <em class="brace">{</em>
<a id="L358" name="L358"></a> 358                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> uri = fElemMap[elemIndex].uri;
<a id="L359" name="L359"></a> 359                     <strong class="reserved">if</strong> (uri == <strong class="reserved">null</strong> || uri == curElem.uri) <em class="brace">{</em>
<a id="L360" name="L360"></a> 360                         <strong class="reserved">break</strong>;
<a id="L361" name="L361"></a> 361                     <em class="brace">}</em>
<a id="L362" name="L362"></a> 362                 <em class="brace">}</em>
<a id="L363" name="L363"></a> 363                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ANY_LOCAL) <em class="brace">{</em>
<a id="L364" name="L364"></a> 364                     <strong class="reserved">if</strong> (curElem.uri == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L365" name="L365"></a> 365                         <strong class="reserved">break</strong>;
<a id="L366" name="L366"></a> 366                     <em class="brace">}</em>
<a id="L367" name="L367"></a> 367                 <em class="brace">}</em>
<a id="L368" name="L368"></a> 368                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ANY_OTHER) <em class="brace">{</em>
<a id="L369" name="L369"></a> 369                     <strong class="reserved">if</strong> (fElemMap[elemIndex].uri != curElem.uri) <em class="brace">{</em>
<a id="L370" name="L370"></a> 370                         <strong class="reserved">break</strong>;
<a id="L371" name="L371"></a> 371                     <em class="brace">}</em>
<a id="L372" name="L372"></a> 372                 <em class="brace">}</em>
<a id="L373" name="L373"></a> 373             <em class="brace">}</em>
<a id="L374" name="L374"></a> 374 
<a id="L375" name="L375"></a> 375             <em class="comment">// If we didn't find it, then obviously not valid</em>
<a id="L376" name="L376"></a> 376             <strong class="reserved">if</strong> (elemIndex == fElemMapSize) <em class="brace">{</em>
<a id="L377" name="L377"></a> 377                 <strong class="reserved">if</strong> (DEBUG_VALIDATE_CONTENT) <em class="brace">{</em>
<a id="L378" name="L378"></a> 378                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("!!! didn't find it");
<a id="L379" name="L379"></a> 379 
<a id="L380" name="L380"></a> 380                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("curElem : " +curElem );
<a id="L381" name="L381"></a> 381                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i&lt;fElemMapSize; i++) <em class="brace">{</em>
<a id="L382" name="L382"></a> 382                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("fElemMap["+i+"] = " +fElemMap[i] );
<a id="L383" name="L383"></a> 383                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("fElemMapType["+i+"] = " +fElemMapType[i] );
<a id="L384" name="L384"></a> 384                     <em class="brace">}</em>
<a id="L385" name="L385"></a> 385                 <em class="brace">}</em>
<a id="L386" name="L386"></a> 386 
<a id="L387" name="L387"></a> 387                 <strong class="reserved">return</strong> childIndex;
<a id="L388" name="L388"></a> 388             <em class="brace">}</em>
<a id="L389" name="L389"></a> 389 
<a id="L390" name="L390"></a> 390             <em class="comment">//</em>
<a id="L391" name="L391"></a> 391             <em class="comment">//  Look up the next state for this input symbol when in the</em>
<a id="L392" name="L392"></a> 392             <em class="comment">//  current state.</em>
<a id="L393" name="L393"></a> 393             <em class="comment">//</em>
<a id="L394" name="L394"></a> 394             curState = fTransTable[curState][elemIndex];
<a id="L395" name="L395"></a> 395 
<a id="L396" name="L396"></a> 396             <em class="comment">// If its not a legal transition, then invalid</em>
<a id="L397" name="L397"></a> 397             <strong class="reserved">if</strong> (curState == -1) <em class="brace">{</em>
<a id="L398" name="L398"></a> 398                 <strong class="reserved">if</strong> (DEBUG_VALIDATE_CONTENT)
<a id="L399" name="L399"></a> 399                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("!!! not a legal transition");
<a id="L400" name="L400"></a> 400                 <strong class="reserved">return</strong> childIndex;
<a id="L401" name="L401"></a> 401             <em class="brace">}</em>
<a id="L402" name="L402"></a> 402         <em class="brace">}</em>
<a id="L403" name="L403"></a> 403 
<a id="L404" name="L404"></a> 404         <em class="comment">//</em>
<a id="L405" name="L405"></a> 405         <em class="comment">//  We transitioned all the way through the input list. However, that</em>
<a id="L406" name="L406"></a> 406         <em class="comment">//  does not mean that we ended in a final state. So check whether</em>
<a id="L407" name="L407"></a> 407         <em class="comment">//  our ending state is a final state.</em>
<a id="L408" name="L408"></a> 408         <em class="comment">//</em>
<a id="L409" name="L409"></a> 409         <strong class="reserved">if</strong> (DEBUG_VALIDATE_CONTENT)
<a id="L410" name="L410"></a> 410             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("curState="+curState+", childCount="+<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L411" name="L411"></a> 411         <strong class="reserved">if</strong> (!fFinalStateFlags[curState])
<a id="L412" name="L412"></a> 412             <strong class="reserved">return</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L413" name="L413"></a> 413 
<a id="L414" name="L414"></a> 414         <em class="comment">// success!</em>
<a id="L415" name="L415"></a> 415         <strong class="reserved">return</strong> -1;
<a id="L416" name="L416"></a> 416     <em class="brace">}</em> <em class="comment">// validate</em>
<a id="L417" name="L417"></a> 417 
<a id="L418" name="L418"></a> 418 
<a id="L419" name="L419"></a> 419     <em class="comment">//</em>
<a id="L420" name="L420"></a> 420     <em class="comment">// Private methods</em>
<a id="L421" name="L421"></a> 421     <em class="comment">//</em>
<a id="L422" name="L422"></a> 422 
<div class="comment">
      Builds the internal DFA transition table from the given syntax tree.
      @param syntaxTree The syntax tree.
      @exception CMException Thrown if DFA cannot be built.</div>
<a id="L430" name="L430"></a> 430     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10698.html" title="Multiple referred from 2 places.">buildDFA</a>(<a href="../S/5151.html#L70" title="Defined at 70 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">CMNode</a> syntaxTree)
<a id="L431" name="L431"></a> 431     <em class="brace">{</em>
<a id="L432" name="L432"></a> 432         <em class="comment">//</em>
<a id="L433" name="L433"></a> 433         <em class="comment">//  The first step we need to take is to rewrite the content model</em>
<a id="L434" name="L434"></a> 434         <em class="comment">//  using our CMNode objects, and in the process get rid of any</em>
<a id="L435" name="L435"></a> 435         <em class="comment">//  repetition short cuts, converting them into '*' style repetitions</em>
<a id="L436" name="L436"></a> 436         <em class="comment">//  or getting rid of repetitions altogether.</em>
<a id="L437" name="L437"></a> 437         <em class="comment">//</em>
<a id="L438" name="L438"></a> 438         <em class="comment">//  The conversions done are:</em>
<a id="L439" name="L439"></a> 439         <em class="comment">//</em>
<a id="L440" name="L440"></a> 440         <em class="comment">//  x+ -&gt; (x|x*)</em>
<a id="L441" name="L441"></a> 441         <em class="comment">//  x? -&gt; (x|epsilon)</em>
<a id="L442" name="L442"></a> 442         <em class="comment">//</em>
<a id="L443" name="L443"></a> 443         <em class="comment">//  This is a relatively complex scenario. What is happening is that</em>
<a id="L444" name="L444"></a> 444         <em class="comment">//  we create a top level binary node of which the special EOC value</em>
<a id="L445" name="L445"></a> 445         <em class="comment">//  is set as the right side node. The the left side is set to the</em>
<a id="L446" name="L446"></a> 446         <em class="comment">//  rewritten syntax tree. The source is the original content model</em>
<a id="L447" name="L447"></a> 447         <em class="comment">//  info from the decl pool. The rewrite is done by buildSyntaxTree()</em>
<a id="L448" name="L448"></a> 448         <em class="comment">//  which recurses the decl pool's content of the element and builds</em>
<a id="L449" name="L449"></a> 449         <em class="comment">//  a new tree in the process.</em>
<a id="L450" name="L450"></a> 450         <em class="comment">//</em>
<a id="L451" name="L451"></a> 451         <em class="comment">//  Note that, during this operation, we set each non-epsilon leaf</em>
<a id="L452" name="L452"></a> 452         <em class="comment">//  node's DFA state position and count the number of such leafs, which</em>
<a id="L453" name="L453"></a> 453         <em class="comment">//  is left in the fLeafCount member.</em>
<a id="L454" name="L454"></a> 454         <em class="comment">//</em>
<a id="L455" name="L455"></a> 455         <em class="comment">//  The nodeTmp object is passed in just as a temp node to use during</em>
<a id="L456" name="L456"></a> 456         <em class="comment">//  the recursion. Otherwise, we'd have to create a new node on every</em>
<a id="L457" name="L457"></a> 457         <em class="comment">//  level of recursion, which would be piggy in Java (as is everything</em>
<a id="L458" name="L458"></a> 458         <em class="comment">//  for that matter.)</em>
<a id="L459" name="L459"></a> 459         <em class="comment">//</em>
<a id="L460" name="L460"></a> 460 
<div class="comment">
 MODIFIED (Jan, 2001)
          Use following rules.
            nullable(x+) := nullable(x), first(x+) := first(x),  last(x+) := last(x)
            nullable(x?) := true, first(x?) := first(x),  last(x?) := last(x)
          The same computation of follow as x* is applied to x+
          The modification drastically reduces computation time of
          "(a, (b, a+, (c, (b, a+)+, a+, (d,  (c, (b, a+)+, a+)+, (b, a+)+, a+)+)+)+)+"</div>
<a id="L472" name="L472"></a> 472 
<a id="L473" name="L473"></a> 473         fQName.<a href="../D/34272.html" title="Multiple defined in 29 places.">setValues</a>(<strong class="reserved">null</strong>, fEOCString, fEOCString, <strong class="reserved">null</strong>);
<a id="L474" name="L474"></a> 474         <a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a> nodeEOC = <strong class="reserved">new</strong> <a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>(fQName);
<a id="L475" name="L475"></a> 475         fHeadNode = <strong class="reserved">new</strong> <a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>
<a id="L476" name="L476"></a> 476         (
<a id="L477" name="L477"></a> 477             <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_SEQ
<a id="L478" name="L478"></a> 478             , syntaxTree
<a id="L479" name="L479"></a> 479             , nodeEOC
<a id="L480" name="L480"></a> 480         );
<a id="L481" name="L481"></a> 481 
<a id="L482" name="L482"></a> 482         <em class="comment">//</em>
<a id="L483" name="L483"></a> 483         <em class="comment">//  And handle specially the EOC node, which also must be numbered</em>
<a id="L484" name="L484"></a> 484         <em class="comment">//  and counted as a non-epsilon leaf node. It could not be handled</em>
<a id="L485" name="L485"></a> 485         <em class="comment">//  in the above tree build because it was created before all that</em>
<a id="L486" name="L486"></a> 486         <em class="comment">//  started. We save the EOC position since its used during the DFA</em>
<a id="L487" name="L487"></a> 487         <em class="comment">//  building loop.</em>
<a id="L488" name="L488"></a> 488         <em class="comment">//</em>
<a id="L489" name="L489"></a> 489         fEOCPos = fLeafCount;
<a id="L490" name="L490"></a> 490         nodeEOC.<a href="../D/33567.html" title="Multiple defined in 9 places.">setPosition</a>(fLeafCount++);
<a id="L491" name="L491"></a> 491 
<a id="L492" name="L492"></a> 492         <em class="comment">//</em>
<a id="L493" name="L493"></a> 493         <em class="comment">//  Ok, so now we have to iterate the new tree and do a little more</em>
<a id="L494" name="L494"></a> 494         <em class="comment">//  work now that we know the leaf count. One thing we need to do is</em>
<a id="L495" name="L495"></a> 495         <em class="comment">//  to calculate the first and last position sets of each node. This</em>
<a id="L496" name="L496"></a> 496         <em class="comment">//  is cached away in each of the nodes.</em>
<a id="L497" name="L497"></a> 497         <em class="comment">//</em>
<a id="L498" name="L498"></a> 498         <em class="comment">//  Along the way we also set the leaf count in each node as the</em>
<a id="L499" name="L499"></a> 499         <em class="comment">//  maximum state count. They must know this in order to create their</em>
<a id="L500" name="L500"></a> 500         <em class="comment">//  first/last pos sets.</em>
<a id="L501" name="L501"></a> 501         <em class="comment">//</em>
<a id="L502" name="L502"></a> 502         <em class="comment">//  We also need to build an array of references to the non-epsilon</em>
<a id="L503" name="L503"></a> 503         <em class="comment">//  leaf nodes. Since we iterate it in the same way as before, this</em>
<a id="L504" name="L504"></a> 504         <em class="comment">//  will put them in the array according to their position values.</em>
<a id="L505" name="L505"></a> 505         <em class="comment">//</em>
<a id="L506" name="L506"></a> 506         fLeafList = <strong class="reserved">new</strong> <a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>[fLeafCount];
<a id="L507" name="L507"></a> 507         fLeafListType = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[fLeafCount];
<a id="L508" name="L508"></a> 508         <a href="../D/29494.html" title="Multiple defined in 2 places.">postTreeBuildInit</a>(fHeadNode, 0);
<a id="L509" name="L509"></a> 509 
<a id="L510" name="L510"></a> 510         <em class="comment">//</em>
<a id="L511" name="L511"></a> 511         <em class="comment">//  And, moving onward... We now need to build the follow position</em>
<a id="L512" name="L512"></a> 512         <em class="comment">//  sets for all the nodes. So we allocate an array of state sets,</em>
<a id="L513" name="L513"></a> 513         <em class="comment">//  one for each leaf node (i.e. each DFA position.)</em>
<a id="L514" name="L514"></a> 514         <em class="comment">//</em>
<a id="L515" name="L515"></a> 515         fFollowList = <strong class="reserved">new</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>[fLeafCount];
<a id="L516" name="L516"></a> 516         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = 0; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &lt; fLeafCount; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>++)
<a id="L517" name="L517"></a> 517             fFollowList[<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>] = <strong class="reserved">new</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>(fLeafCount);
<a id="L518" name="L518"></a> 518         <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(fHeadNode);
<a id="L519" name="L519"></a> 519         <em class="comment">//</em>
<a id="L520" name="L520"></a> 520         <em class="comment">//  And finally the big push... Now we build the DFA using all the</em>
<a id="L521" name="L521"></a> 521         <em class="comment">//  states and the tree we've built up. First we set up the various</em>
<a id="L522" name="L522"></a> 522         <em class="comment">//  data structures we are going to use while we do this.</em>
<a id="L523" name="L523"></a> 523         <em class="comment">//</em>
<a id="L524" name="L524"></a> 524         <em class="comment">//  First of all we need an array of unique element names in our</em>
<a id="L525" name="L525"></a> 525         <em class="comment">//  content model. For each transition table entry, we need a set of</em>
<a id="L526" name="L526"></a> 526         <em class="comment">//  contiguous indices to represent the transitions for a particular</em>
<a id="L527" name="L527"></a> 527         <em class="comment">//  input element. So we need to a zero based range of indexes that</em>
<a id="L528" name="L528"></a> 528         <em class="comment">//  map to element types. This element map provides that mapping.</em>
<a id="L529" name="L529"></a> 529         <em class="comment">//</em>
<a id="L530" name="L530"></a> 530         fElemMap = <strong class="reserved">new</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a>[fLeafCount];
<a id="L531" name="L531"></a> 531         fElemMapType = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[fLeafCount];
<a id="L532" name="L532"></a> 532         fElemMapSize = 0;
<a id="L533" name="L533"></a> 533         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> outIndex = 0; outIndex &lt; fLeafCount; outIndex++)
<a id="L534" name="L534"></a> 534         <em class="brace">{</em>
<a id="L535" name="L535"></a> 535             fElemMap[outIndex] = <strong class="reserved">new</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a>();
<a id="L536" name="L536"></a> 536 
<div class="comment">
**
            if ( (fLeafListType[outIndex] &amp; 0x0f) != 0 ) {
                if (fLeafNameTypeVector == null) {
                    fLeafNameTypeVector = new ContentLeafNameTypeVector();
                }
            }
             /****/</div>
<a id="L544" name="L544"></a> 544 
<a id="L545" name="L545"></a> 545             <em class="comment">// Get the current leaf's element index</em>
<a id="L546" name="L546"></a> 546             <strong class="reserved">final</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> <a href="../D/15287.html" title="Multiple defined in 20 places.">element</a> = fLeafList[outIndex].<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>();
<a id="L547" name="L547"></a> 547 
<a id="L548" name="L548"></a> 548             <em class="comment">// See if the current leaf node's element index is in the list</em>
<a id="L549" name="L549"></a> 549             <strong class="reserved">int</strong> inIndex = 0;
<a id="L550" name="L550"></a> 550             <strong class="reserved">for</strong> (; inIndex &lt; fElemMapSize; inIndex++)
<a id="L551" name="L551"></a> 551             <em class="brace">{</em>
<a id="L552" name="L552"></a> 552                 <strong class="reserved">if</strong> (fElemMap[inIndex].rawname == <a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>.rawname) <em class="brace">{</em>
<a id="L553" name="L553"></a> 553                     <strong class="reserved">break</strong>;
<a id="L554" name="L554"></a> 554                 <em class="brace">}</em>
<a id="L555" name="L555"></a> 555             <em class="brace">}</em>
<a id="L556" name="L556"></a> 556 
<a id="L557" name="L557"></a> 557             <em class="comment">// If it was not in the list, then add it, if not the EOC node</em>
<a id="L558" name="L558"></a> 558             <strong class="reserved">if</strong> (inIndex == fElemMapSize) <em class="brace">{</em>
<a id="L559" name="L559"></a> 559                 fElemMap[fElemMapSize].<a href="../D/34272.html" title="Multiple defined in 29 places.">setValues</a>(<a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>);
<a id="L560" name="L560"></a> 560                 fElemMapType[fElemMapSize] = fLeafListType[outIndex];
<a id="L561" name="L561"></a> 561                 fElemMapSize++;
<a id="L562" name="L562"></a> 562             <em class="brace">}</em>
<a id="L563" name="L563"></a> 563         <em class="brace">}</em>
<a id="L564" name="L564"></a> 564         <em class="comment">// set up the fLeafNameTypeVector object if there is one.</em>
<div class="comment">
***
        if (fLeafNameTypeVector != null) {
            fLeafNameTypeVector.setValues(fElemMap, fElemMapType, fElemMapSize);
        }
        *
         Optimization(Jan, 2001); We sort fLeafList according to
         elemIndex which is *uniquely* associated to each leaf.
         We are *assuming* that each element appears in at least one leaf.
        *</div>
<a id="L575" name="L575"></a> 575 
<a id="L576" name="L576"></a> 576         <strong class="reserved">int</strong>[] fLeafSorter = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[fLeafCount + fElemMapSize];
<a id="L577" name="L577"></a> 577         <strong class="reserved">int</strong> fSortCount = 0;
<a id="L578" name="L578"></a> 578 
<a id="L579" name="L579"></a> 579         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> elemIndex = 0; elemIndex &lt; fElemMapSize; elemIndex++) <em class="brace">{</em>
<a id="L580" name="L580"></a> 580             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> leafIndex = 0; leafIndex &lt; fLeafCount; leafIndex++) <em class="brace">{</em>
<a id="L581" name="L581"></a> 581                     <strong class="reserved">final</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> leaf = fLeafList[leafIndex].<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>();
<a id="L582" name="L582"></a> 582                     <strong class="reserved">final</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> <a href="../D/15287.html" title="Multiple defined in 20 places.">element</a> = fElemMap[elemIndex];
<a id="L583" name="L583"></a> 583                     <strong class="reserved">if</strong> (leaf.rawname == <a href="../D/15287.html" title="Multiple defined in 20 places.">element</a>.rawname) <em class="brace">{</em>
<a id="L584" name="L584"></a> 584                             fLeafSorter[fSortCount++] = leafIndex;
<a id="L585" name="L585"></a> 585                     <em class="brace">}</em>
<a id="L586" name="L586"></a> 586             <em class="brace">}</em>
<a id="L587" name="L587"></a> 587             fLeafSorter[fSortCount++] = -1;
<a id="L588" name="L588"></a> 588         <em class="brace">}</em>
<a id="L589" name="L589"></a> 589 
<div class="comment">
         /* Optimization(Jan, 2001) */</div>
<a id="L591" name="L591"></a> 591 
<a id="L592" name="L592"></a> 592         <em class="comment">//</em>
<a id="L593" name="L593"></a> 593         <em class="comment">//  Next lets create some arrays, some that that hold transient</em>
<a id="L594" name="L594"></a> 594         <em class="comment">//  information during the DFA build and some that are permament.</em>
<a id="L595" name="L595"></a> 595         <em class="comment">//  These are kind of sticky since we cannot know how big they will</em>
<a id="L596" name="L596"></a> 596         <em class="comment">//  get, but we don't want to use any Java collections because of</em>
<a id="L597" name="L597"></a> 597         <em class="comment">//  performance.</em>
<a id="L598" name="L598"></a> 598         <em class="comment">//</em>
<a id="L599" name="L599"></a> 599         <em class="comment">//  Basically they will probably be about fLeafCount*2 on average,</em>
<a id="L600" name="L600"></a> 600         <em class="comment">//  but can be as large as 2^(fLeafCount*2), worst case. So we start</em>
<a id="L601" name="L601"></a> 601         <em class="comment">//  with fLeafCount*4 as a middle ground. This will be very unlikely</em>
<a id="L602" name="L602"></a> 602         <em class="comment">//  to ever have to expand, though it if does, the overhead will be</em>
<a id="L603" name="L603"></a> 603         <em class="comment">//  somewhat ugly.</em>
<a id="L604" name="L604"></a> 604         <em class="comment">//</em>
<a id="L605" name="L605"></a> 605         <strong class="reserved">int</strong> curArraySize = fLeafCount * 4;
<a id="L606" name="L606"></a> 606         <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>[] statesToDo = <strong class="reserved">new</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>[curArraySize];
<a id="L607" name="L607"></a> 607         fFinalStateFlags = <strong class="reserved">new</strong> <strong class="reserved">boolean</strong>[curArraySize];
<a id="L608" name="L608"></a> 608         fTransTable = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[curArraySize][];
<a id="L609" name="L609"></a> 609 
<a id="L610" name="L610"></a> 610         <em class="comment">//</em>
<a id="L611" name="L611"></a> 611         <em class="comment">//  Ok we start with the initial set as the first pos set of the</em>
<a id="L612" name="L612"></a> 612         <em class="comment">//  head node (which is the seq node that holds the content model</em>
<a id="L613" name="L613"></a> 613         <em class="comment">//  and the EOC node.)</em>
<a id="L614" name="L614"></a> 614         <em class="comment">//</em>
<a id="L615" name="L615"></a> 615         <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> setT = fHeadNode.<a href="../S/5151.html#L97" title="Defined at 97 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">firstPos</a>();
<a id="L616" name="L616"></a> 616 
<a id="L617" name="L617"></a> 617         <em class="comment">//</em>
<a id="L618" name="L618"></a> 618         <em class="comment">//  Init our two state flags. Basically the unmarked state counter</em>
<a id="L619" name="L619"></a> 619         <em class="comment">//  is always chasing the current state counter. When it catches up,</em>
<a id="L620" name="L620"></a> 620         <em class="comment">//  that means we made a pass through that did not add any new states</em>
<a id="L621" name="L621"></a> 621         <em class="comment">//  to the lists, at which time we are done. We could have used a</em>
<a id="L622" name="L622"></a> 622         <em class="comment">//  expanding array of flags which we used to mark off states as we</em>
<a id="L623" name="L623"></a> 623         <em class="comment">//  complete them, but this is easier though less readable maybe.</em>
<a id="L624" name="L624"></a> 624         <em class="comment">//</em>
<a id="L625" name="L625"></a> 625         <strong class="reserved">int</strong> unmarkedState = 0;
<a id="L626" name="L626"></a> 626         <strong class="reserved">int</strong> curState = 0;
<a id="L627" name="L627"></a> 627 
<a id="L628" name="L628"></a> 628         <em class="comment">//</em>
<a id="L629" name="L629"></a> 629         <em class="comment">//  Init the first transition table entry, and put the initial state</em>
<a id="L630" name="L630"></a> 630         <em class="comment">//  into the states to do list, then bump the current state.</em>
<a id="L631" name="L631"></a> 631         <em class="comment">//</em>
<a id="L632" name="L632"></a> 632         fTransTable[curState] = <a href="../D/27251.html" title="Multiple defined in 2 places.">makeDefStateList</a>();
<a id="L633" name="L633"></a> 633         statesToDo[curState] = setT;
<a id="L634" name="L634"></a> 634         curState++;
<a id="L635" name="L635"></a> 635 
<div class="comment">
 Optimization(Jan, 2001); This is faster for
              a large content model such as, "(t001+|t002+|.... |t500+)".</div>
<a id="L639" name="L639"></a> 639 
<a id="L640" name="L640"></a> 640         <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a> stateTable = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>();
<a id="L641" name="L641"></a> 641 
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L643" name="L643"></a> 643 
<a id="L644" name="L644"></a> 644         <em class="comment">//</em>
<a id="L645" name="L645"></a> 645         <em class="comment">//  Ok, almost done with the algorithm... We now enter the</em>
<a id="L646" name="L646"></a> 646         <em class="comment">//  loop where we go until the states done counter catches up with</em>
<a id="L647" name="L647"></a> 647         <em class="comment">//  the states to do counter.</em>
<a id="L648" name="L648"></a> 648         <em class="comment">//</em>
<a id="L649" name="L649"></a> 649         <strong class="reserved">while</strong> (unmarkedState &lt; curState)
<a id="L650" name="L650"></a> 650         <em class="brace">{</em>
<a id="L651" name="L651"></a> 651             <em class="comment">//</em>
<a id="L652" name="L652"></a> 652             <em class="comment">//  Get the first unmarked state out of the list of states to do.</em>
<a id="L653" name="L653"></a> 653             <em class="comment">//  And get the associated transition table entry.</em>
<a id="L654" name="L654"></a> 654             <em class="comment">//</em>
<a id="L655" name="L655"></a> 655             setT = statesToDo[unmarkedState];
<a id="L656" name="L656"></a> 656             <strong class="reserved">int</strong>[] transEntry = fTransTable[unmarkedState];
<a id="L657" name="L657"></a> 657 
<a id="L658" name="L658"></a> 658             <em class="comment">// Mark this one final if it contains the EOC state</em>
<a id="L659" name="L659"></a> 659             fFinalStateFlags[unmarkedState] = setT.<a href="../D/17259.html" title="Multiple defined in 2 places.">getBit</a>(fEOCPos);
<a id="L660" name="L660"></a> 660 
<a id="L661" name="L661"></a> 661             <em class="comment">// Bump up the unmarked state count, marking this state done</em>
<a id="L662" name="L662"></a> 662             unmarkedState++;
<a id="L663" name="L663"></a> 663 
<a id="L664" name="L664"></a> 664             <em class="comment">// Loop through each possible input symbol in the element map</em>
<a id="L665" name="L665"></a> 665             <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> <a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a> = <strong class="reserved">null</strong>;
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L667" name="L667"></a> 667             <strong class="reserved">int</strong> sorterIndex = 0;
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L669" name="L669"></a> 669             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> elemIndex = 0; elemIndex &lt; fElemMapSize; elemIndex++)
<a id="L670" name="L670"></a> 670             <em class="brace">{</em>
<a id="L671" name="L671"></a> 671                 <em class="comment">//</em>
<a id="L672" name="L672"></a> 672                 <em class="comment">//  Build up a set of states which is the union of all of</em>
<a id="L673" name="L673"></a> 673                 <em class="comment">//  the follow sets of DFA positions that are in the current</em>
<a id="L674" name="L674"></a> 674                 <em class="comment">//  state. If we gave away the new set last time through then</em>
<a id="L675" name="L675"></a> 675                 <em class="comment">//  create a new one. Otherwise, zero out the existing one.</em>
<a id="L676" name="L676"></a> 676                 <em class="comment">//</em>
<a id="L677" name="L677"></a> 677                 <strong class="reserved">if</strong> (<a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a> == <strong class="reserved">null</strong>)
<a id="L678" name="L678"></a> 678                     <a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a> = <strong class="reserved">new</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>(fLeafCount);
<a id="L679" name="L679"></a> 679                 <strong class="reserved">else</strong>
<a id="L680" name="L680"></a> 680                     <a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a>.<a href="../S/5154.html#L286" title="Defined at 286 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">zeroBits</a>();
<a id="L681" name="L681"></a> 681 
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L683" name="L683"></a> 683                 <strong class="reserved">int</strong> leafIndex = fLeafSorter[sorterIndex++];
<a id="L684" name="L684"></a> 684 
<a id="L685" name="L685"></a> 685                 <strong class="reserved">while</strong> (leafIndex != -1) <em class="brace">{</em>
<a id="L686" name="L686"></a> 686                 <em class="comment">// If this leaf index (DFA position) is in the current set...</em>
<a id="L687" name="L687"></a> 687                     <strong class="reserved">if</strong> (setT.<a href="../D/17259.html" title="Multiple defined in 2 places.">getBit</a>(leafIndex))
<a id="L688" name="L688"></a> 688                     <em class="brace">{</em>
<a id="L689" name="L689"></a> 689                         <em class="comment">//</em>
<a id="L690" name="L690"></a> 690                         <em class="comment">//  If this leaf is the current input symbol, then we</em>
<a id="L691" name="L691"></a> 691                         <em class="comment">//  want to add its follow list to the set of states to</em>
<a id="L692" name="L692"></a> 692                         <em class="comment">//  transition to from the current state.</em>
<a id="L693" name="L693"></a> 693                         <em class="comment">//</em>
<a id="L694" name="L694"></a> 694                                 <a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a>.<strong class="reserved">union</strong>(fFollowList[leafIndex]);
<a id="L695" name="L695"></a> 695                             <em class="brace">}</em>
<a id="L696" name="L696"></a> 696 
<a id="L697" name="L697"></a> 697                    leafIndex = fLeafSorter[sorterIndex++];
<a id="L698" name="L698"></a> 698         <em class="brace">}</em>
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L700" name="L700"></a> 700 
<a id="L701" name="L701"></a> 701                 <em class="comment">//</em>
<a id="L702" name="L702"></a> 702                 <em class="comment">//  If this new set is not empty, then see if its in the list</em>
<a id="L703" name="L703"></a> 703                 <em class="comment">//  of states to do. If not, then add it.</em>
<a id="L704" name="L704"></a> 704                 <em class="comment">//</em>
<a id="L705" name="L705"></a> 705                 <strong class="reserved">if</strong> (!<a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a>.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L706" name="L706"></a> 706                 <em class="brace">{</em>
<a id="L707" name="L707"></a> 707                     <em class="comment">//</em>
<a id="L708" name="L708"></a> 708                     <em class="comment">//  Search the 'states to do' list to see if this new</em>
<a id="L709" name="L709"></a> 709                     <em class="comment">//  state set is already in there.</em>
<a id="L710" name="L710"></a> 710                     <em class="comment">//</em>
<a id="L711" name="L711"></a> 711 
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L713" name="L713"></a> 713             <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a> stateObj = (<a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>)stateTable.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(<a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a>);
<a id="L714" name="L714"></a> 714             <strong class="reserved">int</strong> stateIndex = (stateObj == <strong class="reserved">null</strong> ? curState : stateObj.<a href="../D/24897.html" title="Multiple defined in 21 places.">intValue</a>());
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L716" name="L716"></a> 716 
<a id="L717" name="L717"></a> 717                     <em class="comment">// If we did not find it, then add it</em>
<a id="L718" name="L718"></a> 718                     <strong class="reserved">if</strong> (stateIndex == curState)
<a id="L719" name="L719"></a> 719                     <em class="brace">{</em>
<a id="L720" name="L720"></a> 720                         <em class="comment">//</em>
<a id="L721" name="L721"></a> 721                         <em class="comment">//  Put this new state into the states to do and init</em>
<a id="L722" name="L722"></a> 722                         <em class="comment">//  a new entry at the same index in the transition</em>
<a id="L723" name="L723"></a> 723                         <em class="comment">//  table.</em>
<a id="L724" name="L724"></a> 724                         <em class="comment">//</em>
<a id="L725" name="L725"></a> 725                         statesToDo[curState] = <a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a>;
<a id="L726" name="L726"></a> 726                         fTransTable[curState] = <a href="../D/27251.html" title="Multiple defined in 2 places.">makeDefStateList</a>();
<a id="L727" name="L727"></a> 727 
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L729" name="L729"></a> 729                         stateTable.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(<a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a>, <strong class="reserved">new</strong> <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>(curState));
<div class="comment">
             /* Optimization(Jan, 2001) */</div>
<a id="L731" name="L731"></a> 731 
<a id="L732" name="L732"></a> 732                         <em class="comment">// We now have a new state to do so bump the count</em>
<a id="L733" name="L733"></a> 733                         curState++;
<a id="L734" name="L734"></a> 734 
<a id="L735" name="L735"></a> 735                         <em class="comment">//</em>
<a id="L736" name="L736"></a> 736                         <em class="comment">//  Null out the new set to indicate we adopted it.</em>
<a id="L737" name="L737"></a> 737                         <em class="comment">//  This will cause the creation of a new set on the</em>
<a id="L738" name="L738"></a> 738                         <em class="comment">//  next time around the loop.</em>
<a id="L739" name="L739"></a> 739                         <em class="comment">//</em>
<a id="L740" name="L740"></a> 740                         <a href="../D/28072.html" title="Multiple defined in 2 places.">newSet</a> = <strong class="reserved">null</strong>;
<a id="L741" name="L741"></a> 741                     <em class="brace">}</em>
<a id="L742" name="L742"></a> 742 
<a id="L743" name="L743"></a> 743                     <em class="comment">//</em>
<a id="L744" name="L744"></a> 744                     <em class="comment">//  Now set this state in the transition table's entry</em>
<a id="L745" name="L745"></a> 745                     <em class="comment">//  for this element (using its index), with the DFA</em>
<a id="L746" name="L746"></a> 746                     <em class="comment">//  state we will move to from the current state when we</em>
<a id="L747" name="L747"></a> 747                     <em class="comment">//  see this input element.</em>
<a id="L748" name="L748"></a> 748                     <em class="comment">//</em>
<a id="L749" name="L749"></a> 749                     transEntry[elemIndex] = stateIndex;
<a id="L750" name="L750"></a> 750 
<a id="L751" name="L751"></a> 751                     <em class="comment">// Expand the arrays if we're full</em>
<a id="L752" name="L752"></a> 752                     <strong class="reserved">if</strong> (curState == curArraySize)
<a id="L753" name="L753"></a> 753                     <em class="brace">{</em>
<a id="L754" name="L754"></a> 754                         <em class="comment">//</em>
<a id="L755" name="L755"></a> 755                         <em class="comment">//  Yikes, we overflowed the initial array size, so</em>
<a id="L756" name="L756"></a> 756                         <em class="comment">//  we've got to expand all of these arrays. So adjust</em>
<a id="L757" name="L757"></a> 757                         <em class="comment">//  up the size by 50% and allocate new arrays.</em>
<a id="L758" name="L758"></a> 758                         <em class="comment">//</em>
<a id="L759" name="L759"></a> 759                         <strong class="reserved">final</strong> <strong class="reserved">int</strong> newSize = (<strong class="reserved">int</strong>)(curArraySize * 1.5);
<a id="L760" name="L760"></a> 760                         <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>[] newToDo = <strong class="reserved">new</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a>[newSize];
<a id="L761" name="L761"></a> 761                         <strong class="reserved">boolean</strong>[] newFinalFlags = <strong class="reserved">new</strong> <strong class="reserved">boolean</strong>[newSize];
<a id="L762" name="L762"></a> 762                         <strong class="reserved">int</strong>[][] newTransTable = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[newSize][];
<a id="L763" name="L763"></a> 763 
<a id="L764" name="L764"></a> 764                         <em class="comment">// Copy over all of the existing content</em>
<a id="L765" name="L765"></a> 765                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(statesToDo, 0, newToDo, 0, curArraySize);
<a id="L766" name="L766"></a> 766                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(fFinalStateFlags, 0, newFinalFlags, 0, curArraySize);
<a id="L767" name="L767"></a> 767                         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(fTransTable, 0, newTransTable, 0, curArraySize);
<a id="L768" name="L768"></a> 768 
<a id="L769" name="L769"></a> 769                         <em class="comment">// Store the new array size</em>
<a id="L770" name="L770"></a> 770                         curArraySize = newSize;
<a id="L771" name="L771"></a> 771                         statesToDo = newToDo;
<a id="L772" name="L772"></a> 772                         fFinalStateFlags = newFinalFlags;
<a id="L773" name="L773"></a> 773                         fTransTable = newTransTable;
<a id="L774" name="L774"></a> 774                     <em class="brace">}</em>
<a id="L775" name="L775"></a> 775                 <em class="brace">}</em>
<a id="L776" name="L776"></a> 776             <em class="brace">}</em>
<a id="L777" name="L777"></a> 777         <em class="brace">}</em>
<a id="L778" name="L778"></a> 778 
<a id="L779" name="L779"></a> 779         <em class="comment">// Check to see if we can set the fEmptyContentIsValid flag.</em>
<a id="L780" name="L780"></a> 780         fEmptyContentIsValid = ((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)fHeadNode).<a href="../D/20063.html" title="Multiple defined in 6 places.">getLeft</a>().<a href="../D/25971.html" title="Multiple defined in 11 places.">isNullable</a>();
<a id="L781" name="L781"></a> 781 
<a id="L782" name="L782"></a> 782         <em class="comment">//</em>
<a id="L783" name="L783"></a> 783         <em class="comment">//  And now we can say bye bye to the temp representation since we've</em>
<a id="L784" name="L784"></a> 784         <em class="comment">//  built the DFA.</em>
<a id="L785" name="L785"></a> 785         <em class="comment">//</em>
<a id="L786" name="L786"></a> 786         <strong class="reserved">if</strong> (DEBUG_VALIDATE_CONTENT)
<a id="L787" name="L787"></a> 787             <a href="../D/15260.html" title="Multiple defined in 3 places.">dumpTree</a>(fHeadNode, 0);
<a id="L788" name="L788"></a> 788         fHeadNode = <strong class="reserved">null</strong>;
<a id="L789" name="L789"></a> 789         fLeafList = <strong class="reserved">null</strong>;
<a id="L790" name="L790"></a> 790         fFollowList = <strong class="reserved">null</strong>;
<a id="L791" name="L791"></a> 791 
<a id="L792" name="L792"></a> 792     <em class="brace">}</em>
<a id="L793" name="L793"></a> 793 
<div class="comment">
      Calculates the follow list of the current node.
      @param nodeCur The curent node.
      @exception CMException Thrown if follow list cannot be calculated.</div>
<a id="L801" name="L801"></a> 801     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10772.html" title="Multiple referred from 14 places.">calcFollowList</a>(<a href="../S/5151.html#L70" title="Defined at 70 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">CMNode</a> nodeCur)
<a id="L802" name="L802"></a> 802     <em class="brace">{</em>
<a id="L803" name="L803"></a> 803         <em class="comment">// Recurse as required</em>
<a id="L804" name="L804"></a> 804         <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_CHOICE)
<a id="L805" name="L805"></a> 805         <em class="brace">{</em>
<a id="L806" name="L806"></a> 806             <em class="comment">// Recurse only</em>
<a id="L807" name="L807"></a> 807             <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/20063.html" title="Multiple defined in 6 places.">getLeft</a>());
<a id="L808" name="L808"></a> 808             <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/22096.html" title="Multiple defined in 6 places.">getRight</a>());
<a id="L809" name="L809"></a> 809         <em class="brace">}</em>
<a id="L810" name="L810"></a> 810          <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_SEQ)
<a id="L811" name="L811"></a> 811         <em class="brace">{</em>
<a id="L812" name="L812"></a> 812             <em class="comment">// Recurse first</em>
<a id="L813" name="L813"></a> 813             <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/20063.html" title="Multiple defined in 6 places.">getLeft</a>());
<a id="L814" name="L814"></a> 814             <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/22096.html" title="Multiple defined in 6 places.">getRight</a>());
<a id="L815" name="L815"></a> 815 
<a id="L816" name="L816"></a> 816             <em class="comment">//</em>
<a id="L817" name="L817"></a> 817             <em class="comment">//  Now handle our level. We use our left child's last pos</em>
<a id="L818" name="L818"></a> 818             <em class="comment">//  set and our right child's first pos set, so go ahead and</em>
<a id="L819" name="L819"></a> 819             <em class="comment">//  get them ahead of time.</em>
<a id="L820" name="L820"></a> 820             <em class="comment">//</em>
<a id="L821" name="L821"></a> 821             <strong class="reserved">final</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>  = ((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/20063.html" title="Multiple defined in 6 places.">getLeft</a>().<a href="../S/5151.html#L108" title="Defined at 108 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">lastPos</a>();
<a id="L822" name="L822"></a> 822             <strong class="reserved">final</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = ((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/22096.html" title="Multiple defined in 6 places.">getRight</a>().<a href="../S/5151.html#L97" title="Defined at 97 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">firstPos</a>();
<a id="L823" name="L823"></a> 823 
<a id="L824" name="L824"></a> 824             <em class="comment">//</em>
<a id="L825" name="L825"></a> 825             <em class="comment">//  Now, for every position which is in our left child's last set</em>
<a id="L826" name="L826"></a> 826             <em class="comment">//  add all of the states in our right child's first set to the</em>
<a id="L827" name="L827"></a> 827             <em class="comment">//  follow set for that position.</em>
<a id="L828" name="L828"></a> 828             <em class="comment">//</em>
<a id="L829" name="L829"></a> 829             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = 0; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &lt; fLeafCount; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>++)
<a id="L830" name="L830"></a> 830             <em class="brace">{</em>
<a id="L831" name="L831"></a> 831                 <strong class="reserved">if</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/17259.html" title="Multiple defined in 2 places.">getBit</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>))
<a id="L832" name="L832"></a> 832                     fFollowList[<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>].<strong class="reserved">union</strong>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L833" name="L833"></a> 833             <em class="brace">}</em>
<a id="L834" name="L834"></a> 834         <em class="brace">}</em>
<div class="comment">
*
         else if (nodeCur.type() == XMLContentSpec.CONTENTSPECNODE_ZERO_OR_MORE)
        {
            // Recurse first
            calcFollowList(((CMUniOp)nodeCur).getChild());
            //
            //  Now handle our level. We use our own first and last position
            //  sets, so get them up front.
            //
            final CMStateSet first = nodeCur.firstPos();
            final CMStateSet last  = nodeCur.lastPos();
            //
            //  For every position which is in our last position set, add all
            //  of our first position states to the follow set for that
            //  position.
            //
            for (int index = 0; index &lt; fLeafCount; index++)
            {
                if (last.getBit(index))
                    fFollowList[index].union(first);
            }
        }
         else if ((nodeCur.type() == XMLContentSpec.CONTENTSPECNODE_ONE_OR_MORE)
              ||  (nodeCur.type() == XMLContentSpec.CONTENTSPECNODE_ZERO_OR_ONE))
        {
            throw new RuntimeException("ImplementationMessages.VAL_NIICM");
        }
         /***/</div>
<a id="L865" name="L865"></a> 865          <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ZERO_OR_MORE
<a id="L866" name="L866"></a> 866             || nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ONE_OR_MORE)
<a id="L867" name="L867"></a> 867         <em class="brace">{</em>
<a id="L868" name="L868"></a> 868             <em class="comment">// Recurse first</em>
<a id="L869" name="L869"></a> 869             <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(((<a href="../S/5153.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMUniOp.java.">CMUniOp</a>)nodeCur).<a href="../D/17626.html" title="Multiple defined in 28 places.">getChild</a>());
<a id="L870" name="L870"></a> 870 
<a id="L871" name="L871"></a> 871             <em class="comment">//</em>
<a id="L872" name="L872"></a> 872             <em class="comment">//  Now handle our level. We use our own first and last position</em>
<a id="L873" name="L873"></a> 873             <em class="comment">//  sets, so get them up front.</em>
<a id="L874" name="L874"></a> 874             <em class="comment">//</em>
<a id="L875" name="L875"></a> 875             <strong class="reserved">final</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = nodeCur.<a href="../S/5151.html#L97" title="Defined at 97 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">firstPos</a>();
<a id="L876" name="L876"></a> 876             <strong class="reserved">final</strong> <a href="../S/5154.html#L84" title="Defined at 84 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMStateSet.java.">CMStateSet</a> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>  = nodeCur.<a href="../S/5151.html#L108" title="Defined at 108 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">lastPos</a>();
<a id="L877" name="L877"></a> 877 
<a id="L878" name="L878"></a> 878             <em class="comment">//</em>
<a id="L879" name="L879"></a> 879             <em class="comment">//  For every position which is in our last position set, add all</em>
<a id="L880" name="L880"></a> 880             <em class="comment">//  of our first position states to the follow set for that</em>
<a id="L881" name="L881"></a> 881             <em class="comment">//  position.</em>
<a id="L882" name="L882"></a> 882             <em class="comment">//</em>
<a id="L883" name="L883"></a> 883             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = 0; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &lt; fLeafCount; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>++)
<a id="L884" name="L884"></a> 884             <em class="brace">{</em>
<a id="L885" name="L885"></a> 885                 <strong class="reserved">if</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/17259.html" title="Multiple defined in 2 places.">getBit</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>))
<a id="L886" name="L886"></a> 886                     fFollowList[<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>].<strong class="reserved">union</strong>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L887" name="L887"></a> 887             <em class="brace">}</em>
<a id="L888" name="L888"></a> 888         <em class="brace">}</em>
<a id="L889" name="L889"></a> 889 
<a id="L890" name="L890"></a> 890         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ZERO_OR_ONE) <em class="brace">{</em>
<a id="L891" name="L891"></a> 891             <em class="comment">// Recurse only</em>
<a id="L892" name="L892"></a> 892             <a href="../D/12023.html" title="Multiple defined in 2 places.">calcFollowList</a>(((<a href="../S/5153.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMUniOp.java.">CMUniOp</a>)nodeCur).<a href="../D/17626.html" title="Multiple defined in 28 places.">getChild</a>());
<a id="L893" name="L893"></a> 893         <em class="brace">}</em>
<div class="comment">
          /***/</div>
<a id="L895" name="L895"></a> 895     <em class="brace">}</em>
<a id="L896" name="L896"></a> 896 
<div class="comment">
      Dumps the tree of the current node to standard output.
      @param nodeCur The current node.
      @param level   The maximum levels to output.
      @exception CMException Thrown on error.</div>
<a id="L905" name="L905"></a> 905     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13606.html" title="Multiple referred from 8 places.">dumpTree</a>(<a href="../S/5151.html#L70" title="Defined at 70 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">CMNode</a> nodeCur, <strong class="reserved">int</strong> level)
<a id="L906" name="L906"></a> 906     <em class="brace">{</em>
<a id="L907" name="L907"></a> 907         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = 0; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &lt; level; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>++)
<a id="L908" name="L908"></a> 908             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("   ");
<a id="L909" name="L909"></a> 909 
<a id="L910" name="L910"></a> 910         <strong class="reserved">int</strong> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> = nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>();
<a id="L911" name="L911"></a> 911         <strong class="reserved">if</strong> ((<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_CHOICE)
<a id="L912" name="L912"></a> 912         ||  (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_SEQ))
<a id="L913" name="L913"></a> 913         <em class="brace">{</em>
<a id="L914" name="L914"></a> 914             <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_CHOICE)
<a id="L915" name="L915"></a> 915                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("Choice Node ");
<a id="L916" name="L916"></a> 916             <strong class="reserved">else</strong>
<a id="L917" name="L917"></a> 917                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("Seq Node ");
<a id="L918" name="L918"></a> 918 
<a id="L919" name="L919"></a> 919             <strong class="reserved">if</strong> (nodeCur.<a href="../D/25971.html" title="Multiple defined in 11 places.">isNullable</a>())
<a id="L920" name="L920"></a> 920                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("Nullable ");
<a id="L921" name="L921"></a> 921 
<a id="L922" name="L922"></a> 922             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("firstPos=");
<a id="L923" name="L923"></a> 923             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(nodeCur.<a href="../S/5151.html#L97" title="Defined at 97 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">firstPos</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L924" name="L924"></a> 924             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(" lastPos=");
<a id="L925" name="L925"></a> 925             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>(nodeCur.<a href="../S/5151.html#L108" title="Defined at 108 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">lastPos</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L926" name="L926"></a> 926 
<a id="L927" name="L927"></a> 927             <a href="../D/15260.html" title="Multiple defined in 3 places.">dumpTree</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/20063.html" title="Multiple defined in 6 places.">getLeft</a>(), level+1);
<a id="L928" name="L928"></a> 928             <a href="../D/15260.html" title="Multiple defined in 3 places.">dumpTree</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/22096.html" title="Multiple defined in 6 places.">getRight</a>(), level+1);
<a id="L929" name="L929"></a> 929         <em class="brace">}</em>
<a id="L930" name="L930"></a> 930          <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ZERO_OR_MORE)
<a id="L931" name="L931"></a> 931         <em class="brace">{</em>
<a id="L932" name="L932"></a> 932             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("Rep Node ");
<a id="L933" name="L933"></a> 933 
<a id="L934" name="L934"></a> 934             <strong class="reserved">if</strong> (nodeCur.<a href="../D/25971.html" title="Multiple defined in 11 places.">isNullable</a>())
<a id="L935" name="L935"></a> 935                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("Nullable ");
<a id="L936" name="L936"></a> 936 
<a id="L937" name="L937"></a> 937             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("firstPos=");
<a id="L938" name="L938"></a> 938             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(nodeCur.<a href="../S/5151.html#L97" title="Defined at 97 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">firstPos</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L939" name="L939"></a> 939             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(" lastPos=");
<a id="L940" name="L940"></a> 940             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>(nodeCur.<a href="../S/5151.html#L108" title="Defined at 108 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">lastPos</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L941" name="L941"></a> 941 
<a id="L942" name="L942"></a> 942             <a href="../D/15260.html" title="Multiple defined in 3 places.">dumpTree</a>(((<a href="../S/5153.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMUniOp.java.">CMUniOp</a>)nodeCur).<a href="../D/17626.html" title="Multiple defined in 28 places.">getChild</a>(), level+1);
<a id="L943" name="L943"></a> 943         <em class="brace">}</em>
<a id="L944" name="L944"></a> 944          <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_LEAF)
<a id="L945" name="L945"></a> 945         <em class="brace">{</em>
<a id="L946" name="L946"></a> 946             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>
<a id="L947" name="L947"></a> 947             (
<a id="L948" name="L948"></a> 948                 "Leaf: (pos="
<a id="L949" name="L949"></a> 949                 + ((<a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>)nodeCur).<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>()
<a id="L950" name="L950"></a> 950                 + "), "
<a id="L951" name="L951"></a> 951                 + ((<a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>)nodeCur).<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>()
<a id="L952" name="L952"></a> 952                 + "(elemIndex="
<a id="L953" name="L953"></a> 953                 + ((<a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>)nodeCur).<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>()
<a id="L954" name="L954"></a> 954                 + ") "
<a id="L955" name="L955"></a> 955             );
<a id="L956" name="L956"></a> 956 
<a id="L957" name="L957"></a> 957             <strong class="reserved">if</strong> (nodeCur.<a href="../D/25971.html" title="Multiple defined in 11 places.">isNullable</a>())
<a id="L958" name="L958"></a> 958                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(" Nullable ");
<a id="L959" name="L959"></a> 959 
<a id="L960" name="L960"></a> 960             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>("firstPos=");
<a id="L961" name="L961"></a> 961             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(nodeCur.<a href="../S/5151.html#L97" title="Defined at 97 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">firstPos</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L962" name="L962"></a> 962             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29620.html" title="Multiple defined in 86 places.">print</a>(" lastPos=");
<a id="L963" name="L963"></a> 963             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>(nodeCur.<a href="../S/5151.html#L108" title="Defined at 108 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">lastPos</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L964" name="L964"></a> 964         <em class="brace">}</em>
<a id="L965" name="L965"></a> 965          <strong class="reserved">else</strong>
<a id="L966" name="L966"></a> 966         <em class="brace">{</em>
<a id="L967" name="L967"></a> 967             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1723.html#L43" title="Defined at 43 in src/java/lang/RuntimeException.java.">RuntimeException</a>("ImplementationMessages.VAL_NIICM");
<a id="L968" name="L968"></a> 968         <em class="brace">}</em>
<a id="L969" name="L969"></a> 969     <em class="brace">}</em>
<a id="L970" name="L970"></a> 970 
<a id="L971" name="L971"></a> 971 
<div class="comment">
      -1 is used to represent bad transitions in the transition table
      entry for each state. So each entry is initialized to an all -1
      array. This method creates a new entry and initializes it.</div>
<a id="L977" name="L977"></a> 977     <strong class="reserved">private</strong> <strong class="reserved">int</strong>[] <a href="../R/22865.html" title="Multiple referred from 4 places.">makeDefStateList</a>()
<a id="L978" name="L978"></a> 978     <em class="brace">{</em>
<a id="L979" name="L979"></a> 979         <strong class="reserved">int</strong>[] retArray = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[fElemMapSize];
<a id="L980" name="L980"></a> 980         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = 0; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &lt; fElemMapSize; <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>++)
<a id="L981" name="L981"></a> 981             retArray[<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>] = -1;
<a id="L982" name="L982"></a> 982         <strong class="reserved">return</strong> retArray;
<a id="L983" name="L983"></a> 983     <em class="brace">}</em>
<a id="L984" name="L984"></a> 984 
<div class="comment">
     /** Post tree build initialization. */</div>
<a id="L986" name="L986"></a> 986     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/24867.html" title="Multiple referred from 8 places.">postTreeBuildInit</a>(<a href="../S/5151.html#L70" title="Defined at 70 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">CMNode</a> nodeCur, <strong class="reserved">int</strong> curIndex)
<a id="L987" name="L987"></a> 987     <em class="brace">{</em>
<a id="L988" name="L988"></a> 988         <em class="comment">// Set the maximum states on this node</em>
<a id="L989" name="L989"></a> 989         nodeCur.<a href="../S/5151.html#L123" title="Defined at 123 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMNode.java.">setMaxStates</a>(fLeafCount);
<a id="L990" name="L990"></a> 990 
<a id="L991" name="L991"></a> 991         <em class="comment">// Recurse as required</em>
<a id="L992" name="L992"></a> 992         <strong class="reserved">if</strong> ((nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() &amp; 0x0f) == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ANY ||
<a id="L993" name="L993"></a> 993             (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() &amp; 0x0f) == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ANY_LOCAL ||
<a id="L994" name="L994"></a> 994             (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() &amp; 0x0f) == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ANY_OTHER) <em class="brace">{</em>
<a id="L995" name="L995"></a> 995             <em class="comment">// REVISIT: Don't waste these structures.</em>
<a id="L996" name="L996"></a> 996             <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> qname = <strong class="reserved">new</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a>(<strong class="reserved">null</strong>, <strong class="reserved">null</strong>, <strong class="reserved">null</strong>, ((<a href="../S/5145.html#L71" title="Defined at 71 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMAny.java.">CMAny</a>)nodeCur).<a href="../D/23369.html" title="Multiple defined in 43 places.">getURI</a>());
<a id="L997" name="L997"></a> 997             fLeafList[curIndex] = <strong class="reserved">new</strong> <a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>(qname, ((<a href="../S/5145.html#L71" title="Defined at 71 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMAny.java.">CMAny</a>)nodeCur).<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>());
<a id="L998" name="L998"></a> 998             fLeafListType[curIndex] = nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>();
<a id="L999" name="L999"></a> 999             curIndex++;
<a id="L1000" name="L1000"></a>1000         <em class="brace">}</em>
<a id="L1001" name="L1001"></a>1001         <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_CHOICE)
<a id="L1002" name="L1002"></a>1002         ||  (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_SEQ))
<a id="L1003" name="L1003"></a>1003         <em class="brace">{</em>
<a id="L1004" name="L1004"></a>1004             curIndex = <a href="../D/29494.html" title="Multiple defined in 2 places.">postTreeBuildInit</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/20063.html" title="Multiple defined in 6 places.">getLeft</a>(), curIndex);
<a id="L1005" name="L1005"></a>1005             curIndex = <a href="../D/29494.html" title="Multiple defined in 2 places.">postTreeBuildInit</a>(((<a href="../S/5147.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMBinOp.java.">CMBinOp</a>)nodeCur).<a href="../D/22096.html" title="Multiple defined in 6 places.">getRight</a>(), curIndex);
<a id="L1006" name="L1006"></a>1006         <em class="brace">}</em>
<a id="L1007" name="L1007"></a>1007          <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ZERO_OR_MORE
<a id="L1008" name="L1008"></a>1008              || nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ONE_OR_MORE
<a id="L1009" name="L1009"></a>1009              || nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_ZERO_OR_ONE)
<a id="L1010" name="L1010"></a>1010         <em class="brace">{</em>
<a id="L1011" name="L1011"></a>1011             curIndex = <a href="../D/29494.html" title="Multiple defined in 2 places.">postTreeBuildInit</a>(((<a href="../S/5153.html#L72" title="Defined at 72 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMUniOp.java.">CMUniOp</a>)nodeCur).<a href="../D/17626.html" title="Multiple defined in 28 places.">getChild</a>(), curIndex);
<a id="L1012" name="L1012"></a>1012         <em class="brace">}</em>
<a id="L1013" name="L1013"></a>1013          <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>() == <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_LEAF)
<a id="L1014" name="L1014"></a>1014         <em class="brace">{</em>
<a id="L1015" name="L1015"></a>1015             <em class="comment">//</em>
<a id="L1016" name="L1016"></a>1016             <em class="comment">//  Put this node in the leaf list at the current index if its</em>
<a id="L1017" name="L1017"></a>1017             <em class="comment">//  a non-epsilon leaf.</em>
<a id="L1018" name="L1018"></a>1018             <em class="comment">//</em>
<a id="L1019" name="L1019"></a>1019              <strong class="reserved">final</strong> <a href="../D/6976.html" title="Multiple defined in 5 places.">QName</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = ((<a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>)nodeCur).<a href="../D/18665.html" title="Multiple defined in 28 places.">getElement</a>();
<a id="L1020" name="L1020"></a>1020             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.localpart != fEpsilonString) <em class="brace">{</em>
<a id="L1021" name="L1021"></a>1021                 fLeafList[curIndex] = (<a href="../S/5148.html#L73" title="Defined at 73 in src/com/sun/org/apache/xerces/internal/impl/dtd/models/CMLeaf.java.">CMLeaf</a>)nodeCur;
<a id="L1022" name="L1022"></a>1022                 fLeafListType[curIndex] = <a href="../S/5159.html#L117" title="Defined at 117 in src/com/sun/org/apache/xerces/internal/impl/dtd/XMLContentSpec.java.">XMLContentSpec</a>.CONTENTSPECNODE_LEAF;
<a id="L1023" name="L1023"></a>1023                 curIndex++;
<a id="L1024" name="L1024"></a>1024             <em class="brace">}</em>
<a id="L1025" name="L1025"></a>1025         <em class="brace">}</em>
<a id="L1026" name="L1026"></a>1026          <strong class="reserved">else</strong>
<a id="L1027" name="L1027"></a>1027         <em class="brace">{</em>
<a id="L1028" name="L1028"></a>1028             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1723.html#L43" title="Defined at 43 in src/java/lang/RuntimeException.java.">RuntimeException</a>("ImplementationMessages.VAL_NIICM: type="+nodeCur.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>());
<a id="L1029" name="L1029"></a>1029         <em class="brace">}</em>
<a id="L1030" name="L1030"></a>1030         <strong class="reserved">return</strong> curIndex;
<a id="L1031" name="L1031"></a>1031     <em class="brace">}</em>
<a id="L1032" name="L1032"></a>1032 
<a id="L1033" name="L1033"></a>1033 <em class="brace">}</em> <em class="comment">// class DFAContentModel</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L291">[^]</a><a href="#L986">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>