<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/TimSort.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L210">[^]</a><a href="#L916">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L210" title="Defined at 210.">sort</a></li>
<li><a href="#L276" title="Defined at 276.">SuppressWarnings</a></li>
<li><a href="#L277" title="Defined at 277.">binarySort</a></li>
<li><a href="#L347" title="Defined at 347.">countRunAndMakeAscending</a></li>
<li><a href="#L374" title="Defined at 374.">reverseRange</a></li>
<li><a href="#L400" title="Defined at 400.">minRunLength</a></li>
<li><a href="#L416" title="Defined at 416.">pushRun</a></li>
<li><a href="#L433" title="Defined at 433.">mergeCollapse</a></li>
<li><a href="#L452" title="Defined at 452.">mergeForceCollapse</a></li>
<li><a href="#L468" title="Defined at 468.">mergeAt</a></li>
<li><a href="#L537" title="Defined at 537.">gallopLeft</a></li>
<li><a href="#L607" title="Defined at 607.">gallopRight</a></li>
<li><a href="#L681" title="Defined at 681.">mergeLo</a></li>
<li><a href="#L797" title="Defined at 797.">mergeHi</a></li>
<li><a href="#L916" title="Defined at 916.">ensureCapacity</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2009, 2013, Oracle and/or its affiliates. All rights reserved.
  Copyright 2009 Google Inc.  All Rights Reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L26" name="L26"></a>  26 
<a id="L27" name="L27"></a>  27 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util;
<a id="L28" name="L28"></a>  28 
<div class="comment">
  A stable, adaptive, iterative mergesort that requires far fewer than
  n lg(n) comparisons when running on partially sorted arrays, while
  offering performance comparable to a traditional mergesort when run
  on random arrays.  Like all proper mergesorts, this sort is stable and
  runs O(n log n) time (worst case).  In the worst case, this sort requires
  temporary storage space for n/2 object references; in the best case,
  it requires only a small constant amount of space.
  This implementation was adapted from Tim Peters's list sort for
  Python, which is described in detail here:
    http://svn.python.org/projects/python/trunk/Objects/listsort.txt
  Tim's C code may be found here:
    http://svn.python.org/projects/python/trunk/Objects/listobject.c
  The underlying techniques are described in this paper (and may have
  even earlier origins):
   "Optimistic Sorting and Information Theoretic Complexity"
   Peter McIlroy
   SODA (Fourth Annual ACM-SIAM Symposium on Discrete Algorithms),
   pp 467-474, Austin, Texas, 25-27 January 1993.
  While the API to this class consists solely of static methods, it is
  (privately) instantiable; a TimSort instance holds the state of an ongoing
  sort, assuming the input array is large enough to warrant the full-blown
  TimSort. Small arrays are sorted in place, using a binary insertion sort.
  @author Josh Bloch</div>
<a id="L62" name="L62"></a>  62 <strong class="reserved">class</strong> <a href="../R/8160.html" title="Multiple referred from 8 places.">TimSort</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <em class="brace">{</em>
<div class="comment">
      This is the minimum sized sequence that will be merged.  Shorter
      sequences will be lengthened by calling binarySort.  If the entire
      array is less than this length, no merges will be performed.
      This constant should be a power of two.  It was 64 in Tim Peter's C
      implementation, but 32 was empirically determined to work better in
      this implementation.  In the unlikely event that you set this constant
      to be a number that's not a power of two, you'll need to change the
      {@link #minRunLength} computation.
      If you decrease this constant, you must change the stackLen
      computation in the TimSort constructor, or you risk an
      ArrayOutOfBounds exception.  See listsort.txt for a discussion
      of the minimum stack length required as a function of the length
      of the array being sorted and the minimum merge sequence length.</div>
<a id="L80" name="L80"></a>  80     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MIN_MERGE = 32;
<a id="L81" name="L81"></a>  81 
<div class="comment">
      The array being sorted.</div>
<a id="L85" name="L85"></a>  85     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L86" name="L86"></a>  86 
<div class="comment">
      The comparator for this sort.</div>
<a id="L90" name="L90"></a>  90     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L91" name="L91"></a>  91 
<div class="comment">
      When we get into galloping mode, we stay there until both runs win less
      often than MIN_GALLOP consecutive times.</div>
<a id="L96" name="L96"></a>  96     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  MIN_GALLOP = 7;
<a id="L97" name="L97"></a>  97 
<div class="comment">
      This controls when we get *into* galloping mode.  It is initialized
      to MIN_GALLOP.  The mergeLo and mergeHi methods nudge it higher for
      random data, and lower for highly structured data.</div>
<a id="L103" name="L103"></a> 103     <strong class="reserved">private</strong> <strong class="reserved">int</strong> minGallop = MIN_GALLOP;
<a id="L104" name="L104"></a> 104 
<div class="comment">
      Maximum initial size of tmp array, which is used for merging.  The array
      can grow to accommodate demand.
      Unlike Tim's original C version, we do not allocate this much storage
      when sorting smaller arrays.  This change was required for performance.</div>
<a id="L112" name="L112"></a> 112     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> INITIAL_TMP_STORAGE_LENGTH = 256;
<a id="L113" name="L113"></a> 113 
<div class="comment">
      Temp storage for merges. A workspace array may optionally be
      provided in constructor, and if so will be used as long as it
      is big enough.</div>
<a id="L119" name="L119"></a> 119     <strong class="reserved">private</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] tmp;
<a id="L120" name="L120"></a> 120     <strong class="reserved">private</strong> <strong class="reserved">int</strong> tmpBase; <em class="comment">// base of tmp array slice</em>
<a id="L121" name="L121"></a> 121     <strong class="reserved">private</strong> <strong class="reserved">int</strong> tmpLen;  <em class="comment">// length of tmp array slice</em>
<a id="L122" name="L122"></a> 122 
<div class="comment">
      A stack of pending runs yet to be merged.  Run i starts at
      address base[i] and extends for len[i] elements.  It's always
      true (so long as the indices are in bounds) that:
          runBase[i] + runLen[i] == runBase[i + 1]
      so we could cut the storage for this, but it's a minor amount,
      and keeping all the info explicit simplifies the code.</div>
<a id="L133" name="L133"></a> 133     <strong class="reserved">private</strong> <strong class="reserved">int</strong> stackSize = 0;  <em class="comment">// Number of pending runs on stack</em>
<a id="L134" name="L134"></a> 134     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>[] runBase;
<a id="L135" name="L135"></a> 135     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>[] runLen;
<a id="L136" name="L136"></a> 136 
<div class="comment">
      Creates a TimSort instance to maintain the state of an ongoing sort.
      @param a the array to be sorted
      @param c the comparator to determine the order of the sort
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L146" name="L146"></a> 146     <strong class="reserved">private</strong> TimSort(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L147" name="L147"></a> 147         <strong class="reserved">this</strong>.<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L148" name="L148"></a> 148         <strong class="reserved">this</strong>.<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L149" name="L149"></a> 149 
<a id="L150" name="L150"></a> 150         <em class="comment">// Allocate temp storage (which may be increased later if necessary)</em>
<a id="L151" name="L151"></a> 151         <strong class="reserved">int</strong> len = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L152" name="L152"></a> 152         <strong class="reserved">int</strong> tlen = (len &lt; 2 * INITIAL_TMP_STORAGE_LENGTH) ?
<a id="L153" name="L153"></a> 153             len &gt;&gt;&gt; 1 : INITIAL_TMP_STORAGE_LENGTH;
<a id="L154" name="L154"></a> 154         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; tlen || workBase + tlen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L155" name="L155"></a> 155             @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>(<em class="brace">{</em>"unchecked", "UnnecessaryLocalVariable"<em class="brace">}</em>)
<a id="L156" name="L156"></a> 156             <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/27956.html" title="Multiple defined in 13 places.">newArray</a> = (<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[])<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.lang.reflect.<a href="../D/487.html" title="Multiple defined in 2 places.">Array</a>.<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>
<a id="L157" name="L157"></a> 157                 (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>().<a href="../D/17880.html" title="Multiple defined in 2 places.">getComponentType</a>(), tlen);
<a id="L158" name="L158"></a> 158             tmp = <a href="../D/27956.html" title="Multiple defined in 13 places.">newArray</a>;
<a id="L159" name="L159"></a> 159             tmpBase = 0;
<a id="L160" name="L160"></a> 160             tmpLen = tlen;
<a id="L161" name="L161"></a> 161         <em class="brace">}</em>
<a id="L162" name="L162"></a> 162         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L163" name="L163"></a> 163             tmp = work;
<a id="L164" name="L164"></a> 164             tmpBase = workBase;
<a id="L165" name="L165"></a> 165             tmpLen = workLen;
<a id="L166" name="L166"></a> 166         <em class="brace">}</em>
<a id="L167" name="L167"></a> 167 
<div class="comment">
          Allocate runs-to-be-merged stack (which cannot be expanded).  The
          stack length requirements are described in listsort.txt.  The C
          version always uses the same stack length (85), but this was
          measured to be too expensive when sorting "mid-sized" arrays (e.g.,
          100 elements) in Java.  Therefore, we use smaller (but sufficiently
          large) stack lengths for smaller arrays.  The "magic numbers" in the
          computation below must be changed if MIN_MERGE is decreased.  See
          the MIN_MERGE declaration above for more information.
          The maximum value of 49 allows for an array up to length
          Integer.MAX_VALUE-4, if array is filled by the worst case stack size
          increasing scenario. More explanations are given in section 4 of:
          http://envisage-project.eu/wp-content/uploads/2015/02/sorting.pdf</div>
<a id="L182" name="L182"></a> 182         <strong class="reserved">int</strong> stackLen = (len &lt;    120  ?  5 :
<a id="L183" name="L183"></a> 183                         len &lt;   1542  ? 10 :
<a id="L184" name="L184"></a> 184                         len &lt; 119151  ? 24 : 49);
<a id="L185" name="L185"></a> 185         runBase = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[stackLen];
<a id="L186" name="L186"></a> 186         runLen = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[stackLen];
<a id="L187" name="L187"></a> 187     <em class="brace">}</em>
<a id="L188" name="L188"></a> 188 
<div class="comment">
      The next method (package private and static) constitutes the
      entire API of this class.</div>
<a id="L193" name="L193"></a> 193 
<div class="comment">
      Sorts the given range, using the given workspace array slice
      for temp storage when possible. This method is designed to be
      invoked from public methods (in class Arrays) after performing
      any necessary array bounds checks and expanding parameters into
      the required forms.
      @param a the array to be sorted
      @param lo the index of the first element, inclusive, to be sorted
      @param hi the index of the last element, exclusive, to be sorted
      @param c the comparator to use
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array
      @since 1.8</div>
<a id="L210" name="L210"></a> 210     <strong class="reserved">static</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> lo, <strong class="reserved">int</strong> hi, <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>,
<a id="L211" name="L211"></a> 211                          <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L212" name="L212"></a> 212         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> != <strong class="reserved">null</strong> &amp;&amp; lo &gt;= 0 &amp;&amp; lo &lt;= hi &amp;&amp; hi &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L213" name="L213"></a> 213 
<a id="L214" name="L214"></a> 214         <strong class="reserved">int</strong> nRemaining  = hi - lo;
<a id="L215" name="L215"></a> 215         <strong class="reserved">if</strong> (nRemaining &lt; 2)
<a id="L216" name="L216"></a> 216             <strong class="reserved">return</strong>;  <em class="comment">// Arrays of size 0 and 1 are always sorted</em>
<a id="L217" name="L217"></a> 217 
<a id="L218" name="L218"></a> 218         <em class="comment">// If array is small, do a "mini-TimSort" with no merges</em>
<a id="L219" name="L219"></a> 219         <strong class="reserved">if</strong> (nRemaining &lt; MIN_MERGE) <em class="brace">{</em>
<a id="L220" name="L220"></a> 220             <strong class="reserved">int</strong> initRunLen = <a href="../D/13578.html" title="Multiple defined in 2 places.">countRunAndMakeAscending</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, lo, hi, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L221" name="L221"></a> 221             <a href="../D/11843.html" title="Multiple defined in 2 places.">binarySort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, lo, hi, lo + initRunLen, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L222" name="L222"></a> 222             <strong class="reserved">return</strong>;
<a id="L223" name="L223"></a> 223         <em class="brace">}</em>
<a id="L224" name="L224"></a> 224 
<div class="comment">
          March over the array once, left to right, finding natural runs,
          extending short natural runs to minRun elements, and merging runs
          to maintain stack invariant.</div>
<a id="L230" name="L230"></a> 230         <a href="../S/917.html#L62" title="Defined at 62 in src/java/util/TimSort.java.">TimSort</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; ts = <strong class="reserved">new</strong> <a href="../S/917.html#L62" title="Defined at 62 in src/java/util/TimSort.java.">TimSort</a>&lt;&gt;(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, work, workBase, workLen);
<a id="L231" name="L231"></a> 231         <strong class="reserved">int</strong> minRun = <a href="../D/27703.html" title="Multiple defined in 2 places.">minRunLength</a>(nRemaining);
<a id="L232" name="L232"></a> 232         <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L233" name="L233"></a> 233             <em class="comment">// Identify next run</em>
<a id="L234" name="L234"></a> 234             <strong class="reserved">int</strong> runLen = <a href="../D/13578.html" title="Multiple defined in 2 places.">countRunAndMakeAscending</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, lo, hi, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L235" name="L235"></a> 235 
<a id="L236" name="L236"></a> 236             <em class="comment">// If run is short, extend to min(minRun, nRemaining)</em>
<a id="L237" name="L237"></a> 237             <strong class="reserved">if</strong> (runLen &lt; minRun) <em class="brace">{</em>
<a id="L238" name="L238"></a> 238                 <strong class="reserved">int</strong> <a href="../D/16521.html" title="Multiple defined in 3 places.">force</a> = nRemaining &lt;= minRun ? nRemaining : minRun;
<a id="L239" name="L239"></a> 239                 <a href="../D/11843.html" title="Multiple defined in 2 places.">binarySort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, lo, lo + <a href="../D/16521.html" title="Multiple defined in 3 places.">force</a>, lo + runLen, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L240" name="L240"></a> 240                 runLen = <a href="../D/16521.html" title="Multiple defined in 3 places.">force</a>;
<a id="L241" name="L241"></a> 241             <em class="brace">}</em>
<a id="L242" name="L242"></a> 242 
<a id="L243" name="L243"></a> 243             <em class="comment">// Push run onto pending-run stack, and maybe merge</em>
<a id="L244" name="L244"></a> 244             ts.<a href="../D/29961.html" title="Multiple defined in 2 places.">pushRun</a>(lo, runLen);
<a id="L245" name="L245"></a> 245             ts.<a href="../D/27637.html" title="Multiple defined in 2 places.">mergeCollapse</a>();
<a id="L246" name="L246"></a> 246 
<a id="L247" name="L247"></a> 247             <em class="comment">// Advance to find next run</em>
<a id="L248" name="L248"></a> 248             lo += runLen;
<a id="L249" name="L249"></a> 249             nRemaining -= runLen;
<a id="L250" name="L250"></a> 250         <em class="brace">}</em> <strong class="reserved">while</strong> (nRemaining != 0);
<a id="L251" name="L251"></a> 251 
<a id="L252" name="L252"></a> 252         <em class="comment">// Merge all remaining runs to complete sort</em>
<a id="L253" name="L253"></a> 253         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> lo == hi;
<a id="L254" name="L254"></a> 254         ts.<a href="../D/27642.html" title="Multiple defined in 2 places.">mergeForceCollapse</a>();
<a id="L255" name="L255"></a> 255         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> ts.stackSize == 1;
<a id="L256" name="L256"></a> 256     <em class="brace">}</em>
<a id="L257" name="L257"></a> 257 
<div class="comment">
      Sorts the specified portion of the specified array using a binary
      insertion sort.  This is the best method for sorting small numbers
      of elements.  It requires O(n log n) compares, but O(n^2) data
      movement (worst case).
      If the initial part of the specified range is already sorted,
      this method can take advantage of it: the method assumes that the
      elements from index <code>lo</code>, inclusive, to <code>start</code>,
      exclusive are already sorted.
      @param a the array in which a range is to be sorted
      @param lo the index of the first element in the range to be sorted
      @param hi the index after the last element in the range to be sorted
      @param start the index of the first element in the range that is
             not already known to be sorted (<code>lo &lt;= start &lt;= hi</code>)
      @param c comparator to used for the sort</div>
<a id="L276" name="L276"></a> 276     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("fallthrough")
<a id="L277" name="L277"></a> 277     <strong class="reserved">private</strong> <strong class="reserved">static</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">void</strong> <a href="../R/10597.html" title="Multiple referred from 4 places.">binarySort</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> lo, <strong class="reserved">int</strong> hi, <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>,
<a id="L278" name="L278"></a> 278                                        <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L279" name="L279"></a> 279         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> lo &lt;= <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &amp;&amp; <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &lt;= hi;
<a id="L280" name="L280"></a> 280         <strong class="reserved">if</strong> (<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> == lo)
<a id="L281" name="L281"></a> 281             <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>++;
<a id="L282" name="L282"></a> 282         <strong class="reserved">for</strong> ( ; <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &lt; hi; <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>++) <em class="brace">{</em>
<a id="L283" name="L283"></a> 283             <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>];
<a id="L284" name="L284"></a> 284 
<a id="L285" name="L285"></a> 285             <em class="comment">// Set left (and right) to the index where a[start] (pivot) belongs</em>
<a id="L286" name="L286"></a> 286             <strong class="reserved">int</strong> left = lo;
<a id="L287" name="L287"></a> 287             <strong class="reserved">int</strong> right = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>;
<a id="L288" name="L288"></a> 288             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> left &lt;= right;
<div class="comment">
              Invariants:
                pivot &gt;= all in [lo, left).
                pivot &lt;  all in [right, start).</div>
<a id="L294" name="L294"></a> 294             <strong class="reserved">while</strong> (left &lt; right) <em class="brace">{</em>
<a id="L295" name="L295"></a> 295                 <strong class="reserved">int</strong> mid = (left + right) &gt;&gt;&gt; 1;
<a id="L296" name="L296"></a> 296                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(pivot, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[mid]) &lt; 0)
<a id="L297" name="L297"></a> 297                     right = mid;
<a id="L298" name="L298"></a> 298                 <strong class="reserved">else</strong>
<a id="L299" name="L299"></a> 299                     left = mid + 1;
<a id="L300" name="L300"></a> 300             <em class="brace">}</em>
<a id="L301" name="L301"></a> 301             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> left == right;
<a id="L302" name="L302"></a> 302 
<div class="comment">
              The invariants still hold: pivot &gt;= all in [lo, left) and
              pivot &lt; all in [left, start), so pivot belongs at left.  Note
              that if there are elements equal to pivot, left points to the
              first slot after them -- that's why this sort is stable.
              Slide elements over to make room for pivot.</div>
<a id="L310" name="L310"></a> 310             <strong class="reserved">int</strong> n = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> - left;  <em class="comment">// The number of elements to move</em>
<a id="L311" name="L311"></a> 311             <em class="comment">// Switch is just an optimization for arraycopy in default case</em>
<a id="L312" name="L312"></a> 312             <strong class="reserved">switch</strong> (n) <em class="brace">{</em>
<a id="L313" name="L313"></a> 313                 <strong class="reserved">case</strong> 2:  <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left + 1];
<a id="L314" name="L314"></a> 314                 <strong class="reserved">case</strong> 1:  <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L315" name="L315"></a> 315                          <strong class="reserved">break</strong>;
<a id="L316" name="L316"></a> 316                 <strong class="reserved">default</strong>: <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left + 1, n);
<a id="L317" name="L317"></a> 317             <em class="brace">}</em>
<a id="L318" name="L318"></a> 318             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left] = pivot;
<a id="L319" name="L319"></a> 319         <em class="brace">}</em>
<a id="L320" name="L320"></a> 320     <em class="brace">}</em>
<a id="L321" name="L321"></a> 321 
<div class="comment">
      Returns the length of the run beginning at the specified position in
      the specified array and reverses the run if it is descending (ensuring
      that the run will always be ascending when the method returns).
      A run is the longest ascending sequence with:
         a[lo] &lt;= a[lo + 1] &lt;= a[lo + 2] &lt;= ...
      or the longest descending sequence with:
         a[lo] &gt;  a[lo + 1] &gt;  a[lo + 2] &gt;  ...
      For its intended use in a stable mergesort, the strictness of the
      definition of "descending" is needed so that the call can safely
      reverse a descending sequence without violating stability.
      @param a the array in which a run is to be counted and possibly reversed
      @param lo index of the first element in the run
      @param hi index after the last element that may be contained in the run.
              It is required that <code>lo &lt; hi</code>.
      @param c the comparator to used for the sort
      @return  the length of the run beginning at the specified position in
               the specified array</div>
<a id="L347" name="L347"></a> 347     <strong class="reserved">private</strong> <strong class="reserved">static</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">int</strong> <a href="../R/12184.html" title="Multiple referred from 4 places.">countRunAndMakeAscending</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> lo, <strong class="reserved">int</strong> hi,
<a id="L348" name="L348"></a> 348                                                     <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L349" name="L349"></a> 349         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> lo &lt; hi;
<a id="L350" name="L350"></a> 350         <strong class="reserved">int</strong> runHi = lo + 1;
<a id="L351" name="L351"></a> 351         <strong class="reserved">if</strong> (runHi == hi)
<a id="L352" name="L352"></a> 352             <strong class="reserved">return</strong> 1;
<a id="L353" name="L353"></a> 353 
<a id="L354" name="L354"></a> 354         <em class="comment">// Find end of run, and reverse range if descending</em>
<a id="L355" name="L355"></a> 355         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[runHi++], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]) &lt; 0) <em class="brace">{</em> <em class="comment">// Descending</em>
<a id="L356" name="L356"></a> 356             <strong class="reserved">while</strong> (runHi &lt; hi &amp;&amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[runHi], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[runHi - 1]) &lt; 0)
<a id="L357" name="L357"></a> 357                 runHi++;
<a id="L358" name="L358"></a> 358             <a href="../D/31414.html" title="Multiple defined in 2 places.">reverseRange</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, lo, runHi);
<a id="L359" name="L359"></a> 359         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>                              <em class="comment">// Ascending</em>
<a id="L360" name="L360"></a> 360             <strong class="reserved">while</strong> (runHi &lt; hi &amp;&amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[runHi], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[runHi - 1]) &gt;= 0)
<a id="L361" name="L361"></a> 361                 runHi++;
<a id="L362" name="L362"></a> 362         <em class="brace">}</em>
<a id="L363" name="L363"></a> 363 
<a id="L364" name="L364"></a> 364         <strong class="reserved">return</strong> runHi - lo;
<a id="L365" name="L365"></a> 365     <em class="brace">}</em>
<a id="L366" name="L366"></a> 366 
<div class="comment">
      Reverse the specified range of the specified array.
      @param a the array in which a range is to be reversed
      @param lo the index of the first element in the range to be reversed
      @param hi the index after the last element in the range to be reversed</div>
<a id="L374" name="L374"></a> 374     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/26483.html" title="Multiple referred from 2 places.">reverseRange</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> lo, <strong class="reserved">int</strong> hi) <em class="brace">{</em>
<a id="L375" name="L375"></a> 375         hi--;
<a id="L376" name="L376"></a> 376         <strong class="reserved">while</strong> (lo &lt; hi) <em class="brace">{</em>
<a id="L377" name="L377"></a> 377             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo];
<a id="L378" name="L378"></a> 378             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo++] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi];
<a id="L379" name="L379"></a> 379             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi--] = t;
<a id="L380" name="L380"></a> 380         <em class="brace">}</em>
<a id="L381" name="L381"></a> 381     <em class="brace">}</em>
<a id="L382" name="L382"></a> 382 
<div class="comment">
      Returns the minimum acceptable run length for an array of the specified
      length. Natural runs shorter than this will be extended with
      {@link #binarySort}.
      Roughly speaking, the computation is:
       If n &lt; MIN_MERGE, return n (it's too small to bother with fancy stuff).
       Else if n is an exact power of 2, return MIN_MERGE/2.
       Else return an int k, MIN_MERGE/2 &lt;= k &lt;= MIN_MERGE, such that n/k
        is close to, but strictly less than, an exact power of 2.
      For the rationale, see listsort.txt.
      @param n the length of the array to be sorted
      @return the length of the minimum run to be merged</div>
<a id="L400" name="L400"></a> 400     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/23293.html" title="Multiple referred from 2 places.">minRunLength</a>(<strong class="reserved">int</strong> n) <em class="brace">{</em>
<a id="L401" name="L401"></a> 401         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> n &gt;= 0;
<a id="L402" name="L402"></a> 402         <strong class="reserved">int</strong> r = 0;      <em class="comment">// Becomes 1 if any 1 bits are shifted off</em>
<a id="L403" name="L403"></a> 403         <strong class="reserved">while</strong> (n &gt;= MIN_MERGE) <em class="brace">{</em>
<a id="L404" name="L404"></a> 404             r |= (n &amp; 1);
<a id="L405" name="L405"></a> 405             n &gt;&gt;= 1;
<a id="L406" name="L406"></a> 406         <em class="brace">}</em>
<a id="L407" name="L407"></a> 407         <strong class="reserved">return</strong> n + r;
<a id="L408" name="L408"></a> 408     <em class="brace">}</em>
<a id="L409" name="L409"></a> 409 
<div class="comment">
      Pushes the specified run onto the pending-run stack.
      @param runBase index of the first element in the run
      @param runLen  the number of elements in the run</div>
<a id="L416" name="L416"></a> 416     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25278.html" title="Multiple referred from 2 places.">pushRun</a>(<strong class="reserved">int</strong> runBase, <strong class="reserved">int</strong> runLen) <em class="brace">{</em>
<a id="L417" name="L417"></a> 417         <strong class="reserved">this</strong>.runBase[stackSize] = runBase;
<a id="L418" name="L418"></a> 418         <strong class="reserved">this</strong>.runLen[stackSize] = runLen;
<a id="L419" name="L419"></a> 419         stackSize++;
<a id="L420" name="L420"></a> 420     <em class="brace">}</em>
<a id="L421" name="L421"></a> 421 
<div class="comment">
      Examines the stack of runs waiting to be merged and merges adjacent runs
      until the stack invariants are reestablished:
          1. runLen[i - 3] &gt; runLen[i - 2] + runLen[i - 1]
          2. runLen[i - 2] &gt; runLen[i - 1]
      This method is called each time a new run is pushed onto the stack,
      so the invariants are guaranteed to hold for i &lt; stackSize upon
      entry to the method.</div>
<a id="L433" name="L433"></a> 433     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/23232.html" title="Multiple referred from 2 places.">mergeCollapse</a>() <em class="brace">{</em>
<a id="L434" name="L434"></a> 434         <strong class="reserved">while</strong> (stackSize &gt; 1) <em class="brace">{</em>
<a id="L435" name="L435"></a> 435             <strong class="reserved">int</strong> n = stackSize - 2;
<a id="L436" name="L436"></a> 436             <strong class="reserved">if</strong> (n &gt; 0 &amp;&amp; runLen[n-1] &lt;= runLen[n] + runLen[n+1]) <em class="brace">{</em>
<a id="L437" name="L437"></a> 437                 <strong class="reserved">if</strong> (runLen[n - 1] &lt; runLen[n + 1])
<a id="L438" name="L438"></a> 438                     n--;
<a id="L439" name="L439"></a> 439                 <a href="../D/27633.html" title="Multiple defined in 2 places.">mergeAt</a>(n);
<a id="L440" name="L440"></a> 440             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (runLen[n] &lt;= runLen[n + 1]) <em class="brace">{</em>
<a id="L441" name="L441"></a> 441                 <a href="../D/27633.html" title="Multiple defined in 2 places.">mergeAt</a>(n);
<a id="L442" name="L442"></a> 442             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L443" name="L443"></a> 443                 <strong class="reserved">break</strong>; <em class="comment">// Invariant is established</em>
<a id="L444" name="L444"></a> 444             <em class="brace">}</em>
<a id="L445" name="L445"></a> 445         <em class="brace">}</em>
<a id="L446" name="L446"></a> 446     <em class="brace">}</em>
<a id="L447" name="L447"></a> 447 
<div class="comment">
      Merges all runs on the stack until only one remains.  This method is
      called once, to complete the sort.</div>
<a id="L452" name="L452"></a> 452     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/23237.html" title="Multiple referred from 2 places.">mergeForceCollapse</a>() <em class="brace">{</em>
<a id="L453" name="L453"></a> 453         <strong class="reserved">while</strong> (stackSize &gt; 1) <em class="brace">{</em>
<a id="L454" name="L454"></a> 454             <strong class="reserved">int</strong> n = stackSize - 2;
<a id="L455" name="L455"></a> 455             <strong class="reserved">if</strong> (n &gt; 0 &amp;&amp; runLen[n - 1] &lt; runLen[n + 1])
<a id="L456" name="L456"></a> 456                 n--;
<a id="L457" name="L457"></a> 457             <a href="../D/27633.html" title="Multiple defined in 2 places.">mergeAt</a>(n);
<a id="L458" name="L458"></a> 458         <em class="brace">}</em>
<a id="L459" name="L459"></a> 459     <em class="brace">}</em>
<a id="L460" name="L460"></a> 460 
<div class="comment">
      Merges the two runs at stack indices i and i+1.  Run i must be
      the penultimate or antepenultimate run on the stack.  In other words,
      i must be equal to stackSize-2 or stackSize-3.
      @param i stack index of the first of the two runs to merge</div>
<a id="L468" name="L468"></a> 468     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/23228.html" title="Multiple referred from 6 places.">mergeAt</a>(<strong class="reserved">int</strong> i) <em class="brace">{</em>
<a id="L469" name="L469"></a> 469         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> stackSize &gt;= 2;
<a id="L470" name="L470"></a> 470         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> i &gt;= 0;
<a id="L471" name="L471"></a> 471         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> i == stackSize - 2 || i == stackSize - 3;
<a id="L472" name="L472"></a> 472 
<a id="L473" name="L473"></a> 473         <strong class="reserved">int</strong> base1 = runBase[i];
<a id="L474" name="L474"></a> 474         <strong class="reserved">int</strong> len1 = runLen[i];
<a id="L475" name="L475"></a> 475         <strong class="reserved">int</strong> base2 = runBase[i + 1];
<a id="L476" name="L476"></a> 476         <strong class="reserved">int</strong> len2 = runLen[i + 1];
<a id="L477" name="L477"></a> 477         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 0 &amp;&amp; len2 &gt; 0;
<a id="L478" name="L478"></a> 478         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> base1 + len1 == base2;
<a id="L479" name="L479"></a> 479 
<div class="comment">
          Record the length of the combined runs; if i is the 3rd-last
          run now, also slide over the last run (which isn't involved
          in this merge).  The current run (i+1) goes away in any case.</div>
<a id="L485" name="L485"></a> 485         runLen[i] = len1 + len2;
<a id="L486" name="L486"></a> 486         <strong class="reserved">if</strong> (i == stackSize - 3) <em class="brace">{</em>
<a id="L487" name="L487"></a> 487             runBase[i + 1] = runBase[i + 2];
<a id="L488" name="L488"></a> 488             runLen[i + 1] = runLen[i + 2];
<a id="L489" name="L489"></a> 489         <em class="brace">}</em>
<a id="L490" name="L490"></a> 490         stackSize--;
<a id="L491" name="L491"></a> 491 
<div class="comment">
          Find where the first element of run2 goes in run1. Prior elements
          in run1 can be ignored (because they're already in place).</div>
<a id="L496" name="L496"></a> 496         <strong class="reserved">int</strong> k = <a href="../D/16624.html" title="Multiple defined in 2 places.">gallopRight</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base2], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, base1, len1, 0, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L497" name="L497"></a> 497         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> k &gt;= 0;
<a id="L498" name="L498"></a> 498         base1 += k;
<a id="L499" name="L499"></a> 499         len1 -= k;
<a id="L500" name="L500"></a> 500         <strong class="reserved">if</strong> (len1 == 0)
<a id="L501" name="L501"></a> 501             <strong class="reserved">return</strong>;
<a id="L502" name="L502"></a> 502 
<div class="comment">
          Find where the last element of run1 goes in run2. Subsequent elements
          in run2 can be ignored (because they're already in place).</div>
<a id="L507" name="L507"></a> 507         len2 = <a href="../D/16623.html" title="Multiple defined in 2 places.">gallopLeft</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base1 + len1 - 1], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, base2, len2, len2 - 1, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L508" name="L508"></a> 508         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len2 &gt;= 0;
<a id="L509" name="L509"></a> 509         <strong class="reserved">if</strong> (len2 == 0)
<a id="L510" name="L510"></a> 510             <strong class="reserved">return</strong>;
<a id="L511" name="L511"></a> 511 
<a id="L512" name="L512"></a> 512         <em class="comment">// Merge remaining runs, using tmp array with min(len1, len2) elements</em>
<a id="L513" name="L513"></a> 513         <strong class="reserved">if</strong> (len1 &lt;= len2)
<a id="L514" name="L514"></a> 514             <a href="../D/27645.html" title="Multiple defined in 2 places.">mergeLo</a>(base1, len1, base2, len2);
<a id="L515" name="L515"></a> 515         <strong class="reserved">else</strong>
<a id="L516" name="L516"></a> 516             <a href="../D/27643.html" title="Multiple defined in 2 places.">mergeHi</a>(base1, len1, base2, len2);
<a id="L517" name="L517"></a> 517     <em class="brace">}</em>
<a id="L518" name="L518"></a> 518 
<div class="comment">
      Locates the position at which to insert the specified key into the
      specified sorted range; if the range contains an element equal to key,
      returns the index of the leftmost equal element.
      @param key the key whose insertion point to search for
      @param a the array in which to search
      @param base the index of the first element in the range
      @param len the length of the range; must be &gt; 0
      @param hint the index at which to begin the search, 0 &lt;= hint &lt; n.
          The closer hint is to the result, the faster this method will run.
      @param c the comparator used to order the range, and to search
      @return the int k,  0 &lt;= k &lt;= n such that a[b + k - 1] &lt; key &lt;= a[b + k],
         pretending that a[b - 1] is minus infinity and a[b + n] is infinity.
         In other words, key belongs at index b + k; or in other words,
         the first k elements of a should precede key, and the last n - k
         should follow it.</div>
<a id="L537" name="L537"></a> 537     <strong class="reserved">private</strong> <strong class="reserved">static</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">int</strong> <a href="../R/14833.html" title="Multiple referred from 6 places.">gallopLeft</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> base, <strong class="reserved">int</strong> len, <strong class="reserved">int</strong> hint,
<a id="L538" name="L538"></a> 538                                       <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L539" name="L539"></a> 539         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len &gt; 0 &amp;&amp; hint &gt;= 0 &amp;&amp; hint &lt; len;
<a id="L540" name="L540"></a> 540         <strong class="reserved">int</strong> lastOfs = 0;
<a id="L541" name="L541"></a> 541         <strong class="reserved">int</strong> ofs = 1;
<a id="L542" name="L542"></a> 542         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + hint]) &gt; 0) <em class="brace">{</em>
<a id="L543" name="L543"></a> 543             <em class="comment">// Gallop right until a[base+hint+lastOfs] &lt; key &lt;= a[base+hint+ofs]</em>
<a id="L544" name="L544"></a> 544             <strong class="reserved">int</strong> maxOfs = len - hint;
<a id="L545" name="L545"></a> 545             <strong class="reserved">while</strong> (ofs &lt; maxOfs &amp;&amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + hint + ofs]) &gt; 0) <em class="brace">{</em>
<a id="L546" name="L546"></a> 546                 lastOfs = ofs;
<a id="L547" name="L547"></a> 547                 ofs = (ofs &lt;&lt; 1) + 1;
<a id="L548" name="L548"></a> 548                 <strong class="reserved">if</strong> (ofs &lt;= 0)   <em class="comment">// int overflow</em>
<a id="L549" name="L549"></a> 549                     ofs = maxOfs;
<a id="L550" name="L550"></a> 550             <em class="brace">}</em>
<a id="L551" name="L551"></a> 551             <strong class="reserved">if</strong> (ofs &gt; maxOfs)
<a id="L552" name="L552"></a> 552                 ofs = maxOfs;
<a id="L553" name="L553"></a> 553 
<a id="L554" name="L554"></a> 554             <em class="comment">// Make offsets relative to base</em>
<a id="L555" name="L555"></a> 555             lastOfs += hint;
<a id="L556" name="L556"></a> 556             ofs += hint;
<a id="L557" name="L557"></a> 557         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// key &lt;= a[base + hint]</em>
<a id="L558" name="L558"></a> 558             <em class="comment">// Gallop left until a[base+hint-ofs] &lt; key &lt;= a[base+hint-lastOfs]</em>
<a id="L559" name="L559"></a> 559             <strong class="reserved">final</strong> <strong class="reserved">int</strong> maxOfs = hint + 1;
<a id="L560" name="L560"></a> 560             <strong class="reserved">while</strong> (ofs &lt; maxOfs &amp;&amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + hint - ofs]) &lt;= 0) <em class="brace">{</em>
<a id="L561" name="L561"></a> 561                 lastOfs = ofs;
<a id="L562" name="L562"></a> 562                 ofs = (ofs &lt;&lt; 1) + 1;
<a id="L563" name="L563"></a> 563                 <strong class="reserved">if</strong> (ofs &lt;= 0)   <em class="comment">// int overflow</em>
<a id="L564" name="L564"></a> 564                     ofs = maxOfs;
<a id="L565" name="L565"></a> 565             <em class="brace">}</em>
<a id="L566" name="L566"></a> 566             <strong class="reserved">if</strong> (ofs &gt; maxOfs)
<a id="L567" name="L567"></a> 567                 ofs = maxOfs;
<a id="L568" name="L568"></a> 568 
<a id="L569" name="L569"></a> 569             <em class="comment">// Make offsets relative to base</em>
<a id="L570" name="L570"></a> 570             <strong class="reserved">int</strong> tmp = lastOfs;
<a id="L571" name="L571"></a> 571             lastOfs = hint - ofs;
<a id="L572" name="L572"></a> 572             ofs = hint - tmp;
<a id="L573" name="L573"></a> 573         <em class="brace">}</em>
<a id="L574" name="L574"></a> 574         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> -1 &lt;= lastOfs &amp;&amp; lastOfs &lt; ofs &amp;&amp; ofs &lt;= len;
<a id="L575" name="L575"></a> 575 
<div class="comment">
          Now a[base+lastOfs] &lt; key &lt;= a[base+ofs], so key belongs somewhere
          to the right of lastOfs but no farther right than ofs.  Do a binary
          search, with invariant a[base + lastOfs - 1] &lt; key &lt;= a[base + ofs].</div>
<a id="L581" name="L581"></a> 581         lastOfs++;
<a id="L582" name="L582"></a> 582         <strong class="reserved">while</strong> (lastOfs &lt; ofs) <em class="brace">{</em>
<a id="L583" name="L583"></a> 583             <strong class="reserved">int</strong> m = lastOfs + ((ofs - lastOfs) &gt;&gt;&gt; 1);
<a id="L584" name="L584"></a> 584 
<a id="L585" name="L585"></a> 585             <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + m]) &gt; 0)
<a id="L586" name="L586"></a> 586                 lastOfs = m + 1;  <em class="comment">// a[base + m] &lt; key</em>
<a id="L587" name="L587"></a> 587             <strong class="reserved">else</strong>
<a id="L588" name="L588"></a> 588                 ofs = m;          <em class="comment">// key &lt;= a[base + m]</em>
<a id="L589" name="L589"></a> 589         <em class="brace">}</em>
<a id="L590" name="L590"></a> 590         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> lastOfs == ofs;    <em class="comment">// so a[base + ofs - 1] &lt; key &lt;= a[base + ofs]</em>
<a id="L591" name="L591"></a> 591         <strong class="reserved">return</strong> ofs;
<a id="L592" name="L592"></a> 592     <em class="brace">}</em>
<a id="L593" name="L593"></a> 593 
<div class="comment">
      Like gallopLeft, except that if the range contains an element equal to
      key, gallopRight returns the index after the rightmost equal element.
      @param key the key whose insertion point to search for
      @param a the array in which to search
      @param base the index of the first element in the range
      @param len the length of the range; must be &gt; 0
      @param hint the index at which to begin the search, 0 &lt;= hint &lt; n.
          The closer hint is to the result, the faster this method will run.
      @param c the comparator used to order the range, and to search
      @return the int k,  0 &lt;= k &lt;= n such that a[b + k - 1] &lt;= key &lt; a[b + k]</div>
<a id="L607" name="L607"></a> 607     <strong class="reserved">private</strong> <strong class="reserved">static</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">int</strong> <a href="../R/14834.html" title="Multiple referred from 6 places.">gallopRight</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> base, <strong class="reserved">int</strong> len,
<a id="L608" name="L608"></a> 608                                        <strong class="reserved">int</strong> hint, <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L609" name="L609"></a> 609         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len &gt; 0 &amp;&amp; hint &gt;= 0 &amp;&amp; hint &lt; len;
<a id="L610" name="L610"></a> 610 
<a id="L611" name="L611"></a> 611         <strong class="reserved">int</strong> ofs = 1;
<a id="L612" name="L612"></a> 612         <strong class="reserved">int</strong> lastOfs = 0;
<a id="L613" name="L613"></a> 613         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + hint]) &lt; 0) <em class="brace">{</em>
<a id="L614" name="L614"></a> 614             <em class="comment">// Gallop left until a[b+hint - ofs] &lt;= key &lt; a[b+hint - lastOfs]</em>
<a id="L615" name="L615"></a> 615             <strong class="reserved">int</strong> maxOfs = hint + 1;
<a id="L616" name="L616"></a> 616             <strong class="reserved">while</strong> (ofs &lt; maxOfs &amp;&amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + hint - ofs]) &lt; 0) <em class="brace">{</em>
<a id="L617" name="L617"></a> 617                 lastOfs = ofs;
<a id="L618" name="L618"></a> 618                 ofs = (ofs &lt;&lt; 1) + 1;
<a id="L619" name="L619"></a> 619                 <strong class="reserved">if</strong> (ofs &lt;= 0)   <em class="comment">// int overflow</em>
<a id="L620" name="L620"></a> 620                     ofs = maxOfs;
<a id="L621" name="L621"></a> 621             <em class="brace">}</em>
<a id="L622" name="L622"></a> 622             <strong class="reserved">if</strong> (ofs &gt; maxOfs)
<a id="L623" name="L623"></a> 623                 ofs = maxOfs;
<a id="L624" name="L624"></a> 624 
<a id="L625" name="L625"></a> 625             <em class="comment">// Make offsets relative to b</em>
<a id="L626" name="L626"></a> 626             <strong class="reserved">int</strong> tmp = lastOfs;
<a id="L627" name="L627"></a> 627             lastOfs = hint - ofs;
<a id="L628" name="L628"></a> 628             ofs = hint - tmp;
<a id="L629" name="L629"></a> 629         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[b + hint] &lt;= key</em>
<a id="L630" name="L630"></a> 630             <em class="comment">// Gallop right until a[b+hint + lastOfs] &lt;= key &lt; a[b+hint + ofs]</em>
<a id="L631" name="L631"></a> 631             <strong class="reserved">int</strong> maxOfs = len - hint;
<a id="L632" name="L632"></a> 632             <strong class="reserved">while</strong> (ofs &lt; maxOfs &amp;&amp; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + hint + ofs]) &gt;= 0) <em class="brace">{</em>
<a id="L633" name="L633"></a> 633                 lastOfs = ofs;
<a id="L634" name="L634"></a> 634                 ofs = (ofs &lt;&lt; 1) + 1;
<a id="L635" name="L635"></a> 635                 <strong class="reserved">if</strong> (ofs &lt;= 0)   <em class="comment">// int overflow</em>
<a id="L636" name="L636"></a> 636                     ofs = maxOfs;
<a id="L637" name="L637"></a> 637             <em class="brace">}</em>
<a id="L638" name="L638"></a> 638             <strong class="reserved">if</strong> (ofs &gt; maxOfs)
<a id="L639" name="L639"></a> 639                 ofs = maxOfs;
<a id="L640" name="L640"></a> 640 
<a id="L641" name="L641"></a> 641             <em class="comment">// Make offsets relative to b</em>
<a id="L642" name="L642"></a> 642             lastOfs += hint;
<a id="L643" name="L643"></a> 643             ofs += hint;
<a id="L644" name="L644"></a> 644         <em class="brace">}</em>
<a id="L645" name="L645"></a> 645         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> -1 &lt;= lastOfs &amp;&amp; lastOfs &lt; ofs &amp;&amp; ofs &lt;= len;
<a id="L646" name="L646"></a> 646 
<div class="comment">
          Now a[b + lastOfs] &lt;= key &lt; a[b + ofs], so key belongs somewhere to
          the right of lastOfs but no farther right than ofs.  Do a binary
          search, with invariant a[b + lastOfs - 1] &lt;= key &lt; a[b + ofs].</div>
<a id="L652" name="L652"></a> 652         lastOfs++;
<a id="L653" name="L653"></a> 653         <strong class="reserved">while</strong> (lastOfs &lt; ofs) <em class="brace">{</em>
<a id="L654" name="L654"></a> 654             <strong class="reserved">int</strong> m = lastOfs + ((ofs - lastOfs) &gt;&gt;&gt; 1);
<a id="L655" name="L655"></a> 655 
<a id="L656" name="L656"></a> 656             <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[base + m]) &lt; 0)
<a id="L657" name="L657"></a> 657                 ofs = m;          <em class="comment">// key &lt; a[b + m]</em>
<a id="L658" name="L658"></a> 658             <strong class="reserved">else</strong>
<a id="L659" name="L659"></a> 659                 lastOfs = m + 1;  <em class="comment">// a[b + m] &lt;= key</em>
<a id="L660" name="L660"></a> 660         <em class="brace">}</em>
<a id="L661" name="L661"></a> 661         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> lastOfs == ofs;    <em class="comment">// so a[b + ofs - 1] &lt;= key &lt; a[b + ofs]</em>
<a id="L662" name="L662"></a> 662         <strong class="reserved">return</strong> ofs;
<a id="L663" name="L663"></a> 663     <em class="brace">}</em>
<a id="L664" name="L664"></a> 664 
<div class="comment">
      Merges two adjacent runs in place, in a stable fashion.  The first
      element of the first run must be greater than the first element of the
      second run (a[base1] &gt; a[base2]), and the last element of the first run
      (a[base1 + len1-1]) must be greater than all elements of the second run.
      For performance, this method should be called only when len1 &lt;= len2;
      its twin, mergeHi should be called if len1 &gt;= len2.  (Either method
      may be called if len1 == len2.)
      @param base1 index of first element in first run to be merged
      @param len1  length of first run to be merged (must be &gt; 0)
      @param base2 index of first element in second run to be merged
             (must be aBase + aLen)
      @param len2  length of second run to be merged (must be &gt; 0)</div>
<a id="L681" name="L681"></a> 681     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/23240.html" title="Multiple referred from 2 places.">mergeLo</a>(<strong class="reserved">int</strong> base1, <strong class="reserved">int</strong> len1, <strong class="reserved">int</strong> base2, <strong class="reserved">int</strong> len2) <em class="brace">{</em>
<a id="L682" name="L682"></a> 682         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 0 &amp;&amp; len2 &gt; 0 &amp;&amp; base1 + len1 == base2;
<a id="L683" name="L683"></a> 683 
<a id="L684" name="L684"></a> 684         <em class="comment">// Copy first run into temp array</em>
<a id="L685" name="L685"></a> 685         <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <strong class="reserved">this</strong>.<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <em class="comment">// For performance</em>
<a id="L686" name="L686"></a> 686         <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] tmp = <a href="../D/15596.html" title="Multiple defined in 17 places.">ensureCapacity</a>(len1);
<a id="L687" name="L687"></a> 687         <strong class="reserved">int</strong> cursor1 = tmpBase; <em class="comment">// Indexes into tmp array</em>
<a id="L688" name="L688"></a> 688         <strong class="reserved">int</strong> cursor2 = base2;   <em class="comment">// Indexes int a</em>
<a id="L689" name="L689"></a> 689         <strong class="reserved">int</strong> dest = base1;      <em class="comment">// Indexes int a</em>
<a id="L690" name="L690"></a> 690         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, base1, tmp, cursor1, len1);
<a id="L691" name="L691"></a> 691 
<a id="L692" name="L692"></a> 692         <em class="comment">// Move first element of second run and deal with degenerate cases</em>
<a id="L693" name="L693"></a> 693         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest++] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor2++];
<a id="L694" name="L694"></a> 694         <strong class="reserved">if</strong> (--len2 == 0) <em class="brace">{</em>
<a id="L695" name="L695"></a> 695             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmp, cursor1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest, len1);
<a id="L696" name="L696"></a> 696             <strong class="reserved">return</strong>;
<a id="L697" name="L697"></a> 697         <em class="brace">}</em>
<a id="L698" name="L698"></a> 698         <strong class="reserved">if</strong> (len1 == 1) <em class="brace">{</em>
<a id="L699" name="L699"></a> 699             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor2, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest, len2);
<a id="L700" name="L700"></a> 700             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest + len2] = tmp[cursor1]; <em class="comment">// Last elt of run 1 to end of merge</em>
<a id="L701" name="L701"></a> 701             <strong class="reserved">return</strong>;
<a id="L702" name="L702"></a> 702         <em class="brace">}</em>
<a id="L703" name="L703"></a> 703 
<a id="L704" name="L704"></a> 704         <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <strong class="reserved">this</strong>.<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;  <em class="comment">// Use local variable for performance</em>
<a id="L705" name="L705"></a> 705         <strong class="reserved">int</strong> minGallop = <strong class="reserved">this</strong>.minGallop;    <em class="comment">//  "    "       "     "      "</em>
<a id="L706" name="L706"></a> 706     outer:
<a id="L707" name="L707"></a> 707         <strong class="reserved">while</strong> (<strong class="reserved">true</strong>) <em class="brace">{</em>
<a id="L708" name="L708"></a> 708             <strong class="reserved">int</strong> count1 = 0; <em class="comment">// Number of times in a row that first run won</em>
<a id="L709" name="L709"></a> 709             <strong class="reserved">int</strong> count2 = 0; <em class="comment">// Number of times in a row that second run won</em>
<a id="L710" name="L710"></a> 710 
<div class="comment">
              Do the straightforward thing until (if ever) one run starts
              winning consistently.</div>
<a id="L715" name="L715"></a> 715             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L716" name="L716"></a> 716                 <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 1 &amp;&amp; len2 &gt; 0;
<a id="L717" name="L717"></a> 717                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor2], tmp[cursor1]) &lt; 0) <em class="brace">{</em>
<a id="L718" name="L718"></a> 718                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest++] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor2++];
<a id="L719" name="L719"></a> 719                     count2++;
<a id="L720" name="L720"></a> 720                     count1 = 0;
<a id="L721" name="L721"></a> 721                     <strong class="reserved">if</strong> (--len2 == 0)
<a id="L722" name="L722"></a> 722                         <strong class="reserved">break</strong> outer;
<a id="L723" name="L723"></a> 723                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L724" name="L724"></a> 724                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest++] = tmp[cursor1++];
<a id="L725" name="L725"></a> 725                     count1++;
<a id="L726" name="L726"></a> 726                     count2 = 0;
<a id="L727" name="L727"></a> 727                     <strong class="reserved">if</strong> (--len1 == 1)
<a id="L728" name="L728"></a> 728                         <strong class="reserved">break</strong> outer;
<a id="L729" name="L729"></a> 729                 <em class="brace">}</em>
<a id="L730" name="L730"></a> 730             <em class="brace">}</em> <strong class="reserved">while</strong> ((count1 | count2) &lt; minGallop);
<a id="L731" name="L731"></a> 731 
<div class="comment">
              One run is winning so consistently that galloping may be a
              huge win. So try that, and continue galloping until (if ever)
              neither run appears to be winning consistently anymore.</div>
<a id="L737" name="L737"></a> 737             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L738" name="L738"></a> 738                 <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 1 &amp;&amp; len2 &gt; 0;
<a id="L739" name="L739"></a> 739                 count1 = <a href="../D/16624.html" title="Multiple defined in 2 places.">gallopRight</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor2], tmp, cursor1, len1, 0, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L740" name="L740"></a> 740                 <strong class="reserved">if</strong> (count1 != 0) <em class="brace">{</em>
<a id="L741" name="L741"></a> 741                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmp, cursor1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest, count1);
<a id="L742" name="L742"></a> 742                     dest += count1;
<a id="L743" name="L743"></a> 743                     cursor1 += count1;
<a id="L744" name="L744"></a> 744                     len1 -= count1;
<a id="L745" name="L745"></a> 745                     <strong class="reserved">if</strong> (len1 &lt;= 1) <em class="comment">// len1 == 1 || len1 == 0</em>
<a id="L746" name="L746"></a> 746                         <strong class="reserved">break</strong> outer;
<a id="L747" name="L747"></a> 747                 <em class="brace">}</em>
<a id="L748" name="L748"></a> 748                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest++] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor2++];
<a id="L749" name="L749"></a> 749                 <strong class="reserved">if</strong> (--len2 == 0)
<a id="L750" name="L750"></a> 750                     <strong class="reserved">break</strong> outer;
<a id="L751" name="L751"></a> 751 
<a id="L752" name="L752"></a> 752                 count2 = <a href="../D/16623.html" title="Multiple defined in 2 places.">gallopLeft</a>(tmp[cursor1], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor2, len2, 0, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L753" name="L753"></a> 753                 <strong class="reserved">if</strong> (count2 != 0) <em class="brace">{</em>
<a id="L754" name="L754"></a> 754                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor2, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest, count2);
<a id="L755" name="L755"></a> 755                     dest += count2;
<a id="L756" name="L756"></a> 756                     cursor2 += count2;
<a id="L757" name="L757"></a> 757                     len2 -= count2;
<a id="L758" name="L758"></a> 758                     <strong class="reserved">if</strong> (len2 == 0)
<a id="L759" name="L759"></a> 759                         <strong class="reserved">break</strong> outer;
<a id="L760" name="L760"></a> 760                 <em class="brace">}</em>
<a id="L761" name="L761"></a> 761                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest++] = tmp[cursor1++];
<a id="L762" name="L762"></a> 762                 <strong class="reserved">if</strong> (--len1 == 1)
<a id="L763" name="L763"></a> 763                     <strong class="reserved">break</strong> outer;
<a id="L764" name="L764"></a> 764                 minGallop--;
<a id="L765" name="L765"></a> 765             <em class="brace">}</em> <strong class="reserved">while</strong> (count1 &gt;= MIN_GALLOP | count2 &gt;= MIN_GALLOP);
<a id="L766" name="L766"></a> 766             <strong class="reserved">if</strong> (minGallop &lt; 0)
<a id="L767" name="L767"></a> 767                 minGallop = 0;
<a id="L768" name="L768"></a> 768             minGallop += 2;  <em class="comment">// Penalize for leaving gallop mode</em>
<a id="L769" name="L769"></a> 769         <em class="brace">}</em>  <em class="comment">// End of "outer" loop</em>
<a id="L770" name="L770"></a> 770         <strong class="reserved">this</strong>.minGallop = minGallop &lt; 1 ? 1 : minGallop;  <em class="comment">// Write back to field</em>
<a id="L771" name="L771"></a> 771 
<a id="L772" name="L772"></a> 772         <strong class="reserved">if</strong> (len1 == 1) <em class="brace">{</em>
<a id="L773" name="L773"></a> 773             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len2 &gt; 0;
<a id="L774" name="L774"></a> 774             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor2, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest, len2);
<a id="L775" name="L775"></a> 775             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest + len2] = tmp[cursor1]; <em class="comment">//  Last elt of run 1 to end of merge</em>
<a id="L776" name="L776"></a> 776         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (len1 == 0) <em class="brace">{</em>
<a id="L777" name="L777"></a> 777             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L778" name="L778"></a> 778                 "Comparison method violates its general contract!");
<a id="L779" name="L779"></a> 779         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L780" name="L780"></a> 780             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len2 == 0;
<a id="L781" name="L781"></a> 781             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 1;
<a id="L782" name="L782"></a> 782             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmp, cursor1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest, len1);
<a id="L783" name="L783"></a> 783         <em class="brace">}</em>
<a id="L784" name="L784"></a> 784     <em class="brace">}</em>
<a id="L785" name="L785"></a> 785 
<div class="comment">
      Like mergeLo, except that this method should be called only if
      len1 &gt;= len2; mergeLo should be called if len1 &lt;= len2.  (Either method
      may be called if len1 == len2.)
      @param base1 index of first element in first run to be merged
      @param len1  length of first run to be merged (must be &gt; 0)
      @param base2 index of first element in second run to be merged
             (must be aBase + aLen)
      @param len2  length of second run to be merged (must be &gt; 0)</div>
<a id="L797" name="L797"></a> 797     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/23238.html" title="Multiple referred from 2 places.">mergeHi</a>(<strong class="reserved">int</strong> base1, <strong class="reserved">int</strong> len1, <strong class="reserved">int</strong> base2, <strong class="reserved">int</strong> len2) <em class="brace">{</em>
<a id="L798" name="L798"></a> 798         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 0 &amp;&amp; len2 &gt; 0 &amp;&amp; base1 + len1 == base2;
<a id="L799" name="L799"></a> 799 
<a id="L800" name="L800"></a> 800         <em class="comment">// Copy second run into temp array</em>
<a id="L801" name="L801"></a> 801         <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <strong class="reserved">this</strong>.<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <em class="comment">// For performance</em>
<a id="L802" name="L802"></a> 802         <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] tmp = <a href="../D/15596.html" title="Multiple defined in 17 places.">ensureCapacity</a>(len2);
<a id="L803" name="L803"></a> 803         <strong class="reserved">int</strong> tmpBase = <strong class="reserved">this</strong>.tmpBase;
<a id="L804" name="L804"></a> 804         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, base2, tmp, tmpBase, len2);
<a id="L805" name="L805"></a> 805 
<a id="L806" name="L806"></a> 806         <strong class="reserved">int</strong> cursor1 = base1 + len1 - 1;  <em class="comment">// Indexes into a</em>
<a id="L807" name="L807"></a> 807         <strong class="reserved">int</strong> cursor2 = tmpBase + len2 - 1; <em class="comment">// Indexes into tmp array</em>
<a id="L808" name="L808"></a> 808         <strong class="reserved">int</strong> dest = base2 + len2 - 1;     <em class="comment">// Indexes into a</em>
<a id="L809" name="L809"></a> 809 
<a id="L810" name="L810"></a> 810         <em class="comment">// Move last element of first run and deal with degenerate cases</em>
<a id="L811" name="L811"></a> 811         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest--] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor1--];
<a id="L812" name="L812"></a> 812         <strong class="reserved">if</strong> (--len1 == 0) <em class="brace">{</em>
<a id="L813" name="L813"></a> 813             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmp, tmpBase, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest - (len2 - 1), len2);
<a id="L814" name="L814"></a> 814             <strong class="reserved">return</strong>;
<a id="L815" name="L815"></a> 815         <em class="brace">}</em>
<a id="L816" name="L816"></a> 816         <strong class="reserved">if</strong> (len2 == 1) <em class="brace">{</em>
<a id="L817" name="L817"></a> 817             dest -= len1;
<a id="L818" name="L818"></a> 818             cursor1 -= len1;
<a id="L819" name="L819"></a> 819             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor1 + 1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest + 1, len1);
<a id="L820" name="L820"></a> 820             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest] = tmp[cursor2];
<a id="L821" name="L821"></a> 821             <strong class="reserved">return</strong>;
<a id="L822" name="L822"></a> 822         <em class="brace">}</em>
<a id="L823" name="L823"></a> 823 
<a id="L824" name="L824"></a> 824         <a href="../D/1687.html" title="Multiple defined in 3 places.">Comparator</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <strong class="reserved">this</strong>.<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;  <em class="comment">// Use local variable for performance</em>
<a id="L825" name="L825"></a> 825         <strong class="reserved">int</strong> minGallop = <strong class="reserved">this</strong>.minGallop;    <em class="comment">//  "    "       "     "      "</em>
<a id="L826" name="L826"></a> 826     outer:
<a id="L827" name="L827"></a> 827         <strong class="reserved">while</strong> (<strong class="reserved">true</strong>) <em class="brace">{</em>
<a id="L828" name="L828"></a> 828             <strong class="reserved">int</strong> count1 = 0; <em class="comment">// Number of times in a row that first run won</em>
<a id="L829" name="L829"></a> 829             <strong class="reserved">int</strong> count2 = 0; <em class="comment">// Number of times in a row that second run won</em>
<a id="L830" name="L830"></a> 830 
<div class="comment">
              Do the straightforward thing until (if ever) one run
              appears to win consistently.</div>
<a id="L835" name="L835"></a> 835             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L836" name="L836"></a> 836                 <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 0 &amp;&amp; len2 &gt; 1;
<a id="L837" name="L837"></a> 837                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/13032.html" title="Multiple defined in 71 places.">compare</a>(tmp[cursor2], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor1]) &lt; 0) <em class="brace">{</em>
<a id="L838" name="L838"></a> 838                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest--] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor1--];
<a id="L839" name="L839"></a> 839                     count1++;
<a id="L840" name="L840"></a> 840                     count2 = 0;
<a id="L841" name="L841"></a> 841                     <strong class="reserved">if</strong> (--len1 == 0)
<a id="L842" name="L842"></a> 842                         <strong class="reserved">break</strong> outer;
<a id="L843" name="L843"></a> 843                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L844" name="L844"></a> 844                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest--] = tmp[cursor2--];
<a id="L845" name="L845"></a> 845                     count2++;
<a id="L846" name="L846"></a> 846                     count1 = 0;
<a id="L847" name="L847"></a> 847                     <strong class="reserved">if</strong> (--len2 == 1)
<a id="L848" name="L848"></a> 848                         <strong class="reserved">break</strong> outer;
<a id="L849" name="L849"></a> 849                 <em class="brace">}</em>
<a id="L850" name="L850"></a> 850             <em class="brace">}</em> <strong class="reserved">while</strong> ((count1 | count2) &lt; minGallop);
<a id="L851" name="L851"></a> 851 
<div class="comment">
              One run is winning so consistently that galloping may be a
              huge win. So try that, and continue galloping until (if ever)
              neither run appears to be winning consistently anymore.</div>
<a id="L857" name="L857"></a> 857             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L858" name="L858"></a> 858                 <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 0 &amp;&amp; len2 &gt; 1;
<a id="L859" name="L859"></a> 859                 count1 = len1 - <a href="../D/16624.html" title="Multiple defined in 2 places.">gallopRight</a>(tmp[cursor2], <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, base1, len1, len1 - 1, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L860" name="L860"></a> 860                 <strong class="reserved">if</strong> (count1 != 0) <em class="brace">{</em>
<a id="L861" name="L861"></a> 861                     dest -= count1;
<a id="L862" name="L862"></a> 862                     cursor1 -= count1;
<a id="L863" name="L863"></a> 863                     len1 -= count1;
<a id="L864" name="L864"></a> 864                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor1 + 1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest + 1, count1);
<a id="L865" name="L865"></a> 865                     <strong class="reserved">if</strong> (len1 == 0)
<a id="L866" name="L866"></a> 866                         <strong class="reserved">break</strong> outer;
<a id="L867" name="L867"></a> 867                 <em class="brace">}</em>
<a id="L868" name="L868"></a> 868                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest--] = tmp[cursor2--];
<a id="L869" name="L869"></a> 869                 <strong class="reserved">if</strong> (--len2 == 1)
<a id="L870" name="L870"></a> 870                     <strong class="reserved">break</strong> outer;
<a id="L871" name="L871"></a> 871 
<a id="L872" name="L872"></a> 872                 count2 = len2 - <a href="../D/16623.html" title="Multiple defined in 2 places.">gallopLeft</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor1], tmp, tmpBase, len2, len2 - 1, <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L873" name="L873"></a> 873                 <strong class="reserved">if</strong> (count2 != 0) <em class="brace">{</em>
<a id="L874" name="L874"></a> 874                     dest -= count2;
<a id="L875" name="L875"></a> 875                     cursor2 -= count2;
<a id="L876" name="L876"></a> 876                     len2 -= count2;
<a id="L877" name="L877"></a> 877                     <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmp, cursor2 + 1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest + 1, count2);
<a id="L878" name="L878"></a> 878                     <strong class="reserved">if</strong> (len2 &lt;= 1)  <em class="comment">// len2 == 1 || len2 == 0</em>
<a id="L879" name="L879"></a> 879                         <strong class="reserved">break</strong> outer;
<a id="L880" name="L880"></a> 880                 <em class="brace">}</em>
<a id="L881" name="L881"></a> 881                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest--] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[cursor1--];
<a id="L882" name="L882"></a> 882                 <strong class="reserved">if</strong> (--len1 == 0)
<a id="L883" name="L883"></a> 883                     <strong class="reserved">break</strong> outer;
<a id="L884" name="L884"></a> 884                 minGallop--;
<a id="L885" name="L885"></a> 885             <em class="brace">}</em> <strong class="reserved">while</strong> (count1 &gt;= MIN_GALLOP | count2 &gt;= MIN_GALLOP);
<a id="L886" name="L886"></a> 886             <strong class="reserved">if</strong> (minGallop &lt; 0)
<a id="L887" name="L887"></a> 887                 minGallop = 0;
<a id="L888" name="L888"></a> 888             minGallop += 2;  <em class="comment">// Penalize for leaving gallop mode</em>
<a id="L889" name="L889"></a> 889         <em class="brace">}</em>  <em class="comment">// End of "outer" loop</em>
<a id="L890" name="L890"></a> 890         <strong class="reserved">this</strong>.minGallop = minGallop &lt; 1 ? 1 : minGallop;  <em class="comment">// Write back to field</em>
<a id="L891" name="L891"></a> 891 
<a id="L892" name="L892"></a> 892         <strong class="reserved">if</strong> (len2 == 1) <em class="brace">{</em>
<a id="L893" name="L893"></a> 893             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 &gt; 0;
<a id="L894" name="L894"></a> 894             dest -= len1;
<a id="L895" name="L895"></a> 895             cursor1 -= len1;
<a id="L896" name="L896"></a> 896             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, cursor1 + 1, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest + 1, len1);
<a id="L897" name="L897"></a> 897             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[dest] = tmp[cursor2];  <em class="comment">// Move first elt of run2 to front of merge</em>
<a id="L898" name="L898"></a> 898         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (len2 == 0) <em class="brace">{</em>
<a id="L899" name="L899"></a> 899             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>(
<a id="L900" name="L900"></a> 900                 "Comparison method violates its general contract!");
<a id="L901" name="L901"></a> 901         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L902" name="L902"></a> 902             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len1 == 0;
<a id="L903" name="L903"></a> 903             <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> len2 &gt; 0;
<a id="L904" name="L904"></a> 904             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmp, tmpBase, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, dest - (len2 - 1), len2);
<a id="L905" name="L905"></a> 905         <em class="brace">}</em>
<a id="L906" name="L906"></a> 906     <em class="brace">}</em>
<a id="L907" name="L907"></a> 907 
<div class="comment">
      Ensures that the external array tmp has at least the specified
      number of elements, increasing its size if necessary.  The size
      increases exponentially to ensure amortized linear time complexity.
      @param minCapacity the minimum required capacity of the tmp array
      @return tmp, whether or not it grew</div>
<a id="L916" name="L916"></a> 916     <strong class="reserved">private</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../R/13907.html" title="Multiple referred from 31 places.">ensureCapacity</a>(<strong class="reserved">int</strong> minCapacity) <em class="brace">{</em>
<a id="L917" name="L917"></a> 917         <strong class="reserved">if</strong> (tmpLen &lt; minCapacity) <em class="brace">{</em>
<a id="L918" name="L918"></a> 918             <em class="comment">// Compute smallest power of 2 &gt; minCapacity</em>
<a id="L919" name="L919"></a> 919             <strong class="reserved">int</strong> newSize = minCapacity;
<a id="L920" name="L920"></a> 920             newSize |= newSize &gt;&gt; 1;
<a id="L921" name="L921"></a> 921             newSize |= newSize &gt;&gt; 2;
<a id="L922" name="L922"></a> 922             newSize |= newSize &gt;&gt; 4;
<a id="L923" name="L923"></a> 923             newSize |= newSize &gt;&gt; 8;
<a id="L924" name="L924"></a> 924             newSize |= newSize &gt;&gt; 16;
<a id="L925" name="L925"></a> 925             newSize++;
<a id="L926" name="L926"></a> 926 
<a id="L927" name="L927"></a> 927             <strong class="reserved">if</strong> (newSize &lt; 0) <em class="comment">// Not bloody likely!</em>
<a id="L928" name="L928"></a> 928                 newSize = minCapacity;
<a id="L929" name="L929"></a> 929             <strong class="reserved">else</strong>
<a id="L930" name="L930"></a> 930                 newSize = <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27697.html" title="Multiple defined in 28 places.">min</a>(newSize, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt;&gt; 1);
<a id="L931" name="L931"></a> 931 
<a id="L932" name="L932"></a> 932             @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>(<em class="brace">{</em>"unchecked", "UnnecessaryLocalVariable"<em class="brace">}</em>)
<a id="L933" name="L933"></a> 933             <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[] <a href="../D/27956.html" title="Multiple defined in 13 places.">newArray</a> = (<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[])<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.lang.reflect.<a href="../D/487.html" title="Multiple defined in 2 places.">Array</a>.<a href="../D/28016.html" title="Multiple defined in 74 places.">newInstance</a>
<a id="L934" name="L934"></a> 934                 (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>().<a href="../D/17880.html" title="Multiple defined in 2 places.">getComponentType</a>(), newSize);
<a id="L935" name="L935"></a> 935             tmp = <a href="../D/27956.html" title="Multiple defined in 13 places.">newArray</a>;
<a id="L936" name="L936"></a> 936             tmpLen = newSize;
<a id="L937" name="L937"></a> 937             tmpBase = 0;
<a id="L938" name="L938"></a> 938         <em class="brace">}</em>
<a id="L939" name="L939"></a> 939         <strong class="reserved">return</strong> tmp;
<a id="L940" name="L940"></a> 940     <em class="brace">}</em>
<a id="L941" name="L941"></a> 941 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L210">[^]</a><a href="#L916">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>