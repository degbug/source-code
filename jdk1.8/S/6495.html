<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/jmx/remote/security/FileLoginModule.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L169">[^]</a><a href="#L558">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L169" title="Defined at 169.">initialize</a></li>
<li><a href="#L221" title="Defined at 221.">login</a></li>
<li><a href="#L333" title="Defined at 333.">commit</a></li>
<li><a href="#L374" title="Defined at 374.">abort</a></li>
<li><a href="#L407" title="Defined at 407.">logout</a></li>
<li><a href="#L433" title="Defined at 433.">SuppressWarnings</a></li>
<li><a href="#L434" title="Defined at 434.">attemptAuthentication</a></li>
<li><a href="#L474" title="Defined at 474.">loadPasswordFile</a></li>
<li><a href="#L515" title="Defined at 515.">getUsernamePassword</a></li>
<li><a href="#L558" title="Defined at 558.">cleanState</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2004, 2008, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> com.sun.jmx.remote.security;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> com.sun.jmx.mbeanserver.GetPropertyAction;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> com.sun.jmx.mbeanserver.Util;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.io.BufferedInputStream;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.io.File;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.io.FileInputStream;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.io.FilePermission;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> java.io.IOException;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> java.security.AccessControlException;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.security.AccessController;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.Arrays;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.Hashtable;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.Map;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.util.Properties;
<a id="L41" name="L41"></a>  41 
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> javax.security.auth.*;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> javax.security.auth.callback.*;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> javax.security.auth.login.*;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> javax.security.auth.spi.*;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> javax.management.remote.JMXPrincipal;
<a id="L47" name="L47"></a>  47 
<a id="L48" name="L48"></a>  48 <strong class="reserved">import</strong> com.sun.jmx.remote.util.ClassLogger;
<a id="L49" name="L49"></a>  49 <strong class="reserved">import</strong> com.sun.jmx.remote.util.EnvHelp;
<a id="L50" name="L50"></a>  50 <strong class="reserved">import</strong> sun.management.jmxremote.ConnectorBootstrap;
<a id="L51" name="L51"></a>  51 
<div class="comment">
  This <a href="../S/2646.html#L129" title="Defined at 129 in src/javax/security/auth/spi/LoginModule.java.">LoginModule</a> performs file-based authentication.
  <p> A supplied username and password is verified against the
  corresponding user credentials stored in a designated password file.
  If successful then a new <a href="../S/3622.html#L50" title="Defined at 50 in src/javax/management/remote/JMXPrincipal.java.">JMXPrincipal</a> is created with the
  user's name and it is associated with the current <a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a>.
  Such principals may be identified and granted management privileges in
  the access control file for JMX remote management or in a Java security
  policy.
  </p><p> The password file comprises a list of key-value pairs as specified in
  <a href="../S/1039.html#L122" title="Defined at 122 in src/java/util/Properties.java.">Properties</a>. The key represents a user's name and the value is its
  associated cleartext password. By default, the following password file is
  used:
  </p><pre>      ${java.home}/lib/management/jmxremote.password
  </pre>
  A different password file can be specified via the <code>passwordFile</code>
  configuration option.
  <p> This module recognizes the following <code>Configuration</code> options:
  </p><dl>
  <dt> <code>passwordFile</code> </dt>
  <dd> the path to an alternative password file. It is used instead of
       the default password file.</dd>
  <dt> <code>useFirstPass</code> </dt>
  <dd> if <code>true</code>, this module retrieves the username and password
       from the module's shared state, using "javax.security.auth.login.name"
       and "javax.security.auth.login.password" as the respective keys. The
       retrieved values are used for authentication. If authentication fails,
       no attempt for a retry is made, and the failure is reported back to
       the calling application.</dd>
  <dt> <code>tryFirstPass</code> </dt>
  <dd> if <code>true</code>, this module retrieves the username and password
       from the module's shared state, using "javax.security.auth.login.name"
        and "javax.security.auth.login.password" as the respective keys.  The
       retrieved values are used for authentication. If authentication fails,
       the module uses the CallbackHandler to retrieve a new username and
       password, and another attempt to authenticate is made. If the
       authentication fails, the failure is reported back to the calling
       application.</dd>
  <dt> <code>storePass</code> </dt>
  <dd> if <code>true</code>, this module stores the username and password
       obtained from the CallbackHandler in the module's shared state, using
       "javax.security.auth.login.name" and
       "javax.security.auth.login.password" as the respective keys.  This is
       not performed if existing values already exist for the username and
       password in the shared state, or if authentication fails.</dd>
  <dt> <code>clearPass</code> </dt>
  <dd> if <code>true</code>, this module clears the username and password
       stored in the module's shared state after both phases of authentication
       (login and commit) have completed.</dd>
  </dl></div>
<a id="L111" name="L111"></a> 111 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../S/6500.html#L302" title="Referred from 302 in src/com/sun/jmx/remote/security/JMXPluggableAuthenticator.java.">FileLoginModule</a> <strong class="reserved">implements</strong> <a href="../S/2646.html#L129" title="Defined at 129 in src/javax/security/auth/spi/LoginModule.java.">LoginModule</a> <em class="brace">{</em>
<a id="L112" name="L112"></a> 112 
<a id="L113" name="L113"></a> 113     <em class="comment">// Location of the default password file</em>
<a id="L114" name="L114"></a> 114     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> DEFAULT_PASSWORD_FILE_NAME =
<a id="L115" name="L115"></a> 115         <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(<strong class="reserved">new</strong> <a href="../D/3576.html" title="Multiple defined in 3 places.">GetPropertyAction</a>("java.home")) +
<a id="L116" name="L116"></a> 116         <a href="../S/1433.html#L149" title="Defined at 149 in src/java/io/File.java.">File</a>.separatorChar + "lib" +
<a id="L117" name="L117"></a> 117         <a href="../S/1433.html#L149" title="Defined at 149 in src/java/io/File.java.">File</a>.separatorChar + "management" + <a href="../S/1433.html#L149" title="Defined at 149 in src/java/io/File.java.">File</a>.separatorChar +
<a id="L118" name="L118"></a> 118         ConnectorBootstrap.DefaultValues.PASSWORD_FILE_NAME;
<a id="L119" name="L119"></a> 119 
<a id="L120" name="L120"></a> 120     <em class="comment">// Key to retrieve the stored username</em>
<a id="L121" name="L121"></a> 121     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> USERNAME_KEY =
<a id="L122" name="L122"></a> 122         "javax.security.auth.login.name";
<a id="L123" name="L123"></a> 123 
<a id="L124" name="L124"></a> 124     <em class="comment">// Key to retrieve the stored password</em>
<a id="L125" name="L125"></a> 125     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> PASSWORD_KEY =
<a id="L126" name="L126"></a> 126         "javax.security.auth.login.password";
<a id="L127" name="L127"></a> 127 
<a id="L128" name="L128"></a> 128     <em class="comment">// Log messages</em>
<a id="L129" name="L129"></a> 129     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/6492.html#L30" title="Defined at 30 in src/com/sun/jmx/remote/util/ClassLogger.java.">ClassLogger</a> <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a> =
<a id="L130" name="L130"></a> 130         <strong class="reserved">new</strong> <a href="../S/6492.html#L30" title="Defined at 30 in src/com/sun/jmx/remote/util/ClassLogger.java.">ClassLogger</a>("javax.management.remote.misc", "FileLoginModule");
<a id="L131" name="L131"></a> 131 
<a id="L132" name="L132"></a> 132     <em class="comment">// Configurable options</em>
<a id="L133" name="L133"></a> 133     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> useFirstPass = <strong class="reserved">false</strong>;
<a id="L134" name="L134"></a> 134     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> tryFirstPass = <strong class="reserved">false</strong>;
<a id="L135" name="L135"></a> 135     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> storePass = <strong class="reserved">false</strong>;
<a id="L136" name="L136"></a> 136     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> clearPass = <strong class="reserved">false</strong>;
<a id="L137" name="L137"></a> 137 
<a id="L138" name="L138"></a> 138     <em class="comment">// Authentication status</em>
<a id="L139" name="L139"></a> 139     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> succeeded = <strong class="reserved">false</strong>;
<a id="L140" name="L140"></a> 140     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> commitSucceeded = <strong class="reserved">false</strong>;
<a id="L141" name="L141"></a> 141 
<a id="L142" name="L142"></a> 142     <em class="comment">// Supplied username and password</em>
<a id="L143" name="L143"></a> 143     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> username;
<a id="L144" name="L144"></a> 144     <strong class="reserved">private</strong> <strong class="reserved">char</strong>[] password;
<a id="L145" name="L145"></a> 145     <strong class="reserved">private</strong> <a href="../S/3622.html#L50" title="Defined at 50 in src/javax/management/remote/JMXPrincipal.java.">JMXPrincipal</a> user;
<a id="L146" name="L146"></a> 146 
<a id="L147" name="L147"></a> 147     <em class="comment">// Initial state</em>
<a id="L148" name="L148"></a> 148     <strong class="reserved">private</strong> <a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a> subject;
<a id="L149" name="L149"></a> 149     <strong class="reserved">private</strong> <a href="../S/2659.html#L68" title="Defined at 68 in src/javax/security/auth/callback/CallbackHandler.java.">CallbackHandler</a> callbackHandler;
<a id="L150" name="L150"></a> 150     <strong class="reserved">private</strong> <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt; sharedState;
<a id="L151" name="L151"></a> 151     <strong class="reserved">private</strong> <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>, ?&gt; <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>;
<a id="L152" name="L152"></a> 152     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> passwordFile;
<a id="L153" name="L153"></a> 153     <strong class="reserved">private</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> passwordFileDisplayName;
<a id="L154" name="L154"></a> 154     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> userSuppliedPasswordFile;
<a id="L155" name="L155"></a> 155     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> hasJavaHomePermission;
<a id="L156" name="L156"></a> 156     <strong class="reserved">private</strong> <a href="../S/1039.html#L122" title="Defined at 122 in src/java/util/Properties.java.">Properties</a> userCredentials;
<a id="L157" name="L157"></a> 157 
<div class="comment">
      Initialize this <code>LoginModule</code>.
      @param subject the <code>Subject</code> to be authenticated.
      @param callbackHandler a <code>CallbackHandler</code> to acquire the
                       user's name and password.
      @param sharedState shared <code>LoginModule</code> state.
      @param options options specified in the login
                       <code>Configuration</code> for this particular
                       <code>LoginModule</code>.</div>
<a id="L169" name="L169"></a> 169     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/20681.html" title="Multiple referred from 99 places.">initialize</a>(<a href="../S/2639.html#L100" title="Defined at 100 in src/javax/security/auth/Subject.java.">Subject</a> subject, <a href="../S/2659.html#L68" title="Defined at 68 in src/javax/security/auth/callback/CallbackHandler.java.">CallbackHandler</a> callbackHandler,
<a id="L170" name="L170"></a> 170                            <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>,?&gt; sharedState,
<a id="L171" name="L171"></a> 171                            <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>,?&gt; <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>)
<a id="L172" name="L172"></a> 172     <em class="brace">{</em>
<a id="L173" name="L173"></a> 173 
<a id="L174" name="L174"></a> 174         <strong class="reserved">this</strong>.subject = subject;
<a id="L175" name="L175"></a> 175         <strong class="reserved">this</strong>.callbackHandler = callbackHandler;
<a id="L176" name="L176"></a> 176         <strong class="reserved">this</strong>.sharedState = <a href="../D/9440.html" title="Multiple defined in 6 places.">Util</a>.<a href="../D/12274.html" title="Multiple defined in 6 places.">cast</a>(sharedState);
<a id="L177" name="L177"></a> 177         <strong class="reserved">this</strong>.<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a> = <a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>;
<a id="L178" name="L178"></a> 178 
<a id="L179" name="L179"></a> 179         <em class="comment">// initialize any configured options</em>
<a id="L180" name="L180"></a> 180         tryFirstPass =
<a id="L181" name="L181"></a> 181                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("tryFirstPass"));
<a id="L182" name="L182"></a> 182         useFirstPass =
<a id="L183" name="L183"></a> 183                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("useFirstPass"));
<a id="L184" name="L184"></a> 184         storePass =
<a id="L185" name="L185"></a> 185                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("storePass"));
<a id="L186" name="L186"></a> 186         clearPass =
<a id="L187" name="L187"></a> 187                 "true".<a href="../D/15687.html" title="Multiple defined in 6 places.">equalsIgnoreCase</a>((<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("clearPass"));
<a id="L188" name="L188"></a> 188 
<a id="L189" name="L189"></a> 189         passwordFile = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)<a href="../S/7709.html#L57" title="Defined at 57 in src/com/sun/javadoc/RootDoc.java.">options</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>("passwordFile");
<a id="L190" name="L190"></a> 190         passwordFileDisplayName = passwordFile;
<a id="L191" name="L191"></a> 191         userSuppliedPasswordFile = <strong class="reserved">true</strong>;
<a id="L192" name="L192"></a> 192 
<a id="L193" name="L193"></a> 193         <em class="comment">// set the location of the password file</em>
<a id="L194" name="L194"></a> 194         <strong class="reserved">if</strong> (passwordFile == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L195" name="L195"></a> 195             passwordFile = DEFAULT_PASSWORD_FILE_NAME;
<a id="L196" name="L196"></a> 196             userSuppliedPasswordFile = <strong class="reserved">false</strong>;
<a id="L197" name="L197"></a> 197             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L198" name="L198"></a> 198                 <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>("java.home");
<a id="L199" name="L199"></a> 199                 hasJavaHomePermission = <strong class="reserved">true</strong>;
<a id="L200" name="L200"></a> 200                 passwordFileDisplayName = passwordFile;
<a id="L201" name="L201"></a> 201             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1580.html#L34" title="Defined at 34 in src/java/lang/SecurityException.java.">SecurityException</a> e) <em class="brace">{</em>
<a id="L202" name="L202"></a> 202                 hasJavaHomePermission = <strong class="reserved">false</strong>;
<a id="L203" name="L203"></a> 203                 passwordFileDisplayName =
<a id="L204" name="L204"></a> 204                         ConnectorBootstrap.DefaultValues.PASSWORD_FILE_NAME;
<a id="L205" name="L205"></a> 205             <em class="brace">}</em>
<a id="L206" name="L206"></a> 206         <em class="brace">}</em>
<a id="L207" name="L207"></a> 207     <em class="brace">}</em>
<a id="L208" name="L208"></a> 208 
<div class="comment">
      Begin user authentication (Authentication Phase 1).
      <p> Acquire the user's name and password and verify them against
      the corresponding credentials from the password file.
      @return true always, since this <code>LoginModule</code>
               should not be ignored.
      @exception FailedLoginException if the authentication fails.
      @exception LoginException if this <code>LoginModule</code>
               is unable to perform the authentication.</p></div>
<a id="L221" name="L221"></a> 221     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22690.html" title="Multiple referred from 35 places.">login</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L222" name="L222"></a> 222 
<a id="L223" name="L223"></a> 223         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L224" name="L224"></a> 224             <a href="../S/6495.html#L474" title="Defined at 474 in src/com/sun/jmx/remote/security/FileLoginModule.java.">loadPasswordFile</a>();
<a id="L225" name="L225"></a> 225         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> ioe) <em class="brace">{</em>
<a id="L226" name="L226"></a> 226             <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(
<a id="L227" name="L227"></a> 227                     "Error: unable to load the password file: " +
<a id="L228" name="L228"></a> 228                     passwordFileDisplayName);
<a id="L229" name="L229"></a> 229             <strong class="reserved">throw</strong> <a href="../S/6493.html#L55" title="Defined at 55 in src/com/sun/jmx/remote/util/EnvHelp.java.">EnvHelp</a>.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(le, ioe);
<a id="L230" name="L230"></a> 230         <em class="brace">}</em>
<a id="L231" name="L231"></a> 231 
<a id="L232" name="L232"></a> 232         <strong class="reserved">if</strong> (userCredentials == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L233" name="L233"></a> 233             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>
<a id="L234" name="L234"></a> 234                 ("Error: unable to locate the users' credentials.");
<a id="L235" name="L235"></a> 235         <em class="brace">}</em>
<a id="L236" name="L236"></a> 236 
<a id="L237" name="L237"></a> 237         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L238" name="L238"></a> 238             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login",
<a id="L239" name="L239"></a> 239                     "Using password file: " + passwordFileDisplayName);
<a id="L240" name="L240"></a> 240         <em class="brace">}</em>
<a id="L241" name="L241"></a> 241 
<a id="L242" name="L242"></a> 242         <em class="comment">// attempt the authentication</em>
<a id="L243" name="L243"></a> 243         <strong class="reserved">if</strong> (tryFirstPass) <em class="brace">{</em>
<a id="L244" name="L244"></a> 244 
<a id="L245" name="L245"></a> 245             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L246" name="L246"></a> 246                 <em class="comment">// attempt the authentication by getting the</em>
<a id="L247" name="L247"></a> 247                 <em class="comment">// username and password from shared state</em>
<a id="L248" name="L248"></a> 248                 <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">true</strong>);
<a id="L249" name="L249"></a> 249 
<a id="L250" name="L250"></a> 250                 <em class="comment">// authentication succeeded</em>
<a id="L251" name="L251"></a> 251                 succeeded = <strong class="reserved">true</strong>;
<a id="L252" name="L252"></a> 252                 <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L253" name="L253"></a> 253                     <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login",
<a id="L254" name="L254"></a> 254                         "Authentication using cached password has succeeded");
<a id="L255" name="L255"></a> 255                 <em class="brace">}</em>
<a id="L256" name="L256"></a> 256                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L257" name="L257"></a> 257 
<a id="L258" name="L258"></a> 258             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L259" name="L259"></a> 259                 <em class="comment">// authentication failed -- try again below by prompting</em>
<a id="L260" name="L260"></a> 260                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L261" name="L261"></a> 261                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login",
<a id="L262" name="L262"></a> 262                     "Authentication using cached password has failed");
<a id="L263" name="L263"></a> 263             <em class="brace">}</em>
<a id="L264" name="L264"></a> 264 
<a id="L265" name="L265"></a> 265         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (useFirstPass) <em class="brace">{</em>
<a id="L266" name="L266"></a> 266 
<a id="L267" name="L267"></a> 267             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L268" name="L268"></a> 268                 <em class="comment">// attempt the authentication by getting the</em>
<a id="L269" name="L269"></a> 269                 <em class="comment">// username and password from shared state</em>
<a id="L270" name="L270"></a> 270                 <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">true</strong>);
<a id="L271" name="L271"></a> 271 
<a id="L272" name="L272"></a> 272                 <em class="comment">// authentication succeeded</em>
<a id="L273" name="L273"></a> 273                 succeeded = <strong class="reserved">true</strong>;
<a id="L274" name="L274"></a> 274                 <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L275" name="L275"></a> 275                     <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login",
<a id="L276" name="L276"></a> 276                         "Authentication using cached password has succeeded");
<a id="L277" name="L277"></a> 277                 <em class="brace">}</em>
<a id="L278" name="L278"></a> 278                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L279" name="L279"></a> 279 
<a id="L280" name="L280"></a> 280             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L281" name="L281"></a> 281                 <em class="comment">// authentication failed</em>
<a id="L282" name="L282"></a> 282                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L283" name="L283"></a> 283                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login",
<a id="L284" name="L284"></a> 284                     "Authentication using cached password has failed");
<a id="L285" name="L285"></a> 285 
<a id="L286" name="L286"></a> 286                 <strong class="reserved">throw</strong> le;
<a id="L287" name="L287"></a> 287             <em class="brace">}</em>
<a id="L288" name="L288"></a> 288         <em class="brace">}</em>
<a id="L289" name="L289"></a> 289 
<a id="L290" name="L290"></a> 290         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L291" name="L291"></a> 291             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login", "Acquiring password");
<a id="L292" name="L292"></a> 292         <em class="brace">}</em>
<a id="L293" name="L293"></a> 293 
<a id="L294" name="L294"></a> 294         <em class="comment">// attempt the authentication using the supplied username and password</em>
<a id="L295" name="L295"></a> 295         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L296" name="L296"></a> 296             <a href="../D/11623.html" title="Multiple defined in 4 places.">attemptAuthentication</a>(<strong class="reserved">false</strong>);
<a id="L297" name="L297"></a> 297 
<a id="L298" name="L298"></a> 298             <em class="comment">// authentication succeeded</em>
<a id="L299" name="L299"></a> 299             succeeded = <strong class="reserved">true</strong>;
<a id="L300" name="L300"></a> 300             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L301" name="L301"></a> 301                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login", "Authentication has succeeded");
<a id="L302" name="L302"></a> 302             <em class="brace">}</em>
<a id="L303" name="L303"></a> 303             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L304" name="L304"></a> 304 
<a id="L305" name="L305"></a> 305         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le) <em class="brace">{</em>
<a id="L306" name="L306"></a> 306             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L307" name="L307"></a> 307             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login", "Authentication has failed");
<a id="L308" name="L308"></a> 308 
<a id="L309" name="L309"></a> 309             <strong class="reserved">throw</strong> le;
<a id="L310" name="L310"></a> 310         <em class="brace">}</em>
<a id="L311" name="L311"></a> 311     <em class="brace">}</em>
<a id="L312" name="L312"></a> 312 
<div class="comment">
      Complete user authentication (Authentication Phase 2).
      <p> This method is called if the LoginContext's
      overall authentication has succeeded
      (all the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
      LoginModules have succeeded).
      </p><p> If this LoginModule's own authentication attempt
      succeeded (checked by retrieving the private state saved by the
      <code>login</code> method), then this method associates a
      <code>JMXPrincipal</code> with the <code>Subject</code> located in the
      <code>LoginModule</code>.  If this LoginModule's own
      authentication attempted failed, then this method removes
      any state that was originally saved.
      @exception LoginException if the commit fails
      @return true if this LoginModule's own login and commit
               attempts succeeded, or false otherwise.</p></div>
<a id="L333" name="L333"></a> 333     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/11674.html" title="Multiple referred from 3 places.">commit</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L334" name="L334"></a> 334 
<a id="L335" name="L335"></a> 335         <strong class="reserved">if</strong> (succeeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L336" name="L336"></a> 336             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L337" name="L337"></a> 337         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L338" name="L338"></a> 338             <strong class="reserved">if</strong> (subject.<a href="../D/26131.html" title="Multiple defined in 90 places.">isReadOnly</a>()) <em class="brace">{</em>
<a id="L339" name="L339"></a> 339                 <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L340" name="L340"></a> 340                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Subject is read-only");
<a id="L341" name="L341"></a> 341             <em class="brace">}</em>
<a id="L342" name="L342"></a> 342             <em class="comment">// add Principals to the Subject</em>
<a id="L343" name="L343"></a> 343             <strong class="reserved">if</strong> (!subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(user)) <em class="brace">{</em>
<a id="L344" name="L344"></a> 344                 subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(user);
<a id="L345" name="L345"></a> 345             <em class="brace">}</em>
<a id="L346" name="L346"></a> 346 
<a id="L347" name="L347"></a> 347             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L348" name="L348"></a> 348                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("commit",
<a id="L349" name="L349"></a> 349                     "Authentication has completed successfully");
<a id="L350" name="L350"></a> 350             <em class="brace">}</em>
<a id="L351" name="L351"></a> 351         <em class="brace">}</em>
<a id="L352" name="L352"></a> 352         <em class="comment">// in any case, clean out state</em>
<a id="L353" name="L353"></a> 353         <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L354" name="L354"></a> 354         commitSucceeded = <strong class="reserved">true</strong>;
<a id="L355" name="L355"></a> 355         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L356" name="L356"></a> 356     <em class="brace">}</em>
<a id="L357" name="L357"></a> 357 
<div class="comment">
      Abort user authentication (Authentication Phase 2).
      <p> This method is called if the LoginContext's overall authentication
      failed (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
      LoginModules did not succeed).
      </p><p> If this LoginModule's own authentication attempt
      succeeded (checked by retrieving the private state saved by the
      <code>login</code> and <code>commit</code> methods),
      then this method cleans up any state that was originally saved.
      @exception LoginException if the abort fails.
      @return false if this LoginModule's own login and/or commit attempts
               failed, and true otherwise.</p></div>
<a id="L374" name="L374"></a> 374     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/9495.html" title="Multiple referred from 10 places.">abort</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L375" name="L375"></a> 375 
<a id="L376" name="L376"></a> 376         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L377" name="L377"></a> 377             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("abort",
<a id="L378" name="L378"></a> 378                 "Authentication has not completed successfully");
<a id="L379" name="L379"></a> 379         <em class="brace">}</em>
<a id="L380" name="L380"></a> 380 
<a id="L381" name="L381"></a> 381         <strong class="reserved">if</strong> (succeeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L382" name="L382"></a> 382             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L383" name="L383"></a> 383         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (succeeded == <strong class="reserved">true</strong> &amp;&amp; commitSucceeded == <strong class="reserved">false</strong>) <em class="brace">{</em>
<a id="L384" name="L384"></a> 384 
<a id="L385" name="L385"></a> 385             <em class="comment">// Clean out state</em>
<a id="L386" name="L386"></a> 386             succeeded = <strong class="reserved">false</strong>;
<a id="L387" name="L387"></a> 387             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L388" name="L388"></a> 388             user = <strong class="reserved">null</strong>;
<a id="L389" name="L389"></a> 389         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L390" name="L390"></a> 390             <em class="comment">// overall authentication succeeded and commit succeeded,</em>
<a id="L391" name="L391"></a> 391             <em class="comment">// but someone else's commit failed</em>
<a id="L392" name="L392"></a> 392             <a href="../D/27060.html" title="Multiple defined in 11 places.">logout</a>();
<a id="L393" name="L393"></a> 393         <em class="brace">}</em>
<a id="L394" name="L394"></a> 394         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L395" name="L395"></a> 395     <em class="brace">}</em>
<a id="L396" name="L396"></a> 396 
<div class="comment">
      Logout a user.
      <p> This method removes the Principals
      that were added by the <code>commit</code> method.
      @exception LoginException if the logout fails.
      @return true in all cases since this <code>LoginModule</code>
               should not be ignored.</p></div>
<a id="L407" name="L407"></a> 407     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/22691.html" title="Multiple referred from 8 places.">logout</a>() <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L408" name="L408"></a> 408         <strong class="reserved">if</strong> (subject.<a href="../D/26131.html" title="Multiple defined in 90 places.">isReadOnly</a>()) <em class="brace">{</em>
<a id="L409" name="L409"></a> 409             <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L410" name="L410"></a> 410             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> ("Subject is read-only");
<a id="L411" name="L411"></a> 411         <em class="brace">}</em>
<a id="L412" name="L412"></a> 412         subject.<a href="../D/21663.html" title="Multiple defined in 4 places.">getPrincipals</a>().<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(user);
<a id="L413" name="L413"></a> 413 
<a id="L414" name="L414"></a> 414         <em class="comment">// clean out state</em>
<a id="L415" name="L415"></a> 415         <a href="../D/12805.html" title="Multiple defined in 4 places.">cleanState</a>();
<a id="L416" name="L416"></a> 416         succeeded = <strong class="reserved">false</strong>;
<a id="L417" name="L417"></a> 417         commitSucceeded = <strong class="reserved">false</strong>;
<a id="L418" name="L418"></a> 418         user = <strong class="reserved">null</strong>;
<a id="L419" name="L419"></a> 419 
<a id="L420" name="L420"></a> 420         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L421" name="L421"></a> 421             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("logout", "Subject is being logged out");
<a id="L422" name="L422"></a> 422         <em class="brace">}</em>
<a id="L423" name="L423"></a> 423 
<a id="L424" name="L424"></a> 424         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L425" name="L425"></a> 425     <em class="brace">}</em>
<a id="L426" name="L426"></a> 426 
<div class="comment">
      Attempt authentication
      @param usePasswdFromSharedState a flag to tell this method whether
               to retrieve the password from the sharedState.</div>
<a id="L433" name="L433"></a> 433     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")  <em class="comment">// sharedState used as Map&lt;String,Object&gt;</em>
<a id="L434" name="L434"></a> 434     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10399.html" title="Multiple referred from 12 places.">attemptAuthentication</a>(<strong class="reserved">boolean</strong> usePasswdFromSharedState)
<a id="L435" name="L435"></a> 435         <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L436" name="L436"></a> 436 
<a id="L437" name="L437"></a> 437         <em class="comment">// get the username and password</em>
<a id="L438" name="L438"></a> 438         <a href="../D/23505.html" title="Multiple defined in 3 places.">getUsernamePassword</a>(usePasswdFromSharedState);
<a id="L439" name="L439"></a> 439 
<a id="L440" name="L440"></a> 440         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> localPassword;
<a id="L441" name="L441"></a> 441 
<a id="L442" name="L442"></a> 442         <em class="comment">// userCredentials is initialized in login()</em>
<a id="L443" name="L443"></a> 443         <strong class="reserved">if</strong> (((localPassword = userCredentials.<a href="../D/21720.html" title="Multiple defined in 77 places.">getProperty</a>(username)) == <strong class="reserved">null</strong>) ||
<a id="L444" name="L444"></a> 444             (! localPassword.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>(password)))) <em class="brace">{</em>
<a id="L445" name="L445"></a> 445 
<a id="L446" name="L446"></a> 446             <em class="comment">// username not found or passwords do not match</em>
<a id="L447" name="L447"></a> 447             <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L448" name="L448"></a> 448                 <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login", "Invalid username or password");
<a id="L449" name="L449"></a> 449             <em class="brace">}</em>
<a id="L450" name="L450"></a> 450             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2668.html#L36" title="Defined at 36 in src/javax/security/auth/login/FailedLoginException.java.">FailedLoginException</a>("Invalid username or password");
<a id="L451" name="L451"></a> 451         <em class="brace">}</em>
<a id="L452" name="L452"></a> 452 
<a id="L453" name="L453"></a> 453         <em class="comment">// Save the username and password in the shared state</em>
<a id="L454" name="L454"></a> 454         <em class="comment">// only if authentication succeeded</em>
<a id="L455" name="L455"></a> 455         <strong class="reserved">if</strong> (storePass &amp;&amp;
<a id="L456" name="L456"></a> 456             !sharedState.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(USERNAME_KEY) &amp;&amp;
<a id="L457" name="L457"></a> 457             !sharedState.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(PASSWORD_KEY)) <em class="brace">{</em>
<a id="L458" name="L458"></a> 458             sharedState.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(USERNAME_KEY, username);
<a id="L459" name="L459"></a> 459             sharedState.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(PASSWORD_KEY, password);
<a id="L460" name="L460"></a> 460         <em class="brace">}</em>
<a id="L461" name="L461"></a> 461 
<a id="L462" name="L462"></a> 462         <em class="comment">// Create a new user principal</em>
<a id="L463" name="L463"></a> 463         user = <strong class="reserved">new</strong> <a href="../S/3622.html#L50" title="Defined at 50 in src/javax/management/remote/JMXPrincipal.java.">JMXPrincipal</a>(username);
<a id="L464" name="L464"></a> 464 
<a id="L465" name="L465"></a> 465         <strong class="reserved">if</strong> (<a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../S/6492.html#L65" title="Defined at 65 in src/com/sun/jmx/remote/util/ClassLogger.java.">debugOn</a>()) <em class="brace">{</em>
<a id="L466" name="L466"></a> 466             <a href="../S/835.html#L1128" title="Defined at 1128 in src/java/util/prefs/WindowsPreferences.java.">logger</a>.<a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>("login",
<a id="L467" name="L467"></a> 467                 "User '" + username + "' successfully validated");
<a id="L468" name="L468"></a> 468         <em class="brace">}</em>
<a id="L469" name="L469"></a> 469     <em class="brace">}</em>
<a id="L470" name="L470"></a> 470 
<div class="comment">
      Read the password file.</div>
<a id="L474" name="L474"></a> 474     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/6495.html#L224" title="Referred from 224 in src/com/sun/jmx/remote/security/FileLoginModule.java.">loadPasswordFile</a>() <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L475" name="L475"></a> 475         <a href="../S/1386.html#L49" title="Defined at 49 in src/java/io/FileInputStream.java.">FileInputStream</a> fis;
<a id="L476" name="L476"></a> 476         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L477" name="L477"></a> 477             fis = <strong class="reserved">new</strong> <a href="../S/1386.html#L49" title="Defined at 49 in src/java/io/FileInputStream.java.">FileInputStream</a>(passwordFile);
<a id="L478" name="L478"></a> 478         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1580.html#L34" title="Defined at 34 in src/java/lang/SecurityException.java.">SecurityException</a> e) <em class="brace">{</em>
<a id="L479" name="L479"></a> 479             <strong class="reserved">if</strong> (userSuppliedPasswordFile || hasJavaHomePermission) <em class="brace">{</em>
<a id="L480" name="L480"></a> 480                 <strong class="reserved">throw</strong> e;
<a id="L481" name="L481"></a> 481             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L482" name="L482"></a> 482                 <strong class="reserved">final</strong> <a href="../S/1426.html#L100" title="Defined at 100 in src/java/io/FilePermission.java.">FilePermission</a> fp =
<a id="L483" name="L483"></a> 483                         <strong class="reserved">new</strong> <a href="../S/1426.html#L100" title="Defined at 100 in src/java/io/FilePermission.java.">FilePermission</a>(passwordFileDisplayName, "read");
<a id="L484" name="L484"></a> 484                 <a href="../S/1326.html#L43" title="Defined at 43 in src/java/security/AccessControlException.java.">AccessControlException</a> ace = <strong class="reserved">new</strong> <a href="../S/1326.html#L43" title="Defined at 43 in src/java/security/AccessControlException.java.">AccessControlException</a>(
<a id="L485" name="L485"></a> 485                         "access denied " + fp.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L486" name="L486"></a> 486                 ace.<a href="../S/1726.html#L862" title="Defined at 862 in src/java/lang/Throwable.java.">setStackTrace</a>(e.<a href="../D/22687.html" title="Multiple defined in 3 places.">getStackTrace</a>());
<a id="L487" name="L487"></a> 487                 <strong class="reserved">throw</strong> ace;
<a id="L488" name="L488"></a> 488             <em class="brace">}</em>
<a id="L489" name="L489"></a> 489         <em class="brace">}</em>
<a id="L490" name="L490"></a> 490         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L491" name="L491"></a> 491             <strong class="reserved">final</strong> <a href="../S/1411.html#L51" title="Defined at 51 in src/java/io/BufferedInputStream.java.">BufferedInputStream</a> bis = <strong class="reserved">new</strong> <a href="../S/1411.html#L51" title="Defined at 51 in src/java/io/BufferedInputStream.java.">BufferedInputStream</a>(fis);
<a id="L492" name="L492"></a> 492             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L493" name="L493"></a> 493                 userCredentials = <strong class="reserved">new</strong> <a href="../S/1039.html#L122" title="Defined at 122 in src/java/util/Properties.java.">Properties</a>();
<a id="L494" name="L494"></a> 494                 userCredentials.<a href="../D/26888.html" title="Multiple defined in 27 places.">load</a>(bis);
<a id="L495" name="L495"></a> 495             <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L496" name="L496"></a> 496                 bis.<a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>();
<a id="L497" name="L497"></a> 497             <em class="brace">}</em>
<a id="L498" name="L498"></a> 498         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L499" name="L499"></a> 499             fis.<a href="../D/12922.html" title="Multiple defined in 218 places.">close</a>();
<a id="L500" name="L500"></a> 500         <em class="brace">}</em>
<a id="L501" name="L501"></a> 501     <em class="brace">}</em>
<a id="L502" name="L502"></a> 502 
<div class="comment">
      Get the username and password.
      This method does not return any value.
      Instead, it sets global name and password variables.
      <p> Also note that this method will set the username and password
      values in the shared state in case subsequent LoginModules
      want to use them via use/tryFirstPass.
      @param usePasswdFromSharedState boolean that tells this method whether
               to retrieve the password from the sharedState.</p></div>
<a id="L515" name="L515"></a> 515     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/19734.html" title="Multiple referred from 3 places.">getUsernamePassword</a>(<strong class="reserved">boolean</strong> usePasswdFromSharedState)
<a id="L516" name="L516"></a> 516         <strong class="reserved">throws</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> <em class="brace">{</em>
<a id="L517" name="L517"></a> 517 
<a id="L518" name="L518"></a> 518         <strong class="reserved">if</strong> (usePasswdFromSharedState) <em class="brace">{</em>
<a id="L519" name="L519"></a> 519             <em class="comment">// use the password saved by the first module in the stack</em>
<a id="L520" name="L520"></a> 520             username = (<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>)sharedState.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(USERNAME_KEY);
<a id="L521" name="L521"></a> 521             password = (<strong class="reserved">char</strong>[])sharedState.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(PASSWORD_KEY);
<a id="L522" name="L522"></a> 522             <strong class="reserved">return</strong>;
<a id="L523" name="L523"></a> 523         <em class="brace">}</em>
<a id="L524" name="L524"></a> 524 
<a id="L525" name="L525"></a> 525         <em class="comment">// acquire username and password</em>
<a id="L526" name="L526"></a> 526         <strong class="reserved">if</strong> (callbackHandler == <strong class="reserved">null</strong>)
<a id="L527" name="L527"></a> 527             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>("Error: no CallbackHandler available " +
<a id="L528" name="L528"></a> 528                 "to garner authentication information from the user");
<a id="L529" name="L529"></a> 529 
<a id="L530" name="L530"></a> 530         <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[] callbacks = <strong class="reserved">new</strong> <a href="../D/1261.html" title="Multiple defined in 2 places.">Callback</a>[2];
<a id="L531" name="L531"></a> 531         callbacks[0] = <strong class="reserved">new</strong> <a href="../S/2650.html#L35" title="Defined at 35 in src/javax/security/auth/callback/NameCallback.java.">NameCallback</a>("username");
<a id="L532" name="L532"></a> 532         callbacks[1] = <strong class="reserved">new</strong> <a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>("password", <strong class="reserved">false</strong>);
<a id="L533" name="L533"></a> 533 
<a id="L534" name="L534"></a> 534         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L535" name="L535"></a> 535             callbackHandler.<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>(callbacks);
<a id="L536" name="L536"></a> 536             username = ((<a href="../S/2650.html#L35" title="Defined at 35 in src/javax/security/auth/callback/NameCallback.java.">NameCallback</a>)callbacks[0]).<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L537" name="L537"></a> 537             <strong class="reserved">char</strong>[] tmpPassword = ((<a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>)callbacks[1]).<a href="../D/21429.html" title="Multiple defined in 6 places.">getPassword</a>();
<a id="L538" name="L538"></a> 538             password = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L539" name="L539"></a> 539             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(tmpPassword, 0,
<a id="L540" name="L540"></a> 540                                 password, 0, tmpPassword.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L541" name="L541"></a> 541             ((<a href="../S/2651.html#L35" title="Defined at 35 in src/javax/security/auth/callback/PasswordCallback.java.">PasswordCallback</a>)callbacks[1]).<a href="../S/2651.html#L136" title="Defined at 136 in src/javax/security/auth/callback/PasswordCallback.java.">clearPassword</a>();
<a id="L542" name="L542"></a> 542 
<a id="L543" name="L543"></a> 543         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> ioe) <em class="brace">{</em>
<a id="L544" name="L544"></a> 544             <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(ioe.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>());
<a id="L545" name="L545"></a> 545             <strong class="reserved">throw</strong> <a href="../S/6493.html#L55" title="Defined at 55 in src/com/sun/jmx/remote/util/EnvHelp.java.">EnvHelp</a>.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(le, ioe);
<a id="L546" name="L546"></a> 546         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2652.html#L33" title="Defined at 33 in src/javax/security/auth/callback/UnsupportedCallbackException.java.">UnsupportedCallbackException</a> uce) <em class="brace">{</em>
<a id="L547" name="L547"></a> 547             <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a> le = <strong class="reserved">new</strong> <a href="../S/2666.html#L34" title="Defined at 34 in src/javax/security/auth/login/LoginException.java.">LoginException</a>(
<a id="L548" name="L548"></a> 548                                     "Error: " + uce.<a href="../S/2652.html#L78" title="Defined at 78 in src/javax/security/auth/callback/UnsupportedCallbackException.java.">getCallback</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L549" name="L549"></a> 549                                     " not available to garner authentication " +
<a id="L550" name="L550"></a> 550                                     "information from the user");
<a id="L551" name="L551"></a> 551             <strong class="reserved">throw</strong> <a href="../S/6493.html#L55" title="Defined at 55 in src/com/sun/jmx/remote/util/EnvHelp.java.">EnvHelp</a>.<a href="../D/24507.html" title="Multiple defined in 7 places.">initCause</a>(le, uce);
<a id="L552" name="L552"></a> 552         <em class="brace">}</em>
<a id="L553" name="L553"></a> 553     <em class="brace">}</em>
<a id="L554" name="L554"></a> 554 
<div class="comment">
      Clean out state because of a failed authentication attempt</div>
<a id="L558" name="L558"></a> 558     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/11485.html" title="Multiple referred from 30 places.">cleanState</a>() <em class="brace">{</em>
<a id="L559" name="L559"></a> 559         username = <strong class="reserved">null</strong>;
<a id="L560" name="L560"></a> 560         <strong class="reserved">if</strong> (password != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L561" name="L561"></a> 561             <a href="../S/1150.html#L71" title="Defined at 71 in src/java/util/Arrays.java.">Arrays</a>.<a href="../D/16028.html" title="Multiple defined in 25 places.">fill</a>(password, ' ');
<a id="L562" name="L562"></a> 562             password = <strong class="reserved">null</strong>;
<a id="L563" name="L563"></a> 563         <em class="brace">}</em>
<a id="L564" name="L564"></a> 564 
<a id="L565" name="L565"></a> 565         <strong class="reserved">if</strong> (clearPass) <em class="brace">{</em>
<a id="L566" name="L566"></a> 566             sharedState.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(USERNAME_KEY);
<a id="L567" name="L567"></a> 567             sharedState.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(PASSWORD_KEY);
<a id="L568" name="L568"></a> 568         <em class="brace">}</em>
<a id="L569" name="L569"></a> 569     <em class="brace">}</em>
<a id="L570" name="L570"></a> 570 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L169">[^]</a><a href="#L558">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>