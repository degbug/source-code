<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/text/RBTableBuilder.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L78">[^]</a><a href="#L570">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L78" title="Defined at 78.">build</a></li>
<li><a href="#L178" title="Defined at 178.">addComposedChars</a></li>
<li><a href="#L262" title="Defined at 262.">commit</a></li>
<li><a href="#L291" title="Defined at 291.">increment</a></li>
<li><a href="#L323" title="Defined at 323.">addOrder</a></li>
<li><a href="#L346" title="Defined at 346.">addContractOrder</a></li>
<li><a href="#L353" title="Defined at 353.">addContractOrder</a></li>
<li><a href="#L419" title="Defined at 419.">getContractOrder</a></li>
<li><a href="#L441" title="Defined at 441.">getCharOrder</a></li>
<li><a href="#L457" title="Defined at 457.">getContractValues</a></li>
<li><a href="#L463" title="Defined at 463.">getContractValuesImpl</a></li>
<li><a href="#L478" title="Defined at 478.">addExpandOrder</a></li>
<li><a href="#L502" title="Defined at 502.">addExpandOrder</a></li>
<li><a href="#L514" title="Defined at 514.">addExpansion</a></li>
<li><a href="#L570" title="Defined at 570.">addContractFlags</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1999, 2012, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<div class="comment">
  (C) Copyright Taligent, Inc. 1996, 1997 - All Rights Reserved
  (C) Copyright IBM Corp. 1996-1998 - All Rights Reserved
    The original version of this source code and documentation is copyrighted
  and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These
  materials are provided under terms of a License Agreement between Taligent
  and Sun. This technology is protected by multiple US and International
  patents. This notice and attribution to Taligent may not be removed.
    Taligent is a registered trademark of Taligent, Inc.</div>
<a id="L38" name="L38"></a>  38 
<a id="L39" name="L39"></a>  39 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>;
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.util.Vector;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> sun.text.UCompactIntArray;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> sun.text.IntHashtable;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> sun.text.ComposedCharIter;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> sun.text.CollatorUtilities;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> sun.text.normalizer.NormalizerImpl;
<a id="L47" name="L47"></a>  47 
<div class="comment">
  This class contains all the code to parse a RuleBasedCollator pattern
  and build a RBCollationTables object from it.  A particular instance
  of tis class exists only during the actual build process-- once an
  RBCollationTables object has been built, the RBTableBuilder object
  goes away.  This object carries all of the state which is only needed
  during the build process, plus a "shadow" copy of all of the state
  that will go into the tables object itself.  This object communicates
  with RBCollationTables through a separate class, RBCollationTables.BuildAPI,
  this is an inner class of RBCollationTables and provides a separate
  private API for communication with RBTableBuilder.
  This class isn't just an inner class of RBCollationTables itself because
  of its large size.  For source-code readability, it seemed better for the
  builder to have its own source file.</div>
<a id="L63" name="L63"></a>  63 <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/2453.html#L82" title="Referred from 82 in src/java/text/RBCollationTables.java.">RBTableBuilder</a> <em class="brace">{</em>
<a id="L64" name="L64"></a>  64 
<a id="L65" name="L65"></a>  65     <strong class="reserved">public</strong> RBTableBuilder(<a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.<a href="../S/2453.html#L87" title="Defined at 87 in src/java/text/RBCollationTables.java.">BuildAPI</a> tables) <em class="brace">{</em>
<a id="L66" name="L66"></a>  66         <strong class="reserved">this</strong>.tables = tables;
<a id="L67" name="L67"></a>  67     <em class="brace">}</em>
<a id="L68" name="L68"></a>  68 
<div class="comment">
      Create a table-based collation object with the given rules.
      This is the main function that actually builds the tables and
      stores them back in the RBCollationTables object.  It is called
      ONLY by the RBCollationTables constructor.
      @see RuleBasedCollator#RuleBasedCollator
      @exception ParseException If the rules format is incorrect.</div>
<a id="L77" name="L77"></a>  77 
<a id="L78" name="L78"></a>  78     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/10684.html" title="Multiple referred from 11 places.">build</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>, <strong class="reserved">int</strong> decmp) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L79" name="L79"></a>  79     <em class="brace">{</em>
<a id="L80" name="L80"></a>  80         <strong class="reserved">boolean</strong> <a href="../S/4382.html#L154" title="Defined at 154 in src/javax/sound/sampled/Port.java.">isSource</a> = <strong class="reserved">true</strong>;
<a id="L81" name="L81"></a>  81         <strong class="reserved">int</strong> i = 0;
<a id="L82" name="L82"></a>  82         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> expChars;
<a id="L83" name="L83"></a>  83         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> groupChars;
<a id="L84" name="L84"></a>  84         <strong class="reserved">if</strong> (<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 0)
<a id="L85" name="L85"></a>  85             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>("Build rules empty.", 0);
<a id="L86" name="L86"></a>  86 
<a id="L87" name="L87"></a>  87         <em class="comment">// This array maps Unicode characters to their collation ordering</em>
<a id="L88" name="L88"></a>  88         <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a> = <strong class="reserved">new</strong> UCompactIntArray(<a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED);
<a id="L89" name="L89"></a>  89         <em class="comment">// Normalize the build rules.  Find occurances of all decomposed characters</em>
<a id="L90" name="L90"></a>  90         <em class="comment">// and normalize the rules before feeding into the builder.  By "normalize",</em>
<a id="L91" name="L91"></a>  91         <em class="comment">// we mean that all precomposed Unicode characters must be converted into</em>
<a id="L92" name="L92"></a>  92         <em class="comment">// a base character and one or more combining characters (such as accents).</em>
<a id="L93" name="L93"></a>  93         <em class="comment">// When there are multiple combining characters attached to a base character,</em>
<a id="L94" name="L94"></a>  94         <em class="comment">// the combining characters must be in their canonical order</em>
<a id="L95" name="L95"></a>  95         <em class="comment">//</em>
<a id="L96" name="L96"></a>  96         <em class="comment">// sherman/Note:</em>
<a id="L97" name="L97"></a>  97         <em class="comment">//(1)decmp will be NO_DECOMPOSITION only in ko locale to prevent decompose</em>
<a id="L98" name="L98"></a>  98         <em class="comment">//hangual syllables to jamos, so we can actually just call decompose with</em>
<a id="L99" name="L99"></a>  99         <em class="comment">//normalizer's IGNORE_HANGUL option turned on</em>
<a id="L100" name="L100"></a> 100         <em class="comment">//</em>
<a id="L101" name="L101"></a> 101         <em class="comment">//(2)just call the "special version" in NormalizerImpl directly</em>
<a id="L102" name="L102"></a> 102         <em class="comment">//pattern = Normalizer.decompose(pattern, false, Normalizer.IGNORE_HANGUL, true);</em>
<a id="L103" name="L103"></a> 103         <em class="comment">//</em>
<a id="L104" name="L104"></a> 104         <em class="comment">//Normalizer.Mode mode = CollatorUtilities.toNormalizerMode(decmp);</em>
<a id="L105" name="L105"></a> 105         <em class="comment">//pattern = Normalizer.normalize(pattern, mode, 0, true);</em>
<a id="L106" name="L106"></a> 106 
<a id="L107" name="L107"></a> 107         <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a> = NormalizerImpl.canonicalDecomposeWithSingleQuotation(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>);
<a id="L108" name="L108"></a> 108 
<a id="L109" name="L109"></a> 109         <em class="comment">// Build the merged collation entries</em>
<a id="L110" name="L110"></a> 110         <em class="comment">// Since rules can be specified in any order in the string</em>
<a id="L111" name="L111"></a> 111         <em class="comment">// (e.g. "c , C &lt; d , D &lt; e , E .... C &lt; CH")</em>
<a id="L112" name="L112"></a> 112         <em class="comment">// this splits all of the rules in the string out into separate</em>
<a id="L113" name="L113"></a> 113         <em class="comment">// objects and then sorts them.  In the above example, it merges the</em>
<a id="L114" name="L114"></a> 114         <em class="comment">// "C &lt; CH" rule in just before the "C &lt; D" rule.</em>
<a id="L115" name="L115"></a> 115         <em class="comment">//</em>
<a id="L116" name="L116"></a> 116 
<a id="L117" name="L117"></a> 117         mPattern = <strong class="reserved">new</strong> <a href="../S/2464.html#L63" title="Defined at 63 in src/java/text/MergeCollation.java.">MergeCollation</a>(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>);
<a id="L118" name="L118"></a> 118 
<a id="L119" name="L119"></a> 119         <strong class="reserved">int</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = 0;
<a id="L120" name="L120"></a> 120 
<a id="L121" name="L121"></a> 121         <em class="comment">// Now walk though each entry and add it to my own tables</em>
<a id="L122" name="L122"></a> 122         <strong class="reserved">for</strong> (i = 0; i &lt; mPattern.<a href="../D/18032.html" title="Multiple defined in 16 places.">getCount</a>(); ++i)
<a id="L123" name="L123"></a> 123         <em class="brace">{</em>
<a id="L124" name="L124"></a> 124             <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> entry = mPattern.<a href="../D/19852.html" title="Multiple defined in 2 places.">getItemAt</a>(i);
<a id="L125" name="L125"></a> 125             <strong class="reserved">if</strong> (entry != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L126" name="L126"></a> 126                 groupChars = entry.<a href="../D/17616.html" title="Multiple defined in 22 places.">getChars</a>();
<a id="L127" name="L127"></a> 127                 <strong class="reserved">if</strong> (groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 1) <em class="brace">{</em>
<a id="L128" name="L128"></a> 128                     <strong class="reserved">switch</strong>(groupChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>()-1)) <em class="brace">{</em>
<a id="L129" name="L129"></a> 129                     <strong class="reserved">case</strong> '@':
<a id="L130" name="L130"></a> 130                         frenchSec = <strong class="reserved">true</strong>;
<a id="L131" name="L131"></a> 131                         groupChars = groupChars.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0, groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>()-1);
<a id="L132" name="L132"></a> 132                         <strong class="reserved">break</strong>;
<a id="L133" name="L133"></a> 133                     <strong class="reserved">case</strong> '!':
<a id="L134" name="L134"></a> 134                         seAsianSwapping = <strong class="reserved">true</strong>;
<a id="L135" name="L135"></a> 135                         groupChars = groupChars.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0, groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>()-1);
<a id="L136" name="L136"></a> 136                         <strong class="reserved">break</strong>;
<a id="L137" name="L137"></a> 137                     <em class="brace">}</em>
<a id="L138" name="L138"></a> 138                 <em class="brace">}</em>
<a id="L139" name="L139"></a> 139 
<a id="L140" name="L140"></a> 140                 <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = <a href="../D/24445.html" title="Multiple defined in 3 places.">increment</a>(entry.<a href="../D/22764.html" title="Multiple defined in 3 places.">getStrength</a>(), <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L141" name="L141"></a> 141                 expChars = entry.<a href="../D/18953.html" title="Multiple defined in 3 places.">getExtension</a>();
<a id="L142" name="L142"></a> 142 
<a id="L143" name="L143"></a> 143                 <strong class="reserved">if</strong> (expChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() != 0) <em class="brace">{</em>
<a id="L144" name="L144"></a> 144                     <a href="../D/10796.html" title="Multiple defined in 2 places.">addExpandOrder</a>(groupChars, expChars, <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L145" name="L145"></a> 145                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 1) <em class="brace">{</em>
<a id="L146" name="L146"></a> 146                     <strong class="reserved">char</strong> ch = groupChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0);
<a id="L147" name="L147"></a> 147                     <strong class="reserved">if</strong> (<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25654.html" title="Multiple defined in 4 places.">isHighSurrogate</a>(ch) &amp;&amp; groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 2) <em class="brace">{</em>
<a id="L148" name="L148"></a> 148                         <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/35373.html" title="Multiple defined in 3 places.">toCodePoint</a>(ch, groupChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(1)), <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L149" name="L149"></a> 149                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L150" name="L150"></a> 150                         <a href="../D/10734.html" title="Multiple defined in 2 places.">addContractOrder</a>(groupChars, <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L151" name="L151"></a> 151                     <em class="brace">}</em>
<a id="L152" name="L152"></a> 152                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L153" name="L153"></a> 153                     <strong class="reserved">char</strong> ch = groupChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0);
<a id="L154" name="L154"></a> 154                     <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(ch, <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L155" name="L155"></a> 155                 <em class="brace">}</em>
<a id="L156" name="L156"></a> 156             <em class="brace">}</em>
<a id="L157" name="L157"></a> 157         <em class="brace">}</em>
<a id="L158" name="L158"></a> 158         <a href="../S/2456.html#L178" title="Defined at 178 in src/java/text/RBTableBuilder.java.">addComposedChars</a>();
<a id="L159" name="L159"></a> 159 
<a id="L160" name="L160"></a> 160         <a href="../D/13015.html" title="Multiple defined in 14 places.">commit</a>();
<a id="L161" name="L161"></a> 161         <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/13024.html" title="Multiple defined in 72 places.">compact</a>();
<div class="comment">
        System.out.println("mappingSize=" + mapping.getKSize());
        for (int j = 0; j &lt; 0xffff; j++) {
            int value = mapping.elementAt(j);
            if (value != RBCollationTables.UNMAPPED)
                System.out.println("index=" + Integer.toString(j, 16)
                           + ", value=" + Integer.toString(value, 16));
        }</div>
<a id="L171" name="L171"></a> 171         tables.<a href="../S/2453.html#L112" title="Defined at 112 in src/java/text/RBCollationTables.java.">fillInTables</a>(frenchSec, seAsianSwapping, <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>, contractTable, expandTable,
<a id="L172" name="L172"></a> 172                     contractFlags, maxSecOrder, maxTerOrder);
<a id="L173" name="L173"></a> 173     <em class="brace">}</em>
<a id="L174" name="L174"></a> 174 
<div class="comment">
 Add expanding entries for pre-composed unicode characters so that this
      collator can be used reasonably well with decomposition turned off.</div>
<a id="L178" name="L178"></a> 178     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2456.html#L158" title="Referred from 158 in src/java/text/RBTableBuilder.java.">addComposedChars</a>() <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a> <em class="brace">{</em>
<a id="L179" name="L179"></a> 179         <em class="comment">// Iterate through all of the pre-composed characters in Unicode</em>
<a id="L180" name="L180"></a> 180         ComposedCharIter <a href="../D/26587.html" title="Multiple defined in 2 places.">iter</a> = <strong class="reserved">new</strong> ComposedCharIter();
<a id="L181" name="L181"></a> 181         <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L182" name="L182"></a> 182         <strong class="reserved">while</strong> ((<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/26587.html" title="Multiple defined in 2 places.">iter</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>()) != ComposedCharIter.DONE) <em class="brace">{</em>
<a id="L183" name="L183"></a> 183             <strong class="reserved">if</strong> (<a href="../S/2456.html#L441" title="Defined at 441 in src/java/text/RBTableBuilder.java.">getCharOrder</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) == <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L184" name="L184"></a> 184                 <em class="comment">//</em>
<a id="L185" name="L185"></a> 185                 <em class="comment">// We don't already have an ordering for this pre-composed character.</em>
<a id="L186" name="L186"></a> 186                 <em class="comment">//</em>
<a id="L187" name="L187"></a> 187                 <em class="comment">// First, see if the decomposed string is already in our</em>
<a id="L188" name="L188"></a> 188                 <em class="comment">// tables as a single contracting-string ordering.</em>
<a id="L189" name="L189"></a> 189                 <em class="comment">// If so, just map the precomposed character to that order.</em>
<a id="L190" name="L190"></a> 190                 <em class="comment">//</em>
<a id="L191" name="L191"></a> 191                 <em class="comment">// TODO: What we should really be doing here is trying to find the</em>
<a id="L192" name="L192"></a> 192                 <em class="comment">// longest initial substring of the decomposition that is present</em>
<a id="L193" name="L193"></a> 193                 <em class="comment">// in the tables as a contracting character sequence, and find its</em>
<a id="L194" name="L194"></a> 194                 <em class="comment">// ordering.  Then do this recursively with the remaining chars</em>
<a id="L195" name="L195"></a> 195                 <em class="comment">// so that we build a list of orderings, and add that list to</em>
<a id="L196" name="L196"></a> 196                 <em class="comment">// the expansion table.</em>
<a id="L197" name="L197"></a> 197                 <em class="comment">// That would be more correct but also significantly slower, so</em>
<a id="L198" name="L198"></a> 198                 <em class="comment">// I'm not totally sure it's worth doing.</em>
<a id="L199" name="L199"></a> 199                 <em class="comment">//</em>
<a id="L200" name="L200"></a> 200                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> s = <a href="../D/26587.html" title="Multiple defined in 2 places.">iter</a>.decomposition();
<a id="L201" name="L201"></a> 201 
<a id="L202" name="L202"></a> 202                 <em class="comment">//sherman/Note: if this is 1 character decomposed string, the</em>
<a id="L203" name="L203"></a> 203                 <em class="comment">//only thing need to do is to check if this decomposed character</em>
<a id="L204" name="L204"></a> 204                 <em class="comment">//has an entry in our order table, this order is not necessary</em>
<a id="L205" name="L205"></a> 205                 <em class="comment">//to be a contraction order, if it does have one, add an entry</em>
<a id="L206" name="L206"></a> 206                 <em class="comment">//for the precomposed character by using the same order, the</em>
<a id="L207" name="L207"></a> 207                 <em class="comment">//previous impl unnecessarily adds a single character expansion</em>
<a id="L208" name="L208"></a> 208                 <em class="comment">//entry.</em>
<a id="L209" name="L209"></a> 209                 <strong class="reserved">if</strong> (s.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 1) <em class="brace">{</em>
<a id="L210" name="L210"></a> 210                     <strong class="reserved">int</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = <a href="../S/2456.html#L441" title="Defined at 441 in src/java/text/RBTableBuilder.java.">getCharOrder</a>(s.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0));
<a id="L211" name="L211"></a> 211                     <strong class="reserved">if</strong> (<a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> != <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L212" name="L212"></a> 212                         <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L213" name="L213"></a> 213                     <em class="brace">}</em>
<a id="L214" name="L214"></a> 214                     <strong class="reserved">continue</strong>;
<a id="L215" name="L215"></a> 215                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (s.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 2) <em class="brace">{</em>
<a id="L216" name="L216"></a> 216                     <strong class="reserved">char</strong> ch0 = s.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0);
<a id="L217" name="L217"></a> 217                     <strong class="reserved">if</strong> (<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25654.html" title="Multiple defined in 4 places.">isHighSurrogate</a>(ch0)) <em class="brace">{</em>
<a id="L218" name="L218"></a> 218                         <strong class="reserved">int</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = <a href="../S/2456.html#L441" title="Defined at 441 in src/java/text/RBTableBuilder.java.">getCharOrder</a>(s.<a href="../D/12960.html" title="Multiple defined in 6 places.">codePointAt</a>(0));
<a id="L219" name="L219"></a> 219                         <strong class="reserved">if</strong> (<a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> != <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L220" name="L220"></a> 220                             <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>);
<a id="L221" name="L221"></a> 221                         <em class="brace">}</em>
<a id="L222" name="L222"></a> 222                         <strong class="reserved">continue</strong>;
<a id="L223" name="L223"></a> 223                     <em class="brace">}</em>
<a id="L224" name="L224"></a> 224                 <em class="brace">}</em>
<a id="L225" name="L225"></a> 225                 <strong class="reserved">int</strong> contractOrder = <a href="../S/2456.html#L419" title="Defined at 419 in src/java/text/RBTableBuilder.java.">getContractOrder</a>(s);
<a id="L226" name="L226"></a> 226                 <strong class="reserved">if</strong> (contractOrder != <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L227" name="L227"></a> 227                     <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, contractOrder);
<a id="L228" name="L228"></a> 228                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L229" name="L229"></a> 229                     <em class="comment">//</em>
<a id="L230" name="L230"></a> 230                     <em class="comment">// We don't have a contracting ordering for the entire string</em>
<a id="L231" name="L231"></a> 231                     <em class="comment">// that results from the decomposition, but if we have orders</em>
<a id="L232" name="L232"></a> 232                     <em class="comment">// for each individual character, we can add an expanding</em>
<a id="L233" name="L233"></a> 233                     <em class="comment">// table entry for the pre-composed character</em>
<a id="L234" name="L234"></a> 234                     <em class="comment">//</em>
<a id="L235" name="L235"></a> 235                     <strong class="reserved">boolean</strong> allThere = <strong class="reserved">true</strong>;
<a id="L236" name="L236"></a> 236                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; s.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>(); i++) <em class="brace">{</em>
<a id="L237" name="L237"></a> 237                         <strong class="reserved">if</strong> (<a href="../S/2456.html#L441" title="Defined at 441 in src/java/text/RBTableBuilder.java.">getCharOrder</a>(s.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i)) == <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L238" name="L238"></a> 238                             allThere = <strong class="reserved">false</strong>;
<a id="L239" name="L239"></a> 239                             <strong class="reserved">break</strong>;
<a id="L240" name="L240"></a> 240                         <em class="brace">}</em>
<a id="L241" name="L241"></a> 241                     <em class="brace">}</em>
<a id="L242" name="L242"></a> 242                     <strong class="reserved">if</strong> (allThere) <em class="brace">{</em>
<a id="L243" name="L243"></a> 243                         <a href="../D/10796.html" title="Multiple defined in 2 places.">addExpandOrder</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, s, <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED);
<a id="L244" name="L244"></a> 244                     <em class="brace">}</em>
<a id="L245" name="L245"></a> 245                 <em class="brace">}</em>
<a id="L246" name="L246"></a> 246             <em class="brace">}</em>
<a id="L247" name="L247"></a> 247         <em class="brace">}</em>
<a id="L248" name="L248"></a> 248     <em class="brace">}</em>
<a id="L249" name="L249"></a> 249 
<div class="comment">
      Look up for unmapped values in the expanded character table.
      When the expanding character tables are built by addExpandOrder,
      it doesn't know what the final ordering of each character
      in the expansion will be.  Instead, it just puts the raw character
      code into the table, adding CHARINDEX as a flag.  Now that we've
      finished building the mapping table, we can go back and look up
      that character to see what its real collation order is and
      stick that into the expansion table.  That lets us avoid doing
      a two-stage lookup later.</div>
<a id="L262" name="L262"></a> 262     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/11674.html" title="Multiple referred from 3 places.">commit</a>()
<a id="L263" name="L263"></a> 263     <em class="brace">{</em>
<a id="L264" name="L264"></a> 264         <strong class="reserved">if</strong> (expandTable != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L265" name="L265"></a> 265             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; expandTable.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L266" name="L266"></a> 266                 <strong class="reserved">int</strong>[] valueList = expandTable.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(i);
<a id="L267" name="L267"></a> 267                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; valueList.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; j++) <em class="brace">{</em>
<a id="L268" name="L268"></a> 268                     <strong class="reserved">int</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = valueList[j];
<a id="L269" name="L269"></a> 269                     <strong class="reserved">if</strong> (<a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> &lt; <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.EXPANDCHARINDEX &amp;&amp; <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> &gt; CHARINDEX) <em class="brace">{</em>
<a id="L270" name="L270"></a> 270                         <em class="comment">// found a expanding character that isn't filled in yet</em>
<a id="L271" name="L271"></a> 271                         <strong class="reserved">int</strong> ch = <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> - CHARINDEX;
<a id="L272" name="L272"></a> 272 
<a id="L273" name="L273"></a> 273                         <em class="comment">// Get the real values for the non-filled entry</em>
<a id="L274" name="L274"></a> 274                         <strong class="reserved">int</strong> realValue = <a href="../S/2456.html#L441" title="Defined at 441 in src/java/text/RBTableBuilder.java.">getCharOrder</a>(ch);
<a id="L275" name="L275"></a> 275 
<a id="L276" name="L276"></a> 276                         <strong class="reserved">if</strong> (realValue == <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L277" name="L277"></a> 277                             <em class="comment">// The real value is still unmapped, maybe it's ignorable</em>
<a id="L278" name="L278"></a> 278                             valueList[j] = IGNORABLEMASK &amp; ch;
<a id="L279" name="L279"></a> 279                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L280" name="L280"></a> 280                             <em class="comment">// just fill in the value</em>
<a id="L281" name="L281"></a> 281                             valueList[j] = realValue;
<a id="L282" name="L282"></a> 282                         <em class="brace">}</em>
<a id="L283" name="L283"></a> 283                     <em class="brace">}</em>
<a id="L284" name="L284"></a> 284                 <em class="brace">}</em>
<a id="L285" name="L285"></a> 285             <em class="brace">}</em>
<a id="L286" name="L286"></a> 286         <em class="brace">}</em>
<a id="L287" name="L287"></a> 287     <em class="brace">}</em>
<div class="comment">
       Increment of the last order based on the comparison level.</div>
<a id="L291" name="L291"></a> 291     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/20491.html" title="Multiple referred from 60 places.">increment</a>(<strong class="reserved">int</strong> aStrength, <strong class="reserved">int</strong> lastValue)
<a id="L292" name="L292"></a> 292     <em class="brace">{</em>
<a id="L293" name="L293"></a> 293         <strong class="reserved">switch</strong>(aStrength)
<a id="L294" name="L294"></a> 294         <em class="brace">{</em>
<a id="L295" name="L295"></a> 295         <strong class="reserved">case</strong> <a href="../S/2466.html#L128" title="Defined at 128 in src/java/text/Collator.java.">Collator</a>.PRIMARY:
<a id="L296" name="L296"></a> 296             <em class="comment">// increment priamry order  and mask off secondary and tertiary difference</em>
<a id="L297" name="L297"></a> 297             lastValue += PRIMARYORDERINCREMENT;
<a id="L298" name="L298"></a> 298             lastValue &amp;= <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.PRIMARYORDERMASK;
<a id="L299" name="L299"></a> 299             isOverIgnore = <strong class="reserved">true</strong>;
<a id="L300" name="L300"></a> 300             <strong class="reserved">break</strong>;
<a id="L301" name="L301"></a> 301         <strong class="reserved">case</strong> <a href="../S/2466.html#L128" title="Defined at 128 in src/java/text/Collator.java.">Collator</a>.SECONDARY:
<a id="L302" name="L302"></a> 302             <em class="comment">// increment secondary order and mask off tertiary difference</em>
<a id="L303" name="L303"></a> 303             lastValue += SECONDARYORDERINCREMENT;
<a id="L304" name="L304"></a> 304             lastValue &amp;= <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.SECONDARYDIFFERENCEONLY;
<a id="L305" name="L305"></a> 305             <em class="comment">// record max # of ignorable chars with secondary difference</em>
<a id="L306" name="L306"></a> 306             <strong class="reserved">if</strong> (!isOverIgnore)
<a id="L307" name="L307"></a> 307                 maxSecOrder++;
<a id="L308" name="L308"></a> 308             <strong class="reserved">break</strong>;
<a id="L309" name="L309"></a> 309         <strong class="reserved">case</strong> <a href="../S/2466.html#L128" title="Defined at 128 in src/java/text/Collator.java.">Collator</a>.TERTIARY:
<a id="L310" name="L310"></a> 310             <em class="comment">// increment tertiary order</em>
<a id="L311" name="L311"></a> 311             lastValue += TERTIARYORDERINCREMENT;
<a id="L312" name="L312"></a> 312             <em class="comment">// record max # of ignorable chars with tertiary difference</em>
<a id="L313" name="L313"></a> 313             <strong class="reserved">if</strong> (!isOverIgnore)
<a id="L314" name="L314"></a> 314                 maxTerOrder++;
<a id="L315" name="L315"></a> 315             <strong class="reserved">break</strong>;
<a id="L316" name="L316"></a> 316         <em class="brace">}</em>
<a id="L317" name="L317"></a> 317         <strong class="reserved">return</strong> lastValue;
<a id="L318" name="L318"></a> 318     <em class="brace">}</em>
<a id="L319" name="L319"></a> 319 
<div class="comment">
       Adds a character and its designated order into the collation table.</div>
<a id="L323" name="L323"></a> 323     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9888.html" title="Multiple referred from 8 places.">addOrder</a>(<strong class="reserved">int</strong> ch, <strong class="reserved">int</strong> anOrder)
<a id="L324" name="L324"></a> 324     <em class="brace">{</em>
<a id="L325" name="L325"></a> 325         <em class="comment">// See if the char already has an order in the mapping table</em>
<a id="L326" name="L326"></a> 326         <strong class="reserved">int</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(ch);
<a id="L327" name="L327"></a> 327 
<a id="L328" name="L328"></a> 328         <strong class="reserved">if</strong> (<a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> &gt;= <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.CONTRACTCHARINDEX) <em class="brace">{</em>
<a id="L329" name="L329"></a> 329             <em class="comment">// There's already an entry for this character that points to a contracting</em>
<a id="L330" name="L330"></a> 330             <em class="comment">// character table.  Instead of adding the character directly to the mapping</em>
<a id="L331" name="L331"></a> 331             <em class="comment">// table, we must add it to the contract table instead.</em>
<a id="L332" name="L332"></a> 332             <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = 1;
<a id="L333" name="L333"></a> 333             <strong class="reserved">if</strong> (<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../S/1732.html#L4702" title="Defined at 4702 in src/java/lang/Character.java.">isSupplementaryCodePoint</a>(ch)) <em class="brace">{</em>
<a id="L334" name="L334"></a> 334                 <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/35370.html" title="Multiple defined in 3 places.">toChars</a>(ch, keyBuf, 0);
<a id="L335" name="L335"></a> 335             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L336" name="L336"></a> 336                 keyBuf[0] = (<strong class="reserved">char</strong>)ch;
<a id="L337" name="L337"></a> 337             <em class="brace">}</em>
<a id="L338" name="L338"></a> 338             <a href="../D/10734.html" title="Multiple defined in 2 places.">addContractOrder</a>(<strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>(keyBuf, 0, <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>), anOrder);
<a id="L339" name="L339"></a> 339         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L340" name="L340"></a> 340             <em class="comment">// add the entry to the mapping table,</em>
<a id="L341" name="L341"></a> 341             <em class="comment">// the same later entry replaces the previous one</em>
<a id="L342" name="L342"></a> 342             <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/32553.html" title="Multiple defined in 11 places.">setElementAt</a>(ch, anOrder);
<a id="L343" name="L343"></a> 343         <em class="brace">}</em>
<a id="L344" name="L344"></a> 344     <em class="brace">}</em>
<a id="L345" name="L345"></a> 345 
<a id="L346" name="L346"></a> 346     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9674.html" title="Multiple referred from 5 places.">addContractOrder</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> groupChars, <strong class="reserved">int</strong> anOrder) <em class="brace">{</em>
<a id="L347" name="L347"></a> 347         <a href="../D/10734.html" title="Multiple defined in 2 places.">addContractOrder</a>(groupChars, anOrder, <strong class="reserved">true</strong>);
<a id="L348" name="L348"></a> 348     <em class="brace">}</em>
<a id="L349" name="L349"></a> 349 
<div class="comment">
       Adds the contracting string into the collation table.</div>
<a id="L353" name="L353"></a> 353     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9674.html" title="Multiple referred from 5 places.">addContractOrder</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> groupChars, <strong class="reserved">int</strong> anOrder,
<a id="L354" name="L354"></a> 354                                           <strong class="reserved">boolean</strong> fwd)
<a id="L355" name="L355"></a> 355     <em class="brace">{</em>
<a id="L356" name="L356"></a> 356         <strong class="reserved">if</strong> (contractTable == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L357" name="L357"></a> 357             contractTable = <strong class="reserved">new</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;&gt;(INITIALTABLESIZE);
<a id="L358" name="L358"></a> 358         <em class="brace">}</em>
<a id="L359" name="L359"></a> 359 
<a id="L360" name="L360"></a> 360         <em class="comment">//initial character</em>
<a id="L361" name="L361"></a> 361         <strong class="reserved">int</strong> ch = groupChars.<a href="../D/12960.html" title="Multiple defined in 6 places.">codePointAt</a>(0);
<div class="comment">
        char ch0 = groupChars.charAt(0);
        int ch = Character.isHighSurrogate(ch0)?
          Character.toCodePoint(ch0, groupChars.charAt(1)):ch0;</div>
<a id="L367" name="L367"></a> 367         <em class="comment">// See if the initial character of the string already has a contract table.</em>
<a id="L368" name="L368"></a> 368         <strong class="reserved">int</strong> entry = <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(ch);
<a id="L369" name="L369"></a> 369         <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>&gt; entryTable = <a href="../D/17993.html" title="Multiple defined in 2 places.">getContractValuesImpl</a>(entry - <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.CONTRACTCHARINDEX);
<a id="L370" name="L370"></a> 370 
<a id="L371" name="L371"></a> 371         <strong class="reserved">if</strong> (entryTable == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L372" name="L372"></a> 372             <em class="comment">// We need to create a new table of contract entries for this base char</em>
<a id="L373" name="L373"></a> 373             <strong class="reserved">int</strong> tableIndex = <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.CONTRACTCHARINDEX + contractTable.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L374" name="L374"></a> 374             entryTable = <strong class="reserved">new</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;&gt;(INITIALTABLESIZE);
<a id="L375" name="L375"></a> 375             contractTable.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(entryTable);
<a id="L376" name="L376"></a> 376 
<a id="L377" name="L377"></a> 377             <em class="comment">// Add the initial character's current ordering first. then</em>
<a id="L378" name="L378"></a> 378             <em class="comment">// update its mapping to point to this contract table</em>
<a id="L379" name="L379"></a> 379             entryTable.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<strong class="reserved">new</strong> <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>(groupChars.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(0,<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../S/1732.html#L4817" title="Defined at 4817 in src/java/lang/Character.java.">charCount</a>(ch)), entry));
<a id="L380" name="L380"></a> 380             <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/32553.html" title="Multiple defined in 11 places.">setElementAt</a>(ch, tableIndex);
<a id="L381" name="L381"></a> 381         <em class="brace">}</em>
<a id="L382" name="L382"></a> 382 
<a id="L383" name="L383"></a> 383         <em class="comment">// Now add (or replace) this string in the table</em>
<a id="L384" name="L384"></a> 384         <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.<a href="../D/18807.html" title="Multiple defined in 12 places.">getEntry</a>(entryTable, groupChars, fwd);
<a id="L385" name="L385"></a> 385         <strong class="reserved">if</strong> (<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> != <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L386" name="L386"></a> 386             <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a> pair = entryTable.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L387" name="L387"></a> 387             pair.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = anOrder;
<a id="L388" name="L388"></a> 388         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L389" name="L389"></a> 389             <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a> pair = entryTable.<a href="../D/26745.html" title="Multiple defined in 2 places.">lastElement</a>();
<a id="L390" name="L390"></a> 390 
<a id="L391" name="L391"></a> 391             <em class="comment">// NOTE:  This little bit of logic is here to speed CollationElementIterator</em>
<a id="L392" name="L392"></a> 392             <em class="comment">// .nextContractChar().  This code ensures that the longest sequence in</em>
<a id="L393" name="L393"></a> 393             <em class="comment">// this list is always the _last_ one in the list.  This keeps</em>
<a id="L394" name="L394"></a> 394             <em class="comment">// nextContractChar() from having to search the entire list for the longest</em>
<a id="L395" name="L395"></a> 395             <em class="comment">// sequence.</em>
<a id="L396" name="L396"></a> 396             <strong class="reserved">if</strong> (groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; pair.<a href="../S/6196.html#L928" title="Defined at 928 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/XSLTC.java.">entryName</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>()) <em class="brace">{</em>
<a id="L397" name="L397"></a> 397                 entryTable.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(<strong class="reserved">new</strong> <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>(groupChars, anOrder, fwd));
<a id="L398" name="L398"></a> 398             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L399" name="L399"></a> 399                 entryTable.<a href="../D/24745.html" title="Multiple defined in 12 places.">insertElementAt</a>(<strong class="reserved">new</strong> <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>(groupChars, anOrder,
<a id="L400" name="L400"></a> 400                         fwd), entryTable.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() - 1);
<a id="L401" name="L401"></a> 401             <em class="brace">}</em>
<a id="L402" name="L402"></a> 402         <em class="brace">}</em>
<a id="L403" name="L403"></a> 403 
<a id="L404" name="L404"></a> 404         <em class="comment">// If this was a forward mapping for a contracting string, also add a</em>
<a id="L405" name="L405"></a> 405         <em class="comment">// reverse mapping for it, so that CollationElementIterator.previous</em>
<a id="L406" name="L406"></a> 406         <em class="comment">// can work right</em>
<a id="L407" name="L407"></a> 407         <strong class="reserved">if</strong> (fwd &amp;&amp; groupChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 1) <em class="brace">{</em>
<a id="L408" name="L408"></a> 408             <a href="../S/2456.html#L570" title="Defined at 570 in src/java/text/RBTableBuilder.java.">addContractFlags</a>(groupChars);
<a id="L409" name="L409"></a> 409             <a href="../D/10734.html" title="Multiple defined in 2 places.">addContractOrder</a>(<strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>(groupChars).<a href="../D/31410.html" title="Multiple defined in 8 places.">reverse</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>(),
<a id="L410" name="L410"></a> 410                              anOrder, <strong class="reserved">false</strong>);
<a id="L411" name="L411"></a> 411         <em class="brace">}</em>
<a id="L412" name="L412"></a> 412     <em class="brace">}</em>
<a id="L413" name="L413"></a> 413 
<div class="comment">
      If the given string has been specified as a contracting string
      in this collation table, return its ordering.
      Otherwise return UNMAPPED.</div>
<a id="L419" name="L419"></a> 419     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/2456.html#L225" title="Referred from 225 in src/java/text/RBTableBuilder.java.">getContractOrder</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> groupChars)
<a id="L420" name="L420"></a> 420     <em class="brace">{</em>
<a id="L421" name="L421"></a> 421         <strong class="reserved">int</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED;
<a id="L422" name="L422"></a> 422         <strong class="reserved">if</strong> (contractTable != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L423" name="L423"></a> 423             <strong class="reserved">int</strong> ch = groupChars.<a href="../D/12960.html" title="Multiple defined in 6 places.">codePointAt</a>(0);
<div class="comment">
            char ch0 = groupChars.charAt(0);
            int ch = Character.isHighSurrogate(ch0)?
              Character.toCodePoint(ch0, groupChars.charAt(1)):ch0;</div>
<a id="L429" name="L429"></a> 429             <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>&gt; entryTable = <a href="../D/17992.html" title="Multiple defined in 2 places.">getContractValues</a>(ch);
<a id="L430" name="L430"></a> 430             <strong class="reserved">if</strong> (entryTable != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L431" name="L431"></a> 431                 <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.<a href="../D/18807.html" title="Multiple defined in 12 places.">getEntry</a>(entryTable, groupChars, <strong class="reserved">true</strong>);
<a id="L432" name="L432"></a> 432                 <strong class="reserved">if</strong> (<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> != <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L433" name="L433"></a> 433                     <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a> pair = entryTable.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L434" name="L434"></a> 434                     <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = pair.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L435" name="L435"></a> 435                 <em class="brace">}</em>
<a id="L436" name="L436"></a> 436             <em class="brace">}</em>
<a id="L437" name="L437"></a> 437         <em class="brace">}</em>
<a id="L438" name="L438"></a> 438         <strong class="reserved">return</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>;
<a id="L439" name="L439"></a> 439     <em class="brace">}</em>
<a id="L440" name="L440"></a> 440 
<a id="L441" name="L441"></a> 441     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/15514.html" title="Multiple referred from 6 places.">getCharOrder</a>(<strong class="reserved">int</strong> ch) <em class="brace">{</em>
<a id="L442" name="L442"></a> 442         <strong class="reserved">int</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(ch);
<a id="L443" name="L443"></a> 443 
<a id="L444" name="L444"></a> 444         <strong class="reserved">if</strong> (<a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> &gt;= <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.CONTRACTCHARINDEX) <em class="brace">{</em>
<a id="L445" name="L445"></a> 445             <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>&gt; groupList = <a href="../D/17993.html" title="Multiple defined in 2 places.">getContractValuesImpl</a>(<a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> - <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.CONTRACTCHARINDEX);
<a id="L446" name="L446"></a> 446             <a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a> pair = groupList.<a href="../D/16403.html" title="Multiple defined in 2 places.">firstElement</a>();
<a id="L447" name="L447"></a> 447             <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a> = pair.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L448" name="L448"></a> 448         <em class="brace">}</em>
<a id="L449" name="L449"></a> 449         <strong class="reserved">return</strong> <a href="../D/28576.html" title="Multiple defined in 69 places.">order</a>;
<a id="L450" name="L450"></a> 450     <em class="brace">}</em>
<a id="L451" name="L451"></a> 451 
<div class="comment">
       Get the entry of hash table of the contracting string in the collation
       table.
       @param ch the starting character of the contracting string</div>
<a id="L457" name="L457"></a> 457     <strong class="reserved">private</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>&gt; <a href="../R/15810.html" title="Multiple referred from 3 places.">getContractValues</a>(<strong class="reserved">int</strong> ch)
<a id="L458" name="L458"></a> 458     <em class="brace">{</em>
<a id="L459" name="L459"></a> 459         <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a>.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(ch);
<a id="L460" name="L460"></a> 460         <strong class="reserved">return</strong> <a href="../D/17993.html" title="Multiple defined in 2 places.">getContractValuesImpl</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> - <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.CONTRACTCHARINDEX);
<a id="L461" name="L461"></a> 461     <em class="brace">}</em>
<a id="L462" name="L462"></a> 462 
<a id="L463" name="L463"></a> 463     <strong class="reserved">private</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>&gt; <a href="../R/15811.html" title="Multiple referred from 4 places.">getContractValuesImpl</a>(<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>)
<a id="L464" name="L464"></a> 464     <em class="brace">{</em>
<a id="L465" name="L465"></a> 465         <strong class="reserved">if</strong> (<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> &gt;= 0)
<a id="L466" name="L466"></a> 466         <em class="brace">{</em>
<a id="L467" name="L467"></a> 467             <strong class="reserved">return</strong> contractTable.<a href="../D/15289.html" title="Multiple defined in 23 places.">elementAt</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L468" name="L468"></a> 468         <em class="brace">}</em>
<a id="L469" name="L469"></a> 469         <strong class="reserved">else</strong> <em class="comment">// not found</em>
<a id="L470" name="L470"></a> 470         <em class="brace">{</em>
<a id="L471" name="L471"></a> 471             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L472" name="L472"></a> 472         <em class="brace">}</em>
<a id="L473" name="L473"></a> 473     <em class="brace">}</em>
<a id="L474" name="L474"></a> 474 
<div class="comment">
       Adds the expanding string into the collation table.</div>
<a id="L478" name="L478"></a> 478     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9726.html" title="Multiple referred from 2 places.">addExpandOrder</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> contractChars,
<a id="L479" name="L479"></a> 479                                 <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> expandChars,
<a id="L480" name="L480"></a> 480                                 <strong class="reserved">int</strong> anOrder) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L481" name="L481"></a> 481     <em class="brace">{</em>
<a id="L482" name="L482"></a> 482         <em class="comment">// Create an expansion table entry</em>
<a id="L483" name="L483"></a> 483         <strong class="reserved">int</strong> tableIndex = <a href="../S/2456.html#L514" title="Defined at 514 in src/java/text/RBTableBuilder.java.">addExpansion</a>(anOrder, expandChars);
<a id="L484" name="L484"></a> 484 
<a id="L485" name="L485"></a> 485         <em class="comment">// And add its index into the main mapping table</em>
<a id="L486" name="L486"></a> 486         <strong class="reserved">if</strong> (contractChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() &gt; 1) <em class="brace">{</em>
<a id="L487" name="L487"></a> 487             <strong class="reserved">char</strong> ch = contractChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0);
<a id="L488" name="L488"></a> 488             <strong class="reserved">if</strong> (<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25654.html" title="Multiple defined in 4 places.">isHighSurrogate</a>(ch) &amp;&amp; contractChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 2) <em class="brace">{</em>
<a id="L489" name="L489"></a> 489                 <strong class="reserved">char</strong> ch2 = contractChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(1);
<a id="L490" name="L490"></a> 490                 <strong class="reserved">if</strong> (<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25841.html" title="Multiple defined in 4 places.">isLowSurrogate</a>(ch2)) <em class="brace">{</em>
<a id="L491" name="L491"></a> 491                     <em class="comment">//only add into table when it is a legal surrogate</em>
<a id="L492" name="L492"></a> 492                     <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/35373.html" title="Multiple defined in 3 places.">toCodePoint</a>(ch, ch2), tableIndex);
<a id="L493" name="L493"></a> 493                 <em class="brace">}</em>
<a id="L494" name="L494"></a> 494             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L495" name="L495"></a> 495                 <a href="../D/10734.html" title="Multiple defined in 2 places.">addContractOrder</a>(contractChars, tableIndex);
<a id="L496" name="L496"></a> 496             <em class="brace">}</em>
<a id="L497" name="L497"></a> 497         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L498" name="L498"></a> 498             <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(contractChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0), tableIndex);
<a id="L499" name="L499"></a> 499         <em class="brace">}</em>
<a id="L500" name="L500"></a> 500     <em class="brace">}</em>
<a id="L501" name="L501"></a> 501 
<a id="L502" name="L502"></a> 502     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9726.html" title="Multiple referred from 2 places.">addExpandOrder</a>(<strong class="reserved">int</strong> ch, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> expandChars, <strong class="reserved">int</strong> anOrder)
<a id="L503" name="L503"></a> 503       <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L504" name="L504"></a> 504     <em class="brace">{</em>
<a id="L505" name="L505"></a> 505         <strong class="reserved">int</strong> tableIndex = <a href="../S/2456.html#L514" title="Defined at 514 in src/java/text/RBTableBuilder.java.">addExpansion</a>(anOrder, expandChars);
<a id="L506" name="L506"></a> 506         <a href="../S/2456.html#L323" title="Defined at 323 in src/java/text/RBTableBuilder.java.">addOrder</a>(ch, tableIndex);
<a id="L507" name="L507"></a> 507     <em class="brace">}</em>
<a id="L508" name="L508"></a> 508 
<div class="comment">
      Create a new entry in the expansion table that contains the orderings
      for the given characers.  If anOrder is valid, it is added to the
      beginning of the expanded list of orders.</div>
<a id="L514" name="L514"></a> 514     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/9727.html" title="Multiple referred from 2 places.">addExpansion</a>(<strong class="reserved">int</strong> anOrder, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> expandChars) <em class="brace">{</em>
<a id="L515" name="L515"></a> 515         <strong class="reserved">if</strong> (expandTable == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L516" name="L516"></a> 516             expandTable = <strong class="reserved">new</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;&gt;(INITIALTABLESIZE);
<a id="L517" name="L517"></a> 517         <em class="brace">}</em>
<a id="L518" name="L518"></a> 518 
<a id="L519" name="L519"></a> 519         <em class="comment">// If anOrder is valid, we want to add it at the beginning of the list</em>
<a id="L520" name="L520"></a> 520         <strong class="reserved">int</strong> <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a> = (anOrder == <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) ? 0 : 1;
<a id="L521" name="L521"></a> 521 
<a id="L522" name="L522"></a> 522         <strong class="reserved">int</strong>[] valueList = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[expandChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() + <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>];
<a id="L523" name="L523"></a> 523         <strong class="reserved">if</strong> (<a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a> == 1) <em class="brace">{</em>
<a id="L524" name="L524"></a> 524             valueList[0] = anOrder;
<a id="L525" name="L525"></a> 525         <em class="brace">}</em>
<a id="L526" name="L526"></a> 526 
<a id="L527" name="L527"></a> 527         <strong class="reserved">int</strong> j = <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>;
<a id="L528" name="L528"></a> 528         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; expandChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>(); i++) <em class="brace">{</em>
<a id="L529" name="L529"></a> 529             <strong class="reserved">char</strong> ch0 = expandChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i);
<a id="L530" name="L530"></a> 530             <strong class="reserved">char</strong> ch1;
<a id="L531" name="L531"></a> 531             <strong class="reserved">int</strong> ch;
<a id="L532" name="L532"></a> 532             <strong class="reserved">if</strong> (<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25654.html" title="Multiple defined in 4 places.">isHighSurrogate</a>(ch0)) <em class="brace">{</em>
<a id="L533" name="L533"></a> 533                 <strong class="reserved">if</strong> (++i == expandChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() ||
<a id="L534" name="L534"></a> 534                     !<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25841.html" title="Multiple defined in 4 places.">isLowSurrogate</a>(ch1=expandChars.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i))) <em class="brace">{</em>
<a id="L535" name="L535"></a> 535                     <em class="comment">//ether we are missing the low surrogate or the next char</em>
<a id="L536" name="L536"></a> 536                     <em class="comment">//is not a legal low surrogate, so stop loop</em>
<a id="L537" name="L537"></a> 537                     <strong class="reserved">break</strong>;
<a id="L538" name="L538"></a> 538                 <em class="brace">}</em>
<a id="L539" name="L539"></a> 539                 ch = <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/35373.html" title="Multiple defined in 3 places.">toCodePoint</a>(ch0, ch1);
<a id="L540" name="L540"></a> 540 
<a id="L541" name="L541"></a> 541             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L542" name="L542"></a> 542                 ch = ch0;
<a id="L543" name="L543"></a> 543             <em class="brace">}</em>
<a id="L544" name="L544"></a> 544 
<a id="L545" name="L545"></a> 545             <strong class="reserved">int</strong> mapValue = <a href="../S/2456.html#L441" title="Defined at 441 in src/java/text/RBTableBuilder.java.">getCharOrder</a>(ch);
<a id="L546" name="L546"></a> 546 
<a id="L547" name="L547"></a> 547             <strong class="reserved">if</strong> (mapValue != <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.UNMAPPED) <em class="brace">{</em>
<a id="L548" name="L548"></a> 548                 valueList[j++] = mapValue;
<a id="L549" name="L549"></a> 549             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L550" name="L550"></a> 550                 <em class="comment">// can't find it in the table, will be filled in by commit().</em>
<a id="L551" name="L551"></a> 551                 valueList[j++] = CHARINDEX + ch;
<a id="L552" name="L552"></a> 552             <em class="brace">}</em>
<a id="L553" name="L553"></a> 553         <em class="brace">}</em>
<a id="L554" name="L554"></a> 554         <strong class="reserved">if</strong> (j &lt; valueList.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L555" name="L555"></a> 555             <em class="comment">//we had at least one supplementary character, the size of valueList</em>
<a id="L556" name="L556"></a> 556             <em class="comment">//is bigger than it really needs...</em>
<a id="L557" name="L557"></a> 557             <strong class="reserved">int</strong>[] tmpBuf = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[j];
<a id="L558" name="L558"></a> 558             <strong class="reserved">while</strong> (--j &gt;= 0) <em class="brace">{</em>
<a id="L559" name="L559"></a> 559                 tmpBuf[j] = valueList[j];
<a id="L560" name="L560"></a> 560             <em class="brace">}</em>
<a id="L561" name="L561"></a> 561             valueList = tmpBuf;
<a id="L562" name="L562"></a> 562         <em class="brace">}</em>
<a id="L563" name="L563"></a> 563         <em class="comment">// Add the expanding char list into the expansion table.</em>
<a id="L564" name="L564"></a> 564         <strong class="reserved">int</strong> tableIndex = <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.EXPANDCHARINDEX + expandTable.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L565" name="L565"></a> 565         expandTable.<a href="../D/10774.html" title="Multiple defined in 24 places.">addElement</a>(valueList);
<a id="L566" name="L566"></a> 566 
<a id="L567" name="L567"></a> 567         <strong class="reserved">return</strong> tableIndex;
<a id="L568" name="L568"></a> 568     <em class="brace">}</em>
<a id="L569" name="L569"></a> 569 
<a id="L570" name="L570"></a> 570     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2456.html#L408" title="Referred from 408 in src/java/text/RBTableBuilder.java.">addContractFlags</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>) <em class="brace">{</em>
<a id="L571" name="L571"></a> 571         <strong class="reserved">char</strong> c0;
<a id="L572" name="L572"></a> 572         <strong class="reserved">int</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L573" name="L573"></a> 573         <strong class="reserved">int</strong> len = <a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>();
<a id="L574" name="L574"></a> 574         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; len; i++) <em class="brace">{</em>
<a id="L575" name="L575"></a> 575             c0 = <a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(i);
<a id="L576" name="L576"></a> 576             <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/25654.html" title="Multiple defined in 4 places.">isHighSurrogate</a>(c0)
<a id="L577" name="L577"></a> 577                           ?<a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/35373.html" title="Multiple defined in 3 places.">toCodePoint</a>(c0, <a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(++i))
<a id="L578" name="L578"></a> 578                           :c0;
<a id="L579" name="L579"></a> 579             contractFlags.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, 1);
<a id="L580" name="L580"></a> 580         <em class="brace">}</em>
<a id="L581" name="L581"></a> 581     <em class="brace">}</em>
<a id="L582" name="L582"></a> 582 
<a id="L583" name="L583"></a> 583     <em class="comment">// ==============================================================</em>
<a id="L584" name="L584"></a> 584     <em class="comment">// constants</em>
<a id="L585" name="L585"></a> 585     <em class="comment">// ==============================================================</em>
<a id="L586" name="L586"></a> 586     <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> CHARINDEX = 0x70000000;  <em class="comment">// need look up in .commit()</em>
<a id="L587" name="L587"></a> 587 
<a id="L588" name="L588"></a> 588     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> IGNORABLEMASK = 0x0000ffff;
<a id="L589" name="L589"></a> 589     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> PRIMARYORDERINCREMENT = 0x00010000;
<a id="L590" name="L590"></a> 590     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> SECONDARYORDERINCREMENT = 0x00000100;
<a id="L591" name="L591"></a> 591     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> TERTIARYORDERINCREMENT = 0x00000001;
<a id="L592" name="L592"></a> 592     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> INITIALTABLESIZE = 20;
<a id="L593" name="L593"></a> 593     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> MAXKEYSIZE = 5;
<a id="L594" name="L594"></a> 594 
<a id="L595" name="L595"></a> 595     <em class="comment">// ==============================================================</em>
<a id="L596" name="L596"></a> 596     <em class="comment">// instance variables</em>
<a id="L597" name="L597"></a> 597     <em class="comment">// ==============================================================</em>
<a id="L598" name="L598"></a> 598 
<a id="L599" name="L599"></a> 599     <em class="comment">// variables used by the build process</em>
<a id="L600" name="L600"></a> 600     <strong class="reserved">private</strong> <a href="../S/2453.html#L51" title="Defined at 51 in src/java/text/RBCollationTables.java.">RBCollationTables</a>.<a href="../S/2453.html#L87" title="Defined at 87 in src/java/text/RBCollationTables.java.">BuildAPI</a> tables = <strong class="reserved">null</strong>;
<a id="L601" name="L601"></a> 601     <strong class="reserved">private</strong> <a href="../S/2464.html#L63" title="Defined at 63 in src/java/text/MergeCollation.java.">MergeCollation</a> mPattern = <strong class="reserved">null</strong>;
<a id="L602" name="L602"></a> 602     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> isOverIgnore = <strong class="reserved">false</strong>;
<a id="L603" name="L603"></a> 603     <strong class="reserved">private</strong> <strong class="reserved">char</strong>[] keyBuf = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[MAXKEYSIZE];
<a id="L604" name="L604"></a> 604     <strong class="reserved">private</strong> IntHashtable contractFlags = <strong class="reserved">new</strong> IntHashtable(100);
<a id="L605" name="L605"></a> 605 
<a id="L606" name="L606"></a> 606     <em class="comment">// "shadow" copies of the instance variables in RBCollationTables</em>
<a id="L607" name="L607"></a> 607     <em class="comment">// (the values in these variables are copied back into RBCollationTables</em>
<a id="L608" name="L608"></a> 608     <em class="comment">// at the end of the build process)</em>
<a id="L609" name="L609"></a> 609     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> frenchSec = <strong class="reserved">false</strong>;
<a id="L610" name="L610"></a> 610     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> seAsianSwapping = <strong class="reserved">false</strong>;
<a id="L611" name="L611"></a> 611 
<a id="L612" name="L612"></a> 612     <strong class="reserved">private</strong> UCompactIntArray <a href="../S/910.html#L351" title="Defined at 351 in src/java/util/stream/Collectors.java.">mapping</a> = <strong class="reserved">null</strong>;
<a id="L613" name="L613"></a> 613     <strong class="reserved">private</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<a href="../S/2487.html#L46" title="Defined at 46 in src/java/text/EntryPair.java.">EntryPair</a>&gt;&gt;   contractTable = <strong class="reserved">null</strong>;
<a id="L614" name="L614"></a> 614     <strong class="reserved">private</strong> <a href="../S/846.html#L83" title="Defined at 83 in src/java/util/Vector.java.">Vector</a>&lt;<strong class="reserved">int</strong>[]&gt;   expandTable = <strong class="reserved">null</strong>;
<a id="L615" name="L615"></a> 615 
<a id="L616" name="L616"></a> 616     <strong class="reserved">private</strong> <strong class="reserved">short</strong> maxSecOrder = 0;
<a id="L617" name="L617"></a> 617     <strong class="reserved">private</strong> <strong class="reserved">short</strong> maxTerOrder = 0;
<a id="L618" name="L618"></a> 618 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L78">[^]</a><a href="#L570">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>