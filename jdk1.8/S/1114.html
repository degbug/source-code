<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/LinkedTransferQueue.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L458">[^]</a><a href="#L1448">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L458" title="Defined at 458.">casNext</a></li>
<li><a href="#L462" title="Defined at 462.">casItem</a></li>
<li><a href="#L480" title="Defined at 480.">forgetNext</a></li>
<li><a href="#L493" title="Defined at 493.">forgetContents</a></li>
<li><a href="#L502" title="Defined at 502.">isMatched</a></li>
<li><a href="#L510" title="Defined at 510.">isUnmatchedRequest</a></li>
<li><a href="#L519" title="Defined at 519.">cannotPrecede</a></li>
<li><a href="#L528" title="Defined at 528.">tryMatchData</a></li>
<li><a href="#L571" title="Defined at 571.">casTail</a></li>
<li><a href="#L575" title="Defined at 575.">casHead</a></li>
<li><a href="#L579" title="Defined at 579.">casSweepVotes</a></li>
<li><a href="#L591" title="Defined at 591.">SuppressWarnings</a></li>
<li><a href="#L592" title="Defined at 592.">cast</a></li>
<li><a href="#L607" title="Defined at 607.">xfer</a></li>
<li><a href="#L662" title="Defined at 662.">tryAppend</a></li>
<li><a href="#L700" title="Defined at 700.">awaitMatch</a></li>
<li><a href="#L746" title="Defined at 746.">spinsFor</a></li>
<li><a href="#L765" title="Defined at 765.">succ</a></li>
<li><a href="#L774" title="Defined at 774.">firstOfMode</a></li>
<li><a href="#L787" title="Defined at 787.">firstDataNode</a></li>
<li><a href="#L806" title="Defined at 806.">firstDataItem</a></li>
<li><a href="#L823" title="Defined at 823.">countOfMode</a></li>
<li><a href="#L852" title="Defined at 852.">advance</a></li>
<li><a href="#L914" title="Defined at 914.">hasNext</a></li>
<li><a href="#L918" title="Defined at 918.">next</a></li>
<li><a href="#L926" title="Defined at 926.">remove</a></li>
<li><a href="#L947" title="Defined at 947.">trySplit</a></li>
<li><a href="#L976" title="Defined at 976.">SuppressWarnings</a></li>
<li><a href="#L977" title="Defined at 977.">forEachRemaining</a></li>
<li><a href="#L994" title="Defined at 994.">SuppressWarnings</a></li>
<li><a href="#L995" title="Defined at 995.">tryAdvance</a></li>
<li><a href="#L1018" title="Defined at 1018.">estimateSize</a></li>
<li><a href="#L1020" title="Defined at 1020.">characteristics</a></li>
<li><a href="#L1042" title="Defined at 1042.">spliterator</a></li>
<li><a href="#L1056" title="Defined at 1056.">unsplice</a></li>
<li><a href="#L1102" title="Defined at 1102.">sweep</a></li>
<li><a href="#L1120" title="Defined at 1120.">findAndRemove</a></li>
<li><a href="#L1169" title="Defined at 1169.">put</a></li>
<li><a href="#L1183" title="Defined at 1183.">offer</a></li>
<li><a href="#L1195" title="Defined at 1195.">offer</a></li>
<li><a href="#L1208" title="Defined at 1208.">add</a></li>
<li><a href="#L1223" title="Defined at 1223.">tryTransfer</a></li>
<li><a href="#L1238" title="Defined at 1238.">transfer</a></li>
<li><a href="#L1259" title="Defined at 1259.">tryTransfer</a></li>
<li><a href="#L1268" title="Defined at 1268.">take</a></li>
<li><a href="#L1276" title="Defined at 1276.">poll</a></li>
<li><a href="#L1283" title="Defined at 1283.">poll</a></li>
<li><a href="#L1291" title="Defined at 1291.">drainTo</a></li>
<li><a href="#L1308" title="Defined at 1308.">drainTo</a></li>
<li><a href="#L1330" title="Defined at 1330.">iterator</a></li>
<li><a href="#L1334" title="Defined at 1334.">peek</a></li>
<li><a href="#L1343" title="Defined at 1343.">isEmpty</a></li>
<li><a href="#L1351" title="Defined at 1351.">hasWaitingConsumer</a></li>
<li><a href="#L1367" title="Defined at 1367.">size</a></li>
<li><a href="#L1371" title="Defined at 1371.">getWaitingConsumerCount</a></li>
<li><a href="#L1386" title="Defined at 1386.">remove</a></li>
<li><a href="#L1398" title="Defined at 1398.">contains</a></li>
<li><a href="#L1420" title="Defined at 1420.">remainingCapacity</a></li>
<li><a href="#L1432" title="Defined at 1432.">writeObject</a></li>
<li><a href="#L1448" title="Defined at 1448.">readObject</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent;
<a id="L37" name="L37"></a>  37 
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.AbstractQueue;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.Collection;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.util.Iterator;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.util.NoSuchElementException;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> java.util.Queue;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> java.util.concurrent.TimeUnit;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> java.util.concurrent.locks.LockSupport;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> java.util.Spliterator;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> java.util.Spliterators;
<a id="L47" name="L47"></a>  47 <strong class="reserved">import</strong> java.util.function.Consumer;
<a id="L48" name="L48"></a>  48 
<div class="comment">
  An unbounded <a href="../D/9058.html" title="Multiple defined in 2 places.">TransferQueue</a> based on linked nodes.
  This queue orders elements FIFO (first-in-first-out) with respect
  to any given producer.  The <em>head</em> of the queue is that
  element that has been on the queue the longest time for some
  producer.  The <em>tail</em> of the queue is that element that has
  been on the queue the shortest time for some producer.
  <p>Beware that, unlike in most collections, the <code>size</code> method
  is <em>NOT</em> a constant-time operation. Because of the
  asynchronous nature of these queues, determining the current number
  of elements requires a traversal of the elements, and so may report
  inaccurate results if this collection is modified during traversal.
  Additionally, the bulk operations <code>addAll</code>,
  <code>removeAll</code>, <code>retainAll</code>, <code>containsAll</code>,
  <code>equals</code>, and <code>toArray</code> are <em>not</em> guaranteed
  to be performed atomically. For example, an iterator operating
  concurrently with an <code>addAll</code> operation might view only some
  of the added elements.
  </p><p>This class and its iterator implement all of the
  <em>optional</em> methods of the <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a> and {@link
  Iterator} interfaces.
  </p><p>Memory consistency effects: As with other concurrent
  collections, actions in a thread prior to placing an object into a
  <code>LinkedTransferQueue</code>
  <a href="package-summary.html#MemoryVisibility"><i>happen-before</i></a>
  actions subsequent to the access or removal of that element from
  the <code>LinkedTransferQueue</code> in another thread.
  </p><p>This class is a member of the
  <a href="{@docRoot}/../technotes/guides/collections/index.html">
  Java Collections Framework</a>.
  @since 1.7
  @author Doug Lea
  @param <e> the type of elements held in this collection</e></p></div>
<a id="L88" name="L88"></a>  88 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/4623.html" title="Multiple referred from 10 places.">LinkedTransferQueue</a>&lt;E&gt; <strong class="reserved">extends</strong> <a href="../S/994.html#L64" title="Defined at 64 in src/java/util/AbstractQueue.java.">AbstractQueue</a>&lt;E&gt;
<a id="L89" name="L89"></a>  89     <strong class="reserved">implements</strong> <a href="../D/9058.html" title="Multiple defined in 2 places.">TransferQueue</a>&lt;E&gt;, <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L90" name="L90"></a>  90     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -3223113410248163686L;
<a id="L91" name="L91"></a>  91 
<div class="comment">
      *** Overview of Dual Queues with Slack ***
      Dual Queues, introduced by Scherer and Scott
      (http://www.cs.rice.edu/~wns1/papers/2004-DISC-DDS.pdf) are
      (linked) queues in which nodes may represent either data or
      requests.  When a thread tries to enqueue a data node, but
      encounters a request node, it instead "matches" and removes it;
      and vice versa for enqueuing requests. Blocking Dual Queues
      arrange that threads enqueuing unmatched requests block until
      other threads provide the match. Dual Synchronous Queues (see
      Scherer, Lea, &amp; Scott
      http://www.cs.rochester.edu/u/scott/papers/2009_Scherer_CACM_SSQ.pdf)
      additionally arrange that threads enqueuing unmatched data also
      block.  Dual Transfer Queues support all of these modes, as
      dictated by callers.
      A FIFO dual queue may be implemented using a variation of the
      Michael &amp; Scott (M&amp;S) lock-free queue algorithm
      (http://www.cs.rochester.edu/u/scott/papers/1996_PODC_queues.pdf).
      It maintains two pointer fields, "head", pointing to a
      (matched) node that in turn points to the first actual
      (unmatched) queue node (or null if empty); and "tail" that
      points to the last node on the queue (or again null if
      empty). For example, here is a possible queue with four data
      elements:
       head                tail
         |                   |
         v                   v
         M -&gt; U -&gt; U -&gt; U -&gt; U
      The M&amp;S queue algorithm is known to be prone to scalability and
      overhead limitations when maintaining (via CAS) these head and
      tail pointers. This has led to the development of
      contention-reducing variants such as elimination arrays (see
      Moir et al http://portal.acm.org/citation.cfm?id=1074013) and
      optimistic back pointers (see Ladan-Mozes &amp; Shavit
      http://people.csail.mit.edu/edya/publications/OptimisticFIFOQueue-journal.pdf).
      However, the nature of dual queues enables a simpler tactic for
      improving M&amp;S-style implementations when dual-ness is needed.
      In a dual queue, each node must atomically maintain its match
      status. While there are other possible variants, we implement
      this here as: for a data-mode node, matching entails CASing an
      "item" field from a non-null data value to null upon match, and
      vice-versa for request nodes, CASing from null to a data
      value. (Note that the linearization properties of this style of
      queue are easy to verify -- elements are made available by
      linking, and unavailable by matching.) Compared to plain M&amp;S
      queues, this property of dual queues requires one additional
      successful atomic operation per enq/deq pair. But it also
      enables lower cost variants of queue maintenance mechanics. (A
      variation of this idea applies even for non-dual queues that
      support deletion of interior elements, such as
      j.u.c.ConcurrentLinkedQueue.)
      Once a node is matched, its match status can never again
      change.  We may thus arrange that the linked list of them
      contain a prefix of zero or more matched nodes, followed by a
      suffix of zero or more unmatched nodes. (Note that we allow
      both the prefix and suffix to be zero length, which in turn
      means that we do not use a dummy header.)  If we were not
      concerned with either time or space efficiency, we could
      correctly perform enqueue and dequeue operations by traversing
      from a pointer to the initial node; CASing the item of the
      first unmatched node on match and CASing the next field of the
      trailing node on appends. (Plus some special-casing when
      initially empty).  While this would be a terrible idea in
      itself, it does have the benefit of not requiring ANY atomic
      updates on head/tail fields.
      We introduce here an approach that lies between the extremes of
      never versus always updating queue (head and tail) pointers.
      This offers a tradeoff between sometimes requiring extra
      traversal steps to locate the first and/or last unmatched
      nodes, versus the reduced overhead and contention of fewer
      updates to queue pointers. For example, a possible snapshot of
      a queue is:
       head           tail
         |              |
         v              v
         M -&gt; M -&gt; U -&gt; U -&gt; U -&gt; U
      The best value for this "slack" (the targeted maximum distance
      between the value of "head" and the first unmatched node, and
      similarly for "tail") is an empirical matter. We have found
      that using very small constants in the range of 1-3 work best
      over a range of platforms. Larger values introduce increasing
      costs of cache misses and risks of long traversal chains, while
      smaller values increase CAS contention and overhead.
      Dual queues with slack differ from plain M&amp;S dual queues by
      virtue of only sometimes updating head or tail pointers when
      matching, appending, or even traversing nodes; in order to
      maintain a targeted slack.  The idea of "sometimes" may be
      operationalized in several ways. The simplest is to use a
      per-operation counter incremented on each traversal step, and
      to try (via CAS) to update the associated queue pointer
      whenever the count exceeds a threshold. Another, that requires
      more overhead, is to use random number generators to update
      with a given probability per traversal step.
      In any strategy along these lines, because CASes updating
      fields may fail, the actual slack may exceed targeted
      slack. However, they may be retried at any time to maintain
      targets.  Even when using very small slack values, this
      approach works well for dual queues because it allows all
      operations up to the point of matching or appending an item
      (hence potentially allowing progress by another thread) to be
      read-only, thus not introducing any further contention. As
      described below, we implement this by performing slack
      maintenance retries only after these points.
      As an accompaniment to such techniques, traversal overhead can
      be further reduced without increasing contention of head
      pointer updates: Threads may sometimes shortcut the "next" link
      path from the current "head" node to be closer to the currently
      known first unmatched node, and similarly for tail. Again, this
      may be triggered with using thresholds or randomization.
      These ideas must be further extended to avoid unbounded amounts
      of costly-to-reclaim garbage caused by the sequential "next"
      links of nodes starting at old forgotten head nodes: As first
      described in detail by Boehm
      (http://portal.acm.org/citation.cfm?doid=503272.503282) if a GC
      delays noticing that any arbitrarily old node has become
      garbage, all newer dead nodes will also be unreclaimed.
      (Similar issues arise in non-GC environments.)  To cope with
      this in our implementation, upon CASing to advance the head
      pointer, we set the "next" link of the previous head to point
      only to itself; thus limiting the length of connected dead lists.
      (We also take similar care to wipe out possibly garbage
      retaining values held in other Node fields.)  However, doing so
      adds some further complexity to traversal: If any "next"
      pointer links to itself, it indicates that the current thread
      has lagged behind a head-update, and so the traversal must
      continue from the "head".  Traversals trying to find the
      current tail starting from "tail" may also encounter
      self-links, in which case they also continue at "head".
      It is tempting in slack-based scheme to not even use CAS for
      updates (similarly to Ladan-Mozes &amp; Shavit). However, this
      cannot be done for head updates under the above link-forgetting
      mechanics because an update may leave head at a detached node.
      And while direct writes are possible for tail updates, they
      increase the risk of long retraversals, and hence long garbage
      chains, which can be much more costly than is worthwhile
      considering that the cost difference of performing a CAS vs
      write is smaller when they are not triggered on each operation
      (especially considering that writes and CASes equally require
      additional GC bookkeeping ("write barriers") that are sometimes
      more costly than the writes themselves because of contention).
      *** Overview of implementation ***
      We use a threshold-based approach to updates, with a slack
      threshold of two -- that is, we update head/tail when the
      current pointer appears to be two or more steps away from the
      first/last node. The slack value is hard-wired: a path greater
      than one is naturally implemented by checking equality of
      traversal pointers except when the list has only one element,
      in which case we keep slack threshold at one. Avoiding tracking
      explicit counts across method calls slightly simplifies an
      already-messy implementation. Using randomization would
      probably work better if there were a low-quality dirt-cheap
      per-thread one available, but even ThreadLocalRandom is too
      heavy for these purposes.
      With such a small slack threshold value, it is not worthwhile
      to augment this with path short-circuiting (i.e., unsplicing
      interior nodes) except in the case of cancellation/removal (see
      below).
      We allow both the head and tail fields to be null before any
      nodes are enqueued; initializing upon first append.  This
      simplifies some other logic, as well as providing more
      efficient explicit control paths instead of letting JVMs insert
      implicit NullPointerExceptions when they are null.  While not
      currently fully implemented, we also leave open the possibility
      of re-nulling these fields when empty (which is complicated to
      arrange, for little benefit.)
      All enqueue/dequeue operations are handled by the single method
      "xfer" with parameters indicating whether to act as some form
      of offer, put, poll, take, or transfer (each possibly with
      timeout). The relative complexity of using one monolithic
      method outweighs the code bulk and maintenance problems of
      using separate methods for each case.
      Operation consists of up to three phases. The first is
      implemented within method xfer, the second in tryAppend, and
      the third in method awaitMatch.
      1. Try to match an existing node
         Starting at head, skip already-matched nodes until finding
         an unmatched node of opposite mode, if one exists, in which
         case matching it and returning, also if necessary updating
         head to one past the matched node (or the node itself if the
         list has no other unmatched nodes). If the CAS misses, then
         a loop retries advancing head by two steps until either
         success or the slack is at most two. By requiring that each
         attempt advances head by two (if applicable), we ensure that
         the slack does not grow without bound. Traversals also check
         if the initial head is now off-list, in which case they
         start at the new head.
         If no candidates are found and the call was untimed
         poll/offer, (argument "how" is NOW) return.
      2. Try to append a new node (method tryAppend)
         Starting at current tail pointer, find the actual last node
         and try to append a new node (or if head was null, establish
         the first node). Nodes can be appended only if their
         predecessors are either already matched or are of the same
         mode. If we detect otherwise, then a new node with opposite
         mode must have been appended during traversal, so we must
         restart at phase 1. The traversal and update steps are
         otherwise similar to phase 1: Retrying upon CAS misses and
         checking for staleness.  In particular, if a self-link is
         encountered, then we can safely jump to a node on the list
         by continuing the traversal at current head.
         On successful append, if the call was ASYNC, return.
      3. Await match or cancellation (method awaitMatch)
         Wait for another thread to match node; instead cancelling if
         the current thread was interrupted or the wait timed out. On
         multiprocessors, we use front-of-queue spinning: If a node
         appears to be the first unmatched node in the queue, it
         spins a bit before blocking. In either case, before blocking
         it tries to unsplice any nodes between the current "head"
         and the first unmatched node.
         Front-of-queue spinning vastly improves performance of
         heavily contended queues. And so long as it is relatively
         brief and "quiet", spinning does not much impact performance
         of less-contended queues.  During spins threads check their
         interrupt status and generate a thread-local random number
         to decide to occasionally perform a Thread.yield. While
         yield has underdefined specs, we assume that it might help,
         and will not hurt, in limiting impact of spinning on busy
         systems.  We also use smaller (1/2) spins for nodes that are
         not known to be front but whose predecessors have not
         blocked -- these "chained" spins avoid artifacts of
         front-of-queue rules which otherwise lead to alternating
         nodes spinning vs blocking. Further, front threads that
         represent phase changes (from data to request node or vice
         versa) compared to their predecessors receive additional
         chained spins, reflecting longer paths typically required to
         unblock threads during phase changes.
      ** Unlinking removed interior nodes **
      In addition to minimizing garbage retention via self-linking
      described above, we also unlink removed interior nodes. These
      may arise due to timed out or interrupted waits, or calls to
      remove(x) or Iterator.remove.  Normally, given a node that was
      at one time known to be the predecessor of some node s that is
      to be removed, we can unsplice s by CASing the next field of
      its predecessor if it still points to s (otherwise s must
      already have been removed or is now offlist). But there are two
      situations in which we cannot guarantee to make node s
      unreachable in this way: (1) If s is the trailing node of list
      (i.e., with null next), then it is pinned as the target node
      for appends, so can only be removed later after other nodes are
      appended. (2) We cannot necessarily unlink s given a
      predecessor node that is matched (including the case of being
      cancelled): the predecessor may already be unspliced, in which
      case some previous reachable node may still point to s.
      (For further explanation see Herlihy &amp; Shavit "The Art of
      Multiprocessor Programming" chapter 9).  Although, in both
      cases, we can rule out the need for further action if either s
      or its predecessor are (or can be made to be) at, or fall off
      from, the head of list.
      Without taking these into account, it would be possible for an
      unbounded number of supposedly removed nodes to remain
      reachable.  Situations leading to such buildup are uncommon but
      can occur in practice; for example when a series of short timed
      calls to poll repeatedly time out but never otherwise fall off
      the list because of an untimed call to take at the front of the
      queue.
      When these cases arise, rather than always retraversing the
      entire list to find an actual predecessor to unlink (which
      won't help for case (1) anyway), we record a conservative
      estimate of possible unsplice failures (in "sweepVotes").
      We trigger a full sweep when the estimate exceeds a threshold
      ("SWEEP_THRESHOLD") indicating the maximum number of estimated
      removal failures to tolerate before sweeping through, unlinking
      cancelled nodes that were not unlinked upon initial removal.
      We perform sweeps by the thread hitting threshold (rather than
      background threads or by spreading work to other threads)
      because in the main contexts in which removal occurs, the
      caller is already timed-out, cancelled, or performing a
      potentially O(n) operation (e.g. remove(x)), none of which are
      time-critical enough to warrant the overhead that alternatives
      would impose on other threads.
      Because the sweepVotes estimate is conservative, and because
      nodes become unlinked "naturally" as they fall off the head of
      the queue, and because we allow votes to accumulate even while
      sweeps are in progress, there are typically significantly fewer
      such nodes than estimated.  Choice of a threshold value
      balances the likelihood of wasted effort and contention, versus
      providing a worst-case bound on retention of interior nodes in
      quiescent queues. The value defined below was chosen
      empirically to balance these under various timeout scenarios.
      Note that we cannot self-link unlinked interior nodes during
      sweeps. However, the associated garbage chains terminate when
      some successor ultimately falls off the head of the list and is
      self-linked.</div>
<a id="L412" name="L412"></a> 412 
<div class="comment">
     /** True if on multiprocessor */</div>
<a id="L414" name="L414"></a> 414     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> MP =
<a id="L415" name="L415"></a> 415         <a href="../S/1774.html#L46" title="Defined at 46 in src/java/lang/Runtime.java.">Runtime</a>.<a href="../S/1774.html#L57" title="Defined at 57 in src/java/lang/Runtime.java.">getRuntime</a>().<a href="../S/1774.html#L635" title="Defined at 635 in src/java/lang/Runtime.java.">availableProcessors</a>() &gt; 1;
<a id="L416" name="L416"></a> 416 
<div class="comment">
      The number of times to spin (with randomly interspersed calls
      to Thread.yield) on multiprocessor before blocking when a node
      is apparently the first waiter in the queue.  See above for
      explanation. Must be a power of two. The value is empirically
      derived -- it works pretty well across a variety of processors,
      numbers of CPUs, and OSes.</div>
<a id="L425" name="L425"></a> 425     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> FRONT_SPINS   = 1 &lt;&lt; 7;
<a id="L426" name="L426"></a> 426 
<div class="comment">
      The number of times to spin before blocking when a node is
      preceded by another node that is apparently spinning.  Also
      serves as an increment to FRONT_SPINS on phase changes, and as
      base average frequency for yielding during spins. Must be a
      power of two.</div>
<a id="L434" name="L434"></a> 434     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CHAINED_SPINS = FRONT_SPINS &gt;&gt;&gt; 1;
<a id="L435" name="L435"></a> 435 
<div class="comment">
      The maximum number of estimated removal failures (sweepVotes)
      to tolerate before sweeping through the queue unlinking
      cancelled nodes that were not unlinked upon initial
      removal. See above for explanation. The value must be at least
      two to avoid useless sweeps when removing trailing nodes.</div>
<a id="L443" name="L443"></a> 443     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SWEEP_THRESHOLD = 32;
<a id="L444" name="L444"></a> 444 
<div class="comment">
      Queue nodes. Uses Object, not E, for items to allow forgetting
      them after use.  Relies heavily on Unsafe mechanics to minimize
      unnecessary ordering constraints: Writes that are intrinsically
      ordered wrt other accesses or CASes use simple relaxed forms.</div>
<a id="L451" name="L451"></a> 451     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5542.html" title="Multiple referred from 4060 places.">Node</a> <em class="brace">{</em>
<a id="L452" name="L452"></a> 452         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>;   <em class="comment">// false if this is a request node</em>
<a id="L453" name="L453"></a> 453         <strong class="reserved">volatile</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;   <em class="comment">// initially non-null if isData; CASed to match</em>
<a id="L454" name="L454"></a> 454         <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L455" name="L455"></a> 455         <strong class="reserved">volatile</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> waiter; <em class="comment">// null until waiting</em>
<a id="L456" name="L456"></a> 456 
<a id="L457" name="L457"></a> 457         <em class="comment">// CAS methods for fields</em>
<a id="L458" name="L458"></a> 458         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/10985.html" title="Multiple referred from 26 places.">casNext</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> cmp, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>) <em class="brace">{</em>
<a id="L459" name="L459"></a> 459             <strong class="reserved">return</strong> UNSAFE.compareAndSwapObject(<strong class="reserved">this</strong>, <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>, cmp, <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>);
<a id="L460" name="L460"></a> 460         <em class="brace">}</em>
<a id="L461" name="L461"></a> 461 
<a id="L462" name="L462"></a> 462         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/10984.html" title="Multiple referred from 10 places.">casItem</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> cmp, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>) <em class="brace">{</em>
<a id="L463" name="L463"></a> 463             <em class="comment">// assert cmp == null || cmp.getClass() != Node.class;</em>
<a id="L464" name="L464"></a> 464             <strong class="reserved">return</strong> UNSAFE.compareAndSwapObject(<strong class="reserved">this</strong>, itemOffset, cmp, <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>);
<a id="L465" name="L465"></a> 465         <em class="brace">}</em>
<a id="L466" name="L466"></a> 466 
<div class="comment">
          Constructs a new node.  Uses relaxed write because item can
          only be seen after publication via casNext.</div>
<a id="L471" name="L471"></a> 471         Node(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>, <strong class="reserved">boolean</strong> <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L472" name="L472"></a> 472             UNSAFE.putObject(<strong class="reserved">this</strong>, itemOffset, <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>); <em class="comment">// relaxed write</em>
<a id="L473" name="L473"></a> 473             <strong class="reserved">this</strong>.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> = <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>;
<a id="L474" name="L474"></a> 474         <em class="brace">}</em>
<a id="L475" name="L475"></a> 475 
<div class="comment">
          Links node to itself to avoid garbage retention.  Called
          only after CASing head field, so uses relaxed write.</div>
<a id="L480" name="L480"></a> 480         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14743.html" title="Multiple referred from 2 places.">forgetNext</a>() <em class="brace">{</em>
<a id="L481" name="L481"></a> 481             UNSAFE.putObject(<strong class="reserved">this</strong>, <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>, <strong class="reserved">this</strong>);
<a id="L482" name="L482"></a> 482         <em class="brace">}</em>
<a id="L483" name="L483"></a> 483 
<div class="comment">
          Sets item to self and waiter to null, to avoid garbage
          retention after matching or cancelling. Uses relaxed writes
          because order is already constrained in the only calling
          contexts: item is forgotten only after volatile/atomic
          mechanics that extract items.  Similarly, clearing waiter
          follows either CAS or return from park (if ever parked;
          else we don't care).</div>
<a id="L493" name="L493"></a> 493         <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14742.html" title="Multiple referred from 2 places.">forgetContents</a>() <em class="brace">{</em>
<a id="L494" name="L494"></a> 494             UNSAFE.putObject(<strong class="reserved">this</strong>, itemOffset, <strong class="reserved">this</strong>);
<a id="L495" name="L495"></a> 495             UNSAFE.putObject(<strong class="reserved">this</strong>, waiterOffset, <strong class="reserved">null</strong>);
<a id="L496" name="L496"></a> 496         <em class="brace">}</em>
<a id="L497" name="L497"></a> 497 
<div class="comment">
          Returns true if this node has been matched, including the
          case of artificial matches due to cancellation.</div>
<a id="L502" name="L502"></a> 502         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21716.html" title="Multiple referred from 14 places.">isMatched</a>() <em class="brace">{</em>
<a id="L503" name="L503"></a> 503             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> = <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L504" name="L504"></a> 504             <strong class="reserved">return</strong> (<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> == <strong class="reserved">this</strong>) || ((<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> == <strong class="reserved">null</strong>) == <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>);
<a id="L505" name="L505"></a> 505         <em class="brace">}</em>
<a id="L506" name="L506"></a> 506 
<div class="comment">
          Returns true if this is an unmatched request node.</div>
<a id="L510" name="L510"></a> 510         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> isUnmatchedRequest() <em class="brace">{</em>
<a id="L511" name="L511"></a> 511             <strong class="reserved">return</strong> !<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> &amp;&amp; <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>;
<a id="L512" name="L512"></a> 512         <em class="brace">}</em>
<a id="L513" name="L513"></a> 513 
<div class="comment">
          Returns true if a node with the given mode cannot be
          appended to this node because this node is unmatched and
          has opposite data mode.</div>
<a id="L519" name="L519"></a> 519         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1114.html#L669" title="Referred from 669 in src/java/util/concurrent/LinkedTransferQueue.java.">cannotPrecede</a>(<strong class="reserved">boolean</strong> haveData) <em class="brace">{</em>
<a id="L520" name="L520"></a> 520             <strong class="reserved">boolean</strong> d = <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>;
<a id="L521" name="L521"></a> 521             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>;
<a id="L522" name="L522"></a> 522             <strong class="reserved">return</strong> d != haveData &amp;&amp; (<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> = <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>) != <strong class="reserved">this</strong> &amp;&amp; (<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> != <strong class="reserved">null</strong>) == d;
<a id="L523" name="L523"></a> 523         <em class="brace">}</em>
<a id="L524" name="L524"></a> 524 
<div class="comment">
          Tries to artificially match a data node -- used by remove.</div>
<a id="L528" name="L528"></a> 528         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29554.html" title="Multiple referred from 2 places.">tryMatchData</a>() <em class="brace">{</em>
<a id="L529" name="L529"></a> 529             <em class="comment">// assert isData;</em>
<a id="L530" name="L530"></a> 530             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> = <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L531" name="L531"></a> 531             <strong class="reserved">if</strong> (<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> != <strong class="reserved">this</strong> &amp;&amp; <a href="../D/12262.html" title="Multiple defined in 4 places.">casItem</a>(<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>, <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L532" name="L532"></a> 532                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(waiter);
<a id="L533" name="L533"></a> 533                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L534" name="L534"></a> 534             <em class="brace">}</em>
<a id="L535" name="L535"></a> 535             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L536" name="L536"></a> 536         <em class="brace">}</em>
<a id="L537" name="L537"></a> 537 
<a id="L538" name="L538"></a> 538         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -3375979862319811754L;
<a id="L539" name="L539"></a> 539 
<a id="L540" name="L540"></a> 540         <em class="comment">// Unsafe mechanics</em>
<a id="L541" name="L541"></a> 541         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> sun.misc.Unsafe UNSAFE;
<a id="L542" name="L542"></a> 542         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> itemOffset;
<a id="L543" name="L543"></a> 543         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>;
<a id="L544" name="L544"></a> 544         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> waiterOffset;
<a id="L545" name="L545"></a> 545         <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L546" name="L546"></a> 546             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L547" name="L547"></a> 547                 UNSAFE = sun.misc.Unsafe.getUnsafe();
<a id="L548" name="L548"></a> 548                 <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; k = <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<strong class="reserved">class</strong>;
<a id="L549" name="L549"></a> 549                 itemOffset = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L550" name="L550"></a> 550                     (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("item"));
<a id="L551" name="L551"></a> 551                 <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a> = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L552" name="L552"></a> 552                     (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("next"));
<a id="L553" name="L553"></a> 553                 waiterOffset = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L554" name="L554"></a> 554                     (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("waiter"));
<a id="L555" name="L555"></a> 555             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L556" name="L556"></a> 556                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(e);
<a id="L557" name="L557"></a> 557             <em class="brace">}</em>
<a id="L558" name="L558"></a> 558         <em class="brace">}</em>
<a id="L559" name="L559"></a> 559     <em class="brace">}</em>
<a id="L560" name="L560"></a> 560 
<div class="comment">
     /** head of the queue; null until first enqueue */</div>
<a id="L562" name="L562"></a> 562     <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> head;
<a id="L563" name="L563"></a> 563 
<div class="comment">
     /** tail of the queue; null until first append */</div>
<a id="L565" name="L565"></a> 565     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> tail;
<a id="L566" name="L566"></a> 566 
<div class="comment">
     /** The number of apparent failures to unsplice removed nodes */</div>
<a id="L568" name="L568"></a> 568     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> sweepVotes;
<a id="L569" name="L569"></a> 569 
<a id="L570" name="L570"></a> 570     <em class="comment">// CAS methods for fields</em>
<a id="L571" name="L571"></a> 571     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/10993.html" title="Multiple referred from 9 places.">casTail</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> cmp, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>) <em class="brace">{</em>
<a id="L572" name="L572"></a> 572         <strong class="reserved">return</strong> UNSAFE.compareAndSwapObject(<strong class="reserved">this</strong>, tailOffset, cmp, <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>);
<a id="L573" name="L573"></a> 573     <em class="brace">}</em>
<a id="L574" name="L574"></a> 574 
<a id="L575" name="L575"></a> 575     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/10983.html" title="Multiple referred from 20 places.">casHead</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> cmp, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>) <em class="brace">{</em>
<a id="L576" name="L576"></a> 576         <strong class="reserved">return</strong> UNSAFE.compareAndSwapObject(<strong class="reserved">this</strong>, headOffset, cmp, <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>);
<a id="L577" name="L577"></a> 577     <em class="brace">}</em>
<a id="L578" name="L578"></a> 578 
<a id="L579" name="L579"></a> 579     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/10991.html" title="Multiple referred from 2 places.">casSweepVotes</a>(<strong class="reserved">int</strong> cmp, <strong class="reserved">int</strong> <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>) <em class="brace">{</em>
<a id="L580" name="L580"></a> 580         <strong class="reserved">return</strong> UNSAFE.compareAndSwapInt(<strong class="reserved">this</strong>, sweepVotesOffset, cmp, <a href="../S/1444.html#L56" title="Defined at 56 in src/java/io/ExpiringCache.java.">val</a>);
<a id="L581" name="L581"></a> 581     <em class="brace">}</em>
<a id="L582" name="L582"></a> 582 
<div class="comment">
      Possible values for "how" argument in xfer method.</div>
<a id="L586" name="L586"></a> 586     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> NOW   = 0; <em class="comment">// for untimed poll, tryTransfer</em>
<a id="L587" name="L587"></a> 587     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> ASYNC = 1; <em class="comment">// for offer, put, add</em>
<a id="L588" name="L588"></a> 588     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SYNC  = 2; <em class="comment">// for transfer, take</em>
<a id="L589" name="L589"></a> 589     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> TIMED = 3; <em class="comment">// for timed poll, tryTransfer</em>
<a id="L590" name="L590"></a> 590 
<a id="L591" name="L591"></a> 591     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L592" name="L592"></a> 592     <strong class="reserved">static</strong> &lt;E&gt; E <a href="../R/10996.html" title="Multiple referred from 111 places.">cast</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>) <em class="brace">{</em>
<a id="L593" name="L593"></a> 593         <em class="comment">// assert item == null || item.getClass() != Node.class;</em>
<a id="L594" name="L594"></a> 594         <strong class="reserved">return</strong> (E) <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L595" name="L595"></a> 595     <em class="brace">}</em>
<a id="L596" name="L596"></a> 596 
<div class="comment">
      Implements all queuing methods. See above for explanation.
      @param e the item or null for take
      @param haveData true if this is a put, else a take
      @param how NOW, ASYNC, SYNC, or TIMED
      @param nanos timeout in nanosecs, used only if mode is TIMED
      @return an item if matched, else e
      @throws NullPointerException if haveData mode but e is null</div>
<a id="L607" name="L607"></a> 607     <strong class="reserved">private</strong> E <a href="../R/30834.html" title="Multiple referred from 10 places.">xfer</a>(E e, <strong class="reserved">boolean</strong> haveData, <strong class="reserved">int</strong> how, <strong class="reserved">long</strong> nanos) <em class="brace">{</em>
<a id="L608" name="L608"></a> 608         <strong class="reserved">if</strong> (haveData &amp;&amp; (e == <strong class="reserved">null</strong>))
<a id="L609" name="L609"></a> 609             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L610" name="L610"></a> 610         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s = <strong class="reserved">null</strong>;                        <em class="comment">// the node to append, if needed</em>
<a id="L611" name="L611"></a> 611 
<a id="L612" name="L612"></a> 612         retry:
<a id="L613" name="L613"></a> 613         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>                            <em class="comment">// restart on append race</em>
<a id="L614" name="L614"></a> 614 
<a id="L615" name="L615"></a> 615             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head, p = h; p != <strong class="reserved">null</strong>;) <em class="brace">{</em> <em class="comment">// find &amp; match first node</em>
<a id="L616" name="L616"></a> 616                 <strong class="reserved">boolean</strong> <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> = p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>;
<a id="L617" name="L617"></a> 617                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L618" name="L618"></a> 618                 <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != p &amp;&amp; (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != <strong class="reserved">null</strong>) == <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em> <em class="comment">// unmatched</em>
<a id="L619" name="L619"></a> 619                     <strong class="reserved">if</strong> (<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> == haveData)   <em class="comment">// can't match</em>
<a id="L620" name="L620"></a> 620                         <strong class="reserved">break</strong>;
<a id="L621" name="L621"></a> 621                     <strong class="reserved">if</strong> (p.<a href="../D/12262.html" title="Multiple defined in 4 places.">casItem</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>, e)) <em class="brace">{</em> <em class="comment">// match</em>
<a id="L622" name="L622"></a> 622                         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> q = p; q != h;) <em class="brace">{</em>
<a id="L623" name="L623"></a> 623                             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> n = q.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;  <em class="comment">// update by 2 unless singleton</em>
<a id="L624" name="L624"></a> 624                             <strong class="reserved">if</strong> (head == h &amp;&amp; <a href="../D/12261.html" title="Multiple defined in 5 places.">casHead</a>(h, n == <strong class="reserved">null</strong> ? q : n)) <em class="brace">{</em>
<a id="L625" name="L625"></a> 625                                 h.<a href="../S/1114.html#L480" title="Defined at 480 in src/java/util/concurrent/LinkedTransferQueue.java.">forgetNext</a>();
<a id="L626" name="L626"></a> 626                                 <strong class="reserved">break</strong>;
<a id="L627" name="L627"></a> 627                             <em class="brace">}</em>                 <em class="comment">// advance and retry</em>
<a id="L628" name="L628"></a> 628                             <strong class="reserved">if</strong> ((h = head)   == <strong class="reserved">null</strong> ||
<a id="L629" name="L629"></a> 629                                 (q = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong> || !q.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L630" name="L630"></a> 630                                 <strong class="reserved">break</strong>;        <em class="comment">// unless slack &lt; 2</em>
<a id="L631" name="L631"></a> 631                         <em class="brace">}</em>
<a id="L632" name="L632"></a> 632                         <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(p.waiter);
<a id="L633" name="L633"></a> 633                         <strong class="reserved">return</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>.&lt;E&gt;<a href="../D/12274.html" title="Multiple defined in 6 places.">cast</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>);
<a id="L634" name="L634"></a> 634                     <em class="brace">}</em>
<a id="L635" name="L635"></a> 635                 <em class="brace">}</em>
<a id="L636" name="L636"></a> 636                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> n = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L637" name="L637"></a> 637                 p = (p != n) ? n : (h = head); <em class="comment">// Use head if p offlist</em>
<a id="L638" name="L638"></a> 638             <em class="brace">}</em>
<a id="L639" name="L639"></a> 639 
<a id="L640" name="L640"></a> 640             <strong class="reserved">if</strong> (how != NOW) <em class="brace">{</em>                 <em class="comment">// No matches available</em>
<a id="L641" name="L641"></a> 641                 <strong class="reserved">if</strong> (s == <strong class="reserved">null</strong>)
<a id="L642" name="L642"></a> 642                     s = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(e, haveData);
<a id="L643" name="L643"></a> 643                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../S/1114.html#L662" title="Defined at 662 in src/java/util/concurrent/LinkedTransferQueue.java.">tryAppend</a>(s, haveData);
<a id="L644" name="L644"></a> 644                 <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> == <strong class="reserved">null</strong>)
<a id="L645" name="L645"></a> 645                     <strong class="reserved">continue</strong> retry;           <em class="comment">// lost race vs opposite mode</em>
<a id="L646" name="L646"></a> 646                 <strong class="reserved">if</strong> (how != ASYNC)
<a id="L647" name="L647"></a> 647                     <strong class="reserved">return</strong> <a href="../S/1114.html#L700" title="Defined at 700 in src/java/util/concurrent/LinkedTransferQueue.java.">awaitMatch</a>(s, <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, e, (how == TIMED), nanos);
<a id="L648" name="L648"></a> 648             <em class="brace">}</em>
<a id="L649" name="L649"></a> 649             <strong class="reserved">return</strong> e; <em class="comment">// not waiting</em>
<a id="L650" name="L650"></a> 650         <em class="brace">}</em>
<a id="L651" name="L651"></a> 651     <em class="brace">}</em>
<a id="L652" name="L652"></a> 652 
<div class="comment">
      Tries to append node s as tail.
      @param s the node to append
      @param haveData true if appending in data mode
      @return null on failure due to losing race with append in
      different mode, else s's predecessor, or s itself if no
      predecessor</div>
<a id="L662" name="L662"></a> 662     <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1114.html#L643" title="Referred from 643 in src/java/util/concurrent/LinkedTransferQueue.java.">tryAppend</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s, <strong class="reserved">boolean</strong> haveData) <em class="brace">{</em>
<a id="L663" name="L663"></a> 663         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail, p = t;;) <em class="brace">{</em>        <em class="comment">// move p to last node and append</em>
<a id="L664" name="L664"></a> 664             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> n, <a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a>;                        <em class="comment">// temps for reads of next &amp; tail</em>
<a id="L665" name="L665"></a> 665             <strong class="reserved">if</strong> (p == <strong class="reserved">null</strong> &amp;&amp; (p = head) == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L666" name="L666"></a> 666                 <strong class="reserved">if</strong> (<a href="../D/12261.html" title="Multiple defined in 5 places.">casHead</a>(<strong class="reserved">null</strong>, s))
<a id="L667" name="L667"></a> 667                     <strong class="reserved">return</strong> s;                 <em class="comment">// initialize</em>
<a id="L668" name="L668"></a> 668             <em class="brace">}</em>
<a id="L669" name="L669"></a> 669             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (p.<a href="../S/1114.html#L519" title="Defined at 519 in src/java/util/concurrent/LinkedTransferQueue.java.">cannotPrecede</a>(haveData))
<a id="L670" name="L670"></a> 670                 <strong class="reserved">return</strong> <strong class="reserved">null</strong>;                  <em class="comment">// lost race vs opposite mode</em>
<a id="L671" name="L671"></a> 671             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((n = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong>)    <em class="comment">// not last; keep traversing</em>
<a id="L672" name="L672"></a> 672                 p = p != t &amp;&amp; t != (<a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a> = tail) ? (t = <a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a>) : <em class="comment">// stale tail</em>
<a id="L673" name="L673"></a> 673                     (p != n) ? n : <strong class="reserved">null</strong>;      <em class="comment">// restart if off list</em>
<a id="L674" name="L674"></a> 674             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!p.<a href="../D/12263.html" title="Multiple defined in 6 places.">casNext</a>(<strong class="reserved">null</strong>, s))
<a id="L675" name="L675"></a> 675                 p = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;                   <em class="comment">// re-read on CAS failure</em>
<a id="L676" name="L676"></a> 676             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L677" name="L677"></a> 677                 <strong class="reserved">if</strong> (p != t) <em class="brace">{</em>                 <em class="comment">// update if slack now &gt;= 2</em>
<a id="L678" name="L678"></a> 678                     <strong class="reserved">while</strong> ((tail != t || !<a href="../D/12271.html" title="Multiple defined in 3 places.">casTail</a>(t, s)) &amp;&amp;
<a id="L679" name="L679"></a> 679                            (t = tail)   != <strong class="reserved">null</strong> &amp;&amp;
<a id="L680" name="L680"></a> 680                            (s = t.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp; <em class="comment">// advance and retry</em>
<a id="L681" name="L681"></a> 681                            (s = s.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp; s != t);
<a id="L682" name="L682"></a> 682                 <em class="brace">}</em>
<a id="L683" name="L683"></a> 683                 <strong class="reserved">return</strong> p;
<a id="L684" name="L684"></a> 684             <em class="brace">}</em>
<a id="L685" name="L685"></a> 685         <em class="brace">}</em>
<a id="L686" name="L686"></a> 686     <em class="brace">}</em>
<a id="L687" name="L687"></a> 687 
<div class="comment">
      Spins/yields/blocks until node s is matched or caller gives up.
      @param s the waiting node
      @param pred the predecessor of s, or s itself if it has no
      predecessor, or null if unknown (the null case does not occur
      in any current calls but may in possible future extensions)
      @param e the comparison value for checking match
      @param timed if true, wait only until timeout elapses
      @param nanos timeout in nanosecs, used only if timed is true
      @return matched item, or e if unmatched on interrupt or timeout</div>
<a id="L700" name="L700"></a> 700     <strong class="reserved">private</strong> E <a href="../S/1114.html#L647" title="Referred from 647 in src/java/util/concurrent/LinkedTransferQueue.java.">awaitMatch</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, E e, <strong class="reserved">boolean</strong> timed, <strong class="reserved">long</strong> nanos) <em class="brace">{</em>
<a id="L701" name="L701"></a> 701         <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = timed ? <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanos : 0L;
<a id="L702" name="L702"></a> 702         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> w = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L703" name="L703"></a> 703         <strong class="reserved">int</strong> spins = -1; <em class="comment">// initialized after first item and cancel checks</em>
<a id="L704" name="L704"></a> 704         <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a> randomYields = <strong class="reserved">null</strong>; <em class="comment">// bound if needed</em>
<a id="L705" name="L705"></a> 705 
<a id="L706" name="L706"></a> 706         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L707" name="L707"></a> 707             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = s.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L708" name="L708"></a> 708             <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != e) <em class="brace">{</em>                  <em class="comment">// matched</em>
<a id="L709" name="L709"></a> 709                 <em class="comment">// assert item != s;</em>
<a id="L710" name="L710"></a> 710                 s.<a href="../S/1114.html#L493" title="Defined at 493 in src/java/util/concurrent/LinkedTransferQueue.java.">forgetContents</a>();           <em class="comment">// avoid garbage</em>
<a id="L711" name="L711"></a> 711                 <strong class="reserved">return</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>.&lt;E&gt;<a href="../D/12274.html" title="Multiple defined in 6 places.">cast</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>);
<a id="L712" name="L712"></a> 712             <em class="brace">}</em>
<a id="L713" name="L713"></a> 713             <strong class="reserved">if</strong> ((w.<a href="../D/25738.html" title="Multiple defined in 2 places.">isInterrupted</a>() || (timed &amp;&amp; nanos &lt;= 0)) &amp;&amp;
<a id="L714" name="L714"></a> 714                     s.<a href="../D/12262.html" title="Multiple defined in 4 places.">casItem</a>(e, s)) <em class="brace">{</em>        <em class="comment">// cancel</em>
<a id="L715" name="L715"></a> 715                 <a href="../S/1114.html#L1056" title="Defined at 1056 in src/java/util/concurrent/LinkedTransferQueue.java.">unsplice</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, s);
<a id="L716" name="L716"></a> 716                 <strong class="reserved">return</strong> e;
<a id="L717" name="L717"></a> 717             <em class="brace">}</em>
<a id="L718" name="L718"></a> 718 
<a id="L719" name="L719"></a> 719             <strong class="reserved">if</strong> (spins &lt; 0) <em class="brace">{</em>                  <em class="comment">// establish spins at/near front</em>
<a id="L720" name="L720"></a> 720                 <strong class="reserved">if</strong> ((spins = <a href="../S/1114.html#L746" title="Defined at 746 in src/java/util/concurrent/LinkedTransferQueue.java.">spinsFor</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, s.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>)) &gt; 0)
<a id="L721" name="L721"></a> 721                     randomYields = <a href="../S/1056.html#L82" title="Defined at 82 in src/java/util/concurrent/ThreadLocalRandom.java.">ThreadLocalRandom</a>.<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>();
<a id="L722" name="L722"></a> 722             <em class="brace">}</em>
<a id="L723" name="L723"></a> 723             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (spins &gt; 0) <em class="brace">{</em>             <em class="comment">// spin</em>
<a id="L724" name="L724"></a> 724                 --spins;
<a id="L725" name="L725"></a> 725                 <strong class="reserved">if</strong> (randomYields.<a href="../D/28158.html" title="Multiple defined in 16 places.">nextInt</a>(CHAINED_SPINS) == 0)
<a id="L726" name="L726"></a> 726                     <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>();           <em class="comment">// occasionally yield</em>
<a id="L727" name="L727"></a> 727             <em class="brace">}</em>
<a id="L728" name="L728"></a> 728             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (s.waiter == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L729" name="L729"></a> 729                 s.waiter = w;                 <em class="comment">// request unpark then recheck</em>
<a id="L730" name="L730"></a> 730             <em class="brace">}</em>
<a id="L731" name="L731"></a> 731             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (timed) <em class="brace">{</em>
<a id="L732" name="L732"></a> 732                 nanos = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L733" name="L733"></a> 733                 <strong class="reserved">if</strong> (nanos &gt; 0L)
<a id="L734" name="L734"></a> 734                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanos);
<a id="L735" name="L735"></a> 735             <em class="brace">}</em>
<a id="L736" name="L736"></a> 736             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L737" name="L737"></a> 737                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L738" name="L738"></a> 738             <em class="brace">}</em>
<a id="L739" name="L739"></a> 739         <em class="brace">}</em>
<a id="L740" name="L740"></a> 740     <em class="brace">}</em>
<a id="L741" name="L741"></a> 741 
<div class="comment">
      Returns spin/yield value for a node with given predecessor and
      data mode. See above for explanation.</div>
<a id="L746" name="L746"></a> 746     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../S/1114.html#L720" title="Referred from 720 in src/java/util/concurrent/LinkedTransferQueue.java.">spinsFor</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <strong class="reserved">boolean</strong> haveData) <em class="brace">{</em>
<a id="L747" name="L747"></a> 747         <strong class="reserved">if</strong> (MP &amp;&amp; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L748" name="L748"></a> 748             <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> != haveData)      <em class="comment">// phase change</em>
<a id="L749" name="L749"></a> 749                 <strong class="reserved">return</strong> FRONT_SPINS + CHAINED_SPINS;
<a id="L750" name="L750"></a> 750             <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())             <em class="comment">// probably at front</em>
<a id="L751" name="L751"></a> 751                 <strong class="reserved">return</strong> FRONT_SPINS;
<a id="L752" name="L752"></a> 752             <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waiter == <strong class="reserved">null</strong>)          <em class="comment">// pred apparently spinning</em>
<a id="L753" name="L753"></a> 753                 <strong class="reserved">return</strong> CHAINED_SPINS;
<a id="L754" name="L754"></a> 754         <em class="brace">}</em>
<a id="L755" name="L755"></a> 755         <strong class="reserved">return</strong> 0;
<a id="L756" name="L756"></a> 756     <em class="brace">}</em>
<a id="L757" name="L757"></a> 757 
<div class="comment">
     /* -------------- Traversal methods -------------- */</div>
<a id="L759" name="L759"></a> 759 
<div class="comment">
      Returns the successor of p, or the head node if p.next has been
      linked to self, which will only be true if traversing with a
      stale pointer that is now off the list.</div>
<a id="L765" name="L765"></a> 765     <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/29027.html" title="Multiple referred from 54 places.">succ</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p) <em class="brace">{</em>
<a id="L766" name="L766"></a> 766         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L767" name="L767"></a> 767         <strong class="reserved">return</strong> (p == <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) ? head : <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L768" name="L768"></a> 768     <em class="brace">}</em>
<a id="L769" name="L769"></a> 769 
<div class="comment">
      Returns the first unmatched node of the given mode, or null if
      none.  Used by methods isEmpty, hasWaitingConsumer.</div>
<a id="L774" name="L774"></a> 774     <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1114.html#L1352" title="Referred from 1352 in src/java/util/concurrent/LinkedTransferQueue.java.">firstOfMode</a>(<strong class="reserved">boolean</strong> <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L775" name="L775"></a> 775         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head; p != <strong class="reserved">null</strong>; p = <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>(p)) <em class="brace">{</em>
<a id="L776" name="L776"></a> 776             <strong class="reserved">if</strong> (!p.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L777" name="L777"></a> 777                 <strong class="reserved">return</strong> (p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> == <a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) ? p : <strong class="reserved">null</strong>;
<a id="L778" name="L778"></a> 778         <em class="brace">}</em>
<a id="L779" name="L779"></a> 779         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L780" name="L780"></a> 780     <em class="brace">}</em>
<a id="L781" name="L781"></a> 781 
<div class="comment">
      Version of firstOfMode used by Spliterator. Callers must
      recheck if the returned node's item field is null or
      self-linked before using.</div>
<a id="L787" name="L787"></a> 787     <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/14632.html" title="Multiple referred from 6 places.">firstDataNode</a>() <em class="brace">{</em>
<a id="L788" name="L788"></a> 788         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head; p != <strong class="reserved">null</strong>;) <em class="brace">{</em>
<a id="L789" name="L789"></a> 789             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L790" name="L790"></a> 790             <strong class="reserved">if</strong> (p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L791" name="L791"></a> 791                 <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != p)
<a id="L792" name="L792"></a> 792                     <strong class="reserved">return</strong> p;
<a id="L793" name="L793"></a> 793             <em class="brace">}</em>
<a id="L794" name="L794"></a> 794             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>)
<a id="L795" name="L795"></a> 795                 <strong class="reserved">break</strong>;
<a id="L796" name="L796"></a> 796             <strong class="reserved">if</strong> (p == (p = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>))
<a id="L797" name="L797"></a> 797                 p = head;
<a id="L798" name="L798"></a> 798         <em class="brace">}</em>
<a id="L799" name="L799"></a> 799         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L800" name="L800"></a> 800     <em class="brace">}</em>
<a id="L801" name="L801"></a> 801 
<div class="comment">
      Returns the item in the first unmatched node with isData; or
      null if none.  Used by peek.</div>
<a id="L806" name="L806"></a> 806     <strong class="reserved">private</strong> E <a href="../S/1114.html#L1335" title="Referred from 1335 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataItem</a>() <em class="brace">{</em>
<a id="L807" name="L807"></a> 807         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head; p != <strong class="reserved">null</strong>; p = <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>(p)) <em class="brace">{</em>
<a id="L808" name="L808"></a> 808             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L809" name="L809"></a> 809             <strong class="reserved">if</strong> (p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L810" name="L810"></a> 810                 <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != p)
<a id="L811" name="L811"></a> 811                     <strong class="reserved">return</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>.&lt;E&gt;<a href="../D/12274.html" title="Multiple defined in 6 places.">cast</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>);
<a id="L812" name="L812"></a> 812             <em class="brace">}</em>
<a id="L813" name="L813"></a> 813             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>)
<a id="L814" name="L814"></a> 814                 <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L815" name="L815"></a> 815         <em class="brace">}</em>
<a id="L816" name="L816"></a> 816         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L817" name="L817"></a> 817     <em class="brace">}</em>
<a id="L818" name="L818"></a> 818 
<div class="comment">
      Traverses and counts unmatched nodes of the given mode.
      Used by methods size and getWaitingConsumerCount.</div>
<a id="L823" name="L823"></a> 823     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/12180.html" title="Multiple referred from 2 places.">countOfMode</a>(<strong class="reserved">boolean</strong> <a href="../S/6040.html#L177" title="Defined at 177 in src/com/sun/org/apache/xalan/internal/xsltc/dom/BitArray.java.">data</a>) <em class="brace">{</em>
<a id="L824" name="L824"></a> 824         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L825" name="L825"></a> 825         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head; p != <strong class="reserved">null</strong>; ) <em class="brace">{</em>
<a id="L826" name="L826"></a> 826             <strong class="reserved">if</strong> (!p.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>()) <em class="brace">{</em>
<a id="L827" name="L827"></a> 827                 <strong class="reserved">if</strong> (p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a> != <a href="../S/6040.html#L177" title="Defined at 177 in src/com/sun/org/apache/xalan/internal/xsltc/dom/BitArray.java.">data</a>)
<a id="L828" name="L828"></a> 828                     <strong class="reserved">return</strong> 0;
<a id="L829" name="L829"></a> 829                 <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE) <em class="comment">// saturated</em>
<a id="L830" name="L830"></a> 830                     <strong class="reserved">break</strong>;
<a id="L831" name="L831"></a> 831             <em class="brace">}</em>
<a id="L832" name="L832"></a> 832             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> n = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L833" name="L833"></a> 833             <strong class="reserved">if</strong> (n != p)
<a id="L834" name="L834"></a> 834                 p = n;
<a id="L835" name="L835"></a> 835             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L836" name="L836"></a> 836                 <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L837" name="L837"></a> 837                 p = head;
<a id="L838" name="L838"></a> 838             <em class="brace">}</em>
<a id="L839" name="L839"></a> 839         <em class="brace">}</em>
<a id="L840" name="L840"></a> 840         <strong class="reserved">return</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L841" name="L841"></a> 841     <em class="brace">}</em>
<a id="L842" name="L842"></a> 842 
<a id="L843" name="L843"></a> 843     <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/4056.html" title="Multiple referred from 24 places.">Itr</a> <strong class="reserved">implements</strong> <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a>&lt;E&gt; <em class="brace">{</em>
<a id="L844" name="L844"></a> 844         <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28170.html" title="Multiple defined in 34 places.">nextNode</a>;   <em class="comment">// next node to return item for</em>
<a id="L845" name="L845"></a> 845         <strong class="reserved">private</strong> E nextItem;      <em class="comment">// the corresponding item</em>
<a id="L846" name="L846"></a> 846         <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> lastRet;    <em class="comment">// last returned node, to support remove</em>
<a id="L847" name="L847"></a> 847         <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> lastPred;   <em class="comment">// predecessor to unlink lastRet</em>
<a id="L848" name="L848"></a> 848 
<div class="comment">
          Moves to next node after prev, or first node if prev null.</div>
<a id="L852" name="L852"></a> 852         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10102.html" title="Multiple referred from 119 places.">advance</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> prev) <em class="brace">{</em>
<div class="comment">
              To track and avoid buildup of deleted nodes in the face
              of calls to both Queue.remove and Itr.remove, we must
              include variants of unsplice and sweep upon each
              advance: Upon Itr.remove, we may need to catch up links
              from lastPred, and upon other removes, we might need to
              skip ahead from stale nodes and unsplice deleted ones
              found while advancing.</div>
<a id="L862" name="L862"></a> 862 
<a id="L863" name="L863"></a> 863             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> r, b; <em class="comment">// reset lastPred upon possible deletion of lastRet</em>
<a id="L864" name="L864"></a> 864             <strong class="reserved">if</strong> ((r = lastRet) != <strong class="reserved">null</strong> &amp;&amp; !r.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L865" name="L865"></a> 865                 lastPred = r;    <em class="comment">// next lastPred is old lastRet</em>
<a id="L866" name="L866"></a> 866             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((b = lastPred) == <strong class="reserved">null</strong> || b.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L867" name="L867"></a> 867                 lastPred = <strong class="reserved">null</strong>; <em class="comment">// at start of list</em>
<a id="L868" name="L868"></a> 868             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L869" name="L869"></a> 869                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s, n;       <em class="comment">// help with removal of lastPred.next</em>
<a id="L870" name="L870"></a> 870                 <strong class="reserved">while</strong> ((s = b.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L871" name="L871"></a> 871                        s != b &amp;&amp; s.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>() &amp;&amp;
<a id="L872" name="L872"></a> 872                        (n = s.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp; n != s)
<a id="L873" name="L873"></a> 873                     b.<a href="../D/12263.html" title="Multiple defined in 6 places.">casNext</a>(s, n);
<a id="L874" name="L874"></a> 874             <em class="brace">}</em>
<a id="L875" name="L875"></a> 875 
<a id="L876" name="L876"></a> 876             <strong class="reserved">this</strong>.lastRet = prev;
<a id="L877" name="L877"></a> 877 
<a id="L878" name="L878"></a> 878             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = prev, s, n;;) <em class="brace">{</em>
<a id="L879" name="L879"></a> 879                 s = (p == <strong class="reserved">null</strong>) ? head : p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L880" name="L880"></a> 880                 <strong class="reserved">if</strong> (s == <strong class="reserved">null</strong>)
<a id="L881" name="L881"></a> 881                     <strong class="reserved">break</strong>;
<a id="L882" name="L882"></a> 882                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (s == p) <em class="brace">{</em>
<a id="L883" name="L883"></a> 883                     p = <strong class="reserved">null</strong>;
<a id="L884" name="L884"></a> 884                     <strong class="reserved">continue</strong>;
<a id="L885" name="L885"></a> 885                 <em class="brace">}</em>
<a id="L886" name="L886"></a> 886                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = s.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L887" name="L887"></a> 887                 <strong class="reserved">if</strong> (s.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L888" name="L888"></a> 888                     <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != s) <em class="brace">{</em>
<a id="L889" name="L889"></a> 889                         nextItem = <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>.&lt;E&gt;<a href="../D/12274.html" title="Multiple defined in 6 places.">cast</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>);
<a id="L890" name="L890"></a> 890                         <a href="../D/28170.html" title="Multiple defined in 34 places.">nextNode</a> = s;
<a id="L891" name="L891"></a> 891                         <strong class="reserved">return</strong>;
<a id="L892" name="L892"></a> 892                     <em class="brace">}</em>
<a id="L893" name="L893"></a> 893                 <em class="brace">}</em>
<a id="L894" name="L894"></a> 894                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>)
<a id="L895" name="L895"></a> 895                     <strong class="reserved">break</strong>;
<a id="L896" name="L896"></a> 896                 <em class="comment">// assert s.isMatched();</em>
<a id="L897" name="L897"></a> 897                 <strong class="reserved">if</strong> (p == <strong class="reserved">null</strong>)
<a id="L898" name="L898"></a> 898                     p = s;
<a id="L899" name="L899"></a> 899                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((n = s.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong>)
<a id="L900" name="L900"></a> 900                     <strong class="reserved">break</strong>;
<a id="L901" name="L901"></a> 901                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (s == n)
<a id="L902" name="L902"></a> 902                     p = <strong class="reserved">null</strong>;
<a id="L903" name="L903"></a> 903                 <strong class="reserved">else</strong>
<a id="L904" name="L904"></a> 904                     p.<a href="../D/12263.html" title="Multiple defined in 6 places.">casNext</a>(s, n);
<a id="L905" name="L905"></a> 905             <em class="brace">}</em>
<a id="L906" name="L906"></a> 906             <a href="../D/28170.html" title="Multiple defined in 34 places.">nextNode</a> = <strong class="reserved">null</strong>;
<a id="L907" name="L907"></a> 907             nextItem = <strong class="reserved">null</strong>;
<a id="L908" name="L908"></a> 908         <em class="brace">}</em>
<a id="L909" name="L909"></a> 909 
<a id="L910" name="L910"></a> 910         Itr() <em class="brace">{</em>
<a id="L911" name="L911"></a> 911             <a href="../D/11249.html" title="Multiple defined in 12 places.">advance</a>(<strong class="reserved">null</strong>);
<a id="L912" name="L912"></a> 912         <em class="brace">}</em>
<a id="L913" name="L913"></a> 913 
<a id="L914" name="L914"></a> 914         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20233.html" title="Multiple referred from 653 places.">hasNext</a>() <em class="brace">{</em>
<a id="L915" name="L915"></a> 915             <strong class="reserved">return</strong> <a href="../D/28170.html" title="Multiple defined in 34 places.">nextNode</a> != <strong class="reserved">null</strong>;
<a id="L916" name="L916"></a> 916         <em class="brace">}</em>
<a id="L917" name="L917"></a> 917 
<a id="L918" name="L918"></a> 918         <strong class="reserved">public</strong> <strong class="reserved">final</strong> E <a href="../R/23650.html" title="Multiple referred from 3301 places.">next</a>() <em class="brace">{</em>
<a id="L919" name="L919"></a> 919             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28170.html" title="Multiple defined in 34 places.">nextNode</a>;
<a id="L920" name="L920"></a> 920             <strong class="reserved">if</strong> (p == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1128.html#L38" title="Defined at 38 in src/java/util/NoSuchElementException.java.">NoSuchElementException</a>();
<a id="L921" name="L921"></a> 921             E e = nextItem;
<a id="L922" name="L922"></a> 922             <a href="../D/11249.html" title="Multiple defined in 12 places.">advance</a>(p);
<a id="L923" name="L923"></a> 923             <strong class="reserved">return</strong> e;
<a id="L924" name="L924"></a> 924         <em class="brace">}</em>
<a id="L925" name="L925"></a> 925 
<a id="L926" name="L926"></a> 926         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/25882.html" title="Multiple referred from 1115 places.">remove</a>() <em class="brace">{</em>
<a id="L927" name="L927"></a> 927             <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> lastRet = <strong class="reserved">this</strong>.lastRet;
<a id="L928" name="L928"></a> 928             <strong class="reserved">if</strong> (lastRet == <strong class="reserved">null</strong>)
<a id="L929" name="L929"></a> 929                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>();
<a id="L930" name="L930"></a> 930             <strong class="reserved">this</strong>.lastRet = <strong class="reserved">null</strong>;
<a id="L931" name="L931"></a> 931             <strong class="reserved">if</strong> (lastRet.<a href="../S/1114.html#L528" title="Defined at 528 in src/java/util/concurrent/LinkedTransferQueue.java.">tryMatchData</a>())
<a id="L932" name="L932"></a> 932                 <a href="../S/1114.html#L1056" title="Defined at 1056 in src/java/util/concurrent/LinkedTransferQueue.java.">unsplice</a>(lastPred, lastRet);
<a id="L933" name="L933"></a> 933         <em class="brace">}</em>
<a id="L934" name="L934"></a> 934     <em class="brace">}</em>
<a id="L935" name="L935"></a> 935 
<div class="comment">
     /** A customized variant of Spliterators.IteratorSpliterator */</div>
<a id="L937" name="L937"></a> 937     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/1114.html#L1043" title="Referred from 1043 in src/java/util/concurrent/LinkedTransferQueue.java.">LTQSpliterator</a>&lt;E&gt; <strong class="reserved">implements</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E&gt; <em class="brace">{</em>
<a id="L938" name="L938"></a> 938         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_BATCH = 1 &lt;&lt; 25;  <em class="comment">// max batch array size;</em>
<a id="L939" name="L939"></a> 939         <strong class="reserved">final</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>&lt;E&gt; queue;
<a id="L940" name="L940"></a> 940         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;    <em class="comment">// current node; null until initialized</em>
<a id="L941" name="L941"></a> 941         <strong class="reserved">int</strong> batch;          <em class="comment">// batch size for splits</em>
<a id="L942" name="L942"></a> 942         <strong class="reserved">boolean</strong> exhausted;  <em class="comment">// true when no more nodes</em>
<a id="L943" name="L943"></a> 943         LTQSpliterator(<a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>&lt;E&gt; queue) <em class="brace">{</em>
<a id="L944" name="L944"></a> 944             <strong class="reserved">this</strong>.queue = queue;
<a id="L945" name="L945"></a> 945         <em class="brace">}</em>
<a id="L946" name="L946"></a> 946 
<a id="L947" name="L947"></a> 947         <strong class="reserved">public</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E&gt; <a href="../R/29563.html" title="Multiple referred from 18 places.">trySplit</a>() <em class="brace">{</em>
<a id="L948" name="L948"></a> 948             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p;
<a id="L949" name="L949"></a> 949             <strong class="reserved">final</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>&lt;E&gt; q = <strong class="reserved">this</strong>.queue;
<a id="L950" name="L950"></a> 950             <strong class="reserved">int</strong> b = batch;
<a id="L951" name="L951"></a> 951             <strong class="reserved">int</strong> n = (b &lt;= 0) ? 1 : (b &gt;= MAX_BATCH) ? MAX_BATCH : b + 1;
<a id="L952" name="L952"></a> 952             <strong class="reserved">if</strong> (!exhausted &amp;&amp;
<a id="L953" name="L953"></a> 953                 ((p = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) != <strong class="reserved">null</strong> || (p = q.<a href="../S/1114.html#L787" title="Defined at 787 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataNode</a>()) != <strong class="reserved">null</strong>) &amp;&amp;
<a id="L954" name="L954"></a> 954                 p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L955" name="L955"></a> 955                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = <strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[n];
<a id="L956" name="L956"></a> 956                 <strong class="reserved">int</strong> i = 0;
<a id="L957" name="L957"></a> 957                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L958" name="L958"></a> 958                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> e = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L959" name="L959"></a> 959                     <strong class="reserved">if</strong> (e != p &amp;&amp; (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i] = e) != <strong class="reserved">null</strong>)
<a id="L960" name="L960"></a> 960                         ++i;
<a id="L961" name="L961"></a> 961                     <strong class="reserved">if</strong> (p == (p = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>))
<a id="L962" name="L962"></a> 962                         p = q.<a href="../S/1114.html#L787" title="Defined at 787 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataNode</a>();
<a id="L963" name="L963"></a> 963                 <em class="brace">}</em> <strong class="reserved">while</strong> (p != <strong class="reserved">null</strong> &amp;&amp; i &lt; n &amp;&amp; p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>);
<a id="L964" name="L964"></a> 964                 <strong class="reserved">if</strong> ((<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = p) == <strong class="reserved">null</strong>)
<a id="L965" name="L965"></a> 965                     exhausted = <strong class="reserved">true</strong>;
<a id="L966" name="L966"></a> 966                 <strong class="reserved">if</strong> (i &gt; 0) <em class="brace">{</em>
<a id="L967" name="L967"></a> 967                     batch = i;
<a id="L968" name="L968"></a> 968                     <strong class="reserved">return</strong> <a href="../S/1188.html#L41" title="Defined at 41 in src/java/util/Spliterators.java.">Spliterators</a>.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>
<a id="L969" name="L969"></a> 969                         (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, 0, i, <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.<a href="../S/915.html#L281" title="Defined at 281 in src/java/util/stream/StreamOpFlag.java.">ORDERED</a> | <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.NONNULL |
<a id="L970" name="L970"></a> 970                          <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.CONCURRENT);
<a id="L971" name="L971"></a> 971                 <em class="brace">}</em>
<a id="L972" name="L972"></a> 972             <em class="brace">}</em>
<a id="L973" name="L973"></a> 973             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L974" name="L974"></a> 974         <em class="brace">}</em>
<a id="L975" name="L975"></a> 975 
<a id="L976" name="L976"></a> 976         @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L977" name="L977"></a> 977         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/14732.html" title="Multiple referred from 54 places.">forEachRemaining</a>(<a href="../S/963.html#L42" title="Defined at 42 in src/java/util/function/Consumer.java.">Consumer</a>&lt;? <strong class="reserved">super</strong> E&gt; <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>) <em class="brace">{</em>
<a id="L978" name="L978"></a> 978             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p;
<a id="L979" name="L979"></a> 979             <strong class="reserved">if</strong> (<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a> == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L980" name="L980"></a> 980             <strong class="reserved">final</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>&lt;E&gt; q = <strong class="reserved">this</strong>.queue;
<a id="L981" name="L981"></a> 981             <strong class="reserved">if</strong> (!exhausted &amp;&amp;
<a id="L982" name="L982"></a> 982                 ((p = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) != <strong class="reserved">null</strong> || (p = q.<a href="../S/1114.html#L787" title="Defined at 787 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataNode</a>()) != <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L983" name="L983"></a> 983                 exhausted = <strong class="reserved">true</strong>;
<a id="L984" name="L984"></a> 984                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L985" name="L985"></a> 985                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> e = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L986" name="L986"></a> 986                     <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong> &amp;&amp; e != p)
<a id="L987" name="L987"></a> 987                         <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>.<a href="../D/10537.html" title="Multiple defined in 327 places.">accept</a>((E)e);
<a id="L988" name="L988"></a> 988                     <strong class="reserved">if</strong> (p == (p = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>))
<a id="L989" name="L989"></a> 989                         p = q.<a href="../S/1114.html#L787" title="Defined at 787 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataNode</a>();
<a id="L990" name="L990"></a> 990                 <em class="brace">}</em> <strong class="reserved">while</strong> (p != <strong class="reserved">null</strong> &amp;&amp; p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>);
<a id="L991" name="L991"></a> 991             <em class="brace">}</em>
<a id="L992" name="L992"></a> 992         <em class="brace">}</em>
<a id="L993" name="L993"></a> 993 
<a id="L994" name="L994"></a> 994         @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L995" name="L995"></a> 995         <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/29541.html" title="Multiple referred from 73 places.">tryAdvance</a>(<a href="../S/963.html#L42" title="Defined at 42 in src/java/util/function/Consumer.java.">Consumer</a>&lt;? <strong class="reserved">super</strong> E&gt; <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>) <em class="brace">{</em>
<a id="L996" name="L996"></a> 996             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p;
<a id="L997" name="L997"></a> 997             <strong class="reserved">if</strong> (<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a> == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L998" name="L998"></a> 998             <strong class="reserved">final</strong> <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>&lt;E&gt; q = <strong class="reserved">this</strong>.queue;
<a id="L999" name="L999"></a> 999             <strong class="reserved">if</strong> (!exhausted &amp;&amp;
<a id="L1000" name="L1000"></a>1000                 ((p = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>) != <strong class="reserved">null</strong> || (p = q.<a href="../S/1114.html#L787" title="Defined at 787 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataNode</a>()) != <strong class="reserved">null</strong>)) <em class="brace">{</em>
<a id="L1001" name="L1001"></a>1001                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> e;
<a id="L1002" name="L1002"></a>1002                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1003" name="L1003"></a>1003                     <strong class="reserved">if</strong> ((e = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>) == p)
<a id="L1004" name="L1004"></a>1004                         e = <strong class="reserved">null</strong>;
<a id="L1005" name="L1005"></a>1005                     <strong class="reserved">if</strong> (p == (p = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>))
<a id="L1006" name="L1006"></a>1006                         p = q.<a href="../S/1114.html#L787" title="Defined at 787 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataNode</a>();
<a id="L1007" name="L1007"></a>1007                 <em class="brace">}</em> <strong class="reserved">while</strong> (e == <strong class="reserved">null</strong> &amp;&amp; p != <strong class="reserved">null</strong> &amp;&amp; p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>);
<a id="L1008" name="L1008"></a>1008                 <strong class="reserved">if</strong> ((<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = p) == <strong class="reserved">null</strong>)
<a id="L1009" name="L1009"></a>1009                     exhausted = <strong class="reserved">true</strong>;
<a id="L1010" name="L1010"></a>1010                 <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1011" name="L1011"></a>1011                     <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>.<a href="../D/10537.html" title="Multiple defined in 327 places.">accept</a>((E)e);
<a id="L1012" name="L1012"></a>1012                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1013" name="L1013"></a>1013                 <em class="brace">}</em>
<a id="L1014" name="L1014"></a>1014             <em class="brace">}</em>
<a id="L1015" name="L1015"></a>1015             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1016" name="L1016"></a>1016         <em class="brace">}</em>
<a id="L1017" name="L1017"></a>1017 
<a id="L1018" name="L1018"></a>1018         <strong class="reserved">public</strong> <strong class="reserved">long</strong> <a href="../R/14042.html" title="Multiple referred from 29 places.">estimateSize</a>() <em class="brace">{</em> <strong class="reserved">return</strong> <a href="../S/1720.html#L54" title="Defined at 54 in src/java/lang/Long.java.">Long</a>.MAX_VALUE; <em class="brace">}</em>
<a id="L1019" name="L1019"></a>1019 
<a id="L1020" name="L1020"></a>1020         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/11055.html" title="Multiple referred from 149 places.">characteristics</a>() <em class="brace">{</em>
<a id="L1021" name="L1021"></a>1021             <strong class="reserved">return</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.<a href="../S/915.html#L281" title="Defined at 281 in src/java/util/stream/StreamOpFlag.java.">ORDERED</a> | <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.NONNULL |
<a id="L1022" name="L1022"></a>1022                 <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.CONCURRENT;
<a id="L1023" name="L1023"></a>1023         <em class="brace">}</em>
<a id="L1024" name="L1024"></a>1024     <em class="brace">}</em>
<a id="L1025" name="L1025"></a>1025 
<div class="comment">
      Returns a <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a> over the elements in this queue.
      <p>The returned spliterator is
      <a href="package-summary.html#Weakly"><i>weakly consistent</i></a>.
      </p><p>The <code>Spliterator</code> reports {@link Spliterator#CONCURRENT},
      {@link Spliterator#ORDERED}, and {@link Spliterator#NONNULL}.
      @implNote
      The <code>Spliterator</code> implements <code>trySplit</code> to permit limited
      parallelism.
      @return a <code>Spliterator</code> over the elements in this queue
      @since 1.8</p></div>
<a id="L1042" name="L1042"></a>1042     <strong class="reserved">public</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E&gt; <a href="../R/28762.html" title="Multiple referred from 435 places.">spliterator</a>() <em class="brace">{</em>
<a id="L1043" name="L1043"></a>1043         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1114.html#L937" title="Defined at 937 in src/java/util/concurrent/LinkedTransferQueue.java.">LTQSpliterator</a>&lt;E&gt;(<strong class="reserved">this</strong>);
<a id="L1044" name="L1044"></a>1044     <em class="brace">}</em>
<a id="L1045" name="L1045"></a>1045 
<div class="comment">
     /* -------------- Removal methods -------------- */</div>
<a id="L1047" name="L1047"></a>1047 
<div class="comment">
      Unsplices (now or later) the given deleted/cancelled node with
      the given predecessor.
      @param pred a node that was at one time known to be the
      predecessor of s, or null or s itself if s is/was at head
      @param s the node to be unspliced</div>
<a id="L1056" name="L1056"></a>1056     <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/29785.html" title="Multiple referred from 3 places.">unsplice</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s) <em class="brace">{</em>
<a id="L1057" name="L1057"></a>1057         s.<a href="../S/1114.html#L493" title="Defined at 493 in src/java/util/concurrent/LinkedTransferQueue.java.">forgetContents</a>(); <em class="comment">// forget unneeded fields</em>
<div class="comment">
          See above for rationale. Briefly: if pred still points to
          s, try to unlink s.  If s cannot be unlinked, because it is
          trailing node or pred might be unlinked, and neither pred
          nor s are head or offlist, add to sweepVotes, and if enough
          votes have accumulated, sweep.</div>
<a id="L1065" name="L1065"></a>1065         <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != s &amp;&amp; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> == s) <em class="brace">{</em>
<a id="L1066" name="L1066"></a>1066             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> n = s.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1067" name="L1067"></a>1067             <strong class="reserved">if</strong> (n == <strong class="reserved">null</strong> ||
<a id="L1068" name="L1068"></a>1068                 (n != s &amp;&amp; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/12263.html" title="Multiple defined in 6 places.">casNext</a>(s, n) &amp;&amp; <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())) <em class="brace">{</em>
<a id="L1069" name="L1069"></a>1069                 <strong class="reserved">for</strong> (;;) <em class="brace">{</em>               <em class="comment">// check if at, or could be, head</em>
<a id="L1070" name="L1070"></a>1070                     <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L1071" name="L1071"></a>1071                     <strong class="reserved">if</strong> (h == <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> || h == s || h == <strong class="reserved">null</strong>)
<a id="L1072" name="L1072"></a>1072                         <strong class="reserved">return</strong>;          <em class="comment">// at head or list empty</em>
<a id="L1073" name="L1073"></a>1073                     <strong class="reserved">if</strong> (!h.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L1074" name="L1074"></a>1074                         <strong class="reserved">break</strong>;
<a id="L1075" name="L1075"></a>1075                     <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> hn = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1076" name="L1076"></a>1076                     <strong class="reserved">if</strong> (hn == <strong class="reserved">null</strong>)
<a id="L1077" name="L1077"></a>1077                         <strong class="reserved">return</strong>;          <em class="comment">// now empty</em>
<a id="L1078" name="L1078"></a>1078                     <strong class="reserved">if</strong> (hn != h &amp;&amp; <a href="../D/12261.html" title="Multiple defined in 5 places.">casHead</a>(h, hn))
<a id="L1079" name="L1079"></a>1079                         h.<a href="../S/1114.html#L480" title="Defined at 480 in src/java/util/concurrent/LinkedTransferQueue.java.">forgetNext</a>();  <em class="comment">// advance head</em>
<a id="L1080" name="L1080"></a>1080                 <em class="brace">}</em>
<a id="L1081" name="L1081"></a>1081                 <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> &amp;&amp; s.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != s) <em class="brace">{</em> <em class="comment">// recheck if offlist</em>
<a id="L1082" name="L1082"></a>1082                     <strong class="reserved">for</strong> (;;) <em class="brace">{</em>           <em class="comment">// sweep now if enough votes</em>
<a id="L1083" name="L1083"></a>1083                         <strong class="reserved">int</strong> v = sweepVotes;
<a id="L1084" name="L1084"></a>1084                         <strong class="reserved">if</strong> (v &lt; SWEEP_THRESHOLD) <em class="brace">{</em>
<a id="L1085" name="L1085"></a>1085                             <strong class="reserved">if</strong> (<a href="../S/1114.html#L579" title="Defined at 579 in src/java/util/concurrent/LinkedTransferQueue.java.">casSweepVotes</a>(v, v + 1))
<a id="L1086" name="L1086"></a>1086                                 <strong class="reserved">break</strong>;
<a id="L1087" name="L1087"></a>1087                         <em class="brace">}</em>
<a id="L1088" name="L1088"></a>1088                         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1114.html#L579" title="Defined at 579 in src/java/util/concurrent/LinkedTransferQueue.java.">casSweepVotes</a>(v, 0)) <em class="brace">{</em>
<a id="L1089" name="L1089"></a>1089                             <a href="../S/1114.html#L1102" title="Defined at 1102 in src/java/util/concurrent/LinkedTransferQueue.java.">sweep</a>();
<a id="L1090" name="L1090"></a>1090                             <strong class="reserved">break</strong>;
<a id="L1091" name="L1091"></a>1091                         <em class="brace">}</em>
<a id="L1092" name="L1092"></a>1092                     <em class="brace">}</em>
<a id="L1093" name="L1093"></a>1093                 <em class="brace">}</em>
<a id="L1094" name="L1094"></a>1094             <em class="brace">}</em>
<a id="L1095" name="L1095"></a>1095         <em class="brace">}</em>
<a id="L1096" name="L1096"></a>1096     <em class="brace">}</em>
<a id="L1097" name="L1097"></a>1097 
<div class="comment">
      Unlinks matched (typically cancelled) nodes encountered in a
      traversal from head.</div>
<a id="L1102" name="L1102"></a>1102     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/1114.html#L1089" title="Referred from 1089 in src/java/util/concurrent/LinkedTransferQueue.java.">sweep</a>() <em class="brace">{</em>
<a id="L1103" name="L1103"></a>1103         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head, s, n; p != <strong class="reserved">null</strong> &amp;&amp; (s = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong>; ) <em class="brace">{</em>
<a id="L1104" name="L1104"></a>1104             <strong class="reserved">if</strong> (!s.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L1105" name="L1105"></a>1105                 <em class="comment">// Unmatched nodes are never self-linked</em>
<a id="L1106" name="L1106"></a>1106                 p = s;
<a id="L1107" name="L1107"></a>1107             <strong class="reserved">else</strong> <strong class="reserved">if</strong> ((n = s.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong>) <em class="comment">// trailing node is pinned</em>
<a id="L1108" name="L1108"></a>1108                 <strong class="reserved">break</strong>;
<a id="L1109" name="L1109"></a>1109             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (s == n)    <em class="comment">// stale</em>
<a id="L1110" name="L1110"></a>1110                 <em class="comment">// No need to also check for p == s, since that implies s == n</em>
<a id="L1111" name="L1111"></a>1111                 p = head;
<a id="L1112" name="L1112"></a>1112             <strong class="reserved">else</strong>
<a id="L1113" name="L1113"></a>1113                 p.<a href="../D/12263.html" title="Multiple defined in 6 places.">casNext</a>(s, n);
<a id="L1114" name="L1114"></a>1114         <em class="brace">}</em>
<a id="L1115" name="L1115"></a>1115     <em class="brace">}</em>
<a id="L1116" name="L1116"></a>1116 
<div class="comment">
      Main implementation of remove(Object)</div>
<a id="L1120" name="L1120"></a>1120     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/1114.html#L1387" title="Referred from 1387 in src/java/util/concurrent/LinkedTransferQueue.java.">findAndRemove</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> e) <em class="brace">{</em>
<a id="L1121" name="L1121"></a>1121         <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1122" name="L1122"></a>1122             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <strong class="reserved">null</strong>, p = head; p != <strong class="reserved">null</strong>; ) <em class="brace">{</em>
<a id="L1123" name="L1123"></a>1123                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L1124" name="L1124"></a>1124                 <strong class="reserved">if</strong> (p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L1125" name="L1125"></a>1125                     <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != p &amp;&amp; e.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>) &amp;&amp;
<a id="L1126" name="L1126"></a>1126                         p.<a href="../S/1114.html#L528" title="Defined at 528 in src/java/util/concurrent/LinkedTransferQueue.java.">tryMatchData</a>()) <em class="brace">{</em>
<a id="L1127" name="L1127"></a>1127                         <a href="../S/1114.html#L1056" title="Defined at 1056 in src/java/util/concurrent/LinkedTransferQueue.java.">unsplice</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, p);
<a id="L1128" name="L1128"></a>1128                         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1129" name="L1129"></a>1129                     <em class="brace">}</em>
<a id="L1130" name="L1130"></a>1130                 <em class="brace">}</em>
<a id="L1131" name="L1131"></a>1131                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>)
<a id="L1132" name="L1132"></a>1132                     <strong class="reserved">break</strong>;
<a id="L1133" name="L1133"></a>1133                 <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = p;
<a id="L1134" name="L1134"></a>1134                 <strong class="reserved">if</strong> ((p = p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>) <em class="brace">{</em> <em class="comment">// stale</em>
<a id="L1135" name="L1135"></a>1135                     <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <strong class="reserved">null</strong>;
<a id="L1136" name="L1136"></a>1136                     p = head;
<a id="L1137" name="L1137"></a>1137                 <em class="brace">}</em>
<a id="L1138" name="L1138"></a>1138             <em class="brace">}</em>
<a id="L1139" name="L1139"></a>1139         <em class="brace">}</em>
<a id="L1140" name="L1140"></a>1140         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1141" name="L1141"></a>1141     <em class="brace">}</em>
<a id="L1142" name="L1142"></a>1142 
<div class="comment">
      Creates an initially empty <code>LinkedTransferQueue</code>.</div>
<a id="L1146" name="L1146"></a>1146     <strong class="reserved">public</strong> LinkedTransferQueue() <em class="brace">{</em>
<a id="L1147" name="L1147"></a>1147     <em class="brace">}</em>
<a id="L1148" name="L1148"></a>1148 
<div class="comment">
      Creates a <code>LinkedTransferQueue</code>
      initially containing the elements of the given collection,
      added in traversal order of the collection's iterator.
      @param c the collection of elements to initially contain
      @throws NullPointerException if the specified collection or any
              of its elements are null</div>
<a id="L1158" name="L1158"></a>1158     <strong class="reserved">public</strong> LinkedTransferQueue(<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;? <strong class="reserved">extends</strong> E&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L1159" name="L1159"></a>1159         <strong class="reserved">this</strong>();
<a id="L1160" name="L1160"></a>1160         <a href="../D/10646.html" title="Multiple defined in 78 places.">addAll</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L1161" name="L1161"></a>1161     <em class="brace">}</em>
<a id="L1162" name="L1162"></a>1162 
<div class="comment">
      Inserts the specified element at the tail of this queue.
      As the queue is unbounded, this method will never block.
      @throws NullPointerException if the specified element is null</div>
<a id="L1169" name="L1169"></a>1169     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/25285.html" title="Multiple referred from 5173 places.">put</a>(E e) <em class="brace">{</em>
<a id="L1170" name="L1170"></a>1170         <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, ASYNC, 0);
<a id="L1171" name="L1171"></a>1171     <em class="brace">}</em>
<a id="L1172" name="L1172"></a>1172 
<div class="comment">
      Inserts the specified element at the tail of this queue.
      As the queue is unbounded, this method will never block or
      return <code>false</code>.
      @return <code>true</code> (as specified by
       {@link java.util.concurrent.BlockingQueue#offer(Object,long,TimeUnit)
       BlockingQueue.offer})
      @throws NullPointerException if the specified element is null</div>
<a id="L1183" name="L1183"></a>1183     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/23932.html" title="Multiple referred from 17 places.">offer</a>(E e, <strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit) <em class="brace">{</em>
<a id="L1184" name="L1184"></a>1184         <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, ASYNC, 0);
<a id="L1185" name="L1185"></a>1185         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1186" name="L1186"></a>1186     <em class="brace">}</em>
<a id="L1187" name="L1187"></a>1187 
<div class="comment">
      Inserts the specified element at the tail of this queue.
      As the queue is unbounded, this method will never return <code>false</code>.
      @return <code>true</code> (as specified by {@link Queue#offer})
      @throws NullPointerException if the specified element is null</div>
<a id="L1195" name="L1195"></a>1195     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/23932.html" title="Multiple referred from 17 places.">offer</a>(E e) <em class="brace">{</em>
<a id="L1196" name="L1196"></a>1196         <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, ASYNC, 0);
<a id="L1197" name="L1197"></a>1197         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1198" name="L1198"></a>1198     <em class="brace">}</em>
<a id="L1199" name="L1199"></a>1199 
<div class="comment">
      Inserts the specified element at the tail of this queue.
      As the queue is unbounded, this method will never throw
      <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a> or return <code>false</code>.
      @return <code>true</code> (as specified by {@link Collection#add})
      @throws NullPointerException if the specified element is null</div>
<a id="L1208" name="L1208"></a>1208     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/9592.html" title="Multiple referred from 2612 places.">add</a>(E e) <em class="brace">{</em>
<a id="L1209" name="L1209"></a>1209         <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, ASYNC, 0);
<a id="L1210" name="L1210"></a>1210         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1211" name="L1211"></a>1211     <em class="brace">}</em>
<a id="L1212" name="L1212"></a>1212 
<div class="comment">
      Transfers the element to a waiting consumer immediately, if possible.
      <p>More precisely, transfers the specified element immediately
      if there exists a consumer already waiting to receive it (in
      <a href="#L1268" title="Defined at 1268.">take</a> or timed {@link #poll(long,TimeUnit) poll}),
      otherwise returning <code>false</code> without enqueuing the element.
      @throws NullPointerException if the specified element is null</p></div>
<a id="L1223" name="L1223"></a>1223     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> tryTransfer(E e) <em class="brace">{</em>
<a id="L1224" name="L1224"></a>1224         <strong class="reserved">return</strong> <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, NOW, 0) == <strong class="reserved">null</strong>;
<a id="L1225" name="L1225"></a>1225     <em class="brace">}</em>
<a id="L1226" name="L1226"></a>1226 
<div class="comment">
      Transfers the element to a consumer, waiting if necessary to do so.
      <p>More precisely, transfers the specified element immediately
      if there exists a consumer already waiting to receive it (in
      <a href="#L1268" title="Defined at 1268.">take</a> or timed {@link #poll(long,TimeUnit) poll}),
      else inserts the specified element at the tail of this queue
      and waits until the element is received by a consumer.
      @throws NullPointerException if the specified element is null</p></div>
<a id="L1238" name="L1238"></a>1238     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/29413.html" title="Multiple referred from 15 places.">transfer</a>(E e) <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1239" name="L1239"></a>1239         <strong class="reserved">if</strong> (<a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, SYNC, 0) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1240" name="L1240"></a>1240             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>(); <em class="comment">// failure possible only due to interrupt</em>
<a id="L1241" name="L1241"></a>1241             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1242" name="L1242"></a>1242         <em class="brace">}</em>
<a id="L1243" name="L1243"></a>1243     <em class="brace">}</em>
<a id="L1244" name="L1244"></a>1244 
<div class="comment">
      Transfers the element to a consumer if it is possible to do so
      before the timeout elapses.
      <p>More precisely, transfers the specified element immediately
      if there exists a consumer already waiting to receive it (in
      <a href="#L1268" title="Defined at 1268.">take</a> or timed {@link #poll(long,TimeUnit) poll}),
      else inserts the specified element at the tail of this queue
      and waits until the element is received by a consumer,
      returning <code>false</code> if the specified wait time elapses
      before the element can be transferred.
      @throws NullPointerException if the specified element is null</p></div>
<a id="L1259" name="L1259"></a>1259     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> tryTransfer(E e, <strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L1260" name="L1260"></a>1260         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1261" name="L1261"></a>1261         <strong class="reserved">if</strong> (<a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(e, <strong class="reserved">true</strong>, TIMED, unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout)) == <strong class="reserved">null</strong>)
<a id="L1262" name="L1262"></a>1262             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1263" name="L1263"></a>1263         <strong class="reserved">if</strong> (!<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1264" name="L1264"></a>1264             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1265" name="L1265"></a>1265         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1266" name="L1266"></a>1266     <em class="brace">}</em>
<a id="L1267" name="L1267"></a>1267 
<a id="L1268" name="L1268"></a>1268     <strong class="reserved">public</strong> E <a href="../R/29108.html" title="Multiple referred from 11 places.">take</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1269" name="L1269"></a>1269         E e = <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(<strong class="reserved">null</strong>, <strong class="reserved">false</strong>, SYNC, 0);
<a id="L1270" name="L1270"></a>1270         <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong>)
<a id="L1271" name="L1271"></a>1271             <strong class="reserved">return</strong> e;
<a id="L1272" name="L1272"></a>1272         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>();
<a id="L1273" name="L1273"></a>1273         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1274" name="L1274"></a>1274     <em class="brace">}</em>
<a id="L1275" name="L1275"></a>1275 
<a id="L1276" name="L1276"></a>1276     <strong class="reserved">public</strong> E <a href="../R/24795.html" title="Multiple referred from 51 places.">poll</a>(<strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit) <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1277" name="L1277"></a>1277         E e = <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(<strong class="reserved">null</strong>, <strong class="reserved">false</strong>, TIMED, unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout));
<a id="L1278" name="L1278"></a>1278         <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong> || !<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1279" name="L1279"></a>1279             <strong class="reserved">return</strong> e;
<a id="L1280" name="L1280"></a>1280         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1281" name="L1281"></a>1281     <em class="brace">}</em>
<a id="L1282" name="L1282"></a>1282 
<a id="L1283" name="L1283"></a>1283     <strong class="reserved">public</strong> E <a href="../R/24795.html" title="Multiple referred from 51 places.">poll</a>() <em class="brace">{</em>
<a id="L1284" name="L1284"></a>1284         <strong class="reserved">return</strong> <a href="../S/1114.html#L607" title="Defined at 607 in src/java/util/concurrent/LinkedTransferQueue.java.">xfer</a>(<strong class="reserved">null</strong>, <strong class="reserved">false</strong>, NOW, 0);
<a id="L1285" name="L1285"></a>1285     <em class="brace">}</em>
<a id="L1286" name="L1286"></a>1286 
<div class="comment">
      @throws NullPointerException     {@inheritDoc}
      @throws IllegalArgumentException {@inheritDoc}</div>
<a id="L1291" name="L1291"></a>1291     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/13516.html" title="Multiple referred from 5 places.">drainTo</a>(<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;? <strong class="reserved">super</strong> E&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>) <em class="brace">{</em>
<a id="L1292" name="L1292"></a>1292         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == <strong class="reserved">null</strong>)
<a id="L1293" name="L1293"></a>1293             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1294" name="L1294"></a>1294         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == <strong class="reserved">this</strong>)
<a id="L1295" name="L1295"></a>1295             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>();
<a id="L1296" name="L1296"></a>1296         <strong class="reserved">int</strong> n = 0;
<a id="L1297" name="L1297"></a>1297         <strong class="reserved">for</strong> (E e; (e = <a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>()) != <strong class="reserved">null</strong>;) <em class="brace">{</em>
<a id="L1298" name="L1298"></a>1298             <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(e);
<a id="L1299" name="L1299"></a>1299             ++n;
<a id="L1300" name="L1300"></a>1300         <em class="brace">}</em>
<a id="L1301" name="L1301"></a>1301         <strong class="reserved">return</strong> n;
<a id="L1302" name="L1302"></a>1302     <em class="brace">}</em>
<a id="L1303" name="L1303"></a>1303 
<div class="comment">
      @throws NullPointerException     {@inheritDoc}
      @throws IllegalArgumentException {@inheritDoc}</div>
<a id="L1308" name="L1308"></a>1308     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/13516.html" title="Multiple referred from 5 places.">drainTo</a>(<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;? <strong class="reserved">super</strong> E&gt; <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>, <strong class="reserved">int</strong> maxElements) <em class="brace">{</em>
<a id="L1309" name="L1309"></a>1309         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == <strong class="reserved">null</strong>)
<a id="L1310" name="L1310"></a>1310             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1311" name="L1311"></a>1311         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> == <strong class="reserved">this</strong>)
<a id="L1312" name="L1312"></a>1312             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>();
<a id="L1313" name="L1313"></a>1313         <strong class="reserved">int</strong> n = 0;
<a id="L1314" name="L1314"></a>1314         <strong class="reserved">for</strong> (E e; n &lt; maxElements &amp;&amp; (e = <a href="../D/29402.html" title="Multiple defined in 36 places.">poll</a>()) != <strong class="reserved">null</strong>;) <em class="brace">{</em>
<a id="L1315" name="L1315"></a>1315             <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(e);
<a id="L1316" name="L1316"></a>1316             ++n;
<a id="L1317" name="L1317"></a>1317         <em class="brace">}</em>
<a id="L1318" name="L1318"></a>1318         <strong class="reserved">return</strong> n;
<a id="L1319" name="L1319"></a>1319     <em class="brace">}</em>
<a id="L1320" name="L1320"></a>1320 
<div class="comment">
      Returns an iterator over the elements in this queue in proper sequence.
      The elements will be returned in order from first (head) to last (tail).
      <p>The returned iterator is
      <a href="package-summary.html#Weakly"><i>weakly consistent</i></a>.
      @return an iterator over the elements in this queue in proper sequence</p></div>
<a id="L1330" name="L1330"></a>1330     <strong class="reserved">public</strong> <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a>&lt;E&gt; <a href="../R/22304.html" title="Multiple referred from 905 places.">iterator</a>() <em class="brace">{</em>
<a id="L1331" name="L1331"></a>1331         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../D/4466.html" title="Multiple defined in 13 places.">Itr</a>();
<a id="L1332" name="L1332"></a>1332     <em class="brace">}</em>
<a id="L1333" name="L1333"></a>1333 
<a id="L1334" name="L1334"></a>1334     <strong class="reserved">public</strong> E <a href="../R/24689.html" title="Multiple referred from 168 places.">peek</a>() <em class="brace">{</em>
<a id="L1335" name="L1335"></a>1335         <strong class="reserved">return</strong> <a href="../S/1114.html#L806" title="Defined at 806 in src/java/util/concurrent/LinkedTransferQueue.java.">firstDataItem</a>();
<a id="L1336" name="L1336"></a>1336     <em class="brace">}</em>
<a id="L1337" name="L1337"></a>1337 
<div class="comment">
      Returns <code>true</code> if this queue contains no elements.
      @return <code>true</code> if this queue contains no elements</div>
<a id="L1343" name="L1343"></a>1343     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/21404.html" title="Multiple referred from 435 places.">isEmpty</a>() <em class="brace">{</em>
<a id="L1344" name="L1344"></a>1344         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head; p != <strong class="reserved">null</strong>; p = <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>(p)) <em class="brace">{</em>
<a id="L1345" name="L1345"></a>1345             <strong class="reserved">if</strong> (!p.<a href="../D/25863.html" title="Multiple defined in 3 places.">isMatched</a>())
<a id="L1346" name="L1346"></a>1346                 <strong class="reserved">return</strong> !p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>;
<a id="L1347" name="L1347"></a>1347         <em class="brace">}</em>
<a id="L1348" name="L1348"></a>1348         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1349" name="L1349"></a>1349     <em class="brace">}</em>
<a id="L1350" name="L1350"></a>1350 
<a id="L1351" name="L1351"></a>1351     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> hasWaitingConsumer() <em class="brace">{</em>
<a id="L1352" name="L1352"></a>1352         <strong class="reserved">return</strong> <a href="../S/1114.html#L774" title="Defined at 774 in src/java/util/concurrent/LinkedTransferQueue.java.">firstOfMode</a>(<strong class="reserved">false</strong>) != <strong class="reserved">null</strong>;
<a id="L1353" name="L1353"></a>1353     <em class="brace">}</em>
<a id="L1354" name="L1354"></a>1354 
<div class="comment">
      Returns the number of elements in this queue.  If this queue
      contains more than <code>Integer.MAX_VALUE</code> elements, returns
      <code>Integer.MAX_VALUE</code>.
      <p>Beware that, unlike in most collections, this method is
      <em>NOT</em> a constant-time operation. Because of the
      asynchronous nature of these queues, determining the current
      number of elements requires an O(n) traversal.
      @return the number of elements in this queue</p></div>
<a id="L1367" name="L1367"></a>1367     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/28639.html" title="Multiple referred from 5617 places.">size</a>() <em class="brace">{</em>
<a id="L1368" name="L1368"></a>1368         <strong class="reserved">return</strong> <a href="../S/1114.html#L823" title="Defined at 823 in src/java/util/concurrent/LinkedTransferQueue.java.">countOfMode</a>(<strong class="reserved">true</strong>);
<a id="L1369" name="L1369"></a>1369     <em class="brace">}</em>
<a id="L1370" name="L1370"></a>1370 
<a id="L1371" name="L1371"></a>1371     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getWaitingConsumerCount() <em class="brace">{</em>
<a id="L1372" name="L1372"></a>1372         <strong class="reserved">return</strong> <a href="../S/1114.html#L823" title="Defined at 823 in src/java/util/concurrent/LinkedTransferQueue.java.">countOfMode</a>(<strong class="reserved">false</strong>);
<a id="L1373" name="L1373"></a>1373     <em class="brace">}</em>
<a id="L1374" name="L1374"></a>1374 
<div class="comment">
      Removes a single instance of the specified element from this queue,
      if it is present.  More formally, removes an element <code>e</code> such
      that <code>o.equals(e)</code>, if this queue contains one or more such
      elements.
      Returns <code>true</code> if this queue contained the specified element
      (or equivalently, if this queue changed as a result of the call).
      @param o element to be removed from this queue, if present
      @return <code>true</code> if this queue changed as a result of the call</div>
<a id="L1386" name="L1386"></a>1386     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/25882.html" title="Multiple referred from 1115 places.">remove</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>) <em class="brace">{</em>
<a id="L1387" name="L1387"></a>1387         <strong class="reserved">return</strong> <a href="../S/1114.html#L1120" title="Defined at 1120 in src/java/util/concurrent/LinkedTransferQueue.java.">findAndRemove</a>(<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>);
<a id="L1388" name="L1388"></a>1388     <em class="brace">}</em>
<a id="L1389" name="L1389"></a>1389 
<div class="comment">
      Returns <code>true</code> if this queue contains the specified element.
      More formally, returns <code>true</code> if and only if this queue contains
      at least one element <code>e</code> such that <code>o.equals(e)</code>.
      @param o object to be checked for containment in this queue
      @return <code>true</code> if this queue contains the specified element</div>
<a id="L1398" name="L1398"></a>1398     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/11949.html" title="Multiple referred from 682 places.">contains</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>) <em class="brace">{</em>
<a id="L1399" name="L1399"></a>1399         <strong class="reserved">if</strong> (<a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> == <strong class="reserved">null</strong>) <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1400" name="L1400"></a>1400         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = head; p != <strong class="reserved">null</strong>; p = <a href="../D/35024.html" title="Multiple defined in 4 places.">succ</a>(p)) <em class="brace">{</em>
<a id="L1401" name="L1401"></a>1401             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = p.<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>;
<a id="L1402" name="L1402"></a>1402             <strong class="reserved">if</strong> (p.<a href="../S/5170.html#L95" title="Defined at 95 in src/com/sun/org/apache/xerces/internal/impl/dv/util/Base64.java.">isData</a>) <em class="brace">{</em>
<a id="L1403" name="L1403"></a>1403                 <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> != p &amp;&amp; <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>))
<a id="L1404" name="L1404"></a>1404                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1405" name="L1405"></a>1405             <em class="brace">}</em>
<a id="L1406" name="L1406"></a>1406             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>)
<a id="L1407" name="L1407"></a>1407                 <strong class="reserved">break</strong>;
<a id="L1408" name="L1408"></a>1408         <em class="brace">}</em>
<a id="L1409" name="L1409"></a>1409         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1410" name="L1410"></a>1410     <em class="brace">}</em>
<a id="L1411" name="L1411"></a>1411 
<div class="comment">
      Always returns <code>Integer.MAX_VALUE</code> because a
      <code>LinkedTransferQueue</code> is not capacity constrained.
      @return <code>Integer.MAX_VALUE</code> (as specified by
              {@link java.util.concurrent.BlockingQueue#remainingCapacity()
              BlockingQueue.remainingCapacity})</div>
<a id="L1420" name="L1420"></a>1420     <strong class="reserved">public</strong> <strong class="reserved">int</strong> remainingCapacity() <em class="brace">{</em>
<a id="L1421" name="L1421"></a>1421         <strong class="reserved">return</strong> <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.MAX_VALUE;
<a id="L1422" name="L1422"></a>1422     <em class="brace">}</em>
<a id="L1423" name="L1423"></a>1423 
<div class="comment">
      Saves this queue to a stream (that is, serializes it).
      @param s the stream
      @throws java.io.IOException if an I/O error occurs
      @serialData All of the elements (each an <code>E</code>) in
      the proper order, followed by a null</div>
<a id="L1432" name="L1432"></a>1432     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/30680.html" title="Multiple referred from 184 places.">writeObject</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1381.html#L162" title="Defined at 162 in src/java/io/ObjectOutputStream.java.">ObjectOutputStream</a> s)
<a id="L1433" name="L1433"></a>1433         <strong class="reserved">throws</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L1434" name="L1434"></a>1434         s.<a href="../D/14752.html" title="Multiple defined in 6 places.">defaultWriteObject</a>();
<a id="L1435" name="L1435"></a>1435         <strong class="reserved">for</strong> (E e : <strong class="reserved">this</strong>)
<a id="L1436" name="L1436"></a>1436             s.<a href="../D/37124.html" title="Multiple defined in 263 places.">writeObject</a>(e);
<a id="L1437" name="L1437"></a>1437         <em class="comment">// Use trailing null as sentinel</em>
<a id="L1438" name="L1438"></a>1438         s.<a href="../D/37124.html" title="Multiple defined in 263 places.">writeObject</a>(<strong class="reserved">null</strong>);
<a id="L1439" name="L1439"></a>1439     <em class="brace">}</em>
<a id="L1440" name="L1440"></a>1440 
<div class="comment">
      Reconstitutes this queue from a stream (that is, deserializes it).
      @param s the stream
      @throws ClassNotFoundException if the class of a serialized object
              could not be found
      @throws java.io.IOException if an I/O error occurs</div>
<a id="L1448" name="L1448"></a>1448     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25518.html" title="Multiple referred from 189 places.">readObject</a>(<a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1378.html#L206" title="Defined at 206 in src/java/io/ObjectInputStream.java.">ObjectInputStream</a> s)
<a id="L1449" name="L1449"></a>1449         <strong class="reserved">throws</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/1705.html#L53" title="Defined at 53 in src/java/lang/ClassNotFoundException.java.">ClassNotFoundException</a> <em class="brace">{</em>
<a id="L1450" name="L1450"></a>1450         s.<a href="../D/14746.html" title="Multiple defined in 2 places.">defaultReadObject</a>();
<a id="L1451" name="L1451"></a>1451         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L1452" name="L1452"></a>1452             @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L1453" name="L1453"></a>1453             E <a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> = (E) s.<a href="../D/30232.html" title="Multiple defined in 322 places.">readObject</a>();
<a id="L1454" name="L1454"></a>1454             <strong class="reserved">if</strong> (<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a> == <strong class="reserved">null</strong>)
<a id="L1455" name="L1455"></a>1455                 <strong class="reserved">break</strong>;
<a id="L1456" name="L1456"></a>1456             <strong class="reserved">else</strong>
<a id="L1457" name="L1457"></a>1457                 <a href="../D/28469.html" title="Multiple defined in 29 places.">offer</a>(<a href="../D/26564.html" title="Multiple defined in 60 places.">item</a>);
<a id="L1458" name="L1458"></a>1458         <em class="brace">}</em>
<a id="L1459" name="L1459"></a>1459     <em class="brace">}</em>
<a id="L1460" name="L1460"></a>1460 
<a id="L1461" name="L1461"></a>1461     <em class="comment">// Unsafe mechanics</em>
<a id="L1462" name="L1462"></a>1462 
<a id="L1463" name="L1463"></a>1463     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> sun.misc.Unsafe UNSAFE;
<a id="L1464" name="L1464"></a>1464     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> headOffset;
<a id="L1465" name="L1465"></a>1465     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> tailOffset;
<a id="L1466" name="L1466"></a>1466     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> sweepVotesOffset;
<a id="L1467" name="L1467"></a>1467     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L1468" name="L1468"></a>1468         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1469" name="L1469"></a>1469             UNSAFE = sun.misc.Unsafe.getUnsafe();
<a id="L1470" name="L1470"></a>1470             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; k = <a href="../S/1114.html#L88" title="Defined at 88 in src/java/util/concurrent/LinkedTransferQueue.java.">LinkedTransferQueue</a>.<strong class="reserved">class</strong>;
<a id="L1471" name="L1471"></a>1471             headOffset = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1472" name="L1472"></a>1472                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("head"));
<a id="L1473" name="L1473"></a>1473             tailOffset = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1474" name="L1474"></a>1474                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("tail"));
<a id="L1475" name="L1475"></a>1475             sweepVotesOffset = UNSAFE.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L1476" name="L1476"></a>1476                 (k.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("sweepVotes"));
<a id="L1477" name="L1477"></a>1477         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> e) <em class="brace">{</em>
<a id="L1478" name="L1478"></a>1478             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(e);
<a id="L1479" name="L1479"></a>1479         <em class="brace">}</em>
<a id="L1480" name="L1480"></a>1480     <em class="brace">}</em>
<a id="L1481" name="L1481"></a>1481 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L458">[^]</a><a href="#L1448">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>