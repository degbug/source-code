<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/CyclicBarrier.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L177">[^]</a><a href="#L482">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L177" title="Defined at 177.">nextGeneration</a></li>
<li><a href="#L189" title="Defined at 189.">breakBarrier</a></li>
<li><a href="#L198" title="Defined at 198.">dowait</a></li>
<li><a href="#L302" title="Defined at 302.">getParties</a></li>
<li><a href="#L360" title="Defined at 360.">await</a></li>
<li><a href="#L431" title="Defined at 431.">await</a></li>
<li><a href="#L446" title="Defined at 446.">isBroken</a></li>
<li><a href="#L465" title="Defined at 465.">reset</a></li>
<li><a href="#L482" title="Defined at 482.">getNumberWaiting</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.concurrent.locks.Condition;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.concurrent.locks.ReentrantLock;
<a id="L39" name="L39"></a>  39 
<div class="comment">
  A synchronization aid that allows a set of threads to all wait for
  each other to reach a common barrier point.  CyclicBarriers are
  useful in programs involving a fixed sized party of threads that
  must occasionally wait for each other. The barrier is called
  <em>cyclic</em> because it can be re-used after the waiting threads
  are released.
  <p>A <code>CyclicBarrier</code> supports an optional <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> command
  that is run once per barrier point, after the last thread in the party
  arrives, but before any threads are released.
  This <em>barrier action</em> is useful
  for updating shared-state before any of the parties continue.
  </p><p><b>Sample usage:</b> Here is an example of using a barrier in a
  parallel decomposition design:
   </p><pre> {@code
  class Solver {
    final int N;
    final float[][] data;
    final CyclicBarrier barrier;
    class Worker implements Runnable {
      int myRow;
      Worker(int row) { myRow = row; }
      public void run() {
        while (!done()) {
          processRow(myRow);
          try {
            barrier.await();
          } catch (InterruptedException ex) {
            return;
          } catch (BrokenBarrierException ex) {
            return;
          }
        }
      }
    }
    public Solver(float[][] matrix) {
      data = matrix;
      N = matrix.length;
      Runnable barrierAction =
        new Runnable() { public void run() { mergeRows(...); }};
      barrier = new CyclicBarrier(N, barrierAction);
      List<thread> threads = new ArrayList<thread>(N);
      for (int i = 0; i &lt; N; i++) {
        Thread thread = new Thread(new Worker(i));
        threads.add(thread);
        thread.start();
      }
      // wait until done
      for (Thread thread : threads)
        thread.join();
    }
  }}</thread></thread></pre>
  Here, each worker thread processes a row of the matrix then waits at the
  barrier until all rows have been processed. When all rows are processed
  the supplied <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> barrier action is executed and merges the
  rows. If the merger
  determines that a solution has been found then <code>done()</code> will return
  <code>true</code> and each worker will terminate.
  <p>If the barrier action does not rely on the parties being suspended when
  it is executed, then any of the threads in the party could execute that
  action when it is released. To facilitate this, each invocation of
  <a href="#L360" title="Defined at 360.">await</a> returns the arrival index of that thread at the barrier.
  You can then choose which thread should execute the barrier action, for
  example:
   </p><pre> {@code
  if (barrier.await() == 0) {
    // log the completion of this iteration
  }}</pre>
  <p>The <code>CyclicBarrier</code> uses an all-or-none breakage model
  for failed synchronization attempts: If a thread leaves a barrier
  point prematurely because of interruption, failure, or timeout, all
  other threads waiting at that barrier point will also leave
  abnormally via <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a> (or
  <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> if they too were interrupted at about
  the same time).
  </p><p>Memory consistency effects: Actions in a thread prior to calling
  <code>await()</code>
  <a href="package-summary.html#MemoryVisibility"><i>happen-before</i></a>
  actions that are part of the barrier action, which in turn
  <i>happen-before</i> actions following a successful return from the
  corresponding <code>await()</code> in other threads.
  @since 1.5
  @see CountDownLatch
  @author Doug Lea</p></div>
<a id="L139" name="L139"></a> 139 <strong class="reserved">public</strong> <strong class="reserved">class</strong> CyclicBarrier <em class="brace">{</em>
<div class="comment">
      Each use of the barrier is represented as a generation instance.
      The generation changes whenever the barrier is tripped, or
      is reset. There can be many generations associated with threads
      using the barrier - due to the non-deterministic way the lock
      may be allocated to waiting threads - but only one of these
      can be active at a time (the one to which <code>count</code> applies)
      and all the rest are either broken or tripped.
      There need not be an active generation if there has been a break
      but no subsequent reset.</div>
<a id="L151" name="L151"></a> 151     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/3251.html" title="Multiple referred from 3 places.">Generation</a> <em class="brace">{</em>
<a id="L152" name="L152"></a> 152         <strong class="reserved">boolean</strong> broken = <strong class="reserved">false</strong>;
<a id="L153" name="L153"></a> 153     <em class="brace">}</em>
<a id="L154" name="L154"></a> 154 
<div class="comment">
     /** The lock for guarding barrier entry */</div>
<a id="L156" name="L156"></a> 156     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1047.html#L106" title="Defined at 106 in src/java/util/concurrent/locks/ReentrantLock.java.">ReentrantLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = <strong class="reserved">new</strong> <a href="../S/1047.html#L106" title="Defined at 106 in src/java/util/concurrent/locks/ReentrantLock.java.">ReentrantLock</a>();
<div class="comment">
     /** Condition to wait on until tripped */</div>
<a id="L158" name="L158"></a> 158     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a> <a href="../D/35702.html" title="Multiple defined in 2 places.">trip</a> = <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/27977.html" title="Multiple defined in 8 places.">newCondition</a>();
<div class="comment">
     /** The number of parties */</div>
<a id="L160" name="L160"></a> 160     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> parties;
<div class="comment">
     /* The command to run when tripped */</div>
<a id="L162" name="L162"></a> 162     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> barrierCommand;
<div class="comment">
     /** The current generation */</div>
<a id="L164" name="L164"></a> 164     <strong class="reserved">private</strong> <a href="../S/1066.html#L151" title="Defined at 151 in src/java/util/concurrent/CyclicBarrier.java.">Generation</a> generation = <strong class="reserved">new</strong> <a href="../S/1066.html#L151" title="Defined at 151 in src/java/util/concurrent/CyclicBarrier.java.">Generation</a>();
<a id="L165" name="L165"></a> 165 
<div class="comment">
      Number of parties still waiting. Counts down from parties to 0
      on each generation.  It is reset to parties on each new
      generation or when broken.</div>
<a id="L171" name="L171"></a> 171     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L172" name="L172"></a> 172 
<div class="comment">
      Updates state on barrier trip and wakes up everyone.
      Called only while holding lock.</div>
<a id="L177" name="L177"></a> 177     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/23667.html" title="Multiple referred from 2 places.">nextGeneration</a>() <em class="brace">{</em>
<a id="L178" name="L178"></a> 178         <em class="comment">// signal completion of last generation</em>
<a id="L179" name="L179"></a> 179         <a href="../D/35702.html" title="Multiple defined in 2 places.">trip</a>.<a href="../D/34559.html" title="Multiple defined in 3 places.">signalAll</a>();
<a id="L180" name="L180"></a> 180         <em class="comment">// set up next generation</em>
<a id="L181" name="L181"></a> 181         <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = parties;
<a id="L182" name="L182"></a> 182         generation = <strong class="reserved">new</strong> <a href="../S/1066.html#L151" title="Defined at 151 in src/java/util/concurrent/CyclicBarrier.java.">Generation</a>();
<a id="L183" name="L183"></a> 183     <em class="brace">}</em>
<a id="L184" name="L184"></a> 184 
<div class="comment">
      Sets current barrier generation as broken and wakes up everyone.
      Called only while holding lock.</div>
<a id="L189" name="L189"></a> 189     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10667.html" title="Multiple referred from 5 places.">breakBarrier</a>() <em class="brace">{</em>
<a id="L190" name="L190"></a> 190         generation.broken = <strong class="reserved">true</strong>;
<a id="L191" name="L191"></a> 191         <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = parties;
<a id="L192" name="L192"></a> 192         <a href="../D/35702.html" title="Multiple defined in 2 places.">trip</a>.<a href="../D/34559.html" title="Multiple defined in 3 places.">signalAll</a>();
<a id="L193" name="L193"></a> 193     <em class="brace">}</em>
<a id="L194" name="L194"></a> 194 
<div class="comment">
      Main barrier code, covering the various policies.</div>
<a id="L198" name="L198"></a> 198     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/13494.html" title="Multiple referred from 2 places.">dowait</a>(<strong class="reserved">boolean</strong> timed, <strong class="reserved">long</strong> nanos)
<a id="L199" name="L199"></a> 199         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>, <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a>,
<a id="L200" name="L200"></a> 200                <a href="../D/8986.html" title="Multiple defined in 2 places.">TimeoutException</a> <em class="brace">{</em>
<a id="L201" name="L201"></a> 201         <strong class="reserved">final</strong> <a href="../S/1047.html#L106" title="Defined at 106 in src/java/util/concurrent/locks/ReentrantLock.java.">ReentrantLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = <strong class="reserved">this</strong>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>;
<a id="L202" name="L202"></a> 202         <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>();
<a id="L203" name="L203"></a> 203         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L204" name="L204"></a> 204             <strong class="reserved">final</strong> <a href="../S/1066.html#L151" title="Defined at 151 in src/java/util/concurrent/CyclicBarrier.java.">Generation</a> g = generation;
<a id="L205" name="L205"></a> 205 
<a id="L206" name="L206"></a> 206             <strong class="reserved">if</strong> (g.broken)
<a id="L207" name="L207"></a> 207                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a>();
<a id="L208" name="L208"></a> 208 
<a id="L209" name="L209"></a> 209             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>()) <em class="brace">{</em>
<a id="L210" name="L210"></a> 210                 <a href="../S/1066.html#L189" title="Defined at 189 in src/java/util/concurrent/CyclicBarrier.java.">breakBarrier</a>();
<a id="L211" name="L211"></a> 211                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L212" name="L212"></a> 212             <em class="brace">}</em>
<a id="L213" name="L213"></a> 213 
<a id="L214" name="L214"></a> 214             <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = --<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L215" name="L215"></a> 215             <strong class="reserved">if</strong> (<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> == 0) <em class="brace">{</em>  <em class="comment">// tripped</em>
<a id="L216" name="L216"></a> 216                 <strong class="reserved">boolean</strong> ranAction = <strong class="reserved">false</strong>;
<a id="L217" name="L217"></a> 217                 <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L218" name="L218"></a> 218                     <strong class="reserved">final</strong> <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> <a href="../D/13010.html" title="Multiple defined in 4 places.">command</a> = barrierCommand;
<a id="L219" name="L219"></a> 219                     <strong class="reserved">if</strong> (<a href="../D/13010.html" title="Multiple defined in 4 places.">command</a> != <strong class="reserved">null</strong>)
<a id="L220" name="L220"></a> 220                         <a href="../D/13010.html" title="Multiple defined in 4 places.">command</a>.<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>();
<a id="L221" name="L221"></a> 221                     ranAction = <strong class="reserved">true</strong>;
<a id="L222" name="L222"></a> 222                     <a href="../S/1066.html#L177" title="Defined at 177 in src/java/util/concurrent/CyclicBarrier.java.">nextGeneration</a>();
<a id="L223" name="L223"></a> 223                     <strong class="reserved">return</strong> 0;
<a id="L224" name="L224"></a> 224                 <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L225" name="L225"></a> 225                     <strong class="reserved">if</strong> (!ranAction)
<a id="L226" name="L226"></a> 226                         <a href="../S/1066.html#L189" title="Defined at 189 in src/java/util/concurrent/CyclicBarrier.java.">breakBarrier</a>();
<a id="L227" name="L227"></a> 227                 <em class="brace">}</em>
<a id="L228" name="L228"></a> 228             <em class="brace">}</em>
<a id="L229" name="L229"></a> 229 
<a id="L230" name="L230"></a> 230             <em class="comment">// loop until tripped, broken, interrupted, or timed out</em>
<a id="L231" name="L231"></a> 231             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L232" name="L232"></a> 232                 <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L233" name="L233"></a> 233                     <strong class="reserved">if</strong> (!timed)
<a id="L234" name="L234"></a> 234                         <a href="../D/35702.html" title="Multiple defined in 2 places.">trip</a>.<a href="../D/11670.html" title="Multiple defined in 11 places.">await</a>();
<a id="L235" name="L235"></a> 235                     <strong class="reserved">else</strong> <strong class="reserved">if</strong> (nanos &gt; 0L)
<a id="L236" name="L236"></a> 236                         nanos = <a href="../D/35702.html" title="Multiple defined in 2 places.">trip</a>.<a href="../D/11677.html" title="Multiple defined in 3 places.">awaitNanos</a>(nanos);
<a id="L237" name="L237"></a> 237                 <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> ie) <em class="brace">{</em>
<a id="L238" name="L238"></a> 238                     <strong class="reserved">if</strong> (g == generation &amp;&amp; ! g.broken) <em class="brace">{</em>
<a id="L239" name="L239"></a> 239                         <a href="../S/1066.html#L189" title="Defined at 189 in src/java/util/concurrent/CyclicBarrier.java.">breakBarrier</a>();
<a id="L240" name="L240"></a> 240                         <strong class="reserved">throw</strong> ie;
<a id="L241" name="L241"></a> 241                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L242" name="L242"></a> 242                         <em class="comment">// We're about to finish waiting even if we had not</em>
<a id="L243" name="L243"></a> 243                         <em class="comment">// been interrupted, so this interrupt is deemed to</em>
<a id="L244" name="L244"></a> 244                         <em class="comment">// "belong" to subsequent execution.</em>
<a id="L245" name="L245"></a> 245                         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>().<a href="../D/24969.html" title="Multiple defined in 3 places.">interrupt</a>();
<a id="L246" name="L246"></a> 246                     <em class="brace">}</em>
<a id="L247" name="L247"></a> 247                 <em class="brace">}</em>
<a id="L248" name="L248"></a> 248 
<a id="L249" name="L249"></a> 249                 <strong class="reserved">if</strong> (g.broken)
<a id="L250" name="L250"></a> 250                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a>();
<a id="L251" name="L251"></a> 251 
<a id="L252" name="L252"></a> 252                 <strong class="reserved">if</strong> (g != generation)
<a id="L253" name="L253"></a> 253                     <strong class="reserved">return</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>;
<a id="L254" name="L254"></a> 254 
<a id="L255" name="L255"></a> 255                 <strong class="reserved">if</strong> (timed &amp;&amp; nanos &lt;= 0L) <em class="brace">{</em>
<a id="L256" name="L256"></a> 256                     <a href="../S/1066.html#L189" title="Defined at 189 in src/java/util/concurrent/CyclicBarrier.java.">breakBarrier</a>();
<a id="L257" name="L257"></a> 257                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/8986.html" title="Multiple defined in 2 places.">TimeoutException</a>();
<a id="L258" name="L258"></a> 258                 <em class="brace">}</em>
<a id="L259" name="L259"></a> 259             <em class="brace">}</em>
<a id="L260" name="L260"></a> 260         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L261" name="L261"></a> 261             <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/35916.html" title="Multiple defined in 13 places.">unlock</a>();
<a id="L262" name="L262"></a> 262         <em class="brace">}</em>
<a id="L263" name="L263"></a> 263     <em class="brace">}</em>
<a id="L264" name="L264"></a> 264 
<div class="comment">
      Creates a new <code>CyclicBarrier</code> that will trip when the
      given number of parties (threads) are waiting upon it, and which
      will execute the given barrier action when the barrier is tripped,
      performed by the last thread entering the barrier.
      @param parties the number of threads that must invoke <a href="#L360" title="Defined at 360.">await</a>
             before the barrier is tripped
      @param barrierAction the command to execute when the barrier is
             tripped, or <code>null</code> if there is no action
      @throws IllegalArgumentException if <code>parties</code> is less than 1</div>
<a id="L277" name="L277"></a> 277     <strong class="reserved">public</strong> CyclicBarrier(<strong class="reserved">int</strong> parties, <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> barrierAction) <em class="brace">{</em>
<a id="L278" name="L278"></a> 278         <strong class="reserved">if</strong> (parties &lt;= 0) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>();
<a id="L279" name="L279"></a> 279         <strong class="reserved">this</strong>.parties = parties;
<a id="L280" name="L280"></a> 280         <strong class="reserved">this</strong>.<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = parties;
<a id="L281" name="L281"></a> 281         <strong class="reserved">this</strong>.barrierCommand = barrierAction;
<a id="L282" name="L282"></a> 282     <em class="brace">}</em>
<a id="L283" name="L283"></a> 283 
<div class="comment">
      Creates a new <code>CyclicBarrier</code> that will trip when the
      given number of parties (threads) are waiting upon it, and
      does not perform a predefined action when the barrier is tripped.
      @param parties the number of threads that must invoke <a href="#L360" title="Defined at 360.">await</a>
             before the barrier is tripped
      @throws IllegalArgumentException if <code>parties</code> is less than 1</div>
<a id="L293" name="L293"></a> 293     <strong class="reserved">public</strong> CyclicBarrier(<strong class="reserved">int</strong> parties) <em class="brace">{</em>
<a id="L294" name="L294"></a> 294         <strong class="reserved">this</strong>(parties, <strong class="reserved">null</strong>);
<a id="L295" name="L295"></a> 295     <em class="brace">}</em>
<a id="L296" name="L296"></a> 296 
<div class="comment">
      Returns the number of parties required to trip this barrier.
      @return the number of parties required to trip this barrier</div>
<a id="L302" name="L302"></a> 302     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getParties() <em class="brace">{</em>
<a id="L303" name="L303"></a> 303         <strong class="reserved">return</strong> parties;
<a id="L304" name="L304"></a> 304     <em class="brace">}</em>
<a id="L305" name="L305"></a> 305 
<div class="comment">
      Waits until all {@linkplain #getParties parties} have invoked
      <code>await</code> on this barrier.
      <p>If the current thread is not the last to arrive then it is
      disabled for thread scheduling purposes and lies dormant until
      one of the following things happens:
      </p><ul><li>The last thread arrives; or
      </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
      the current thread; or
      </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
      one of the other waiting threads; or
      </li><li>Some other thread times out while waiting for barrier; or
      </li><li>Some other thread invokes <a href="#L465" title="Defined at 465.">reset</a> on this barrier.
      </li></ul>
      <p>If the current thread:
      </p><ul><li>has its interrupted status set on entry to this method; or
      </li><li>is {@linkplain Thread#interrupt interrupted} while waiting
      </li></ul>
      then <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> is thrown and the current thread's
      interrupted status is cleared.
      <p>If the barrier is <a href="#L465" title="Defined at 465.">reset</a> while any thread is waiting,
      or if the barrier {@linkplain #isBroken is broken} when
      <code>await</code> is invoked, or while any thread is waiting, then
      <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a> is thrown.
      </p><p>If any thread is {@linkplain Thread#interrupt interrupted} while waiting,
      then all other waiting threads will throw
      <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a> and the barrier is placed in the broken
      state.
      </p><p>If the current thread is the last thread to arrive, and a
      non-null barrier action was supplied in the constructor, then the
      current thread runs the action before allowing the other threads to
      continue.
      If an exception occurs during the barrier action then that exception
      will be propagated in the current thread and the barrier is placed in
      the broken state.
      @return the arrival index of the current thread, where index
              <code>getParties() - 1</code> indicates the first
              to arrive and zero indicates the last to arrive
      @throws InterruptedException if the current thread was interrupted
              while waiting
      @throws BrokenBarrierException if <em>another</em> thread was
              interrupted or timed out while the current thread was
              waiting, or the barrier was reset, or the barrier was
              broken when <code>await</code> was called, or the barrier
              action (if present) failed due to an exception</p></div>
<a id="L360" name="L360"></a> 360     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/10432.html" title="Multiple referred from 21 places.">await</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>, <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a> <em class="brace">{</em>
<a id="L361" name="L361"></a> 361         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L362" name="L362"></a> 362             <strong class="reserved">return</strong> <a href="../S/1066.html#L198" title="Defined at 198 in src/java/util/concurrent/CyclicBarrier.java.">dowait</a>(<strong class="reserved">false</strong>, 0L);
<a id="L363" name="L363"></a> 363         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../D/8986.html" title="Multiple defined in 2 places.">TimeoutException</a> toe) <em class="brace">{</em>
<a id="L364" name="L364"></a> 364             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(toe); <em class="comment">// cannot happen</em>
<a id="L365" name="L365"></a> 365         <em class="brace">}</em>
<a id="L366" name="L366"></a> 366     <em class="brace">}</em>
<a id="L367" name="L367"></a> 367 
<div class="comment">
      Waits until all {@linkplain #getParties parties} have invoked
      <code>await</code> on this barrier, or the specified waiting time elapses.
      <p>If the current thread is not the last to arrive then it is
      disabled for thread scheduling purposes and lies dormant until
      one of the following things happens:
      </p><ul><li>The last thread arrives; or
      </li><li>The specified timeout elapses; or
      </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
      the current thread; or
      </li><li>Some other thread {@linkplain Thread#interrupt interrupts}
      one of the other waiting threads; or
      </li><li>Some other thread times out while waiting for barrier; or
      </li><li>Some other thread invokes <a href="#L465" title="Defined at 465.">reset</a> on this barrier.
      </li></ul>
      <p>If the current thread:
      </p><ul><li>has its interrupted status set on entry to this method; or
      </li><li>is {@linkplain Thread#interrupt interrupted} while waiting
      </li></ul>
      then <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> is thrown and the current thread's
      interrupted status is cleared.
      <p>If the specified waiting time elapses then <a href="../D/8986.html" title="Multiple defined in 2 places.">TimeoutException</a>
      is thrown. If the time is less than or equal to zero, the
      method will not wait at all.
      </p><p>If the barrier is <a href="#L465" title="Defined at 465.">reset</a> while any thread is waiting,
      or if the barrier {@linkplain #isBroken is broken} when
      <code>await</code> is invoked, or while any thread is waiting, then
      <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a> is thrown.
      </p><p>If any thread is {@linkplain Thread#interrupt interrupted} while
      waiting, then all other waiting threads will throw {@link
      BrokenBarrierException} and the barrier is placed in the broken
      state.
      </p><p>If the current thread is the last thread to arrive, and a
      non-null barrier action was supplied in the constructor, then the
      current thread runs the action before allowing the other threads to
      continue.
      If an exception occurs during the barrier action then that exception
      will be propagated in the current thread and the barrier is placed in
      the broken state.
      @param timeout the time to wait for the barrier
      @param unit the time unit of the timeout parameter
      @return the arrival index of the current thread, where index
              <code>getParties() - 1</code> indicates the first
              to arrive and zero indicates the last to arrive
      @throws InterruptedException if the current thread was interrupted
              while waiting
      @throws TimeoutException if the specified timeout elapses.
              In this case the barrier will be broken.
      @throws BrokenBarrierException if <em>another</em> thread was
              interrupted or timed out while the current thread was
              waiting, or the barrier was reset, or the barrier was broken
              when <code>await</code> was called, or the barrier action (if
              present) failed due to an exception</p></div>
<a id="L431" name="L431"></a> 431     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/10432.html" title="Multiple referred from 21 places.">await</a>(<strong class="reserved">long</strong> timeout, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L432" name="L432"></a> 432         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>,
<a id="L433" name="L433"></a> 433                <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a>,
<a id="L434" name="L434"></a> 434                <a href="../D/8986.html" title="Multiple defined in 2 places.">TimeoutException</a> <em class="brace">{</em>
<a id="L435" name="L435"></a> 435         <strong class="reserved">return</strong> <a href="../S/1066.html#L198" title="Defined at 198 in src/java/util/concurrent/CyclicBarrier.java.">dowait</a>(<strong class="reserved">true</strong>, unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(timeout));
<a id="L436" name="L436"></a> 436     <em class="brace">}</em>
<a id="L437" name="L437"></a> 437 
<div class="comment">
      Queries if this barrier is in a broken state.
      @return <code>true</code> if one or more parties broke out of this
              barrier due to interruption or timeout since
              construction or the last reset, or a barrier action
              failed due to an exception; <code>false</code> otherwise.</div>
<a id="L446" name="L446"></a> 446     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> isBroken() <em class="brace">{</em>
<a id="L447" name="L447"></a> 447         <strong class="reserved">final</strong> <a href="../S/1047.html#L106" title="Defined at 106 in src/java/util/concurrent/locks/ReentrantLock.java.">ReentrantLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = <strong class="reserved">this</strong>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>;
<a id="L448" name="L448"></a> 448         <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>();
<a id="L449" name="L449"></a> 449         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L450" name="L450"></a> 450             <strong class="reserved">return</strong> generation.broken;
<a id="L451" name="L451"></a> 451         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L452" name="L452"></a> 452             <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/35916.html" title="Multiple defined in 13 places.">unlock</a>();
<a id="L453" name="L453"></a> 453         <em class="brace">}</em>
<a id="L454" name="L454"></a> 454     <em class="brace">}</em>
<a id="L455" name="L455"></a> 455 
<div class="comment">
      Resets the barrier to its initial state.  If any parties are
      currently waiting at the barrier, they will return with a
      <a href="../S/1073.html#L48" title="Defined at 48 in src/java/util/concurrent/BrokenBarrierException.java.">BrokenBarrierException</a>. Note that resets <em>after</em>
      a breakage has occurred for other reasons can be complicated to
      carry out; threads need to re-synchronize in some other way,
      and choose one to perform the reset.  It may be preferable to
      instead create a new barrier for subsequent use.</div>
<a id="L465" name="L465"></a> 465     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26238.html" title="Multiple referred from 619 places.">reset</a>() <em class="brace">{</em>
<a id="L466" name="L466"></a> 466         <strong class="reserved">final</strong> <a href="../S/1047.html#L106" title="Defined at 106 in src/java/util/concurrent/locks/ReentrantLock.java.">ReentrantLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = <strong class="reserved">this</strong>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>;
<a id="L467" name="L467"></a> 467         <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>();
<a id="L468" name="L468"></a> 468         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L469" name="L469"></a> 469             <a href="../S/1066.html#L189" title="Defined at 189 in src/java/util/concurrent/CyclicBarrier.java.">breakBarrier</a>();   <em class="comment">// break the current generation</em>
<a id="L470" name="L470"></a> 470             <a href="../S/1066.html#L177" title="Defined at 177 in src/java/util/concurrent/CyclicBarrier.java.">nextGeneration</a>(); <em class="comment">// start a new generation</em>
<a id="L471" name="L471"></a> 471         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L472" name="L472"></a> 472             <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/35916.html" title="Multiple defined in 13 places.">unlock</a>();
<a id="L473" name="L473"></a> 473         <em class="brace">}</em>
<a id="L474" name="L474"></a> 474     <em class="brace">}</em>
<a id="L475" name="L475"></a> 475 
<div class="comment">
      Returns the number of parties currently waiting at the barrier.
      This method is primarily useful for debugging and assertions.
      @return the number of parties currently blocked in <a href="#L360" title="Defined at 360.">await</a></div>
<a id="L482" name="L482"></a> 482     <strong class="reserved">public</strong> <strong class="reserved">int</strong> getNumberWaiting() <em class="brace">{</em>
<a id="L483" name="L483"></a> 483         <strong class="reserved">final</strong> <a href="../S/1047.html#L106" title="Defined at 106 in src/java/util/concurrent/locks/ReentrantLock.java.">ReentrantLock</a> <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a> = <strong class="reserved">this</strong>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>;
<a id="L484" name="L484"></a> 484         <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>();
<a id="L485" name="L485"></a> 485         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L486" name="L486"></a> 486             <strong class="reserved">return</strong> parties - <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L487" name="L487"></a> 487         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L488" name="L488"></a> 488             <a href="../D/27034.html" title="Multiple defined in 25 places.">lock</a>.<a href="../D/35916.html" title="Multiple defined in 13 places.">unlock</a>();
<a id="L489" name="L489"></a> 489         <em class="brace">}</em>
<a id="L490" name="L490"></a> 490     <em class="brace">}</em>
<a id="L491" name="L491"></a> 491 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L177">[^]</a><a href="#L482">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>