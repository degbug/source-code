<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L224">[^]</a><a href="#L1980">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L224" title="Defined at 224.">addLocalVariable</a></li>
<li><a href="#L239" title="Defined at 239.">addLocalVariable2</a></li>
<li><a href="#L248" title="Defined at 248.">getLocalVariableRegistry</a></li>
<li><a href="#L304" title="Defined at 304.">registerLocalVariable</a></li>
<li><a href="#L357" title="Defined at 357.">lookupRegisteredLocalVariable</a></li>
<li><a href="#L409" title="Defined at 409.">registerByName</a></li>
<li><a href="#L437" title="Defined at 437.">removeByNameTracking</a></li>
<li><a href="#L461" title="Defined at 461.">lookUpByName</a></li>
<li><a href="#L495" title="Defined at 495.">getLocals</a></li>
<li><a href="#L556" title="Defined at 556.">offsetInLocalVariableGenRange</a></li>
<li><a href="#L583" title="Defined at 583.">removeLocalVariable</a></li>
<li><a href="#L589" title="Defined at 589.">loadDOM</a></li>
<li><a href="#L593" title="Defined at 593.">storeDOM</a></li>
<li><a href="#L597" title="Defined at 597.">storeHandler</a></li>
<li><a href="#L601" title="Defined at 601.">loadHandler</a></li>
<li><a href="#L605" title="Defined at 605.">storeIterator</a></li>
<li><a href="#L609" title="Defined at 609.">loadIterator</a></li>
<li><a href="#L613" title="Defined at 613.">setStartNode</a></li>
<li><a href="#L617" title="Defined at 617.">reset</a></li>
<li><a href="#L621" title="Defined at 621.">nextNode</a></li>
<li><a href="#L625" title="Defined at 625.">startElement</a></li>
<li><a href="#L629" title="Defined at 629.">endElement</a></li>
<li><a href="#L633" title="Defined at 633.">startDocument</a></li>
<li><a href="#L637" title="Defined at 637.">endDocument</a></li>
<li><a href="#L641" title="Defined at 641.">attribute</a></li>
<li><a href="#L645" title="Defined at 645.">uniqueAttribute</a></li>
<li><a href="#L649" title="Defined at 649.">namespace</a></li>
<li><a href="#L653" title="Defined at 653.">loadCurrentNode</a></li>
<li><a href="#L664" title="Defined at 664.">storeCurrentNode</a></li>
<li><a href="#L671" title="Defined at 671.">loadContextNode</a></li>
<li><a href="#L675" title="Defined at 675.">storeContextNode</a></li>
<li><a href="#L679" title="Defined at 679.">getLocalIndex</a></li>
<li><a href="#L683" title="Defined at 683.">getLocalVariable</a></li>
<li><a href="#L687" title="Defined at 687.">setMaxLocals</a></li>
<li><a href="#L709" title="Defined at 709.">addInstructionList</a></li>
<li><a href="#L717" title="Defined at 717.">getInstructionList</a></li>
<li><a href="#L774" title="Defined at 774.">isAdjacentTo</a></li>
<li><a href="#L783" title="Defined at 783.">getChunkStart</a></li>
<li><a href="#L791" title="Defined at 791.">getChunkEnd</a></li>
<li><a href="#L800" title="Defined at 800.">getChunkSize</a></li>
<li><a href="#L816" title="Defined at 816.">compareTo</a></li>
<li><a href="#L830" title="Defined at 830.">getCandidateChunks</a></li>
<li><a href="#L996" title="Defined at 996.">mergeAdjacentChunks</a></li>
<li><a href="#L1137" title="Defined at 1137.">outlineChunks</a></li>
<li><a href="#L1225" title="Defined at 1225.">outline</a></li>
<li><a href="#L1769" title="Defined at 1769.">loadLocal</a></li>
<li><a href="#L1800" title="Defined at 1800.">storeLocal</a></li>
<li><a href="#L1841" title="Defined at 1841.">markChunkStart</a></li>
<li><a href="#L1853" title="Defined at 1853.">markChunkEnd</a></li>
<li><a href="#L1879" title="Defined at 1879.">getGeneratedMethods</a></li>
<li><a href="#L1912" title="Defined at 1912.">getThisMethod</a></li>
<li><a href="#L1980" title="Defined at 1980.">widenConditionalBranchTargetOffsets</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<div class="comment">
  Copyright 2001-2004 The Apache Software Foundation.
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
      http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.</div>
<div class="comment">
  $Id: MethodGenerator.java,v 1.2.4.1 2005/09/05 11:16:47 pvedula Exp $</div>
<a id="L23" name="L23"></a>  23 
<a id="L24" name="L24"></a>  24 <strong class="reserved">package</strong> com.sun.org.apache.xalan.internal.xsltc.compiler.util;
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.util.Collections;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.HashMap;
<a id="L29" name="L29"></a>  29  <strong class="reserved">import</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.<a href="../D/3743.html" title="Multiple defined in 2 places.">Hashtable</a>;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.util.Iterator;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.util.Map;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.util.Stack;
<a id="L33" name="L33"></a>  33 
<a id="L34" name="L34"></a>  34 
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.Constants;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.classfile.Field;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.classfile.Method;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.ALOAD;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.ASTORE;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.BranchHandle;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.BranchInstruction;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.ConstantPoolGen;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.DLOAD;
<a id="L44" name="L44"></a>  44 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.DSTORE;
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.FLOAD;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.FSTORE;
<a id="L47" name="L47"></a>  47 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.GETFIELD;
<a id="L48" name="L48"></a>  48 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.GOTO;
<a id="L49" name="L49"></a>  49 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.ICONST;
<a id="L50" name="L50"></a>  50 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.IfInstruction;
<a id="L51" name="L51"></a>  51 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.ILOAD;
<a id="L52" name="L52"></a>  52 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.IndexedInstruction;
<a id="L53" name="L53"></a>  53 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.INVOKEINTERFACE;
<a id="L54" name="L54"></a>  54 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.INVOKESPECIAL;
<a id="L55" name="L55"></a>  55 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.INVOKESTATIC;
<a id="L56" name="L56"></a>  56 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.INVOKEVIRTUAL;
<a id="L57" name="L57"></a>  57 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.ISTORE;
<a id="L58" name="L58"></a>  58 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.Instruction;
<a id="L59" name="L59"></a>  59 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.InstructionConstants;
<a id="L60" name="L60"></a>  60 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.InstructionHandle;
<a id="L61" name="L61"></a>  61 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.InstructionList;
<a id="L62" name="L62"></a>  62 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.InstructionTargeter;
<a id="L63" name="L63"></a>  63 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.LocalVariableGen;
<a id="L64" name="L64"></a>  64 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.LocalVariableInstruction;
<a id="L65" name="L65"></a>  65 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.LLOAD;
<a id="L66" name="L66"></a>  66 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.LSTORE;
<a id="L67" name="L67"></a>  67 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.MethodGen;
<a id="L68" name="L68"></a>  68 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.NEW;
<a id="L69" name="L69"></a>  69 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.PUTFIELD;
<a id="L70" name="L70"></a>  70 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.RET;
<a id="L71" name="L71"></a>  71 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.Select;
<a id="L72" name="L72"></a>  72 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.TargetLostException;
<a id="L73" name="L73"></a>  73 <strong class="reserved">import</strong> com.sun.org.apache.bcel.internal.generic.Type;
<a id="L74" name="L74"></a>  74 
<a id="L75" name="L75"></a>  75 <strong class="reserved">import</strong> com.sun.org.apache.xalan.internal.xsltc.compiler.Pattern;
<a id="L76" name="L76"></a>  76 <strong class="reserved">import</strong> com.sun.org.apache.xalan.internal.xsltc.compiler.XSLTC;
<a id="L77" name="L77"></a>  77 
<div class="comment">
  @author Jacek Ambroziak
  @author Santiago Pericas-Geertsen</div>
<a id="L82" name="L82"></a>  82 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/5113.html" title="Multiple referred from 402 places.">MethodGenerator</a> <strong class="reserved">extends</strong> <a href="../S/4802.html#L80" title="Defined at 80 in src/com/sun/org/apache/bcel/internal/generic/MethodGen.java.">MethodGen</a>
<a id="L83" name="L83"></a>  83     <strong class="reserved">implements</strong> com.sun.org.apache.xalan.internal.xsltc.compiler.<a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a> <em class="brace">{</em>
<a id="L84" name="L84"></a>  84     <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> INVALID_INDEX   = -1;
<a id="L85" name="L85"></a>  85 
<a id="L86" name="L86"></a>  86     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> START_ELEMENT_SIG
<a id="L87" name="L87"></a>  87         = "(" + STRING_SIG + ")V";
<a id="L88" name="L88"></a>  88     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> END_ELEMENT_SIG
<a id="L89" name="L89"></a>  89         = START_ELEMENT_SIG;
<a id="L90" name="L90"></a>  90 
<a id="L91" name="L91"></a>  91     <strong class="reserved">private</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> _mapTypeSub;
<a id="L92" name="L92"></a>  92 
<a id="L93" name="L93"></a>  93     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> DOM_INDEX       = 1;
<a id="L94" name="L94"></a>  94     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> ITERATOR_INDEX  = 2;
<a id="L95" name="L95"></a>  95     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> HANDLER_INDEX   = 3;
<a id="L96" name="L96"></a>  96 
<a id="L97" name="L97"></a>  97     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_METHOD_SIZE = 65535;
<a id="L98" name="L98"></a>  98     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_BRANCH_TARGET_OFFSET = 32767;
<a id="L99" name="L99"></a>  99     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MIN_BRANCH_TARGET_OFFSET = -32768;
<a id="L100" name="L100"></a> 100 
<a id="L101" name="L101"></a> 101     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> TARGET_METHOD_SIZE = 60000;
<a id="L102" name="L102"></a> 102     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MINIMUM_OUTLINEABLE_CHUNK_SIZE = 1000;
<a id="L103" name="L103"></a> 103 
<a id="L104" name="L104"></a> 104     <strong class="reserved">private</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a>       _iloadCurrent;
<a id="L105" name="L105"></a> 105     <strong class="reserved">private</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a>       _istoreCurrent;
<a id="L106" name="L106"></a> 106     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _astoreHandler;
<a id="L107" name="L107"></a> 107     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _aloadHandler;
<a id="L108" name="L108"></a> 108     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _astoreIterator;
<a id="L109" name="L109"></a> 109     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _aloadIterator;
<a id="L110" name="L110"></a> 110     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _aloadDom;
<a id="L111" name="L111"></a> 111     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _astoreDom;
<a id="L112" name="L112"></a> 112 
<a id="L113" name="L113"></a> 113     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _startElement;
<a id="L114" name="L114"></a> 114     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _endElement;
<a id="L115" name="L115"></a> 115     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _startDocument;
<a id="L116" name="L116"></a> 116     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _endDocument;
<a id="L117" name="L117"></a> 117     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _attribute;
<a id="L118" name="L118"></a> 118     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _uniqueAttribute;
<a id="L119" name="L119"></a> 119     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _namespace;
<a id="L120" name="L120"></a> 120 
<a id="L121" name="L121"></a> 121     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _setStartNode;
<a id="L122" name="L122"></a> 122     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _reset;
<a id="L123" name="L123"></a> 123     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> _nextNode;
<a id="L124" name="L124"></a> 124 
<a id="L125" name="L125"></a> 125     <strong class="reserved">private</strong> <a href="../S/6140.html#L32" title="Defined at 32 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/SlotAllocator.java.">SlotAllocator</a> _slotAllocator;
<a id="L126" name="L126"></a> 126     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> _allocatorInit = <strong class="reserved">false</strong>;
<a id="L127" name="L127"></a> 127     <strong class="reserved">private</strong> <a href="../S/6132.html#L270" title="Defined at 270 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">LocalVariableRegistry</a> _localVariableRegistry;
<div class="comment">
                  A mapping between patterns and instruction lists used by
                  test sequences to avoid compiling the same pattern multiple
                  times. Note that patterns whose kernels are "*", "node()"
                  and "@*" can between shared by test sequences.</div>
<a id="L134" name="L134"></a> 134         <strong class="reserved">private</strong> <a href="../D/3743.html" title="Multiple defined in 2 places.">Hashtable</a> _preCompiled = <strong class="reserved">new</strong> <a href="../D/3743.html" title="Multiple defined in 2 places.">Hashtable</a>();
<a id="L135" name="L135"></a> 135 
<a id="L136" name="L136"></a> 136 
<a id="L137" name="L137"></a> 137     <strong class="reserved">public</strong> MethodGenerator(<strong class="reserved">int</strong> access_flags, <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> return_type,
<a id="L138" name="L138"></a> 138                            <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>[] arg_types, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] arg_names,
<a id="L139" name="L139"></a> 139                            <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> method_name, <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> class_name,
<a id="L140" name="L140"></a> 140                            <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> il, <a href="../S/4764.html#L78" title="Defined at 78 in src/com/sun/org/apache/bcel/internal/generic/ConstantPoolGen.java.">ConstantPoolGen</a> cpg) <em class="brace">{</em>
<a id="L141" name="L141"></a> 141         <strong class="reserved">super</strong>(access_flags, return_type, arg_types, arg_names, method_name,
<a id="L142" name="L142"></a> 142               class_name, il, cpg);
<a id="L143" name="L143"></a> 143 
<a id="L144" name="L144"></a> 144         _astoreHandler  = <strong class="reserved">new</strong> <a href="../S/4659.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ASTORE.java.">ASTORE</a>(HANDLER_INDEX);
<a id="L145" name="L145"></a> 145         _aloadHandler   = <strong class="reserved">new</strong> <a href="../S/4754.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ALOAD.java.">ALOAD</a>(HANDLER_INDEX);
<a id="L146" name="L146"></a> 146         _astoreIterator = <strong class="reserved">new</strong> <a href="../S/4659.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ASTORE.java.">ASTORE</a>(ITERATOR_INDEX);
<a id="L147" name="L147"></a> 147         _aloadIterator  = <strong class="reserved">new</strong> <a href="../S/4754.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ALOAD.java.">ALOAD</a>(ITERATOR_INDEX);
<a id="L148" name="L148"></a> 148         _aloadDom       = <strong class="reserved">new</strong> <a href="../S/4754.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ALOAD.java.">ALOAD</a>(DOM_INDEX);
<a id="L149" name="L149"></a> 149         _astoreDom      = <strong class="reserved">new</strong> <a href="../S/4659.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ASTORE.java.">ASTORE</a>(DOM_INDEX);
<a id="L150" name="L150"></a> 150 
<a id="L151" name="L151"></a> 151         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/34781.html" title="Multiple defined in 105 places.">startElement</a> =
<a id="L152" name="L152"></a> 152             cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L153" name="L153"></a> 153                                       "startElement",
<a id="L154" name="L154"></a> 154                                       START_ELEMENT_SIG);
<a id="L155" name="L155"></a> 155         _startElement = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/34781.html" title="Multiple defined in 105 places.">startElement</a>, 2);
<a id="L156" name="L156"></a> 156 
<a id="L157" name="L157"></a> 157         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/15448.html" title="Multiple defined in 90 places.">endElement</a> =
<a id="L158" name="L158"></a> 158             cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L159" name="L159"></a> 159                                       "endElement",
<a id="L160" name="L160"></a> 160                                       END_ELEMENT_SIG);
<a id="L161" name="L161"></a> 161         _endElement = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/15448.html" title="Multiple defined in 90 places.">endElement</a>, 2);
<a id="L162" name="L162"></a> 162 
<a id="L163" name="L163"></a> 163         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/11628.html" title="Multiple defined in 2 places.">attribute</a> =
<a id="L164" name="L164"></a> 164             cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L165" name="L165"></a> 165                                       "addAttribute",
<a id="L166" name="L166"></a> 166                                       "("
<a id="L167" name="L167"></a> 167                                       + STRING_SIG
<a id="L168" name="L168"></a> 168                                       + STRING_SIG
<a id="L169" name="L169"></a> 169                                       + ")V");
<a id="L170" name="L170"></a> 170         _attribute = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/11628.html" title="Multiple defined in 2 places.">attribute</a>, 3);
<a id="L171" name="L171"></a> 171 
<a id="L172" name="L172"></a> 172         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/6132.html#L645" title="Defined at 645 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">uniqueAttribute</a> =
<a id="L173" name="L173"></a> 173             cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L174" name="L174"></a> 174                                       "addUniqueAttribute",
<a id="L175" name="L175"></a> 175                                       "("
<a id="L176" name="L176"></a> 176                                       + STRING_SIG
<a id="L177" name="L177"></a> 177                                       + STRING_SIG
<a id="L178" name="L178"></a> 178                                       + "I)V");
<a id="L179" name="L179"></a> 179         _uniqueAttribute = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../S/6132.html#L645" title="Defined at 645 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">uniqueAttribute</a>, 4);
<a id="L180" name="L180"></a> 180 
<a id="L181" name="L181"></a> 181         <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../D/27870.html" title="Multiple defined in 10 places.">namespace</a> =
<a id="L182" name="L182"></a> 182             cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L183" name="L183"></a> 183                                       "namespaceAfterStartElement",
<a id="L184" name="L184"></a> 184                                       "("
<a id="L185" name="L185"></a> 185                                       + STRING_SIG
<a id="L186" name="L186"></a> 186                                       + STRING_SIG
<a id="L187" name="L187"></a> 187                                       + ")V");
<a id="L188" name="L188"></a> 188         _namespace = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/27870.html" title="Multiple defined in 10 places.">namespace</a>, 3);
<a id="L189" name="L189"></a> 189 
<a id="L190" name="L190"></a> 190         <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L191" name="L191"></a> 191                                               "startDocument",
<a id="L192" name="L192"></a> 192                                               "()V");
<a id="L193" name="L193"></a> 193         _startDocument = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, 1);
<a id="L194" name="L194"></a> 194 
<a id="L195" name="L195"></a> 195         <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(TRANSLET_OUTPUT_INTERFACE,
<a id="L196" name="L196"></a> 196                                           "endDocument",
<a id="L197" name="L197"></a> 197                                           "()V");
<a id="L198" name="L198"></a> 198         _endDocument = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, 1);
<a id="L199" name="L199"></a> 199 
<a id="L200" name="L200"></a> 200 
<a id="L201" name="L201"></a> 201         <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(NODE_ITERATOR,
<a id="L202" name="L202"></a> 202                                           SET_START_NODE,
<a id="L203" name="L203"></a> 203                                           SET_START_NODE_SIG);
<a id="L204" name="L204"></a> 204         _setStartNode = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, 2);
<a id="L205" name="L205"></a> 205 
<a id="L206" name="L206"></a> 206         <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(NODE_ITERATOR,
<a id="L207" name="L207"></a> 207                                           "reset", "()"+NODE_ITERATOR_SIG);
<a id="L208" name="L208"></a> 208         _reset = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, 1);
<a id="L209" name="L209"></a> 209 
<a id="L210" name="L210"></a> 210         <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = cpg.<a href="../D/10875.html" title="Multiple defined in 2 places.">addInterfaceMethodref</a>(NODE_ITERATOR, NEXT, NEXT_SIG);
<a id="L211" name="L211"></a> 211         _nextNode = <strong class="reserved">new</strong> <a href="../S/4624.html#L73" title="Defined at 73 in src/com/sun/org/apache/bcel/internal/generic/INVOKEINTERFACE.java.">INVOKEINTERFACE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, 1);
<a id="L212" name="L212"></a> 212 
<a id="L213" name="L213"></a> 213         _slotAllocator = <strong class="reserved">new</strong> <a href="../S/6140.html#L32" title="Defined at 32 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/SlotAllocator.java.">SlotAllocator</a>();
<a id="L214" name="L214"></a> 214         _slotAllocator.<a href="../D/24646.html" title="Multiple defined in 91 places.">initialize</a>(<a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>().<a href="../S/6132.html#L495" title="Defined at 495 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocals</a>(<strong class="reserved">false</strong>));
<a id="L215" name="L215"></a> 215         _allocatorInit = <strong class="reserved">true</strong>;
<a id="L216" name="L216"></a> 216     <em class="brace">}</em>
<a id="L217" name="L217"></a> 217 
<div class="comment">
      Allocates a local variable. If the slot allocator has already been
      initialized, then call addLocalVariable2() so that the new variable
      is known to the allocator. Failing to do this may cause the allocator
      to return a slot that is already in use.</div>
<a id="L224" name="L224"></a> 224     <strong class="reserved">public</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> <a href="../R/9831.html" title="Multiple referred from 46 places.">addLocalVariable</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>,
<a id="L225" name="L225"></a> 225                                              <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>,
<a id="L226" name="L226"></a> 226                                              <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>)
<a id="L227" name="L227"></a> 227     <em class="brace">{</em>
<a id="L228" name="L228"></a> 228         <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg;
<a id="L229" name="L229"></a> 229 
<a id="L230" name="L230"></a> 230         <strong class="reserved">if</strong> (_allocatorInit) <em class="brace">{</em>
<a id="L231" name="L231"></a> 231             lvg = <a href="../S/6132.html#L239" title="Defined at 239 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">addLocalVariable2</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>, <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>);
<a id="L232" name="L232"></a> 232         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L233" name="L233"></a> 233             lvg = <strong class="reserved">super</strong>.<a href="../D/10913.html" title="Multiple defined in 3 places.">addLocalVariable</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>, <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>);
<a id="L234" name="L234"></a> 234             <a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>().<a href="../S/6132.html#L304" title="Defined at 304 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">registerLocalVariable</a>(lvg);
<a id="L235" name="L235"></a> 235         <em class="brace">}</em>
<a id="L236" name="L236"></a> 236         <strong class="reserved">return</strong> lvg;
<a id="L237" name="L237"></a> 237     <em class="brace">}</em>
<a id="L238" name="L238"></a> 238 
<a id="L239" name="L239"></a> 239     <strong class="reserved">public</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> <a href="../R/9832.html" title="Multiple referred from 14 places.">addLocalVariable2</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>,
<a id="L240" name="L240"></a> 240                                               <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>)
<a id="L241" name="L241"></a> 241     <em class="brace">{</em>
<a id="L242" name="L242"></a> 242         <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg = <strong class="reserved">super</strong>.<a href="../D/10913.html" title="Multiple defined in 3 places.">addLocalVariable</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>,
<a id="L243" name="L243"></a> 243                                               _slotAllocator.<a href="../S/6140.html#L51" title="Defined at 51 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/SlotAllocator.java.">allocateSlot</a>(<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>),
<a id="L244" name="L244"></a> 244                                               <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">null</strong>);
<a id="L245" name="L245"></a> 245         <a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>().<a href="../S/6132.html#L304" title="Defined at 304 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">registerLocalVariable</a>(lvg);
<a id="L246" name="L246"></a> 246         <strong class="reserved">return</strong> lvg;
<a id="L247" name="L247"></a> 247     <em class="brace">}</em>
<a id="L248" name="L248"></a> 248     <strong class="reserved">private</strong> <a href="../S/6132.html#L270" title="Defined at 270 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">LocalVariableRegistry</a> <a href="../R/17433.html" title="Multiple referred from 7 places.">getLocalVariableRegistry</a>() <em class="brace">{</em>
<a id="L249" name="L249"></a> 249         <strong class="reserved">if</strong> (_localVariableRegistry == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L250" name="L250"></a> 250             _localVariableRegistry = <strong class="reserved">new</strong> <a href="../S/6132.html#L270" title="Defined at 270 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">LocalVariableRegistry</a>();
<a id="L251" name="L251"></a> 251         <em class="brace">}</em>
<a id="L252" name="L252"></a> 252 
<a id="L253" name="L253"></a> 253         <strong class="reserved">return</strong> _localVariableRegistry;
<a id="L254" name="L254"></a> 254     <em class="brace">}</em>
<a id="L255" name="L255"></a> 255 
<div class="comment">
      Keeps track of all local variables used in the method.
      <p>The
      {@link MethodGen#addLocalVariable(String,Type,InstructionHandle,InstructionHandle)}
      and
      {@link MethodGen#addLocalVariable(String,Type,int,InstructionHandle,InstructionHandle)}
      methods of {@link MethodGen} will only keep track of
      {@link LocalVariableGen} object until it'ss removed by a call to
      {@link MethodGen#removeLocalVariable(LocalVariableGen)}.</p>
      <p>In order to support efficient copying of local variables to outlined
      methods by
      {@link #outline(InstructionHandle,InstructionHandle,String,ClassGenerator)},
      this class keeps track of all local variables defined by the method.</p></div>
<a id="L270" name="L270"></a> 270     <strong class="reserved">protected</strong> <strong class="reserved">class</strong> <a href="../R/4692.html" title="Multiple referred from 3 places.">LocalVariableRegistry</a> <em class="brace">{</em>
<div class="comment">
          <p>A <code>java.lang.ArrayList</code> of all
          {@link LocalVariableGen}s created for this method, indexed by the
          slot number of the local variable.  The JVM stack frame of local
          variables is divided into "slots".  A single slot can be used to
          store more than one variable in a method, without regard to type, so
          long as the byte code keeps the ranges of the two disjoint.</p>
          <p>If only one registration of use of a particular slot occurs, the
          corresponding entry of <code>_variables</code> contains the
          <code>LocalVariableGen</code>; if more than one occurs, the
          corresponding entry contains all such <code>LocalVariableGen</code>s
          registered for the same slot; and if none occurs, the entry will be
          <code>null</code>.</p></div>
<a id="L285" name="L285"></a> 285         <strong class="reserved">protected</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> _variables = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L286" name="L286"></a> 286 
<div class="comment">
          Maps a name to a {@link LocalVariableGen}</div>
<a id="L290" name="L290"></a> 290         <strong class="reserved">protected</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a> _nameToLVGMap = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>();
<a id="L291" name="L291"></a> 291 
<div class="comment">
          Registers a {@link org.apache.bcel.generic.LocalVariableGen}
          for this method.
          <p><b>Preconditions:</b>
          </p><ul><li>The range of instructions for <code>lvg</code> does not
          overlap with the range of instructions for any
          <code>LocalVariableGen</code> with the same slot index previously
          registered for this method.  <b><em>(Unchecked.)</em></b></li>
          </ul><p></p>
          @param lvg The variable to be registered</div>
<a id="L304" name="L304"></a> 304         <strong class="reserved">protected</strong> <strong class="reserved">void</strong> <a href="../R/25788.html" title="Multiple referred from 2 places.">registerLocalVariable</a>(<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg) <em class="brace">{</em>
<a id="L305" name="L305"></a> 305             <strong class="reserved">int</strong> slot = lvg.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L306" name="L306"></a> 306 
<a id="L307" name="L307"></a> 307             <strong class="reserved">int</strong> registrySize = _variables.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L308" name="L308"></a> 308 
<a id="L309" name="L309"></a> 309             <em class="comment">// If the LocalVariableGen uses a slot index beyond any previously</em>
<a id="L310" name="L310"></a> 310             <em class="comment">// encountered, expand the _variables, padding with intervening null</em>
<a id="L311" name="L311"></a> 311             <em class="comment">// entries as required.</em>
<a id="L312" name="L312"></a> 312             <strong class="reserved">if</strong> (slot &gt;= registrySize) <em class="brace">{</em>
<a id="L313" name="L313"></a> 313                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = registrySize; i &lt; slot; i++) <em class="brace">{</em>
<a id="L314" name="L314"></a> 314                     _variables.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<strong class="reserved">null</strong>);
<a id="L315" name="L315"></a> 315                 <em class="brace">}</em>
<a id="L316" name="L316"></a> 316                 _variables.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(lvg);
<a id="L317" name="L317"></a> 317             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L318" name="L318"></a> 318                 <em class="comment">// If the LocalVariableGen reuses a slot, make sure the entry</em>
<a id="L319" name="L319"></a> 319                 <em class="comment">// in _variables contains an ArrayList and add the newly</em>
<a id="L320" name="L320"></a> 320                 <em class="comment">// registered LocalVariableGen to the list.  If the entry in</em>
<a id="L321" name="L321"></a> 321                 <em class="comment">// _variables just contains null padding, store the</em>
<a id="L322" name="L322"></a> 322                 <em class="comment">// LocalVariableGen directly.</em>
<a id="L323" name="L323"></a> 323                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> localsInSlot = _variables.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(slot);
<a id="L324" name="L324"></a> 324                 <strong class="reserved">if</strong> (localsInSlot != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L325" name="L325"></a> 325                     <strong class="reserved">if</strong> (localsInSlot <strong class="reserved">instanceof</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) <em class="brace">{</em>
<a id="L326" name="L326"></a> 326                         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> listOfLocalsInSlot = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L327" name="L327"></a> 327                         listOfLocalsInSlot.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(localsInSlot);
<a id="L328" name="L328"></a> 328                         listOfLocalsInSlot.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(lvg);
<a id="L329" name="L329"></a> 329                         _variables.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(slot, listOfLocalsInSlot);
<a id="L330" name="L330"></a> 330                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L331" name="L331"></a> 331                         ((<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) localsInSlot).<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(lvg);
<a id="L332" name="L332"></a> 332                     <em class="brace">}</em>
<a id="L333" name="L333"></a> 333                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L334" name="L334"></a> 334                     _variables.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(slot, lvg);
<a id="L335" name="L335"></a> 335                 <em class="brace">}</em>
<a id="L336" name="L336"></a> 336             <em class="brace">}</em>
<a id="L337" name="L337"></a> 337 
<a id="L338" name="L338"></a> 338             <a href="../S/6132.html#L409" title="Defined at 409 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">registerByName</a>(lvg);
<a id="L339" name="L339"></a> 339         <em class="brace">}</em>
<a id="L340" name="L340"></a> 340 
<div class="comment">
          <p>Find which {@link LocalVariableGen}, if any, is registered for a
          particular JVM local stack frame slot at a particular position in the
          byte code for the method.</p>
          <p><b>Preconditions:</b>
          </p><ul><li>The {@link InstructionList#setPositions()} has been called for
          the {@link InstructionList} associated with this
          {@link MethodGenerator}.</li>
          </ul><p></p>
          @param slot the JVM local stack frame slot number
          @param offset the position in the byte code
          @return the <code>LocalVariableGen</code> for the local variable
          stored in the relevant slot at the relevant offset; <code>null</code>
          if there is none.</div>
<a id="L357" name="L357"></a> 357         <strong class="reserved">protected</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> <a href="../R/22775.html" title="Multiple referred from 2 places.">lookupRegisteredLocalVariable</a>(<strong class="reserved">int</strong> slot,
<a id="L358" name="L358"></a> 358                                                                  <strong class="reserved">int</strong> <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>) <em class="brace">{</em>
<a id="L359" name="L359"></a> 359             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> localsInSlot = (_variables != <strong class="reserved">null</strong>) ? _variables.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(slot)
<a id="L360" name="L360"></a> 360                                                        : <strong class="reserved">null</strong>;
<a id="L361" name="L361"></a> 361 
<a id="L362" name="L362"></a> 362             <em class="comment">// If this slot index was never used, _variables.get will return</em>
<a id="L363" name="L363"></a> 363             <em class="comment">// null; if it was used once, it will return the LocalVariableGen;</em>
<a id="L364" name="L364"></a> 364             <em class="comment">// more than once it will return an ArrayList of all the</em>
<a id="L365" name="L365"></a> 365             <em class="comment">// LocalVariableGens for variables stored in that slot.  For each</em>
<a id="L366" name="L366"></a> 366             <em class="comment">// LocalVariableGen, check whether its range includes the</em>
<a id="L367" name="L367"></a> 367             <em class="comment">// specified offset, and return the first such encountered.</em>
<a id="L368" name="L368"></a> 368             <strong class="reserved">if</strong> (localsInSlot != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L369" name="L369"></a> 369                 <strong class="reserved">if</strong> (localsInSlot <strong class="reserved">instanceof</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) <em class="brace">{</em>
<a id="L370" name="L370"></a> 370                     <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg = (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)localsInSlot;
<a id="L371" name="L371"></a> 371                     <strong class="reserved">if</strong> (<a href="../S/6132.html#L556" title="Defined at 556 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">offsetInLocalVariableGenRange</a>(lvg, <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>)) <em class="brace">{</em>
<a id="L372" name="L372"></a> 372                         <strong class="reserved">return</strong> lvg;
<a id="L373" name="L373"></a> 373                     <em class="brace">}</em>
<a id="L374" name="L374"></a> 374                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L375" name="L375"></a> 375                     <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> listOfLocalsInSlot = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) localsInSlot;
<a id="L376" name="L376"></a> 376                     <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = listOfLocalsInSlot.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L377" name="L377"></a> 377 
<a id="L378" name="L378"></a> 378                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>; i++) <em class="brace">{</em>
<a id="L379" name="L379"></a> 379                         <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg =
<a id="L380" name="L380"></a> 380                             (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)listOfLocalsInSlot.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L381" name="L381"></a> 381                         <strong class="reserved">if</strong> (<a href="../S/6132.html#L556" title="Defined at 556 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">offsetInLocalVariableGenRange</a>(lvg, <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>)) <em class="brace">{</em>
<a id="L382" name="L382"></a> 382                             <strong class="reserved">return</strong> lvg;
<a id="L383" name="L383"></a> 383                         <em class="brace">}</em>
<a id="L384" name="L384"></a> 384                     <em class="brace">}</em>
<a id="L385" name="L385"></a> 385                 <em class="brace">}</em>
<a id="L386" name="L386"></a> 386             <em class="brace">}</em>
<a id="L387" name="L387"></a> 387 
<a id="L388" name="L388"></a> 388             <em class="comment">// No local variable stored in the specified slot at the specified</em>
<a id="L389" name="L389"></a> 389             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L390" name="L390"></a> 390         <em class="brace">}</em>
<a id="L391" name="L391"></a> 391 
<div class="comment">
          <p>Set up a mapping of the name of the specified
          {@link LocalVariableGen} object to the <code>LocalVariableGen</code>
          itself.</p>
          <p>This is a bit of a hack.  XSLTC is relying on the fact that the
          name that is being looked up won't be duplicated, which isn't
          guaranteed.  It replaces code which used to call
          {@link MethodGen#getLocalVariables()} and looped through the
          <code>LocalVariableGen</code> objects it contained to find the one
          with the specified name.  However, <code>getLocalVariables()</code>
          has the side effect of setting the start and end for any
          <code>LocalVariableGen</code> which did not already have them
          set, which causes problems for outlining..</p>
          <p>See also {@link #lookUpByName(String)} and
          {@link #removeByNameTracking(LocalVariableGen)}</p>LocalVariableGen</div>
<a id="L409" name="L409"></a> 409         <strong class="reserved">protected</strong> <strong class="reserved">void</strong> <a href="../S/6132.html#L338" title="Referred from 338 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">registerByName</a>(<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg) <em class="brace">{</em>
<a id="L410" name="L410"></a> 410             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> duplicateNameEntry = _nameToLVGMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(lvg.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L411" name="L411"></a> 411 
<a id="L412" name="L412"></a> 412             <strong class="reserved">if</strong> (duplicateNameEntry == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L413" name="L413"></a> 413                 _nameToLVGMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(lvg.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>(), lvg);
<a id="L414" name="L414"></a> 414             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L415" name="L415"></a> 415                 <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> sameNameList;
<a id="L416" name="L416"></a> 416 
<a id="L417" name="L417"></a> 417                 <strong class="reserved">if</strong> (duplicateNameEntry <strong class="reserved">instanceof</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) <em class="brace">{</em>
<a id="L418" name="L418"></a> 418                     sameNameList = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) duplicateNameEntry;
<a id="L419" name="L419"></a> 419                     sameNameList.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(lvg);
<a id="L420" name="L420"></a> 420                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L421" name="L421"></a> 421                     sameNameList = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L422" name="L422"></a> 422                     sameNameList.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(duplicateNameEntry);
<a id="L423" name="L423"></a> 423                     sameNameList.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(lvg);
<a id="L424" name="L424"></a> 424                 <em class="brace">}</em>
<a id="L425" name="L425"></a> 425 
<a id="L426" name="L426"></a> 426                 _nameToLVGMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(lvg.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>(), sameNameList);
<a id="L427" name="L427"></a> 427             <em class="brace">}</em>
<a id="L428" name="L428"></a> 428         <em class="brace">}</em>
<a id="L429" name="L429"></a> 429 
<div class="comment">
          Remove the mapping from the name of the specified
          {@link LocalVariableGen} to itself.
          See also {@link #registerByName(LocalVariableGen)} and
          {@link #lookUpByName(String)}
          @param lvg a <code>LocalVariableGen</code></div>
<a id="L437" name="L437"></a> 437         <strong class="reserved">protected</strong> <strong class="reserved">void</strong> <a href="../S/6132.html#L585" title="Referred from 585 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">removeByNameTracking</a>(<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg) <em class="brace">{</em>
<a id="L438" name="L438"></a> 438             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> duplicateNameEntry = _nameToLVGMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(lvg.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L439" name="L439"></a> 439 
<a id="L440" name="L440"></a> 440             <strong class="reserved">if</strong> (duplicateNameEntry <strong class="reserved">instanceof</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) <em class="brace">{</em>
<a id="L441" name="L441"></a> 441                 <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> sameNameList = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) duplicateNameEntry;
<a id="L442" name="L442"></a> 442                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; sameNameList.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L443" name="L443"></a> 443                     <strong class="reserved">if</strong> (sameNameList.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i) == lvg) <em class="brace">{</em>
<a id="L444" name="L444"></a> 444                         sameNameList.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(i);
<a id="L445" name="L445"></a> 445                         <strong class="reserved">break</strong>;
<a id="L446" name="L446"></a> 446                     <em class="brace">}</em>
<a id="L447" name="L447"></a> 447                 <em class="brace">}</em>
<a id="L448" name="L448"></a> 448             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L449" name="L449"></a> 449                 _nameToLVGMap.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(lvg);
<a id="L450" name="L450"></a> 450             <em class="brace">}</em>
<a id="L451" name="L451"></a> 451         <em class="brace">}</em>
<a id="L452" name="L452"></a> 452 
<div class="comment">
          <p>Given the name of a variable, finds a {@link LocalVariableGen}
          corresponding to it.</p>
          <p>See also {@link #registerByName(LocalVariableGen)} and
          {@link #removeByNameTracking(LocalVariableGen)}</p>
          @param name
          @return</div>
<a id="L461" name="L461"></a> 461         <strong class="reserved">protected</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> <a href="../S/6132.html#L684" title="Referred from 684 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">lookUpByName</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L462" name="L462"></a> 462             <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg = <strong class="reserved">null</strong>;
<a id="L463" name="L463"></a> 463             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> duplicateNameEntry = _nameToLVGMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L464" name="L464"></a> 464 
<a id="L465" name="L465"></a> 465             <strong class="reserved">if</strong> (duplicateNameEntry <strong class="reserved">instanceof</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) <em class="brace">{</em>
<a id="L466" name="L466"></a> 466                 <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> sameNameList = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) duplicateNameEntry;
<a id="L467" name="L467"></a> 467 
<a id="L468" name="L468"></a> 468                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; sameNameList.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L469" name="L469"></a> 469                     lvg = (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)sameNameList.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L470" name="L470"></a> 470                     <strong class="reserved">if</strong> (lvg.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>() == <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L471" name="L471"></a> 471                         <strong class="reserved">break</strong>;
<a id="L472" name="L472"></a> 472                     <em class="brace">}</em>
<a id="L473" name="L473"></a> 473                 <em class="brace">}</em>
<a id="L474" name="L474"></a> 474             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L475" name="L475"></a> 475                 lvg = (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) duplicateNameEntry;
<a id="L476" name="L476"></a> 476             <em class="brace">}</em>
<a id="L477" name="L477"></a> 477 
<a id="L478" name="L478"></a> 478             <strong class="reserved">return</strong> lvg;
<a id="L479" name="L479"></a> 479         <em class="brace">}</em>
<a id="L480" name="L480"></a> 480 
<div class="comment">
          <p>Gets all {@link LocalVariableGen} objects for this method.</p>
          <p>When the <code>includeRemoved</code> argument has the value
          <code>false</code>, this method replaces uses of
          {@link MethodGen#getLocalVariables()} which has
          a side-effect of setting the start and end range for any
          <code>LocalVariableGen</code> if either was <code>null</code>.  That
          side-effect causes problems for outlining of code in XSLTC.
          @param includeRemoved Specifies whether all local variables ever
          declared should be returned (<code>true</code>) or only those not
          removed (<code>false</code>)
          @return an array of <code>LocalVariableGen</code> containing all the
          local variables</p></div>
<a id="L495" name="L495"></a> 495         <strong class="reserved">protected</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>[] <a href="../S/6132.html#L214" title="Referred from 214 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocals</a>(<strong class="reserved">boolean</strong> includeRemoved) <em class="brace">{</em>
<a id="L496" name="L496"></a> 496             <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>[] locals = <strong class="reserved">null</strong>;
<a id="L497" name="L497"></a> 497             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> allVarsEverDeclared = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L498" name="L498"></a> 498 
<a id="L499" name="L499"></a> 499             <strong class="reserved">if</strong> (includeRemoved) <em class="brace">{</em>
<a id="L500" name="L500"></a> 500                 <strong class="reserved">int</strong> slotCount = allVarsEverDeclared.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L501" name="L501"></a> 501 
<a id="L502" name="L502"></a> 502                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; slotCount; i++) <em class="brace">{</em>
<a id="L503" name="L503"></a> 503                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> slotEntries = _variables.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L504" name="L504"></a> 504                     <strong class="reserved">if</strong> (slotEntries != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L505" name="L505"></a> 505                         <strong class="reserved">if</strong> (slotEntries <strong class="reserved">instanceof</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) <em class="brace">{</em>
<a id="L506" name="L506"></a> 506                             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> slotList = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) slotEntries;
<a id="L507" name="L507"></a> 507 
<a id="L508" name="L508"></a> 508                             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; slotList.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); j++) <em class="brace">{</em>
<a id="L509" name="L509"></a> 509                                 allVarsEverDeclared.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(slotList.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i));
<a id="L510" name="L510"></a> 510                             <em class="brace">}</em>
<a id="L511" name="L511"></a> 511                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L512" name="L512"></a> 512                             allVarsEverDeclared.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(slotEntries);
<a id="L513" name="L513"></a> 513                         <em class="brace">}</em>
<a id="L514" name="L514"></a> 514                     <em class="brace">}</em>
<a id="L515" name="L515"></a> 515                 <em class="brace">}</em>
<a id="L516" name="L516"></a> 516             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L517" name="L517"></a> 517                 <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> nameVarsPairsIter = _nameToLVGMap.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L518" name="L518"></a> 518 
<a id="L519" name="L519"></a> 519                 <strong class="reserved">while</strong> (nameVarsPairsIter.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L520" name="L520"></a> 520                     <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> nameVarsPair =
<a id="L521" name="L521"></a> 521                                   (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>) nameVarsPairsIter.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L522" name="L522"></a> 522                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> vars = nameVarsPair.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L523" name="L523"></a> 523                     <strong class="reserved">if</strong> (vars != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L524" name="L524"></a> 524                         <strong class="reserved">if</strong> (vars <strong class="reserved">instanceof</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) <em class="brace">{</em>
<a id="L525" name="L525"></a> 525                             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> varsList = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>) vars;
<a id="L526" name="L526"></a> 526                             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; varsList.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L527" name="L527"></a> 527                                 allVarsEverDeclared.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(varsList.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i));
<a id="L528" name="L528"></a> 528                             <em class="brace">}</em>
<a id="L529" name="L529"></a> 529                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L530" name="L530"></a> 530                             allVarsEverDeclared.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(vars);
<a id="L531" name="L531"></a> 531                         <em class="brace">}</em>
<a id="L532" name="L532"></a> 532                     <em class="brace">}</em>
<a id="L533" name="L533"></a> 533                 <em class="brace">}</em>
<a id="L534" name="L534"></a> 534             <em class="brace">}</em>
<a id="L535" name="L535"></a> 535 
<a id="L536" name="L536"></a> 536             locals = <strong class="reserved">new</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>[allVarsEverDeclared.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()];
<a id="L537" name="L537"></a> 537             allVarsEverDeclared.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(locals);
<a id="L538" name="L538"></a> 538 
<a id="L539" name="L539"></a> 539             <strong class="reserved">return</strong> locals;
<a id="L540" name="L540"></a> 540         <em class="brace">}</em>
<a id="L541" name="L541"></a> 541     <em class="brace">}</em>
<a id="L542" name="L542"></a> 542 
<div class="comment">
      Determines whether a particular variable is in use at a particular offset
      in the byte code for this method.
      <p><b>Preconditions:</b>
      </p><ul><li>The {@link InstructionList#setPositions()} has been called for the
      {@link InstructionList} associated with this {@link MethodGenerator}.
      </li></ul><p></p>
      @param lvg the {@link LocalVariableGen} for the variable
      @param offset the position in the byte code
      @return <code>true</code> if and only if the specified variable is in
      use at the particular byte code offset.</div>
<a id="L556" name="L556"></a> 556     <strong class="reserved">boolean</strong> <a href="../R/23938.html" title="Multiple referred from 4 places.">offsetInLocalVariableGenRange</a>(<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg, <strong class="reserved">int</strong> <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>) <em class="brace">{</em>
<a id="L557" name="L557"></a> 557         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> lvgStart = lvg.<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>();
<a id="L558" name="L558"></a> 558         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> lvgEnd = lvg.<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>();
<a id="L559" name="L559"></a> 559 
<a id="L560" name="L560"></a> 560         <em class="comment">// If no start handle is recorded for the LocalVariableGen, it is</em>
<a id="L561" name="L561"></a> 561         <em class="comment">// assumed to be in use from the beginning of the method.</em>
<a id="L562" name="L562"></a> 562         <strong class="reserved">if</strong> (lvgStart == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L563" name="L563"></a> 563             lvgStart = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>().<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>();
<a id="L564" name="L564"></a> 564         <em class="brace">}</em>
<a id="L565" name="L565"></a> 565 
<a id="L566" name="L566"></a> 566         <em class="comment">// If no end handle is recorded for the LocalVariableGen, it is assumed</em>
<a id="L567" name="L567"></a> 567         <em class="comment">// to be in use to the end of the method.</em>
<a id="L568" name="L568"></a> 568         <strong class="reserved">if</strong> (lvgEnd == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L569" name="L569"></a> 569             lvgEnd = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>().<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>();
<a id="L570" name="L570"></a> 570         <em class="brace">}</em>
<a id="L571" name="L571"></a> 571 
<a id="L572" name="L572"></a> 572         <em class="comment">// Does the range of the instruction include the specified offset?</em>
<a id="L573" name="L573"></a> 573         <em class="comment">// Note that the InstructionHandle.getPosition method returns the</em>
<a id="L574" name="L574"></a> 574         <em class="comment">// offset of the beginning of an instruction.  A LocalVariableGen's</em>
<a id="L575" name="L575"></a> 575         <em class="comment">// range includes the end instruction itself, so that instruction's</em>
<a id="L576" name="L576"></a> 576         <em class="comment">// length must be taken into consideration in computing whether the</em>
<a id="L577" name="L577"></a> 577         <em class="comment">// varible is in range at a particular offset.</em>
<a id="L578" name="L578"></a> 578         <strong class="reserved">return</strong> ((lvgStart.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>() &lt;= <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>)
<a id="L579" name="L579"></a> 579                     &amp;&amp; (lvgEnd.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>()
<a id="L580" name="L580"></a> 580                             + lvgEnd.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>().<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>() &gt;= <a href="../D/28472.html" title="Multiple defined in 2 places.">offset</a>));
<a id="L581" name="L581"></a> 581     <em class="brace">}</em>
<a id="L582" name="L582"></a> 582 
<a id="L583" name="L583"></a> 583     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26007.html" title="Multiple referred from 7 places.">removeLocalVariable</a>(<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg) <em class="brace">{</em>
<a id="L584" name="L584"></a> 584         _slotAllocator.<a href="../S/6140.html#L82" title="Defined at 82 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/SlotAllocator.java.">releaseSlot</a>(lvg);
<a id="L585" name="L585"></a> 585         <a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>().<a href="../S/6132.html#L437" title="Defined at 437 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">removeByNameTracking</a>(lvg);
<a id="L586" name="L586"></a> 586         <strong class="reserved">super</strong>.<a href="../D/30860.html" title="Multiple defined in 2 places.">removeLocalVariable</a>(lvg);
<a id="L587" name="L587"></a> 587     <em class="brace">}</em>
<a id="L588" name="L588"></a> 588 
<a id="L589" name="L589"></a> 589     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/22565.html" title="Multiple referred from 87 places.">loadDOM</a>() <em class="brace">{</em>
<a id="L590" name="L590"></a> 590         <strong class="reserved">return</strong> _aloadDom;
<a id="L591" name="L591"></a> 591     <em class="brace">}</em>
<a id="L592" name="L592"></a> 592 
<a id="L593" name="L593"></a> 593     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28919.html" title="Multiple referred from 2 places.">storeDOM</a>() <em class="brace">{</em>
<a id="L594" name="L594"></a> 594         <strong class="reserved">return</strong> _astoreDom;
<a id="L595" name="L595"></a> 595     <em class="brace">}</em>
<a id="L596" name="L596"></a> 596 
<a id="L597" name="L597"></a> 597     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28922.html" title="Multiple referred from 12 places.">storeHandler</a>() <em class="brace">{</em>
<a id="L598" name="L598"></a> 598         <strong class="reserved">return</strong> _astoreHandler;
<a id="L599" name="L599"></a> 599     <em class="brace">}</em>
<a id="L600" name="L600"></a> 600 
<a id="L601" name="L601"></a> 601     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/22581.html" title="Multiple referred from 54 places.">loadHandler</a>() <em class="brace">{</em>
<a id="L602" name="L602"></a> 602         <strong class="reserved">return</strong> _aloadHandler;
<a id="L603" name="L603"></a> 603     <em class="brace">}</em>
<a id="L604" name="L604"></a> 604 
<a id="L605" name="L605"></a> 605     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28926.html" title="Multiple referred from 10 places.">storeIterator</a>() <em class="brace">{</em>
<a id="L606" name="L606"></a> 606         <strong class="reserved">return</strong> _astoreIterator;
<a id="L607" name="L607"></a> 607     <em class="brace">}</em>
<a id="L608" name="L608"></a> 608 
<a id="L609" name="L609"></a> 609     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/22591.html" title="Multiple referred from 19 places.">loadIterator</a>() <em class="brace">{</em>
<a id="L610" name="L610"></a> 610         <strong class="reserved">return</strong> _aloadIterator;
<a id="L611" name="L611"></a> 611     <em class="brace">}</em>
<a id="L612" name="L612"></a> 612 
<a id="L613" name="L613"></a> 613     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28221.html" title="Multiple referred from 52 places.">setStartNode</a>() <em class="brace">{</em>
<a id="L614" name="L614"></a> 614         <strong class="reserved">return</strong> _setStartNode;
<a id="L615" name="L615"></a> 615     <em class="brace">}</em>
<a id="L616" name="L616"></a> 616 
<a id="L617" name="L617"></a> 617     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/26238.html" title="Multiple referred from 619 places.">reset</a>() <em class="brace">{</em>
<a id="L618" name="L618"></a> 618         <strong class="reserved">return</strong> _reset;
<a id="L619" name="L619"></a> 619     <em class="brace">}</em>
<a id="L620" name="L620"></a> 620 
<a id="L621" name="L621"></a> 621     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/23682.html" title="Multiple referred from 192 places.">nextNode</a>() <em class="brace">{</em>
<a id="L622" name="L622"></a> 622         <strong class="reserved">return</strong> _nextNode;
<a id="L623" name="L623"></a> 623     <em class="brace">}</em>
<a id="L624" name="L624"></a> 624 
<a id="L625" name="L625"></a> 625     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28813.html" title="Multiple referred from 116 places.">startElement</a>() <em class="brace">{</em>
<a id="L626" name="L626"></a> 626         <strong class="reserved">return</strong> _startElement;
<a id="L627" name="L627"></a> 627     <em class="brace">}</em>
<a id="L628" name="L628"></a> 628 
<a id="L629" name="L629"></a> 629     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/13766.html" title="Multiple referred from 95 places.">endElement</a>() <em class="brace">{</em>
<a id="L630" name="L630"></a> 630         <strong class="reserved">return</strong> _endElement;
<a id="L631" name="L631"></a> 631     <em class="brace">}</em>
<a id="L632" name="L632"></a> 632 
<a id="L633" name="L633"></a> 633     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28800.html" title="Multiple referred from 67 places.">startDocument</a>() <em class="brace">{</em>
<a id="L634" name="L634"></a> 634         <strong class="reserved">return</strong> _startDocument;
<a id="L635" name="L635"></a> 635     <em class="brace">}</em>
<a id="L636" name="L636"></a> 636 
<a id="L637" name="L637"></a> 637     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/13761.html" title="Multiple referred from 58 places.">endDocument</a>() <em class="brace">{</em>
<a id="L638" name="L638"></a> 638         <strong class="reserved">return</strong> _endDocument;
<a id="L639" name="L639"></a> 639     <em class="brace">}</em>
<a id="L640" name="L640"></a> 640 
<a id="L641" name="L641"></a> 641     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/10402.html" title="Multiple referred from 896 places.">attribute</a>() <em class="brace">{</em>
<a id="L642" name="L642"></a> 642         <strong class="reserved">return</strong> _attribute;
<a id="L643" name="L643"></a> 643     <em class="brace">}</em>
<a id="L644" name="L644"></a> 644 
<a id="L645" name="L645"></a> 645     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/29687.html" title="Multiple referred from 4 places.">uniqueAttribute</a>() <em class="brace">{</em>
<a id="L646" name="L646"></a> 646         <strong class="reserved">return</strong> _uniqueAttribute;
<a id="L647" name="L647"></a> 647     <em class="brace">}</em>
<a id="L648" name="L648"></a> 648 
<a id="L649" name="L649"></a> 649     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/23435.html" title="Multiple referred from 554 places.">namespace</a>() <em class="brace">{</em>
<a id="L650" name="L650"></a> 650         <strong class="reserved">return</strong> _namespace;
<a id="L651" name="L651"></a> 651     <em class="brace">}</em>
<a id="L652" name="L652"></a> 652 
<a id="L653" name="L653"></a> 653     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/22564.html" title="Multiple referred from 31 places.">loadCurrentNode</a>() <em class="brace">{</em>
<a id="L654" name="L654"></a> 654         <strong class="reserved">if</strong> (_iloadCurrent == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L655" name="L655"></a> 655             <strong class="reserved">int</strong> idx = <a href="../D/20200.html" title="Multiple defined in 7 places.">getLocalIndex</a>("current");
<a id="L656" name="L656"></a> 656             <strong class="reserved">if</strong> (idx &gt; 0)
<a id="L657" name="L657"></a> 657                 _iloadCurrent = <strong class="reserved">new</strong> <a href="../S/4623.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ILOAD.java.">ILOAD</a>(idx);
<a id="L658" name="L658"></a> 658             <strong class="reserved">else</strong>
<a id="L659" name="L659"></a> 659                 _iloadCurrent = <strong class="reserved">new</strong> <a href="../S/4822.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/ICONST.java.">ICONST</a>(0);
<a id="L660" name="L660"></a> 660         <em class="brace">}</em>
<a id="L661" name="L661"></a> 661         <strong class="reserved">return</strong> _iloadCurrent;
<a id="L662" name="L662"></a> 662     <em class="brace">}</em>
<a id="L663" name="L663"></a> 663 
<a id="L664" name="L664"></a> 664     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28918.html" title="Multiple referred from 16 places.">storeCurrentNode</a>() <em class="brace">{</em>
<a id="L665" name="L665"></a> 665         <strong class="reserved">return</strong> _istoreCurrent != <strong class="reserved">null</strong>
<a id="L666" name="L666"></a> 666             ? _istoreCurrent
<a id="L667" name="L667"></a> 667             : (_istoreCurrent = <strong class="reserved">new</strong> <a href="../S/4787.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ISTORE.java.">ISTORE</a>(<a href="../D/20200.html" title="Multiple defined in 7 places.">getLocalIndex</a>("current")));
<a id="L668" name="L668"></a> 668     <em class="brace">}</em>
<a id="L669" name="L669"></a> 669 
<div class="comment">
     /** by default context node is the same as current node. MK437 */</div>
<a id="L671" name="L671"></a> 671     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/22562.html" title="Multiple referred from 19 places.">loadContextNode</a>() <em class="brace">{</em>
<a id="L672" name="L672"></a> 672         <strong class="reserved">return</strong> <a href="../D/26911.html" title="Multiple defined in 4 places.">loadCurrentNode</a>();
<a id="L673" name="L673"></a> 673     <em class="brace">}</em>
<a id="L674" name="L674"></a> 674 
<a id="L675" name="L675"></a> 675     <strong class="reserved">public</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> storeContextNode() <em class="brace">{</em>
<a id="L676" name="L676"></a> 676         <strong class="reserved">return</strong> <a href="../D/34898.html" title="Multiple defined in 4 places.">storeCurrentNode</a>();
<a id="L677" name="L677"></a> 677     <em class="brace">}</em>
<a id="L678" name="L678"></a> 678 
<a id="L679" name="L679"></a> 679     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/17418.html" title="Multiple referred from 18 places.">getLocalIndex</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L680" name="L680"></a> 680         <strong class="reserved">return</strong> <a href="../D/20218.html" title="Multiple defined in 7 places.">getLocalVariable</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>).<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L681" name="L681"></a> 681     <em class="brace">}</em>
<a id="L682" name="L682"></a> 682 
<a id="L683" name="L683"></a> 683     <strong class="reserved">public</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> <a href="../R/17432.html" title="Multiple referred from 5 places.">getLocalVariable</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L684" name="L684"></a> 684         <strong class="reserved">return</strong> <a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>().<a href="../S/6132.html#L461" title="Defined at 461 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">lookUpByName</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L685" name="L685"></a> 685     <em class="brace">}</em>
<a id="L686" name="L686"></a> 686 
<a id="L687" name="L687"></a> 687     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/27723.html" title="Multiple referred from 6 places.">setMaxLocals</a>() <em class="brace">{</em>
<a id="L688" name="L688"></a> 688 
<a id="L689" name="L689"></a> 689         <em class="comment">// Get the current number of local variable slots</em>
<a id="L690" name="L690"></a> 690         <strong class="reserved">int</strong> maxLocals = <strong class="reserved">super</strong>.<a href="../D/20454.html" title="Multiple defined in 2 places.">getMaxLocals</a>();
<a id="L691" name="L691"></a> 691         <strong class="reserved">int</strong> prevLocals = maxLocals;
<a id="L692" name="L692"></a> 692 
<a id="L693" name="L693"></a> 693         <em class="comment">// Get numer of actual variables</em>
<a id="L694" name="L694"></a> 694         <strong class="reserved">final</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>[] localVars = <strong class="reserved">super</strong>.<a href="../S/4802.html#L391" title="Defined at 391 in src/com/sun/org/apache/bcel/internal/generic/MethodGen.java.">getLocalVariables</a>();
<a id="L695" name="L695"></a> 695         <strong class="reserved">if</strong> (localVars != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L696" name="L696"></a> 696             <strong class="reserved">if</strong> (localVars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt; maxLocals)
<a id="L697" name="L697"></a> 697                 maxLocals = localVars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L698" name="L698"></a> 698         <em class="brace">}</em>
<a id="L699" name="L699"></a> 699 
<a id="L700" name="L700"></a> 700         <em class="comment">// We want at least 5 local variable slots (for parameters)</em>
<a id="L701" name="L701"></a> 701         <strong class="reserved">if</strong> (maxLocals &lt; 5) maxLocals = 5;
<a id="L702" name="L702"></a> 702 
<a id="L703" name="L703"></a> 703         <strong class="reserved">super</strong>.<a href="../D/33202.html" title="Multiple defined in 4 places.">setMaxLocals</a>(maxLocals);
<a id="L704" name="L704"></a> 704     <em class="brace">}</em>
<a id="L705" name="L705"></a> 705 
<div class="comment">
      Add a pre-compiled pattern to this mode.</div>
<a id="L709" name="L709"></a> 709     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../S/6189.html#L248" title="Referred from 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/TestSeq.java.">addInstructionList</a>(<a href="../D/6677.html" title="Multiple defined in 3 places.">Pattern</a> <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>, <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> ilist) <em class="brace">{</em>
<a id="L710" name="L710"></a> 710         _preCompiled.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>, ilist);
<a id="L711" name="L711"></a> 711     <em class="brace">}</em>
<a id="L712" name="L712"></a> 712 
<div class="comment">
      Get the instruction list for a pre-compiled pattern. Used by
      test sequences to avoid compiling patterns more than once.</div>
<a id="L717" name="L717"></a> 717     <strong class="reserved">public</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> <a href="../R/17124.html" title="Multiple referred from 209 places.">getInstructionList</a>(<a href="../D/6677.html" title="Multiple defined in 3 places.">Pattern</a> <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>) <em class="brace">{</em>
<a id="L718" name="L718"></a> 718         <strong class="reserved">return</strong> (<a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a>) _preCompiled.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>);
<a id="L719" name="L719"></a> 719     <em class="brace">}</em>
<a id="L720" name="L720"></a> 720 
<div class="comment">
      Used to keep track of an outlineable chunk of instructions in the
      current method.  See {@link OutlineableChunkStart} and
      {@link OutlineableChunkEnd} for more information.</div>
<a id="L726" name="L726"></a> 726     <strong class="reserved">private</strong> <strong class="reserved">class</strong> <a href="../R/1358.html" title="Multiple referred from 9 places.">Chunk</a> <strong class="reserved">implements</strong> <a href="../S/1704.html#L96" title="Defined at 96 in src/java/lang/Comparable.java.">Comparable</a> <em class="brace">{</em>
<div class="comment">
          {@link InstructionHandle} of the first instruction in the outlineable
          chunk.</div>
<a id="L731" name="L731"></a> 731         <strong class="reserved">private</strong> <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> m_start;
<a id="L732" name="L732"></a> 732 
<div class="comment">
          {@link org.apache.bcel.generic.InstructionHandle} of the first
          instruction in the outlineable chunk.</div>
<a id="L737" name="L737"></a> 737         <strong class="reserved">private</strong> <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> m_end;
<a id="L738" name="L738"></a> 738 
<div class="comment">
          Number of bytes in the instructions contained in this outlineable
          chunk.</div>
<a id="L743" name="L743"></a> 743         <strong class="reserved">private</strong> <strong class="reserved">int</strong> m_size;
<a id="L744" name="L744"></a> 744 
<div class="comment">
          <p>Constructor for an outlineable {@link MethodGenerator.Chunk}.</p>
          <p><b>Preconditions:</b>
          </p><ul><li>The {@link InstructionList#setPositions()} has been called for
          the {@link InstructionList} associated with this
          {@link MethodGenerator}.</li>
          </ul><p></p>
          @param start The {@link InstructionHandle} of the first
                       instruction in the outlineable chunk.
          @param end The {@link InstructionHandle} of the last
                     instruction in the outlineable chunk.</div>
<a id="L758" name="L758"></a> 758         Chunk(<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>) <em class="brace">{</em>
<a id="L759" name="L759"></a> 759             m_start = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>;
<a id="L760" name="L760"></a> 760             m_end = <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>;
<a id="L761" name="L761"></a> 761             m_size = <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>() - <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>();
<a id="L762" name="L762"></a> 762         <em class="brace">}</em>
<a id="L763" name="L763"></a> 763 
<div class="comment">
          Determines whether this outlineable {@link MethodGenerator.Chunk} is
          followed immediately by the argument
          <code>MethodGenerator.Chunk</code>, with no other intervening
          instructions, including {@link OutlineableChunkStart} or
          {@link OutlineableChunkEnd} instructions.
          @param neighbour an outlineable {@link MethodGenerator.Chunk}
          @return <code>true</code> if and only if the argument chunk
          immediately follows <code>this</code> chunk</div>
<a id="L774" name="L774"></a> 774         <strong class="reserved">boolean</strong> <a href="../S/6132.html#L1016" title="Referred from 1016 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">isAdjacentTo</a>(<a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a> neighbour) <em class="brace">{</em>
<a id="L775" name="L775"></a> 775             <strong class="reserved">return</strong> <a href="../S/6132.html#L791" title="Defined at 791 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkEnd</a>().<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>() == neighbour.<a href="../S/6132.html#L783" title="Defined at 783 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkStart</a>();
<a id="L776" name="L776"></a> 776         <em class="brace">}</em>
<a id="L777" name="L777"></a> 777 
<div class="comment">
          Getter method for the start of this {@linke MethodGenerator.Chunk}
          @return the {@link org.apache.bcel.generic.InstructionHandle} of the
          start of this chunk</div>
<a id="L783" name="L783"></a> 783         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../R/15569.html" title="Multiple referred from 3 places.">getChunkStart</a>() <em class="brace">{</em>
<a id="L784" name="L784"></a> 784             <strong class="reserved">return</strong> m_start;
<a id="L785" name="L785"></a> 785         <em class="brace">}</em>
<a id="L786" name="L786"></a> 786 
<div class="comment">
          Getter method for the end of this {@link MethodGenerator.Chunk}
          @return the {@link InstructionHandle} of the start of this chunk</div>
<a id="L791" name="L791"></a> 791         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../R/15566.html" title="Multiple referred from 3 places.">getChunkEnd</a>() <em class="brace">{</em>
<a id="L792" name="L792"></a> 792             <strong class="reserved">return</strong> m_end;
<a id="L793" name="L793"></a> 793         <em class="brace">}</em>
<a id="L794" name="L794"></a> 794 
<div class="comment">
          The size of this {@link MethodGenerator.Chunk}
          @return the number of bytes in the byte code represented by this
                  chunk.</div>
<a id="L800" name="L800"></a> 800         <strong class="reserved">int</strong> <a href="../R/15568.html" title="Multiple referred from 3 places.">getChunkSize</a>() <em class="brace">{</em>
<a id="L801" name="L801"></a> 801             <strong class="reserved">return</strong> m_size;
<a id="L802" name="L802"></a> 802         <em class="brace">}</em>
<a id="L803" name="L803"></a> 803 
<div class="comment">
          Implements the <code>java.util.Comparable.compareTo(Object)</code>
          method.
          @return
          <ul><li>A positive <code>int</code> if the length of <code>this</code>
          chunk in bytes is greater than that of <code>comparand</code></li><li>A negative <code>int</code> if the length of <code>this</code>
          chunk in bytes is less than that of <code>comparand</code></li><li>Zero, otherwise.</li>
          </ul></div>
<a id="L816" name="L816"></a> 816         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/11724.html" title="Multiple referred from 291 places.">compareTo</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> comparand) <em class="brace">{</em>
<a id="L817" name="L817"></a> 817             <strong class="reserved">return</strong> <a href="../S/6132.html#L800" title="Defined at 800 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkSize</a>() - ((<a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>)comparand).<a href="../S/6132.html#L800" title="Defined at 800 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkSize</a>();
<a id="L818" name="L818"></a> 818         <em class="brace">}</em>
<a id="L819" name="L819"></a> 819     <em class="brace">}</em>
<a id="L820" name="L820"></a> 820 
<div class="comment">
      Find the outlineable chunks in this method that would be the best choices
      to outline, based on size and position in the method.
      @param classGen The {@link ClassGen} with which the generated methods
                      will be associated
      @param totalMethodSize the size of the bytecode in the original method
      @return a <code>java.util.ArrayList</code> containing the
       {@link MethodGenerator.Chunk}s that may be outlined from this method</div>
<a id="L830" name="L830"></a> 830     <strong class="reserved">private</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> <a href="../S/6132.html#L1160" title="Referred from 1160 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getCandidateChunks</a>(<a href="../S/6130.html#L50" title="Defined at 50 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">ClassGenerator</a> classGen,
<a id="L831" name="L831"></a> 831                                          <strong class="reserved">int</strong> totalMethodSize) <em class="brace">{</em>
<a id="L832" name="L832"></a> 832         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> instructions = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L833" name="L833"></a> 833         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> candidateChunks = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L834" name="L834"></a> 834         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> currLevelChunks = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L835" name="L835"></a> 835         <a href="../S/1186.html#L49" title="Defined at 49 in src/java/util/Stack.java.">Stack</a> subChunkStack = <strong class="reserved">new</strong> <a href="../S/1186.html#L49" title="Defined at 49 in src/java/util/Stack.java.">Stack</a>();
<a id="L836" name="L836"></a> 836         <strong class="reserved">boolean</strong> openChunkAtCurrLevel = <strong class="reserved">false</strong>;
<a id="L837" name="L837"></a> 837         <strong class="reserved">boolean</strong> firstInstruction = <strong class="reserved">true</strong>;
<a id="L838" name="L838"></a> 838 
<a id="L839" name="L839"></a> 839         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> currentHandle;
<a id="L840" name="L840"></a> 840 
<a id="L841" name="L841"></a> 841         <strong class="reserved">if</strong> (m_openChunks != 0) <em class="brace">{</em>
<a id="L842" name="L842"></a> 842             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> =
<a id="L843" name="L843"></a> 843                 (<strong class="reserved">new</strong> <a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>(<a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>.OUTLINE_ERR_UNBALANCED_MARKERS))
<a id="L844" name="L844"></a> 844                     .<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L845" name="L845"></a> 845             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L846" name="L846"></a> 846         <em class="brace">}</em>
<a id="L847" name="L847"></a> 847 
<a id="L848" name="L848"></a> 848         <em class="comment">// Scan instructions in the method, keeping track of the nesting level</em>
<a id="L849" name="L849"></a> 849         <em class="comment">// of outlineable chunks.</em>
<a id="L850" name="L850"></a> 850         <em class="comment">//</em>
<a id="L851" name="L851"></a> 851         <em class="comment">// currLevelChunks</em>
<a id="L852" name="L852"></a> 852         <em class="comment">//     keeps track of the child chunks of a chunk.  For each chunk,</em>
<a id="L853" name="L853"></a> 853         <em class="comment">//     there will be a pair of entries:  the InstructionHandles for the</em>
<a id="L854" name="L854"></a> 854         <em class="comment">//     start and for the end of the chunk</em>
<a id="L855" name="L855"></a> 855         <em class="comment">// subChunkStack</em>
<a id="L856" name="L856"></a> 856         <em class="comment">//     a stack containing the partially accumulated currLevelChunks for</em>
<a id="L857" name="L857"></a> 857         <em class="comment">//     each chunk that's still open at the current position in the</em>
<a id="L858" name="L858"></a> 858         <em class="comment">//     InstructionList.</em>
<a id="L859" name="L859"></a> 859         <em class="comment">// candidateChunks</em>
<a id="L860" name="L860"></a> 860         <em class="comment">//     the list of chunks which have been accepted as candidates chunks</em>
<a id="L861" name="L861"></a> 861         <em class="comment">//     for outlining</em>
<a id="L862" name="L862"></a> 862         <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L863" name="L863"></a> 863             <em class="comment">// Get the next instruction.  The loop will perform one extra</em>
<a id="L864" name="L864"></a> 864             <em class="comment">// iteration after it reaches the end of the InstructionList, with</em>
<a id="L865" name="L865"></a> 865             <em class="comment">// currentHandle set to null.</em>
<a id="L866" name="L866"></a> 866             currentHandle = instructions.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()
<a id="L867" name="L867"></a> 867                                     ? (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>) instructions.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>()
<a id="L868" name="L868"></a> 868                                     : <strong class="reserved">null</strong>;
<a id="L869" name="L869"></a> 869             <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> inst =
<a id="L870" name="L870"></a> 870                     (currentHandle != <strong class="reserved">null</strong>) ? currentHandle.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>()
<a id="L871" name="L871"></a> 871                                             : <strong class="reserved">null</strong>;
<a id="L872" name="L872"></a> 872 
<a id="L873" name="L873"></a> 873             <em class="comment">// At the first iteration, create a chunk representing all the</em>
<a id="L874" name="L874"></a> 874             <em class="comment">// code in the method.  This is done just to simplify the logic -</em>
<a id="L875" name="L875"></a> 875             <em class="comment">// this chunk can never be outlined because it will be too big.</em>
<a id="L876" name="L876"></a> 876             <strong class="reserved">if</strong> (firstInstruction) <em class="brace">{</em>
<a id="L877" name="L877"></a> 877                 openChunkAtCurrLevel = <strong class="reserved">true</strong>;
<a id="L878" name="L878"></a> 878                 currLevelChunks.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(currentHandle);
<a id="L879" name="L879"></a> 879                 firstInstruction = <strong class="reserved">false</strong>;
<a id="L880" name="L880"></a> 880             <em class="brace">}</em>
<a id="L881" name="L881"></a> 881 
<a id="L882" name="L882"></a> 882             <em class="comment">// Found a new chunk</em>
<a id="L883" name="L883"></a> 883             <strong class="reserved">if</strong> (inst <strong class="reserved">instanceof</strong> <a href="../S/6121.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/OutlineableChunkStart.java.">OutlineableChunkStart</a>) <em class="brace">{</em>
<a id="L884" name="L884"></a> 884                 <em class="comment">// If last MarkerInstruction encountered was an</em>
<a id="L885" name="L885"></a> 885                 <em class="comment">// OutlineableChunkStart, this represents the first chunk</em>
<a id="L886" name="L886"></a> 886                 <em class="comment">// nested within that previous chunk - push the list of chunks</em>
<a id="L887" name="L887"></a> 887                 <em class="comment">// from the outer level onto the stack</em>
<a id="L888" name="L888"></a> 888                 <strong class="reserved">if</strong> (openChunkAtCurrLevel) <em class="brace">{</em>
<a id="L889" name="L889"></a> 889                     subChunkStack.<a href="../D/29933.html" title="Multiple defined in 37 places.">push</a>(currLevelChunks);
<a id="L890" name="L890"></a> 890                     currLevelChunks = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L891" name="L891"></a> 891                 <em class="brace">}</em>
<a id="L892" name="L892"></a> 892 
<a id="L893" name="L893"></a> 893                 openChunkAtCurrLevel = <strong class="reserved">true</strong>;
<a id="L894" name="L894"></a> 894                 currLevelChunks.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(currentHandle);
<a id="L895" name="L895"></a> 895             <em class="comment">// Close off an open chunk</em>
<a id="L896" name="L896"></a> 896             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (currentHandle == <strong class="reserved">null</strong>
<a id="L897" name="L897"></a> 897                            || inst <strong class="reserved">instanceof</strong> <a href="../S/6099.html#L31" title="Defined at 31 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/OutlineableChunkEnd.java.">OutlineableChunkEnd</a>) <em class="brace">{</em>
<a id="L898" name="L898"></a> 898                 <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> nestedSubChunks = <strong class="reserved">null</strong>;
<a id="L899" name="L899"></a> 899 
<a id="L900" name="L900"></a> 900                 <em class="comment">// If the last MarkerInstruction encountered was an</em>
<a id="L901" name="L901"></a> 901                 <em class="comment">// OutlineableChunkEnd, it means that the current instruction</em>
<a id="L902" name="L902"></a> 902                 <em class="comment">// marks the end of a chunk that contained child chunks.</em>
<a id="L903" name="L903"></a> 903                 <em class="comment">// Those children might need to be examined below in case they</em>
<a id="L904" name="L904"></a> 904                 <em class="comment">// are better candidates for outlining than the current chunk.</em>
<a id="L905" name="L905"></a> 905                 <strong class="reserved">if</strong> (!openChunkAtCurrLevel) <em class="brace">{</em>
<a id="L906" name="L906"></a> 906                     nestedSubChunks = currLevelChunks;
<a id="L907" name="L907"></a> 907                     currLevelChunks = (<a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>)subChunkStack.<a href="../D/29416.html" title="Multiple defined in 30 places.">pop</a>();
<a id="L908" name="L908"></a> 908                 <em class="brace">}</em>
<a id="L909" name="L909"></a> 909 
<a id="L910" name="L910"></a> 910                 <em class="comment">// Get the handle for the start of this chunk (the last entry</em>
<a id="L911" name="L911"></a> 911                 <em class="comment">// in currLevelChunks)</em>
<a id="L912" name="L912"></a> 912                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> chunkStart =
<a id="L913" name="L913"></a> 913                         (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>) currLevelChunks.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(
<a id="L914" name="L914"></a> 914                                                       currLevelChunks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()-1);
<a id="L915" name="L915"></a> 915 
<a id="L916" name="L916"></a> 916                 <strong class="reserved">int</strong> chunkEndPosition =
<a id="L917" name="L917"></a> 917                         (currentHandle != <strong class="reserved">null</strong>) ? currentHandle.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>()
<a id="L918" name="L918"></a> 918                                                 : totalMethodSize;
<a id="L919" name="L919"></a> 919                 <strong class="reserved">int</strong> <a href="../S/898.html#L116" title="Defined at 116 in src/java/util/stream/AbstractSpinedBuffer.java.">chunkSize</a> = chunkEndPosition - chunkStart.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>();
<a id="L920" name="L920"></a> 920 
<a id="L921" name="L921"></a> 921                 <em class="comment">// Two ranges of chunk size to consider:</em>
<a id="L922" name="L922"></a> 922                 <em class="comment">//</em>
<a id="L923" name="L923"></a> 923                 <em class="comment">// 1. [0,TARGET_METHOD_SIZE]</em>
<a id="L924" name="L924"></a> 924                 <em class="comment">//      Keep this chunk in consideration as a candidate,</em>
<a id="L925" name="L925"></a> 925                 <em class="comment">//      and ignore its subchunks, if any - there's nothing to be</em>
<a id="L926" name="L926"></a> 926                 <em class="comment">//      gained by outlining both the current chunk and its</em>
<a id="L927" name="L927"></a> 927                 <em class="comment">//      children!</em>
<a id="L928" name="L928"></a> 928                 <em class="comment">//</em>
<a id="L929" name="L929"></a> 929                 <em class="comment">// 2. (TARGET_METHOD_SIZE,+infinity)</em>
<a id="L930" name="L930"></a> 930                 <em class="comment">//      Ignore this chunk - it's too big.  Add its subchunks</em>
<a id="L931" name="L931"></a> 931                 <em class="comment">//      as candidates, after merging adjacent chunks to produce</em>
<a id="L932" name="L932"></a> 932                 <em class="comment">//      chunks that are as large as possible</em>
<a id="L933" name="L933"></a> 933                 <strong class="reserved">if</strong> (<a href="../S/898.html#L116" title="Defined at 116 in src/java/util/stream/AbstractSpinedBuffer.java.">chunkSize</a> &lt;= TARGET_METHOD_SIZE) <em class="brace">{</em>
<a id="L934" name="L934"></a> 934                     currLevelChunks.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(currentHandle);
<a id="L935" name="L935"></a> 935                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L936" name="L936"></a> 936                     <strong class="reserved">if</strong> (!openChunkAtCurrLevel) <em class="brace">{</em>
<a id="L937" name="L937"></a> 937                         <strong class="reserved">int</strong> childChunkCount = nestedSubChunks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() / 2;
<a id="L938" name="L938"></a> 938                         <strong class="reserved">if</strong> (childChunkCount &gt; 0) <em class="brace">{</em>
<a id="L939" name="L939"></a> 939                             <a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>[] childChunks = <strong class="reserved">new</strong> <a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>[childChunkCount];
<a id="L940" name="L940"></a> 940 
<a id="L941" name="L941"></a> 941                             <em class="comment">// Gather all the child chunks of the current chunk</em>
<a id="L942" name="L942"></a> 942                             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; childChunkCount; i++) <em class="brace">{</em>
<a id="L943" name="L943"></a> 943                                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> =
<a id="L944" name="L944"></a> 944                                     (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>) nestedSubChunks
<a id="L945" name="L945"></a> 945                                                             .<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i*2);
<a id="L946" name="L946"></a> 946                                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a> =
<a id="L947" name="L947"></a> 947                                     (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>) nestedSubChunks
<a id="L948" name="L948"></a> 948                                                             .<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i*2+1);
<a id="L949" name="L949"></a> 949 
<a id="L950" name="L950"></a> 950                                 childChunks[i] = <strong class="reserved">new</strong> <a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>(<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>);
<a id="L951" name="L951"></a> 951                             <em class="brace">}</em>
<a id="L952" name="L952"></a> 952 
<a id="L953" name="L953"></a> 953                             <em class="comment">// Merge adjacent siblings</em>
<a id="L954" name="L954"></a> 954                             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> mergedChildChunks =
<a id="L955" name="L955"></a> 955                                         <a href="../S/6132.html#L996" title="Defined at 996 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">mergeAdjacentChunks</a>(childChunks);
<a id="L956" name="L956"></a> 956 
<a id="L957" name="L957"></a> 957                             <em class="comment">// Add chunks that mean minimum size requirements</em>
<a id="L958" name="L958"></a> 958                             <em class="comment">// to the list of candidate chunks for outlining</em>
<a id="L959" name="L959"></a> 959                             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; mergedChildChunks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); i++) <em class="brace">{</em>
<a id="L960" name="L960"></a> 960                                 <a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a> mergedChunk =
<a id="L961" name="L961"></a> 961                                     (<a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>)mergedChildChunks.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L962" name="L962"></a> 962                                 <strong class="reserved">int</strong> mergedSize = mergedChunk.<a href="../S/6132.html#L800" title="Defined at 800 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkSize</a>();
<a id="L963" name="L963"></a> 963 
<a id="L964" name="L964"></a> 964                                 <strong class="reserved">if</strong> (mergedSize &gt;= MINIMUM_OUTLINEABLE_CHUNK_SIZE
<a id="L965" name="L965"></a> 965                                         &amp;&amp; mergedSize &lt;= TARGET_METHOD_SIZE) <em class="brace">{</em>
<a id="L966" name="L966"></a> 966                                     candidateChunks.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(mergedChunk);
<a id="L967" name="L967"></a> 967                                 <em class="brace">}</em>
<a id="L968" name="L968"></a> 968                             <em class="brace">}</em>
<a id="L969" name="L969"></a> 969                         <em class="brace">}</em>
<a id="L970" name="L970"></a> 970                     <em class="brace">}</em>
<a id="L971" name="L971"></a> 971 
<a id="L972" name="L972"></a> 972                     <em class="comment">// Drop the chunk which was too big</em>
<a id="L973" name="L973"></a> 973                     currLevelChunks.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(currLevelChunks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() - 1);
<a id="L974" name="L974"></a> 974                 <em class="brace">}</em>
<a id="L975" name="L975"></a> 975 
<a id="L976" name="L976"></a> 976                 <em class="comment">// currLevelChunks contains pairs of InstructionHandles.  If</em>
<a id="L977" name="L977"></a> 977                 <em class="comment">// its size is an odd number, the loop has encountered the</em>
<a id="L978" name="L978"></a> 978                 <em class="comment">// start of a chunk at this level, but not its end.</em>
<a id="L979" name="L979"></a> 979                 openChunkAtCurrLevel = ((currLevelChunks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() &amp; 0x1) == 1);
<a id="L980" name="L980"></a> 980             <em class="brace">}</em>
<a id="L981" name="L981"></a> 981 
<a id="L982" name="L982"></a> 982         <em class="brace">}</em> <strong class="reserved">while</strong> (currentHandle != <strong class="reserved">null</strong>);
<a id="L983" name="L983"></a> 983 
<a id="L984" name="L984"></a> 984         <strong class="reserved">return</strong> candidateChunks;
<a id="L985" name="L985"></a> 985     <em class="brace">}</em>
<a id="L986" name="L986"></a> 986 
<div class="comment">
      Merge adjacent sibling chunks to produce larger candidate chunks for
      outlining
      @param chunks array of sibling {@link MethodGenerator.Chunk}s that are
                    under consideration for outlining.  Chunks must be in
                    the order encountered in the {@link InstructionList}
      @return a <code>java.util.ArrayList</code> of
              <code>MethodGenerator.Chunk</code>s maximally merged</div>
<a id="L996" name="L996"></a> 996     <strong class="reserved">private</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> <a href="../S/6132.html#L955" title="Referred from 955 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">mergeAdjacentChunks</a>(<a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>[] chunks) <em class="brace">{</em>
<a id="L997" name="L997"></a> 997         <strong class="reserved">int</strong>[] adjacencyRunStart = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L998" name="L998"></a> 998         <strong class="reserved">int</strong>[] adjacencyRunLength = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L999" name="L999"></a> 999         <strong class="reserved">boolean</strong>[] chunkWasMerged = <strong class="reserved">new</strong> <strong class="reserved">boolean</strong>[chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L1000" name="L1000"></a>1000 
<a id="L1001" name="L1001"></a>1001         <strong class="reserved">int</strong> maximumRunOfChunks = 0;
<a id="L1002" name="L1002"></a>1002         <strong class="reserved">int</strong> startOfCurrentRun;
<a id="L1003" name="L1003"></a>1003         <strong class="reserved">int</strong> numAdjacentRuns = 0;
<a id="L1004" name="L1004"></a>1004 
<a id="L1005" name="L1005"></a>1005         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> mergedChunks = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L1006" name="L1006"></a>1006 
<a id="L1007" name="L1007"></a>1007         startOfCurrentRun = 0;
<a id="L1008" name="L1008"></a>1008 
<a id="L1009" name="L1009"></a>1009         <em class="comment">// Loop through chunks, and record in adjacencyRunStart where each</em>
<a id="L1010" name="L1010"></a>1010         <em class="comment">// run of adjacent chunks begins and how many are in that run.  For</em>
<a id="L1011" name="L1011"></a>1011         <em class="comment">// example, given chunks A B C D E F, if A is adjacent to B, but not</em>
<a id="L1012" name="L1012"></a>1012         <em class="comment">// to C, and C, D, E and F are all adjacent,</em>
<a id="L1013" name="L1013"></a>1013         <em class="comment">//   adjacencyRunStart[0] == 0; adjacencyRunLength[0] == 2</em>
<a id="L1014" name="L1014"></a>1014         <em class="comment">//   adjacencyRunStart[1] == 2; adjacencyRunLength[1] == 4</em>
<a id="L1015" name="L1015"></a>1015         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 1; i &lt; chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1016" name="L1016"></a>1016             <strong class="reserved">if</strong> (!chunks[i-1].<a href="../S/6132.html#L774" title="Defined at 774 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">isAdjacentTo</a>(chunks[i])) <em class="brace">{</em>
<a id="L1017" name="L1017"></a>1017                 <strong class="reserved">int</strong> lengthOfRun = i - startOfCurrentRun;
<a id="L1018" name="L1018"></a>1018 
<a id="L1019" name="L1019"></a>1019                 <em class="comment">// Track the longest run of chunks found</em>
<a id="L1020" name="L1020"></a>1020                 <strong class="reserved">if</strong> (maximumRunOfChunks &lt; lengthOfRun) <em class="brace">{</em>
<a id="L1021" name="L1021"></a>1021                     maximumRunOfChunks = lengthOfRun;
<a id="L1022" name="L1022"></a>1022                 <em class="brace">}</em>
<a id="L1023" name="L1023"></a>1023 
<a id="L1024" name="L1024"></a>1024                 <strong class="reserved">if</strong> (lengthOfRun &gt; 1 ) <em class="brace">{</em>
<a id="L1025" name="L1025"></a>1025                     adjacencyRunLength[numAdjacentRuns] = lengthOfRun;
<a id="L1026" name="L1026"></a>1026                     adjacencyRunStart[numAdjacentRuns] = startOfCurrentRun;
<a id="L1027" name="L1027"></a>1027                     numAdjacentRuns++;
<a id="L1028" name="L1028"></a>1028                 <em class="brace">}</em>
<a id="L1029" name="L1029"></a>1029 
<a id="L1030" name="L1030"></a>1030                 startOfCurrentRun = i;
<a id="L1031" name="L1031"></a>1031             <em class="brace">}</em>
<a id="L1032" name="L1032"></a>1032         <em class="brace">}</em>
<a id="L1033" name="L1033"></a>1033 
<a id="L1034" name="L1034"></a>1034         <strong class="reserved">if</strong> (chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - startOfCurrentRun &gt; 1) <em class="brace">{</em>
<a id="L1035" name="L1035"></a>1035             <strong class="reserved">int</strong> lengthOfRun = chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - startOfCurrentRun;
<a id="L1036" name="L1036"></a>1036 
<a id="L1037" name="L1037"></a>1037             <em class="comment">// Track the longest run of chunks found</em>
<a id="L1038" name="L1038"></a>1038             <strong class="reserved">if</strong> (maximumRunOfChunks &lt; lengthOfRun) <em class="brace">{</em>
<a id="L1039" name="L1039"></a>1039                 maximumRunOfChunks = lengthOfRun;
<a id="L1040" name="L1040"></a>1040             <em class="brace">}</em>
<a id="L1041" name="L1041"></a>1041 
<a id="L1042" name="L1042"></a>1042             adjacencyRunLength[numAdjacentRuns] =
<a id="L1043" name="L1043"></a>1043                         chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - startOfCurrentRun;
<a id="L1044" name="L1044"></a>1044             adjacencyRunStart[numAdjacentRuns] = startOfCurrentRun;
<a id="L1045" name="L1045"></a>1045             numAdjacentRuns++;
<a id="L1046" name="L1046"></a>1046         <em class="brace">}</em>
<a id="L1047" name="L1047"></a>1047 
<a id="L1048" name="L1048"></a>1048         <em class="comment">// Try merging adjacent chunks to come up with better sized chunks for</em>
<a id="L1049" name="L1049"></a>1049         <em class="comment">// outlining.  This algorithm is not optimal, but it should be</em>
<a id="L1050" name="L1050"></a>1050         <em class="comment">// reasonably fast.  Consider an example like this, where four chunks</em>
<a id="L1051" name="L1051"></a>1051         <em class="comment">// of the sizes specified in brackets are adjacent.  The best way of</em>
<a id="L1052" name="L1052"></a>1052         <em class="comment">// combining these chunks would be to merge the first pair and merge</em>
<a id="L1053" name="L1053"></a>1053         <em class="comment">// the last three to form two chunks, but the algorithm will merge the</em>
<a id="L1054" name="L1054"></a>1054         <em class="comment">// three in the middle instead, leaving three chunks in all.</em>
<a id="L1055" name="L1055"></a>1055         <em class="comment">//    [25000] [25000] [20000] [1000] [20000]</em>
<a id="L1056" name="L1056"></a>1056 
<a id="L1057" name="L1057"></a>1057         <em class="comment">// Start by trying to merge the maximum number of adjacent chunks, and</em>
<a id="L1058" name="L1058"></a>1058         <em class="comment">// work down from there.</em>
<a id="L1059" name="L1059"></a>1059         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> numToMerge = maximumRunOfChunks; numToMerge&gt;1; numToMerge--) <em class="brace">{</em>
<a id="L1060" name="L1060"></a>1060             <em class="comment">// Look at each run of adjacent chunks</em>
<a id="L1061" name="L1061"></a>1061             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> &lt; numAdjacentRuns; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>++) <em class="brace">{</em>
<a id="L1062" name="L1062"></a>1062                 <strong class="reserved">int</strong> runStart = adjacencyRunStart[<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>];
<a id="L1063" name="L1063"></a>1063                 <strong class="reserved">int</strong> runEnd = runStart + adjacencyRunLength[<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>] - 1;
<a id="L1064" name="L1064"></a>1064 
<a id="L1065" name="L1065"></a>1065                 <strong class="reserved">boolean</strong> foundChunksToMerge = <strong class="reserved">false</strong>;
<a id="L1066" name="L1066"></a>1066 
<a id="L1067" name="L1067"></a>1067                 <em class="comment">// Within the current run of adjacent chunks, look at all</em>
<a id="L1068" name="L1068"></a>1068                 <em class="comment">// "subruns" of length numToMerge, until we run out or find</em>
<a id="L1069" name="L1069"></a>1069                 <em class="comment">// a subrun that can be merged.</em>
<a id="L1070" name="L1070"></a>1070                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> mergeStart = runStart;
<a id="L1071" name="L1071"></a>1071                      mergeStart+numToMerge-1 &lt;= runEnd &amp;&amp; !foundChunksToMerge;
<a id="L1072" name="L1072"></a>1072                      mergeStart++) <em class="brace">{</em>
<a id="L1073" name="L1073"></a>1073                     <strong class="reserved">int</strong> mergeEnd = mergeStart + numToMerge - 1;
<a id="L1074" name="L1074"></a>1074                     <strong class="reserved">int</strong> mergeSize = 0;
<a id="L1075" name="L1075"></a>1075 
<a id="L1076" name="L1076"></a>1076                     <em class="comment">// Find out how big the subrun is</em>
<a id="L1077" name="L1077"></a>1077                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = mergeStart; j &lt;= mergeEnd; j++) <em class="brace">{</em>
<a id="L1078" name="L1078"></a>1078                         mergeSize = mergeSize + chunks[j].<a href="../S/6132.html#L800" title="Defined at 800 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkSize</a>();
<a id="L1079" name="L1079"></a>1079                     <em class="brace">}</em>
<a id="L1080" name="L1080"></a>1080 
<a id="L1081" name="L1081"></a>1081                     <em class="comment">// If the current subrun is small enough to outline,</em>
<a id="L1082" name="L1082"></a>1082                     <em class="comment">// merge it, and split the remaining chunks in the run</em>
<a id="L1083" name="L1083"></a>1083                     <strong class="reserved">if</strong> (mergeSize &lt;= TARGET_METHOD_SIZE) <em class="brace">{</em>
<a id="L1084" name="L1084"></a>1084                         foundChunksToMerge = <strong class="reserved">true</strong>;
<a id="L1085" name="L1085"></a>1085 
<a id="L1086" name="L1086"></a>1086                         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = mergeStart; j &lt;= mergeEnd; j++) <em class="brace">{</em>
<a id="L1087" name="L1087"></a>1087                             chunkWasMerged[j] = <strong class="reserved">true</strong>;
<a id="L1088" name="L1088"></a>1088                         <em class="brace">}</em>
<a id="L1089" name="L1089"></a>1089 
<a id="L1090" name="L1090"></a>1090                         mergedChunks.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(
<a id="L1091" name="L1091"></a>1091                                 <strong class="reserved">new</strong> <a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>(chunks[mergeStart].<a href="../S/6132.html#L783" title="Defined at 783 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkStart</a>(),
<a id="L1092" name="L1092"></a>1092                                           chunks[mergeEnd].<a href="../S/6132.html#L791" title="Defined at 791 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkEnd</a>()));
<a id="L1093" name="L1093"></a>1093 
<a id="L1094" name="L1094"></a>1094                         <em class="comment">// Adjust the length of the current run of adjacent</em>
<a id="L1095" name="L1095"></a>1095                         <em class="comment">// chunks to end at the newly merged chunk...</em>
<a id="L1096" name="L1096"></a>1096                         adjacencyRunLength[<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>] =
<a id="L1097" name="L1097"></a>1097                                 adjacencyRunStart[<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>] - mergeStart;
<a id="L1098" name="L1098"></a>1098 
<a id="L1099" name="L1099"></a>1099                         <strong class="reserved">int</strong> trailingRunLength = runEnd - mergeEnd;
<a id="L1100" name="L1100"></a>1100 
<a id="L1101" name="L1101"></a>1101                         <em class="comment">// and any chunks that follow the newly merged chunk</em>
<a id="L1102" name="L1102"></a>1102                         <em class="comment">// in the current run of adjacent chunks form another</em>
<a id="L1103" name="L1103"></a>1103                         <em class="comment">// new run of adjacent chunks</em>
<a id="L1104" name="L1104"></a>1104                         <strong class="reserved">if</strong> (trailingRunLength &gt;= 2) <em class="brace">{</em>
<a id="L1105" name="L1105"></a>1105                             adjacencyRunStart[numAdjacentRuns] = mergeEnd + 1;
<a id="L1106" name="L1106"></a>1106                             adjacencyRunLength[numAdjacentRuns] =
<a id="L1107" name="L1107"></a>1107                                                             trailingRunLength;
<a id="L1108" name="L1108"></a>1108                             numAdjacentRuns++;
<a id="L1109" name="L1109"></a>1109                         <em class="brace">}</em>
<a id="L1110" name="L1110"></a>1110                     <em class="brace">}</em>
<a id="L1111" name="L1111"></a>1111                 <em class="brace">}</em>
<a id="L1112" name="L1112"></a>1112             <em class="brace">}</em>
<a id="L1113" name="L1113"></a>1113         <em class="brace">}</em>
<a id="L1114" name="L1114"></a>1114 
<a id="L1115" name="L1115"></a>1115         <em class="comment">// Make a final pass for any chunk that wasn't merged with a sibling</em>
<a id="L1116" name="L1116"></a>1116         <em class="comment">// and include it in the list of chunks after merging.</em>
<a id="L1117" name="L1117"></a>1117         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; chunks.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1118" name="L1118"></a>1118             <strong class="reserved">if</strong> (!chunkWasMerged[i]) <em class="brace">{</em>
<a id="L1119" name="L1119"></a>1119                 mergedChunks.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(chunks[i]);
<a id="L1120" name="L1120"></a>1120             <em class="brace">}</em>
<a id="L1121" name="L1121"></a>1121         <em class="brace">}</em>
<a id="L1122" name="L1122"></a>1122 
<a id="L1123" name="L1123"></a>1123         <strong class="reserved">return</strong> mergedChunks;
<a id="L1124" name="L1124"></a>1124     <em class="brace">}</em>
<a id="L1125" name="L1125"></a>1125 
<div class="comment">
      Breaks up the IL for this {@link MethodGenerator} into separate
      outlined methods so that no method exceeds the 64KB limit on the length
      of the byte code associated with a method.
      @param classGen The {@link ClassGen} with which the generated methods
                      will be associated
      @param originalMethodSize The number of bytes of bytecode represented by
                      the {@link InstructionList} of this method
      @return an array of the outlined <code>Method</code>s and the original
              method itself</div>
<a id="L1137" name="L1137"></a>1137     <strong class="reserved">public</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] <a href="../S/6132.html#L1905" title="Referred from 1905 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">outlineChunks</a>(<a href="../S/6130.html#L50" title="Defined at 50 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">ClassGenerator</a> classGen,
<a id="L1138" name="L1138"></a>1138                                   <strong class="reserved">int</strong> originalMethodSize) <em class="brace">{</em>
<a id="L1139" name="L1139"></a>1139         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> methodsOutlined = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>();
<a id="L1140" name="L1140"></a>1140         <strong class="reserved">int</strong> currentMethodSize = originalMethodSize;
<a id="L1141" name="L1141"></a>1141 
<a id="L1142" name="L1142"></a>1142         <strong class="reserved">int</strong> outlinedCount = 0;
<a id="L1143" name="L1143"></a>1143         <strong class="reserved">boolean</strong> moreMethodsOutlined;
<a id="L1144" name="L1144"></a>1144         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> originalMethodName = <a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L1145" name="L1145"></a>1145 
<a id="L1146" name="L1146"></a>1146         <em class="comment">// Special handling for initialization methods.  No other methods can</em>
<a id="L1147" name="L1147"></a>1147         <em class="comment">// include the less than and greater than characters in their names,</em>
<a id="L1148" name="L1148"></a>1148         <em class="comment">// so we munge the names here.</em>
<a id="L1149" name="L1149"></a>1149         <strong class="reserved">if</strong> (originalMethodName.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("&lt;init&gt;")) <em class="brace">{</em>
<a id="L1150" name="L1150"></a>1150             originalMethodName = "$lt$init$gt$";
<a id="L1151" name="L1151"></a>1151         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (originalMethodName.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>("&lt;clinit&gt;")) <em class="brace">{</em>
<a id="L1152" name="L1152"></a>1152             originalMethodName = "$lt$clinit$gt$";
<a id="L1153" name="L1153"></a>1153         <em class="brace">}</em>
<a id="L1154" name="L1154"></a>1154 
<a id="L1155" name="L1155"></a>1155         <em class="comment">// Loop until the original method comes in under the JVM limit or</em>
<a id="L1156" name="L1156"></a>1156         <em class="comment">// the loop was unable to outline any more methods</em>
<a id="L1157" name="L1157"></a>1157         <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1158" name="L1158"></a>1158             <em class="comment">// Get all the best candidates for outlining, and sort them in</em>
<a id="L1159" name="L1159"></a>1159             <em class="comment">// ascending order of size</em>
<a id="L1160" name="L1160"></a>1160             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a> candidateChunks = <a href="../S/6132.html#L830" title="Defined at 830 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getCandidateChunks</a>(classGen,
<a id="L1161" name="L1161"></a>1161                                                            currentMethodSize);
<a id="L1162" name="L1162"></a>1162             <a href="../S/1147.html#L80" title="Defined at 80 in src/java/util/Collections.java.">Collections</a>.<a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(candidateChunks);
<a id="L1163" name="L1163"></a>1163 
<a id="L1164" name="L1164"></a>1164             moreMethodsOutlined = <strong class="reserved">false</strong>;
<a id="L1165" name="L1165"></a>1165 
<a id="L1166" name="L1166"></a>1166             <em class="comment">// Loop over the candidates for outlining, from the largest to the</em>
<a id="L1167" name="L1167"></a>1167             <em class="comment">// smallest and outline them one at a time, until the loop has</em>
<a id="L1168" name="L1168"></a>1168             <em class="comment">// outlined all or the original method comes in under the JVM</em>
<a id="L1169" name="L1169"></a>1169             <em class="comment">// limit on the size of a method.</em>
<a id="L1170" name="L1170"></a>1170             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = candidateChunks.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()-1;
<a id="L1171" name="L1171"></a>1171                  i &gt;= 0 &amp;&amp; currentMethodSize &gt; TARGET_METHOD_SIZE;
<a id="L1172" name="L1172"></a>1172                  i--) <em class="brace">{</em>
<a id="L1173" name="L1173"></a>1173                 <a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a> chunkToOutline = (<a href="../S/6132.html#L726" title="Defined at 726 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">Chunk</a>)candidateChunks.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L1174" name="L1174"></a>1174 
<a id="L1175" name="L1175"></a>1175                 methodsOutlined.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<a href="../S/6132.html#L1225" title="Defined at 1225 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">outline</a>(chunkToOutline.<a href="../S/6132.html#L783" title="Defined at 783 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkStart</a>(),
<a id="L1176" name="L1176"></a>1176                                             chunkToOutline.<a href="../S/6132.html#L791" title="Defined at 791 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getChunkEnd</a>(),
<a id="L1177" name="L1177"></a>1177                                             originalMethodName + "$outline$"
<a id="L1178" name="L1178"></a>1178                                                                + outlinedCount,
<a id="L1179" name="L1179"></a>1179                                             classGen));
<a id="L1180" name="L1180"></a>1180                 outlinedCount++;
<a id="L1181" name="L1181"></a>1181                 moreMethodsOutlined = <strong class="reserved">true</strong>;
<a id="L1182" name="L1182"></a>1182 
<a id="L1183" name="L1183"></a>1183                 <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> il = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>();
<a id="L1184" name="L1184"></a>1184                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> lastInst = il.<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>();
<a id="L1185" name="L1185"></a>1185                 il.<a href="../D/33568.html" title="Multiple defined in 2 places.">setPositions</a>();
<a id="L1186" name="L1186"></a>1186 
<a id="L1187" name="L1187"></a>1187                 <em class="comment">// Check the size of the method now</em>
<a id="L1188" name="L1188"></a>1188                 currentMethodSize =
<a id="L1189" name="L1189"></a>1189                         lastInst.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>()
<a id="L1190" name="L1190"></a>1190                                 + lastInst.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>().<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>();
<a id="L1191" name="L1191"></a>1191             <em class="brace">}</em>
<a id="L1192" name="L1192"></a>1192         <em class="brace">}</em> <strong class="reserved">while</strong> (moreMethodsOutlined &amp;&amp; currentMethodSize &gt; TARGET_METHOD_SIZE);
<a id="L1193" name="L1193"></a>1193 
<a id="L1194" name="L1194"></a>1194         <em class="comment">// Outlining failed to reduce the size of the current method</em>
<a id="L1195" name="L1195"></a>1195         <em class="comment">// sufficiently.  Throw an internal error.</em>
<a id="L1196" name="L1196"></a>1196         <strong class="reserved">if</strong> (currentMethodSize &gt; MAX_METHOD_SIZE) <em class="brace">{</em>
<a id="L1197" name="L1197"></a>1197             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> = (<strong class="reserved">new</strong> <a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>(<a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>.OUTLINE_ERR_METHOD_TOO_BIG))
<a id="L1198" name="L1198"></a>1198                                   .<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L1199" name="L1199"></a>1199             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L1200" name="L1200"></a>1200         <em class="brace">}</em>
<a id="L1201" name="L1201"></a>1201 
<a id="L1202" name="L1202"></a>1202         <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] methodsArr = <strong class="reserved">new</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[methodsOutlined.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() + 1];
<a id="L1203" name="L1203"></a>1203         methodsOutlined.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(methodsArr);
<a id="L1204" name="L1204"></a>1204 
<a id="L1205" name="L1205"></a>1205         methodsArr[methodsOutlined.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()] = <a href="../S/6132.html#L1912" title="Defined at 1912 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getThisMethod</a>();
<a id="L1206" name="L1206"></a>1206 
<a id="L1207" name="L1207"></a>1207         <strong class="reserved">return</strong> methodsArr;
<a id="L1208" name="L1208"></a>1208     <em class="brace">}</em>
<a id="L1209" name="L1209"></a>1209 
<div class="comment">
      Given an outlineable chunk of code in the current {@link MethodGenerator}
      move ("outline") the chunk to a new method, and replace the chunk in the
      old method with a reference to that new method.  No
      {@link OutlineableChunkStart} or {@link OutlineableChunkEnd} instructions
      are copied.
      @param first The {@link InstructionHandle} of the first instruction in
                   the chunk to outline
      @param last The <code>InstructionHandle</code> of the last instruction in
                  the chunk to outline
      @param outlinedMethodName The name of the new method
      @param classGen The {@link ClassGenerator} of which the original
                   and new methods will be members
      @return The new {@link Method} containing the outlined code.</div>
<a id="L1225" name="L1225"></a>1225     <strong class="reserved">private</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> <a href="../R/24042.html" title="Multiple referred from 2 places.">outline</a>(<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>, <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>,
<a id="L1226" name="L1226"></a>1226                            <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> outlinedMethodName, <a href="../S/6130.html#L50" title="Defined at 50 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">ClassGenerator</a> classGen) <em class="brace">{</em>
<a id="L1227" name="L1227"></a>1227         <em class="comment">// We're not equipped to deal with exception handlers yet.  Bail out!</em>
<a id="L1228" name="L1228"></a>1228         <strong class="reserved">if</strong> (<a href="../S/4802.html#L605" title="Defined at 605 in src/com/sun/org/apache/bcel/internal/generic/MethodGen.java.">getExceptionHandlers</a>().<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> != 0) <em class="brace">{</em>
<a id="L1229" name="L1229"></a>1229             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> = (<strong class="reserved">new</strong> <a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>(<a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>.OUTLINE_ERR_TRY_CATCH))
<a id="L1230" name="L1230"></a>1230                                   .<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L1231" name="L1231"></a>1231             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L1232" name="L1232"></a>1232         <em class="brace">}</em>
<a id="L1233" name="L1233"></a>1233 
<a id="L1234" name="L1234"></a>1234         <strong class="reserved">int</strong> outlineChunkStartOffset = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>();
<a id="L1235" name="L1235"></a>1235         <strong class="reserved">int</strong> outlineChunkEndOffset = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>()
<a id="L1236" name="L1236"></a>1236                                         + <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>().<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>();
<a id="L1237" name="L1237"></a>1237 
<a id="L1238" name="L1238"></a>1238         <a href="../S/4764.html#L78" title="Defined at 78 in src/com/sun/org/apache/bcel/internal/generic/ConstantPoolGen.java.">ConstantPoolGen</a> cpg = <a href="../D/17923.html" title="Multiple defined in 12 places.">getConstantPool</a>();
<a id="L1239" name="L1239"></a>1239 
<a id="L1240" name="L1240"></a>1240         <em class="comment">// Create new outlined method with signature:</em>
<a id="L1241" name="L1241"></a>1241         <em class="comment">//</em>
<a id="L1242" name="L1242"></a>1242         <em class="comment">//   private final outlinedMethodName(CopyLocals copyLocals);</em>
<a id="L1243" name="L1243"></a>1243         <em class="comment">//</em>
<a id="L1244" name="L1244"></a>1244         <em class="comment">// CopyLocals is an object that is used to copy-in/copy-out local</em>
<a id="L1245" name="L1245"></a>1245         <em class="comment">// variables that are used by the outlined method.   Only locals whose</em>
<a id="L1246" name="L1246"></a>1246         <em class="comment">// value is potentially set or referenced outside the range of the</em>
<a id="L1247" name="L1247"></a>1247         <em class="comment">// chunk that is being outlined will be represented in CopyLocals.  The</em>
<a id="L1248" name="L1248"></a>1248         <em class="comment">// type of the variable for copying local variables is actually</em>
<a id="L1249" name="L1249"></a>1249         <em class="comment">// generated to be unique - it is not named CopyLocals.</em>
<a id="L1250" name="L1250"></a>1250         <em class="comment">//</em>
<a id="L1251" name="L1251"></a>1251         <em class="comment">// The outlined method never needs to be referenced outside of this</em>
<a id="L1252" name="L1252"></a>1252         <em class="comment">// class, and will never be overridden, so we mark it private final.</em>
<a id="L1253" name="L1253"></a>1253         <strong class="reserved">final</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> newIL = <strong class="reserved">new</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a>();
<a id="L1254" name="L1254"></a>1254 
<a id="L1255" name="L1255"></a>1255         <strong class="reserved">final</strong> <a href="../S/6196.html#L66" title="Defined at 66 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/XSLTC.java.">XSLTC</a>  xsltc = classGen.<a href="../D/21413.html" title="Multiple defined in 8 places.">getParser</a>().<a href="../D/23784.html" title="Multiple defined in 2 places.">getXSLTC</a>();
<a id="L1256" name="L1256"></a>1256         <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> argTypeName = xsltc.<a href="../S/6196.html#L874" title="Defined at 874 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/XSLTC.java.">getHelperClassName</a>();
<a id="L1257" name="L1257"></a>1257         <strong class="reserved">final</strong> <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>[] argTypes =
<a id="L1258" name="L1258"></a>1258             <strong class="reserved">new</strong> <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>[] <em class="brace">{</em>(<strong class="reserved">new</strong> <a href="../D/6335.html" title="Multiple defined in 2 places.">ObjectType</a>(argTypeName)).<a href="../D/35420.html" title="Multiple defined in 12 places.">toJCType</a>()<em class="brace">}</em>;
<a id="L1259" name="L1259"></a>1259         <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> argName = "copyLocals";
<a id="L1260" name="L1260"></a>1260         <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] argNames = <strong class="reserved">new</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] <em class="brace">{</em>argName<em class="brace">}</em>;
<a id="L1261" name="L1261"></a>1261 
<a id="L1262" name="L1262"></a>1262         <strong class="reserved">int</strong> methodAttributes = ACC_PRIVATE | ACC_FINAL;
<a id="L1263" name="L1263"></a>1263         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> isStaticMethod = (<a href="../S/4587.html#L84" title="Defined at 84 in src/com/sun/org/apache/bcel/internal/classfile/AccessFlags.java.">getAccessFlags</a>() &amp; ACC_STATIC) != 0;
<a id="L1264" name="L1264"></a>1264 
<a id="L1265" name="L1265"></a>1265         <strong class="reserved">if</strong> (isStaticMethod) <em class="brace">{</em>
<a id="L1266" name="L1266"></a>1266             methodAttributes = methodAttributes | ACC_STATIC;
<a id="L1267" name="L1267"></a>1267         <em class="brace">}</em>
<a id="L1268" name="L1268"></a>1268 
<a id="L1269" name="L1269"></a>1269         <strong class="reserved">final</strong> <a href="../S/6132.html#L82" title="Defined at 82 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">MethodGenerator</a> outlinedMethodGen =
<a id="L1270" name="L1270"></a>1270             <strong class="reserved">new</strong> <a href="../S/6132.html#L82" title="Defined at 82 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">MethodGenerator</a>(methodAttributes,
<a id="L1271" name="L1271"></a>1271                                 com.sun.org.apache.bcel.internal.<a href="../S/1616.html#L641" title="Defined at 641 in src/java/lang/invoke/MethodType.java.">generic</a>.<a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.VOID,
<a id="L1272" name="L1272"></a>1272                                 argTypes, argNames, outlinedMethodName,
<a id="L1273" name="L1273"></a>1273                                 <a href="../D/17698.html" title="Multiple defined in 41 places.">getClassName</a>(), newIL, cpg);
<a id="L1274" name="L1274"></a>1274 
<a id="L1275" name="L1275"></a>1275         <em class="comment">// Create class for copying local variables to the outlined method.</em>
<a id="L1276" name="L1276"></a>1276         <em class="comment">// The fields the class will need to contain will be determined as the</em>
<a id="L1277" name="L1277"></a>1277         <em class="comment">// code in the outlineable chunk is examined.</em>
<a id="L1278" name="L1278"></a>1278         <a href="../S/6130.html#L50" title="Defined at 50 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">ClassGenerator</a> copyAreaCG
<a id="L1279" name="L1279"></a>1279             = <strong class="reserved">new</strong> <a href="../S/6130.html#L50" title="Defined at 50 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">ClassGenerator</a>(argTypeName, OBJECT_CLASS, argTypeName+".java",
<a id="L1280" name="L1280"></a>1280                                  ACC_FINAL | ACC_PUBLIC | ACC_SUPER, <strong class="reserved">null</strong>,
<a id="L1281" name="L1281"></a>1281                                  classGen.<a href="../D/22812.html" title="Multiple defined in 7 places.">getStylesheet</a>()) <em class="brace">{</em>
<a id="L1282" name="L1282"></a>1282                       <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../D/25536.html" title="Multiple defined in 7 places.">isExternal</a>() <em class="brace">{</em>
<a id="L1283" name="L1283"></a>1283                           <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1284" name="L1284"></a>1284                       <em class="brace">}</em>
<a id="L1285" name="L1285"></a>1285                   <em class="brace">}</em>;
<a id="L1286" name="L1286"></a>1286         <a href="../S/4764.html#L78" title="Defined at 78 in src/com/sun/org/apache/bcel/internal/generic/ConstantPoolGen.java.">ConstantPoolGen</a> copyAreaCPG = copyAreaCG.<a href="../D/17923.html" title="Multiple defined in 12 places.">getConstantPool</a>();
<a id="L1287" name="L1287"></a>1287         copyAreaCG.<a href="../S/4785.html#L240" title="Defined at 240 in src/com/sun/org/apache/bcel/internal/generic/ClassGen.java.">addEmptyConstructor</a>(ACC_PUBLIC);
<a id="L1288" name="L1288"></a>1288 
<a id="L1289" name="L1289"></a>1289         <em class="comment">// Number of fields in the copy class</em>
<a id="L1290" name="L1290"></a>1290         <strong class="reserved">int</strong> copyAreaFieldCount = 0;
<a id="L1291" name="L1291"></a>1291 
<a id="L1292" name="L1292"></a>1292         <em class="comment">// The handle for the instruction after the last one to be outlined.</em>
<a id="L1293" name="L1293"></a>1293         <em class="comment">// Note that this should never end up being null.  An outlineable chunk</em>
<a id="L1294" name="L1294"></a>1294         <em class="comment">// won't contain a RETURN instruction or other branch out of the chunk,</em>
<a id="L1295" name="L1295"></a>1295         <em class="comment">// and the JVM specification prohibits code in a method from just</em>
<a id="L1296" name="L1296"></a>1296         <em class="comment">// "falling off the end" so this should always point to a valid handle.</em>
<a id="L1297" name="L1297"></a>1297         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>();
<a id="L1298" name="L1298"></a>1298 
<a id="L1299" name="L1299"></a>1299         <em class="comment">// InstructionLists for copying values into and out of an instance of</em>
<a id="L1300" name="L1300"></a>1300         <em class="comment">// CopyLocals:</em>
<a id="L1301" name="L1301"></a>1301         <em class="comment">//      oldMethCoypInIL  - from locals in old method into an instance</em>
<a id="L1302" name="L1302"></a>1302         <em class="comment">//                         of the CopyLocals class (oldMethCopyInIL)</em>
<a id="L1303" name="L1303"></a>1303         <em class="comment">//      oldMethCopyOutIL - from CopyLocals back into locals in the old</em>
<a id="L1304" name="L1304"></a>1304         <em class="comment">//                         method</em>
<a id="L1305" name="L1305"></a>1305         <em class="comment">//      newMethCopyInIL  - from CopyLocals into locals in the new</em>
<a id="L1306" name="L1306"></a>1306         <em class="comment">//                         method</em>
<a id="L1307" name="L1307"></a>1307         <em class="comment">//      newMethCopyOutIL - from locals in new method into the instance</em>
<a id="L1308" name="L1308"></a>1308         <em class="comment">//                         of the CopyLocals class</em>
<a id="L1309" name="L1309"></a>1309         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> oldMethCopyInIL  = <strong class="reserved">new</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a>();
<a id="L1310" name="L1310"></a>1310         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> oldMethCopyOutIL = <strong class="reserved">new</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a>();
<a id="L1311" name="L1311"></a>1311         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> newMethCopyInIL  = <strong class="reserved">new</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a>();
<a id="L1312" name="L1312"></a>1312         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> newMethCopyOutIL = <strong class="reserved">new</strong> <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a>();
<a id="L1313" name="L1313"></a>1313 
<a id="L1314" name="L1314"></a>1314         <em class="comment">// Allocate instance of class in which we'll copy in or copy out locals</em>
<a id="L1315" name="L1315"></a>1315         <em class="comment">// and make two copies:  last copy is used to invoke constructor;</em>
<a id="L1316" name="L1316"></a>1316         <em class="comment">// other two are used for references to fields in the CopyLocals object</em>
<a id="L1317" name="L1317"></a>1317         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> outlinedMethodCallSetup =
<a id="L1318" name="L1318"></a>1318             oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<strong class="reserved">new</strong> <a href="../S/4824.html#L69" title="Defined at 69 in src/com/sun/org/apache/bcel/internal/generic/NEW.java.">NEW</a>(cpg.<a href="../D/10706.html" title="Multiple defined in 4 places.">addClass</a>(argTypeName)));
<a id="L1319" name="L1319"></a>1319         oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../D/2160.html" title="Multiple defined in 3 places.">DUP</a>);
<a id="L1320" name="L1320"></a>1320         oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../D/2160.html" title="Multiple defined in 3 places.">DUP</a>);
<a id="L1321" name="L1321"></a>1321         oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1322" name="L1322"></a>1322             <strong class="reserved">new</strong> <a href="../S/4695.html#L71" title="Defined at 71 in src/com/sun/org/apache/bcel/internal/generic/INVOKESPECIAL.java.">INVOKESPECIAL</a>(cpg.<a href="../D/10937.html" title="Multiple defined in 2 places.">addMethodref</a>(argTypeName, "&lt;init&gt;", "()V")));
<a id="L1323" name="L1323"></a>1323 
<a id="L1324" name="L1324"></a>1324         <em class="comment">// Generate code to invoke the new outlined method, and place the code</em>
<a id="L1325" name="L1325"></a>1325         <em class="comment">// on oldMethCopyOutIL</em>
<a id="L1326" name="L1326"></a>1326         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> outlinedMethodRef;
<a id="L1327" name="L1327"></a>1327 
<a id="L1328" name="L1328"></a>1328         <strong class="reserved">if</strong> (isStaticMethod) <em class="brace">{</em>
<a id="L1329" name="L1329"></a>1329             outlinedMethodRef =
<a id="L1330" name="L1330"></a>1330                 oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1331" name="L1331"></a>1331                     <strong class="reserved">new</strong> <a href="../S/4756.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/INVOKESTATIC.java.">INVOKESTATIC</a>(cpg.<a href="../D/10937.html" title="Multiple defined in 2 places.">addMethodref</a>(
<a id="L1332" name="L1332"></a>1332                                           classGen.<a href="../D/17698.html" title="Multiple defined in 41 places.">getClassName</a>(),
<a id="L1333" name="L1333"></a>1333                                           outlinedMethodName,
<a id="L1334" name="L1334"></a>1334                                           outlinedMethodGen.<a href="../D/22504.html" title="Multiple defined in 40 places.">getSignature</a>())));
<a id="L1335" name="L1335"></a>1335         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1336" name="L1336"></a>1336             oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.THIS);
<a id="L1337" name="L1337"></a>1337             oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../S/4676.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/SWAP.java.">SWAP</a>);
<a id="L1338" name="L1338"></a>1338             outlinedMethodRef =
<a id="L1339" name="L1339"></a>1339                 oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1340" name="L1340"></a>1340                     <strong class="reserved">new</strong> <a href="../S/4737.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/INVOKEVIRTUAL.java.">INVOKEVIRTUAL</a>(cpg.<a href="../D/10937.html" title="Multiple defined in 2 places.">addMethodref</a>(
<a id="L1341" name="L1341"></a>1341                                           classGen.<a href="../D/17698.html" title="Multiple defined in 41 places.">getClassName</a>(),
<a id="L1342" name="L1342"></a>1342                                           outlinedMethodName,
<a id="L1343" name="L1343"></a>1343                                           outlinedMethodGen.<a href="../D/22504.html" title="Multiple defined in 40 places.">getSignature</a>())));
<a id="L1344" name="L1344"></a>1344         <em class="brace">}</em>
<a id="L1345" name="L1345"></a>1345 
<a id="L1346" name="L1346"></a>1346         <em class="comment">// Used to keep track of the first in a sequence of</em>
<a id="L1347" name="L1347"></a>1347         <em class="comment">// OutlineableChunkStart instructions</em>
<a id="L1348" name="L1348"></a>1348         <strong class="reserved">boolean</strong> chunkStartTargetMappingsPending = <strong class="reserved">false</strong>;
<a id="L1349" name="L1349"></a>1349         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> pendingTargetMappingHandle = <strong class="reserved">null</strong>;
<a id="L1350" name="L1350"></a>1350 
<a id="L1351" name="L1351"></a>1351         <em class="comment">// Used to keep track of the last instruction that was copied</em>
<a id="L1352" name="L1352"></a>1352         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> lastCopyHandle = <strong class="reserved">null</strong>;
<a id="L1353" name="L1353"></a>1353 
<a id="L1354" name="L1354"></a>1354         <em class="comment">// Keeps track of the mapping from instruction handles in the old</em>
<a id="L1355" name="L1355"></a>1355         <em class="comment">// method to instruction handles in the outlined method.  Only need</em>
<a id="L1356" name="L1356"></a>1356         <em class="comment">// to track instructions that are targeted by something else in the</em>
<a id="L1357" name="L1357"></a>1357         <em class="comment">// generated BCEL</em>
<a id="L1358" name="L1358"></a>1358         <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a> targetMap   = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>();
<a id="L1359" name="L1359"></a>1359 
<a id="L1360" name="L1360"></a>1360         <em class="comment">// Keeps track of the mapping from local variables in the old method</em>
<a id="L1361" name="L1361"></a>1361         <em class="comment">// to local variables in the outlined method.</em>
<a id="L1362" name="L1362"></a>1362         <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a> localVarMap = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>();
<a id="L1363" name="L1363"></a>1363 
<a id="L1364" name="L1364"></a>1364         <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a> revisedLocalVarStart = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>();
<a id="L1365" name="L1365"></a>1365         <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a> revisedLocalVarEnd = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>();
<a id="L1366" name="L1366"></a>1366 
<a id="L1367" name="L1367"></a>1367         <em class="comment">// Pass 1: Make copies of all instructions, append them to the new list</em>
<a id="L1368" name="L1368"></a>1368         <em class="comment">// and associate old instruction references with the new ones, i.e.,</em>
<a id="L1369" name="L1369"></a>1369         <em class="comment">// a 1:1 mapping.  The special marker instructions are not copied.</em>
<a id="L1370" name="L1370"></a>1370         <em class="comment">// Also, identify local variables whose values need to be copied into or</em>
<a id="L1371" name="L1371"></a>1371         <em class="comment">// out of the new outlined method, and builds up targetMap and</em>
<a id="L1372" name="L1372"></a>1372         <em class="comment">// localVarMap as described above.  The code identifies those local</em>
<a id="L1373" name="L1373"></a>1373         <em class="comment">// variables first so that they can have fixed slots in the stack</em>
<a id="L1374" name="L1374"></a>1374         <em class="comment">// frame for the outlined method assigned them ahead of all those</em>
<a id="L1375" name="L1375"></a>1375         <em class="comment">// variables that don't need to exist for the entirety of the outlined</em>
<a id="L1376" name="L1376"></a>1376         <em class="comment">// method invocation.</em>
<a id="L1377" name="L1377"></a>1377         <strong class="reserved">for</strong> (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> ih = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>; ih != <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>; ih = ih.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>()) <em class="brace">{</em>
<a id="L1378" name="L1378"></a>1378             <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> inst = ih.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>();
<a id="L1379" name="L1379"></a>1379 
<a id="L1380" name="L1380"></a>1380             <em class="comment">// MarkerInstructions are not copied, so if something else targets</em>
<a id="L1381" name="L1381"></a>1381             <em class="comment">// one, the targetMap will point to the nearest copied sibling</em>
<a id="L1382" name="L1382"></a>1382             <em class="comment">// InstructionHandle:  for an OutlineableChunkEnd, the nearest</em>
<a id="L1383" name="L1383"></a>1383             <em class="comment">// preceding sibling; for an OutlineableChunkStart, the nearest</em>
<a id="L1384" name="L1384"></a>1384             <em class="comment">// following sibling.</em>
<a id="L1385" name="L1385"></a>1385             <strong class="reserved">if</strong> (inst <strong class="reserved">instanceof</strong> <a href="../S/6117.html#L40" title="Defined at 40 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MarkerInstruction.java.">MarkerInstruction</a>) <em class="brace">{</em>
<a id="L1386" name="L1386"></a>1386                 <strong class="reserved">if</strong> (ih.<a href="../S/4625.html#L214" title="Defined at 214 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">hasTargeters</a>()) <em class="brace">{</em>
<a id="L1387" name="L1387"></a>1387                     <strong class="reserved">if</strong> (inst <strong class="reserved">instanceof</strong> <a href="../S/6099.html#L31" title="Defined at 31 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/OutlineableChunkEnd.java.">OutlineableChunkEnd</a>) <em class="brace">{</em>
<a id="L1388" name="L1388"></a>1388                         targetMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(ih, lastCopyHandle);
<a id="L1389" name="L1389"></a>1389                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1390" name="L1390"></a>1390                         <strong class="reserved">if</strong> (!chunkStartTargetMappingsPending)  <em class="brace">{</em>
<a id="L1391" name="L1391"></a>1391                             chunkStartTargetMappingsPending = <strong class="reserved">true</strong>;
<a id="L1392" name="L1392"></a>1392                             pendingTargetMappingHandle = ih;
<a id="L1393" name="L1393"></a>1393                         <em class="brace">}</em>
<a id="L1394" name="L1394"></a>1394                     <em class="brace">}</em>
<a id="L1395" name="L1395"></a>1395                 <em class="brace">}</em>
<a id="L1396" name="L1396"></a>1396             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1397" name="L1397"></a>1397                 <em class="comment">// Copy the instruction and append it to the outlined method's</em>
<a id="L1398" name="L1398"></a>1398                 <em class="comment">// InstructionList.</em>
<a id="L1399" name="L1399"></a>1399                 <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = inst.<a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>(); <em class="comment">// Use clone for shallow copy</em>
<a id="L1400" name="L1400"></a>1400 
<a id="L1401" name="L1401"></a>1401                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> <strong class="reserved">instanceof</strong> <a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a>) <em class="brace">{</em>
<a id="L1402" name="L1402"></a>1402                     lastCopyHandle = newIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>((<a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L1403" name="L1403"></a>1403                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1404" name="L1404"></a>1404                     lastCopyHandle = newIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>);
<a id="L1405" name="L1405"></a>1405                 <em class="brace">}</em>
<a id="L1406" name="L1406"></a>1406 
<a id="L1407" name="L1407"></a>1407                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> <strong class="reserved">instanceof</strong> <a href="../S/4711.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableInstruction.java.">LocalVariableInstruction</a>
<a id="L1408" name="L1408"></a>1408                         || <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> <strong class="reserved">instanceof</strong> <a href="../S/4716.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/RET.java.">RET</a>) <em class="brace">{</em>
<a id="L1409" name="L1409"></a>1409                     <em class="comment">// For any instruction that touches a local variable,</em>
<a id="L1410" name="L1410"></a>1410                     <em class="comment">// check whether the local variable's value needs to be</em>
<a id="L1411" name="L1411"></a>1411                     <em class="comment">// copied into or out of the outlined method.  If so,</em>
<a id="L1412" name="L1412"></a>1412                     <em class="comment">// generate the code to perform the necessary copying, and</em>
<a id="L1413" name="L1413"></a>1413                     <em class="comment">// use localVarMap to map the variable in the original</em>
<a id="L1414" name="L1414"></a>1414                     <em class="comment">// method to the variable in the new method.</em>
<a id="L1415" name="L1415"></a>1415                     <a href="../S/4816.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/IndexedInstruction.java.">IndexedInstruction</a> lvi = (<a href="../S/4816.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/IndexedInstruction.java.">IndexedInstruction</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L1416" name="L1416"></a>1416                     <strong class="reserved">int</strong> oldLocalVarIndex = lvi.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L1417" name="L1417"></a>1417                     <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> oldLVG =
<a id="L1418" name="L1418"></a>1418                             <a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>()
<a id="L1419" name="L1419"></a>1419                                 .<a href="../S/6132.html#L357" title="Defined at 357 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">lookupRegisteredLocalVariable</a>(oldLocalVarIndex,
<a id="L1420" name="L1420"></a>1420                                                               ih.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>());
<a id="L1421" name="L1421"></a>1421                     <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> newLVG =
<a id="L1422" name="L1422"></a>1422                             (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)localVarMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(oldLVG);
<a id="L1423" name="L1423"></a>1423 
<a id="L1424" name="L1424"></a>1424                     <em class="comment">// Has the code already mapped this local variable to a</em>
<a id="L1425" name="L1425"></a>1425                     <em class="comment">// local in the new method?</em>
<a id="L1426" name="L1426"></a>1426                     <strong class="reserved">if</strong> (localVarMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(oldLVG) == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1427" name="L1427"></a>1427                         <em class="comment">// Determine whether the local variable needs to be</em>
<a id="L1428" name="L1428"></a>1428                         <em class="comment">// copied into or out of the outlined by checking</em>
<a id="L1429" name="L1429"></a>1429                         <em class="comment">// whether the range of instructions in which the</em>
<a id="L1430" name="L1430"></a>1430                         <em class="comment">// variable is accessible is outside the range of</em>
<a id="L1431" name="L1431"></a>1431                         <em class="comment">// instructions in the outlineable chunk.</em>
<a id="L1432" name="L1432"></a>1432                         <em class="comment">// Special case a chunk start offset of zero:  a local</em>
<a id="L1433" name="L1433"></a>1433                         <em class="comment">// variable live at that position must be a method</em>
<a id="L1434" name="L1434"></a>1434                         <em class="comment">// parameter, so the code doesn't need to check whether</em>
<a id="L1435" name="L1435"></a>1435                         <em class="comment">// the variable is live before that point; being live</em>
<a id="L1436" name="L1436"></a>1436                         <em class="comment">// at offset zero is sufficient to know that the value</em>
<a id="L1437" name="L1437"></a>1437                         <em class="comment">// must be copied in to the outlined method.</em>
<a id="L1438" name="L1438"></a>1438                         <strong class="reserved">boolean</strong> copyInLocalValue =
<a id="L1439" name="L1439"></a>1439                             <a href="../S/6132.html#L556" title="Defined at 556 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">offsetInLocalVariableGenRange</a>(oldLVG,
<a id="L1440" name="L1440"></a>1440                                                 (outlineChunkStartOffset != 0)
<a id="L1441" name="L1441"></a>1441                                                     ? outlineChunkStartOffset-1
<a id="L1442" name="L1442"></a>1442                                                     : 0);
<a id="L1443" name="L1443"></a>1443                         <strong class="reserved">boolean</strong> copyOutLocalValue =
<a id="L1444" name="L1444"></a>1444                             <a href="../S/6132.html#L556" title="Defined at 556 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">offsetInLocalVariableGenRange</a>(oldLVG,
<a id="L1445" name="L1445"></a>1445                                                 outlineChunkEndOffset+1);
<a id="L1446" name="L1446"></a>1446 
<a id="L1447" name="L1447"></a>1447                         <em class="comment">// For any variable that needs to be copied into or out</em>
<a id="L1448" name="L1448"></a>1448                         <em class="comment">// of the outlined method, create a field in the</em>
<a id="L1449" name="L1449"></a>1449                         <em class="comment">// CopyLocals class, and generate the necessary code for</em>
<a id="L1450" name="L1450"></a>1450                         <em class="comment">// copying the value.</em>
<a id="L1451" name="L1451"></a>1451                         <strong class="reserved">if</strong> (copyInLocalValue || copyOutLocalValue) <em class="brace">{</em>
<a id="L1452" name="L1452"></a>1452                             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> varName = oldLVG.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L1453" name="L1453"></a>1453                             <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> varType = oldLVG.<a href="../D/23311.html" title="Multiple defined in 232 places.">getType</a>();
<a id="L1454" name="L1454"></a>1454                             newLVG = outlinedMethodGen.<a href="../D/10913.html" title="Multiple defined in 3 places.">addLocalVariable</a>(varName,
<a id="L1455" name="L1455"></a>1455                                                                         varType,
<a id="L1456" name="L1456"></a>1456                                                                         <strong class="reserved">null</strong>,
<a id="L1457" name="L1457"></a>1457                                                                         <strong class="reserved">null</strong>);
<a id="L1458" name="L1458"></a>1458                             <strong class="reserved">int</strong> newLocalVarIndex = newLVG.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L1459" name="L1459"></a>1459                             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> varSignature = varType.<a href="../D/22504.html" title="Multiple defined in 40 places.">getSignature</a>();
<a id="L1460" name="L1460"></a>1460 
<a id="L1461" name="L1461"></a>1461                             <em class="comment">// Record the mapping from the old local to the new</em>
<a id="L1462" name="L1462"></a>1462                             localVarMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(oldLVG, newLVG);
<a id="L1463" name="L1463"></a>1463 
<a id="L1464" name="L1464"></a>1464                             copyAreaFieldCount++;
<a id="L1465" name="L1465"></a>1465                             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> copyAreaFieldName =
<a id="L1466" name="L1466"></a>1466                                            "field" + copyAreaFieldCount;
<a id="L1467" name="L1467"></a>1467                             copyAreaCG.<a href="../D/10803.html" title="Multiple defined in 2 places.">addField</a>(
<a id="L1468" name="L1468"></a>1468                                 <strong class="reserved">new</strong> <a href="../D/3142.html" title="Multiple defined in 10 places.">Field</a>(ACC_PUBLIC,
<a id="L1469" name="L1469"></a>1469                                         copyAreaCPG.<a href="../S/4764.html#L383" title="Defined at 383 in src/com/sun/org/apache/bcel/internal/generic/ConstantPoolGen.java.">addUtf8</a>(copyAreaFieldName),
<a id="L1470" name="L1470"></a>1470                                         copyAreaCPG.<a href="../S/4764.html#L383" title="Defined at 383 in src/com/sun/org/apache/bcel/internal/generic/ConstantPoolGen.java.">addUtf8</a>(varSignature),
<a id="L1471" name="L1471"></a>1471                                         <strong class="reserved">null</strong>, copyAreaCPG.<a href="../D/17923.html" title="Multiple defined in 12 places.">getConstantPool</a>()));
<a id="L1472" name="L1472"></a>1472 
<a id="L1473" name="L1473"></a>1473                             <strong class="reserved">int</strong> fieldRef = cpg.<a href="../S/4764.html#L643" title="Defined at 643 in src/com/sun/org/apache/bcel/internal/generic/ConstantPoolGen.java.">addFieldref</a>(argTypeName,
<a id="L1474" name="L1474"></a>1474                                                            copyAreaFieldName,
<a id="L1475" name="L1475"></a>1475                                                            varSignature);
<a id="L1476" name="L1476"></a>1476 
<a id="L1477" name="L1477"></a>1477                             <strong class="reserved">if</strong> (copyInLocalValue) <em class="brace">{</em>
<a id="L1478" name="L1478"></a>1478                                 <em class="comment">// Generate code for the old method to store the</em>
<a id="L1479" name="L1479"></a>1479                                 <em class="comment">// value of the local into the correct field in</em>
<a id="L1480" name="L1480"></a>1480                                 <em class="comment">// CopyLocals prior to invocation of the</em>
<a id="L1481" name="L1481"></a>1481                                 <em class="comment">// outlined method.</em>
<a id="L1482" name="L1482"></a>1482                                 oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1483" name="L1483"></a>1483                                         <a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../D/2160.html" title="Multiple defined in 3 places.">DUP</a>);
<a id="L1484" name="L1484"></a>1484                                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> copyInLoad =
<a id="L1485" name="L1485"></a>1485                                     oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1486" name="L1486"></a>1486                                         <a href="../S/6132.html#L1769" title="Defined at 1769 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">loadLocal</a>(oldLocalVarIndex, varType));
<a id="L1487" name="L1487"></a>1487                                 oldMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<strong class="reserved">new</strong> <a href="../S/4747.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/PUTFIELD.java.">PUTFIELD</a>(fieldRef));
<a id="L1488" name="L1488"></a>1488 
<a id="L1489" name="L1489"></a>1489                                 <em class="comment">// If the end of the live range of the old</em>
<a id="L1490" name="L1490"></a>1490                                 <em class="comment">// variable was in the middle of the outlined</em>
<a id="L1491" name="L1491"></a>1491                                 <em class="comment">// chunk.  Make the load of its value the new</em>
<a id="L1492" name="L1492"></a>1492                                 <em class="comment">// end of its range.</em>
<a id="L1493" name="L1493"></a>1493                                 <strong class="reserved">if</strong> (!copyOutLocalValue) <em class="brace">{</em>
<a id="L1494" name="L1494"></a>1494                                     revisedLocalVarEnd.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(oldLVG, copyInLoad);
<a id="L1495" name="L1495"></a>1495                                 <em class="brace">}</em>
<a id="L1496" name="L1496"></a>1496 
<a id="L1497" name="L1497"></a>1497                                 <em class="comment">// Generate code for start of the outlined</em>
<a id="L1498" name="L1498"></a>1498                                 <em class="comment">// method to copy the value from a field in</em>
<a id="L1499" name="L1499"></a>1499                                 <em class="comment">// CopyLocals to the new local in the outlined</em>
<a id="L1500" name="L1500"></a>1500                                 <em class="comment">// method</em>
<a id="L1501" name="L1501"></a>1501                                 newMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1502" name="L1502"></a>1502                                         <a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.ALOAD_1);
<a id="L1503" name="L1503"></a>1503                                 newMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<strong class="reserved">new</strong> <a href="../S/4792.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/GETFIELD.java.">GETFIELD</a>(fieldRef));
<a id="L1504" name="L1504"></a>1504                                 newMethCopyInIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1505" name="L1505"></a>1505                                         <a href="../S/6132.html#L1800" title="Defined at 1800 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">storeLocal</a>(newLocalVarIndex, varType));
<a id="L1506" name="L1506"></a>1506                             <em class="brace">}</em>
<a id="L1507" name="L1507"></a>1507 
<a id="L1508" name="L1508"></a>1508                             <strong class="reserved">if</strong> (copyOutLocalValue) <em class="brace">{</em>
<a id="L1509" name="L1509"></a>1509                                 <em class="comment">// Generate code for the end of the outlined</em>
<a id="L1510" name="L1510"></a>1510                                 <em class="comment">// method to copy the value from the new local</em>
<a id="L1511" name="L1511"></a>1511                                 <em class="comment">// variable into a field in CopyLocals</em>
<a id="L1512" name="L1512"></a>1512                                 <em class="comment">// method</em>
<a id="L1513" name="L1513"></a>1513                                 newMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1514" name="L1514"></a>1514                                         <a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.ALOAD_1);
<a id="L1515" name="L1515"></a>1515                                 newMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1516" name="L1516"></a>1516                                         <a href="../S/6132.html#L1769" title="Defined at 1769 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">loadLocal</a>(newLocalVarIndex, varType));
<a id="L1517" name="L1517"></a>1517                                 newMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<strong class="reserved">new</strong> <a href="../S/4747.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/PUTFIELD.java.">PUTFIELD</a>(fieldRef));
<a id="L1518" name="L1518"></a>1518 
<a id="L1519" name="L1519"></a>1519                                 <em class="comment">// Generate code to copy the value from a field</em>
<a id="L1520" name="L1520"></a>1520                                 <em class="comment">// in CopyLocals into a local in the original</em>
<a id="L1521" name="L1521"></a>1521                                 <em class="comment">// method following invocation of the outlined</em>
<a id="L1522" name="L1522"></a>1522                                 <em class="comment">// method.</em>
<a id="L1523" name="L1523"></a>1523                                 oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1524" name="L1524"></a>1524                                         <a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../D/2160.html" title="Multiple defined in 3 places.">DUP</a>);
<a id="L1525" name="L1525"></a>1525                                 oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<strong class="reserved">new</strong> <a href="../S/4792.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/GETFIELD.java.">GETFIELD</a>(fieldRef));
<a id="L1526" name="L1526"></a>1526                                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> copyOutStore =
<a id="L1527" name="L1527"></a>1527                                     oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(
<a id="L1528" name="L1528"></a>1528                                         <a href="../S/6132.html#L1800" title="Defined at 1800 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">storeLocal</a>(oldLocalVarIndex, varType));
<a id="L1529" name="L1529"></a>1529 
<a id="L1530" name="L1530"></a>1530                                 <em class="comment">// If the start of the live range of the old</em>
<a id="L1531" name="L1531"></a>1531                                 <em class="comment">// variable was in the middle of the outlined</em>
<a id="L1532" name="L1532"></a>1532                                 <em class="comment">// chunk.  Make this store into it the new start</em>
<a id="L1533" name="L1533"></a>1533                                 <em class="comment">// of its range.</em>
<a id="L1534" name="L1534"></a>1534                                 <strong class="reserved">if</strong> (!copyInLocalValue) <em class="brace">{</em>
<a id="L1535" name="L1535"></a>1535                                     revisedLocalVarStart.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(oldLVG,
<a id="L1536" name="L1536"></a>1536                                                              copyOutStore);
<a id="L1537" name="L1537"></a>1537                                 <em class="brace">}</em>
<a id="L1538" name="L1538"></a>1538                             <em class="brace">}</em>
<a id="L1539" name="L1539"></a>1539                         <em class="brace">}</em>
<a id="L1540" name="L1540"></a>1540                     <em class="brace">}</em>
<a id="L1541" name="L1541"></a>1541                 <em class="brace">}</em>
<a id="L1542" name="L1542"></a>1542 
<a id="L1543" name="L1543"></a>1543                 <strong class="reserved">if</strong> (ih.<a href="../S/4625.html#L214" title="Defined at 214 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">hasTargeters</a>()) <em class="brace">{</em>
<a id="L1544" name="L1544"></a>1544                     targetMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(ih, lastCopyHandle);
<a id="L1545" name="L1545"></a>1545                 <em class="brace">}</em>
<a id="L1546" name="L1546"></a>1546 
<a id="L1547" name="L1547"></a>1547                 <em class="comment">// If this is the first instruction copied following a sequence</em>
<a id="L1548" name="L1548"></a>1548                 <em class="comment">// of OutlineableChunkStart instructions, indicate that the</em>
<a id="L1549" name="L1549"></a>1549                 <em class="comment">// sequence of old instruction all map to this newly created</em>
<a id="L1550" name="L1550"></a>1550                 <em class="comment">// instruction</em>
<a id="L1551" name="L1551"></a>1551                 <strong class="reserved">if</strong> (chunkStartTargetMappingsPending) <em class="brace">{</em>
<a id="L1552" name="L1552"></a>1552                     <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1553" name="L1553"></a>1553                          targetMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(pendingTargetMappingHandle,
<a id="L1554" name="L1554"></a>1554                                        lastCopyHandle);
<a id="L1555" name="L1555"></a>1555                          pendingTargetMappingHandle =
<a id="L1556" name="L1556"></a>1556                                  pendingTargetMappingHandle.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>();
<a id="L1557" name="L1557"></a>1557                     <em class="brace">}</em> <strong class="reserved">while</strong>(pendingTargetMappingHandle != ih);
<a id="L1558" name="L1558"></a>1558 
<a id="L1559" name="L1559"></a>1559                     chunkStartTargetMappingsPending = <strong class="reserved">false</strong>;
<a id="L1560" name="L1560"></a>1560                 <em class="brace">}</em>
<a id="L1561" name="L1561"></a>1561             <em class="brace">}</em>
<a id="L1562" name="L1562"></a>1562         <em class="brace">}</em>
<a id="L1563" name="L1563"></a>1563 
<a id="L1564" name="L1564"></a>1564         <em class="comment">// Pass 2: Walk old and new instruction lists, updating branch targets</em>
<a id="L1565" name="L1565"></a>1565         <em class="comment">// and local variable references in the new list</em>
<a id="L1566" name="L1566"></a>1566         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> ih = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>;
<a id="L1567" name="L1567"></a>1567         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> ch = newIL.<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>();
<a id="L1568" name="L1568"></a>1568 
<a id="L1569" name="L1569"></a>1569         <strong class="reserved">while</strong> (ch != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1570" name="L1570"></a>1570             <em class="comment">// i == old instruction; c == copied instruction</em>
<a id="L1571" name="L1571"></a>1571             <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> i = ih.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>();
<a id="L1572" name="L1572"></a>1572             <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = ch.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>();
<a id="L1573" name="L1573"></a>1573 
<a id="L1574" name="L1574"></a>1574             <strong class="reserved">if</strong> (i <strong class="reserved">instanceof</strong> <a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a>) <em class="brace">{</em>
<a id="L1575" name="L1575"></a>1575                 <a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a> bc      = (<a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L1576" name="L1576"></a>1576                 <a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a> bi      = (<a href="../S/4732.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java.">BranchInstruction</a>)i;
<a id="L1577" name="L1577"></a>1577                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> itarget = bi.<a href="../D/22997.html" title="Multiple defined in 36 places.">getTarget</a>(); <em class="comment">// old target</em>
<a id="L1578" name="L1578"></a>1578 
<a id="L1579" name="L1579"></a>1579                 <em class="comment">// New target must be in targetMap</em>
<a id="L1580" name="L1580"></a>1580                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> newTarget =
<a id="L1581" name="L1581"></a>1581                     (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>)targetMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(itarget);
<a id="L1582" name="L1582"></a>1582 
<a id="L1583" name="L1583"></a>1583                 bc.<a href="../D/34078.html" title="Multiple defined in 20 places.">setTarget</a>(newTarget);
<a id="L1584" name="L1584"></a>1584 
<a id="L1585" name="L1585"></a>1585                 <em class="comment">// Handle LOOKUPSWITCH or TABLESWITCH which may have many</em>
<a id="L1586" name="L1586"></a>1586                 <em class="comment">// target instructions</em>
<a id="L1587" name="L1587"></a>1587                 <strong class="reserved">if</strong> (bi <strong class="reserved">instanceof</strong> <a href="../S/4618.html#L71" title="Defined at 71 in src/com/sun/org/apache/bcel/internal/generic/Select.java.">Select</a>) <em class="brace">{</em>
<a id="L1588" name="L1588"></a>1588                     <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>[] itargets = ((<a href="../S/4618.html#L71" title="Defined at 71 in src/com/sun/org/apache/bcel/internal/generic/Select.java.">Select</a>)bi).<a href="../D/23024.html" title="Multiple defined in 2 places.">getTargets</a>();
<a id="L1589" name="L1589"></a>1589                     <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>[] ctargets = ((<a href="../S/4618.html#L71" title="Defined at 71 in src/com/sun/org/apache/bcel/internal/generic/Select.java.">Select</a>)bc).<a href="../D/23024.html" title="Multiple defined in 2 places.">getTargets</a>();
<a id="L1590" name="L1590"></a>1590 
<a id="L1591" name="L1591"></a>1591                     <em class="comment">// Update all targets</em>
<a id="L1592" name="L1592"></a>1592                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j=0; j &lt; itargets.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; j++) <em class="brace">{</em>
<a id="L1593" name="L1593"></a>1593                         ctargets[j] =
<a id="L1594" name="L1594"></a>1594                             (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>)targetMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(itargets[j]);
<a id="L1595" name="L1595"></a>1595                     <em class="brace">}</em>
<a id="L1596" name="L1596"></a>1596                 <em class="brace">}</em>
<a id="L1597" name="L1597"></a>1597             <em class="brace">}</em>  <strong class="reserved">else</strong> <strong class="reserved">if</strong> (i <strong class="reserved">instanceof</strong> <a href="../S/4711.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableInstruction.java.">LocalVariableInstruction</a>
<a id="L1598" name="L1598"></a>1598                             || i <strong class="reserved">instanceof</strong> <a href="../S/4716.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/RET.java.">RET</a>) <em class="brace">{</em>
<a id="L1599" name="L1599"></a>1599                 <em class="comment">// For any instruction that touches a local variable,</em>
<a id="L1600" name="L1600"></a>1600                 <em class="comment">// map the location of the variable in the original</em>
<a id="L1601" name="L1601"></a>1601                 <em class="comment">// method to its location in the new method.</em>
<a id="L1602" name="L1602"></a>1602                 <a href="../S/4816.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/IndexedInstruction.java.">IndexedInstruction</a> lvi = (<a href="../S/4816.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/IndexedInstruction.java.">IndexedInstruction</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L1603" name="L1603"></a>1603                 <strong class="reserved">int</strong> oldLocalVarIndex = lvi.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L1604" name="L1604"></a>1604                 <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> oldLVG =
<a id="L1605" name="L1605"></a>1605                         <a href="../S/6132.html#L248" title="Defined at 248 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getLocalVariableRegistry</a>()
<a id="L1606" name="L1606"></a>1606                                 .<a href="../S/6132.html#L357" title="Defined at 357 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">lookupRegisteredLocalVariable</a>(oldLocalVarIndex,
<a id="L1607" name="L1607"></a>1607                                                               ih.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>());
<a id="L1608" name="L1608"></a>1608                 <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> newLVG =
<a id="L1609" name="L1609"></a>1609                         (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)localVarMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(oldLVG);
<a id="L1610" name="L1610"></a>1610                 <strong class="reserved">int</strong> newLocalVarIndex;
<a id="L1611" name="L1611"></a>1611 
<a id="L1612" name="L1612"></a>1612                 <strong class="reserved">if</strong> (newLVG == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1613" name="L1613"></a>1613                     <em class="comment">// Create new variable based on old variable - use same</em>
<a id="L1614" name="L1614"></a>1614                     <em class="comment">// name and type, but we will let the variable be active</em>
<a id="L1615" name="L1615"></a>1615                     <em class="comment">// for the entire outlined method.</em>
<a id="L1616" name="L1616"></a>1616                     <em class="comment">// LocalVariableGen oldLocal = oldLocals[oldLocalVarIndex];</em>
<a id="L1617" name="L1617"></a>1617                     <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> varName = oldLVG.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L1618" name="L1618"></a>1618                     <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> varType = oldLVG.<a href="../D/23311.html" title="Multiple defined in 232 places.">getType</a>();
<a id="L1619" name="L1619"></a>1619                     newLVG = outlinedMethodGen.<a href="../D/10913.html" title="Multiple defined in 3 places.">addLocalVariable</a>(varName,
<a id="L1620" name="L1620"></a>1620                                                                 varType,
<a id="L1621" name="L1621"></a>1621                                                                 <strong class="reserved">null</strong>,
<a id="L1622" name="L1622"></a>1622                                                                 <strong class="reserved">null</strong>);
<a id="L1623" name="L1623"></a>1623                     newLocalVarIndex = newLVG.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L1624" name="L1624"></a>1624                     localVarMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(oldLVG, newLVG);
<a id="L1625" name="L1625"></a>1625 
<a id="L1626" name="L1626"></a>1626                     <em class="comment">// The old variable's live range was wholly contained in</em>
<a id="L1627" name="L1627"></a>1627                     <em class="comment">// the outlined chunk.  There should no longer be stores</em>
<a id="L1628" name="L1628"></a>1628                     <em class="comment">// of values into it or loads of its value, so we can just</em>
<a id="L1629" name="L1629"></a>1629                     <em class="comment">// mark its live range as the reference to the outlined</em>
<a id="L1630" name="L1630"></a>1630                     <em class="comment">// method.</em>
<a id="L1631" name="L1631"></a>1631                     revisedLocalVarStart.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(oldLVG, outlinedMethodRef);
<a id="L1632" name="L1632"></a>1632                     revisedLocalVarEnd.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(oldLVG, outlinedMethodRef);
<a id="L1633" name="L1633"></a>1633                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1634" name="L1634"></a>1634                     newLocalVarIndex = newLVG.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>();
<a id="L1635" name="L1635"></a>1635                 <em class="brace">}</em>
<a id="L1636" name="L1636"></a>1636                 lvi.<a href="../D/32925.html" title="Multiple defined in 28 places.">setIndex</a>(newLocalVarIndex);
<a id="L1637" name="L1637"></a>1637             <em class="brace">}</em>
<a id="L1638" name="L1638"></a>1638 
<a id="L1639" name="L1639"></a>1639             <em class="comment">// If the old instruction marks the end of the range of a local</em>
<a id="L1640" name="L1640"></a>1640             <em class="comment">// variable, make sure that any slots on the stack reserved for</em>
<a id="L1641" name="L1641"></a>1641             <em class="comment">// local variables are made available for reuse by calling</em>
<a id="L1642" name="L1642"></a>1642             <em class="comment">// MethodGenerator.removeLocalVariable</em>
<a id="L1643" name="L1643"></a>1643             <strong class="reserved">if</strong> (ih.<a href="../S/4625.html#L214" title="Defined at 214 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">hasTargeters</a>()) <em class="brace">{</em>
<a id="L1644" name="L1644"></a>1644                 <a href="../S/4636.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/InstructionTargeter.java.">InstructionTargeter</a>[] targeters = ih.<a href="../S/4625.html#L221" title="Defined at 221 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">getTargeters</a>();
<a id="L1645" name="L1645"></a>1645 
<a id="L1646" name="L1646"></a>1646                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> idx = 0; idx &lt; targeters.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; idx++) <em class="brace">{</em>
<a id="L1647" name="L1647"></a>1647                     <a href="../S/4636.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/InstructionTargeter.java.">InstructionTargeter</a> targeter = targeters[idx];
<a id="L1648" name="L1648"></a>1648 
<a id="L1649" name="L1649"></a>1649                     <strong class="reserved">if</strong> (targeter <strong class="reserved">instanceof</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>
<a id="L1650" name="L1650"></a>1650                             &amp;&amp; ((<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)targeter).<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>()==ih) <em class="brace">{</em>
<a id="L1651" name="L1651"></a>1651                         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> newLVG = localVarMap.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(targeter);
<a id="L1652" name="L1652"></a>1652                         <strong class="reserved">if</strong> (newLVG != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1653" name="L1653"></a>1653                             outlinedMethodGen.<a href="../D/30860.html" title="Multiple defined in 2 places.">removeLocalVariable</a>(
<a id="L1654" name="L1654"></a>1654                                                   (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)newLVG);
<a id="L1655" name="L1655"></a>1655                         <em class="brace">}</em>
<a id="L1656" name="L1656"></a>1656                     <em class="brace">}</em>
<a id="L1657" name="L1657"></a>1657                 <em class="brace">}</em>
<a id="L1658" name="L1658"></a>1658             <em class="brace">}</em>
<a id="L1659" name="L1659"></a>1659 
<a id="L1660" name="L1660"></a>1660             <em class="comment">// If the current instruction in the original list was a marker,</em>
<a id="L1661" name="L1661"></a>1661             <em class="comment">// it wasn't copied, so don't advance through the list of copied</em>
<a id="L1662" name="L1662"></a>1662             <em class="comment">// instructions yet.</em>
<a id="L1663" name="L1663"></a>1663             <strong class="reserved">if</strong> (!(i <strong class="reserved">instanceof</strong> <a href="../S/6117.html#L40" title="Defined at 40 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MarkerInstruction.java.">MarkerInstruction</a>)) <em class="brace">{</em>
<a id="L1664" name="L1664"></a>1664                 ch = ch.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>();
<a id="L1665" name="L1665"></a>1665             <em class="brace">}</em>
<a id="L1666" name="L1666"></a>1666             ih = ih.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>();
<a id="L1667" name="L1667"></a>1667 
<a id="L1668" name="L1668"></a>1668         <em class="brace">}</em>
<a id="L1669" name="L1669"></a>1669 
<a id="L1670" name="L1670"></a>1670         <em class="comment">// POP the reference to the CopyLocals object from the stack</em>
<a id="L1671" name="L1671"></a>1671         oldMethCopyOutIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../D/6521.html" title="Multiple defined in 4 places.">POP</a>);
<a id="L1672" name="L1672"></a>1672 
<a id="L1673" name="L1673"></a>1673         <em class="comment">// Now that the generation of the outlined code is complete, update</em>
<a id="L1674" name="L1674"></a>1674         <em class="comment">// the old local variables with new start and end ranges, as required.</em>
<a id="L1675" name="L1675"></a>1675         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> revisedLocalVarStartPairIter = revisedLocalVarStart.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>()
<a id="L1676" name="L1676"></a>1676                                                                     .<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L1677" name="L1677"></a>1677         <strong class="reserved">while</strong> (revisedLocalVarStartPairIter.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L1678" name="L1678"></a>1678             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> lvgRangeStartPair =
<a id="L1679" name="L1679"></a>1679                     (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)revisedLocalVarStartPairIter.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L1680" name="L1680"></a>1680             <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg = (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)lvgRangeStartPair.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>();
<a id="L1681" name="L1681"></a>1681             <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> startInst =
<a id="L1682" name="L1682"></a>1682                     (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>)lvgRangeStartPair.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L1683" name="L1683"></a>1683 
<a id="L1684" name="L1684"></a>1684             lvg.<a href="../D/33997.html" title="Multiple defined in 5 places.">setStart</a>(startInst);
<a id="L1685" name="L1685"></a>1685 
<a id="L1686" name="L1686"></a>1686         <em class="brace">}</em>
<a id="L1687" name="L1687"></a>1687 
<a id="L1688" name="L1688"></a>1688         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> revisedLocalVarEndPairIter = revisedLocalVarEnd.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>()
<a id="L1689" name="L1689"></a>1689                                                                 .<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L1690" name="L1690"></a>1690         <strong class="reserved">while</strong> (revisedLocalVarEndPairIter.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L1691" name="L1691"></a>1691             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> lvgRangeEndPair =
<a id="L1692" name="L1692"></a>1692                     (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)revisedLocalVarEndPairIter.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L1693" name="L1693"></a>1693             <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg = (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>)lvgRangeEndPair.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>();
<a id="L1694" name="L1694"></a>1694             <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> endInst =
<a id="L1695" name="L1695"></a>1695                     (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>)lvgRangeEndPair.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L1696" name="L1696"></a>1696 
<a id="L1697" name="L1697"></a>1697             lvg.<a href="../D/32584.html" title="Multiple defined in 5 places.">setEnd</a>(endInst);
<a id="L1698" name="L1698"></a>1698         <em class="brace">}</em>
<a id="L1699" name="L1699"></a>1699 
<a id="L1700" name="L1700"></a>1700         xsltc.<a href="../D/15247.html" title="Multiple defined in 2 places.">dumpClass</a>(copyAreaCG.<a href="../D/19889.html" title="Multiple defined in 3 places.">getJavaClass</a>());
<a id="L1701" name="L1701"></a>1701 
<a id="L1702" name="L1702"></a>1702         <em class="comment">// Assemble the instruction lists so that the old method invokes the</em>
<a id="L1703" name="L1703"></a>1703         <em class="comment">// new outlined method</em>
<a id="L1704" name="L1704"></a>1704         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> oldMethodIL = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>();
<a id="L1705" name="L1705"></a>1705 
<a id="L1706" name="L1706"></a>1706         oldMethodIL.<a href="../D/24721.html" title="Multiple defined in 265 places.">insert</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>, oldMethCopyInIL);
<a id="L1707" name="L1707"></a>1707         oldMethodIL.<a href="../D/24721.html" title="Multiple defined in 265 places.">insert</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>, oldMethCopyOutIL);
<a id="L1708" name="L1708"></a>1708 
<a id="L1709" name="L1709"></a>1709         <em class="comment">// Insert the copying code into the outlined method</em>
<a id="L1710" name="L1710"></a>1710         newIL.<a href="../D/24721.html" title="Multiple defined in 265 places.">insert</a>(newMethCopyInIL);
<a id="L1711" name="L1711"></a>1711         newIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(newMethCopyOutIL);
<a id="L1712" name="L1712"></a>1712         newIL.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/4651.html#L79" title="Defined at 79 in src/com/sun/org/apache/bcel/internal/generic/InstructionConstants.java.">InstructionConstants</a>.<a href="../D/7024.html" title="Multiple defined in 4 places.">RETURN</a>);
<a id="L1713" name="L1713"></a>1713 
<a id="L1714" name="L1714"></a>1714         <em class="comment">// Discard instructions in outlineable chunk from old method</em>
<a id="L1715" name="L1715"></a>1715         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1716" name="L1716"></a>1716             oldMethodIL.<a href="../D/14793.html" title="Multiple defined in 25 places.">delete</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>, <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>);
<a id="L1717" name="L1717"></a>1717         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/4746.html#L91" title="Defined at 91 in src/com/sun/org/apache/bcel/internal/generic/TargetLostException.java.">TargetLostException</a> e) <em class="brace">{</em>
<a id="L1718" name="L1718"></a>1718             <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a>[] targets = e.<a href="../D/23024.html" title="Multiple defined in 2 places.">getTargets</a>();
<a id="L1719" name="L1719"></a>1719             <em class="comment">// If there were still references to old instructions lingering,</em>
<a id="L1720" name="L1720"></a>1720             <em class="comment">// clean those up.  The only instructions targetting the deleted</em>
<a id="L1721" name="L1721"></a>1721             <em class="comment">// instructions should have been part of the chunk that was just</em>
<a id="L1722" name="L1722"></a>1722             <em class="comment">// deleted, except that instructions might branch to the start of</em>
<a id="L1723" name="L1723"></a>1723             <em class="comment">// the outlined chunk; similarly, all the live ranges of local</em>
<a id="L1724" name="L1724"></a>1724             <em class="comment">// variables should have been adjusted, except for unreferenced</em>
<a id="L1725" name="L1725"></a>1725             <em class="comment">// variables.</em>
<a id="L1726" name="L1726"></a>1726             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; targets.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1727" name="L1727"></a>1727                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> lostTarget = targets[i];
<a id="L1728" name="L1728"></a>1728                 <a href="../S/4636.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/InstructionTargeter.java.">InstructionTargeter</a>[] targeters = lostTarget.<a href="../S/4625.html#L221" title="Defined at 221 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">getTargeters</a>();
<a id="L1729" name="L1729"></a>1729                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; targeters.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; j++) <em class="brace">{</em>
<a id="L1730" name="L1730"></a>1730                     <strong class="reserved">if</strong> (targeters[j] <strong class="reserved">instanceof</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) <em class="brace">{</em>
<a id="L1731" name="L1731"></a>1731                         <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvgTargeter =
<a id="L1732" name="L1732"></a>1732                                              (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) targeters[j];
<a id="L1733" name="L1733"></a>1733                         <em class="comment">// In the case of any lingering variable references,</em>
<a id="L1734" name="L1734"></a>1734                         <em class="comment">// just make the live range point to the outlined</em>
<a id="L1735" name="L1735"></a>1735                         <em class="comment">// function reference.  Such variables should be unused</em>
<a id="L1736" name="L1736"></a>1736                         <em class="comment">// anyway.</em>
<a id="L1737" name="L1737"></a>1737                         <strong class="reserved">if</strong> (lvgTargeter.<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>() == lostTarget) <em class="brace">{</em>
<a id="L1738" name="L1738"></a>1738                             lvgTargeter.<a href="../D/33997.html" title="Multiple defined in 5 places.">setStart</a>(outlinedMethodRef);
<a id="L1739" name="L1739"></a>1739                         <em class="brace">}</em>
<a id="L1740" name="L1740"></a>1740                         <strong class="reserved">if</strong> (lvgTargeter.<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>() == lostTarget) <em class="brace">{</em>
<a id="L1741" name="L1741"></a>1741                             lvgTargeter.<a href="../D/32584.html" title="Multiple defined in 5 places.">setEnd</a>(outlinedMethodRef);
<a id="L1742" name="L1742"></a>1742                         <em class="brace">}</em>
<a id="L1743" name="L1743"></a>1743                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1744" name="L1744"></a>1744                         targeters[j].<a href="../D/36228.html" title="Multiple defined in 7 places.">updateTarget</a>(lostTarget,
<a id="L1745" name="L1745"></a>1745                                                   outlinedMethodCallSetup);
<a id="L1746" name="L1746"></a>1746                     <em class="brace">}</em>
<a id="L1747" name="L1747"></a>1747                 <em class="brace">}</em>
<a id="L1748" name="L1748"></a>1748             <em class="brace">}</em>
<a id="L1749" name="L1749"></a>1749         <em class="brace">}</em>
<a id="L1750" name="L1750"></a>1750 
<a id="L1751" name="L1751"></a>1751         <em class="comment">// Make a copy for the new method of all exceptions that might be thrown</em>
<a id="L1752" name="L1752"></a>1752         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>[] <a href="../D/15786.html" title="Multiple defined in 7 places.">exceptions</a> = <a href="../D/18907.html" title="Multiple defined in 27 places.">getExceptions</a>();
<a id="L1753" name="L1753"></a>1753         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/15786.html" title="Multiple defined in 7 places.">exceptions</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1754" name="L1754"></a>1754             outlinedMethodGen.<a href="../S/4802.html#L633" title="Defined at 633 in src/com/sun/org/apache/bcel/internal/generic/MethodGen.java.">addException</a>(<a href="../D/15786.html" title="Multiple defined in 7 places.">exceptions</a>[i]);
<a id="L1755" name="L1755"></a>1755         <em class="brace">}</em>
<a id="L1756" name="L1756"></a>1756 
<a id="L1757" name="L1757"></a>1757         <strong class="reserved">return</strong> outlinedMethodGen.<a href="../S/6132.html#L1912" title="Defined at 1912 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getThisMethod</a>();
<a id="L1758" name="L1758"></a>1758     <em class="brace">}</em>
<a id="L1759" name="L1759"></a>1759 
<div class="comment">
      Helper method to generate an instance of a subclass of
      {@link LoadInstruction} based on the specified {@link Type} that will
      load the specified local variable
      @param index the JVM stack frame index of the variable that is to be
      loaded
      @param type the {@link Type} of the variable
      @return the generated {@link LoadInstruction}</div>
<a id="L1769" name="L1769"></a>1769     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/22601.html" title="Multiple referred from 10 places.">loadLocal</a>(<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>) <em class="brace">{</em>
<a id="L1770" name="L1770"></a>1770         <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L159" title="Defined at 159 in src/java/sql/JDBCType.java.">BOOLEAN</a>) <em class="brace">{</em>
<a id="L1771" name="L1771"></a>1771            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4623.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ILOAD.java.">ILOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1772" name="L1772"></a>1772         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.INT) <em class="brace">{</em>
<a id="L1773" name="L1773"></a>1773            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4623.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ILOAD.java.">ILOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1774" name="L1774"></a>1774         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/1535.html#L104" title="Defined at 104 in src/java/time/format/TextStyle.java.">SHORT</a>) <em class="brace">{</em>
<a id="L1775" name="L1775"></a>1775            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4623.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ILOAD.java.">ILOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1776" name="L1776"></a>1776         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.LONG) <em class="brace">{</em>
<a id="L1777" name="L1777"></a>1777            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4804.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/LLOAD.java.">LLOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1778" name="L1778"></a>1778         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.BYTE) <em class="brace">{</em>
<a id="L1779" name="L1779"></a>1779            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4623.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ILOAD.java.">ILOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1780" name="L1780"></a>1780         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L79" title="Defined at 79 in src/java/sql/JDBCType.java.">CHAR</a>) <em class="brace">{</em>
<a id="L1781" name="L1781"></a>1781            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4623.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ILOAD.java.">ILOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1782" name="L1782"></a>1782         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L59" title="Defined at 59 in src/java/sql/JDBCType.java.">FLOAT</a>) <em class="brace">{</em>
<a id="L1783" name="L1783"></a>1783            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4786.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/FLOAD.java.">FLOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1784" name="L1784"></a>1784         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L67" title="Defined at 67 in src/java/sql/JDBCType.java.">DOUBLE</a>) <em class="brace">{</em>
<a id="L1785" name="L1785"></a>1785            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4702.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/DLOAD.java.">DLOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1786" name="L1786"></a>1786         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1787" name="L1787"></a>1787            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4754.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ALOAD.java.">ALOAD</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1788" name="L1788"></a>1788         <em class="brace">}</em>
<a id="L1789" name="L1789"></a>1789     <em class="brace">}</em>
<a id="L1790" name="L1790"></a>1790 
<div class="comment">
      Helper method to generate an instance of a subclass of
      {@link StoreInstruction} based on the specified {@link Type} that will
      store a value in the specified local variable
      @param index the JVM stack frame index of the variable that is to be
      stored
      @param type the {@link Type} of the variable
      @return the generated {@link StoredInstruction}</div>
<a id="L1800" name="L1800"></a>1800     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> <a href="../R/28928.html" title="Multiple referred from 8 places.">storeLocal</a>(<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>) <em class="brace">{</em>
<a id="L1801" name="L1801"></a>1801         <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L159" title="Defined at 159 in src/java/sql/JDBCType.java.">BOOLEAN</a>) <em class="brace">{</em>
<a id="L1802" name="L1802"></a>1802            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4787.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ISTORE.java.">ISTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1803" name="L1803"></a>1803         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.INT) <em class="brace">{</em>
<a id="L1804" name="L1804"></a>1804            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4787.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ISTORE.java.">ISTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1805" name="L1805"></a>1805         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/1535.html#L104" title="Defined at 104 in src/java/time/format/TextStyle.java.">SHORT</a>) <em class="brace">{</em>
<a id="L1806" name="L1806"></a>1806            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4787.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ISTORE.java.">ISTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1807" name="L1807"></a>1807         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.LONG) <em class="brace">{</em>
<a id="L1808" name="L1808"></a>1808            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4646.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/LSTORE.java.">LSTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1809" name="L1809"></a>1809         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.BYTE) <em class="brace">{</em>
<a id="L1810" name="L1810"></a>1810            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4787.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ISTORE.java.">ISTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1811" name="L1811"></a>1811         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L79" title="Defined at 79 in src/java/sql/JDBCType.java.">CHAR</a>) <em class="brace">{</em>
<a id="L1812" name="L1812"></a>1812            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4787.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ISTORE.java.">ISTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1813" name="L1813"></a>1813         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L59" title="Defined at 59 in src/java/sql/JDBCType.java.">FLOAT</a>) <em class="brace">{</em>
<a id="L1814" name="L1814"></a>1814            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4688.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/FSTORE.java.">FSTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1815" name="L1815"></a>1815         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == <a href="../D/9178.html" title="Multiple defined in 19 places.">Type</a>.<a href="../S/2603.html#L67" title="Defined at 67 in src/java/sql/JDBCType.java.">DOUBLE</a>) <em class="brace">{</em>
<a id="L1816" name="L1816"></a>1816            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4801.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/DSTORE.java.">DSTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1817" name="L1817"></a>1817         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1818" name="L1818"></a>1818            <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/4659.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/ASTORE.java.">ASTORE</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L1819" name="L1819"></a>1819         <em class="brace">}</em>
<a id="L1820" name="L1820"></a>1820     <em class="brace">}</em>
<a id="L1821" name="L1821"></a>1821 
<div class="comment">
      Track the number of outlineable chunks seen.</div>
<a id="L1825" name="L1825"></a>1825     <strong class="reserved">private</strong> <strong class="reserved">int</strong> m_totalChunks = 0;
<a id="L1826" name="L1826"></a>1826 
<div class="comment">
      Track the number of outlineable chunks started but not yet ended.  Used
      to detect imbalances in byte code generation.</div>
<a id="L1831" name="L1831"></a>1831     <strong class="reserved">private</strong> <strong class="reserved">int</strong> m_openChunks = 0;
<a id="L1832" name="L1832"></a>1832 
<div class="comment">
      Mark the end of the method's
      {@link InstructionList} as the start of an outlineable chunk of code.
      The outlineable chunk begins after the {@link InstructionHandle} that is
      at the end of the method's {@link InstructionList}, or at the start of
      the method if the <code>InstructionList</code> is empty.
      See {@link OutlineableChunkStart} for more information.</div>
<a id="L1841" name="L1841"></a>1841     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/23093.html" title="Multiple referred from 17 places.">markChunkStart</a>() <em class="brace">{</em>
<a id="L1842" name="L1842"></a>1842         <em class="comment">// m_chunkTree.markChunkStart();</em>
<a id="L1843" name="L1843"></a>1843         <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>()
<a id="L1844" name="L1844"></a>1844                 .<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/6121.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/OutlineableChunkStart.java.">OutlineableChunkStart</a>.OUTLINEABLECHUNKSTART);
<a id="L1845" name="L1845"></a>1845         m_totalChunks++;
<a id="L1846" name="L1846"></a>1846         m_openChunks++;
<a id="L1847" name="L1847"></a>1847     <em class="brace">}</em>
<a id="L1848" name="L1848"></a>1848 
<div class="comment">
      Mark the end of an outlineable chunk of code.  See
      {@link OutlineableChunkStart} for more information.</div>
<a id="L1853" name="L1853"></a>1853     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/23092.html" title="Multiple referred from 16 places.">markChunkEnd</a>() <em class="brace">{</em>
<a id="L1854" name="L1854"></a>1854         <em class="comment">// m_chunkTree.markChunkEnd();</em>
<a id="L1855" name="L1855"></a>1855         <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>()
<a id="L1856" name="L1856"></a>1856                 .<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(<a href="../S/6099.html#L31" title="Defined at 31 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/OutlineableChunkEnd.java.">OutlineableChunkEnd</a>.OUTLINEABLECHUNKEND);
<a id="L1857" name="L1857"></a>1857         m_openChunks--;
<a id="L1858" name="L1858"></a>1858         <strong class="reserved">if</strong> (m_openChunks &lt; 0) <em class="brace">{</em>
<a id="L1859" name="L1859"></a>1859             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> = (<strong class="reserved">new</strong> <a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>(<a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>.OUTLINE_ERR_UNBALANCED_MARKERS))
<a id="L1860" name="L1860"></a>1860                                  .<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L1861" name="L1861"></a>1861             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L1862" name="L1862"></a>1862         <em class="brace">}</em>
<a id="L1863" name="L1863"></a>1863     <em class="brace">}</em>
<a id="L1864" name="L1864"></a>1864 
<div class="comment">
      <p>Get all {@link Method}s generated by this {@link MethodGenerator}.
      The {@link MethodGen#getMethod()} only returns a single
      <code>Method</code> object.  This method takes into account the Java
      Virtual Machine Specification limit of 64KB on the size of a method, and
      may return more than one <code>Method</code>.</p>
      <p>If the code associated with the <code>MethodGenerator</code> would
      exceed the 64KB limit, this method will attempt to split the code in
      the {@link InstructionList} associated with this
      <code>MethodGenerator</code> into several methods.</p>
      @param classGen the {@link ClassGenerator} of which these methods are
                      members
      @return an array of all the <code>Method</code>s generated</div>
<a id="L1879" name="L1879"></a>1879     <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] <a href="../S/6130.html#L139" title="Referred from 139 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">getGeneratedMethods</a>(<a href="../S/6130.html#L50" title="Defined at 50 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ClassGenerator.java.">ClassGenerator</a> classGen) <em class="brace">{</em>
<a id="L1880" name="L1880"></a>1880         <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] generatedMethods;
<a id="L1881" name="L1881"></a>1881         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> il = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>();
<a id="L1882" name="L1882"></a>1882         <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = il.<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>();
<a id="L1883" name="L1883"></a>1883 
<a id="L1884" name="L1884"></a>1884         il.<a href="../D/33568.html" title="Multiple defined in 2 places.">setPositions</a>();
<a id="L1885" name="L1885"></a>1885 
<a id="L1886" name="L1886"></a>1886         <strong class="reserved">int</strong> instructionListSize =
<a id="L1887" name="L1887"></a>1887                     <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>() + <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>().<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>();
<a id="L1888" name="L1888"></a>1888 
<a id="L1889" name="L1889"></a>1889         <em class="comment">// Need to look for any branch target offsets that exceed the range</em>
<a id="L1890" name="L1890"></a>1890         <em class="comment">// [-32768,32767]</em>
<a id="L1891" name="L1891"></a>1891         <strong class="reserved">if</strong> (instructionListSize &gt; MAX_BRANCH_TARGET_OFFSET) <em class="brace">{</em>
<a id="L1892" name="L1892"></a>1892             <strong class="reserved">boolean</strong> ilChanged = <a href="../S/6132.html#L1980" title="Defined at 1980 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">widenConditionalBranchTargetOffsets</a>();
<a id="L1893" name="L1893"></a>1893 
<a id="L1894" name="L1894"></a>1894             <em class="comment">// If any branch instructions needed widening, recompute the size</em>
<a id="L1895" name="L1895"></a>1895             <em class="comment">// of the byte code for the method</em>
<a id="L1896" name="L1896"></a>1896             <strong class="reserved">if</strong> (ilChanged) <em class="brace">{</em>
<a id="L1897" name="L1897"></a>1897                 il.<a href="../D/33568.html" title="Multiple defined in 2 places.">setPositions</a>();
<a id="L1898" name="L1898"></a>1898                 <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = il.<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>();
<a id="L1899" name="L1899"></a>1899                 instructionListSize =
<a id="L1900" name="L1900"></a>1900                         <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>() + <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>().<a href="../D/20075.html" title="Multiple defined in 116 places.">getLength</a>();
<a id="L1901" name="L1901"></a>1901             <em class="brace">}</em>
<a id="L1902" name="L1902"></a>1902         <em class="brace">}</em>
<a id="L1903" name="L1903"></a>1903 
<a id="L1904" name="L1904"></a>1904         <strong class="reserved">if</strong> (instructionListSize &gt; MAX_METHOD_SIZE) <em class="brace">{</em>
<a id="L1905" name="L1905"></a>1905             generatedMethods = <a href="../S/6132.html#L1137" title="Defined at 1137 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">outlineChunks</a>(classGen, instructionListSize);
<a id="L1906" name="L1906"></a>1906         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1907" name="L1907"></a>1907             generatedMethods = <strong class="reserved">new</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] <em class="brace">{</em><a href="../S/6132.html#L1912" title="Defined at 1912 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">getThisMethod</a>()<em class="brace">}</em>;
<a id="L1908" name="L1908"></a>1908         <em class="brace">}</em>
<a id="L1909" name="L1909"></a>1909         <strong class="reserved">return</strong> generatedMethods;
<a id="L1910" name="L1910"></a>1910     <em class="brace">}</em>
<a id="L1911" name="L1911"></a>1911 
<a id="L1912" name="L1912"></a>1912     <strong class="reserved">protected</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> <a href="../R/19454.html" title="Multiple referred from 3 places.">getThisMethod</a>() <em class="brace">{</em>
<a id="L1913" name="L1913"></a>1913         <a href="../S/4802.html#L906" title="Defined at 906 in src/com/sun/org/apache/bcel/internal/generic/MethodGen.java.">stripAttributes</a>(<strong class="reserved">true</strong>);
<a id="L1914" name="L1914"></a>1914         <a href="../D/33202.html" title="Multiple defined in 4 places.">setMaxLocals</a>();
<a id="L1915" name="L1915"></a>1915         <a href="../D/33211.html" title="Multiple defined in 3 places.">setMaxStack</a>();
<a id="L1916" name="L1916"></a>1916         <a href="../S/4802.html#L800" title="Defined at 800 in src/com/sun/org/apache/bcel/internal/generic/MethodGen.java.">removeNOPs</a>();
<a id="L1917" name="L1917"></a>1917 
<a id="L1918" name="L1918"></a>1918         <strong class="reserved">return</strong> <a href="../D/20584.html" title="Multiple defined in 21 places.">getMethod</a>();
<a id="L1919" name="L1919"></a>1919     <em class="brace">}</em>
<div class="comment">
      <p>Rewrites branches to avoid the JVM limits of relative branch
      offsets.  There is no need to invoke this method if the bytecode for the
      {@link MethodGenerator} does not exceed 32KB.</p>
      <p>The Java Virtual Machine Specification permits the code portion of a
      method to be up to 64KB in length.  However, some control transfer
      instructions specify relative offsets as a signed 16-bit quantity,
      limiting the range to a subset of the instructions that might be in a
      method.</p>
      <p>The <code>TABLESWITCH</code> and <code>LOOKUPSWITCH</code>
      instructions always use 32-bit signed relative offsets, so they are
      immune to this problem.</p>
      <p>The <code>GOTO</code> and <code>JSR</code>
      instructions come in two forms, one of which uses 16-bit relative
      offsets, and the other of which uses 32-bit relative offsets.  The BCEL
      library decides whether to use the wide form of <code>GOTO</code> or
      <code>JSR</code>instructions based on the relative offset of the target
      of the instruction without any intervention by the user of the
      library.</p>
      <p>This leaves the various conditional branch instructions,
      <code>IFEQ</code>, <code>IFNULL</code>, <code>IF_ICMPEQ</code>,
      <em>et al.</em>, all of which use 16-bit signed relative offsets, with no
      32-bit wide form available.</p>
      <p>This method scans the {@link InstructionList} associated with this
      {@link MethodGenerator} and finds all conditional branch instructions
      that might exceed the 16-bit limitation for relative branch offsets.
      The logic of each such instruction is inverted, and made to target the
      instruction which follows it.  An unconditional branch to the original
      target of the instruction is then inserted between the conditional
      branch and the instruction which previously followed it.  The
      unconditional branch is permitted to have a 16-bit or a 32-bit relative
      offset, as described above.  For example,
      <code>
      1234:   NOP
               ...
      55278:  IFEQ -54044
      55280:  NOP
      </code>
      is rewritten as
      <code>
      1234:   NOP
               ...
      55278:  IFNE 7
      55280:  GOTO_W -54046
      55285:  NOP
      </code></p>
      <p><b>Preconditions:</b>
      </p><ul><li>The {@link InstructionList#setPositions()} has been called for
      the <code>InstructionList</code> associated with this
      <code>MethodGenerator</code>.
      </li></ul><p></p>
      <p><b>Postconditions:</b>
      </p><ul><li>Any further changes to the <code>InstructionList</code> for this
      <code>MethodGenerator</code> will invalidate the changes made by this
      method.</li></ul>
      <p></p>
      @return <code>true</code> if the <code>InstructionList</code> was
      modified; <code>false</code> otherwise
      @see The Java Virtual Machine Specification, Second Edition</div>
<a id="L1980" name="L1980"></a>1980     <strong class="reserved">boolean</strong> <a href="../S/6132.html#L1892" title="Referred from 1892 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java.">widenConditionalBranchTargetOffsets</a>() <em class="brace">{</em>
<a id="L1981" name="L1981"></a>1981         <strong class="reserved">boolean</strong> ilChanged = <strong class="reserved">false</strong>;
<a id="L1982" name="L1982"></a>1982         <strong class="reserved">int</strong> maxOffsetChange = 0;
<a id="L1983" name="L1983"></a>1983         <a href="../S/4621.html#L87" title="Defined at 87 in src/com/sun/org/apache/bcel/internal/generic/InstructionList.java.">InstructionList</a> il = <a href="../D/19776.html" title="Multiple defined in 7 places.">getInstructionList</a>();
<a id="L1984" name="L1984"></a>1984 
<a id="L1985" name="L1985"></a>1985         <em class="comment">// Loop through all the instructions, finding those that would be</em>
<a id="L1986" name="L1986"></a>1986         <em class="comment">// affected by inserting new instructions in the InstructionList, and</em>
<a id="L1987" name="L1987"></a>1987         <em class="comment">// calculating the maximum amount by which the relative offset between</em>
<a id="L1988" name="L1988"></a>1988         <em class="comment">// two instructions could possibly change.</em>
<a id="L1989" name="L1989"></a>1989         <em class="comment">// In part this loop duplicates code in</em>
<a id="L1990" name="L1990"></a>1990         <em class="comment">// org.apache.bcel.generic.InstructionList.setPosition(), which does</em>
<a id="L1991" name="L1991"></a>1991         <em class="comment">// this to determine whether to use 16-bit or 32-bit offsets for GOTO</em>
<a id="L1992" name="L1992"></a>1992         <em class="comment">// and JSR instructions.  Ideally, that method would do the same for</em>
<a id="L1993" name="L1993"></a>1993         <em class="comment">// conditional branch instructions, but it doesn't, so we duplicate the</em>
<a id="L1994" name="L1994"></a>1994         <em class="comment">// processing here.</em>
<a id="L1995" name="L1995"></a>1995         <strong class="reserved">for</strong> (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> ih = il.<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>();
<a id="L1996" name="L1996"></a>1996              ih != <strong class="reserved">null</strong>;
<a id="L1997" name="L1997"></a>1997              ih = ih.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>()) <em class="brace">{</em>
<a id="L1998" name="L1998"></a>1998             <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> inst = ih.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>();
<a id="L1999" name="L1999"></a>1999 
<a id="L2000" name="L2000"></a>2000             <strong class="reserved">switch</strong> (inst.<a href="../S/4799.html#L264" title="Defined at 264 in src/com/sun/org/apache/bcel/internal/generic/Instruction.java.">getOpcode</a>()) <em class="brace">{</em>
<a id="L2001" name="L2001"></a>2001                 <em class="comment">// Instructions that may have 16-bit or 32-bit branch targets.</em>
<a id="L2002" name="L2002"></a>2002                 <em class="comment">// The size of the branch offset might increase by two bytes.</em>
<a id="L2003" name="L2003"></a>2003                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4790.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/GOTO.java.">GOTO</a>:
<a id="L2004" name="L2004"></a>2004                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4731.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/JSR.java.">JSR</a>:
<a id="L2005" name="L2005"></a>2005                     maxOffsetChange = maxOffsetChange + 2;
<a id="L2006" name="L2006"></a>2006                     <strong class="reserved">break</strong>;
<a id="L2007" name="L2007"></a>2007                 <em class="comment">// Instructions that contain padding for alignment purposes</em>
<a id="L2008" name="L2008"></a>2008                 <em class="comment">// Up to three bytes of padding might be needed.  For greater</em>
<a id="L2009" name="L2009"></a>2009                 <em class="comment">// accuracy, we should be able to discount any padding already</em>
<a id="L2010" name="L2010"></a>2010                 <em class="comment">// added to these instructions by InstructionList.setPosition(),</em>
<a id="L2011" name="L2011"></a>2011                 <em class="comment">// their APIs do not expose that information.</em>
<a id="L2012" name="L2012"></a>2012                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4652.html#L69" title="Defined at 69 in src/com/sun/org/apache/bcel/internal/generic/TABLESWITCH.java.">TABLESWITCH</a>:
<a id="L2013" name="L2013"></a>2013                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4678.html#L69" title="Defined at 69 in src/com/sun/org/apache/bcel/internal/generic/LOOKUPSWITCH.java.">LOOKUPSWITCH</a>:
<a id="L2014" name="L2014"></a>2014                     maxOffsetChange = maxOffsetChange + 3;
<a id="L2015" name="L2015"></a>2015                     <strong class="reserved">break</strong>;
<a id="L2016" name="L2016"></a>2016                 <em class="comment">// Instructions that might be rewritten by this method as a</em>
<a id="L2017" name="L2017"></a>2017                 <em class="comment">// conditional branch followed by an unconditional branch.</em>
<a id="L2018" name="L2018"></a>2018                 <em class="comment">// The unconditional branch would require five bytes.</em>
<a id="L2019" name="L2019"></a>2019                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4793.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ACMPEQ.java.">IF_ACMPEQ</a>:
<a id="L2020" name="L2020"></a>2020                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4704.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ACMPNE.java.">IF_ACMPNE</a>:
<a id="L2021" name="L2021"></a>2021                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4664.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ICMPEQ.java.">IF_ICMPEQ</a>:
<a id="L2022" name="L2022"></a>2022                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4633.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ICMPGE.java.">IF_ICMPGE</a>:
<a id="L2023" name="L2023"></a>2023                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4725.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ICMPGT.java.">IF_ICMPGT</a>:
<a id="L2024" name="L2024"></a>2024                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4743.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ICMPLE.java.">IF_ICMPLE</a>:
<a id="L2025" name="L2025"></a>2025                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4628.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ICMPLT.java.">IF_ICMPLT</a>:
<a id="L2026" name="L2026"></a>2026                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4724.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IF_ICMPNE.java.">IF_ICMPNE</a>:
<a id="L2027" name="L2027"></a>2027                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4635.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFEQ.java.">IFEQ</a>:
<a id="L2028" name="L2028"></a>2028                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4663.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFGE.java.">IFGE</a>:
<a id="L2029" name="L2029"></a>2029                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4762.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFGT.java.">IFGT</a>:
<a id="L2030" name="L2030"></a>2030                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4773.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFLE.java.">IFLE</a>:
<a id="L2031" name="L2031"></a>2031                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4649.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFLT.java.">IFLT</a>:
<a id="L2032" name="L2032"></a>2032                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4757.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFNE.java.">IFNE</a>:
<a id="L2033" name="L2033"></a>2033                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4805.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFNONNULL.java.">IFNONNULL</a>:
<a id="L2034" name="L2034"></a>2034                 <strong class="reserved">case</strong> <a href="../D/1829.html" title="Multiple defined in 9 places.">Constants</a>.<a href="../S/4778.html#L68" title="Defined at 68 in src/com/sun/org/apache/bcel/internal/generic/IFNULL.java.">IFNULL</a>:
<a id="L2035" name="L2035"></a>2035                     maxOffsetChange = maxOffsetChange + 5;
<a id="L2036" name="L2036"></a>2036                     <strong class="reserved">break</strong>;
<a id="L2037" name="L2037"></a>2037             <em class="brace">}</em>
<a id="L2038" name="L2038"></a>2038         <em class="brace">}</em>
<a id="L2039" name="L2039"></a>2039 
<a id="L2040" name="L2040"></a>2040         <em class="comment">// Now that the maximum number of bytes by which the method might grow</em>
<a id="L2041" name="L2041"></a>2041         <em class="comment">// has been determined, look for conditional branches to see which</em>
<a id="L2042" name="L2042"></a>2042         <em class="comment">// might possibly exceed the 16-bit relative offset.</em>
<a id="L2043" name="L2043"></a>2043         <strong class="reserved">for</strong> (<a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> ih = il.<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>();
<a id="L2044" name="L2044"></a>2044              ih != <strong class="reserved">null</strong>;
<a id="L2045" name="L2045"></a>2045              ih = ih.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>()) <em class="brace">{</em>
<a id="L2046" name="L2046"></a>2046             <a href="../D/4259.html" title="Multiple defined in 2 places.">Instruction</a> inst = ih.<a href="../D/19773.html" title="Multiple defined in 4 places.">getInstruction</a>();
<a id="L2047" name="L2047"></a>2047 
<a id="L2048" name="L2048"></a>2048             <strong class="reserved">if</strong> (inst <strong class="reserved">instanceof</strong> <a href="../S/4735.html#L66" title="Defined at 66 in src/com/sun/org/apache/bcel/internal/generic/IfInstruction.java.">IfInstruction</a>) <em class="brace">{</em>
<a id="L2049" name="L2049"></a>2049                 <a href="../S/4735.html#L66" title="Defined at 66 in src/com/sun/org/apache/bcel/internal/generic/IfInstruction.java.">IfInstruction</a> oldIfInst = (<a href="../S/4735.html#L66" title="Defined at 66 in src/com/sun/org/apache/bcel/internal/generic/IfInstruction.java.">IfInstruction</a>)inst;
<a id="L2050" name="L2050"></a>2050                 <a href="../S/4742.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchHandle.java.">BranchHandle</a> oldIfHandle = (<a href="../S/4742.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchHandle.java.">BranchHandle</a>)ih;
<a id="L2051" name="L2051"></a>2051                 <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a> = oldIfInst.<a href="../D/22997.html" title="Multiple defined in 36 places.">getTarget</a>();
<a id="L2052" name="L2052"></a>2052                 <strong class="reserved">int</strong> relativeTargetOffset = <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>()
<a id="L2053" name="L2053"></a>2053                                                - oldIfHandle.<a href="../D/21546.html" title="Multiple defined in 41 places.">getPosition</a>();
<a id="L2054" name="L2054"></a>2054 
<a id="L2055" name="L2055"></a>2055                 <em class="comment">// Consider the worst case scenario in which the conditional</em>
<a id="L2056" name="L2056"></a>2056                 <em class="comment">// branch and its target are separated by all the instructions</em>
<a id="L2057" name="L2057"></a>2057                 <em class="comment">// in the method that might increase in size.  If that results</em>
<a id="L2058" name="L2058"></a>2058                 <em class="comment">// in a relative offset that cannot be represented as a 32-bit</em>
<a id="L2059" name="L2059"></a>2059                 <em class="comment">// signed quantity, rewrite the instruction as described above.</em>
<a id="L2060" name="L2060"></a>2060                 <strong class="reserved">if</strong> ((relativeTargetOffset - maxOffsetChange
<a id="L2061" name="L2061"></a>2061                              &lt; MIN_BRANCH_TARGET_OFFSET)
<a id="L2062" name="L2062"></a>2062                         || (relativeTargetOffset + maxOffsetChange
<a id="L2063" name="L2063"></a>2063                                     &gt; MAX_BRANCH_TARGET_OFFSET)) <em class="brace">{</em>
<a id="L2064" name="L2064"></a>2064                     <em class="comment">// Invert the logic of the IF instruction, and append</em>
<a id="L2065" name="L2065"></a>2065                     <em class="comment">// that to the InstructionList following the original IF</em>
<a id="L2066" name="L2066"></a>2066                     <em class="comment">// instruction</em>
<a id="L2067" name="L2067"></a>2067                     <a href="../S/4625.html#L83" title="Defined at 83 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">InstructionHandle</a> nextHandle = oldIfHandle.<a href="../D/20885.html" title="Multiple defined in 8 places.">getNext</a>();
<a id="L2068" name="L2068"></a>2068                     <a href="../S/4735.html#L66" title="Defined at 66 in src/com/sun/org/apache/bcel/internal/generic/IfInstruction.java.">IfInstruction</a> invertedIfInst = oldIfInst.<a href="../D/27947.html" title="Multiple defined in 27 places.">negate</a>();
<a id="L2069" name="L2069"></a>2069                     <a href="../S/4742.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchHandle.java.">BranchHandle</a> invertedIfHandle = il.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(oldIfHandle,
<a id="L2070" name="L2070"></a>2070                                                               invertedIfInst);
<a id="L2071" name="L2071"></a>2071 
<a id="L2072" name="L2072"></a>2072                     <em class="comment">// Append an unconditional branch to the target of the</em>
<a id="L2073" name="L2073"></a>2073                     <em class="comment">// original IF instruction after the new IF instruction</em>
<a id="L2074" name="L2074"></a>2074                     <a href="../S/4742.html#L72" title="Defined at 72 in src/com/sun/org/apache/bcel/internal/generic/BranchHandle.java.">BranchHandle</a> gotoHandle = il.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(invertedIfHandle,
<a id="L2075" name="L2075"></a>2075                                                         <strong class="reserved">new</strong> <a href="../S/4790.html#L67" title="Defined at 67 in src/com/sun/org/apache/bcel/internal/generic/GOTO.java.">GOTO</a>(<a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>));
<a id="L2076" name="L2076"></a>2076 
<a id="L2077" name="L2077"></a>2077                     <em class="comment">// If the original IF was the last instruction in</em>
<a id="L2078" name="L2078"></a>2078                     <em class="comment">// InstructionList, add a new no-op to act as the target</em>
<a id="L2079" name="L2079"></a>2079                     <em class="comment">// of the new IF</em>
<a id="L2080" name="L2080"></a>2080                     <strong class="reserved">if</strong> (nextHandle == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L2081" name="L2081"></a>2081                         nextHandle = il.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(gotoHandle, <a href="../S/4691.html#L66" title="Defined at 66 in src/com/sun/org/apache/bcel/internal/generic/NOP.java.">NOP</a>);
<a id="L2082" name="L2082"></a>2082                     <em class="brace">}</em>
<a id="L2083" name="L2083"></a>2083 
<a id="L2084" name="L2084"></a>2084                     <em class="comment">// Make the new IF instruction branch around the GOTO</em>
<a id="L2085" name="L2085"></a>2085                     invertedIfHandle.<a href="../D/36228.html" title="Multiple defined in 7 places.">updateTarget</a>(<a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>, nextHandle);
<a id="L2086" name="L2086"></a>2086 
<a id="L2087" name="L2087"></a>2087                     <em class="comment">// If anything still "points" to the old IF instruction,</em>
<a id="L2088" name="L2088"></a>2088                     <em class="comment">// make adjustments to refer to either the new IF or GOTO</em>
<a id="L2089" name="L2089"></a>2089                     <em class="comment">// instruction</em>
<a id="L2090" name="L2090"></a>2090                     <strong class="reserved">if</strong> (oldIfHandle.<a href="../S/4625.html#L214" title="Defined at 214 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">hasTargeters</a>()) <em class="brace">{</em>
<a id="L2091" name="L2091"></a>2091                         <a href="../S/4636.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/InstructionTargeter.java.">InstructionTargeter</a>[] targeters =
<a id="L2092" name="L2092"></a>2092                                                   oldIfHandle.<a href="../S/4625.html#L221" title="Defined at 221 in src/com/sun/org/apache/bcel/internal/generic/InstructionHandle.java.">getTargeters</a>();
<a id="L2093" name="L2093"></a>2093 
<a id="L2094" name="L2094"></a>2094                         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; targeters.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L2095" name="L2095"></a>2095                             <a href="../S/4636.html#L70" title="Defined at 70 in src/com/sun/org/apache/bcel/internal/generic/InstructionTargeter.java.">InstructionTargeter</a> targeter = targeters[i];
<a id="L2096" name="L2096"></a>2096                             <em class="comment">// Ideally, one should simply be able to use</em>
<a id="L2097" name="L2097"></a>2097                             <em class="comment">// InstructionTargeter.updateTarget to change</em>
<a id="L2098" name="L2098"></a>2098                             <em class="comment">// references to the old IF instruction to the new</em>
<a id="L2099" name="L2099"></a>2099                             <em class="comment">// IF instruction.  However, if a LocalVariableGen</em>
<a id="L2100" name="L2100"></a>2100                             <em class="comment">// indicated the old IF marked the end of the range</em>
<a id="L2101" name="L2101"></a>2101                             <em class="comment">// in which the IF variable is in use, the live</em>
<a id="L2102" name="L2102"></a>2102                             <em class="comment">// range of the variable must extend to include the</em>
<a id="L2103" name="L2103"></a>2103                             <em class="comment">// newly created GOTO instruction.  The need for</em>
<a id="L2104" name="L2104"></a>2104                             <em class="comment">// this sort of specific knowledge of an</em>
<a id="L2105" name="L2105"></a>2105                             <em class="comment">// implementor of the InstructionTargeter interface</em>
<a id="L2106" name="L2106"></a>2106                             <em class="comment">// makes the code more fragile.  Future implementors</em>
<a id="L2107" name="L2107"></a>2107                             <em class="comment">// of the interface might have similar requirements</em>
<a id="L2108" name="L2108"></a>2108                             <em class="comment">// which wouldn't be accommodated seemlessly.</em>
<a id="L2109" name="L2109"></a>2109                             <strong class="reserved">if</strong> (targeter <strong class="reserved">instanceof</strong> <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) <em class="brace">{</em>
<a id="L2110" name="L2110"></a>2110                                 <a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a> lvg =
<a id="L2111" name="L2111"></a>2111                                         (<a href="../S/4694.html#L75" title="Defined at 75 in src/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java.">LocalVariableGen</a>) targeter;
<a id="L2112" name="L2112"></a>2112                                 <strong class="reserved">if</strong> (lvg.<a href="../D/22714.html" title="Multiple defined in 6 places.">getStart</a>() == oldIfHandle) <em class="brace">{</em>
<a id="L2113" name="L2113"></a>2113                                     lvg.<a href="../D/33997.html" title="Multiple defined in 5 places.">setStart</a>(invertedIfHandle);
<a id="L2114" name="L2114"></a>2114                                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (lvg.<a href="../D/18764.html" title="Multiple defined in 5 places.">getEnd</a>() == oldIfHandle) <em class="brace">{</em>
<a id="L2115" name="L2115"></a>2115                                     lvg.<a href="../D/32584.html" title="Multiple defined in 5 places.">setEnd</a>(gotoHandle);
<a id="L2116" name="L2116"></a>2116                                 <em class="brace">}</em>
<a id="L2117" name="L2117"></a>2117                             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2118" name="L2118"></a>2118                                 targeter.<a href="../D/36228.html" title="Multiple defined in 7 places.">updateTarget</a>(oldIfHandle,
<a id="L2119" name="L2119"></a>2119                                                       invertedIfHandle);
<a id="L2120" name="L2120"></a>2120                             <em class="brace">}</em>
<a id="L2121" name="L2121"></a>2121                         <em class="brace">}</em>
<a id="L2122" name="L2122"></a>2122                     <em class="brace">}</em>
<a id="L2123" name="L2123"></a>2123 
<a id="L2124" name="L2124"></a>2124                     <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L2125" name="L2125"></a>2125                         il.<a href="../D/14793.html" title="Multiple defined in 25 places.">delete</a>(oldIfHandle);
<a id="L2126" name="L2126"></a>2126                     <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/4746.html#L91" title="Defined at 91 in src/com/sun/org/apache/bcel/internal/generic/TargetLostException.java.">TargetLostException</a> tle) <em class="brace">{</em>
<a id="L2127" name="L2127"></a>2127                         <em class="comment">// This can never happen - we updated the list of</em>
<a id="L2128" name="L2128"></a>2128                         <em class="comment">// instructions that target the deleted instruction</em>
<a id="L2129" name="L2129"></a>2129                         <em class="comment">// prior to deleting it.</em>
<a id="L2130" name="L2130"></a>2130                         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a> =
<a id="L2131" name="L2131"></a>2131                             <strong class="reserved">new</strong> <a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>(<a href="../S/6100.html#L41" title="Defined at 41 in src/com/sun/org/apache/xalan/internal/xsltc/compiler/util/ErrorMsg.java.">ErrorMsg</a>.OUTLINE_ERR_DELETED_TARGET,
<a id="L2132" name="L2132"></a>2132                                          tle.<a href="../D/20565.html" title="Multiple defined in 56 places.">getMessage</a>()).<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L2133" name="L2133"></a>2133                         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4325.html" title="Multiple defined in 2 places.">InternalError</a>(<a href="../S/6957.html#L1026" title="Defined at 1026 in src/com/sun/corba/se/impl/io/ObjectStreamClass.java.">msg</a>);
<a id="L2134" name="L2134"></a>2134                     <em class="brace">}</em>
<a id="L2135" name="L2135"></a>2135 
<a id="L2136" name="L2136"></a>2136                     <em class="comment">// Adjust the pointer in the InstructionList to point after</em>
<a id="L2137" name="L2137"></a>2137                     <em class="comment">// the newly inserted IF instruction</em>
<a id="L2138" name="L2138"></a>2138                     ih = gotoHandle;
<a id="L2139" name="L2139"></a>2139 
<a id="L2140" name="L2140"></a>2140                     <em class="comment">// Indicate that this method rewrote at least one IF</em>
<a id="L2141" name="L2141"></a>2141                     ilChanged = <strong class="reserved">true</strong>;
<a id="L2142" name="L2142"></a>2142                 <em class="brace">}</em>
<a id="L2143" name="L2143"></a>2143             <em class="brace">}</em>
<a id="L2144" name="L2144"></a>2144         <em class="brace">}</em>
<a id="L2145" name="L2145"></a>2145 
<a id="L2146" name="L2146"></a>2146         <em class="comment">// Did this method rewrite any IF instructions?</em>
<a id="L2147" name="L2147"></a>2147         <strong class="reserved">return</strong> ilChanged;
<a id="L2148" name="L2148"></a>2148     <em class="brace">}</em>
<a id="L2149" name="L2149"></a>2149 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L224">[^]</a><a href="#L1980">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>