<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/awt/font/TextMeasurer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L171">[^]</a><a href="#L760">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L171" title="Defined at 171.">clone</a></li>
<li><a href="#L185" title="Defined at 185.">invalidateComponents</a></li>
<li><a href="#L195" title="Defined at 195.">initAll</a></li>
<li><a href="#L265" title="Defined at 265.">generateComponents</a></li>
<li><a href="#L301" title="Defined at 301.">calcLineBreak</a></li>
<li><a href="#L363" title="Defined at 363.">trailingCdWhitespaceStart</a></li>
<li><a href="#L379" title="Defined at 379.">makeComponentsOnRange</a></li>
<li><a href="#L470" title="Defined at 470.">makeTextLineOnRange</a></li>
<li><a href="#L496" title="Defined at 496.">ensureComponents</a></li>
<li><a href="#L503" title="Defined at 503.">makeLayoutWindow</a></li>
<li><a href="#L556" title="Defined at 556.">getLineBreakIndex</a></li>
<li><a href="#L585" title="Defined at 585.">getAdvanceBetween</a></li>
<li><a href="#L610" title="Defined at 610.">getLayout</a></li>
<li><a href="#L633" title="Defined at 633.">printStats</a></li>
<li><a href="#L661" title="Defined at 661.">insertChar</a></li>
<li><a href="#L727" title="Defined at 727.">deleteChar</a></li>
<li><a href="#L760" title="Defined at 760.">getChars</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1997, 2011, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<div class="comment">
  (C) Copyright Taligent, Inc. 1996 - 1997, All Rights Reserved
  (C) Copyright IBM Corp. 1996 - 1998, All Rights Reserved
  The original version of this source code and documentation is
  copyrighted and owned by Taligent, Inc., a wholly-owned subsidiary
  of IBM. These materials are provided under terms of a License
  Agreement between Taligent and Sun. This technology is protected
  by multiple US and International patents.
  This notice and attribution to Taligent may not be removed.
  Taligent is a registered trademark of Taligent, Inc.</div>
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.awt.font;
<a id="L42" name="L42"></a>  42 
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> java.awt.Font;
<a id="L44" name="L44"></a>  44 
<a id="L45" name="L45"></a>  45 <strong class="reserved">import</strong> java.text.AttributedCharacterIterator;
<a id="L46" name="L46"></a>  46 <strong class="reserved">import</strong> java.text.AttributedCharacterIterator.Attribute;
<a id="L47" name="L47"></a>  47 <strong class="reserved">import</strong> java.text.AttributedString;
<a id="L48" name="L48"></a>  48 <strong class="reserved">import</strong> java.text.Bidi;
<a id="L49" name="L49"></a>  49 <strong class="reserved">import</strong> java.text.BreakIterator;
<a id="L50" name="L50"></a>  50 <strong class="reserved">import</strong> java.text.CharacterIterator;
<a id="L51" name="L51"></a>  51 
<a id="L52" name="L52"></a>  52 <strong class="reserved">import</strong> java.awt.font.FontRenderContext;
<a id="L53" name="L53"></a>  53 
<a id="L54" name="L54"></a>  54 <strong class="reserved">import</strong> java.util.Hashtable;
<a id="L55" name="L55"></a>  55 <strong class="reserved">import</strong> java.util.Map;
<a id="L56" name="L56"></a>  56 
<a id="L57" name="L57"></a>  57 <strong class="reserved">import</strong> sun.font.AttributeValues;
<a id="L58" name="L58"></a>  58 <strong class="reserved">import</strong> sun.font.BidiUtils;
<a id="L59" name="L59"></a>  59 <strong class="reserved">import</strong> sun.font.TextLineComponent;
<a id="L60" name="L60"></a>  60 <strong class="reserved">import</strong> sun.font.TextLabelFactory;
<a id="L61" name="L61"></a>  61 <strong class="reserved">import</strong> sun.font.FontResolver;
<a id="L62" name="L62"></a>  62 
<div class="comment">
  The <code>TextMeasurer</code> class provides the primitive operations
  needed for line break: measuring up to a given advance, determining the
  advance of a range of characters, and generating a
  <code>TextLayout</code> for a range of characters. It also provides
  methods for incremental editing of paragraphs.
  <p>
  A <code>TextMeasurer</code> object is constructed with an
  {@link java.text.AttributedCharacterIterator AttributedCharacterIterator}
  representing a single paragraph of text.  The value returned by the
  {@link AttributedCharacterIterator#getBeginIndex() getBeginIndex}
  method of <code>AttributedCharacterIterator</code>
  defines the absolute index of the first character.  The value
  returned by the
  {@link AttributedCharacterIterator#getEndIndex() getEndIndex}
  method of <code>AttributedCharacterIterator</code> defines the index
  past the last character.  These values define the range of indexes to
  use in calls to the <code>TextMeasurer</code>.  For example, calls to
  get the advance of a range of text or the line break of a range of text
  must use indexes between the beginning and end index values.  Calls to
  {@link #insertChar(java.text.AttributedCharacterIterator, int) insertChar}
  and
  {@link #deleteChar(java.text.AttributedCharacterIterator, int) deleteChar}
  reset the <code>TextMeasurer</code> to use the beginning index and end
  index of the <code>AttributedCharacterIterator</code> passed in those calls.
  </p><p>
  Most clients will use the more convenient <code>LineBreakMeasurer</code>,
  which implements the standard line break policy (placing as many words
  as will fit on each line).
  @author John Raley
  @see LineBreakMeasurer
  @since 1.3</p></div>
<a id="L97" name="L97"></a>  97 
<a id="L98" name="L98"></a>  98 <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/8109.html" title="Multiple referred from 4 places.">TextMeasurer</a> <strong class="reserved">implements</strong> <a href="../S/1744.html#L53" title="Defined at 53 in src/java/lang/Cloneable.java.">Cloneable</a> <em class="brace">{</em>
<a id="L99" name="L99"></a>  99 
<a id="L100" name="L100"></a> 100     <em class="comment">// Number of lines to format to.</em>
<a id="L101" name="L101"></a> 101     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">float</strong> EST_LINES = (<strong class="reserved">float</strong>) 2.1;
<a id="L102" name="L102"></a> 102 
<div class="comment">
    static {
        String s = System.getProperty("estLines");
        if (s != null) {
            try {
                Float f = new Float(s);
                EST_LINES = f.floatValue();
            }
            catch(NumberFormatException e) {
            }
        }
        //System.out.println("EST_LINES="+EST_LINES);
    }</div>
<a id="L117" name="L117"></a> 117 
<a id="L118" name="L118"></a> 118     <strong class="reserved">private</strong> <a href="../S/2376.html#L66" title="Defined at 66 in src/java/awt/font/FontRenderContext.java.">FontRenderContext</a> fFrc;
<a id="L119" name="L119"></a> 119 
<a id="L120" name="L120"></a> 120     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fStart;
<a id="L121" name="L121"></a> 121 
<a id="L122" name="L122"></a> 122     <em class="comment">// characters in source text</em>
<a id="L123" name="L123"></a> 123     <strong class="reserved">private</strong> <strong class="reserved">char</strong>[] fChars;
<a id="L124" name="L124"></a> 124 
<a id="L125" name="L125"></a> 125     <em class="comment">// Bidi for this paragraph</em>
<a id="L126" name="L126"></a> 126     <strong class="reserved">private</strong> <a href="../S/2485.html#L61" title="Defined at 61 in src/java/text/Bidi.java.">Bidi</a> fBidi;
<a id="L127" name="L127"></a> 127 
<a id="L128" name="L128"></a> 128     <em class="comment">// Levels array for chars in this paragraph - needed to reorder</em>
<a id="L129" name="L129"></a> 129     <em class="comment">// trailing counterdirectional whitespace</em>
<a id="L130" name="L130"></a> 130     <strong class="reserved">private</strong> <strong class="reserved">byte</strong>[] fLevels;
<a id="L131" name="L131"></a> 131 
<a id="L132" name="L132"></a> 132     <em class="comment">// line components in logical order</em>
<a id="L133" name="L133"></a> 133     <strong class="reserved">private</strong> TextLineComponent[] fComponents;
<a id="L134" name="L134"></a> 134 
<a id="L135" name="L135"></a> 135     <em class="comment">// index where components begin</em>
<a id="L136" name="L136"></a> 136     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fComponentStart;
<a id="L137" name="L137"></a> 137 
<a id="L138" name="L138"></a> 138     <em class="comment">// index where components end</em>
<a id="L139" name="L139"></a> 139     <strong class="reserved">private</strong> <strong class="reserved">int</strong> fComponentLimit;
<a id="L140" name="L140"></a> 140 
<a id="L141" name="L141"></a> 141     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> haveLayoutWindow;
<a id="L142" name="L142"></a> 142 
<a id="L143" name="L143"></a> 143     <em class="comment">// used to find valid starting points for line components</em>
<a id="L144" name="L144"></a> 144     <strong class="reserved">private</strong> <a href="../S/2468.html#L228" title="Defined at 228 in src/java/text/BreakIterator.java.">BreakIterator</a> fLineBreak = <strong class="reserved">null</strong>;
<a id="L145" name="L145"></a> 145     <strong class="reserved">private</strong> <a href="../S/2360.html#L30" title="Defined at 30 in src/java/awt/font/CharArrayIterator.java.">CharArrayIterator</a> charIter = <strong class="reserved">null</strong>;
<a id="L146" name="L146"></a> 146     <strong class="reserved">int</strong> layoutCount = 0;
<a id="L147" name="L147"></a> 147     <strong class="reserved">int</strong> layoutCharCount = 0;
<a id="L148" name="L148"></a> 148 
<a id="L149" name="L149"></a> 149     <em class="comment">// paragraph, with resolved fonts and styles</em>
<a id="L150" name="L150"></a> 150     <strong class="reserved">private</strong> <a href="../S/2372.html#L52" title="Defined at 52 in src/java/awt/font/StyledParagraph.java.">StyledParagraph</a> fParagraph;
<a id="L151" name="L151"></a> 151 
<a id="L152" name="L152"></a> 152     <em class="comment">// paragraph data - same across all layouts</em>
<a id="L153" name="L153"></a> 153     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> fIsDirectionLTR;
<a id="L154" name="L154"></a> 154     <strong class="reserved">private</strong> <strong class="reserved">byte</strong> fBaseline;
<a id="L155" name="L155"></a> 155     <strong class="reserved">private</strong> <strong class="reserved">float</strong>[] fBaselineOffsets;
<a id="L156" name="L156"></a> 156     <strong class="reserved">private</strong> <strong class="reserved">float</strong> fJustifyRatio = 1;
<a id="L157" name="L157"></a> 157 
<div class="comment">
      Constructs a <code>TextMeasurer</code> from the source text.
      The source text should be a single entire paragraph.
      @param text the source paragraph.  Cannot be null.
      @param frc the information about a graphics device which is needed
            to measure the text correctly.  Cannot be null.</div>
<a id="L165" name="L165"></a> 165     <strong class="reserved">public</strong> TextMeasurer(<a href="../S/2454.html#L79" title="Defined at 79 in src/java/text/AttributedCharacterIterator.java.">AttributedCharacterIterator</a> <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>, <a href="../S/2376.html#L66" title="Defined at 66 in src/java/awt/font/FontRenderContext.java.">FontRenderContext</a> frc) <em class="brace">{</em>
<a id="L166" name="L166"></a> 166 
<a id="L167" name="L167"></a> 167         fFrc = frc;
<a id="L168" name="L168"></a> 168         <a href="../S/2365.html#L195" title="Defined at 195 in src/java/awt/font/TextMeasurer.java.">initAll</a>(<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>);
<a id="L169" name="L169"></a> 169     <em class="brace">}</em>
<a id="L170" name="L170"></a> 170 
<a id="L171" name="L171"></a> 171     <strong class="reserved">protected</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../R/11555.html" title="Multiple referred from 1378 places.">clone</a>() <em class="brace">{</em>
<a id="L172" name="L172"></a> 172         <a href="../S/2365.html#L98" title="Defined at 98 in src/java/awt/font/TextMeasurer.java.">TextMeasurer</a> other;
<a id="L173" name="L173"></a> 173         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L174" name="L174"></a> 174             other = (<a href="../S/2365.html#L98" title="Defined at 98 in src/java/awt/font/TextMeasurer.java.">TextMeasurer</a>) <strong class="reserved">super</strong>.<a href="../D/12888.html" title="Multiple defined in 229 places.">clone</a>();
<a id="L175" name="L175"></a> 175         <em class="brace">}</em>
<a id="L176" name="L176"></a> 176         <strong class="reserved">catch</strong>(<a href="../S/1725.html#L45" title="Defined at 45 in src/java/lang/CloneNotSupportedException.java.">CloneNotSupportedException</a> e) <em class="brace">{</em>
<a id="L177" name="L177"></a> 177             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>();
<a id="L178" name="L178"></a> 178         <em class="brace">}</em>
<a id="L179" name="L179"></a> 179         <strong class="reserved">if</strong> (fComponents != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L180" name="L180"></a> 180             other.fComponents = fComponents.<a href="../D/12888.html" title="Multiple defined in 229 places.">clone</a>();
<a id="L181" name="L181"></a> 181         <em class="brace">}</em>
<a id="L182" name="L182"></a> 182         <strong class="reserved">return</strong> other;
<a id="L183" name="L183"></a> 183     <em class="brace">}</em>
<a id="L184" name="L184"></a> 184 
<a id="L185" name="L185"></a> 185     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/21031.html" title="Multiple referred from 3 places.">invalidateComponents</a>() <em class="brace">{</em>
<a id="L186" name="L186"></a> 186         fComponentStart = fComponentLimit = fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L187" name="L187"></a> 187         fComponents = <strong class="reserved">null</strong>;
<a id="L188" name="L188"></a> 188         haveLayoutWindow = <strong class="reserved">false</strong>;
<a id="L189" name="L189"></a> 189     <em class="brace">}</em>
<a id="L190" name="L190"></a> 190 
<div class="comment">
      Initialize state, including fChars array, direction, and
      fBidi.</div>
<a id="L195" name="L195"></a> 195     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/20539.html" title="Multiple referred from 3 places.">initAll</a>(<a href="../S/2454.html#L79" title="Defined at 79 in src/java/text/AttributedCharacterIterator.java.">AttributedCharacterIterator</a> <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>) <em class="brace">{</em>
<a id="L196" name="L196"></a> 196 
<a id="L197" name="L197"></a> 197         fStart = <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/17233.html" title="Multiple defined in 6 places.">getBeginIndex</a>();
<a id="L198" name="L198"></a> 198 
<a id="L199" name="L199"></a> 199         <em class="comment">// extract chars</em>
<a id="L200" name="L200"></a> 200         fChars = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/18768.html" title="Multiple defined in 8 places.">getEndIndex</a>() - fStart];
<a id="L201" name="L201"></a> 201 
<a id="L202" name="L202"></a> 202         <strong class="reserved">int</strong> n = 0;
<a id="L203" name="L203"></a> 203         <strong class="reserved">for</strong> (<strong class="reserved">char</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>();
<a id="L204" name="L204"></a> 204              <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> != <a href="../D/1412.html" title="Multiple defined in 2 places.">CharacterIterator</a>.DONE;
<a id="L205" name="L205"></a> 205              <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>())
<a id="L206" name="L206"></a> 206         <em class="brace">{</em>
<a id="L207" name="L207"></a> 207             fChars[n++] = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L208" name="L208"></a> 208         <em class="brace">}</em>
<a id="L209" name="L209"></a> 209 
<a id="L210" name="L210"></a> 210         <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>();
<a id="L211" name="L211"></a> 211 
<a id="L212" name="L212"></a> 212         fBidi = <strong class="reserved">new</strong> <a href="../S/2485.html#L61" title="Defined at 61 in src/java/text/Bidi.java.">Bidi</a>(<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>);
<a id="L213" name="L213"></a> 213         <strong class="reserved">if</strong> (fBidi.<a href="../D/25785.html" title="Multiple defined in 18 places.">isLeftToRight</a>()) <em class="brace">{</em>
<a id="L214" name="L214"></a> 214             fBidi = <strong class="reserved">null</strong>;
<a id="L215" name="L215"></a> 215         <em class="brace">}</em>
<a id="L216" name="L216"></a> 216 
<a id="L217" name="L217"></a> 217         <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>();
<a id="L218" name="L218"></a> 218         <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>&lt;? <strong class="reserved">extends</strong> <a href="../D/567.html" title="Multiple defined in 12 places.">Attribute</a>, ?&gt; paragraphAttrs = <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/17112.html" title="Multiple defined in 109 places.">getAttributes</a>();
<a id="L219" name="L219"></a> 219         <a href="../S/2370.html#L136" title="Defined at 136 in src/java/awt/font/NumericShaper.java.">NumericShaper</a> shaper = AttributeValues.getNumericShaping(paragraphAttrs);
<a id="L220" name="L220"></a> 220         <strong class="reserved">if</strong> (shaper != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L221" name="L221"></a> 221             shaper.<a href="../D/34433.html" title="Multiple defined in 3 places.">shape</a>(fChars, 0, fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L222" name="L222"></a> 222         <em class="brace">}</em>
<a id="L223" name="L223"></a> 223 
<a id="L224" name="L224"></a> 224         fParagraph = <strong class="reserved">new</strong> <a href="../S/2372.html#L52" title="Defined at 52 in src/java/awt/font/StyledParagraph.java.">StyledParagraph</a>(<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>, fChars);
<a id="L225" name="L225"></a> 225 
<a id="L226" name="L226"></a> 226         <em class="comment">// set paragraph attributes</em>
<a id="L227" name="L227"></a> 227         <em class="brace">{</em>
<a id="L228" name="L228"></a> 228             <em class="comment">// If there's an embedded graphic at the start of the</em>
<a id="L229" name="L229"></a> 229             <em class="comment">// paragraph, look for the first non-graphic character</em>
<a id="L230" name="L230"></a> 230             <em class="comment">// and use it and its font to initialize the paragraph.</em>
<a id="L231" name="L231"></a> 231             <em class="comment">// If not, use the first graphic to initialize.</em>
<a id="L232" name="L232"></a> 232             fJustifyRatio = AttributeValues.<a href="../S/2704.html#L668" title="Defined at 668 in src/javax/swing/border/TitledBorder.java.">getJustification</a>(paragraphAttrs);
<a id="L233" name="L233"></a> 233 
<a id="L234" name="L234"></a> 234             <strong class="reserved">boolean</strong> haveFont = <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a>.<a href="../S/2362.html#L1253" title="Defined at 1253 in src/java/awt/font/TextLine.java.">advanceToFirstFont</a>(<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>);
<a id="L235" name="L235"></a> 235 
<a id="L236" name="L236"></a> 236             <strong class="reserved">if</strong> (haveFont) <em class="brace">{</em>
<a id="L237" name="L237"></a> 237                 <a href="../S/2176.html#L224" title="Defined at 224 in src/java/awt/Font.java.">Font</a> defaultFont = <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a>.<a href="../S/2362.html#L1280" title="Defined at 1280 in src/java/awt/font/TextLine.java.">getFontAtCurrentPos</a>(<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>);
<a id="L238" name="L238"></a> 238                 <strong class="reserved">int</strong> charsStart = <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/19664.html" title="Multiple defined in 76 places.">getIndex</a>() - <a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>.<a href="../D/17233.html" title="Multiple defined in 6 places.">getBeginIndex</a>();
<a id="L239" name="L239"></a> 239                 <a href="../S/2373.html#L44" title="Defined at 44 in src/java/awt/font/LineMetrics.java.">LineMetrics</a> lm = defaultFont.<a href="../D/20121.html" title="Multiple defined in 8 places.">getLineMetrics</a>(fChars, charsStart, charsStart+1, fFrc);
<a id="L240" name="L240"></a> 240                 fBaseline = (<strong class="reserved">byte</strong>) lm.<a href="../S/2373.html#L102" title="Defined at 102 in src/java/awt/font/LineMetrics.java.">getBaselineIndex</a>();
<a id="L241" name="L241"></a> 241                 fBaselineOffsets = lm.<a href="../D/17213.html" title="Multiple defined in 2 places.">getBaselineOffsets</a>();
<a id="L242" name="L242"></a> 242             <em class="brace">}</em>
<a id="L243" name="L243"></a> 243             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L244" name="L244"></a> 244                 <em class="comment">// hmmm what to do here?  Just try to supply reasonable</em>
<a id="L245" name="L245"></a> 245                 <em class="comment">// values I guess.</em>
<a id="L246" name="L246"></a> 246 
<a id="L247" name="L247"></a> 247                 <a href="../S/2369.html#L64" title="Defined at 64 in src/java/awt/font/GraphicAttribute.java.">GraphicAttribute</a> graphic = (<a href="../S/2369.html#L64" title="Defined at 64 in src/java/awt/font/GraphicAttribute.java.">GraphicAttribute</a>)
<a id="L248" name="L248"></a> 248                                 paragraphAttrs.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(<a href="../S/2367.html#L255" title="Defined at 255 in src/java/awt/font/TextAttribute.java.">TextAttribute</a>.CHAR_REPLACEMENT);
<a id="L249" name="L249"></a> 249                 fBaseline = <a href="../S/2375.html#L239" title="Defined at 239 in src/java/awt/font/TextLayout.java.">TextLayout</a>.<a href="../S/2375.html#L2677" title="Defined at 2677 in src/java/awt/font/TextLayout.java.">getBaselineFromGraphic</a>(graphic);
<a id="L250" name="L250"></a> 250                 <a href="../D/3743.html" title="Multiple defined in 2 places.">Hashtable</a>&lt;<a href="../D/567.html" title="Multiple defined in 12 places.">Attribute</a>, ?&gt; fmap = <strong class="reserved">new</strong> <a href="../D/3743.html" title="Multiple defined in 2 places.">Hashtable</a>&lt;&gt;(5, (<strong class="reserved">float</strong>)0.9);
<a id="L251" name="L251"></a> 251                 <a href="../S/2176.html#L224" title="Defined at 224 in src/java/awt/Font.java.">Font</a> dummyFont = <strong class="reserved">new</strong> <a href="../S/2176.html#L224" title="Defined at 224 in src/java/awt/Font.java.">Font</a>(fmap);
<a id="L252" name="L252"></a> 252                 <a href="../S/2373.html#L44" title="Defined at 44 in src/java/awt/font/LineMetrics.java.">LineMetrics</a> lm = dummyFont.<a href="../D/20121.html" title="Multiple defined in 8 places.">getLineMetrics</a>(" ", 0, 1, fFrc);
<a id="L253" name="L253"></a> 253                 fBaselineOffsets = lm.<a href="../D/17213.html" title="Multiple defined in 2 places.">getBaselineOffsets</a>();
<a id="L254" name="L254"></a> 254             <em class="brace">}</em>
<a id="L255" name="L255"></a> 255             fBaselineOffsets = <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a>.<a href="../S/2362.html#L1268" title="Defined at 1268 in src/java/awt/font/TextLine.java.">getNormalizedOffsets</a>(fBaselineOffsets, fBaseline);
<a id="L256" name="L256"></a> 256         <em class="brace">}</em>
<a id="L257" name="L257"></a> 257 
<a id="L258" name="L258"></a> 258         <a href="../S/2365.html#L185" title="Defined at 185 in src/java/awt/font/TextMeasurer.java.">invalidateComponents</a>();
<a id="L259" name="L259"></a> 259     <em class="brace">}</em>
<a id="L260" name="L260"></a> 260 
<div class="comment">
      Generate components for the paragraph.  fChars, fBidi should have been
      initialized already.</div>
<a id="L265" name="L265"></a> 265     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/14843.html" title="Multiple referred from 2 places.">generateComponents</a>(<strong class="reserved">int</strong> startingAt, <strong class="reserved">int</strong> endingAt) <em class="brace">{</em>
<a id="L266" name="L266"></a> 266 
<a id="L267" name="L267"></a> 267         <strong class="reserved">if</strong> (collectStats) <em class="brace">{</em>
<a id="L268" name="L268"></a> 268             formattedChars += (endingAt-startingAt);
<a id="L269" name="L269"></a> 269         <em class="brace">}</em>
<a id="L270" name="L270"></a> 270         <strong class="reserved">int</strong> layoutFlags = 0; <em class="comment">// no extra info yet, bidi determines run and line direction</em>
<a id="L271" name="L271"></a> 271         TextLabelFactory <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a> = <strong class="reserved">new</strong> TextLabelFactory(fFrc, fChars, fBidi, layoutFlags);
<a id="L272" name="L272"></a> 272 
<a id="L273" name="L273"></a> 273         <strong class="reserved">int</strong>[] charsLtoV = <strong class="reserved">null</strong>;
<a id="L274" name="L274"></a> 274 
<a id="L275" name="L275"></a> 275         <strong class="reserved">if</strong> (fBidi != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L276" name="L276"></a> 276             fLevels = BidiUtils.getLevels(fBidi);
<a id="L277" name="L277"></a> 277             <strong class="reserved">int</strong>[] charsVtoL = BidiUtils.createVisualToLogicalMap(fLevels);
<a id="L278" name="L278"></a> 278             charsLtoV = BidiUtils.createInverseMap(charsVtoL);
<a id="L279" name="L279"></a> 279             fIsDirectionLTR = fBidi.<a href="../S/2485.html#L230" title="Defined at 230 in src/java/text/Bidi.java.">baseIsLeftToRight</a>();
<a id="L280" name="L280"></a> 280         <em class="brace">}</em>
<a id="L281" name="L281"></a> 281         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L282" name="L282"></a> 282             fLevels = <strong class="reserved">null</strong>;
<a id="L283" name="L283"></a> 283             fIsDirectionLTR = <strong class="reserved">true</strong>;
<a id="L284" name="L284"></a> 284         <em class="brace">}</em>
<a id="L285" name="L285"></a> 285 
<a id="L286" name="L286"></a> 286         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L287" name="L287"></a> 287             fComponents = <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a>.<a href="../D/17883.html" title="Multiple defined in 18 places.">getComponents</a>(
<a id="L288" name="L288"></a> 288                 fParagraph, fChars, startingAt, endingAt, charsLtoV, fLevels, <a href="../D/15962.html" title="Multiple defined in 2 places.">factory</a>);
<a id="L289" name="L289"></a> 289         <em class="brace">}</em>
<a id="L290" name="L290"></a> 290         <strong class="reserved">catch</strong>(<a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a> e) <em class="brace">{</em>
<a id="L291" name="L291"></a> 291             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("startingAt="+startingAt+"; endingAt="+endingAt);
<a id="L292" name="L292"></a> 292             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("fComponentLimit="+fComponentLimit);
<a id="L293" name="L293"></a> 293             <strong class="reserved">throw</strong> e;
<a id="L294" name="L294"></a> 294         <em class="brace">}</em>
<a id="L295" name="L295"></a> 295 
<a id="L296" name="L296"></a> 296         fComponentStart = startingAt;
<a id="L297" name="L297"></a> 297         fComponentLimit = endingAt;
<a id="L298" name="L298"></a> 298         <em class="comment">//debugFormatCount += (endingAt-startingAt);</em>
<a id="L299" name="L299"></a> 299     <em class="brace">}</em>
<a id="L300" name="L300"></a> 300 
<a id="L301" name="L301"></a> 301     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/10775.html" title="Multiple referred from 2 places.">calcLineBreak</a>(<strong class="reserved">final</strong> <strong class="reserved">int</strong> pos, <strong class="reserved">final</strong> <strong class="reserved">float</strong> maxAdvance) <em class="brace">{</em>
<a id="L302" name="L302"></a> 302 
<a id="L303" name="L303"></a> 303         <em class="comment">// either of these statements removes the bug:</em>
<a id="L304" name="L304"></a> 304         <em class="comment">//generateComponents(0, fChars.length);</em>
<a id="L305" name="L305"></a> 305         <em class="comment">//generateComponents(pos, fChars.length);</em>
<a id="L306" name="L306"></a> 306 
<a id="L307" name="L307"></a> 307         <strong class="reserved">int</strong> startPos = pos;
<a id="L308" name="L308"></a> 308         <strong class="reserved">float</strong> <a href="../D/36863.html" title="Multiple defined in 3 places.">width</a> = maxAdvance;
<a id="L309" name="L309"></a> 309 
<a id="L310" name="L310"></a> 310         <strong class="reserved">int</strong> tlcIndex;
<a id="L311" name="L311"></a> 311         <strong class="reserved">int</strong> tlcStart = fComponentStart;
<a id="L312" name="L312"></a> 312 
<a id="L313" name="L313"></a> 313         <strong class="reserved">for</strong> (tlcIndex = 0; tlcIndex &lt; fComponents.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; tlcIndex++) <em class="brace">{</em>
<a id="L314" name="L314"></a> 314             <strong class="reserved">int</strong> gaLimit = tlcStart + fComponents[tlcIndex].getNumCharacters();
<a id="L315" name="L315"></a> 315             <strong class="reserved">if</strong> (gaLimit &gt; startPos) <em class="brace">{</em>
<a id="L316" name="L316"></a> 316                 <strong class="reserved">break</strong>;
<a id="L317" name="L317"></a> 317             <em class="brace">}</em>
<a id="L318" name="L318"></a> 318             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L319" name="L319"></a> 319                 tlcStart = gaLimit;
<a id="L320" name="L320"></a> 320             <em class="brace">}</em>
<a id="L321" name="L321"></a> 321         <em class="brace">}</em>
<a id="L322" name="L322"></a> 322 
<a id="L323" name="L323"></a> 323         <em class="comment">// tlcStart is now the start of the tlc at tlcIndex</em>
<a id="L324" name="L324"></a> 324 
<a id="L325" name="L325"></a> 325         <strong class="reserved">for</strong> (; tlcIndex &lt; fComponents.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; tlcIndex++) <em class="brace">{</em>
<a id="L326" name="L326"></a> 326 
<a id="L327" name="L327"></a> 327             TextLineComponent tlc = fComponents[tlcIndex];
<a id="L328" name="L328"></a> 328             <strong class="reserved">int</strong> numCharsInGa = tlc.getNumCharacters();
<a id="L329" name="L329"></a> 329 
<a id="L330" name="L330"></a> 330             <strong class="reserved">int</strong> lineBreak = tlc.<a href="../S/2365.html#L556" title="Defined at 556 in src/java/awt/font/TextMeasurer.java.">getLineBreakIndex</a>(startPos - tlcStart, <a href="../D/36863.html" title="Multiple defined in 3 places.">width</a>);
<a id="L331" name="L331"></a> 331             <strong class="reserved">if</strong> (lineBreak == numCharsInGa &amp;&amp; tlcIndex &lt; fComponents.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L332" name="L332"></a> 332                 <a href="../D/36863.html" title="Multiple defined in 3 places.">width</a> -= tlc.<a href="../D/16841.html" title="Multiple defined in 2 places.">getAdvanceBetween</a>(startPos - tlcStart, lineBreak);
<a id="L333" name="L333"></a> 333                 tlcStart += numCharsInGa;
<a id="L334" name="L334"></a> 334                 startPos = tlcStart;
<a id="L335" name="L335"></a> 335             <em class="brace">}</em>
<a id="L336" name="L336"></a> 336             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L337" name="L337"></a> 337                 <strong class="reserved">return</strong> tlcStart + lineBreak;
<a id="L338" name="L338"></a> 338             <em class="brace">}</em>
<a id="L339" name="L339"></a> 339         <em class="brace">}</em>
<a id="L340" name="L340"></a> 340 
<a id="L341" name="L341"></a> 341         <strong class="reserved">if</strong> (fComponentLimit &lt; fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L342" name="L342"></a> 342             <em class="comment">// format more text and try again</em>
<a id="L343" name="L343"></a> 343             <em class="comment">//if (haveLayoutWindow) {</em>
<a id="L344" name="L344"></a> 344             <em class="comment">//    outOfWindow++;</em>
<a id="L345" name="L345"></a> 345             <em class="comment">//}</em>
<a id="L346" name="L346"></a> 346 
<a id="L347" name="L347"></a> 347             <a href="../S/2365.html#L265" title="Defined at 265 in src/java/awt/font/TextMeasurer.java.">generateComponents</a>(pos, fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L348" name="L348"></a> 348             <strong class="reserved">return</strong> <a href="../S/2365.html#L301" title="Defined at 301 in src/java/awt/font/TextMeasurer.java.">calcLineBreak</a>(pos, maxAdvance);
<a id="L349" name="L349"></a> 349         <em class="brace">}</em>
<a id="L350" name="L350"></a> 350 
<a id="L351" name="L351"></a> 351         <strong class="reserved">return</strong> fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L352" name="L352"></a> 352     <em class="brace">}</em>
<a id="L353" name="L353"></a> 353 
<div class="comment">
      According to the Unicode Bidirectional Behavior specification
      (Unicode Standard 2.0, section 3.11), whitespace at the ends
      of lines which would naturally flow against the base direction
      must be made to flow with the line direction, and moved to the
      end of the line.  This method returns the start of the sequence
      of trailing whitespace characters to move to the end of a
      line taken from the given range.</div>
<a id="L363" name="L363"></a> 363     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/2365.html#L386" title="Referred from 386 in src/java/awt/font/TextMeasurer.java.">trailingCdWhitespaceStart</a>(<strong class="reserved">int</strong> startPos, <strong class="reserved">int</strong> limitPos) <em class="brace">{</em>
<a id="L364" name="L364"></a> 364 
<a id="L365" name="L365"></a> 365         <strong class="reserved">if</strong> (fLevels != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L366" name="L366"></a> 366             <em class="comment">// Back up over counterdirectional whitespace</em>
<a id="L367" name="L367"></a> 367             <strong class="reserved">final</strong> <strong class="reserved">byte</strong> baseLevel = (<strong class="reserved">byte</strong>) (fIsDirectionLTR? 0 : 1);
<a id="L368" name="L368"></a> 368             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> cdWsStart = limitPos; --cdWsStart &gt;= startPos;) <em class="brace">{</em>
<a id="L369" name="L369"></a> 369                 <strong class="reserved">if</strong> ((fLevels[cdWsStart] % 2) == baseLevel ||
<a id="L370" name="L370"></a> 370                         <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.<a href="../D/18496.html" title="Multiple defined in 10 places.">getDirectionality</a>(fChars[cdWsStart]) != <a href="../S/1732.html#L123" title="Defined at 123 in src/java/lang/Character.java.">Character</a>.DIRECTIONALITY_WHITESPACE) <em class="brace">{</em>
<a id="L371" name="L371"></a> 371                     <strong class="reserved">return</strong> ++cdWsStart;
<a id="L372" name="L372"></a> 372                 <em class="brace">}</em>
<a id="L373" name="L373"></a> 373             <em class="brace">}</em>
<a id="L374" name="L374"></a> 374         <em class="brace">}</em>
<a id="L375" name="L375"></a> 375 
<a id="L376" name="L376"></a> 376         <strong class="reserved">return</strong> startPos;
<a id="L377" name="L377"></a> 377     <em class="brace">}</em>
<a id="L378" name="L378"></a> 378 
<a id="L379" name="L379"></a> 379     <strong class="reserved">private</strong> TextLineComponent[] <a href="../S/2365.html#L482" title="Referred from 482 in src/java/awt/font/TextMeasurer.java.">makeComponentsOnRange</a>(<strong class="reserved">int</strong> startPos,
<a id="L380" name="L380"></a> 380                                                       <strong class="reserved">int</strong> limitPos) <em class="brace">{</em>
<a id="L381" name="L381"></a> 381 
<a id="L382" name="L382"></a> 382         <em class="comment">// sigh I really hate to do this here since it's part of the</em>
<a id="L383" name="L383"></a> 383         <em class="comment">// bidi algorithm.</em>
<a id="L384" name="L384"></a> 384         <em class="comment">// cdWsStart is the start of the trailing counterdirectional</em>
<a id="L385" name="L385"></a> 385         <em class="comment">// whitespace</em>
<a id="L386" name="L386"></a> 386         <strong class="reserved">final</strong> <strong class="reserved">int</strong> cdWsStart = <a href="../S/2365.html#L363" title="Defined at 363 in src/java/awt/font/TextMeasurer.java.">trailingCdWhitespaceStart</a>(startPos, limitPos);
<a id="L387" name="L387"></a> 387 
<a id="L388" name="L388"></a> 388         <strong class="reserved">int</strong> tlcIndex;
<a id="L389" name="L389"></a> 389         <strong class="reserved">int</strong> tlcStart = fComponentStart;
<a id="L390" name="L390"></a> 390 
<a id="L391" name="L391"></a> 391         <strong class="reserved">for</strong> (tlcIndex = 0; tlcIndex &lt; fComponents.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; tlcIndex++) <em class="brace">{</em>
<a id="L392" name="L392"></a> 392             <strong class="reserved">int</strong> gaLimit = tlcStart + fComponents[tlcIndex].getNumCharacters();
<a id="L393" name="L393"></a> 393             <strong class="reserved">if</strong> (gaLimit &gt; startPos) <em class="brace">{</em>
<a id="L394" name="L394"></a> 394                 <strong class="reserved">break</strong>;
<a id="L395" name="L395"></a> 395             <em class="brace">}</em>
<a id="L396" name="L396"></a> 396             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L397" name="L397"></a> 397                 tlcStart = gaLimit;
<a id="L398" name="L398"></a> 398             <em class="brace">}</em>
<a id="L399" name="L399"></a> 399         <em class="brace">}</em>
<a id="L400" name="L400"></a> 400 
<a id="L401" name="L401"></a> 401         <em class="comment">// tlcStart is now the start of the tlc at tlcIndex</em>
<a id="L402" name="L402"></a> 402 
<a id="L403" name="L403"></a> 403         <strong class="reserved">int</strong> componentCount;
<a id="L404" name="L404"></a> 404         <em class="brace">{</em>
<a id="L405" name="L405"></a> 405             <strong class="reserved">boolean</strong> <a href="../D/34718.html" title="Multiple defined in 12 places.">split</a> = <strong class="reserved">false</strong>;
<a id="L406" name="L406"></a> 406             <strong class="reserved">int</strong> compStart = tlcStart;
<a id="L407" name="L407"></a> 407             <strong class="reserved">int</strong> lim=tlcIndex;
<a id="L408" name="L408"></a> 408             <strong class="reserved">for</strong> (<strong class="reserved">boolean</strong> cont=<strong class="reserved">true</strong>; cont; lim++) <em class="brace">{</em>
<a id="L409" name="L409"></a> 409                 <strong class="reserved">int</strong> gaLimit = compStart + fComponents[lim].getNumCharacters();
<a id="L410" name="L410"></a> 410                 <strong class="reserved">if</strong> (cdWsStart &gt; <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27569.html" title="Multiple defined in 28 places.">max</a>(compStart, startPos)
<a id="L411" name="L411"></a> 411                             &amp;&amp; cdWsStart &lt; <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27697.html" title="Multiple defined in 28 places.">min</a>(gaLimit, limitPos)) <em class="brace">{</em>
<a id="L412" name="L412"></a> 412                     <a href="../D/34718.html" title="Multiple defined in 12 places.">split</a> = <strong class="reserved">true</strong>;
<a id="L413" name="L413"></a> 413                 <em class="brace">}</em>
<a id="L414" name="L414"></a> 414                 <strong class="reserved">if</strong> (gaLimit &gt;= limitPos) <em class="brace">{</em>
<a id="L415" name="L415"></a> 415                     cont=<strong class="reserved">false</strong>;
<a id="L416" name="L416"></a> 416                 <em class="brace">}</em>
<a id="L417" name="L417"></a> 417                 <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L418" name="L418"></a> 418                     compStart = gaLimit;
<a id="L419" name="L419"></a> 419                 <em class="brace">}</em>
<a id="L420" name="L420"></a> 420             <em class="brace">}</em>
<a id="L421" name="L421"></a> 421             componentCount = lim-tlcIndex;
<a id="L422" name="L422"></a> 422             <strong class="reserved">if</strong> (<a href="../D/34718.html" title="Multiple defined in 12 places.">split</a>) <em class="brace">{</em>
<a id="L423" name="L423"></a> 423                 componentCount++;
<a id="L424" name="L424"></a> 424             <em class="brace">}</em>
<a id="L425" name="L425"></a> 425         <em class="brace">}</em>
<a id="L426" name="L426"></a> 426 
<a id="L427" name="L427"></a> 427         TextLineComponent[] components = <strong class="reserved">new</strong> TextLineComponent[componentCount];
<a id="L428" name="L428"></a> 428         <strong class="reserved">int</strong> newCompIndex = 0;
<a id="L429" name="L429"></a> 429         <strong class="reserved">int</strong> linePos = startPos;
<a id="L430" name="L430"></a> 430 
<a id="L431" name="L431"></a> 431         <strong class="reserved">int</strong> breakPt = cdWsStart;
<a id="L432" name="L432"></a> 432 
<a id="L433" name="L433"></a> 433         <strong class="reserved">int</strong> subsetFlag;
<a id="L434" name="L434"></a> 434         <strong class="reserved">if</strong> (breakPt == startPos) <em class="brace">{</em>
<a id="L435" name="L435"></a> 435             subsetFlag = fIsDirectionLTR? TextLineComponent.LEFT_TO_RIGHT :
<a id="L436" name="L436"></a> 436                                           TextLineComponent.RIGHT_TO_LEFT;
<a id="L437" name="L437"></a> 437             breakPt = limitPos;
<a id="L438" name="L438"></a> 438         <em class="brace">}</em>
<a id="L439" name="L439"></a> 439         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L440" name="L440"></a> 440             subsetFlag = TextLineComponent.UNCHANGED;
<a id="L441" name="L441"></a> 441         <em class="brace">}</em>
<a id="L442" name="L442"></a> 442 
<a id="L443" name="L443"></a> 443         <strong class="reserved">while</strong> (linePos &lt; limitPos) <em class="brace">{</em>
<a id="L444" name="L444"></a> 444 
<a id="L445" name="L445"></a> 445             <strong class="reserved">int</strong> compLength = fComponents[tlcIndex].getNumCharacters();
<a id="L446" name="L446"></a> 446             <strong class="reserved">int</strong> tlcLimit = tlcStart + compLength;
<a id="L447" name="L447"></a> 447 
<a id="L448" name="L448"></a> 448             <strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> = <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27569.html" title="Multiple defined in 28 places.">max</a>(linePos, tlcStart);
<a id="L449" name="L449"></a> 449             <strong class="reserved">int</strong> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> = <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27697.html" title="Multiple defined in 28 places.">min</a>(breakPt, tlcLimit);
<a id="L450" name="L450"></a> 450 
<a id="L451" name="L451"></a> 451             components[newCompIndex++] = fComponents[tlcIndex].getSubset(
<a id="L452" name="L452"></a> 452                                                                 <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>-tlcStart,
<a id="L453" name="L453"></a> 453                                                                 <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>-tlcStart,
<a id="L454" name="L454"></a> 454                                                                 subsetFlag);
<a id="L455" name="L455"></a> 455             linePos += (<a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>-<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>);
<a id="L456" name="L456"></a> 456             <strong class="reserved">if</strong> (linePos == breakPt) <em class="brace">{</em>
<a id="L457" name="L457"></a> 457                 breakPt = limitPos;
<a id="L458" name="L458"></a> 458                 subsetFlag = fIsDirectionLTR? TextLineComponent.LEFT_TO_RIGHT :
<a id="L459" name="L459"></a> 459                                               TextLineComponent.RIGHT_TO_LEFT;
<a id="L460" name="L460"></a> 460             <em class="brace">}</em>
<a id="L461" name="L461"></a> 461             <strong class="reserved">if</strong> (linePos == tlcLimit) <em class="brace">{</em>
<a id="L462" name="L462"></a> 462                 tlcIndex++;
<a id="L463" name="L463"></a> 463                 tlcStart = tlcLimit;
<a id="L464" name="L464"></a> 464             <em class="brace">}</em>
<a id="L465" name="L465"></a> 465         <em class="brace">}</em>
<a id="L466" name="L466"></a> 466 
<a id="L467" name="L467"></a> 467         <strong class="reserved">return</strong> components;
<a id="L468" name="L468"></a> 468     <em class="brace">}</em>
<a id="L469" name="L469"></a> 469 
<a id="L470" name="L470"></a> 470     <strong class="reserved">private</strong> <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a> <a href="../R/23018.html" title="Multiple referred from 2 places.">makeTextLineOnRange</a>(<strong class="reserved">int</strong> startPos, <strong class="reserved">int</strong> limitPos) <em class="brace">{</em>
<a id="L471" name="L471"></a> 471 
<a id="L472" name="L472"></a> 472         <strong class="reserved">int</strong>[] charsLtoV = <strong class="reserved">null</strong>;
<a id="L473" name="L473"></a> 473         <strong class="reserved">byte</strong>[] charLevels = <strong class="reserved">null</strong>;
<a id="L474" name="L474"></a> 474 
<a id="L475" name="L475"></a> 475         <strong class="reserved">if</strong> (fBidi != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L476" name="L476"></a> 476             <a href="../S/2485.html#L61" title="Defined at 61 in src/java/text/Bidi.java.">Bidi</a> lineBidi = fBidi.<a href="../S/2485.html#L184" title="Defined at 184 in src/java/text/Bidi.java.">createLineBidi</a>(startPos, limitPos);
<a id="L477" name="L477"></a> 477             charLevels = BidiUtils.getLevels(lineBidi);
<a id="L478" name="L478"></a> 478             <strong class="reserved">int</strong>[] charsVtoL = BidiUtils.createVisualToLogicalMap(charLevels);
<a id="L479" name="L479"></a> 479             charsLtoV = BidiUtils.createInverseMap(charsVtoL);
<a id="L480" name="L480"></a> 480         <em class="brace">}</em>
<a id="L481" name="L481"></a> 481 
<a id="L482" name="L482"></a> 482         TextLineComponent[] components = <a href="../S/2365.html#L379" title="Defined at 379 in src/java/awt/font/TextMeasurer.java.">makeComponentsOnRange</a>(startPos, limitPos);
<a id="L483" name="L483"></a> 483 
<a id="L484" name="L484"></a> 484         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a>(fFrc,
<a id="L485" name="L485"></a> 485                             components,
<a id="L486" name="L486"></a> 486                             fBaselineOffsets,
<a id="L487" name="L487"></a> 487                             fChars,
<a id="L488" name="L488"></a> 488                             startPos,
<a id="L489" name="L489"></a> 489                             limitPos,
<a id="L490" name="L490"></a> 490                             charsLtoV,
<a id="L491" name="L491"></a> 491                             charLevels,
<a id="L492" name="L492"></a> 492                             fIsDirectionLTR);
<a id="L493" name="L493"></a> 493 
<a id="L494" name="L494"></a> 494     <em class="brace">}</em>
<a id="L495" name="L495"></a> 495 
<a id="L496" name="L496"></a> 496     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13911.html" title="Multiple referred from 3 places.">ensureComponents</a>(<strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>) <em class="brace">{</em>
<a id="L497" name="L497"></a> 497 
<a id="L498" name="L498"></a> 498         <strong class="reserved">if</strong> (<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> &lt; fComponentStart || <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> &gt; fComponentLimit) <em class="brace">{</em>
<a id="L499" name="L499"></a> 499             <a href="../S/2365.html#L265" title="Defined at 265 in src/java/awt/font/TextMeasurer.java.">generateComponents</a>(<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>);
<a id="L500" name="L500"></a> 500         <em class="brace">}</em>
<a id="L501" name="L501"></a> 501     <em class="brace">}</em>
<a id="L502" name="L502"></a> 502 
<a id="L503" name="L503"></a> 503     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2365.html#L563" title="Referred from 563 in src/java/awt/font/TextMeasurer.java.">makeLayoutWindow</a>(<strong class="reserved">int</strong> localStart) <em class="brace">{</em>
<a id="L504" name="L504"></a> 504 
<a id="L505" name="L505"></a> 505         <strong class="reserved">int</strong> compStart = localStart;
<a id="L506" name="L506"></a> 506         <strong class="reserved">int</strong> compLimit = fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L507" name="L507"></a> 507 
<a id="L508" name="L508"></a> 508         <em class="comment">// If we've already gone past the layout window, format to end of paragraph</em>
<a id="L509" name="L509"></a> 509         <strong class="reserved">if</strong> (layoutCount &gt; 0 &amp;&amp; !haveLayoutWindow) <em class="brace">{</em>
<a id="L510" name="L510"></a> 510             <strong class="reserved">float</strong> avgLineLength = <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27569.html" title="Multiple defined in 28 places.">max</a>(layoutCharCount / layoutCount, 1);
<a id="L511" name="L511"></a> 511             compLimit = <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27697.html" title="Multiple defined in 28 places.">min</a>(localStart + (<strong class="reserved">int</strong>)(avgLineLength*EST_LINES), fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L512" name="L512"></a> 512         <em class="brace">}</em>
<a id="L513" name="L513"></a> 513 
<a id="L514" name="L514"></a> 514         <strong class="reserved">if</strong> (localStart &gt; 0 || compLimit &lt; fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L515" name="L515"></a> 515             <strong class="reserved">if</strong> (charIter == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L516" name="L516"></a> 516                 charIter = <strong class="reserved">new</strong> <a href="../S/2360.html#L30" title="Defined at 30 in src/java/awt/font/CharArrayIterator.java.">CharArrayIterator</a>(fChars);
<a id="L517" name="L517"></a> 517             <em class="brace">}</em>
<a id="L518" name="L518"></a> 518             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L519" name="L519"></a> 519                 charIter.<a href="../D/31151.html" title="Multiple defined in 296 places.">reset</a>(fChars);
<a id="L520" name="L520"></a> 520             <em class="brace">}</em>
<a id="L521" name="L521"></a> 521             <strong class="reserved">if</strong> (fLineBreak == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L522" name="L522"></a> 522                 fLineBreak = <a href="../S/2468.html#L228" title="Defined at 228 in src/java/text/BreakIterator.java.">BreakIterator</a>.<a href="../D/20117.html" title="Multiple defined in 3 places.">getLineInstance</a>();
<a id="L523" name="L523"></a> 523             <em class="brace">}</em>
<a id="L524" name="L524"></a> 524             fLineBreak.<a href="../D/34097.html" title="Multiple defined in 21 places.">setText</a>(charIter);
<a id="L525" name="L525"></a> 525             <strong class="reserved">if</strong> (localStart &gt; 0) <em class="brace">{</em>
<a id="L526" name="L526"></a> 526                 <strong class="reserved">if</strong> (!fLineBreak.<a href="../S/2468.html#L369" title="Defined at 369 in src/java/text/BreakIterator.java.">isBoundary</a>(localStart)) <em class="brace">{</em>
<a id="L527" name="L527"></a> 527                     compStart = fLineBreak.<a href="../D/29531.html" title="Multiple defined in 2 places.">preceding</a>(localStart);
<a id="L528" name="L528"></a> 528                 <em class="brace">}</em>
<a id="L529" name="L529"></a> 529             <em class="brace">}</em>
<a id="L530" name="L530"></a> 530             <strong class="reserved">if</strong> (compLimit &lt; fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L531" name="L531"></a> 531                 <strong class="reserved">if</strong> (!fLineBreak.<a href="../S/2468.html#L369" title="Defined at 369 in src/java/text/BreakIterator.java.">isBoundary</a>(compLimit)) <em class="brace">{</em>
<a id="L532" name="L532"></a> 532                     compLimit = fLineBreak.<a href="../D/16506.html" title="Multiple defined in 2 places.">following</a>(compLimit);
<a id="L533" name="L533"></a> 533                 <em class="brace">}</em>
<a id="L534" name="L534"></a> 534             <em class="brace">}</em>
<a id="L535" name="L535"></a> 535         <em class="brace">}</em>
<a id="L536" name="L536"></a> 536 
<a id="L537" name="L537"></a> 537         <a href="../S/2365.html#L496" title="Defined at 496 in src/java/awt/font/TextMeasurer.java.">ensureComponents</a>(compStart, compLimit);
<a id="L538" name="L538"></a> 538         haveLayoutWindow = <strong class="reserved">true</strong>;
<a id="L539" name="L539"></a> 539     <em class="brace">}</em>
<a id="L540" name="L540"></a> 540 
<div class="comment">
      Returns the index of the first character which will not fit on
      on a line beginning at <code>start</code> and possible
      measuring up to <code>maxAdvance</code> in graphical width.
      @param start the character index at which to start measuring.
       <code>start</code> is an absolute index, not relative to the
       start of the paragraph
      @param maxAdvance the graphical width in which the line must fit
      @return the index after the last character that will fit
       on a line beginning at <code>start</code>, which is not longer
       than <code>maxAdvance</code> in graphical width
      @throws IllegalArgumentException if <code>start</code> is
               less than the beginning of the paragraph.</div>
<a id="L556" name="L556"></a> 556     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/17358.html" title="Multiple referred from 2 places.">getLineBreakIndex</a>(<strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">float</strong> maxAdvance) <em class="brace">{</em>
<a id="L557" name="L557"></a> 557 
<a id="L558" name="L558"></a> 558         <strong class="reserved">int</strong> localStart = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> - fStart;
<a id="L559" name="L559"></a> 559 
<a id="L560" name="L560"></a> 560         <strong class="reserved">if</strong> (!haveLayoutWindow ||
<a id="L561" name="L561"></a> 561                 localStart &lt; fComponentStart ||
<a id="L562" name="L562"></a> 562                 localStart &gt;= fComponentLimit) <em class="brace">{</em>
<a id="L563" name="L563"></a> 563             <a href="../S/2365.html#L503" title="Defined at 503 in src/java/awt/font/TextMeasurer.java.">makeLayoutWindow</a>(localStart);
<a id="L564" name="L564"></a> 564         <em class="brace">}</em>
<a id="L565" name="L565"></a> 565 
<a id="L566" name="L566"></a> 566         <strong class="reserved">return</strong> <a href="../S/2365.html#L301" title="Defined at 301 in src/java/awt/font/TextMeasurer.java.">calcLineBreak</a>(localStart, maxAdvance) + fStart;
<a id="L567" name="L567"></a> 567     <em class="brace">}</em>
<a id="L568" name="L568"></a> 568 
<div class="comment">
      Returns the graphical width of a line beginning at <code>start</code>
      and including characters up to <code>limit</code>.
      <code>start</code> and <code>limit</code> are absolute indices,
      not relative to the start of the paragraph.
      @param start the character index at which to start measuring
      @param limit the character index at which to stop measuring
      @return the graphical width of a line beginning at <code>start</code>
        and including characters up to <code>limit</code>
      @throws IndexOutOfBoundsException if <code>limit</code> is less
              than <code>start</code>
      @throws IllegalArgumentException if <code>start</code> or
               <code>limit</code> is not between the beginning of
               the paragraph and the end of the paragraph.</div>
<a id="L585" name="L585"></a> 585     <strong class="reserved">public</strong> <strong class="reserved">float</strong> <a href="../R/14996.html" title="Multiple referred from 4 places.">getAdvanceBetween</a>(<strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>) <em class="brace">{</em>
<a id="L586" name="L586"></a> 586 
<a id="L587" name="L587"></a> 587         <strong class="reserved">int</strong> localStart = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> - fStart;
<a id="L588" name="L588"></a> 588         <strong class="reserved">int</strong> localLimit = <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> - fStart;
<a id="L589" name="L589"></a> 589 
<a id="L590" name="L590"></a> 590         <a href="../S/2365.html#L496" title="Defined at 496 in src/java/awt/font/TextMeasurer.java.">ensureComponents</a>(localStart, localLimit);
<a id="L591" name="L591"></a> 591         <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a> <a href="../S/7696.html#L44" title="Defined at 44 in src/com/sun/javadoc/SourcePosition.java.">line</a> = <a href="../S/2365.html#L470" title="Defined at 470 in src/java/awt/font/TextMeasurer.java.">makeTextLineOnRange</a>(localStart, localLimit);
<a id="L592" name="L592"></a> 592         <strong class="reserved">return</strong> <a href="../S/7696.html#L44" title="Defined at 44 in src/com/sun/javadoc/SourcePosition.java.">line</a>.<a href="../S/2362.html#L547" title="Defined at 547 in src/java/awt/font/TextLine.java.">getMetrics</a>().<a href="../D/11249.html" title="Multiple defined in 12 places.">advance</a>;
<a id="L593" name="L593"></a> 593         <em class="comment">// could cache line in case getLayout is called with same start, limit</em>
<a id="L594" name="L594"></a> 594     <em class="brace">}</em>
<a id="L595" name="L595"></a> 595 
<div class="comment">
      Returns a <code>TextLayout</code> on the given character range.
      @param start the index of the first character
      @param limit the index after the last character.  Must be greater
        than <code>start</code>
      @return a <code>TextLayout</code> for the characters beginning at
       <code>start</code> up to (but not including) <code>limit</code>
      @throws IndexOutOfBoundsException if <code>limit</code> is less
              than <code>start</code>
      @throws IllegalArgumentException if <code>start</code> or
               <code>limit</code> is not between the beginning of
               the paragraph and the end of the paragraph.</div>
<a id="L610" name="L610"></a> 610     <strong class="reserved">public</strong> <a href="../S/2375.html#L239" title="Defined at 239 in src/java/awt/font/TextLayout.java.">TextLayout</a> <a href="../R/17299.html" title="Multiple referred from 54 places.">getLayout</a>(<strong class="reserved">int</strong> <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>, <strong class="reserved">int</strong> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>) <em class="brace">{</em>
<a id="L611" name="L611"></a> 611 
<a id="L612" name="L612"></a> 612         <strong class="reserved">int</strong> localStart = <a href="../D/34747.html" title="Multiple defined in 52 places.">start</a> - fStart;
<a id="L613" name="L613"></a> 613         <strong class="reserved">int</strong> localLimit = <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> - fStart;
<a id="L614" name="L614"></a> 614 
<a id="L615" name="L615"></a> 615         <a href="../S/2365.html#L496" title="Defined at 496 in src/java/awt/font/TextMeasurer.java.">ensureComponents</a>(localStart, localLimit);
<a id="L616" name="L616"></a> 616         <a href="../S/2362.html#L67" title="Defined at 67 in src/java/awt/font/TextLine.java.">TextLine</a> textLine = <a href="../S/2365.html#L470" title="Defined at 470 in src/java/awt/font/TextMeasurer.java.">makeTextLineOnRange</a>(localStart, localLimit);
<a id="L617" name="L617"></a> 617 
<a id="L618" name="L618"></a> 618         <strong class="reserved">if</strong> (localLimit &lt; fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L619" name="L619"></a> 619             layoutCharCount += <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>-<a href="../D/34747.html" title="Multiple defined in 52 places.">start</a>;
<a id="L620" name="L620"></a> 620             layoutCount++;
<a id="L621" name="L621"></a> 621         <em class="brace">}</em>
<a id="L622" name="L622"></a> 622 
<a id="L623" name="L623"></a> 623         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/2375.html#L239" title="Defined at 239 in src/java/awt/font/TextLayout.java.">TextLayout</a>(textLine,
<a id="L624" name="L624"></a> 624                               fBaseline,
<a id="L625" name="L625"></a> 625                               fBaselineOffsets,
<a id="L626" name="L626"></a> 626                               fJustifyRatio);
<a id="L627" name="L627"></a> 627     <em class="brace">}</em>
<a id="L628" name="L628"></a> 628 
<a id="L629" name="L629"></a> 629     <strong class="reserved">private</strong> <strong class="reserved">int</strong> formattedChars = 0;
<a id="L630" name="L630"></a> 630     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> wantStats = <div class="comment">
/*"true".equals(System.getProperty("collectStats"));*/</div>
<a id="L631" name="L631"></a> 631     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> collectStats = <strong class="reserved">false</strong>;
<a id="L632" name="L632"></a> 632 
<a id="L633" name="L633"></a> 633     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2365.html#L664" title="Referred from 664 in src/java/awt/font/TextMeasurer.java.">printStats</a>() <em class="brace">{</em>
<a id="L634" name="L634"></a> 634         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1038.html#L2317" title="Defined at 2317 in src/java/util/Formatter.java.">out</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("formattedChars: " + formattedChars);
<a id="L635" name="L635"></a> 635         <em class="comment">//formattedChars = 0;</em>
<a id="L636" name="L636"></a> 636         collectStats = <strong class="reserved">false</strong>;
<a id="L637" name="L637"></a> 637     <em class="brace">}</em>
<a id="L638" name="L638"></a> 638 
<div class="comment">
      Updates the <code>TextMeasurer</code> after a single character has
      been inserted
      into the paragraph currently represented by this
      <code>TextMeasurer</code>.  After this call, this
      <code>TextMeasurer</code> is equivalent to a new
      <code>TextMeasurer</code> created from the text;  however, it will
      usually be more efficient to update an existing
      <code>TextMeasurer</code> than to create a new one from scratch.
      @param newParagraph the text of the paragraph after performing
      the insertion.  Cannot be null.
      @param insertPos the position in the text where the character was
      inserted.  Must not be less than the start of
      <code>newParagraph</code>, and must be less than the end of
      <code>newParagraph</code>.
      @throws IndexOutOfBoundsException if <code>insertPos</code> is less
              than the start of <code>newParagraph</code> or greater than
              or equal to the end of <code>newParagraph</code>
      @throws NullPointerException if <code>newParagraph</code> is
              <code>null</code></div>
<a id="L661" name="L661"></a> 661     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/20763.html" title="Multiple referred from 2 places.">insertChar</a>(<a href="../S/2454.html#L79" title="Defined at 79 in src/java/text/AttributedCharacterIterator.java.">AttributedCharacterIterator</a> newParagraph, <strong class="reserved">int</strong> insertPos) <em class="brace">{</em>
<a id="L662" name="L662"></a> 662 
<a id="L663" name="L663"></a> 663         <strong class="reserved">if</strong> (collectStats) <em class="brace">{</em>
<a id="L664" name="L664"></a> 664             <a href="../S/2365.html#L633" title="Defined at 633 in src/java/awt/font/TextMeasurer.java.">printStats</a>();
<a id="L665" name="L665"></a> 665         <em class="brace">}</em>
<a id="L666" name="L666"></a> 666         <strong class="reserved">if</strong> (wantStats) <em class="brace">{</em>
<a id="L667" name="L667"></a> 667             collectStats = <strong class="reserved">true</strong>;
<a id="L668" name="L668"></a> 668         <em class="brace">}</em>
<a id="L669" name="L669"></a> 669 
<a id="L670" name="L670"></a> 670         fStart = newParagraph.<a href="../D/17233.html" title="Multiple defined in 6 places.">getBeginIndex</a>();
<a id="L671" name="L671"></a> 671         <strong class="reserved">int</strong> <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a> = newParagraph.<a href="../D/18768.html" title="Multiple defined in 8 places.">getEndIndex</a>();
<a id="L672" name="L672"></a> 672         <strong class="reserved">if</strong> (<a href="../D/15431.html" title="Multiple defined in 52 places.">end</a> - fStart != fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>+1) <em class="brace">{</em>
<a id="L673" name="L673"></a> 673             <a href="../S/2365.html#L195" title="Defined at 195 in src/java/awt/font/TextMeasurer.java.">initAll</a>(newParagraph);
<a id="L674" name="L674"></a> 674         <em class="brace">}</em>
<a id="L675" name="L675"></a> 675 
<a id="L676" name="L676"></a> 676         <strong class="reserved">char</strong>[] newChars = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[<a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>-fStart];
<a id="L677" name="L677"></a> 677         <strong class="reserved">int</strong> newCharIndex = insertPos - fStart;
<a id="L678" name="L678"></a> 678         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(fChars, 0, newChars, 0, newCharIndex);
<a id="L679" name="L679"></a> 679 
<a id="L680" name="L680"></a> 680         <strong class="reserved">char</strong> newChar = newParagraph.<a href="../D/32925.html" title="Multiple defined in 28 places.">setIndex</a>(insertPos);
<a id="L681" name="L681"></a> 681         newChars[newCharIndex] = newChar;
<a id="L682" name="L682"></a> 682         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(fChars,
<a id="L683" name="L683"></a> 683                          newCharIndex,
<a id="L684" name="L684"></a> 684                          newChars,
<a id="L685" name="L685"></a> 685                          newCharIndex+1,
<a id="L686" name="L686"></a> 686                          <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>-insertPos-1);
<a id="L687" name="L687"></a> 687         fChars = newChars;
<a id="L688" name="L688"></a> 688 
<a id="L689" name="L689"></a> 689         <strong class="reserved">if</strong> (fBidi != <strong class="reserved">null</strong> || <a href="../S/2485.html#L61" title="Defined at 61 in src/java/text/Bidi.java.">Bidi</a>.<a href="../S/2485.html#L303" title="Defined at 303 in src/java/text/Bidi.java.">requiresBidi</a>(newChars, newCharIndex, newCharIndex + 1) ||
<a id="L690" name="L690"></a> 690                 newParagraph.<a href="../D/17064.html" title="Multiple defined in 72 places.">getAttribute</a>(<a href="../S/2367.html#L255" title="Defined at 255 in src/java/awt/font/TextAttribute.java.">TextAttribute</a>.BIDI_EMBEDDING) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L691" name="L691"></a> 691 
<a id="L692" name="L692"></a> 692             fBidi = <strong class="reserved">new</strong> <a href="../S/2485.html#L61" title="Defined at 61 in src/java/text/Bidi.java.">Bidi</a>(newParagraph);
<a id="L693" name="L693"></a> 693             <strong class="reserved">if</strong> (fBidi.<a href="../D/25785.html" title="Multiple defined in 18 places.">isLeftToRight</a>()) <em class="brace">{</em>
<a id="L694" name="L694"></a> 694                 fBidi = <strong class="reserved">null</strong>;
<a id="L695" name="L695"></a> 695             <em class="brace">}</em>
<a id="L696" name="L696"></a> 696         <em class="brace">}</em>
<a id="L697" name="L697"></a> 697 
<a id="L698" name="L698"></a> 698         fParagraph = <a href="../S/2372.html#L52" title="Defined at 52 in src/java/awt/font/StyledParagraph.java.">StyledParagraph</a>.<a href="../D/24738.html" title="Multiple defined in 3 places.">insertChar</a>(newParagraph,
<a id="L699" name="L699"></a> 699                                                 fChars,
<a id="L700" name="L700"></a> 700                                                 insertPos,
<a id="L701" name="L701"></a> 701                                                 fParagraph);
<a id="L702" name="L702"></a> 702         <a href="../S/2365.html#L185" title="Defined at 185 in src/java/awt/font/TextMeasurer.java.">invalidateComponents</a>();
<a id="L703" name="L703"></a> 703     <em class="brace">}</em>
<a id="L704" name="L704"></a> 704 
<div class="comment">
      Updates the <code>TextMeasurer</code> after a single character has
      been deleted
      from the paragraph currently represented by this
      <code>TextMeasurer</code>.  After this call, this
      <code>TextMeasurer</code> is equivalent to a new <code>TextMeasurer</code>
      created from the text;  however, it will usually be more efficient
      to update an existing <code>TextMeasurer</code> than to create a new one
      from scratch.
      @param newParagraph the text of the paragraph after performing
      the deletion.  Cannot be null.
      @param deletePos the position in the text where the character was removed.
      Must not be less than
      the start of <code>newParagraph</code>, and must not be greater than the
      end of <code>newParagraph</code>.
      @throws IndexOutOfBoundsException if <code>deletePos</code> is
              less than the start of <code>newParagraph</code> or greater
              than the end of <code>newParagraph</code>
      @throws NullPointerException if <code>newParagraph</code> is
              <code>null</code></div>
<a id="L727" name="L727"></a> 727     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/13206.html" title="Multiple referred from 2 places.">deleteChar</a>(<a href="../S/2454.html#L79" title="Defined at 79 in src/java/text/AttributedCharacterIterator.java.">AttributedCharacterIterator</a> newParagraph, <strong class="reserved">int</strong> deletePos) <em class="brace">{</em>
<a id="L728" name="L728"></a> 728 
<a id="L729" name="L729"></a> 729         fStart = newParagraph.<a href="../D/17233.html" title="Multiple defined in 6 places.">getBeginIndex</a>();
<a id="L730" name="L730"></a> 730         <strong class="reserved">int</strong> <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a> = newParagraph.<a href="../D/18768.html" title="Multiple defined in 8 places.">getEndIndex</a>();
<a id="L731" name="L731"></a> 731         <strong class="reserved">if</strong> (<a href="../D/15431.html" title="Multiple defined in 52 places.">end</a> - fStart != fChars.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>-1) <em class="brace">{</em>
<a id="L732" name="L732"></a> 732             <a href="../S/2365.html#L195" title="Defined at 195 in src/java/awt/font/TextMeasurer.java.">initAll</a>(newParagraph);
<a id="L733" name="L733"></a> 733         <em class="brace">}</em>
<a id="L734" name="L734"></a> 734 
<a id="L735" name="L735"></a> 735         <strong class="reserved">char</strong>[] newChars = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[<a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>-fStart];
<a id="L736" name="L736"></a> 736         <strong class="reserved">int</strong> changedIndex = deletePos-fStart;
<a id="L737" name="L737"></a> 737 
<a id="L738" name="L738"></a> 738         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(fChars, 0, newChars, 0, deletePos-fStart);
<a id="L739" name="L739"></a> 739         <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(fChars, changedIndex+1, newChars, changedIndex, <a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>-deletePos);
<a id="L740" name="L740"></a> 740         fChars = newChars;
<a id="L741" name="L741"></a> 741 
<a id="L742" name="L742"></a> 742         <strong class="reserved">if</strong> (fBidi != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L743" name="L743"></a> 743             fBidi = <strong class="reserved">new</strong> <a href="../S/2485.html#L61" title="Defined at 61 in src/java/text/Bidi.java.">Bidi</a>(newParagraph);
<a id="L744" name="L744"></a> 744             <strong class="reserved">if</strong> (fBidi.<a href="../D/25785.html" title="Multiple defined in 18 places.">isLeftToRight</a>()) <em class="brace">{</em>
<a id="L745" name="L745"></a> 745                 fBidi = <strong class="reserved">null</strong>;
<a id="L746" name="L746"></a> 746             <em class="brace">}</em>
<a id="L747" name="L747"></a> 747         <em class="brace">}</em>
<a id="L748" name="L748"></a> 748 
<a id="L749" name="L749"></a> 749         fParagraph = <a href="../S/2372.html#L52" title="Defined at 52 in src/java/awt/font/StyledParagraph.java.">StyledParagraph</a>.<a href="../D/14797.html" title="Multiple defined in 3 places.">deleteChar</a>(newParagraph,
<a id="L750" name="L750"></a> 750                                                 fChars,
<a id="L751" name="L751"></a> 751                                                 deletePos,
<a id="L752" name="L752"></a> 752                                                 fParagraph);
<a id="L753" name="L753"></a> 753         <a href="../S/2365.html#L185" title="Defined at 185 in src/java/awt/font/TextMeasurer.java.">invalidateComponents</a>();
<a id="L754" name="L754"></a> 754     <em class="brace">}</em>
<a id="L755" name="L755"></a> 755 
<div class="comment">
      NOTE:  This method is only for LineBreakMeasurer's use.  It is package-
      private because it returns internal data.</div>
<a id="L760" name="L760"></a> 760     <strong class="reserved">char</strong>[] <a href="../R/15533.html" title="Multiple referred from 94 places.">getChars</a>() <em class="brace">{</em>
<a id="L761" name="L761"></a> 761 
<a id="L762" name="L762"></a> 762         <strong class="reserved">return</strong> fChars;
<a id="L763" name="L763"></a> 763     <em class="brace">}</em>
<a id="L764" name="L764"></a> 764 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L171">[^]</a><a href="#L760">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>