<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/DualPivotQuicksort.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L107">[^]</a><a href="#L2749">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L107" title="Defined at 107.">sort</a></li>
<li><a href="#L214" title="Defined at 214.">sort</a></li>
<li><a href="#L555" title="Defined at 555.">sort</a></li>
<li><a href="#L662" title="Defined at 662.">sort</a></li>
<li><a href="#L1003" title="Defined at 1003.">sort</a></li>
<li><a href="#L1039" title="Defined at 1039.">doSort</a></li>
<li><a href="#L1146" title="Defined at 1146.">sort</a></li>
<li><a href="#L1487" title="Defined at 1487.">sort</a></li>
<li><a href="#L1523" title="Defined at 1523.">doSort</a></li>
<li><a href="#L1630" title="Defined at 1630.">sort</a></li>
<li><a href="#L1970" title="Defined at 1970.">sort</a></li>
<li><a href="#L2012" title="Defined at 2012.">sort</a></li>
<li><a href="#L2103" title="Defined at 2103.">doSort</a></li>
<li><a href="#L2210" title="Defined at 2210.">sort</a></li>
<li><a href="#L2551" title="Defined at 2551.">sort</a></li>
<li><a href="#L2642" title="Defined at 2642.">doSort</a></li>
<li><a href="#L2749" title="Defined at 2749.">sort</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2009, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util;
<a id="L27" name="L27"></a>  27 
<div class="comment">
  This class implements the Dual-Pivot Quicksort algorithm by
  Vladimir Yaroslavskiy, Jon Bentley, and Josh Bloch. The algorithm
  offers O(n log(n)) performance on many data sets that cause other
  quicksorts to degrade to quadratic performance, and is typically
  faster than traditional (one-pivot) Quicksort implementations.
  All exposed methods are package-private, designed to be invoked
  from public methods (in class Arrays) after performing any
  necessary array bounds checks and expanding parameters into the
  required forms.
  @author Vladimir Yaroslavskiy
  @author Jon Bentley
  @author Josh Bloch
  @version 2011.02.11 m765.827.12i:5\7pm
  @since 1.7</div>
<a id="L47" name="L47"></a>  47 <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/2448.html" title="Multiple referred from 35 places.">DualPivotQuicksort</a> <em class="brace">{</em>
<a id="L48" name="L48"></a>  48 
<div class="comment">
      Prevents instantiation.</div>
<a id="L52" name="L52"></a>  52     <strong class="reserved">private</strong> DualPivotQuicksort() <em class="brace">{</em><em class="brace">}</em>
<a id="L53" name="L53"></a>  53 
<div class="comment">
      Tuning parameters.</div>
<a id="L57" name="L57"></a>  57 
<div class="comment">
      The maximum number of runs in merge sort.</div>
<a id="L61" name="L61"></a>  61     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_RUN_COUNT = 67;
<a id="L62" name="L62"></a>  62 
<div class="comment">
      The maximum length of run in merge sort.</div>
<a id="L66" name="L66"></a>  66     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_RUN_LENGTH = 33;
<a id="L67" name="L67"></a>  67 
<div class="comment">
      If the length of an array to be sorted is less than this
      constant, Quicksort is used in preference to merge sort.</div>
<a id="L72" name="L72"></a>  72     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> QUICKSORT_THRESHOLD = 286;
<a id="L73" name="L73"></a>  73 
<div class="comment">
      If the length of an array to be sorted is less than this
      constant, insertion sort is used in preference to Quicksort.</div>
<a id="L78" name="L78"></a>  78     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> INSERTION_SORT_THRESHOLD = 47;
<a id="L79" name="L79"></a>  79 
<div class="comment">
      If the length of a byte array to be sorted is greater than this
      constant, counting sort is used in preference to insertion sort.</div>
<a id="L84" name="L84"></a>  84     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> COUNTING_SORT_THRESHOLD_FOR_BYTE = 29;
<a id="L85" name="L85"></a>  85 
<div class="comment">
      If the length of a short or char array to be sorted is greater
      than this constant, counting sort is used in preference to Quicksort.</div>
<a id="L90" name="L90"></a>  90     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> COUNTING_SORT_THRESHOLD_FOR_SHORT_OR_CHAR = 3200;
<a id="L91" name="L91"></a>  91 
<div class="comment">
      Sorting methods for seven primitive types.</div>
<a id="L95" name="L95"></a>  95 
<div class="comment">
      Sorts the specified range of the array using the given
      workspace array slice if possible for merging
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L107" name="L107"></a> 107     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">int</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L108" name="L108"></a> 108                      <strong class="reserved">int</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L109" name="L109"></a> 109         <em class="comment">// Use Quicksort on small arrays</em>
<a id="L110" name="L110"></a> 110         <strong class="reserved">if</strong> (right - left &lt; QUICKSORT_THRESHOLD) <em class="brace">{</em>
<a id="L111" name="L111"></a> 111             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L112" name="L112"></a> 112             <strong class="reserved">return</strong>;
<a id="L113" name="L113"></a> 113         <em class="brace">}</em>
<a id="L114" name="L114"></a> 114 
<div class="comment">
          Index run[i] is the start of i-th run
          (ascending or descending sequence).</div>
<a id="L119" name="L119"></a> 119         <strong class="reserved">int</strong>[] <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[MAX_RUN_COUNT + 1];
<a id="L120" name="L120"></a> 120         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[0] = left;
<a id="L121" name="L121"></a> 121 
<a id="L122" name="L122"></a> 122         <em class="comment">// Check if the array is nearly sorted</em>
<a id="L123" name="L123"></a> 123         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; k &lt; right; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = k) <em class="brace">{</em>
<a id="L124" name="L124"></a> 124             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// ascending</em>
<a id="L125" name="L125"></a> 125                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L126" name="L126"></a> 126             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &gt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// descending</em>
<a id="L127" name="L127"></a> 127                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L128" name="L128"></a> 128                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] - 1, hi = k; ++lo &lt; --hi; ) <em class="brace">{</em>
<a id="L129" name="L129"></a> 129                     <strong class="reserved">int</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi] = t;
<a id="L130" name="L130"></a> 130                 <em class="brace">}</em>
<a id="L131" name="L131"></a> 131             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// equal</em>
<a id="L132" name="L132"></a> 132                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> m = MAX_RUN_LENGTH; ++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]; ) <em class="brace">{</em>
<a id="L133" name="L133"></a> 133                     <strong class="reserved">if</strong> (--m == 0) <em class="brace">{</em>
<a id="L134" name="L134"></a> 134                         <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L135" name="L135"></a> 135                         <strong class="reserved">return</strong>;
<a id="L136" name="L136"></a> 136                     <em class="brace">}</em>
<a id="L137" name="L137"></a> 137                 <em class="brace">}</em>
<a id="L138" name="L138"></a> 138             <em class="brace">}</em>
<a id="L139" name="L139"></a> 139 
<div class="comment">
              The array is not highly structured,
              use Quicksort instead of merge sort.</div>
<a id="L144" name="L144"></a> 144             <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == MAX_RUN_COUNT) <em class="brace">{</em>
<a id="L145" name="L145"></a> 145                 <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L146" name="L146"></a> 146                 <strong class="reserved">return</strong>;
<a id="L147" name="L147"></a> 147             <em class="brace">}</em>
<a id="L148" name="L148"></a> 148         <em class="brace">}</em>
<a id="L149" name="L149"></a> 149 
<a id="L150" name="L150"></a> 150         <em class="comment">// Check special cases</em>
<a id="L151" name="L151"></a> 151         <em class="comment">// Implementation note: variable "right" is increased by 1.</em>
<a id="L152" name="L152"></a> 152         <strong class="reserved">if</strong> (<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] == right++) <em class="brace">{</em> <em class="comment">// The last run contains one element</em>
<a id="L153" name="L153"></a> 153             <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = right;
<a id="L154" name="L154"></a> 154         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 1) <em class="brace">{</em> <em class="comment">// The array is already sorted</em>
<a id="L155" name="L155"></a> 155             <strong class="reserved">return</strong>;
<a id="L156" name="L156"></a> 156         <em class="brace">}</em>
<a id="L157" name="L157"></a> 157 
<a id="L158" name="L158"></a> 158         <em class="comment">// Determine alternation base for merge</em>
<a id="L159" name="L159"></a> 159         <strong class="reserved">byte</strong> odd = 0;
<a id="L160" name="L160"></a> 160         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> n = 1; (n &lt;&lt;= 1) &lt; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; odd ^= 1);
<a id="L161" name="L161"></a> 161 
<a id="L162" name="L162"></a> 162         <em class="comment">// Use or create temporary array b for merging</em>
<a id="L163" name="L163"></a> 163         <strong class="reserved">int</strong>[] b;                 <em class="comment">// temp array; alternates with a</em>
<a id="L164" name="L164"></a> 164         <strong class="reserved">int</strong> ao, bo;              <em class="comment">// array offsets from 'left'</em>
<a id="L165" name="L165"></a> 165         <strong class="reserved">int</strong> blen = right - left; <em class="comment">// space needed for b</em>
<a id="L166" name="L166"></a> 166         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; blen || workBase + blen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L167" name="L167"></a> 167             work = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[blen];
<a id="L168" name="L168"></a> 168             workBase = 0;
<a id="L169" name="L169"></a> 169         <em class="brace">}</em>
<a id="L170" name="L170"></a> 170         <strong class="reserved">if</strong> (odd == 0) <em class="brace">{</em>
<a id="L171" name="L171"></a> 171             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, work, workBase, blen);
<a id="L172" name="L172"></a> 172             b = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L173" name="L173"></a> 173             bo = 0;
<a id="L174" name="L174"></a> 174             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = work;
<a id="L175" name="L175"></a> 175             ao = workBase - left;
<a id="L176" name="L176"></a> 176         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L177" name="L177"></a> 177             b = work;
<a id="L178" name="L178"></a> 178             ao = 0;
<a id="L179" name="L179"></a> 179             bo = workBase - left;
<a id="L180" name="L180"></a> 180         <em class="brace">}</em>
<a id="L181" name="L181"></a> 181 
<a id="L182" name="L182"></a> 182         <em class="comment">// Merging</em>
<a id="L183" name="L183"></a> 183         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 1; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>) <em class="brace">{</em>
<a id="L184" name="L184"></a> 184             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = 0) + 2; k &lt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; k += 2) <em class="brace">{</em>
<a id="L185" name="L185"></a> 185                 <strong class="reserved">int</strong> hi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k], mi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 1];
<a id="L186" name="L186"></a> 186                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 2], p = i, q = mi; i &lt; hi; ++i) <em class="brace">{</em>
<a id="L187" name="L187"></a> 187                     <strong class="reserved">if</strong> (q &gt;= hi || p &lt; mi &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p + ao] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q + ao]) <em class="brace">{</em>
<a id="L188" name="L188"></a> 188                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p++ + ao];
<a id="L189" name="L189"></a> 189                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L190" name="L190"></a> 190                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q++ + ao];
<a id="L191" name="L191"></a> 191                     <em class="brace">}</em>
<a id="L192" name="L192"></a> 192                 <em class="brace">}</em>
<a id="L193" name="L193"></a> 193                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = hi;
<a id="L194" name="L194"></a> 194             <em class="brace">}</em>
<a id="L195" name="L195"></a> 195             <strong class="reserved">if</strong> ((<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &amp; 1) != 0) <em class="brace">{</em>
<a id="L196" name="L196"></a> 196                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = right, lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - 1]; --i &gt;= lo;
<a id="L197" name="L197"></a> 197                     b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + ao]
<a id="L198" name="L198"></a> 198                 );
<a id="L199" name="L199"></a> 199                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = right;
<a id="L200" name="L200"></a> 200             <em class="brace">}</em>
<a id="L201" name="L201"></a> 201             <strong class="reserved">int</strong>[] t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = b; b = t;
<a id="L202" name="L202"></a> 202             <strong class="reserved">int</strong> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = ao; ao = bo; bo = <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L203" name="L203"></a> 203         <em class="brace">}</em>
<a id="L204" name="L204"></a> 204     <em class="brace">}</em>
<a id="L205" name="L205"></a> 205 
<div class="comment">
      Sorts the specified range of the array by Dual-Pivot Quicksort.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param leftmost indicates if this part is the leftmost in the range</div>
<a id="L214" name="L214"></a> 214     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">int</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right, <strong class="reserved">boolean</strong> leftmost) <em class="brace">{</em>
<a id="L215" name="L215"></a> 215         <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = right - left + 1;
<a id="L216" name="L216"></a> 216 
<a id="L217" name="L217"></a> 217         <em class="comment">// Use insertion sort on tiny arrays</em>
<a id="L218" name="L218"></a> 218         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; INSERTION_SORT_THRESHOLD) <em class="brace">{</em>
<a id="L219" name="L219"></a> 219             <strong class="reserved">if</strong> (leftmost) <em class="brace">{</em>
<div class="comment">
                  Traditional (without sentinel) insertion sort,
                  optimized for server VM, is used in case of
                  the leftmost part.</div>
<a id="L225" name="L225"></a> 225                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L226" name="L226"></a> 226                     <strong class="reserved">int</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L227" name="L227"></a> 227                     <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L228" name="L228"></a> 228                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L229" name="L229"></a> 229                         <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L230" name="L230"></a> 230                             <strong class="reserved">break</strong>;
<a id="L231" name="L231"></a> 231                         <em class="brace">}</em>
<a id="L232" name="L232"></a> 232                     <em class="brace">}</em>
<a id="L233" name="L233"></a> 233                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L234" name="L234"></a> 234                 <em class="brace">}</em>
<a id="L235" name="L235"></a> 235             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
                  Skip the longest ascending sequence.</div>
<a id="L239" name="L239"></a> 239                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L240" name="L240"></a> 240                     <strong class="reserved">if</strong> (left &gt;= right) <em class="brace">{</em>
<a id="L241" name="L241"></a> 241                         <strong class="reserved">return</strong>;
<a id="L242" name="L242"></a> 242                     <em class="brace">}</em>
<a id="L243" name="L243"></a> 243                 <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++left] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left - 1]);
<a id="L244" name="L244"></a> 244 
<div class="comment">
                  Every element from adjoining part plays the role
                  of sentinel, therefore this allows us to avoid the
                  left range check on each iteration. Moreover, we use
                  the more optimized algorithm, so called pair insertion
                  sort, which is faster (in the context of Quicksort)
                  than traditional implementation of insertion sort.</div>
<a id="L253" name="L253"></a> 253                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; ++left &lt;= right; k = ++left) <em class="brace">{</em>
<a id="L254" name="L254"></a> 254                     <strong class="reserved">int</strong> a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k], <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L255" name="L255"></a> 255 
<a id="L256" name="L256"></a> 256                     <strong class="reserved">if</strong> (a1 &lt; <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>) <em class="brace">{</em>
<a id="L257" name="L257"></a> 257                         <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = a1; a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L258" name="L258"></a> 258                     <em class="brace">}</em>
<a id="L259" name="L259"></a> 259                     <strong class="reserved">while</strong> (a1 &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L260" name="L260"></a> 260                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L261" name="L261"></a> 261                     <em class="brace">}</em>
<a id="L262" name="L262"></a> 262                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++k + 1] = a1;
<a id="L263" name="L263"></a> 263 
<a id="L264" name="L264"></a> 264                     <strong class="reserved">while</strong> (<a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L265" name="L265"></a> 265                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L266" name="L266"></a> 266                     <em class="brace">}</em>
<a id="L267" name="L267"></a> 267                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>;
<a id="L268" name="L268"></a> 268                 <em class="brace">}</em>
<a id="L269" name="L269"></a> 269                 <strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L270" name="L270"></a> 270 
<a id="L271" name="L271"></a> 271                 <strong class="reserved">while</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--right]) <em class="brace">{</em>
<a id="L272" name="L272"></a> 272                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L273" name="L273"></a> 273                 <em class="brace">}</em>
<a id="L274" name="L274"></a> 274                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>;
<a id="L275" name="L275"></a> 275             <em class="brace">}</em>
<a id="L276" name="L276"></a> 276             <strong class="reserved">return</strong>;
<a id="L277" name="L277"></a> 277         <em class="brace">}</em>
<a id="L278" name="L278"></a> 278 
<a id="L279" name="L279"></a> 279         <em class="comment">// Inexpensive approximation of length / 7</em>
<a id="L280" name="L280"></a> 280         <strong class="reserved">int</strong> seventh = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 3) + (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 6) + 1;
<a id="L281" name="L281"></a> 281 
<div class="comment">
          Sort five evenly spaced elements around (and including) the
          center element in the range. These elements will be used for
          pivot selection as described below. The choice for spacing
          these elements was empirically determined to work well on
          a wide variety of inputs.</div>
<a id="L289" name="L289"></a> 289         <strong class="reserved">int</strong> e3 = (left + right) &gt;&gt;&gt; 1; <em class="comment">// The midpoint</em>
<a id="L290" name="L290"></a> 290         <strong class="reserved">int</strong> e2 = e3 - seventh;
<a id="L291" name="L291"></a> 291         <strong class="reserved">int</strong> e1 = e2 - seventh;
<a id="L292" name="L292"></a> 292         <strong class="reserved">int</strong> e4 = e3 + seventh;
<a id="L293" name="L293"></a> 293         <strong class="reserved">int</strong> e5 = e4 + seventh;
<a id="L294" name="L294"></a> 294 
<a id="L295" name="L295"></a> 295         <em class="comment">// Sort these elements using insertion sort</em>
<a id="L296" name="L296"></a> 296         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <strong class="reserved">int</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L297" name="L297"></a> 297 
<a id="L298" name="L298"></a> 298         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <strong class="reserved">int</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L299" name="L299"></a> 299             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L300" name="L300"></a> 300         <em class="brace">}</em>
<a id="L301" name="L301"></a> 301         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <strong class="reserved">int</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L302" name="L302"></a> 302             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L303" name="L303"></a> 303                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L304" name="L304"></a> 304             <em class="brace">}</em>
<a id="L305" name="L305"></a> 305         <em class="brace">}</em>
<a id="L306" name="L306"></a> 306         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]) <em class="brace">{</em> <strong class="reserved">int</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = t;
<a id="L307" name="L307"></a> 307             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L308" name="L308"></a> 308                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L309" name="L309"></a> 309                     <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L310" name="L310"></a> 310                 <em class="brace">}</em>
<a id="L311" name="L311"></a> 311             <em class="brace">}</em>
<a id="L312" name="L312"></a> 312         <em class="brace">}</em>
<a id="L313" name="L313"></a> 313 
<a id="L314" name="L314"></a> 314         <em class="comment">// Pointers</em>
<a id="L315" name="L315"></a> 315         <strong class="reserved">int</strong> less  = left;  <em class="comment">// The index of the first element of center part</em>
<a id="L316" name="L316"></a> 316         <strong class="reserved">int</strong> great = right; <em class="comment">// The index before the first element of right part</em>
<a id="L317" name="L317"></a> 317 
<a id="L318" name="L318"></a> 318         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]) <em class="brace">{</em>
<div class="comment">
              Use the second and fourth of the five sorted elements as pivots.
              These values are inexpensive approximations of the first and
              second terciles of the array. Note that pivot1 &lt;= pivot2.</div>
<a id="L324" name="L324"></a> 324             <strong class="reserved">int</strong> pivot1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2];
<a id="L325" name="L325"></a> 325             <strong class="reserved">int</strong> pivot2 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4];
<a id="L326" name="L326"></a> 326 
<div class="comment">
              The first and the last elements to be sorted are moved to the
              locations formerly occupied by the pivots. When partitioning
              is complete, the pivots are swapped back into their final
              positions, and excluded from subsequent sorting.</div>
<a id="L333" name="L333"></a> 333             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L334" name="L334"></a> 334             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L335" name="L335"></a> 335 
<div class="comment">
              Skip elements, which are less or greater than pivot values.</div>
<a id="L339" name="L339"></a> 339             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++less] &lt; pivot1);
<a id="L340" name="L340"></a> 340             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--great] &gt; pivot2);
<a id="L341" name="L341"></a> 341 
<div class="comment">
              Partitioning:
                left part           center part                   right part
              +--------------------------------------------------------------+
              |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  |
              +--------------------------------------------------------------+
                            ^                          ^       ^
                            |                          |       |
                           less                        k     great
              Invariants:
                           all in (left, less)   &lt; pivot1
                 pivot1 &lt;= all in [less, k)     &lt;= pivot2
                           all in (great, right) &gt; pivot2
              Pointer k is the first index of ?-part.</div>
<a id="L361" name="L361"></a> 361             outer:
<a id="L362" name="L362"></a> 362             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L363" name="L363"></a> 363                 <strong class="reserved">int</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L364" name="L364"></a> 364                 <strong class="reserved">if</strong> (ak &lt; pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L365" name="L365"></a> 365                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                      Here and below we use "a[i] = b; i++;" instead
                      of "a[i++] = b;" due to performance issue.</div>
<a id="L370" name="L370"></a> 370                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L371" name="L371"></a> 371                     ++less;
<a id="L372" name="L372"></a> 372                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak &gt; pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L373" name="L373"></a> 373                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot2) <em class="brace">{</em>
<a id="L374" name="L374"></a> 374                         <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L375" name="L375"></a> 375                             <strong class="reserved">break</strong> outer;
<a id="L376" name="L376"></a> 376                         <em class="brace">}</em>
<a id="L377" name="L377"></a> 377                     <em class="brace">}</em>
<a id="L378" name="L378"></a> 378                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot2</em>
<a id="L379" name="L379"></a> 379                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L380" name="L380"></a> 380                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L381" name="L381"></a> 381                         ++less;
<a id="L382" name="L382"></a> 382                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt;= a[great] &lt;= pivot2</em>
<a id="L383" name="L383"></a> 383                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L384" name="L384"></a> 384                     <em class="brace">}</em>
<div class="comment">
                      Here and below we use "a[i] = b; i--;" instead
                      of "a[i--] = b;" due to performance issue.</div>
<a id="L389" name="L389"></a> 389                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L390" name="L390"></a> 390                     --great;
<a id="L391" name="L391"></a> 391                 <em class="brace">}</em>
<a id="L392" name="L392"></a> 392             <em class="brace">}</em>
<a id="L393" name="L393"></a> 393 
<a id="L394" name="L394"></a> 394             <em class="comment">// Swap pivots into their final positions</em>
<a id="L395" name="L395"></a> 395             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]  = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1] = pivot1;
<a id="L396" name="L396"></a> 396             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1] = pivot2;
<a id="L397" name="L397"></a> 397 
<a id="L398" name="L398"></a> 398             <em class="comment">// Sort left and right parts recursively, excluding known pivots</em>
<a id="L399" name="L399"></a> 399             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 2, leftmost);
<a id="L400" name="L400"></a> 400             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 2, right, <strong class="reserved">false</strong>);
<a id="L401" name="L401"></a> 401 
<div class="comment">
              If center part is too large (comprises &gt; 4/7 of the array),
              swap internal pivot values to ends.</div>
<a id="L406" name="L406"></a> 406             <strong class="reserved">if</strong> (less &lt; e1 &amp;&amp; e5 &lt; great) <em class="brace">{</em>
<div class="comment">
                  Skip elements, which are equal to pivot values.</div>
<a id="L410" name="L410"></a> 410                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] == pivot1) <em class="brace">{</em>
<a id="L411" name="L411"></a> 411                     ++less;
<a id="L412" name="L412"></a> 412                 <em class="brace">}</em>
<a id="L413" name="L413"></a> 413 
<a id="L414" name="L414"></a> 414                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L415" name="L415"></a> 415                     --great;
<a id="L416" name="L416"></a> 416                 <em class="brace">}</em>
<a id="L417" name="L417"></a> 417 
<div class="comment">
                  Partitioning:
                    left part         center part                  right part
                  +----------------------------------------------------------+
                  | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |
                  +----------------------------------------------------------+
                               ^                        ^       ^
                               |                        |       |
                              less                      k     great
                  Invariants:
                               all in (*,  less) == pivot1
                      pivot1 &lt; all in [less,  k)  &lt; pivot2
                               all in (great, *) == pivot2
                  Pointer k is the first index of ?-part.</div>
<a id="L437" name="L437"></a> 437                 outer:
<a id="L438" name="L438"></a> 438                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L439" name="L439"></a> 439                     <strong class="reserved">int</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L440" name="L440"></a> 440                     <strong class="reserved">if</strong> (ak == pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L441" name="L441"></a> 441                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L442" name="L442"></a> 442                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L443" name="L443"></a> 443                         ++less;
<a id="L444" name="L444"></a> 444                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak == pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L445" name="L445"></a> 445                         <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L446" name="L446"></a> 446                             <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L447" name="L447"></a> 447                                 <strong class="reserved">break</strong> outer;
<a id="L448" name="L448"></a> 448                             <em class="brace">}</em>
<a id="L449" name="L449"></a> 449                         <em class="brace">}</em>
<a id="L450" name="L450"></a> 450                         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt; pivot2</em>
<a id="L451" name="L451"></a> 451                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                              Even though a[great] equals to pivot1, the
                              assignment a[less] = pivot1 may be incorrect,
                              if a[great] and pivot1 are floating-point zeros
                              of different signs. Therefore in float and
                              double sorting methods we have to use more
                              accurate assignment a[less] = a[great].</div>
<a id="L460" name="L460"></a> 460                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = pivot1;
<a id="L461" name="L461"></a> 461                             ++less;
<a id="L462" name="L462"></a> 462                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt; a[great] &lt; pivot2</em>
<a id="L463" name="L463"></a> 463                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L464" name="L464"></a> 464                         <em class="brace">}</em>
<a id="L465" name="L465"></a> 465                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L466" name="L466"></a> 466                         --great;
<a id="L467" name="L467"></a> 467                     <em class="brace">}</em>
<a id="L468" name="L468"></a> 468                 <em class="brace">}</em>
<a id="L469" name="L469"></a> 469             <em class="brace">}</em>
<a id="L470" name="L470"></a> 470 
<a id="L471" name="L471"></a> 471             <em class="comment">// Sort center part recursively</em>
<a id="L472" name="L472"></a> 472             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, less, great, <strong class="reserved">false</strong>);
<a id="L473" name="L473"></a> 473 
<a id="L474" name="L474"></a> 474         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Partitioning with one pivot</em>
<div class="comment">
              Use the third of the five sorted elements as pivot.
              This value is inexpensive approximation of the median.</div>
<a id="L479" name="L479"></a> 479             <strong class="reserved">int</strong> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3];
<a id="L480" name="L480"></a> 480 
<div class="comment">
              Partitioning degenerates to the traditional 3-way
              (or "Dutch National Flag") schema:
                left part    center part              right part
              +-------------------------------------------------+
              |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  |
              +-------------------------------------------------+
                           ^              ^        ^
                           |              |        |
                          less            k      great
              Invariants:
                all in (left, less)   &lt; pivot
                all in [less, k)     == pivot
                all in (great, right) &gt; pivot
              Pointer k is the first index of ?-part.</div>
<a id="L501" name="L501"></a> 501             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less; k &lt;= great; ++k) <em class="brace">{</em>
<a id="L502" name="L502"></a> 502                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] == pivot) <em class="brace">{</em>
<a id="L503" name="L503"></a> 503                     <strong class="reserved">continue</strong>;
<a id="L504" name="L504"></a> 504                 <em class="brace">}</em>
<a id="L505" name="L505"></a> 505                 <strong class="reserved">int</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L506" name="L506"></a> 506                 <strong class="reserved">if</strong> (ak &lt; pivot) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L507" name="L507"></a> 507                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L508" name="L508"></a> 508                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L509" name="L509"></a> 509                     ++less;
<a id="L510" name="L510"></a> 510                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[k] &gt; pivot - Move a[k] to right part</em>
<a id="L511" name="L511"></a> 511                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot) <em class="brace">{</em>
<a id="L512" name="L512"></a> 512                         --great;
<a id="L513" name="L513"></a> 513                     <em class="brace">}</em>
<a id="L514" name="L514"></a> 514                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot</em>
<a id="L515" name="L515"></a> 515                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L516" name="L516"></a> 516                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L517" name="L517"></a> 517                         ++less;
<a id="L518" name="L518"></a> 518                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[great] == pivot</em>
<div class="comment">
                          Even though a[great] equals to pivot, the
                          assignment a[k] = pivot may be incorrect,
                          if a[great] and pivot are floating-point
                          zeros of different signs. Therefore in float
                          and double sorting methods we have to use
                          more accurate assignment a[k] = a[great].</div>
<a id="L527" name="L527"></a> 527                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = pivot;
<a id="L528" name="L528"></a> 528                     <em class="brace">}</em>
<a id="L529" name="L529"></a> 529                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L530" name="L530"></a> 530                     --great;
<a id="L531" name="L531"></a> 531                 <em class="brace">}</em>
<a id="L532" name="L532"></a> 532             <em class="brace">}</em>
<a id="L533" name="L533"></a> 533 
<div class="comment">
              Sort left and right parts recursively.
              All elements from center part are equal
              and, therefore, already sorted.</div>
<a id="L539" name="L539"></a> 539             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 1, leftmost);
<a id="L540" name="L540"></a> 540             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 1, right, <strong class="reserved">false</strong>);
<a id="L541" name="L541"></a> 541         <em class="brace">}</em>
<a id="L542" name="L542"></a> 542     <em class="brace">}</em>
<a id="L543" name="L543"></a> 543 
<div class="comment">
      Sorts the specified range of the array using the given
      workspace array slice if possible for merging
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L555" name="L555"></a> 555     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">long</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L556" name="L556"></a> 556                      <strong class="reserved">long</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L557" name="L557"></a> 557         <em class="comment">// Use Quicksort on small arrays</em>
<a id="L558" name="L558"></a> 558         <strong class="reserved">if</strong> (right - left &lt; QUICKSORT_THRESHOLD) <em class="brace">{</em>
<a id="L559" name="L559"></a> 559             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L560" name="L560"></a> 560             <strong class="reserved">return</strong>;
<a id="L561" name="L561"></a> 561         <em class="brace">}</em>
<a id="L562" name="L562"></a> 562 
<div class="comment">
          Index run[i] is the start of i-th run
          (ascending or descending sequence).</div>
<a id="L567" name="L567"></a> 567         <strong class="reserved">int</strong>[] <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[MAX_RUN_COUNT + 1];
<a id="L568" name="L568"></a> 568         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[0] = left;
<a id="L569" name="L569"></a> 569 
<a id="L570" name="L570"></a> 570         <em class="comment">// Check if the array is nearly sorted</em>
<a id="L571" name="L571"></a> 571         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; k &lt; right; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = k) <em class="brace">{</em>
<a id="L572" name="L572"></a> 572             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// ascending</em>
<a id="L573" name="L573"></a> 573                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L574" name="L574"></a> 574             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &gt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// descending</em>
<a id="L575" name="L575"></a> 575                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L576" name="L576"></a> 576                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] - 1, hi = k; ++lo &lt; --hi; ) <em class="brace">{</em>
<a id="L577" name="L577"></a> 577                     <strong class="reserved">long</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi] = t;
<a id="L578" name="L578"></a> 578                 <em class="brace">}</em>
<a id="L579" name="L579"></a> 579             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// equal</em>
<a id="L580" name="L580"></a> 580                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> m = MAX_RUN_LENGTH; ++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]; ) <em class="brace">{</em>
<a id="L581" name="L581"></a> 581                     <strong class="reserved">if</strong> (--m == 0) <em class="brace">{</em>
<a id="L582" name="L582"></a> 582                         <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L583" name="L583"></a> 583                         <strong class="reserved">return</strong>;
<a id="L584" name="L584"></a> 584                     <em class="brace">}</em>
<a id="L585" name="L585"></a> 585                 <em class="brace">}</em>
<a id="L586" name="L586"></a> 586             <em class="brace">}</em>
<a id="L587" name="L587"></a> 587 
<div class="comment">
              The array is not highly structured,
              use Quicksort instead of merge sort.</div>
<a id="L592" name="L592"></a> 592             <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == MAX_RUN_COUNT) <em class="brace">{</em>
<a id="L593" name="L593"></a> 593                 <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L594" name="L594"></a> 594                 <strong class="reserved">return</strong>;
<a id="L595" name="L595"></a> 595             <em class="brace">}</em>
<a id="L596" name="L596"></a> 596         <em class="brace">}</em>
<a id="L597" name="L597"></a> 597 
<a id="L598" name="L598"></a> 598         <em class="comment">// Check special cases</em>
<a id="L599" name="L599"></a> 599         <em class="comment">// Implementation note: variable "right" is increased by 1.</em>
<a id="L600" name="L600"></a> 600         <strong class="reserved">if</strong> (<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] == right++) <em class="brace">{</em> <em class="comment">// The last run contains one element</em>
<a id="L601" name="L601"></a> 601             <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = right;
<a id="L602" name="L602"></a> 602         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 1) <em class="brace">{</em> <em class="comment">// The array is already sorted</em>
<a id="L603" name="L603"></a> 603             <strong class="reserved">return</strong>;
<a id="L604" name="L604"></a> 604         <em class="brace">}</em>
<a id="L605" name="L605"></a> 605 
<a id="L606" name="L606"></a> 606         <em class="comment">// Determine alternation base for merge</em>
<a id="L607" name="L607"></a> 607         <strong class="reserved">byte</strong> odd = 0;
<a id="L608" name="L608"></a> 608         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> n = 1; (n &lt;&lt;= 1) &lt; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; odd ^= 1);
<a id="L609" name="L609"></a> 609 
<a id="L610" name="L610"></a> 610         <em class="comment">// Use or create temporary array b for merging</em>
<a id="L611" name="L611"></a> 611         <strong class="reserved">long</strong>[] b;                 <em class="comment">// temp array; alternates with a</em>
<a id="L612" name="L612"></a> 612         <strong class="reserved">int</strong> ao, bo;              <em class="comment">// array offsets from 'left'</em>
<a id="L613" name="L613"></a> 613         <strong class="reserved">int</strong> blen = right - left; <em class="comment">// space needed for b</em>
<a id="L614" name="L614"></a> 614         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; blen || workBase + blen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L615" name="L615"></a> 615             work = <strong class="reserved">new</strong> <strong class="reserved">long</strong>[blen];
<a id="L616" name="L616"></a> 616             workBase = 0;
<a id="L617" name="L617"></a> 617         <em class="brace">}</em>
<a id="L618" name="L618"></a> 618         <strong class="reserved">if</strong> (odd == 0) <em class="brace">{</em>
<a id="L619" name="L619"></a> 619             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, work, workBase, blen);
<a id="L620" name="L620"></a> 620             b = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L621" name="L621"></a> 621             bo = 0;
<a id="L622" name="L622"></a> 622             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = work;
<a id="L623" name="L623"></a> 623             ao = workBase - left;
<a id="L624" name="L624"></a> 624         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L625" name="L625"></a> 625             b = work;
<a id="L626" name="L626"></a> 626             ao = 0;
<a id="L627" name="L627"></a> 627             bo = workBase - left;
<a id="L628" name="L628"></a> 628         <em class="brace">}</em>
<a id="L629" name="L629"></a> 629 
<a id="L630" name="L630"></a> 630         <em class="comment">// Merging</em>
<a id="L631" name="L631"></a> 631         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 1; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>) <em class="brace">{</em>
<a id="L632" name="L632"></a> 632             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = 0) + 2; k &lt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; k += 2) <em class="brace">{</em>
<a id="L633" name="L633"></a> 633                 <strong class="reserved">int</strong> hi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k], mi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 1];
<a id="L634" name="L634"></a> 634                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 2], p = i, q = mi; i &lt; hi; ++i) <em class="brace">{</em>
<a id="L635" name="L635"></a> 635                     <strong class="reserved">if</strong> (q &gt;= hi || p &lt; mi &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p + ao] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q + ao]) <em class="brace">{</em>
<a id="L636" name="L636"></a> 636                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p++ + ao];
<a id="L637" name="L637"></a> 637                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L638" name="L638"></a> 638                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q++ + ao];
<a id="L639" name="L639"></a> 639                     <em class="brace">}</em>
<a id="L640" name="L640"></a> 640                 <em class="brace">}</em>
<a id="L641" name="L641"></a> 641                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = hi;
<a id="L642" name="L642"></a> 642             <em class="brace">}</em>
<a id="L643" name="L643"></a> 643             <strong class="reserved">if</strong> ((<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &amp; 1) != 0) <em class="brace">{</em>
<a id="L644" name="L644"></a> 644                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = right, lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - 1]; --i &gt;= lo;
<a id="L645" name="L645"></a> 645                     b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + ao]
<a id="L646" name="L646"></a> 646                 );
<a id="L647" name="L647"></a> 647                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = right;
<a id="L648" name="L648"></a> 648             <em class="brace">}</em>
<a id="L649" name="L649"></a> 649             <strong class="reserved">long</strong>[] t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = b; b = t;
<a id="L650" name="L650"></a> 650             <strong class="reserved">int</strong> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = ao; ao = bo; bo = <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L651" name="L651"></a> 651         <em class="brace">}</em>
<a id="L652" name="L652"></a> 652     <em class="brace">}</em>
<a id="L653" name="L653"></a> 653 
<div class="comment">
      Sorts the specified range of the array by Dual-Pivot Quicksort.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param leftmost indicates if this part is the leftmost in the range</div>
<a id="L662" name="L662"></a> 662     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">long</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right, <strong class="reserved">boolean</strong> leftmost) <em class="brace">{</em>
<a id="L663" name="L663"></a> 663         <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = right - left + 1;
<a id="L664" name="L664"></a> 664 
<a id="L665" name="L665"></a> 665         <em class="comment">// Use insertion sort on tiny arrays</em>
<a id="L666" name="L666"></a> 666         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; INSERTION_SORT_THRESHOLD) <em class="brace">{</em>
<a id="L667" name="L667"></a> 667             <strong class="reserved">if</strong> (leftmost) <em class="brace">{</em>
<div class="comment">
                  Traditional (without sentinel) insertion sort,
                  optimized for server VM, is used in case of
                  the leftmost part.</div>
<a id="L673" name="L673"></a> 673                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L674" name="L674"></a> 674                     <strong class="reserved">long</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L675" name="L675"></a> 675                     <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L676" name="L676"></a> 676                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L677" name="L677"></a> 677                         <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L678" name="L678"></a> 678                             <strong class="reserved">break</strong>;
<a id="L679" name="L679"></a> 679                         <em class="brace">}</em>
<a id="L680" name="L680"></a> 680                     <em class="brace">}</em>
<a id="L681" name="L681"></a> 681                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L682" name="L682"></a> 682                 <em class="brace">}</em>
<a id="L683" name="L683"></a> 683             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
                  Skip the longest ascending sequence.</div>
<a id="L687" name="L687"></a> 687                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L688" name="L688"></a> 688                     <strong class="reserved">if</strong> (left &gt;= right) <em class="brace">{</em>
<a id="L689" name="L689"></a> 689                         <strong class="reserved">return</strong>;
<a id="L690" name="L690"></a> 690                     <em class="brace">}</em>
<a id="L691" name="L691"></a> 691                 <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++left] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left - 1]);
<a id="L692" name="L692"></a> 692 
<div class="comment">
                  Every element from adjoining part plays the role
                  of sentinel, therefore this allows us to avoid the
                  left range check on each iteration. Moreover, we use
                  the more optimized algorithm, so called pair insertion
                  sort, which is faster (in the context of Quicksort)
                  than traditional implementation of insertion sort.</div>
<a id="L701" name="L701"></a> 701                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; ++left &lt;= right; k = ++left) <em class="brace">{</em>
<a id="L702" name="L702"></a> 702                     <strong class="reserved">long</strong> a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k], <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L703" name="L703"></a> 703 
<a id="L704" name="L704"></a> 704                     <strong class="reserved">if</strong> (a1 &lt; <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>) <em class="brace">{</em>
<a id="L705" name="L705"></a> 705                         <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = a1; a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L706" name="L706"></a> 706                     <em class="brace">}</em>
<a id="L707" name="L707"></a> 707                     <strong class="reserved">while</strong> (a1 &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L708" name="L708"></a> 708                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L709" name="L709"></a> 709                     <em class="brace">}</em>
<a id="L710" name="L710"></a> 710                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++k + 1] = a1;
<a id="L711" name="L711"></a> 711 
<a id="L712" name="L712"></a> 712                     <strong class="reserved">while</strong> (<a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L713" name="L713"></a> 713                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L714" name="L714"></a> 714                     <em class="brace">}</em>
<a id="L715" name="L715"></a> 715                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>;
<a id="L716" name="L716"></a> 716                 <em class="brace">}</em>
<a id="L717" name="L717"></a> 717                 <strong class="reserved">long</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L718" name="L718"></a> 718 
<a id="L719" name="L719"></a> 719                 <strong class="reserved">while</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--right]) <em class="brace">{</em>
<a id="L720" name="L720"></a> 720                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L721" name="L721"></a> 721                 <em class="brace">}</em>
<a id="L722" name="L722"></a> 722                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>;
<a id="L723" name="L723"></a> 723             <em class="brace">}</em>
<a id="L724" name="L724"></a> 724             <strong class="reserved">return</strong>;
<a id="L725" name="L725"></a> 725         <em class="brace">}</em>
<a id="L726" name="L726"></a> 726 
<a id="L727" name="L727"></a> 727         <em class="comment">// Inexpensive approximation of length / 7</em>
<a id="L728" name="L728"></a> 728         <strong class="reserved">int</strong> seventh = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 3) + (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 6) + 1;
<a id="L729" name="L729"></a> 729 
<div class="comment">
          Sort five evenly spaced elements around (and including) the
          center element in the range. These elements will be used for
          pivot selection as described below. The choice for spacing
          these elements was empirically determined to work well on
          a wide variety of inputs.</div>
<a id="L737" name="L737"></a> 737         <strong class="reserved">int</strong> e3 = (left + right) &gt;&gt;&gt; 1; <em class="comment">// The midpoint</em>
<a id="L738" name="L738"></a> 738         <strong class="reserved">int</strong> e2 = e3 - seventh;
<a id="L739" name="L739"></a> 739         <strong class="reserved">int</strong> e1 = e2 - seventh;
<a id="L740" name="L740"></a> 740         <strong class="reserved">int</strong> e4 = e3 + seventh;
<a id="L741" name="L741"></a> 741         <strong class="reserved">int</strong> e5 = e4 + seventh;
<a id="L742" name="L742"></a> 742 
<a id="L743" name="L743"></a> 743         <em class="comment">// Sort these elements using insertion sort</em>
<a id="L744" name="L744"></a> 744         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <strong class="reserved">long</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L745" name="L745"></a> 745 
<a id="L746" name="L746"></a> 746         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <strong class="reserved">long</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L747" name="L747"></a> 747             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L748" name="L748"></a> 748         <em class="brace">}</em>
<a id="L749" name="L749"></a> 749         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <strong class="reserved">long</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L750" name="L750"></a> 750             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L751" name="L751"></a> 751                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L752" name="L752"></a> 752             <em class="brace">}</em>
<a id="L753" name="L753"></a> 753         <em class="brace">}</em>
<a id="L754" name="L754"></a> 754         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]) <em class="brace">{</em> <strong class="reserved">long</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = t;
<a id="L755" name="L755"></a> 755             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L756" name="L756"></a> 756                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L757" name="L757"></a> 757                     <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L758" name="L758"></a> 758                 <em class="brace">}</em>
<a id="L759" name="L759"></a> 759             <em class="brace">}</em>
<a id="L760" name="L760"></a> 760         <em class="brace">}</em>
<a id="L761" name="L761"></a> 761 
<a id="L762" name="L762"></a> 762         <em class="comment">// Pointers</em>
<a id="L763" name="L763"></a> 763         <strong class="reserved">int</strong> less  = left;  <em class="comment">// The index of the first element of center part</em>
<a id="L764" name="L764"></a> 764         <strong class="reserved">int</strong> great = right; <em class="comment">// The index before the first element of right part</em>
<a id="L765" name="L765"></a> 765 
<a id="L766" name="L766"></a> 766         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]) <em class="brace">{</em>
<div class="comment">
              Use the second and fourth of the five sorted elements as pivots.
              These values are inexpensive approximations of the first and
              second terciles of the array. Note that pivot1 &lt;= pivot2.</div>
<a id="L772" name="L772"></a> 772             <strong class="reserved">long</strong> pivot1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2];
<a id="L773" name="L773"></a> 773             <strong class="reserved">long</strong> pivot2 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4];
<a id="L774" name="L774"></a> 774 
<div class="comment">
              The first and the last elements to be sorted are moved to the
              locations formerly occupied by the pivots. When partitioning
              is complete, the pivots are swapped back into their final
              positions, and excluded from subsequent sorting.</div>
<a id="L781" name="L781"></a> 781             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L782" name="L782"></a> 782             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L783" name="L783"></a> 783 
<div class="comment">
              Skip elements, which are less or greater than pivot values.</div>
<a id="L787" name="L787"></a> 787             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++less] &lt; pivot1);
<a id="L788" name="L788"></a> 788             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--great] &gt; pivot2);
<a id="L789" name="L789"></a> 789 
<div class="comment">
              Partitioning:
                left part           center part                   right part
              +--------------------------------------------------------------+
              |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  |
              +--------------------------------------------------------------+
                            ^                          ^       ^
                            |                          |       |
                           less                        k     great
              Invariants:
                           all in (left, less)   &lt; pivot1
                 pivot1 &lt;= all in [less, k)     &lt;= pivot2
                           all in (great, right) &gt; pivot2
              Pointer k is the first index of ?-part.</div>
<a id="L809" name="L809"></a> 809             outer:
<a id="L810" name="L810"></a> 810             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L811" name="L811"></a> 811                 <strong class="reserved">long</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L812" name="L812"></a> 812                 <strong class="reserved">if</strong> (ak &lt; pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L813" name="L813"></a> 813                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                      Here and below we use "a[i] = b; i++;" instead
                      of "a[i++] = b;" due to performance issue.</div>
<a id="L818" name="L818"></a> 818                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L819" name="L819"></a> 819                     ++less;
<a id="L820" name="L820"></a> 820                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak &gt; pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L821" name="L821"></a> 821                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot2) <em class="brace">{</em>
<a id="L822" name="L822"></a> 822                         <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L823" name="L823"></a> 823                             <strong class="reserved">break</strong> outer;
<a id="L824" name="L824"></a> 824                         <em class="brace">}</em>
<a id="L825" name="L825"></a> 825                     <em class="brace">}</em>
<a id="L826" name="L826"></a> 826                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot2</em>
<a id="L827" name="L827"></a> 827                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L828" name="L828"></a> 828                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L829" name="L829"></a> 829                         ++less;
<a id="L830" name="L830"></a> 830                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt;= a[great] &lt;= pivot2</em>
<a id="L831" name="L831"></a> 831                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L832" name="L832"></a> 832                     <em class="brace">}</em>
<div class="comment">
                      Here and below we use "a[i] = b; i--;" instead
                      of "a[i--] = b;" due to performance issue.</div>
<a id="L837" name="L837"></a> 837                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L838" name="L838"></a> 838                     --great;
<a id="L839" name="L839"></a> 839                 <em class="brace">}</em>
<a id="L840" name="L840"></a> 840             <em class="brace">}</em>
<a id="L841" name="L841"></a> 841 
<a id="L842" name="L842"></a> 842             <em class="comment">// Swap pivots into their final positions</em>
<a id="L843" name="L843"></a> 843             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]  = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1] = pivot1;
<a id="L844" name="L844"></a> 844             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1] = pivot2;
<a id="L845" name="L845"></a> 845 
<a id="L846" name="L846"></a> 846             <em class="comment">// Sort left and right parts recursively, excluding known pivots</em>
<a id="L847" name="L847"></a> 847             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 2, leftmost);
<a id="L848" name="L848"></a> 848             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 2, right, <strong class="reserved">false</strong>);
<a id="L849" name="L849"></a> 849 
<div class="comment">
              If center part is too large (comprises &gt; 4/7 of the array),
              swap internal pivot values to ends.</div>
<a id="L854" name="L854"></a> 854             <strong class="reserved">if</strong> (less &lt; e1 &amp;&amp; e5 &lt; great) <em class="brace">{</em>
<div class="comment">
                  Skip elements, which are equal to pivot values.</div>
<a id="L858" name="L858"></a> 858                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] == pivot1) <em class="brace">{</em>
<a id="L859" name="L859"></a> 859                     ++less;
<a id="L860" name="L860"></a> 860                 <em class="brace">}</em>
<a id="L861" name="L861"></a> 861 
<a id="L862" name="L862"></a> 862                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L863" name="L863"></a> 863                     --great;
<a id="L864" name="L864"></a> 864                 <em class="brace">}</em>
<a id="L865" name="L865"></a> 865 
<div class="comment">
                  Partitioning:
                    left part         center part                  right part
                  +----------------------------------------------------------+
                  | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |
                  +----------------------------------------------------------+
                               ^                        ^       ^
                               |                        |       |
                              less                      k     great
                  Invariants:
                               all in (*,  less) == pivot1
                      pivot1 &lt; all in [less,  k)  &lt; pivot2
                               all in (great, *) == pivot2
                  Pointer k is the first index of ?-part.</div>
<a id="L885" name="L885"></a> 885                 outer:
<a id="L886" name="L886"></a> 886                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L887" name="L887"></a> 887                     <strong class="reserved">long</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L888" name="L888"></a> 888                     <strong class="reserved">if</strong> (ak == pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L889" name="L889"></a> 889                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L890" name="L890"></a> 890                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L891" name="L891"></a> 891                         ++less;
<a id="L892" name="L892"></a> 892                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak == pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L893" name="L893"></a> 893                         <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L894" name="L894"></a> 894                             <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L895" name="L895"></a> 895                                 <strong class="reserved">break</strong> outer;
<a id="L896" name="L896"></a> 896                             <em class="brace">}</em>
<a id="L897" name="L897"></a> 897                         <em class="brace">}</em>
<a id="L898" name="L898"></a> 898                         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt; pivot2</em>
<a id="L899" name="L899"></a> 899                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                              Even though a[great] equals to pivot1, the
                              assignment a[less] = pivot1 may be incorrect,
                              if a[great] and pivot1 are floating-point zeros
                              of different signs. Therefore in float and
                              double sorting methods we have to use more
                              accurate assignment a[less] = a[great].</div>
<a id="L908" name="L908"></a> 908                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = pivot1;
<a id="L909" name="L909"></a> 909                             ++less;
<a id="L910" name="L910"></a> 910                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt; a[great] &lt; pivot2</em>
<a id="L911" name="L911"></a> 911                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L912" name="L912"></a> 912                         <em class="brace">}</em>
<a id="L913" name="L913"></a> 913                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L914" name="L914"></a> 914                         --great;
<a id="L915" name="L915"></a> 915                     <em class="brace">}</em>
<a id="L916" name="L916"></a> 916                 <em class="brace">}</em>
<a id="L917" name="L917"></a> 917             <em class="brace">}</em>
<a id="L918" name="L918"></a> 918 
<a id="L919" name="L919"></a> 919             <em class="comment">// Sort center part recursively</em>
<a id="L920" name="L920"></a> 920             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, less, great, <strong class="reserved">false</strong>);
<a id="L921" name="L921"></a> 921 
<a id="L922" name="L922"></a> 922         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Partitioning with one pivot</em>
<div class="comment">
              Use the third of the five sorted elements as pivot.
              This value is inexpensive approximation of the median.</div>
<a id="L927" name="L927"></a> 927             <strong class="reserved">long</strong> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3];
<a id="L928" name="L928"></a> 928 
<div class="comment">
              Partitioning degenerates to the traditional 3-way
              (or "Dutch National Flag") schema:
                left part    center part              right part
              +-------------------------------------------------+
              |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  |
              +-------------------------------------------------+
                           ^              ^        ^
                           |              |        |
                          less            k      great
              Invariants:
                all in (left, less)   &lt; pivot
                all in [less, k)     == pivot
                all in (great, right) &gt; pivot
              Pointer k is the first index of ?-part.</div>
<a id="L949" name="L949"></a> 949             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less; k &lt;= great; ++k) <em class="brace">{</em>
<a id="L950" name="L950"></a> 950                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] == pivot) <em class="brace">{</em>
<a id="L951" name="L951"></a> 951                     <strong class="reserved">continue</strong>;
<a id="L952" name="L952"></a> 952                 <em class="brace">}</em>
<a id="L953" name="L953"></a> 953                 <strong class="reserved">long</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L954" name="L954"></a> 954                 <strong class="reserved">if</strong> (ak &lt; pivot) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L955" name="L955"></a> 955                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L956" name="L956"></a> 956                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L957" name="L957"></a> 957                     ++less;
<a id="L958" name="L958"></a> 958                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[k] &gt; pivot - Move a[k] to right part</em>
<a id="L959" name="L959"></a> 959                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot) <em class="brace">{</em>
<a id="L960" name="L960"></a> 960                         --great;
<a id="L961" name="L961"></a> 961                     <em class="brace">}</em>
<a id="L962" name="L962"></a> 962                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot</em>
<a id="L963" name="L963"></a> 963                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L964" name="L964"></a> 964                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L965" name="L965"></a> 965                         ++less;
<a id="L966" name="L966"></a> 966                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[great] == pivot</em>
<div class="comment">
                          Even though a[great] equals to pivot, the
                          assignment a[k] = pivot may be incorrect,
                          if a[great] and pivot are floating-point
                          zeros of different signs. Therefore in float
                          and double sorting methods we have to use
                          more accurate assignment a[k] = a[great].</div>
<a id="L975" name="L975"></a> 975                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = pivot;
<a id="L976" name="L976"></a> 976                     <em class="brace">}</em>
<a id="L977" name="L977"></a> 977                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L978" name="L978"></a> 978                     --great;
<a id="L979" name="L979"></a> 979                 <em class="brace">}</em>
<a id="L980" name="L980"></a> 980             <em class="brace">}</em>
<a id="L981" name="L981"></a> 981 
<div class="comment">
              Sort left and right parts recursively.
              All elements from center part are equal
              and, therefore, already sorted.</div>
<a id="L987" name="L987"></a> 987             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 1, leftmost);
<a id="L988" name="L988"></a> 988             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 1, right, <strong class="reserved">false</strong>);
<a id="L989" name="L989"></a> 989         <em class="brace">}</em>
<a id="L990" name="L990"></a> 990     <em class="brace">}</em>
<a id="L991" name="L991"></a> 991 
<div class="comment">
      Sorts the specified range of the array using the given
      workspace array slice if possible for merging
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L1003" name="L1003"></a>1003     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">short</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L1004" name="L1004"></a>1004                      <strong class="reserved">short</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L1005" name="L1005"></a>1005         <em class="comment">// Use counting sort on large arrays</em>
<a id="L1006" name="L1006"></a>1006         <strong class="reserved">if</strong> (right - left &gt; COUNTING_SORT_THRESHOLD_FOR_SHORT_OR_CHAR) <em class="brace">{</em>
<a id="L1007" name="L1007"></a>1007             <strong class="reserved">int</strong>[] <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[NUM_SHORT_VALUES];
<a id="L1008" name="L1008"></a>1008 
<a id="L1009" name="L1009"></a>1009             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left - 1; ++i &lt;= right;
<a id="L1010" name="L1010"></a>1010                 <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i] - <a href="../S/1596.html#L43" title="Defined at 43 in src/java/lang/Short.java.">Short</a>.MIN_VALUE]++
<a id="L1011" name="L1011"></a>1011             );
<a id="L1012" name="L1012"></a>1012             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = NUM_SHORT_VALUES, k = right + 1; k &gt; left; ) <em class="brace">{</em>
<a id="L1013" name="L1013"></a>1013                 <strong class="reserved">while</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[--i] == 0);
<a id="L1014" name="L1014"></a>1014                 <strong class="reserved">short</strong> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = (<strong class="reserved">short</strong>) (i + <a href="../S/1596.html#L43" title="Defined at 43 in src/java/lang/Short.java.">Short</a>.MIN_VALUE);
<a id="L1015" name="L1015"></a>1015                 <strong class="reserved">int</strong> s = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[i];
<a id="L1016" name="L1016"></a>1016 
<a id="L1017" name="L1017"></a>1017                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1018" name="L1018"></a>1018                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k] = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L1019" name="L1019"></a>1019                 <em class="brace">}</em> <strong class="reserved">while</strong> (--s &gt; 0);
<a id="L1020" name="L1020"></a>1020             <em class="brace">}</em>
<a id="L1021" name="L1021"></a>1021         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Use Dual-Pivot Quicksort on small arrays</em>
<a id="L1022" name="L1022"></a>1022             <a href="../D/15089.html" title="Multiple defined in 4 places.">doSort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, work, workBase, workLen);
<a id="L1023" name="L1023"></a>1023         <em class="brace">}</em>
<a id="L1024" name="L1024"></a>1024     <em class="brace">}</em>
<a id="L1025" name="L1025"></a>1025 
<div class="comment">
     /** The number of distinct short values. */</div>
<a id="L1027" name="L1027"></a>1027     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> NUM_SHORT_VALUES = 1 &lt;&lt; 16;
<a id="L1028" name="L1028"></a>1028 
<div class="comment">
      Sorts the specified range of the array.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L1039" name="L1039"></a>1039     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/13449.html" title="Multiple referred from 4 places.">doSort</a>(<strong class="reserved">short</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L1040" name="L1040"></a>1040                                <strong class="reserved">short</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L1041" name="L1041"></a>1041         <em class="comment">// Use Quicksort on small arrays</em>
<a id="L1042" name="L1042"></a>1042         <strong class="reserved">if</strong> (right - left &lt; QUICKSORT_THRESHOLD) <em class="brace">{</em>
<a id="L1043" name="L1043"></a>1043             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L1044" name="L1044"></a>1044             <strong class="reserved">return</strong>;
<a id="L1045" name="L1045"></a>1045         <em class="brace">}</em>
<a id="L1046" name="L1046"></a>1046 
<div class="comment">
          Index run[i] is the start of i-th run
          (ascending or descending sequence).</div>
<a id="L1051" name="L1051"></a>1051         <strong class="reserved">int</strong>[] <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[MAX_RUN_COUNT + 1];
<a id="L1052" name="L1052"></a>1052         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[0] = left;
<a id="L1053" name="L1053"></a>1053 
<a id="L1054" name="L1054"></a>1054         <em class="comment">// Check if the array is nearly sorted</em>
<a id="L1055" name="L1055"></a>1055         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; k &lt; right; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = k) <em class="brace">{</em>
<a id="L1056" name="L1056"></a>1056             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// ascending</em>
<a id="L1057" name="L1057"></a>1057                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L1058" name="L1058"></a>1058             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &gt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// descending</em>
<a id="L1059" name="L1059"></a>1059                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L1060" name="L1060"></a>1060                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] - 1, hi = k; ++lo &lt; --hi; ) <em class="brace">{</em>
<a id="L1061" name="L1061"></a>1061                     <strong class="reserved">short</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi] = t;
<a id="L1062" name="L1062"></a>1062                 <em class="brace">}</em>
<a id="L1063" name="L1063"></a>1063             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// equal</em>
<a id="L1064" name="L1064"></a>1064                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> m = MAX_RUN_LENGTH; ++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]; ) <em class="brace">{</em>
<a id="L1065" name="L1065"></a>1065                     <strong class="reserved">if</strong> (--m == 0) <em class="brace">{</em>
<a id="L1066" name="L1066"></a>1066                         <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L1067" name="L1067"></a>1067                         <strong class="reserved">return</strong>;
<a id="L1068" name="L1068"></a>1068                     <em class="brace">}</em>
<a id="L1069" name="L1069"></a>1069                 <em class="brace">}</em>
<a id="L1070" name="L1070"></a>1070             <em class="brace">}</em>
<a id="L1071" name="L1071"></a>1071 
<div class="comment">
              The array is not highly structured,
              use Quicksort instead of merge sort.</div>
<a id="L1076" name="L1076"></a>1076             <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == MAX_RUN_COUNT) <em class="brace">{</em>
<a id="L1077" name="L1077"></a>1077                 <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L1078" name="L1078"></a>1078                 <strong class="reserved">return</strong>;
<a id="L1079" name="L1079"></a>1079             <em class="brace">}</em>
<a id="L1080" name="L1080"></a>1080         <em class="brace">}</em>
<a id="L1081" name="L1081"></a>1081 
<a id="L1082" name="L1082"></a>1082         <em class="comment">// Check special cases</em>
<a id="L1083" name="L1083"></a>1083         <em class="comment">// Implementation note: variable "right" is increased by 1.</em>
<a id="L1084" name="L1084"></a>1084         <strong class="reserved">if</strong> (<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] == right++) <em class="brace">{</em> <em class="comment">// The last run contains one element</em>
<a id="L1085" name="L1085"></a>1085             <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = right;
<a id="L1086" name="L1086"></a>1086         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 1) <em class="brace">{</em> <em class="comment">// The array is already sorted</em>
<a id="L1087" name="L1087"></a>1087             <strong class="reserved">return</strong>;
<a id="L1088" name="L1088"></a>1088         <em class="brace">}</em>
<a id="L1089" name="L1089"></a>1089 
<a id="L1090" name="L1090"></a>1090         <em class="comment">// Determine alternation base for merge</em>
<a id="L1091" name="L1091"></a>1091         <strong class="reserved">byte</strong> odd = 0;
<a id="L1092" name="L1092"></a>1092         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> n = 1; (n &lt;&lt;= 1) &lt; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; odd ^= 1);
<a id="L1093" name="L1093"></a>1093 
<a id="L1094" name="L1094"></a>1094         <em class="comment">// Use or create temporary array b for merging</em>
<a id="L1095" name="L1095"></a>1095         <strong class="reserved">short</strong>[] b;                 <em class="comment">// temp array; alternates with a</em>
<a id="L1096" name="L1096"></a>1096         <strong class="reserved">int</strong> ao, bo;              <em class="comment">// array offsets from 'left'</em>
<a id="L1097" name="L1097"></a>1097         <strong class="reserved">int</strong> blen = right - left; <em class="comment">// space needed for b</em>
<a id="L1098" name="L1098"></a>1098         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; blen || workBase + blen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L1099" name="L1099"></a>1099             work = <strong class="reserved">new</strong> <strong class="reserved">short</strong>[blen];
<a id="L1100" name="L1100"></a>1100             workBase = 0;
<a id="L1101" name="L1101"></a>1101         <em class="brace">}</em>
<a id="L1102" name="L1102"></a>1102         <strong class="reserved">if</strong> (odd == 0) <em class="brace">{</em>
<a id="L1103" name="L1103"></a>1103             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, work, workBase, blen);
<a id="L1104" name="L1104"></a>1104             b = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L1105" name="L1105"></a>1105             bo = 0;
<a id="L1106" name="L1106"></a>1106             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = work;
<a id="L1107" name="L1107"></a>1107             ao = workBase - left;
<a id="L1108" name="L1108"></a>1108         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1109" name="L1109"></a>1109             b = work;
<a id="L1110" name="L1110"></a>1110             ao = 0;
<a id="L1111" name="L1111"></a>1111             bo = workBase - left;
<a id="L1112" name="L1112"></a>1112         <em class="brace">}</em>
<a id="L1113" name="L1113"></a>1113 
<a id="L1114" name="L1114"></a>1114         <em class="comment">// Merging</em>
<a id="L1115" name="L1115"></a>1115         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 1; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>) <em class="brace">{</em>
<a id="L1116" name="L1116"></a>1116             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = 0) + 2; k &lt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; k += 2) <em class="brace">{</em>
<a id="L1117" name="L1117"></a>1117                 <strong class="reserved">int</strong> hi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k], mi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 1];
<a id="L1118" name="L1118"></a>1118                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 2], p = i, q = mi; i &lt; hi; ++i) <em class="brace">{</em>
<a id="L1119" name="L1119"></a>1119                     <strong class="reserved">if</strong> (q &gt;= hi || p &lt; mi &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p + ao] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q + ao]) <em class="brace">{</em>
<a id="L1120" name="L1120"></a>1120                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p++ + ao];
<a id="L1121" name="L1121"></a>1121                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1122" name="L1122"></a>1122                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q++ + ao];
<a id="L1123" name="L1123"></a>1123                     <em class="brace">}</em>
<a id="L1124" name="L1124"></a>1124                 <em class="brace">}</em>
<a id="L1125" name="L1125"></a>1125                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = hi;
<a id="L1126" name="L1126"></a>1126             <em class="brace">}</em>
<a id="L1127" name="L1127"></a>1127             <strong class="reserved">if</strong> ((<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &amp; 1) != 0) <em class="brace">{</em>
<a id="L1128" name="L1128"></a>1128                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = right, lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - 1]; --i &gt;= lo;
<a id="L1129" name="L1129"></a>1129                     b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + ao]
<a id="L1130" name="L1130"></a>1130                 );
<a id="L1131" name="L1131"></a>1131                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = right;
<a id="L1132" name="L1132"></a>1132             <em class="brace">}</em>
<a id="L1133" name="L1133"></a>1133             <strong class="reserved">short</strong>[] t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = b; b = t;
<a id="L1134" name="L1134"></a>1134             <strong class="reserved">int</strong> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = ao; ao = bo; bo = <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L1135" name="L1135"></a>1135         <em class="brace">}</em>
<a id="L1136" name="L1136"></a>1136     <em class="brace">}</em>
<a id="L1137" name="L1137"></a>1137 
<div class="comment">
      Sorts the specified range of the array by Dual-Pivot Quicksort.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param leftmost indicates if this part is the leftmost in the range</div>
<a id="L1146" name="L1146"></a>1146     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">short</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right, <strong class="reserved">boolean</strong> leftmost) <em class="brace">{</em>
<a id="L1147" name="L1147"></a>1147         <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = right - left + 1;
<a id="L1148" name="L1148"></a>1148 
<a id="L1149" name="L1149"></a>1149         <em class="comment">// Use insertion sort on tiny arrays</em>
<a id="L1150" name="L1150"></a>1150         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; INSERTION_SORT_THRESHOLD) <em class="brace">{</em>
<a id="L1151" name="L1151"></a>1151             <strong class="reserved">if</strong> (leftmost) <em class="brace">{</em>
<div class="comment">
                  Traditional (without sentinel) insertion sort,
                  optimized for server VM, is used in case of
                  the leftmost part.</div>
<a id="L1157" name="L1157"></a>1157                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L1158" name="L1158"></a>1158                     <strong class="reserved">short</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L1159" name="L1159"></a>1159                     <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L1160" name="L1160"></a>1160                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L1161" name="L1161"></a>1161                         <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L1162" name="L1162"></a>1162                             <strong class="reserved">break</strong>;
<a id="L1163" name="L1163"></a>1163                         <em class="brace">}</em>
<a id="L1164" name="L1164"></a>1164                     <em class="brace">}</em>
<a id="L1165" name="L1165"></a>1165                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L1166" name="L1166"></a>1166                 <em class="brace">}</em>
<a id="L1167" name="L1167"></a>1167             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
                  Skip the longest ascending sequence.</div>
<a id="L1171" name="L1171"></a>1171                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1172" name="L1172"></a>1172                     <strong class="reserved">if</strong> (left &gt;= right) <em class="brace">{</em>
<a id="L1173" name="L1173"></a>1173                         <strong class="reserved">return</strong>;
<a id="L1174" name="L1174"></a>1174                     <em class="brace">}</em>
<a id="L1175" name="L1175"></a>1175                 <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++left] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left - 1]);
<a id="L1176" name="L1176"></a>1176 
<div class="comment">
                  Every element from adjoining part plays the role
                  of sentinel, therefore this allows us to avoid the
                  left range check on each iteration. Moreover, we use
                  the more optimized algorithm, so called pair insertion
                  sort, which is faster (in the context of Quicksort)
                  than traditional implementation of insertion sort.</div>
<a id="L1185" name="L1185"></a>1185                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; ++left &lt;= right; k = ++left) <em class="brace">{</em>
<a id="L1186" name="L1186"></a>1186                     <strong class="reserved">short</strong> a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k], <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L1187" name="L1187"></a>1187 
<a id="L1188" name="L1188"></a>1188                     <strong class="reserved">if</strong> (a1 &lt; <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>) <em class="brace">{</em>
<a id="L1189" name="L1189"></a>1189                         <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = a1; a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L1190" name="L1190"></a>1190                     <em class="brace">}</em>
<a id="L1191" name="L1191"></a>1191                     <strong class="reserved">while</strong> (a1 &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L1192" name="L1192"></a>1192                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1193" name="L1193"></a>1193                     <em class="brace">}</em>
<a id="L1194" name="L1194"></a>1194                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++k + 1] = a1;
<a id="L1195" name="L1195"></a>1195 
<a id="L1196" name="L1196"></a>1196                     <strong class="reserved">while</strong> (<a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L1197" name="L1197"></a>1197                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1198" name="L1198"></a>1198                     <em class="brace">}</em>
<a id="L1199" name="L1199"></a>1199                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>;
<a id="L1200" name="L1200"></a>1200                 <em class="brace">}</em>
<a id="L1201" name="L1201"></a>1201                 <strong class="reserved">short</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L1202" name="L1202"></a>1202 
<a id="L1203" name="L1203"></a>1203                 <strong class="reserved">while</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--right]) <em class="brace">{</em>
<a id="L1204" name="L1204"></a>1204                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L1205" name="L1205"></a>1205                 <em class="brace">}</em>
<a id="L1206" name="L1206"></a>1206                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>;
<a id="L1207" name="L1207"></a>1207             <em class="brace">}</em>
<a id="L1208" name="L1208"></a>1208             <strong class="reserved">return</strong>;
<a id="L1209" name="L1209"></a>1209         <em class="brace">}</em>
<a id="L1210" name="L1210"></a>1210 
<a id="L1211" name="L1211"></a>1211         <em class="comment">// Inexpensive approximation of length / 7</em>
<a id="L1212" name="L1212"></a>1212         <strong class="reserved">int</strong> seventh = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 3) + (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 6) + 1;
<a id="L1213" name="L1213"></a>1213 
<div class="comment">
          Sort five evenly spaced elements around (and including) the
          center element in the range. These elements will be used for
          pivot selection as described below. The choice for spacing
          these elements was empirically determined to work well on
          a wide variety of inputs.</div>
<a id="L1221" name="L1221"></a>1221         <strong class="reserved">int</strong> e3 = (left + right) &gt;&gt;&gt; 1; <em class="comment">// The midpoint</em>
<a id="L1222" name="L1222"></a>1222         <strong class="reserved">int</strong> e2 = e3 - seventh;
<a id="L1223" name="L1223"></a>1223         <strong class="reserved">int</strong> e1 = e2 - seventh;
<a id="L1224" name="L1224"></a>1224         <strong class="reserved">int</strong> e4 = e3 + seventh;
<a id="L1225" name="L1225"></a>1225         <strong class="reserved">int</strong> e5 = e4 + seventh;
<a id="L1226" name="L1226"></a>1226 
<a id="L1227" name="L1227"></a>1227         <em class="comment">// Sort these elements using insertion sort</em>
<a id="L1228" name="L1228"></a>1228         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <strong class="reserved">short</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1229" name="L1229"></a>1229 
<a id="L1230" name="L1230"></a>1230         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <strong class="reserved">short</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L1231" name="L1231"></a>1231             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1232" name="L1232"></a>1232         <em class="brace">}</em>
<a id="L1233" name="L1233"></a>1233         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <strong class="reserved">short</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L1234" name="L1234"></a>1234             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L1235" name="L1235"></a>1235                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1236" name="L1236"></a>1236             <em class="brace">}</em>
<a id="L1237" name="L1237"></a>1237         <em class="brace">}</em>
<a id="L1238" name="L1238"></a>1238         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]) <em class="brace">{</em> <strong class="reserved">short</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = t;
<a id="L1239" name="L1239"></a>1239             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L1240" name="L1240"></a>1240                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L1241" name="L1241"></a>1241                     <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1242" name="L1242"></a>1242                 <em class="brace">}</em>
<a id="L1243" name="L1243"></a>1243             <em class="brace">}</em>
<a id="L1244" name="L1244"></a>1244         <em class="brace">}</em>
<a id="L1245" name="L1245"></a>1245 
<a id="L1246" name="L1246"></a>1246         <em class="comment">// Pointers</em>
<a id="L1247" name="L1247"></a>1247         <strong class="reserved">int</strong> less  = left;  <em class="comment">// The index of the first element of center part</em>
<a id="L1248" name="L1248"></a>1248         <strong class="reserved">int</strong> great = right; <em class="comment">// The index before the first element of right part</em>
<a id="L1249" name="L1249"></a>1249 
<a id="L1250" name="L1250"></a>1250         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]) <em class="brace">{</em>
<div class="comment">
              Use the second and fourth of the five sorted elements as pivots.
              These values are inexpensive approximations of the first and
              second terciles of the array. Note that pivot1 &lt;= pivot2.</div>
<a id="L1256" name="L1256"></a>1256             <strong class="reserved">short</strong> pivot1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2];
<a id="L1257" name="L1257"></a>1257             <strong class="reserved">short</strong> pivot2 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4];
<a id="L1258" name="L1258"></a>1258 
<div class="comment">
              The first and the last elements to be sorted are moved to the
              locations formerly occupied by the pivots. When partitioning
              is complete, the pivots are swapped back into their final
              positions, and excluded from subsequent sorting.</div>
<a id="L1265" name="L1265"></a>1265             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L1266" name="L1266"></a>1266             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L1267" name="L1267"></a>1267 
<div class="comment">
              Skip elements, which are less or greater than pivot values.</div>
<a id="L1271" name="L1271"></a>1271             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++less] &lt; pivot1);
<a id="L1272" name="L1272"></a>1272             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--great] &gt; pivot2);
<a id="L1273" name="L1273"></a>1273 
<div class="comment">
              Partitioning:
                left part           center part                   right part
              +--------------------------------------------------------------+
              |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  |
              +--------------------------------------------------------------+
                            ^                          ^       ^
                            |                          |       |
                           less                        k     great
              Invariants:
                           all in (left, less)   &lt; pivot1
                 pivot1 &lt;= all in [less, k)     &lt;= pivot2
                           all in (great, right) &gt; pivot2
              Pointer k is the first index of ?-part.</div>
<a id="L1293" name="L1293"></a>1293             outer:
<a id="L1294" name="L1294"></a>1294             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L1295" name="L1295"></a>1295                 <strong class="reserved">short</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1296" name="L1296"></a>1296                 <strong class="reserved">if</strong> (ak &lt; pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L1297" name="L1297"></a>1297                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                      Here and below we use "a[i] = b; i++;" instead
                      of "a[i++] = b;" due to performance issue.</div>
<a id="L1302" name="L1302"></a>1302                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L1303" name="L1303"></a>1303                     ++less;
<a id="L1304" name="L1304"></a>1304                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak &gt; pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L1305" name="L1305"></a>1305                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot2) <em class="brace">{</em>
<a id="L1306" name="L1306"></a>1306                         <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L1307" name="L1307"></a>1307                             <strong class="reserved">break</strong> outer;
<a id="L1308" name="L1308"></a>1308                         <em class="brace">}</em>
<a id="L1309" name="L1309"></a>1309                     <em class="brace">}</em>
<a id="L1310" name="L1310"></a>1310                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot2</em>
<a id="L1311" name="L1311"></a>1311                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1312" name="L1312"></a>1312                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1313" name="L1313"></a>1313                         ++less;
<a id="L1314" name="L1314"></a>1314                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt;= a[great] &lt;= pivot2</em>
<a id="L1315" name="L1315"></a>1315                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1316" name="L1316"></a>1316                     <em class="brace">}</em>
<div class="comment">
                      Here and below we use "a[i] = b; i--;" instead
                      of "a[i--] = b;" due to performance issue.</div>
<a id="L1321" name="L1321"></a>1321                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L1322" name="L1322"></a>1322                     --great;
<a id="L1323" name="L1323"></a>1323                 <em class="brace">}</em>
<a id="L1324" name="L1324"></a>1324             <em class="brace">}</em>
<a id="L1325" name="L1325"></a>1325 
<a id="L1326" name="L1326"></a>1326             <em class="comment">// Swap pivots into their final positions</em>
<a id="L1327" name="L1327"></a>1327             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]  = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1] = pivot1;
<a id="L1328" name="L1328"></a>1328             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1] = pivot2;
<a id="L1329" name="L1329"></a>1329 
<a id="L1330" name="L1330"></a>1330             <em class="comment">// Sort left and right parts recursively, excluding known pivots</em>
<a id="L1331" name="L1331"></a>1331             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 2, leftmost);
<a id="L1332" name="L1332"></a>1332             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 2, right, <strong class="reserved">false</strong>);
<a id="L1333" name="L1333"></a>1333 
<div class="comment">
              If center part is too large (comprises &gt; 4/7 of the array),
              swap internal pivot values to ends.</div>
<a id="L1338" name="L1338"></a>1338             <strong class="reserved">if</strong> (less &lt; e1 &amp;&amp; e5 &lt; great) <em class="brace">{</em>
<div class="comment">
                  Skip elements, which are equal to pivot values.</div>
<a id="L1342" name="L1342"></a>1342                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] == pivot1) <em class="brace">{</em>
<a id="L1343" name="L1343"></a>1343                     ++less;
<a id="L1344" name="L1344"></a>1344                 <em class="brace">}</em>
<a id="L1345" name="L1345"></a>1345 
<a id="L1346" name="L1346"></a>1346                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L1347" name="L1347"></a>1347                     --great;
<a id="L1348" name="L1348"></a>1348                 <em class="brace">}</em>
<a id="L1349" name="L1349"></a>1349 
<div class="comment">
                  Partitioning:
                    left part         center part                  right part
                  +----------------------------------------------------------+
                  | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |
                  +----------------------------------------------------------+
                               ^                        ^       ^
                               |                        |       |
                              less                      k     great
                  Invariants:
                               all in (*,  less) == pivot1
                      pivot1 &lt; all in [less,  k)  &lt; pivot2
                               all in (great, *) == pivot2
                  Pointer k is the first index of ?-part.</div>
<a id="L1369" name="L1369"></a>1369                 outer:
<a id="L1370" name="L1370"></a>1370                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L1371" name="L1371"></a>1371                     <strong class="reserved">short</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1372" name="L1372"></a>1372                     <strong class="reserved">if</strong> (ak == pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L1373" name="L1373"></a>1373                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1374" name="L1374"></a>1374                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L1375" name="L1375"></a>1375                         ++less;
<a id="L1376" name="L1376"></a>1376                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak == pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L1377" name="L1377"></a>1377                         <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L1378" name="L1378"></a>1378                             <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L1379" name="L1379"></a>1379                                 <strong class="reserved">break</strong> outer;
<a id="L1380" name="L1380"></a>1380                             <em class="brace">}</em>
<a id="L1381" name="L1381"></a>1381                         <em class="brace">}</em>
<a id="L1382" name="L1382"></a>1382                         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt; pivot2</em>
<a id="L1383" name="L1383"></a>1383                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                              Even though a[great] equals to pivot1, the
                              assignment a[less] = pivot1 may be incorrect,
                              if a[great] and pivot1 are floating-point zeros
                              of different signs. Therefore in float and
                              double sorting methods we have to use more
                              accurate assignment a[less] = a[great].</div>
<a id="L1392" name="L1392"></a>1392                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = pivot1;
<a id="L1393" name="L1393"></a>1393                             ++less;
<a id="L1394" name="L1394"></a>1394                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt; a[great] &lt; pivot2</em>
<a id="L1395" name="L1395"></a>1395                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1396" name="L1396"></a>1396                         <em class="brace">}</em>
<a id="L1397" name="L1397"></a>1397                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L1398" name="L1398"></a>1398                         --great;
<a id="L1399" name="L1399"></a>1399                     <em class="brace">}</em>
<a id="L1400" name="L1400"></a>1400                 <em class="brace">}</em>
<a id="L1401" name="L1401"></a>1401             <em class="brace">}</em>
<a id="L1402" name="L1402"></a>1402 
<a id="L1403" name="L1403"></a>1403             <em class="comment">// Sort center part recursively</em>
<a id="L1404" name="L1404"></a>1404             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, less, great, <strong class="reserved">false</strong>);
<a id="L1405" name="L1405"></a>1405 
<a id="L1406" name="L1406"></a>1406         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Partitioning with one pivot</em>
<div class="comment">
              Use the third of the five sorted elements as pivot.
              This value is inexpensive approximation of the median.</div>
<a id="L1411" name="L1411"></a>1411             <strong class="reserved">short</strong> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3];
<a id="L1412" name="L1412"></a>1412 
<div class="comment">
              Partitioning degenerates to the traditional 3-way
              (or "Dutch National Flag") schema:
                left part    center part              right part
              +-------------------------------------------------+
              |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  |
              +-------------------------------------------------+
                           ^              ^        ^
                           |              |        |
                          less            k      great
              Invariants:
                all in (left, less)   &lt; pivot
                all in [less, k)     == pivot
                all in (great, right) &gt; pivot
              Pointer k is the first index of ?-part.</div>
<a id="L1433" name="L1433"></a>1433             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less; k &lt;= great; ++k) <em class="brace">{</em>
<a id="L1434" name="L1434"></a>1434                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] == pivot) <em class="brace">{</em>
<a id="L1435" name="L1435"></a>1435                     <strong class="reserved">continue</strong>;
<a id="L1436" name="L1436"></a>1436                 <em class="brace">}</em>
<a id="L1437" name="L1437"></a>1437                 <strong class="reserved">short</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1438" name="L1438"></a>1438                 <strong class="reserved">if</strong> (ak &lt; pivot) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L1439" name="L1439"></a>1439                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1440" name="L1440"></a>1440                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L1441" name="L1441"></a>1441                     ++less;
<a id="L1442" name="L1442"></a>1442                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[k] &gt; pivot - Move a[k] to right part</em>
<a id="L1443" name="L1443"></a>1443                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot) <em class="brace">{</em>
<a id="L1444" name="L1444"></a>1444                         --great;
<a id="L1445" name="L1445"></a>1445                     <em class="brace">}</em>
<a id="L1446" name="L1446"></a>1446                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot</em>
<a id="L1447" name="L1447"></a>1447                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1448" name="L1448"></a>1448                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1449" name="L1449"></a>1449                         ++less;
<a id="L1450" name="L1450"></a>1450                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[great] == pivot</em>
<div class="comment">
                          Even though a[great] equals to pivot, the
                          assignment a[k] = pivot may be incorrect,
                          if a[great] and pivot are floating-point
                          zeros of different signs. Therefore in float
                          and double sorting methods we have to use
                          more accurate assignment a[k] = a[great].</div>
<a id="L1459" name="L1459"></a>1459                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = pivot;
<a id="L1460" name="L1460"></a>1460                     <em class="brace">}</em>
<a id="L1461" name="L1461"></a>1461                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L1462" name="L1462"></a>1462                     --great;
<a id="L1463" name="L1463"></a>1463                 <em class="brace">}</em>
<a id="L1464" name="L1464"></a>1464             <em class="brace">}</em>
<a id="L1465" name="L1465"></a>1465 
<div class="comment">
              Sort left and right parts recursively.
              All elements from center part are equal
              and, therefore, already sorted.</div>
<a id="L1471" name="L1471"></a>1471             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 1, leftmost);
<a id="L1472" name="L1472"></a>1472             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 1, right, <strong class="reserved">false</strong>);
<a id="L1473" name="L1473"></a>1473         <em class="brace">}</em>
<a id="L1474" name="L1474"></a>1474     <em class="brace">}</em>
<a id="L1475" name="L1475"></a>1475 
<div class="comment">
      Sorts the specified range of the array using the given
      workspace array slice if possible for merging
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L1487" name="L1487"></a>1487     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">char</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L1488" name="L1488"></a>1488                      <strong class="reserved">char</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L1489" name="L1489"></a>1489         <em class="comment">// Use counting sort on large arrays</em>
<a id="L1490" name="L1490"></a>1490         <strong class="reserved">if</strong> (right - left &gt; COUNTING_SORT_THRESHOLD_FOR_SHORT_OR_CHAR) <em class="brace">{</em>
<a id="L1491" name="L1491"></a>1491             <strong class="reserved">int</strong>[] <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[NUM_CHAR_VALUES];
<a id="L1492" name="L1492"></a>1492 
<a id="L1493" name="L1493"></a>1493             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left - 1; ++i &lt;= right;
<a id="L1494" name="L1494"></a>1494                 <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i]]++
<a id="L1495" name="L1495"></a>1495             );
<a id="L1496" name="L1496"></a>1496             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = NUM_CHAR_VALUES, k = right + 1; k &gt; left; ) <em class="brace">{</em>
<a id="L1497" name="L1497"></a>1497                 <strong class="reserved">while</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[--i] == 0);
<a id="L1498" name="L1498"></a>1498                 <strong class="reserved">char</strong> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = (<strong class="reserved">char</strong>) i;
<a id="L1499" name="L1499"></a>1499                 <strong class="reserved">int</strong> s = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[i];
<a id="L1500" name="L1500"></a>1500 
<a id="L1501" name="L1501"></a>1501                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1502" name="L1502"></a>1502                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k] = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L1503" name="L1503"></a>1503                 <em class="brace">}</em> <strong class="reserved">while</strong> (--s &gt; 0);
<a id="L1504" name="L1504"></a>1504             <em class="brace">}</em>
<a id="L1505" name="L1505"></a>1505         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Use Dual-Pivot Quicksort on small arrays</em>
<a id="L1506" name="L1506"></a>1506             <a href="../D/15089.html" title="Multiple defined in 4 places.">doSort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, work, workBase, workLen);
<a id="L1507" name="L1507"></a>1507         <em class="brace">}</em>
<a id="L1508" name="L1508"></a>1508     <em class="brace">}</em>
<a id="L1509" name="L1509"></a>1509 
<div class="comment">
     /** The number of distinct char values. */</div>
<a id="L1511" name="L1511"></a>1511     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> NUM_CHAR_VALUES = 1 &lt;&lt; 16;
<a id="L1512" name="L1512"></a>1512 
<div class="comment">
      Sorts the specified range of the array.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L1523" name="L1523"></a>1523     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/13449.html" title="Multiple referred from 4 places.">doSort</a>(<strong class="reserved">char</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L1524" name="L1524"></a>1524                                <strong class="reserved">char</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L1525" name="L1525"></a>1525         <em class="comment">// Use Quicksort on small arrays</em>
<a id="L1526" name="L1526"></a>1526         <strong class="reserved">if</strong> (right - left &lt; QUICKSORT_THRESHOLD) <em class="brace">{</em>
<a id="L1527" name="L1527"></a>1527             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L1528" name="L1528"></a>1528             <strong class="reserved">return</strong>;
<a id="L1529" name="L1529"></a>1529         <em class="brace">}</em>
<a id="L1530" name="L1530"></a>1530 
<div class="comment">
          Index run[i] is the start of i-th run
          (ascending or descending sequence).</div>
<a id="L1535" name="L1535"></a>1535         <strong class="reserved">int</strong>[] <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[MAX_RUN_COUNT + 1];
<a id="L1536" name="L1536"></a>1536         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[0] = left;
<a id="L1537" name="L1537"></a>1537 
<a id="L1538" name="L1538"></a>1538         <em class="comment">// Check if the array is nearly sorted</em>
<a id="L1539" name="L1539"></a>1539         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; k &lt; right; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = k) <em class="brace">{</em>
<a id="L1540" name="L1540"></a>1540             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// ascending</em>
<a id="L1541" name="L1541"></a>1541                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L1542" name="L1542"></a>1542             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &gt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// descending</em>
<a id="L1543" name="L1543"></a>1543                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L1544" name="L1544"></a>1544                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] - 1, hi = k; ++lo &lt; --hi; ) <em class="brace">{</em>
<a id="L1545" name="L1545"></a>1545                     <strong class="reserved">char</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi] = t;
<a id="L1546" name="L1546"></a>1546                 <em class="brace">}</em>
<a id="L1547" name="L1547"></a>1547             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// equal</em>
<a id="L1548" name="L1548"></a>1548                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> m = MAX_RUN_LENGTH; ++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]; ) <em class="brace">{</em>
<a id="L1549" name="L1549"></a>1549                     <strong class="reserved">if</strong> (--m == 0) <em class="brace">{</em>
<a id="L1550" name="L1550"></a>1550                         <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L1551" name="L1551"></a>1551                         <strong class="reserved">return</strong>;
<a id="L1552" name="L1552"></a>1552                     <em class="brace">}</em>
<a id="L1553" name="L1553"></a>1553                 <em class="brace">}</em>
<a id="L1554" name="L1554"></a>1554             <em class="brace">}</em>
<a id="L1555" name="L1555"></a>1555 
<div class="comment">
              The array is not highly structured,
              use Quicksort instead of merge sort.</div>
<a id="L1560" name="L1560"></a>1560             <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == MAX_RUN_COUNT) <em class="brace">{</em>
<a id="L1561" name="L1561"></a>1561                 <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L1562" name="L1562"></a>1562                 <strong class="reserved">return</strong>;
<a id="L1563" name="L1563"></a>1563             <em class="brace">}</em>
<a id="L1564" name="L1564"></a>1564         <em class="brace">}</em>
<a id="L1565" name="L1565"></a>1565 
<a id="L1566" name="L1566"></a>1566         <em class="comment">// Check special cases</em>
<a id="L1567" name="L1567"></a>1567         <em class="comment">// Implementation note: variable "right" is increased by 1.</em>
<a id="L1568" name="L1568"></a>1568         <strong class="reserved">if</strong> (<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] == right++) <em class="brace">{</em> <em class="comment">// The last run contains one element</em>
<a id="L1569" name="L1569"></a>1569             <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = right;
<a id="L1570" name="L1570"></a>1570         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 1) <em class="brace">{</em> <em class="comment">// The array is already sorted</em>
<a id="L1571" name="L1571"></a>1571             <strong class="reserved">return</strong>;
<a id="L1572" name="L1572"></a>1572         <em class="brace">}</em>
<a id="L1573" name="L1573"></a>1573 
<a id="L1574" name="L1574"></a>1574         <em class="comment">// Determine alternation base for merge</em>
<a id="L1575" name="L1575"></a>1575         <strong class="reserved">byte</strong> odd = 0;
<a id="L1576" name="L1576"></a>1576         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> n = 1; (n &lt;&lt;= 1) &lt; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; odd ^= 1);
<a id="L1577" name="L1577"></a>1577 
<a id="L1578" name="L1578"></a>1578         <em class="comment">// Use or create temporary array b for merging</em>
<a id="L1579" name="L1579"></a>1579         <strong class="reserved">char</strong>[] b;                 <em class="comment">// temp array; alternates with a</em>
<a id="L1580" name="L1580"></a>1580         <strong class="reserved">int</strong> ao, bo;              <em class="comment">// array offsets from 'left'</em>
<a id="L1581" name="L1581"></a>1581         <strong class="reserved">int</strong> blen = right - left; <em class="comment">// space needed for b</em>
<a id="L1582" name="L1582"></a>1582         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; blen || workBase + blen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L1583" name="L1583"></a>1583             work = <strong class="reserved">new</strong> <strong class="reserved">char</strong>[blen];
<a id="L1584" name="L1584"></a>1584             workBase = 0;
<a id="L1585" name="L1585"></a>1585         <em class="brace">}</em>
<a id="L1586" name="L1586"></a>1586         <strong class="reserved">if</strong> (odd == 0) <em class="brace">{</em>
<a id="L1587" name="L1587"></a>1587             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, work, workBase, blen);
<a id="L1588" name="L1588"></a>1588             b = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L1589" name="L1589"></a>1589             bo = 0;
<a id="L1590" name="L1590"></a>1590             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = work;
<a id="L1591" name="L1591"></a>1591             ao = workBase - left;
<a id="L1592" name="L1592"></a>1592         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1593" name="L1593"></a>1593             b = work;
<a id="L1594" name="L1594"></a>1594             ao = 0;
<a id="L1595" name="L1595"></a>1595             bo = workBase - left;
<a id="L1596" name="L1596"></a>1596         <em class="brace">}</em>
<a id="L1597" name="L1597"></a>1597 
<a id="L1598" name="L1598"></a>1598         <em class="comment">// Merging</em>
<a id="L1599" name="L1599"></a>1599         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 1; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>) <em class="brace">{</em>
<a id="L1600" name="L1600"></a>1600             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = 0) + 2; k &lt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; k += 2) <em class="brace">{</em>
<a id="L1601" name="L1601"></a>1601                 <strong class="reserved">int</strong> hi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k], mi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 1];
<a id="L1602" name="L1602"></a>1602                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 2], p = i, q = mi; i &lt; hi; ++i) <em class="brace">{</em>
<a id="L1603" name="L1603"></a>1603                     <strong class="reserved">if</strong> (q &gt;= hi || p &lt; mi &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p + ao] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q + ao]) <em class="brace">{</em>
<a id="L1604" name="L1604"></a>1604                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p++ + ao];
<a id="L1605" name="L1605"></a>1605                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1606" name="L1606"></a>1606                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q++ + ao];
<a id="L1607" name="L1607"></a>1607                     <em class="brace">}</em>
<a id="L1608" name="L1608"></a>1608                 <em class="brace">}</em>
<a id="L1609" name="L1609"></a>1609                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = hi;
<a id="L1610" name="L1610"></a>1610             <em class="brace">}</em>
<a id="L1611" name="L1611"></a>1611             <strong class="reserved">if</strong> ((<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &amp; 1) != 0) <em class="brace">{</em>
<a id="L1612" name="L1612"></a>1612                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = right, lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - 1]; --i &gt;= lo;
<a id="L1613" name="L1613"></a>1613                     b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + ao]
<a id="L1614" name="L1614"></a>1614                 );
<a id="L1615" name="L1615"></a>1615                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = right;
<a id="L1616" name="L1616"></a>1616             <em class="brace">}</em>
<a id="L1617" name="L1617"></a>1617             <strong class="reserved">char</strong>[] t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = b; b = t;
<a id="L1618" name="L1618"></a>1618             <strong class="reserved">int</strong> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = ao; ao = bo; bo = <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L1619" name="L1619"></a>1619         <em class="brace">}</em>
<a id="L1620" name="L1620"></a>1620     <em class="brace">}</em>
<a id="L1621" name="L1621"></a>1621 
<div class="comment">
      Sorts the specified range of the array by Dual-Pivot Quicksort.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param leftmost indicates if this part is the leftmost in the range</div>
<a id="L1630" name="L1630"></a>1630     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">char</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right, <strong class="reserved">boolean</strong> leftmost) <em class="brace">{</em>
<a id="L1631" name="L1631"></a>1631         <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = right - left + 1;
<a id="L1632" name="L1632"></a>1632 
<a id="L1633" name="L1633"></a>1633         <em class="comment">// Use insertion sort on tiny arrays</em>
<a id="L1634" name="L1634"></a>1634         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; INSERTION_SORT_THRESHOLD) <em class="brace">{</em>
<a id="L1635" name="L1635"></a>1635             <strong class="reserved">if</strong> (leftmost) <em class="brace">{</em>
<div class="comment">
                  Traditional (without sentinel) insertion sort,
                  optimized for server VM, is used in case of
                  the leftmost part.</div>
<a id="L1641" name="L1641"></a>1641                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L1642" name="L1642"></a>1642                     <strong class="reserved">char</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L1643" name="L1643"></a>1643                     <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L1644" name="L1644"></a>1644                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L1645" name="L1645"></a>1645                         <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L1646" name="L1646"></a>1646                             <strong class="reserved">break</strong>;
<a id="L1647" name="L1647"></a>1647                         <em class="brace">}</em>
<a id="L1648" name="L1648"></a>1648                     <em class="brace">}</em>
<a id="L1649" name="L1649"></a>1649                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L1650" name="L1650"></a>1650                 <em class="brace">}</em>
<a id="L1651" name="L1651"></a>1651             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
                  Skip the longest ascending sequence.</div>
<a id="L1655" name="L1655"></a>1655                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1656" name="L1656"></a>1656                     <strong class="reserved">if</strong> (left &gt;= right) <em class="brace">{</em>
<a id="L1657" name="L1657"></a>1657                         <strong class="reserved">return</strong>;
<a id="L1658" name="L1658"></a>1658                     <em class="brace">}</em>
<a id="L1659" name="L1659"></a>1659                 <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++left] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left - 1]);
<a id="L1660" name="L1660"></a>1660 
<div class="comment">
                  Every element from adjoining part plays the role
                  of sentinel, therefore this allows us to avoid the
                  left range check on each iteration. Moreover, we use
                  the more optimized algorithm, so called pair insertion
                  sort, which is faster (in the context of Quicksort)
                  than traditional implementation of insertion sort.</div>
<a id="L1669" name="L1669"></a>1669                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; ++left &lt;= right; k = ++left) <em class="brace">{</em>
<a id="L1670" name="L1670"></a>1670                     <strong class="reserved">char</strong> a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k], <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L1671" name="L1671"></a>1671 
<a id="L1672" name="L1672"></a>1672                     <strong class="reserved">if</strong> (a1 &lt; <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>) <em class="brace">{</em>
<a id="L1673" name="L1673"></a>1673                         <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = a1; a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L1674" name="L1674"></a>1674                     <em class="brace">}</em>
<a id="L1675" name="L1675"></a>1675                     <strong class="reserved">while</strong> (a1 &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L1676" name="L1676"></a>1676                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1677" name="L1677"></a>1677                     <em class="brace">}</em>
<a id="L1678" name="L1678"></a>1678                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++k + 1] = a1;
<a id="L1679" name="L1679"></a>1679 
<a id="L1680" name="L1680"></a>1680                     <strong class="reserved">while</strong> (<a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L1681" name="L1681"></a>1681                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1682" name="L1682"></a>1682                     <em class="brace">}</em>
<a id="L1683" name="L1683"></a>1683                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>;
<a id="L1684" name="L1684"></a>1684                 <em class="brace">}</em>
<a id="L1685" name="L1685"></a>1685                 <strong class="reserved">char</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L1686" name="L1686"></a>1686 
<a id="L1687" name="L1687"></a>1687                 <strong class="reserved">while</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--right]) <em class="brace">{</em>
<a id="L1688" name="L1688"></a>1688                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L1689" name="L1689"></a>1689                 <em class="brace">}</em>
<a id="L1690" name="L1690"></a>1690                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>;
<a id="L1691" name="L1691"></a>1691             <em class="brace">}</em>
<a id="L1692" name="L1692"></a>1692             <strong class="reserved">return</strong>;
<a id="L1693" name="L1693"></a>1693         <em class="brace">}</em>
<a id="L1694" name="L1694"></a>1694 
<a id="L1695" name="L1695"></a>1695         <em class="comment">// Inexpensive approximation of length / 7</em>
<a id="L1696" name="L1696"></a>1696         <strong class="reserved">int</strong> seventh = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 3) + (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 6) + 1;
<a id="L1697" name="L1697"></a>1697 
<div class="comment">
          Sort five evenly spaced elements around (and including) the
          center element in the range. These elements will be used for
          pivot selection as described below. The choice for spacing
          these elements was empirically determined to work well on
          a wide variety of inputs.</div>
<a id="L1705" name="L1705"></a>1705         <strong class="reserved">int</strong> e3 = (left + right) &gt;&gt;&gt; 1; <em class="comment">// The midpoint</em>
<a id="L1706" name="L1706"></a>1706         <strong class="reserved">int</strong> e2 = e3 - seventh;
<a id="L1707" name="L1707"></a>1707         <strong class="reserved">int</strong> e1 = e2 - seventh;
<a id="L1708" name="L1708"></a>1708         <strong class="reserved">int</strong> e4 = e3 + seventh;
<a id="L1709" name="L1709"></a>1709         <strong class="reserved">int</strong> e5 = e4 + seventh;
<a id="L1710" name="L1710"></a>1710 
<a id="L1711" name="L1711"></a>1711         <em class="comment">// Sort these elements using insertion sort</em>
<a id="L1712" name="L1712"></a>1712         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <strong class="reserved">char</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1713" name="L1713"></a>1713 
<a id="L1714" name="L1714"></a>1714         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <strong class="reserved">char</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L1715" name="L1715"></a>1715             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1716" name="L1716"></a>1716         <em class="brace">}</em>
<a id="L1717" name="L1717"></a>1717         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <strong class="reserved">char</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L1718" name="L1718"></a>1718             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L1719" name="L1719"></a>1719                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1720" name="L1720"></a>1720             <em class="brace">}</em>
<a id="L1721" name="L1721"></a>1721         <em class="brace">}</em>
<a id="L1722" name="L1722"></a>1722         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]) <em class="brace">{</em> <strong class="reserved">char</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = t;
<a id="L1723" name="L1723"></a>1723             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L1724" name="L1724"></a>1724                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L1725" name="L1725"></a>1725                     <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L1726" name="L1726"></a>1726                 <em class="brace">}</em>
<a id="L1727" name="L1727"></a>1727             <em class="brace">}</em>
<a id="L1728" name="L1728"></a>1728         <em class="brace">}</em>
<a id="L1729" name="L1729"></a>1729 
<a id="L1730" name="L1730"></a>1730         <em class="comment">// Pointers</em>
<a id="L1731" name="L1731"></a>1731         <strong class="reserved">int</strong> less  = left;  <em class="comment">// The index of the first element of center part</em>
<a id="L1732" name="L1732"></a>1732         <strong class="reserved">int</strong> great = right; <em class="comment">// The index before the first element of right part</em>
<a id="L1733" name="L1733"></a>1733 
<a id="L1734" name="L1734"></a>1734         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]) <em class="brace">{</em>
<div class="comment">
              Use the second and fourth of the five sorted elements as pivots.
              These values are inexpensive approximations of the first and
              second terciles of the array. Note that pivot1 &lt;= pivot2.</div>
<a id="L1740" name="L1740"></a>1740             <strong class="reserved">char</strong> pivot1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2];
<a id="L1741" name="L1741"></a>1741             <strong class="reserved">char</strong> pivot2 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4];
<a id="L1742" name="L1742"></a>1742 
<div class="comment">
              The first and the last elements to be sorted are moved to the
              locations formerly occupied by the pivots. When partitioning
              is complete, the pivots are swapped back into their final
              positions, and excluded from subsequent sorting.</div>
<a id="L1749" name="L1749"></a>1749             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L1750" name="L1750"></a>1750             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L1751" name="L1751"></a>1751 
<div class="comment">
              Skip elements, which are less or greater than pivot values.</div>
<a id="L1755" name="L1755"></a>1755             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++less] &lt; pivot1);
<a id="L1756" name="L1756"></a>1756             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--great] &gt; pivot2);
<a id="L1757" name="L1757"></a>1757 
<div class="comment">
              Partitioning:
                left part           center part                   right part
              +--------------------------------------------------------------+
              |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  |
              +--------------------------------------------------------------+
                            ^                          ^       ^
                            |                          |       |
                           less                        k     great
              Invariants:
                           all in (left, less)   &lt; pivot1
                 pivot1 &lt;= all in [less, k)     &lt;= pivot2
                           all in (great, right) &gt; pivot2
              Pointer k is the first index of ?-part.</div>
<a id="L1777" name="L1777"></a>1777             outer:
<a id="L1778" name="L1778"></a>1778             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L1779" name="L1779"></a>1779                 <strong class="reserved">char</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1780" name="L1780"></a>1780                 <strong class="reserved">if</strong> (ak &lt; pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L1781" name="L1781"></a>1781                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                      Here and below we use "a[i] = b; i++;" instead
                      of "a[i++] = b;" due to performance issue.</div>
<a id="L1786" name="L1786"></a>1786                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L1787" name="L1787"></a>1787                     ++less;
<a id="L1788" name="L1788"></a>1788                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak &gt; pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L1789" name="L1789"></a>1789                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot2) <em class="brace">{</em>
<a id="L1790" name="L1790"></a>1790                         <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L1791" name="L1791"></a>1791                             <strong class="reserved">break</strong> outer;
<a id="L1792" name="L1792"></a>1792                         <em class="brace">}</em>
<a id="L1793" name="L1793"></a>1793                     <em class="brace">}</em>
<a id="L1794" name="L1794"></a>1794                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot2</em>
<a id="L1795" name="L1795"></a>1795                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1796" name="L1796"></a>1796                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1797" name="L1797"></a>1797                         ++less;
<a id="L1798" name="L1798"></a>1798                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt;= a[great] &lt;= pivot2</em>
<a id="L1799" name="L1799"></a>1799                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1800" name="L1800"></a>1800                     <em class="brace">}</em>
<div class="comment">
                      Here and below we use "a[i] = b; i--;" instead
                      of "a[i--] = b;" due to performance issue.</div>
<a id="L1805" name="L1805"></a>1805                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L1806" name="L1806"></a>1806                     --great;
<a id="L1807" name="L1807"></a>1807                 <em class="brace">}</em>
<a id="L1808" name="L1808"></a>1808             <em class="brace">}</em>
<a id="L1809" name="L1809"></a>1809 
<a id="L1810" name="L1810"></a>1810             <em class="comment">// Swap pivots into their final positions</em>
<a id="L1811" name="L1811"></a>1811             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]  = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1] = pivot1;
<a id="L1812" name="L1812"></a>1812             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1] = pivot2;
<a id="L1813" name="L1813"></a>1813 
<a id="L1814" name="L1814"></a>1814             <em class="comment">// Sort left and right parts recursively, excluding known pivots</em>
<a id="L1815" name="L1815"></a>1815             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 2, leftmost);
<a id="L1816" name="L1816"></a>1816             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 2, right, <strong class="reserved">false</strong>);
<a id="L1817" name="L1817"></a>1817 
<div class="comment">
              If center part is too large (comprises &gt; 4/7 of the array),
              swap internal pivot values to ends.</div>
<a id="L1822" name="L1822"></a>1822             <strong class="reserved">if</strong> (less &lt; e1 &amp;&amp; e5 &lt; great) <em class="brace">{</em>
<div class="comment">
                  Skip elements, which are equal to pivot values.</div>
<a id="L1826" name="L1826"></a>1826                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] == pivot1) <em class="brace">{</em>
<a id="L1827" name="L1827"></a>1827                     ++less;
<a id="L1828" name="L1828"></a>1828                 <em class="brace">}</em>
<a id="L1829" name="L1829"></a>1829 
<a id="L1830" name="L1830"></a>1830                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L1831" name="L1831"></a>1831                     --great;
<a id="L1832" name="L1832"></a>1832                 <em class="brace">}</em>
<a id="L1833" name="L1833"></a>1833 
<div class="comment">
                  Partitioning:
                    left part         center part                  right part
                  +----------------------------------------------------------+
                  | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |
                  +----------------------------------------------------------+
                               ^                        ^       ^
                               |                        |       |
                              less                      k     great
                  Invariants:
                               all in (*,  less) == pivot1
                      pivot1 &lt; all in [less,  k)  &lt; pivot2
                               all in (great, *) == pivot2
                  Pointer k is the first index of ?-part.</div>
<a id="L1853" name="L1853"></a>1853                 outer:
<a id="L1854" name="L1854"></a>1854                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L1855" name="L1855"></a>1855                     <strong class="reserved">char</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1856" name="L1856"></a>1856                     <strong class="reserved">if</strong> (ak == pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L1857" name="L1857"></a>1857                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1858" name="L1858"></a>1858                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L1859" name="L1859"></a>1859                         ++less;
<a id="L1860" name="L1860"></a>1860                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak == pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L1861" name="L1861"></a>1861                         <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L1862" name="L1862"></a>1862                             <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L1863" name="L1863"></a>1863                                 <strong class="reserved">break</strong> outer;
<a id="L1864" name="L1864"></a>1864                             <em class="brace">}</em>
<a id="L1865" name="L1865"></a>1865                         <em class="brace">}</em>
<a id="L1866" name="L1866"></a>1866                         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt; pivot2</em>
<a id="L1867" name="L1867"></a>1867                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                              Even though a[great] equals to pivot1, the
                              assignment a[less] = pivot1 may be incorrect,
                              if a[great] and pivot1 are floating-point zeros
                              of different signs. Therefore in float and
                              double sorting methods we have to use more
                              accurate assignment a[less] = a[great].</div>
<a id="L1876" name="L1876"></a>1876                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = pivot1;
<a id="L1877" name="L1877"></a>1877                             ++less;
<a id="L1878" name="L1878"></a>1878                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt; a[great] &lt; pivot2</em>
<a id="L1879" name="L1879"></a>1879                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1880" name="L1880"></a>1880                         <em class="brace">}</em>
<a id="L1881" name="L1881"></a>1881                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L1882" name="L1882"></a>1882                         --great;
<a id="L1883" name="L1883"></a>1883                     <em class="brace">}</em>
<a id="L1884" name="L1884"></a>1884                 <em class="brace">}</em>
<a id="L1885" name="L1885"></a>1885             <em class="brace">}</em>
<a id="L1886" name="L1886"></a>1886 
<a id="L1887" name="L1887"></a>1887             <em class="comment">// Sort center part recursively</em>
<a id="L1888" name="L1888"></a>1888             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, less, great, <strong class="reserved">false</strong>);
<a id="L1889" name="L1889"></a>1889 
<a id="L1890" name="L1890"></a>1890         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Partitioning with one pivot</em>
<div class="comment">
              Use the third of the five sorted elements as pivot.
              This value is inexpensive approximation of the median.</div>
<a id="L1895" name="L1895"></a>1895             <strong class="reserved">char</strong> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3];
<a id="L1896" name="L1896"></a>1896 
<div class="comment">
              Partitioning degenerates to the traditional 3-way
              (or "Dutch National Flag") schema:
                left part    center part              right part
              +-------------------------------------------------+
              |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  |
              +-------------------------------------------------+
                           ^              ^        ^
                           |              |        |
                          less            k      great
              Invariants:
                all in (left, less)   &lt; pivot
                all in [less, k)     == pivot
                all in (great, right) &gt; pivot
              Pointer k is the first index of ?-part.</div>
<a id="L1917" name="L1917"></a>1917             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less; k &lt;= great; ++k) <em class="brace">{</em>
<a id="L1918" name="L1918"></a>1918                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] == pivot) <em class="brace">{</em>
<a id="L1919" name="L1919"></a>1919                     <strong class="reserved">continue</strong>;
<a id="L1920" name="L1920"></a>1920                 <em class="brace">}</em>
<a id="L1921" name="L1921"></a>1921                 <strong class="reserved">char</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L1922" name="L1922"></a>1922                 <strong class="reserved">if</strong> (ak &lt; pivot) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L1923" name="L1923"></a>1923                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1924" name="L1924"></a>1924                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L1925" name="L1925"></a>1925                     ++less;
<a id="L1926" name="L1926"></a>1926                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[k] &gt; pivot - Move a[k] to right part</em>
<a id="L1927" name="L1927"></a>1927                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot) <em class="brace">{</em>
<a id="L1928" name="L1928"></a>1928                         --great;
<a id="L1929" name="L1929"></a>1929                     <em class="brace">}</em>
<a id="L1930" name="L1930"></a>1930                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot</em>
<a id="L1931" name="L1931"></a>1931                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L1932" name="L1932"></a>1932                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L1933" name="L1933"></a>1933                         ++less;
<a id="L1934" name="L1934"></a>1934                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[great] == pivot</em>
<div class="comment">
                          Even though a[great] equals to pivot, the
                          assignment a[k] = pivot may be incorrect,
                          if a[great] and pivot are floating-point
                          zeros of different signs. Therefore in float
                          and double sorting methods we have to use
                          more accurate assignment a[k] = a[great].</div>
<a id="L1943" name="L1943"></a>1943                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = pivot;
<a id="L1944" name="L1944"></a>1944                     <em class="brace">}</em>
<a id="L1945" name="L1945"></a>1945                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L1946" name="L1946"></a>1946                     --great;
<a id="L1947" name="L1947"></a>1947                 <em class="brace">}</em>
<a id="L1948" name="L1948"></a>1948             <em class="brace">}</em>
<a id="L1949" name="L1949"></a>1949 
<div class="comment">
              Sort left and right parts recursively.
              All elements from center part are equal
              and, therefore, already sorted.</div>
<a id="L1955" name="L1955"></a>1955             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 1, leftmost);
<a id="L1956" name="L1956"></a>1956             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 1, right, <strong class="reserved">false</strong>);
<a id="L1957" name="L1957"></a>1957         <em class="brace">}</em>
<a id="L1958" name="L1958"></a>1958     <em class="brace">}</em>
<a id="L1959" name="L1959"></a>1959 
<div class="comment">
     /** The number of distinct byte values. */</div>
<a id="L1961" name="L1961"></a>1961     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> NUM_BYTE_VALUES = 1 &lt;&lt; 8;
<a id="L1962" name="L1962"></a>1962 
<div class="comment">
      Sorts the specified range of the array.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted</div>
<a id="L1970" name="L1970"></a>1970     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">byte</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right) <em class="brace">{</em>
<a id="L1971" name="L1971"></a>1971         <em class="comment">// Use counting sort on large arrays</em>
<a id="L1972" name="L1972"></a>1972         <strong class="reserved">if</strong> (right - left &gt; COUNTING_SORT_THRESHOLD_FOR_BYTE) <em class="brace">{</em>
<a id="L1973" name="L1973"></a>1973             <strong class="reserved">int</strong>[] <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[NUM_BYTE_VALUES];
<a id="L1974" name="L1974"></a>1974 
<a id="L1975" name="L1975"></a>1975             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left - 1; ++i &lt;= right;
<a id="L1976" name="L1976"></a>1976                 <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i] - <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>.MIN_VALUE]++
<a id="L1977" name="L1977"></a>1977             );
<a id="L1978" name="L1978"></a>1978             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = NUM_BYTE_VALUES, k = right + 1; k &gt; left; ) <em class="brace">{</em>
<a id="L1979" name="L1979"></a>1979                 <strong class="reserved">while</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[--i] == 0);
<a id="L1980" name="L1980"></a>1980                 <strong class="reserved">byte</strong> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = (<strong class="reserved">byte</strong>) (i + <a href="../D/1038.html" title="Multiple defined in 2 places.">Byte</a>.MIN_VALUE);
<a id="L1981" name="L1981"></a>1981                 <strong class="reserved">int</strong> s = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>[i];
<a id="L1982" name="L1982"></a>1982 
<a id="L1983" name="L1983"></a>1983                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1984" name="L1984"></a>1984                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k] = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L1985" name="L1985"></a>1985                 <em class="brace">}</em> <strong class="reserved">while</strong> (--s &gt; 0);
<a id="L1986" name="L1986"></a>1986             <em class="brace">}</em>
<a id="L1987" name="L1987"></a>1987         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Use insertion sort on small arrays</em>
<a id="L1988" name="L1988"></a>1988             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L1989" name="L1989"></a>1989                 <strong class="reserved">byte</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L1990" name="L1990"></a>1990                 <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L1991" name="L1991"></a>1991                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L1992" name="L1992"></a>1992                     <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L1993" name="L1993"></a>1993                         <strong class="reserved">break</strong>;
<a id="L1994" name="L1994"></a>1994                     <em class="brace">}</em>
<a id="L1995" name="L1995"></a>1995                 <em class="brace">}</em>
<a id="L1996" name="L1996"></a>1996                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L1997" name="L1997"></a>1997             <em class="brace">}</em>
<a id="L1998" name="L1998"></a>1998         <em class="brace">}</em>
<a id="L1999" name="L1999"></a>1999     <em class="brace">}</em>
<a id="L2000" name="L2000"></a>2000 
<div class="comment">
      Sorts the specified range of the array using the given
      workspace array slice if possible for merging
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L2012" name="L2012"></a>2012     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">float</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L2013" name="L2013"></a>2013                      <strong class="reserved">float</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<div class="comment">
          Phase 1: Move NaNs to the end of the array.</div>
<a id="L2017" name="L2017"></a>2017         <strong class="reserved">while</strong> (left &lt;= right &amp;&amp; <a href="../D/3293.html" title="Multiple defined in 10 places.">Float</a>.<a href="../D/25912.html" title="Multiple defined in 4 places.">isNaN</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right])) <em class="brace">{</em>
<a id="L2018" name="L2018"></a>2018             --right;
<a id="L2019" name="L2019"></a>2019         <em class="brace">}</em>
<a id="L2020" name="L2020"></a>2020         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = right; --k &gt;= left; ) <em class="brace">{</em>
<a id="L2021" name="L2021"></a>2021             <strong class="reserved">float</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2022" name="L2022"></a>2022             <strong class="reserved">if</strong> (ak != ak) <em class="brace">{</em> <em class="comment">// a[k] is NaN</em>
<a id="L2023" name="L2023"></a>2023                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2024" name="L2024"></a>2024                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = ak;
<a id="L2025" name="L2025"></a>2025                 --right;
<a id="L2026" name="L2026"></a>2026             <em class="brace">}</em>
<a id="L2027" name="L2027"></a>2027         <em class="brace">}</em>
<a id="L2028" name="L2028"></a>2028 
<div class="comment">
          Phase 2: Sort everything except NaNs (which are already in place).</div>
<a id="L2032" name="L2032"></a>2032         <a href="../D/15089.html" title="Multiple defined in 4 places.">doSort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, work, workBase, workLen);
<a id="L2033" name="L2033"></a>2033 
<div class="comment">
          Phase 3: Place negative zeros before positive zeros.</div>
<a id="L2037" name="L2037"></a>2037         <strong class="reserved">int</strong> hi = right;
<a id="L2038" name="L2038"></a>2038 
<div class="comment">
          Find the first zero, or first positive, or last negative element.</div>
<a id="L2042" name="L2042"></a>2042         <strong class="reserved">while</strong> (left &lt; hi) <em class="brace">{</em>
<a id="L2043" name="L2043"></a>2043             <strong class="reserved">int</strong> middle = (left + hi) &gt;&gt;&gt; 1;
<a id="L2044" name="L2044"></a>2044             <strong class="reserved">float</strong> middleValue = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[middle];
<a id="L2045" name="L2045"></a>2045 
<a id="L2046" name="L2046"></a>2046             <strong class="reserved">if</strong> (middleValue &lt; 0.0f) <em class="brace">{</em>
<a id="L2047" name="L2047"></a>2047                 left = middle + 1;
<a id="L2048" name="L2048"></a>2048             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2049" name="L2049"></a>2049                 hi = middle;
<a id="L2050" name="L2050"></a>2050             <em class="brace">}</em>
<a id="L2051" name="L2051"></a>2051         <em class="brace">}</em>
<a id="L2052" name="L2052"></a>2052 
<div class="comment">
          Skip the last negative value (if any) or all leading negative zeros.</div>
<a id="L2056" name="L2056"></a>2056         <strong class="reserved">while</strong> (left &lt;= right &amp;&amp; <a href="../D/3293.html" title="Multiple defined in 10 places.">Float</a>.<a href="../S/1719.html#L789" title="Defined at 789 in src/java/lang/Float.java.">floatToRawIntBits</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]) &lt; 0) <em class="brace">{</em>
<a id="L2057" name="L2057"></a>2057             ++left;
<a id="L2058" name="L2058"></a>2058         <em class="brace">}</em>
<a id="L2059" name="L2059"></a>2059 
<div class="comment">
          Move negative zeros to the beginning of the sub-range.
          Partitioning:
          +----------------------------------------------------+
          |   &lt; 0.0   |   -0.0   |   0.0   |   ?  ( &gt;= 0.0 )   |
          +----------------------------------------------------+
                       ^          ^         ^
                       |          |         |
                      left        p         k
          Invariants:
            all in (*,  left)  &lt;  0.0
            all in [left,  p) == -0.0
            all in [p,     k) ==  0.0
            all in [k, right] &gt;=  0.0
          Pointer k is the first index of ?-part.</div>
<a id="L2081" name="L2081"></a>2081         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left, p = left - 1; ++k &lt;= right; ) <em class="brace">{</em>
<a id="L2082" name="L2082"></a>2082             <strong class="reserved">float</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2083" name="L2083"></a>2083             <strong class="reserved">if</strong> (ak != 0.0f) <em class="brace">{</em>
<a id="L2084" name="L2084"></a>2084                 <strong class="reserved">break</strong>;
<a id="L2085" name="L2085"></a>2085             <em class="brace">}</em>
<a id="L2086" name="L2086"></a>2086             <strong class="reserved">if</strong> (<a href="../D/3293.html" title="Multiple defined in 10 places.">Float</a>.<a href="../S/1719.html#L789" title="Defined at 789 in src/java/lang/Float.java.">floatToRawIntBits</a>(ak) &lt; 0) <em class="brace">{</em> <em class="comment">// ak is -0.0f</em>
<a id="L2087" name="L2087"></a>2087                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = 0.0f;
<a id="L2088" name="L2088"></a>2088                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++p] = -0.0f;
<a id="L2089" name="L2089"></a>2089             <em class="brace">}</em>
<a id="L2090" name="L2090"></a>2090         <em class="brace">}</em>
<a id="L2091" name="L2091"></a>2091     <em class="brace">}</em>
<a id="L2092" name="L2092"></a>2092 
<div class="comment">
      Sorts the specified range of the array.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L2103" name="L2103"></a>2103     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/13449.html" title="Multiple referred from 4 places.">doSort</a>(<strong class="reserved">float</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L2104" name="L2104"></a>2104                                <strong class="reserved">float</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L2105" name="L2105"></a>2105         <em class="comment">// Use Quicksort on small arrays</em>
<a id="L2106" name="L2106"></a>2106         <strong class="reserved">if</strong> (right - left &lt; QUICKSORT_THRESHOLD) <em class="brace">{</em>
<a id="L2107" name="L2107"></a>2107             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L2108" name="L2108"></a>2108             <strong class="reserved">return</strong>;
<a id="L2109" name="L2109"></a>2109         <em class="brace">}</em>
<a id="L2110" name="L2110"></a>2110 
<div class="comment">
          Index run[i] is the start of i-th run
          (ascending or descending sequence).</div>
<a id="L2115" name="L2115"></a>2115         <strong class="reserved">int</strong>[] <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[MAX_RUN_COUNT + 1];
<a id="L2116" name="L2116"></a>2116         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[0] = left;
<a id="L2117" name="L2117"></a>2117 
<a id="L2118" name="L2118"></a>2118         <em class="comment">// Check if the array is nearly sorted</em>
<a id="L2119" name="L2119"></a>2119         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; k &lt; right; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = k) <em class="brace">{</em>
<a id="L2120" name="L2120"></a>2120             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// ascending</em>
<a id="L2121" name="L2121"></a>2121                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L2122" name="L2122"></a>2122             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &gt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// descending</em>
<a id="L2123" name="L2123"></a>2123                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L2124" name="L2124"></a>2124                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] - 1, hi = k; ++lo &lt; --hi; ) <em class="brace">{</em>
<a id="L2125" name="L2125"></a>2125                     <strong class="reserved">float</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi] = t;
<a id="L2126" name="L2126"></a>2126                 <em class="brace">}</em>
<a id="L2127" name="L2127"></a>2127             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// equal</em>
<a id="L2128" name="L2128"></a>2128                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> m = MAX_RUN_LENGTH; ++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]; ) <em class="brace">{</em>
<a id="L2129" name="L2129"></a>2129                     <strong class="reserved">if</strong> (--m == 0) <em class="brace">{</em>
<a id="L2130" name="L2130"></a>2130                         <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L2131" name="L2131"></a>2131                         <strong class="reserved">return</strong>;
<a id="L2132" name="L2132"></a>2132                     <em class="brace">}</em>
<a id="L2133" name="L2133"></a>2133                 <em class="brace">}</em>
<a id="L2134" name="L2134"></a>2134             <em class="brace">}</em>
<a id="L2135" name="L2135"></a>2135 
<div class="comment">
              The array is not highly structured,
              use Quicksort instead of merge sort.</div>
<a id="L2140" name="L2140"></a>2140             <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == MAX_RUN_COUNT) <em class="brace">{</em>
<a id="L2141" name="L2141"></a>2141                 <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L2142" name="L2142"></a>2142                 <strong class="reserved">return</strong>;
<a id="L2143" name="L2143"></a>2143             <em class="brace">}</em>
<a id="L2144" name="L2144"></a>2144         <em class="brace">}</em>
<a id="L2145" name="L2145"></a>2145 
<a id="L2146" name="L2146"></a>2146         <em class="comment">// Check special cases</em>
<a id="L2147" name="L2147"></a>2147         <em class="comment">// Implementation note: variable "right" is increased by 1.</em>
<a id="L2148" name="L2148"></a>2148         <strong class="reserved">if</strong> (<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] == right++) <em class="brace">{</em> <em class="comment">// The last run contains one element</em>
<a id="L2149" name="L2149"></a>2149             <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = right;
<a id="L2150" name="L2150"></a>2150         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 1) <em class="brace">{</em> <em class="comment">// The array is already sorted</em>
<a id="L2151" name="L2151"></a>2151             <strong class="reserved">return</strong>;
<a id="L2152" name="L2152"></a>2152         <em class="brace">}</em>
<a id="L2153" name="L2153"></a>2153 
<a id="L2154" name="L2154"></a>2154         <em class="comment">// Determine alternation base for merge</em>
<a id="L2155" name="L2155"></a>2155         <strong class="reserved">byte</strong> odd = 0;
<a id="L2156" name="L2156"></a>2156         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> n = 1; (n &lt;&lt;= 1) &lt; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; odd ^= 1);
<a id="L2157" name="L2157"></a>2157 
<a id="L2158" name="L2158"></a>2158         <em class="comment">// Use or create temporary array b for merging</em>
<a id="L2159" name="L2159"></a>2159         <strong class="reserved">float</strong>[] b;                 <em class="comment">// temp array; alternates with a</em>
<a id="L2160" name="L2160"></a>2160         <strong class="reserved">int</strong> ao, bo;              <em class="comment">// array offsets from 'left'</em>
<a id="L2161" name="L2161"></a>2161         <strong class="reserved">int</strong> blen = right - left; <em class="comment">// space needed for b</em>
<a id="L2162" name="L2162"></a>2162         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; blen || workBase + blen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L2163" name="L2163"></a>2163             work = <strong class="reserved">new</strong> <strong class="reserved">float</strong>[blen];
<a id="L2164" name="L2164"></a>2164             workBase = 0;
<a id="L2165" name="L2165"></a>2165         <em class="brace">}</em>
<a id="L2166" name="L2166"></a>2166         <strong class="reserved">if</strong> (odd == 0) <em class="brace">{</em>
<a id="L2167" name="L2167"></a>2167             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, work, workBase, blen);
<a id="L2168" name="L2168"></a>2168             b = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L2169" name="L2169"></a>2169             bo = 0;
<a id="L2170" name="L2170"></a>2170             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = work;
<a id="L2171" name="L2171"></a>2171             ao = workBase - left;
<a id="L2172" name="L2172"></a>2172         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2173" name="L2173"></a>2173             b = work;
<a id="L2174" name="L2174"></a>2174             ao = 0;
<a id="L2175" name="L2175"></a>2175             bo = workBase - left;
<a id="L2176" name="L2176"></a>2176         <em class="brace">}</em>
<a id="L2177" name="L2177"></a>2177 
<a id="L2178" name="L2178"></a>2178         <em class="comment">// Merging</em>
<a id="L2179" name="L2179"></a>2179         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 1; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>) <em class="brace">{</em>
<a id="L2180" name="L2180"></a>2180             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = 0) + 2; k &lt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; k += 2) <em class="brace">{</em>
<a id="L2181" name="L2181"></a>2181                 <strong class="reserved">int</strong> hi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k], mi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 1];
<a id="L2182" name="L2182"></a>2182                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 2], p = i, q = mi; i &lt; hi; ++i) <em class="brace">{</em>
<a id="L2183" name="L2183"></a>2183                     <strong class="reserved">if</strong> (q &gt;= hi || p &lt; mi &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p + ao] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q + ao]) <em class="brace">{</em>
<a id="L2184" name="L2184"></a>2184                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p++ + ao];
<a id="L2185" name="L2185"></a>2185                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2186" name="L2186"></a>2186                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q++ + ao];
<a id="L2187" name="L2187"></a>2187                     <em class="brace">}</em>
<a id="L2188" name="L2188"></a>2188                 <em class="brace">}</em>
<a id="L2189" name="L2189"></a>2189                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = hi;
<a id="L2190" name="L2190"></a>2190             <em class="brace">}</em>
<a id="L2191" name="L2191"></a>2191             <strong class="reserved">if</strong> ((<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &amp; 1) != 0) <em class="brace">{</em>
<a id="L2192" name="L2192"></a>2192                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = right, lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - 1]; --i &gt;= lo;
<a id="L2193" name="L2193"></a>2193                     b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + ao]
<a id="L2194" name="L2194"></a>2194                 );
<a id="L2195" name="L2195"></a>2195                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = right;
<a id="L2196" name="L2196"></a>2196             <em class="brace">}</em>
<a id="L2197" name="L2197"></a>2197             <strong class="reserved">float</strong>[] t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = b; b = t;
<a id="L2198" name="L2198"></a>2198             <strong class="reserved">int</strong> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = ao; ao = bo; bo = <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L2199" name="L2199"></a>2199         <em class="brace">}</em>
<a id="L2200" name="L2200"></a>2200     <em class="brace">}</em>
<a id="L2201" name="L2201"></a>2201 
<div class="comment">
      Sorts the specified range of the array by Dual-Pivot Quicksort.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param leftmost indicates if this part is the leftmost in the range</div>
<a id="L2210" name="L2210"></a>2210     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">float</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right, <strong class="reserved">boolean</strong> leftmost) <em class="brace">{</em>
<a id="L2211" name="L2211"></a>2211         <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = right - left + 1;
<a id="L2212" name="L2212"></a>2212 
<a id="L2213" name="L2213"></a>2213         <em class="comment">// Use insertion sort on tiny arrays</em>
<a id="L2214" name="L2214"></a>2214         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; INSERTION_SORT_THRESHOLD) <em class="brace">{</em>
<a id="L2215" name="L2215"></a>2215             <strong class="reserved">if</strong> (leftmost) <em class="brace">{</em>
<div class="comment">
                  Traditional (without sentinel) insertion sort,
                  optimized for server VM, is used in case of
                  the leftmost part.</div>
<a id="L2221" name="L2221"></a>2221                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L2222" name="L2222"></a>2222                     <strong class="reserved">float</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L2223" name="L2223"></a>2223                     <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L2224" name="L2224"></a>2224                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L2225" name="L2225"></a>2225                         <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L2226" name="L2226"></a>2226                             <strong class="reserved">break</strong>;
<a id="L2227" name="L2227"></a>2227                         <em class="brace">}</em>
<a id="L2228" name="L2228"></a>2228                     <em class="brace">}</em>
<a id="L2229" name="L2229"></a>2229                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L2230" name="L2230"></a>2230                 <em class="brace">}</em>
<a id="L2231" name="L2231"></a>2231             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
                  Skip the longest ascending sequence.</div>
<a id="L2235" name="L2235"></a>2235                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L2236" name="L2236"></a>2236                     <strong class="reserved">if</strong> (left &gt;= right) <em class="brace">{</em>
<a id="L2237" name="L2237"></a>2237                         <strong class="reserved">return</strong>;
<a id="L2238" name="L2238"></a>2238                     <em class="brace">}</em>
<a id="L2239" name="L2239"></a>2239                 <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++left] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left - 1]);
<a id="L2240" name="L2240"></a>2240 
<div class="comment">
                  Every element from adjoining part plays the role
                  of sentinel, therefore this allows us to avoid the
                  left range check on each iteration. Moreover, we use
                  the more optimized algorithm, so called pair insertion
                  sort, which is faster (in the context of Quicksort)
                  than traditional implementation of insertion sort.</div>
<a id="L2249" name="L2249"></a>2249                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; ++left &lt;= right; k = ++left) <em class="brace">{</em>
<a id="L2250" name="L2250"></a>2250                     <strong class="reserved">float</strong> a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k], <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L2251" name="L2251"></a>2251 
<a id="L2252" name="L2252"></a>2252                     <strong class="reserved">if</strong> (a1 &lt; <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>) <em class="brace">{</em>
<a id="L2253" name="L2253"></a>2253                         <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = a1; a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L2254" name="L2254"></a>2254                     <em class="brace">}</em>
<a id="L2255" name="L2255"></a>2255                     <strong class="reserved">while</strong> (a1 &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L2256" name="L2256"></a>2256                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2257" name="L2257"></a>2257                     <em class="brace">}</em>
<a id="L2258" name="L2258"></a>2258                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++k + 1] = a1;
<a id="L2259" name="L2259"></a>2259 
<a id="L2260" name="L2260"></a>2260                     <strong class="reserved">while</strong> (<a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L2261" name="L2261"></a>2261                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2262" name="L2262"></a>2262                     <em class="brace">}</em>
<a id="L2263" name="L2263"></a>2263                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>;
<a id="L2264" name="L2264"></a>2264                 <em class="brace">}</em>
<a id="L2265" name="L2265"></a>2265                 <strong class="reserved">float</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2266" name="L2266"></a>2266 
<a id="L2267" name="L2267"></a>2267                 <strong class="reserved">while</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--right]) <em class="brace">{</em>
<a id="L2268" name="L2268"></a>2268                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2269" name="L2269"></a>2269                 <em class="brace">}</em>
<a id="L2270" name="L2270"></a>2270                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>;
<a id="L2271" name="L2271"></a>2271             <em class="brace">}</em>
<a id="L2272" name="L2272"></a>2272             <strong class="reserved">return</strong>;
<a id="L2273" name="L2273"></a>2273         <em class="brace">}</em>
<a id="L2274" name="L2274"></a>2274 
<a id="L2275" name="L2275"></a>2275         <em class="comment">// Inexpensive approximation of length / 7</em>
<a id="L2276" name="L2276"></a>2276         <strong class="reserved">int</strong> seventh = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 3) + (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 6) + 1;
<a id="L2277" name="L2277"></a>2277 
<div class="comment">
          Sort five evenly spaced elements around (and including) the
          center element in the range. These elements will be used for
          pivot selection as described below. The choice for spacing
          these elements was empirically determined to work well on
          a wide variety of inputs.</div>
<a id="L2285" name="L2285"></a>2285         <strong class="reserved">int</strong> e3 = (left + right) &gt;&gt;&gt; 1; <em class="comment">// The midpoint</em>
<a id="L2286" name="L2286"></a>2286         <strong class="reserved">int</strong> e2 = e3 - seventh;
<a id="L2287" name="L2287"></a>2287         <strong class="reserved">int</strong> e1 = e2 - seventh;
<a id="L2288" name="L2288"></a>2288         <strong class="reserved">int</strong> e4 = e3 + seventh;
<a id="L2289" name="L2289"></a>2289         <strong class="reserved">int</strong> e5 = e4 + seventh;
<a id="L2290" name="L2290"></a>2290 
<a id="L2291" name="L2291"></a>2291         <em class="comment">// Sort these elements using insertion sort</em>
<a id="L2292" name="L2292"></a>2292         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <strong class="reserved">float</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2293" name="L2293"></a>2293 
<a id="L2294" name="L2294"></a>2294         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <strong class="reserved">float</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L2295" name="L2295"></a>2295             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2296" name="L2296"></a>2296         <em class="brace">}</em>
<a id="L2297" name="L2297"></a>2297         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <strong class="reserved">float</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L2298" name="L2298"></a>2298             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L2299" name="L2299"></a>2299                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2300" name="L2300"></a>2300             <em class="brace">}</em>
<a id="L2301" name="L2301"></a>2301         <em class="brace">}</em>
<a id="L2302" name="L2302"></a>2302         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]) <em class="brace">{</em> <strong class="reserved">float</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = t;
<a id="L2303" name="L2303"></a>2303             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L2304" name="L2304"></a>2304                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L2305" name="L2305"></a>2305                     <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2306" name="L2306"></a>2306                 <em class="brace">}</em>
<a id="L2307" name="L2307"></a>2307             <em class="brace">}</em>
<a id="L2308" name="L2308"></a>2308         <em class="brace">}</em>
<a id="L2309" name="L2309"></a>2309 
<a id="L2310" name="L2310"></a>2310         <em class="comment">// Pointers</em>
<a id="L2311" name="L2311"></a>2311         <strong class="reserved">int</strong> less  = left;  <em class="comment">// The index of the first element of center part</em>
<a id="L2312" name="L2312"></a>2312         <strong class="reserved">int</strong> great = right; <em class="comment">// The index before the first element of right part</em>
<a id="L2313" name="L2313"></a>2313 
<a id="L2314" name="L2314"></a>2314         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]) <em class="brace">{</em>
<div class="comment">
              Use the second and fourth of the five sorted elements as pivots.
              These values are inexpensive approximations of the first and
              second terciles of the array. Note that pivot1 &lt;= pivot2.</div>
<a id="L2320" name="L2320"></a>2320             <strong class="reserved">float</strong> pivot1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2];
<a id="L2321" name="L2321"></a>2321             <strong class="reserved">float</strong> pivot2 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4];
<a id="L2322" name="L2322"></a>2322 
<div class="comment">
              The first and the last elements to be sorted are moved to the
              locations formerly occupied by the pivots. When partitioning
              is complete, the pivots are swapped back into their final
              positions, and excluded from subsequent sorting.</div>
<a id="L2329" name="L2329"></a>2329             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L2330" name="L2330"></a>2330             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2331" name="L2331"></a>2331 
<div class="comment">
              Skip elements, which are less or greater than pivot values.</div>
<a id="L2335" name="L2335"></a>2335             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++less] &lt; pivot1);
<a id="L2336" name="L2336"></a>2336             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--great] &gt; pivot2);
<a id="L2337" name="L2337"></a>2337 
<div class="comment">
              Partitioning:
                left part           center part                   right part
              +--------------------------------------------------------------+
              |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  |
              +--------------------------------------------------------------+
                            ^                          ^       ^
                            |                          |       |
                           less                        k     great
              Invariants:
                           all in (left, less)   &lt; pivot1
                 pivot1 &lt;= all in [less, k)     &lt;= pivot2
                           all in (great, right) &gt; pivot2
              Pointer k is the first index of ?-part.</div>
<a id="L2357" name="L2357"></a>2357             outer:
<a id="L2358" name="L2358"></a>2358             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L2359" name="L2359"></a>2359                 <strong class="reserved">float</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2360" name="L2360"></a>2360                 <strong class="reserved">if</strong> (ak &lt; pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L2361" name="L2361"></a>2361                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                      Here and below we use "a[i] = b; i++;" instead
                      of "a[i++] = b;" due to performance issue.</div>
<a id="L2366" name="L2366"></a>2366                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L2367" name="L2367"></a>2367                     ++less;
<a id="L2368" name="L2368"></a>2368                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak &gt; pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L2369" name="L2369"></a>2369                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot2) <em class="brace">{</em>
<a id="L2370" name="L2370"></a>2370                         <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L2371" name="L2371"></a>2371                             <strong class="reserved">break</strong> outer;
<a id="L2372" name="L2372"></a>2372                         <em class="brace">}</em>
<a id="L2373" name="L2373"></a>2373                     <em class="brace">}</em>
<a id="L2374" name="L2374"></a>2374                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot2</em>
<a id="L2375" name="L2375"></a>2375                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L2376" name="L2376"></a>2376                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2377" name="L2377"></a>2377                         ++less;
<a id="L2378" name="L2378"></a>2378                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt;= a[great] &lt;= pivot2</em>
<a id="L2379" name="L2379"></a>2379                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2380" name="L2380"></a>2380                     <em class="brace">}</em>
<div class="comment">
                      Here and below we use "a[i] = b; i--;" instead
                      of "a[i--] = b;" due to performance issue.</div>
<a id="L2385" name="L2385"></a>2385                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L2386" name="L2386"></a>2386                     --great;
<a id="L2387" name="L2387"></a>2387                 <em class="brace">}</em>
<a id="L2388" name="L2388"></a>2388             <em class="brace">}</em>
<a id="L2389" name="L2389"></a>2389 
<a id="L2390" name="L2390"></a>2390             <em class="comment">// Swap pivots into their final positions</em>
<a id="L2391" name="L2391"></a>2391             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]  = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1] = pivot1;
<a id="L2392" name="L2392"></a>2392             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1] = pivot2;
<a id="L2393" name="L2393"></a>2393 
<a id="L2394" name="L2394"></a>2394             <em class="comment">// Sort left and right parts recursively, excluding known pivots</em>
<a id="L2395" name="L2395"></a>2395             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 2, leftmost);
<a id="L2396" name="L2396"></a>2396             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 2, right, <strong class="reserved">false</strong>);
<a id="L2397" name="L2397"></a>2397 
<div class="comment">
              If center part is too large (comprises &gt; 4/7 of the array),
              swap internal pivot values to ends.</div>
<a id="L2402" name="L2402"></a>2402             <strong class="reserved">if</strong> (less &lt; e1 &amp;&amp; e5 &lt; great) <em class="brace">{</em>
<div class="comment">
                  Skip elements, which are equal to pivot values.</div>
<a id="L2406" name="L2406"></a>2406                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] == pivot1) <em class="brace">{</em>
<a id="L2407" name="L2407"></a>2407                     ++less;
<a id="L2408" name="L2408"></a>2408                 <em class="brace">}</em>
<a id="L2409" name="L2409"></a>2409 
<a id="L2410" name="L2410"></a>2410                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L2411" name="L2411"></a>2411                     --great;
<a id="L2412" name="L2412"></a>2412                 <em class="brace">}</em>
<a id="L2413" name="L2413"></a>2413 
<div class="comment">
                  Partitioning:
                    left part         center part                  right part
                  +----------------------------------------------------------+
                  | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |
                  +----------------------------------------------------------+
                               ^                        ^       ^
                               |                        |       |
                              less                      k     great
                  Invariants:
                               all in (*,  less) == pivot1
                      pivot1 &lt; all in [less,  k)  &lt; pivot2
                               all in (great, *) == pivot2
                  Pointer k is the first index of ?-part.</div>
<a id="L2433" name="L2433"></a>2433                 outer:
<a id="L2434" name="L2434"></a>2434                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L2435" name="L2435"></a>2435                     <strong class="reserved">float</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2436" name="L2436"></a>2436                     <strong class="reserved">if</strong> (ak == pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L2437" name="L2437"></a>2437                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L2438" name="L2438"></a>2438                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L2439" name="L2439"></a>2439                         ++less;
<a id="L2440" name="L2440"></a>2440                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak == pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L2441" name="L2441"></a>2441                         <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L2442" name="L2442"></a>2442                             <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L2443" name="L2443"></a>2443                                 <strong class="reserved">break</strong> outer;
<a id="L2444" name="L2444"></a>2444                             <em class="brace">}</em>
<a id="L2445" name="L2445"></a>2445                         <em class="brace">}</em>
<a id="L2446" name="L2446"></a>2446                         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt; pivot2</em>
<a id="L2447" name="L2447"></a>2447                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                              Even though a[great] equals to pivot1, the
                              assignment a[less] = pivot1 may be incorrect,
                              if a[great] and pivot1 are floating-point zeros
                              of different signs. Therefore in float and
                              double sorting methods we have to use more
                              accurate assignment a[less] = a[great].</div>
<a id="L2456" name="L2456"></a>2456                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2457" name="L2457"></a>2457                             ++less;
<a id="L2458" name="L2458"></a>2458                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt; a[great] &lt; pivot2</em>
<a id="L2459" name="L2459"></a>2459                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2460" name="L2460"></a>2460                         <em class="brace">}</em>
<a id="L2461" name="L2461"></a>2461                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L2462" name="L2462"></a>2462                         --great;
<a id="L2463" name="L2463"></a>2463                     <em class="brace">}</em>
<a id="L2464" name="L2464"></a>2464                 <em class="brace">}</em>
<a id="L2465" name="L2465"></a>2465             <em class="brace">}</em>
<a id="L2466" name="L2466"></a>2466 
<a id="L2467" name="L2467"></a>2467             <em class="comment">// Sort center part recursively</em>
<a id="L2468" name="L2468"></a>2468             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, less, great, <strong class="reserved">false</strong>);
<a id="L2469" name="L2469"></a>2469 
<a id="L2470" name="L2470"></a>2470         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Partitioning with one pivot</em>
<div class="comment">
              Use the third of the five sorted elements as pivot.
              This value is inexpensive approximation of the median.</div>
<a id="L2475" name="L2475"></a>2475             <strong class="reserved">float</strong> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3];
<a id="L2476" name="L2476"></a>2476 
<div class="comment">
              Partitioning degenerates to the traditional 3-way
              (or "Dutch National Flag") schema:
                left part    center part              right part
              +-------------------------------------------------+
              |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  |
              +-------------------------------------------------+
                           ^              ^        ^
                           |              |        |
                          less            k      great
              Invariants:
                all in (left, less)   &lt; pivot
                all in [less, k)     == pivot
                all in (great, right) &gt; pivot
              Pointer k is the first index of ?-part.</div>
<a id="L2497" name="L2497"></a>2497             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less; k &lt;= great; ++k) <em class="brace">{</em>
<a id="L2498" name="L2498"></a>2498                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] == pivot) <em class="brace">{</em>
<a id="L2499" name="L2499"></a>2499                     <strong class="reserved">continue</strong>;
<a id="L2500" name="L2500"></a>2500                 <em class="brace">}</em>
<a id="L2501" name="L2501"></a>2501                 <strong class="reserved">float</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2502" name="L2502"></a>2502                 <strong class="reserved">if</strong> (ak &lt; pivot) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L2503" name="L2503"></a>2503                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L2504" name="L2504"></a>2504                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L2505" name="L2505"></a>2505                     ++less;
<a id="L2506" name="L2506"></a>2506                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[k] &gt; pivot - Move a[k] to right part</em>
<a id="L2507" name="L2507"></a>2507                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot) <em class="brace">{</em>
<a id="L2508" name="L2508"></a>2508                         --great;
<a id="L2509" name="L2509"></a>2509                     <em class="brace">}</em>
<a id="L2510" name="L2510"></a>2510                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot</em>
<a id="L2511" name="L2511"></a>2511                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L2512" name="L2512"></a>2512                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2513" name="L2513"></a>2513                         ++less;
<a id="L2514" name="L2514"></a>2514                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[great] == pivot</em>
<div class="comment">
                          Even though a[great] equals to pivot, the
                          assignment a[k] = pivot may be incorrect,
                          if a[great] and pivot are floating-point
                          zeros of different signs. Therefore in float
                          and double sorting methods we have to use
                          more accurate assignment a[k] = a[great].</div>
<a id="L2523" name="L2523"></a>2523                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2524" name="L2524"></a>2524                     <em class="brace">}</em>
<a id="L2525" name="L2525"></a>2525                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L2526" name="L2526"></a>2526                     --great;
<a id="L2527" name="L2527"></a>2527                 <em class="brace">}</em>
<a id="L2528" name="L2528"></a>2528             <em class="brace">}</em>
<a id="L2529" name="L2529"></a>2529 
<div class="comment">
              Sort left and right parts recursively.
              All elements from center part are equal
              and, therefore, already sorted.</div>
<a id="L2535" name="L2535"></a>2535             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 1, leftmost);
<a id="L2536" name="L2536"></a>2536             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 1, right, <strong class="reserved">false</strong>);
<a id="L2537" name="L2537"></a>2537         <em class="brace">}</em>
<a id="L2538" name="L2538"></a>2538     <em class="brace">}</em>
<a id="L2539" name="L2539"></a>2539 
<div class="comment">
      Sorts the specified range of the array using the given
      workspace array slice if possible for merging
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L2551" name="L2551"></a>2551     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">double</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L2552" name="L2552"></a>2552                      <strong class="reserved">double</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<div class="comment">
          Phase 1: Move NaNs to the end of the array.</div>
<a id="L2556" name="L2556"></a>2556         <strong class="reserved">while</strong> (left &lt;= right &amp;&amp; <a href="../D/2585.html" title="Multiple defined in 10 places.">Double</a>.<a href="../D/25912.html" title="Multiple defined in 4 places.">isNaN</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right])) <em class="brace">{</em>
<a id="L2557" name="L2557"></a>2557             --right;
<a id="L2558" name="L2558"></a>2558         <em class="brace">}</em>
<a id="L2559" name="L2559"></a>2559         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = right; --k &gt;= left; ) <em class="brace">{</em>
<a id="L2560" name="L2560"></a>2560             <strong class="reserved">double</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2561" name="L2561"></a>2561             <strong class="reserved">if</strong> (ak != ak) <em class="brace">{</em> <em class="comment">// a[k] is NaN</em>
<a id="L2562" name="L2562"></a>2562                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2563" name="L2563"></a>2563                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = ak;
<a id="L2564" name="L2564"></a>2564                 --right;
<a id="L2565" name="L2565"></a>2565             <em class="brace">}</em>
<a id="L2566" name="L2566"></a>2566         <em class="brace">}</em>
<a id="L2567" name="L2567"></a>2567 
<div class="comment">
          Phase 2: Sort everything except NaNs (which are already in place).</div>
<a id="L2571" name="L2571"></a>2571         <a href="../D/15089.html" title="Multiple defined in 4 places.">doSort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, work, workBase, workLen);
<a id="L2572" name="L2572"></a>2572 
<div class="comment">
          Phase 3: Place negative zeros before positive zeros.</div>
<a id="L2576" name="L2576"></a>2576         <strong class="reserved">int</strong> hi = right;
<a id="L2577" name="L2577"></a>2577 
<div class="comment">
          Find the first zero, or first positive, or last negative element.</div>
<a id="L2581" name="L2581"></a>2581         <strong class="reserved">while</strong> (left &lt; hi) <em class="brace">{</em>
<a id="L2582" name="L2582"></a>2582             <strong class="reserved">int</strong> middle = (left + hi) &gt;&gt;&gt; 1;
<a id="L2583" name="L2583"></a>2583             <strong class="reserved">double</strong> middleValue = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[middle];
<a id="L2584" name="L2584"></a>2584 
<a id="L2585" name="L2585"></a>2585             <strong class="reserved">if</strong> (middleValue &lt; 0.0d) <em class="brace">{</em>
<a id="L2586" name="L2586"></a>2586                 left = middle + 1;
<a id="L2587" name="L2587"></a>2587             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2588" name="L2588"></a>2588                 hi = middle;
<a id="L2589" name="L2589"></a>2589             <em class="brace">}</em>
<a id="L2590" name="L2590"></a>2590         <em class="brace">}</em>
<a id="L2591" name="L2591"></a>2591 
<div class="comment">
          Skip the last negative value (if any) or all leading negative zeros.</div>
<a id="L2595" name="L2595"></a>2595         <strong class="reserved">while</strong> (left &lt;= right &amp;&amp; <a href="../D/2585.html" title="Multiple defined in 10 places.">Double</a>.<a href="../S/1746.html#L882" title="Defined at 882 in src/java/lang/Double.java.">doubleToRawLongBits</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]) &lt; 0) <em class="brace">{</em>
<a id="L2596" name="L2596"></a>2596             ++left;
<a id="L2597" name="L2597"></a>2597         <em class="brace">}</em>
<a id="L2598" name="L2598"></a>2598 
<div class="comment">
          Move negative zeros to the beginning of the sub-range.
          Partitioning:
          +----------------------------------------------------+
          |   &lt; 0.0   |   -0.0   |   0.0   |   ?  ( &gt;= 0.0 )   |
          +----------------------------------------------------+
                       ^          ^         ^
                       |          |         |
                      left        p         k
          Invariants:
            all in (*,  left)  &lt;  0.0
            all in [left,  p) == -0.0
            all in [p,     k) ==  0.0
            all in [k, right] &gt;=  0.0
          Pointer k is the first index of ?-part.</div>
<a id="L2620" name="L2620"></a>2620         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left, p = left - 1; ++k &lt;= right; ) <em class="brace">{</em>
<a id="L2621" name="L2621"></a>2621             <strong class="reserved">double</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2622" name="L2622"></a>2622             <strong class="reserved">if</strong> (ak != 0.0d) <em class="brace">{</em>
<a id="L2623" name="L2623"></a>2623                 <strong class="reserved">break</strong>;
<a id="L2624" name="L2624"></a>2624             <em class="brace">}</em>
<a id="L2625" name="L2625"></a>2625             <strong class="reserved">if</strong> (<a href="../D/2585.html" title="Multiple defined in 10 places.">Double</a>.<a href="../S/1746.html#L882" title="Defined at 882 in src/java/lang/Double.java.">doubleToRawLongBits</a>(ak) &lt; 0) <em class="brace">{</em> <em class="comment">// ak is -0.0d</em>
<a id="L2626" name="L2626"></a>2626                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = 0.0d;
<a id="L2627" name="L2627"></a>2627                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++p] = -0.0d;
<a id="L2628" name="L2628"></a>2628             <em class="brace">}</em>
<a id="L2629" name="L2629"></a>2629         <em class="brace">}</em>
<a id="L2630" name="L2630"></a>2630     <em class="brace">}</em>
<a id="L2631" name="L2631"></a>2631 
<div class="comment">
      Sorts the specified range of the array.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param work a workspace array (slice)
      @param workBase origin of usable space in work array
      @param workLen usable size of work array</div>
<a id="L2642" name="L2642"></a>2642     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/13449.html" title="Multiple referred from 4 places.">doSort</a>(<strong class="reserved">double</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right,
<a id="L2643" name="L2643"></a>2643                                <strong class="reserved">double</strong>[] work, <strong class="reserved">int</strong> workBase, <strong class="reserved">int</strong> workLen) <em class="brace">{</em>
<a id="L2644" name="L2644"></a>2644         <em class="comment">// Use Quicksort on small arrays</em>
<a id="L2645" name="L2645"></a>2645         <strong class="reserved">if</strong> (right - left &lt; QUICKSORT_THRESHOLD) <em class="brace">{</em>
<a id="L2646" name="L2646"></a>2646             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L2647" name="L2647"></a>2647             <strong class="reserved">return</strong>;
<a id="L2648" name="L2648"></a>2648         <em class="brace">}</em>
<a id="L2649" name="L2649"></a>2649 
<div class="comment">
          Index run[i] is the start of i-th run
          (ascending or descending sequence).</div>
<a id="L2654" name="L2654"></a>2654         <strong class="reserved">int</strong>[] <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a> = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[MAX_RUN_COUNT + 1];
<a id="L2655" name="L2655"></a>2655         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[0] = left;
<a id="L2656" name="L2656"></a>2656 
<a id="L2657" name="L2657"></a>2657         <em class="comment">// Check if the array is nearly sorted</em>
<a id="L2658" name="L2658"></a>2658         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; k &lt; right; <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = k) <em class="brace">{</em>
<a id="L2659" name="L2659"></a>2659             <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// ascending</em>
<a id="L2660" name="L2660"></a>2660                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L2661" name="L2661"></a>2661             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] &gt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1]) <em class="brace">{</em> <em class="comment">// descending</em>
<a id="L2662" name="L2662"></a>2662                 <strong class="reserved">while</strong> (++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]);
<a id="L2663" name="L2663"></a>2663                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] - 1, hi = k; ++lo &lt; --hi; ) <em class="brace">{</em>
<a id="L2664" name="L2664"></a>2664                     <strong class="reserved">double</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[lo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[hi] = t;
<a id="L2665" name="L2665"></a>2665                 <em class="brace">}</em>
<a id="L2666" name="L2666"></a>2666             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// equal</em>
<a id="L2667" name="L2667"></a>2667                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> m = MAX_RUN_LENGTH; ++k &lt;= right &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k - 1] == <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k]; ) <em class="brace">{</em>
<a id="L2668" name="L2668"></a>2668                     <strong class="reserved">if</strong> (--m == 0) <em class="brace">{</em>
<a id="L2669" name="L2669"></a>2669                         <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L2670" name="L2670"></a>2670                         <strong class="reserved">return</strong>;
<a id="L2671" name="L2671"></a>2671                     <em class="brace">}</em>
<a id="L2672" name="L2672"></a>2672                 <em class="brace">}</em>
<a id="L2673" name="L2673"></a>2673             <em class="brace">}</em>
<a id="L2674" name="L2674"></a>2674 
<div class="comment">
              The array is not highly structured,
              use Quicksort instead of merge sort.</div>
<a id="L2679" name="L2679"></a>2679             <strong class="reserved">if</strong> (++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == MAX_RUN_COUNT) <em class="brace">{</em>
<a id="L2680" name="L2680"></a>2680                 <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, right, <strong class="reserved">true</strong>);
<a id="L2681" name="L2681"></a>2681                 <strong class="reserved">return</strong>;
<a id="L2682" name="L2682"></a>2682             <em class="brace">}</em>
<a id="L2683" name="L2683"></a>2683         <em class="brace">}</em>
<a id="L2684" name="L2684"></a>2684 
<a id="L2685" name="L2685"></a>2685         <em class="comment">// Check special cases</em>
<a id="L2686" name="L2686"></a>2686         <em class="comment">// Implementation note: variable "right" is increased by 1.</em>
<a id="L2687" name="L2687"></a>2687         <strong class="reserved">if</strong> (<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] == right++) <em class="brace">{</em> <em class="comment">// The last run contains one element</em>
<a id="L2688" name="L2688"></a>2688             <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>] = right;
<a id="L2689" name="L2689"></a>2689         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> == 1) <em class="brace">{</em> <em class="comment">// The array is already sorted</em>
<a id="L2690" name="L2690"></a>2690             <strong class="reserved">return</strong>;
<a id="L2691" name="L2691"></a>2691         <em class="brace">}</em>
<a id="L2692" name="L2692"></a>2692 
<a id="L2693" name="L2693"></a>2693         <em class="comment">// Determine alternation base for merge</em>
<a id="L2694" name="L2694"></a>2694         <strong class="reserved">byte</strong> odd = 0;
<a id="L2695" name="L2695"></a>2695         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> n = 1; (n &lt;&lt;= 1) &lt; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; odd ^= 1);
<a id="L2696" name="L2696"></a>2696 
<a id="L2697" name="L2697"></a>2697         <em class="comment">// Use or create temporary array b for merging</em>
<a id="L2698" name="L2698"></a>2698         <strong class="reserved">double</strong>[] b;                 <em class="comment">// temp array; alternates with a</em>
<a id="L2699" name="L2699"></a>2699         <strong class="reserved">int</strong> ao, bo;              <em class="comment">// array offsets from 'left'</em>
<a id="L2700" name="L2700"></a>2700         <strong class="reserved">int</strong> blen = right - left; <em class="comment">// space needed for b</em>
<a id="L2701" name="L2701"></a>2701         <strong class="reserved">if</strong> (work == <strong class="reserved">null</strong> || workLen &lt; blen || workBase + blen &gt; work.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L2702" name="L2702"></a>2702             work = <strong class="reserved">new</strong> <strong class="reserved">double</strong>[blen];
<a id="L2703" name="L2703"></a>2703             workBase = 0;
<a id="L2704" name="L2704"></a>2704         <em class="brace">}</em>
<a id="L2705" name="L2705"></a>2705         <strong class="reserved">if</strong> (odd == 0) <em class="brace">{</em>
<a id="L2706" name="L2706"></a>2706             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, work, workBase, blen);
<a id="L2707" name="L2707"></a>2707             b = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>;
<a id="L2708" name="L2708"></a>2708             bo = 0;
<a id="L2709" name="L2709"></a>2709             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = work;
<a id="L2710" name="L2710"></a>2710             ao = workBase - left;
<a id="L2711" name="L2711"></a>2711         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2712" name="L2712"></a>2712             b = work;
<a id="L2713" name="L2713"></a>2713             ao = 0;
<a id="L2714" name="L2714"></a>2714             bo = workBase - left;
<a id="L2715" name="L2715"></a>2715         <em class="brace">}</em>
<a id="L2716" name="L2716"></a>2716 
<a id="L2717" name="L2717"></a>2717         <em class="comment">// Merging</em>
<a id="L2718" name="L2718"></a>2718         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 1; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>) <em class="brace">{</em>
<a id="L2719" name="L2719"></a>2719             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = 0) + 2; k &lt;= <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>; k += 2) <em class="brace">{</em>
<a id="L2720" name="L2720"></a>2720                 <strong class="reserved">int</strong> hi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k], mi = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 1];
<a id="L2721" name="L2721"></a>2721                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[k - 2], p = i, q = mi; i &lt; hi; ++i) <em class="brace">{</em>
<a id="L2722" name="L2722"></a>2722                     <strong class="reserved">if</strong> (q &gt;= hi || p &lt; mi &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p + ao] &lt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q + ao]) <em class="brace">{</em>
<a id="L2723" name="L2723"></a>2723                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[p++ + ao];
<a id="L2724" name="L2724"></a>2724                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L2725" name="L2725"></a>2725                         b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[q++ + ao];
<a id="L2726" name="L2726"></a>2726                     <em class="brace">}</em>
<a id="L2727" name="L2727"></a>2727                 <em class="brace">}</em>
<a id="L2728" name="L2728"></a>2728                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = hi;
<a id="L2729" name="L2729"></a>2729             <em class="brace">}</em>
<a id="L2730" name="L2730"></a>2730             <strong class="reserved">if</strong> ((<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &amp; 1) != 0) <em class="brace">{</em>
<a id="L2731" name="L2731"></a>2731                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = right, lo = <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> - 1]; --i &gt;= lo;
<a id="L2732" name="L2732"></a>2732                     b[i + bo] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + ao]
<a id="L2733" name="L2733"></a>2733                 );
<a id="L2734" name="L2734"></a>2734                 <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>[++<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>] = right;
<a id="L2735" name="L2735"></a>2735             <em class="brace">}</em>
<a id="L2736" name="L2736"></a>2736             <strong class="reserved">double</strong>[] t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = b; b = t;
<a id="L2737" name="L2737"></a>2737             <strong class="reserved">int</strong> <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a> = ao; ao = bo; bo = <a href="../S/986.html#L3177" title="Defined at 3177 in src/java/util/regex/Pattern.java.">o</a>;
<a id="L2738" name="L2738"></a>2738         <em class="brace">}</em>
<a id="L2739" name="L2739"></a>2739     <em class="brace">}</em>
<a id="L2740" name="L2740"></a>2740 
<div class="comment">
      Sorts the specified range of the array by Dual-Pivot Quicksort.
      @param a the array to be sorted
      @param left the index of the first element, inclusive, to be sorted
      @param right the index of the last element, inclusive, to be sorted
      @param leftmost indicates if this part is the leftmost in the range</div>
<a id="L2749" name="L2749"></a>2749     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/28727.html" title="Multiple referred from 210 places.">sort</a>(<strong class="reserved">double</strong>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <strong class="reserved">int</strong> left, <strong class="reserved">int</strong> right, <strong class="reserved">boolean</strong> leftmost) <em class="brace">{</em>
<a id="L2750" name="L2750"></a>2750         <strong class="reserved">int</strong> <a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> = right - left + 1;
<a id="L2751" name="L2751"></a>2751 
<a id="L2752" name="L2752"></a>2752         <em class="comment">// Use insertion sort on tiny arrays</em>
<a id="L2753" name="L2753"></a>2753         <strong class="reserved">if</strong> (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &lt; INSERTION_SORT_THRESHOLD) <em class="brace">{</em>
<a id="L2754" name="L2754"></a>2754             <strong class="reserved">if</strong> (leftmost) <em class="brace">{</em>
<div class="comment">
                  Traditional (without sentinel) insertion sort,
                  optimized for server VM, is used in case of
                  the leftmost part.</div>
<a id="L2760" name="L2760"></a>2760                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = left, j = i; i &lt; right; j = ++i) <em class="brace">{</em>
<a id="L2761" name="L2761"></a>2761                     <strong class="reserved">double</strong> ai = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[i + 1];
<a id="L2762" name="L2762"></a>2762                     <strong class="reserved">while</strong> (ai &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j]) <em class="brace">{</em>
<a id="L2763" name="L2763"></a>2763                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j];
<a id="L2764" name="L2764"></a>2764                         <strong class="reserved">if</strong> (j-- == left) <em class="brace">{</em>
<a id="L2765" name="L2765"></a>2765                             <strong class="reserved">break</strong>;
<a id="L2766" name="L2766"></a>2766                         <em class="brace">}</em>
<a id="L2767" name="L2767"></a>2767                     <em class="brace">}</em>
<a id="L2768" name="L2768"></a>2768                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[j + 1] = ai;
<a id="L2769" name="L2769"></a>2769                 <em class="brace">}</em>
<a id="L2770" name="L2770"></a>2770             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
                  Skip the longest ascending sequence.</div>
<a id="L2774" name="L2774"></a>2774                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L2775" name="L2775"></a>2775                     <strong class="reserved">if</strong> (left &gt;= right) <em class="brace">{</em>
<a id="L2776" name="L2776"></a>2776                         <strong class="reserved">return</strong>;
<a id="L2777" name="L2777"></a>2777                     <em class="brace">}</em>
<a id="L2778" name="L2778"></a>2778                 <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++left] &gt;= <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left - 1]);
<a id="L2779" name="L2779"></a>2779 
<div class="comment">
                  Every element from adjoining part plays the role
                  of sentinel, therefore this allows us to avoid the
                  left range check on each iteration. Moreover, we use
                  the more optimized algorithm, so called pair insertion
                  sort, which is faster (in the context of Quicksort)
                  than traditional implementation of insertion sort.</div>
<a id="L2788" name="L2788"></a>2788                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = left; ++left &lt;= right; k = ++left) <em class="brace">{</em>
<a id="L2789" name="L2789"></a>2789                     <strong class="reserved">double</strong> a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k], <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L2790" name="L2790"></a>2790 
<a id="L2791" name="L2791"></a>2791                     <strong class="reserved">if</strong> (a1 &lt; <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>) <em class="brace">{</em>
<a id="L2792" name="L2792"></a>2792                         <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> = a1; a1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L2793" name="L2793"></a>2793                     <em class="brace">}</em>
<a id="L2794" name="L2794"></a>2794                     <strong class="reserved">while</strong> (a1 &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L2795" name="L2795"></a>2795                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2796" name="L2796"></a>2796                     <em class="brace">}</em>
<a id="L2797" name="L2797"></a>2797                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++k + 1] = a1;
<a id="L2798" name="L2798"></a>2798 
<a id="L2799" name="L2799"></a>2799                     <strong class="reserved">while</strong> (<a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--k]) <em class="brace">{</em>
<a id="L2800" name="L2800"></a>2800                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2801" name="L2801"></a>2801                     <em class="brace">}</em>
<a id="L2802" name="L2802"></a>2802                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k + 1] = <a href="../S/1166.html#L50" title="Defined at 50 in src/java/util/logging/XMLFormatter.java.">a2</a>;
<a id="L2803" name="L2803"></a>2803                 <em class="brace">}</em>
<a id="L2804" name="L2804"></a>2804                 <strong class="reserved">double</strong> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2805" name="L2805"></a>2805 
<a id="L2806" name="L2806"></a>2806                 <strong class="reserved">while</strong> (<a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--right]) <em class="brace">{</em>
<a id="L2807" name="L2807"></a>2807                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2808" name="L2808"></a>2808                 <em class="brace">}</em>
<a id="L2809" name="L2809"></a>2809                 <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right + 1] = <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>;
<a id="L2810" name="L2810"></a>2810             <em class="brace">}</em>
<a id="L2811" name="L2811"></a>2811             <strong class="reserved">return</strong>;
<a id="L2812" name="L2812"></a>2812         <em class="brace">}</em>
<a id="L2813" name="L2813"></a>2813 
<a id="L2814" name="L2814"></a>2814         <em class="comment">// Inexpensive approximation of length / 7</em>
<a id="L2815" name="L2815"></a>2815         <strong class="reserved">int</strong> seventh = (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 3) + (<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> &gt;&gt; 6) + 1;
<a id="L2816" name="L2816"></a>2816 
<div class="comment">
          Sort five evenly spaced elements around (and including) the
          center element in the range. These elements will be used for
          pivot selection as described below. The choice for spacing
          these elements was empirically determined to work well on
          a wide variety of inputs.</div>
<a id="L2824" name="L2824"></a>2824         <strong class="reserved">int</strong> e3 = (left + right) &gt;&gt;&gt; 1; <em class="comment">// The midpoint</em>
<a id="L2825" name="L2825"></a>2825         <strong class="reserved">int</strong> e2 = e3 - seventh;
<a id="L2826" name="L2826"></a>2826         <strong class="reserved">int</strong> e1 = e2 - seventh;
<a id="L2827" name="L2827"></a>2827         <strong class="reserved">int</strong> e4 = e3 + seventh;
<a id="L2828" name="L2828"></a>2828         <strong class="reserved">int</strong> e5 = e4 + seventh;
<a id="L2829" name="L2829"></a>2829 
<a id="L2830" name="L2830"></a>2830         <em class="comment">// Sort these elements using insertion sort</em>
<a id="L2831" name="L2831"></a>2831         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <strong class="reserved">double</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2832" name="L2832"></a>2832 
<a id="L2833" name="L2833"></a>2833         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <strong class="reserved">double</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L2834" name="L2834"></a>2834             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2835" name="L2835"></a>2835         <em class="brace">}</em>
<a id="L2836" name="L2836"></a>2836         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <strong class="reserved">double</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L2837" name="L2837"></a>2837             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L2838" name="L2838"></a>2838                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2839" name="L2839"></a>2839             <em class="brace">}</em>
<a id="L2840" name="L2840"></a>2840         <em class="brace">}</em>
<a id="L2841" name="L2841"></a>2841         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]) <em class="brace">{</em> <strong class="reserved">double</strong> t = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = t;
<a id="L2842" name="L2842"></a>2842             <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = t;
<a id="L2843" name="L2843"></a>2843                 <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = t;
<a id="L2844" name="L2844"></a>2844                     <strong class="reserved">if</strong> (t &lt; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]) <em class="brace">{</em> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] = t; <em class="brace">}</em>
<a id="L2845" name="L2845"></a>2845                 <em class="brace">}</em>
<a id="L2846" name="L2846"></a>2846             <em class="brace">}</em>
<a id="L2847" name="L2847"></a>2847         <em class="brace">}</em>
<a id="L2848" name="L2848"></a>2848 
<a id="L2849" name="L2849"></a>2849         <em class="comment">// Pointers</em>
<a id="L2850" name="L2850"></a>2850         <strong class="reserved">int</strong> less  = left;  <em class="comment">// The index of the first element of center part</em>
<a id="L2851" name="L2851"></a>2851         <strong class="reserved">int</strong> great = right; <em class="comment">// The index before the first element of right part</em>
<a id="L2852" name="L2852"></a>2852 
<a id="L2853" name="L2853"></a>2853         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e1] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] &amp;&amp; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] != <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e5]) <em class="brace">{</em>
<div class="comment">
              Use the second and fourth of the five sorted elements as pivots.
              These values are inexpensive approximations of the first and
              second terciles of the array. Note that pivot1 &lt;= pivot2.</div>
<a id="L2859" name="L2859"></a>2859             <strong class="reserved">double</strong> pivot1 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2];
<a id="L2860" name="L2860"></a>2860             <strong class="reserved">double</strong> pivot2 = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4];
<a id="L2861" name="L2861"></a>2861 
<div class="comment">
              The first and the last elements to be sorted are moved to the
              locations formerly occupied by the pivots. When partitioning
              is complete, the pivots are swapped back into their final
              positions, and excluded from subsequent sorting.</div>
<a id="L2868" name="L2868"></a>2868             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e2] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left];
<a id="L2869" name="L2869"></a>2869             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e4] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right];
<a id="L2870" name="L2870"></a>2870 
<div class="comment">
              Skip elements, which are less or greater than pivot values.</div>
<a id="L2874" name="L2874"></a>2874             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[++less] &lt; pivot1);
<a id="L2875" name="L2875"></a>2875             <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[--great] &gt; pivot2);
<a id="L2876" name="L2876"></a>2876 
<div class="comment">
              Partitioning:
                left part           center part                   right part
              +--------------------------------------------------------------+
              |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  |
              +--------------------------------------------------------------+
                            ^                          ^       ^
                            |                          |       |
                           less                        k     great
              Invariants:
                           all in (left, less)   &lt; pivot1
                 pivot1 &lt;= all in [less, k)     &lt;= pivot2
                           all in (great, right) &gt; pivot2
              Pointer k is the first index of ?-part.</div>
<a id="L2896" name="L2896"></a>2896             outer:
<a id="L2897" name="L2897"></a>2897             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L2898" name="L2898"></a>2898                 <strong class="reserved">double</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2899" name="L2899"></a>2899                 <strong class="reserved">if</strong> (ak &lt; pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L2900" name="L2900"></a>2900                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                      Here and below we use "a[i] = b; i++;" instead
                      of "a[i++] = b;" due to performance issue.</div>
<a id="L2905" name="L2905"></a>2905                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L2906" name="L2906"></a>2906                     ++less;
<a id="L2907" name="L2907"></a>2907                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak &gt; pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L2908" name="L2908"></a>2908                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot2) <em class="brace">{</em>
<a id="L2909" name="L2909"></a>2909                         <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L2910" name="L2910"></a>2910                             <strong class="reserved">break</strong> outer;
<a id="L2911" name="L2911"></a>2911                         <em class="brace">}</em>
<a id="L2912" name="L2912"></a>2912                     <em class="brace">}</em>
<a id="L2913" name="L2913"></a>2913                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot2</em>
<a id="L2914" name="L2914"></a>2914                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L2915" name="L2915"></a>2915                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2916" name="L2916"></a>2916                         ++less;
<a id="L2917" name="L2917"></a>2917                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt;= a[great] &lt;= pivot2</em>
<a id="L2918" name="L2918"></a>2918                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2919" name="L2919"></a>2919                     <em class="brace">}</em>
<div class="comment">
                      Here and below we use "a[i] = b; i--;" instead
                      of "a[i--] = b;" due to performance issue.</div>
<a id="L2924" name="L2924"></a>2924                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L2925" name="L2925"></a>2925                     --great;
<a id="L2926" name="L2926"></a>2926                 <em class="brace">}</em>
<a id="L2927" name="L2927"></a>2927             <em class="brace">}</em>
<a id="L2928" name="L2928"></a>2928 
<a id="L2929" name="L2929"></a>2929             <em class="comment">// Swap pivots into their final positions</em>
<a id="L2930" name="L2930"></a>2930             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[left]  = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less  - 1] = pivot1;
<a id="L2931" name="L2931"></a>2931             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[right] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1]; <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great + 1] = pivot2;
<a id="L2932" name="L2932"></a>2932 
<a id="L2933" name="L2933"></a>2933             <em class="comment">// Sort left and right parts recursively, excluding known pivots</em>
<a id="L2934" name="L2934"></a>2934             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 2, leftmost);
<a id="L2935" name="L2935"></a>2935             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 2, right, <strong class="reserved">false</strong>);
<a id="L2936" name="L2936"></a>2936 
<div class="comment">
              If center part is too large (comprises &gt; 4/7 of the array),
              swap internal pivot values to ends.</div>
<a id="L2941" name="L2941"></a>2941             <strong class="reserved">if</strong> (less &lt; e1 &amp;&amp; e5 &lt; great) <em class="brace">{</em>
<div class="comment">
                  Skip elements, which are equal to pivot values.</div>
<a id="L2945" name="L2945"></a>2945                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] == pivot1) <em class="brace">{</em>
<a id="L2946" name="L2946"></a>2946                     ++less;
<a id="L2947" name="L2947"></a>2947                 <em class="brace">}</em>
<a id="L2948" name="L2948"></a>2948 
<a id="L2949" name="L2949"></a>2949                 <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L2950" name="L2950"></a>2950                     --great;
<a id="L2951" name="L2951"></a>2951                 <em class="brace">}</em>
<a id="L2952" name="L2952"></a>2952 
<div class="comment">
                  Partitioning:
                    left part         center part                  right part
                  +----------------------------------------------------------+
                  | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |
                  +----------------------------------------------------------+
                               ^                        ^       ^
                               |                        |       |
                              less                      k     great
                  Invariants:
                               all in (*,  less) == pivot1
                      pivot1 &lt; all in [less,  k)  &lt; pivot2
                               all in (great, *) == pivot2
                  Pointer k is the first index of ?-part.</div>
<a id="L2972" name="L2972"></a>2972                 outer:
<a id="L2973" name="L2973"></a>2973                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less - 1; ++k &lt;= great; ) <em class="brace">{</em>
<a id="L2974" name="L2974"></a>2974                     <strong class="reserved">double</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L2975" name="L2975"></a>2975                     <strong class="reserved">if</strong> (ak == pivot1) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L2976" name="L2976"></a>2976                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L2977" name="L2977"></a>2977                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L2978" name="L2978"></a>2978                         ++less;
<a id="L2979" name="L2979"></a>2979                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ak == pivot2) <em class="brace">{</em> <em class="comment">// Move a[k] to right part</em>
<a id="L2980" name="L2980"></a>2980                         <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot2) <em class="brace">{</em>
<a id="L2981" name="L2981"></a>2981                             <strong class="reserved">if</strong> (great-- == k) <em class="brace">{</em>
<a id="L2982" name="L2982"></a>2982                                 <strong class="reserved">break</strong> outer;
<a id="L2983" name="L2983"></a>2983                             <em class="brace">}</em>
<a id="L2984" name="L2984"></a>2984                         <em class="brace">}</em>
<a id="L2985" name="L2985"></a>2985                         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] == pivot1) <em class="brace">{</em> <em class="comment">// a[great] &lt; pivot2</em>
<a id="L2986" name="L2986"></a>2986                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<div class="comment">
                              Even though a[great] equals to pivot1, the
                              assignment a[less] = pivot1 may be incorrect,
                              if a[great] and pivot1 are floating-point zeros
                              of different signs. Therefore in float and
                              double sorting methods we have to use more
                              accurate assignment a[less] = a[great].</div>
<a id="L2995" name="L2995"></a>2995                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2996" name="L2996"></a>2996                             ++less;
<a id="L2997" name="L2997"></a>2997                         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// pivot1 &lt; a[great] &lt; pivot2</em>
<a id="L2998" name="L2998"></a>2998                             <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L2999" name="L2999"></a>2999                         <em class="brace">}</em>
<a id="L3000" name="L3000"></a>3000                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L3001" name="L3001"></a>3001                         --great;
<a id="L3002" name="L3002"></a>3002                     <em class="brace">}</em>
<a id="L3003" name="L3003"></a>3003                 <em class="brace">}</em>
<a id="L3004" name="L3004"></a>3004             <em class="brace">}</em>
<a id="L3005" name="L3005"></a>3005 
<a id="L3006" name="L3006"></a>3006             <em class="comment">// Sort center part recursively</em>
<a id="L3007" name="L3007"></a>3007             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, less, great, <strong class="reserved">false</strong>);
<a id="L3008" name="L3008"></a>3008 
<a id="L3009" name="L3009"></a>3009         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// Partitioning with one pivot</em>
<div class="comment">
              Use the third of the five sorted elements as pivot.
              This value is inexpensive approximation of the median.</div>
<a id="L3014" name="L3014"></a>3014             <strong class="reserved">double</strong> pivot = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[e3];
<a id="L3015" name="L3015"></a>3015 
<div class="comment">
              Partitioning degenerates to the traditional 3-way
              (or "Dutch National Flag") schema:
                left part    center part              right part
              +-------------------------------------------------+
              |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  |
              +-------------------------------------------------+
                           ^              ^        ^
                           |              |        |
                          less            k      great
              Invariants:
                all in (left, less)   &lt; pivot
                all in [less, k)     == pivot
                all in (great, right) &gt; pivot
              Pointer k is the first index of ?-part.</div>
<a id="L3036" name="L3036"></a>3036             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = less; k &lt;= great; ++k) <em class="brace">{</em>
<a id="L3037" name="L3037"></a>3037                 <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] == pivot) <em class="brace">{</em>
<a id="L3038" name="L3038"></a>3038                     <strong class="reserved">continue</strong>;
<a id="L3039" name="L3039"></a>3039                 <em class="brace">}</em>
<a id="L3040" name="L3040"></a>3040                 <strong class="reserved">double</strong> ak = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k];
<a id="L3041" name="L3041"></a>3041                 <strong class="reserved">if</strong> (ak &lt; pivot) <em class="brace">{</em> <em class="comment">// Move a[k] to left part</em>
<a id="L3042" name="L3042"></a>3042                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L3043" name="L3043"></a>3043                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = ak;
<a id="L3044" name="L3044"></a>3044                     ++less;
<a id="L3045" name="L3045"></a>3045                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[k] &gt; pivot - Move a[k] to right part</em>
<a id="L3046" name="L3046"></a>3046                     <strong class="reserved">while</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &gt; pivot) <em class="brace">{</em>
<a id="L3047" name="L3047"></a>3047                         --great;
<a id="L3048" name="L3048"></a>3048                     <em class="brace">}</em>
<a id="L3049" name="L3049"></a>3049                     <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] &lt; pivot) <em class="brace">{</em> <em class="comment">// a[great] &lt;= pivot</em>
<a id="L3050" name="L3050"></a>3050                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less];
<a id="L3051" name="L3051"></a>3051                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[less] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L3052" name="L3052"></a>3052                         ++less;
<a id="L3053" name="L3053"></a>3053                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// a[great] == pivot</em>
<div class="comment">
                          Even though a[great] equals to pivot, the
                          assignment a[k] = pivot may be incorrect,
                          if a[great] and pivot are floating-point
                          zeros of different signs. Therefore in float
                          and double sorting methods we have to use
                          more accurate assignment a[k] = a[great].</div>
<a id="L3062" name="L3062"></a>3062                         <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[k] = <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great];
<a id="L3063" name="L3063"></a>3063                     <em class="brace">}</em>
<a id="L3064" name="L3064"></a>3064                     <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>[great] = ak;
<a id="L3065" name="L3065"></a>3065                     --great;
<a id="L3066" name="L3066"></a>3066                 <em class="brace">}</em>
<a id="L3067" name="L3067"></a>3067             <em class="brace">}</em>
<a id="L3068" name="L3068"></a>3068 
<div class="comment">
              Sort left and right parts recursively.
              All elements from center part are equal
              and, therefore, already sorted.</div>
<a id="L3074" name="L3074"></a>3074             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, left, less - 1, leftmost);
<a id="L3075" name="L3075"></a>3075             <a href="../D/34687.html" title="Multiple defined in 56 places.">sort</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, great + 1, right, <strong class="reserved">false</strong>);
<a id="L3076" name="L3076"></a>3076         <em class="brace">}</em>
<a id="L3077" name="L3077"></a>3077     <em class="brace">}</em>
<a id="L3078" name="L3078"></a>3078 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L107">[^]</a><a href="#L2749">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>