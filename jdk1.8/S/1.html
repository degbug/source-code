<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/launcher/java_md.c</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L110">[^]</a><a href="#L1437">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L110" title="Defined at 110.">GetParamValue</a></li>
<li><a href="#L127" title="Defined at 127.">GetBoolParamValue</a></li>
<li><a href="#L146" title="Defined at 146.">IsJavaw</a></li>
<li><a href="#L156" title="Defined at 156.">GetArchPath</a></li>
<li><a href="#L171" title="Defined at 171.">CreateExecutionEnvironment</a></li>
<li><a href="#L257" title="Defined at 257.">LoadMSVCRT</a></li>
<li><a href="#L309" title="Defined at 309.">GetJREPath</a></li>
<li><a href="#L352" title="Defined at 352.">GetJVMPath</a></li>
<li><a href="#L373" title="Defined at 373.">LoadJavaVM</a></li>
<li><a href="#L411" title="Defined at 411.">GetApplicationHome</a></li>
<li><a href="#L433" title="Defined at 433.">GetStringFromRegistry</a></li>
<li><a href="#L448" title="Defined at 448.">GetPublicJREHome</a></li>
<li><a href="#L516" title="Defined at 516.">CounterGet</a></li>
<li><a href="#L531" title="Defined at 531.">Counter2Micros</a></li>
<li><a href="#L549" title="Defined at 549.">JLI_Snprintf</a></li>
<li><a href="#L571" title="Defined at 571.">JLI_ReportErrorMessage</a></li>
<li><a href="#L600" title="Defined at 600.">JLI_ReportErrorMessageSys</a></li>
<li><a href="#L663" title="Defined at 663.">JLI_ReportExceptionDescription</a></li>
<li><a href="#L677" title="Defined at 677.">ServerClassMachine</a></li>
<li><a href="#L693" title="Defined at 693.">ProcessDir</a></li>
<li><a href="#L753" title="Defined at 753.">LocateJRE</a></li>
<li><a href="#L820" title="Defined at 820.">nextarg</a></li>
<li><a href="#L887" title="Defined at 887.">unquote</a></li>
<li><a href="#L923" title="Defined at 923.">ExecJRE</a></li>
<li><a href="#L1099" title="Defined at 1099.">UnsetEnv</a></li>
<li><a href="#L1115" title="Defined at 1115.">SplashProcAddress</a></li>
<li><a href="#L1136" title="Defined at 1136.">SplashFreeLibrary</a></li>
<li><a href="#L1144" title="Defined at 1144.">jlong_format_specifier</a></li>
<li><a href="#L1152" title="Defined at 1152.">ContinueInNewThread0</a></li>
<li><a href="#L1234" title="Defined at 1234.">SetJavaLauncherPlatformProps</a></li>
<li><a href="#L1242" title="Defined at 1242.">FindBootStrapClass</a></li>
<li><a href="#L1261" title="Defined at 1261.">InitLauncher</a></li>
<li><a href="#L1290" title="Defined at 1290.">AWTPreload</a></li>
<li><a href="#L1372" title="Defined at 1372.">AWTPreloadStop</a></li>
<li><a href="#L1381" title="Defined at 1381.">JVMInit</a></li>
<li><a href="#L1390" title="Defined at 1390.">PostJVMInit</a></li>
<li><a href="#L1396" title="Defined at 1396.">RegisterThread</a></li>
<li><a href="#L1405" title="Defined at 1405.">ProcessPlatformOption</a></li>
<li><a href="#L1411" title="Defined at 1411.">filterArgs</a></li>
<li><a href="#L1437" title="Defined at 1437.">CreateApplicationArgs</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1997, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <em class="sharp">#include</em> &lt;windows.h&gt;
<a id="L27" name="L27"></a>  27 <em class="sharp">#include</em> &lt;io.h&gt;
<a id="L28" name="L28"></a>  28 <em class="sharp">#include</em> &lt;process.h&gt;
<a id="L29" name="L29"></a>  29 <em class="sharp">#include</em> &lt;stdlib.h&gt;
<a id="L30" name="L30"></a>  30 <em class="sharp">#include</em> &lt;stdio.h&gt;
<a id="L31" name="L31"></a>  31 <em class="sharp">#include</em> &lt;stdarg.h&gt;
<a id="L32" name="L32"></a>  32 <em class="sharp">#include</em> &lt;string.h&gt;
<a id="L33" name="L33"></a>  33 <em class="sharp">#include</em> &lt;sys/types.h&gt;
<a id="L34" name="L34"></a>  34 <em class="sharp">#include</em> &lt;sys/stat.h&gt;
<a id="L35" name="L35"></a>  35 <em class="sharp">#include</em> &lt;wtypes.h&gt;
<a id="L36" name="L36"></a>  36 <em class="sharp">#include</em> &lt;commctrl.h&gt;
<a id="L37" name="L37"></a>  37 
<a id="L38" name="L38"></a>  38 <em class="sharp">#include</em> &lt;jni.h&gt;
<a id="L39" name="L39"></a>  39 <em class="sharp">#include</em> "<a href="5.html">java.h</a>"
<a id="L40" name="L40"></a>  40 <em class="sharp">#include</em> "<a href="3.html">version_comp.h</a>"
<a id="L41" name="L41"></a>  41 
<a id="L42" name="L42"></a>  42 <em class="sharp">#define</em> <a href="../R/4268.html" title="Multiple referred from 3 places.">JVM_DLL</a> "jvm.dll"
<a id="L43" name="L43"></a>  43 <em class="sharp">#define</em> <a href="../R/4061.html" title="Multiple referred from 4 places.">JAVA_DLL</a> "java.dll"
<a id="L44" name="L44"></a>  44 
<div class="comment">
  Prototypes.</div>
<a id="L48" name="L48"></a>  48 <strong class="reserved">static</strong> jboolean <a href="../S/1.html#L448" title="Defined at 448 in src/launcher/java_md.c.">GetPublicJREHome</a>(<strong class="reserved">char</strong> *path, jint pathsize);
<a id="L49" name="L49"></a>  49 <strong class="reserved">static</strong> jboolean <a href="../S/1.html#L352" title="Defined at 352 in src/launcher/java_md.c.">GetJVMPath</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *jrepath, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *jvmtype,
<a id="L50" name="L50"></a>  50                            <strong class="reserved">char</strong> *jvmpath, jint jvmpathsize);
<a id="L51" name="L51"></a>  51 <strong class="reserved">static</strong> jboolean <a href="../S/1.html#L309" title="Defined at 309 in src/launcher/java_md.c.">GetJREPath</a>(<strong class="reserved">char</strong> *path, jint pathsize);
<a id="L52" name="L52"></a>  52 
<div class="comment">
 We supports warmup for UI stack that is performed in parallel
  to VM initialization.
  This helps to improve startup of UI application as warmup phase
  might be long due to initialization of OS or hardware resources.
  It is not CPU bound and therefore it does not interfere with VM init.
  Obviously such warmup only has sense for UI apps and therefore it needs
  to be explicitly requested by passing -Dsun.awt.warmup=true property
  (this is always the case for plugin/javaws).
  Implementation launches new thread after VM starts and use it to perform
  warmup code (platform dependent).
  This thread is later reused as AWT toolkit thread as graphics toolkit
  often assume that they are used from the same thread they were launched on.
  At the moment we only support warmup for D3D. It only possible on windows
  and only if other flags do not prohibit this (e.g. OpenGL support requested).</div>
<a id="L70" name="L70"></a>  70 <em class="sharp">#undef</em> <a href="../R/2532.html" title="Multiple referred from 5 places.">ENABLE_AWT_PRELOAD</a>
<a id="L71" name="L71"></a>  71 <div class="comment">
/* turn off AWT preloading for javac, jar, etc */</div>
<div class="comment">
 CR6999872: fastdebug crashes if awt library is loaded before JVM is
     * initialized</div>
<a id="L74" name="L74"></a>  74 <em class="sharp">    #if</em> !<strong class="reserved">defined</strong>(DEBUG)
<a id="L75" name="L75"></a>  75 <em class="sharp">        #define</em> <a href="../R/2532.html" title="Multiple referred from 5 places.">ENABLE_AWT_PRELOAD</a>
<a id="L76" name="L76"></a>  76 <em class="sharp">    #endif</em>
<a id="L77" name="L77"></a>  77 <em class="sharp">#endif</em>
<a id="L78" name="L78"></a>  78 
<a id="L79" name="L79"></a>  79 <em class="sharp">#ifdef</em> <a href="../D/2746.html" title="Multiple defined in 2 places.">ENABLE_AWT_PRELOAD</a>
<div class="comment">
 "AWT was preloaded" flag;
  turned on by AWTPreload().</div>
<a id="L83" name="L83"></a>  83 <strong class="reserved">int</strong> awtPreloaded = 0;
<a id="L84" name="L84"></a>  84 
<div class="comment">
 Calls a function with the name specified
  the function must be int(*fn)(void).</div>
<a id="L88" name="L88"></a>  88 <strong class="reserved">int</strong> <a href="../S/1.html#L1290" title="Defined at 1290 in src/launcher/java_md.c.">AWTPreload</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *funcName);
<div class="comment">
 /* stops AWT preloading */</div>
<a id="L90" name="L90"></a>  90 <strong class="reserved">void</strong> <a href="../S/1.html#L1372" title="Defined at 1372 in src/launcher/java_md.c.">AWTPreloadStop</a>();
<a id="L91" name="L91"></a>  91 
<div class="comment">
 /* D3D preloading */</div>
<div class="comment">
 /* -1: not initialized; 0: OFF, 1: ON */</div>
<a id="L94" name="L94"></a>  94 <strong class="reserved">int</strong> awtPreloadD3D = -1;
<div class="comment">
 /* command line parameter to swith D3D preloading on */</div>
<a id="L96" name="L96"></a>  96 <em class="sharp">#define</em> <a href="../S/1.html#L236" title="Referred from 236 in src/launcher/java_md.c.">PARAM_PRELOAD_D3D</a> "-Dsun.awt.warmup"
<div class="comment">
 /* D3D/OpenGL management parameters */</div>
<a id="L98" name="L98"></a>  98 <em class="sharp">#define</em> <a href="../S/1.html#L242" title="Referred from 242 in src/launcher/java_md.c.">PARAM_NODDRAW</a> "-Dsun.java2d.noddraw"
<a id="L99" name="L99"></a>  99 <em class="sharp">#define</em> <a href="../S/1.html#L243" title="Referred from 243 in src/launcher/java_md.c.">PARAM_D3D</a> "-Dsun.java2d.d3d"
<a id="L100" name="L100"></a> 100 <em class="sharp">#define</em> <a href="../S/1.html#L244" title="Referred from 244 in src/launcher/java_md.c.">PARAM_OPENGL</a> "-Dsun.java2d.opengl"
<div class="comment">
 /* funtion in awt.dll (src/windows/native/sun/java2d/d3d/D3DPipelineManager.cpp) */</div>
<a id="L102" name="L102"></a> 102 <em class="sharp">#define</em> <a href="../S/1.html#L1212" title="Referred from 1212 in src/launcher/java_md.c.">D3D_PRELOAD_FUNC</a> "preloadD3D"
<a id="L103" name="L103"></a> 103 
<div class="comment">
 Extracts value of a parameter with the specified name
  from command line argument (returns pointer in the argument).
  Returns NULL if the argument does not contains the parameter.
  e.g.:
  GetParamValue("theParam", "theParam=value") returns pointer to "value".</div>
<a id="L110" name="L110"></a> 110 <strong class="reserved">const</strong> <strong class="reserved">char</strong> * <a href="../S/1.html#L128" title="Referred from 128 in src/launcher/java_md.c.">GetParamValue</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *paramName, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L111" name="L111"></a> 111     <strong class="reserved">int</strong> nameLen = <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(paramName);
<a id="L112" name="L112"></a> 112     <strong class="reserved">if</strong> (<a href="../S/9.html#L53" title="Defined at 53 in src/launcher/jli_util.h.">JLI_StrNCmp</a>(paramName, <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, nameLen) == 0) <em class="brace">{</em>
<div class="comment">
         /* arg[nameLen] is valid (may contain final NULL) */</div>
<a id="L114" name="L114"></a> 114         <strong class="reserved">if</strong> (<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>[nameLen] == '=') <em class="brace">{</em>
<a id="L115" name="L115"></a> 115             <strong class="reserved">return</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a> + nameLen + 1;
<a id="L116" name="L116"></a> 116         <em class="brace">}</em>
<a id="L117" name="L117"></a> 117     <em class="brace">}</em>
<a id="L118" name="L118"></a> 118     <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L119" name="L119"></a> 119 <em class="brace">}</em>
<a id="L120" name="L120"></a> 120 
<div class="comment">
 Checks if commandline argument contains property specified
  and analyze it as boolean property (true/false).
  Returns -1 if the argument does not contain the parameter;
  Returns 1 if the argument contains the parameter and its value is "true";
  Returns 0 if the argument contains the parameter and its value is "false".</div>
<a id="L127" name="L127"></a> 127 <strong class="reserved">int</strong> <a href="../R/3265.html" title="Multiple referred from 4 places.">GetBoolParamValue</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *paramName, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L128" name="L128"></a> 128     <strong class="reserved">const</strong> <strong class="reserved">char</strong> * paramValue = <a href="../S/1.html#L110" title="Defined at 110 in src/launcher/java_md.c.">GetParamValue</a>(paramName, <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L129" name="L129"></a> 129     <strong class="reserved">if</strong> (paramValue != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L130" name="L130"></a> 130         <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(paramValue, "true") == 0) <em class="brace">{</em>
<a id="L131" name="L131"></a> 131             <strong class="reserved">return</strong> 1;
<a id="L132" name="L132"></a> 132         <em class="brace">}</em>
<a id="L133" name="L133"></a> 133         <strong class="reserved">if</strong> (<a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(paramValue, "false") == 0) <em class="brace">{</em>
<a id="L134" name="L134"></a> 134             <strong class="reserved">return</strong> 0;
<a id="L135" name="L135"></a> 135         <em class="brace">}</em>
<a id="L136" name="L136"></a> 136     <em class="brace">}</em>
<a id="L137" name="L137"></a> 137     <strong class="reserved">return</strong> -1;
<a id="L138" name="L138"></a> 138 <em class="brace">}</em>
<a id="L139" name="L139"></a> 139 <div class="comment">
/* ENABLE_AWT_PRELOAD */</div>
<a id="L140" name="L140"></a> 140 
<a id="L141" name="L141"></a> 141 
<a id="L142" name="L142"></a> 142 <strong class="reserved">static</strong> jboolean _isjavaw = JNI_FALSE;
<a id="L143" name="L143"></a> 143 
<a id="L144" name="L144"></a> 144 
<a id="L145" name="L145"></a> 145 jboolean
<a id="L146" name="L146"></a> 146 <a href="../R/4036.html" title="Multiple referred from 5 places.">IsJavaw</a>()
<a id="L147" name="L147"></a> 147 <em class="brace">{</em>
<a id="L148" name="L148"></a> 148     <strong class="reserved">return</strong> _isjavaw;
<a id="L149" name="L149"></a> 149 <em class="brace">}</em>
<a id="L150" name="L150"></a> 150 
<div class="comment">
  Returns the arch path, to get the current arch use the
  macro GetArch, nbits here is ignored for now.</div>
<a id="L155" name="L155"></a> 155 <strong class="reserved">const</strong> <strong class="reserved">char</strong> *
<a id="L156" name="L156"></a> 156 <a href="../S/5.html#L117" title="Referred from 117 in src/launcher/java.h.">GetArchPath</a>(<strong class="reserved">int</strong> nbits)
<a id="L157" name="L157"></a> 157 <em class="brace">{</em>
<a id="L158" name="L158"></a> 158 <em class="sharp">#ifdef</em> _M_AMD64
<a id="L159" name="L159"></a> 159     <strong class="reserved">return</strong> "amd64";
<a id="L160" name="L160"></a> 160 <em class="sharp">#elif</em> <strong class="reserved">defined</strong>(_M_IA64)
<a id="L161" name="L161"></a> 161     <strong class="reserved">return</strong> "ia64";
<a id="L162" name="L162"></a> 162 <em class="sharp">#else</em>
<a id="L163" name="L163"></a> 163     <strong class="reserved">return</strong> "i386";
<a id="L164" name="L164"></a> 164 <em class="sharp">#endif</em>
<a id="L165" name="L165"></a> 165 <em class="brace">}</em>
<a id="L166" name="L166"></a> 166 
<div class="comment">
</div>
<a id="L170" name="L170"></a> 170 <strong class="reserved">void</strong>
<a id="L171" name="L171"></a> 171 <a href="../R/1799.html" title="Multiple referred from 2 places.">CreateExecutionEnvironment</a>(<strong class="reserved">int</strong> *pargc, <strong class="reserved">char</strong> ***pargv,
<a id="L172" name="L172"></a> 172                            <strong class="reserved">char</strong> *jrepath, jint so_jrepath,
<a id="L173" name="L173"></a> 173                            <strong class="reserved">char</strong> *jvmpath, jint so_jvmpath,
<a id="L174" name="L174"></a> 174                            <strong class="reserved">char</strong> *jvmcfg,  jint so_jvmcfg) <em class="brace">{</em>
<a id="L175" name="L175"></a> 175     <strong class="reserved">char</strong> * jvmtype;
<a id="L176" name="L176"></a> 176     <strong class="reserved">int</strong> i = 0;
<a id="L177" name="L177"></a> 177     <strong class="reserved">int</strong> running = <a href="../S/5.html#L53" title="Defined at 53 in src/launcher/java.h.">CURRENT_DATA_MODEL</a>;
<a id="L178" name="L178"></a> 178 
<a id="L179" name="L179"></a> 179     <strong class="reserved">int</strong> wanted = running;
<a id="L180" name="L180"></a> 180 
<a id="L181" name="L181"></a> 181     <strong class="reserved">char</strong>** argv = *pargv;
<a id="L182" name="L182"></a> 182     <strong class="reserved">for</strong> (i = 1; i &lt; *pargc ; i++) <em class="brace">{</em>
<a id="L183" name="L183"></a> 183         <strong class="reserved">if</strong> (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(argv[i], "-J-d64") == 0 || <a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(argv[i], "-d64") == 0) <em class="brace">{</em>
<a id="L184" name="L184"></a> 184             wanted = 64;
<a id="L185" name="L185"></a> 185             <strong class="reserved">continue</strong>;
<a id="L186" name="L186"></a> 186         <em class="brace">}</em>
<a id="L187" name="L187"></a> 187         <strong class="reserved">if</strong> (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(argv[i], "-J-d32") == 0 || <a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(argv[i], "-d32") == 0) <em class="brace">{</em>
<a id="L188" name="L188"></a> 188             wanted = 32;
<a id="L189" name="L189"></a> 189             <strong class="reserved">continue</strong>;
<a id="L190" name="L190"></a> 190         <em class="brace">}</em>
<a id="L191" name="L191"></a> 191 
<a id="L192" name="L192"></a> 192         <strong class="reserved">if</strong> (<a href="../S/15.html#L1965" title="Defined at 1965 in src/launcher/java.c.">IsJavaArgs</a>() &amp;&amp; argv[i][0] != '-')
<a id="L193" name="L193"></a> 193             <strong class="reserved">continue</strong>;
<a id="L194" name="L194"></a> 194         <strong class="reserved">if</strong> (argv[i][0] != '-')
<a id="L195" name="L195"></a> 195             <strong class="reserved">break</strong>;
<a id="L196" name="L196"></a> 196     <em class="brace">}</em>
<a id="L197" name="L197"></a> 197     <strong class="reserved">if</strong> (running != wanted) <em class="brace">{</em>
<a id="L198" name="L198"></a> 198         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L79" title="Defined at 79 in src/launcher/emessages.h.">JRE_ERROR2</a>, wanted);
<a id="L199" name="L199"></a> 199         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(1);
<a id="L200" name="L200"></a> 200     <em class="brace">}</em>
<a id="L201" name="L201"></a> 201 
<div class="comment">
     /* Find out where the JRE is that we will be using. */</div>
<a id="L203" name="L203"></a> 203     <strong class="reserved">if</strong> (!<a href="../S/1.html#L309" title="Defined at 309 in src/launcher/java_md.c.">GetJREPath</a>(jrepath, so_jrepath)) <em class="brace">{</em>
<a id="L204" name="L204"></a> 204         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L78" title="Defined at 78 in src/launcher/emessages.h.">JRE_ERROR1</a>);
<a id="L205" name="L205"></a> 205         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(2);
<a id="L206" name="L206"></a> 206     <em class="brace">}</em>
<a id="L207" name="L207"></a> 207 
<a id="L208" name="L208"></a> 208     <a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(jvmcfg, so_jvmcfg, "%s%slib%s%s%sjvm.cfg",
<a id="L209" name="L209"></a> 209         jrepath, <a href="../S/10.html#L36" title="Defined at 36 in src/launcher/java_md.h.">FILESEP</a>, <a href="../S/10.html#L36" title="Defined at 36 in src/launcher/java_md.h.">FILESEP</a>, (<strong class="reserved">char</strong>*)<a href="../S/5.html#L117" title="Defined at 117 in src/launcher/java.h.">GetArch</a>(), <a href="../S/10.html#L36" title="Defined at 36 in src/launcher/java_md.h.">FILESEP</a>);
<a id="L210" name="L210"></a> 210 
<div class="comment">
     /* Find the specified JVM type */</div>
<a id="L212" name="L212"></a> 212     <strong class="reserved">if</strong> (<a href="../S/15.html#L1698" title="Defined at 1698 in src/launcher/java.c.">ReadKnownVMs</a>(jvmcfg, JNI_FALSE) &lt; 1) <em class="brace">{</em>
<a id="L213" name="L213"></a> 213         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L71" title="Defined at 71 in src/launcher/emessages.h.">CFG_ERROR7</a>);
<a id="L214" name="L214"></a> 214         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(1);
<a id="L215" name="L215"></a> 215     <em class="brace">}</em>
<a id="L216" name="L216"></a> 216 
<a id="L217" name="L217"></a> 217     jvmtype = <a href="../S/15.html#L495" title="Defined at 495 in src/launcher/java.c.">CheckJvmType</a>(pargc, pargv, JNI_FALSE);
<a id="L218" name="L218"></a> 218     <strong class="reserved">if</strong> (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(jvmtype, "ERROR") == 0) <em class="brace">{</em>
<a id="L219" name="L219"></a> 219         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L73" title="Defined at 73 in src/launcher/emessages.h.">CFG_ERROR9</a>);
<a id="L220" name="L220"></a> 220         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(4);
<a id="L221" name="L221"></a> 221     <em class="brace">}</em>
<a id="L222" name="L222"></a> 222 
<a id="L223" name="L223"></a> 223     jvmpath[0] = '\0';
<a id="L224" name="L224"></a> 224     <strong class="reserved">if</strong> (!<a href="../S/1.html#L352" title="Defined at 352 in src/launcher/java_md.c.">GetJVMPath</a>(jrepath, jvmtype, jvmpath, so_jvmpath)) <em class="brace">{</em>
<a id="L225" name="L225"></a> 225         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L72" title="Defined at 72 in src/launcher/emessages.h.">CFG_ERROR8</a>, jvmtype, jvmpath);
<a id="L226" name="L226"></a> 226         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(4);
<a id="L227" name="L227"></a> 227     <em class="brace">}</em>
<div class="comment">
     /* If we got here, jvmpath has been correctly initialized. */</div>
<a id="L229" name="L229"></a> 229 
<div class="comment">
     /* Check if we need preload AWT */</div>
<a id="L231" name="L231"></a> 231 <em class="sharp">#ifdef</em> <a href="../D/2746.html" title="Multiple defined in 2 places.">ENABLE_AWT_PRELOAD</a>
<a id="L232" name="L232"></a> 232     argv = *pargv;
<a id="L233" name="L233"></a> 233     <strong class="reserved">for</strong> (i = 0; i &lt; *pargc ; i++) <em class="brace">{</em>
<div class="comment">
         /* Tests the "turn on" parameter only if not set yet. */</div>
<a id="L235" name="L235"></a> 235         <strong class="reserved">if</strong> (awtPreloadD3D &lt; 0) <em class="brace">{</em>
<a id="L236" name="L236"></a> 236             <strong class="reserved">if</strong> (<a href="../S/1.html#L127" title="Defined at 127 in src/launcher/java_md.c.">GetBoolParamValue</a>(<a href="../S/1.html#L96" title="Defined at 96 in src/launcher/java_md.c.">PARAM_PRELOAD_D3D</a>, argv[i]) == 1) <em class="brace">{</em>
<a id="L237" name="L237"></a> 237                 awtPreloadD3D = 1;
<a id="L238" name="L238"></a> 238             <em class="brace">}</em>
<a id="L239" name="L239"></a> 239         <em class="brace">}</em>
<div class="comment">
         /* Test parameters which can disable preloading if not already disabled. */</div>
<a id="L241" name="L241"></a> 241         <strong class="reserved">if</strong> (awtPreloadD3D != 0) <em class="brace">{</em>
<a id="L242" name="L242"></a> 242             <strong class="reserved">if</strong> (<a href="../S/1.html#L127" title="Defined at 127 in src/launcher/java_md.c.">GetBoolParamValue</a>(<a href="../S/1.html#L98" title="Defined at 98 in src/launcher/java_md.c.">PARAM_NODDRAW</a>, argv[i]) == 1
<a id="L243" name="L243"></a> 243                 || <a href="../S/1.html#L127" title="Defined at 127 in src/launcher/java_md.c.">GetBoolParamValue</a>(<a href="../S/1.html#L99" title="Defined at 99 in src/launcher/java_md.c.">PARAM_D3D</a>, argv[i]) == 0
<a id="L244" name="L244"></a> 244                 || <a href="../S/1.html#L127" title="Defined at 127 in src/launcher/java_md.c.">GetBoolParamValue</a>(<a href="../S/1.html#L100" title="Defined at 100 in src/launcher/java_md.c.">PARAM_OPENGL</a>, argv[i]) == 1)
<a id="L245" name="L245"></a> 245             <em class="brace">{</em>
<a id="L246" name="L246"></a> 246                 awtPreloadD3D = 0;
<div class="comment">
                 /* no need to test the rest of the parameters */</div>
<a id="L248" name="L248"></a> 248                 <strong class="reserved">break</strong>;
<a id="L249" name="L249"></a> 249             <em class="brace">}</em>
<a id="L250" name="L250"></a> 250         <em class="brace">}</em>
<a id="L251" name="L251"></a> 251     <em class="brace">}</em>
<a id="L252" name="L252"></a> 252 <div class="comment">
/* ENABLE_AWT_PRELOAD */</div>
<a id="L253" name="L253"></a> 253 <em class="brace">}</em>
<a id="L254" name="L254"></a> 254 
<a id="L255" name="L255"></a> 255 
<a id="L256" name="L256"></a> 256 <strong class="reserved">static</strong> jboolean
<a id="L257" name="L257"></a> 257 <a href="../R/4670.html" title="Multiple referred from 2 places.">LoadMSVCRT</a>()
<a id="L258" name="L258"></a> 258 <em class="brace">{</em>
<a id="L259" name="L259"></a> 259     <em class="comment">// Only do this once</em>
<a id="L260" name="L260"></a> 260     <strong class="reserved">static</strong> <strong class="reserved">int</strong> loaded = 0;
<a id="L261" name="L261"></a> 261     <strong class="reserved">char</strong> crtpath[<a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>];
<a id="L262" name="L262"></a> 262 
<a id="L263" name="L263"></a> 263     <strong class="reserved">if</strong> (!loaded) <em class="brace">{</em>
<div class="comment">
          The Microsoft C Runtime Library needs to be loaded first.  A copy is
          assumed to be present in the "JRE path" directory.  If it is not found
          there (or "JRE path" fails to resolve), skip the explicit load and let
          nature take its course, which is likely to be a failure to execute.
          This is clearly completely specific to the exact compiler version
          which isn't very nice, but its hardly the only place.
          No attempt to look for compiler versions in between 2003 and 2010
          as we aren't supporting building with those.</div>
<a id="L274" name="L274"></a> 274 <em class="sharp">#ifdef</em> _MSC_VER
<a id="L275" name="L275"></a> 275 <em class="sharp">#if</em> _MSC_VER &lt; 1400
<a id="L276" name="L276"></a> 276 <em class="sharp">#define</em> <a href="../R/1105.html" title="Multiple referred from 3 places.">CRT_DLL</a> "msvcr71.dll"
<a id="L277" name="L277"></a> 277 <em class="sharp">#endif</em>
<a id="L278" name="L278"></a> 278 <em class="sharp">#if</em> _MSC_VER &gt;= 1600
<a id="L279" name="L279"></a> 279 <em class="sharp">#define</em> <a href="../R/1105.html" title="Multiple referred from 3 places.">CRT_DLL</a> "msvcr100.dll"
<a id="L280" name="L280"></a> 280 <em class="sharp">#endif</em>
<a id="L281" name="L281"></a> 281 <em class="sharp">#ifdef</em> <a href="../D/1206.html" title="Multiple defined in 2 places.">CRT_DLL</a>
<a id="L282" name="L282"></a> 282         <strong class="reserved">if</strong> (<a href="../S/1.html#L309" title="Defined at 309 in src/launcher/java_md.c.">GetJREPath</a>(crtpath, <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>)) <em class="brace">{</em>
<a id="L283" name="L283"></a> 283             <strong class="reserved">if</strong> (<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(crtpath) + <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>("\\bin\\") +
<a id="L284" name="L284"></a> 284                     <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(<a href="../D/1206.html" title="Multiple defined in 2 places.">CRT_DLL</a>) &gt;= <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>) <em class="brace">{</em>
<a id="L285" name="L285"></a> 285                 <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L88" title="Defined at 88 in src/launcher/emessages.h.">JRE_ERROR11</a>);
<a id="L286" name="L286"></a> 286                 <strong class="reserved">return</strong> JNI_FALSE;
<a id="L287" name="L287"></a> 287             <em class="brace">}</em>
<a id="L288" name="L288"></a> 288             (<strong class="reserved">void</strong>)<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(crtpath, "\\bin\\" <div class="comment">
/* Add crt dll */</div>
<a id="L289" name="L289"></a> 289             <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("CRT path is %s\n", crtpath);
<a id="L290" name="L290"></a> 290             <strong class="reserved">if</strong> (_access(crtpath, 0) == 0) <em class="brace">{</em>
<a id="L291" name="L291"></a> 291                 <strong class="reserved">if</strong> (LoadLibrary(crtpath) == 0) <em class="brace">{</em>
<a id="L292" name="L292"></a> 292                     <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L95" title="Defined at 95 in src/launcher/emessages.h.">DLL_ERROR4</a>, crtpath);
<a id="L293" name="L293"></a> 293                     <strong class="reserved">return</strong> JNI_FALSE;
<a id="L294" name="L294"></a> 294                 <em class="brace">}</em>
<a id="L295" name="L295"></a> 295             <em class="brace">}</em>
<a id="L296" name="L296"></a> 296         <em class="brace">}</em>
<a id="L297" name="L297"></a> 297 <div class="comment">
/* CRT_DLL */</div>
<a id="L298" name="L298"></a> 298 <div class="comment">
/* _MSC_VER */</div>
<a id="L299" name="L299"></a> 299         loaded = 1;
<a id="L300" name="L300"></a> 300     <em class="brace">}</em>
<a id="L301" name="L301"></a> 301     <strong class="reserved">return</strong> JNI_TRUE;
<a id="L302" name="L302"></a> 302 <em class="brace">}</em>
<a id="L303" name="L303"></a> 303 
<a id="L304" name="L304"></a> 304 
<div class="comment">
  Find path to JRE based on .exe's location or registry settings.</div>
<a id="L308" name="L308"></a> 308 jboolean
<a id="L309" name="L309"></a> 309 <a href="../R/3275.html" title="Multiple referred from 5 places.">GetJREPath</a>(<strong class="reserved">char</strong> *path, jint pathsize)
<a id="L310" name="L310"></a> 310 <em class="brace">{</em>
<a id="L311" name="L311"></a> 311     <strong class="reserved">char</strong> javadll[<a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>];
<a id="L312" name="L312"></a> 312     <strong class="reserved">struct</strong> stat s;
<a id="L313" name="L313"></a> 313 
<a id="L314" name="L314"></a> 314     <strong class="reserved">if</strong> (<a href="../S/1.html#L411" title="Defined at 411 in src/launcher/java_md.c.">GetApplicationHome</a>(path, pathsize)) <em class="brace">{</em>
<div class="comment">
         /* Is JRE co-located with the application? */</div>
<a id="L316" name="L316"></a> 316         <a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(javadll, <strong class="reserved">sizeof</strong>(javadll), "%s\\bin\\" <a href="../S/1.html#L43" title="Defined at 43 in src/launcher/java_md.c.">JAVA_DLL</a>, path);
<a id="L317" name="L317"></a> 317         <strong class="reserved">if</strong> (stat(javadll, &amp;s) == 0) <em class="brace">{</em>
<a id="L318" name="L318"></a> 318             <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("JRE path is %s\n", path);
<a id="L319" name="L319"></a> 319             <strong class="reserved">return</strong> JNI_TRUE;
<a id="L320" name="L320"></a> 320         <em class="brace">}</em>
<div class="comment">
         /* ensure storage for path + \jre + NULL */</div>
<a id="L322" name="L322"></a> 322         <strong class="reserved">if</strong> ((<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(path) + 4 + 1) &gt; pathsize) <em class="brace">{</em>
<a id="L323" name="L323"></a> 323             <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("Insufficient space to store JRE path\n");
<a id="L324" name="L324"></a> 324             <strong class="reserved">return</strong> JNI_FALSE;
<a id="L325" name="L325"></a> 325         <em class="brace">}</em>
<div class="comment">
         /* Does this app ship a private JRE in <apphome>\jre directory? */</apphome></div>
<a id="L327" name="L327"></a> 327         <a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(javadll, <strong class="reserved">sizeof</strong> (javadll), "%s\\jre\\bin\\" <a href="../S/1.html#L43" title="Defined at 43 in src/launcher/java_md.c.">JAVA_DLL</a>, path);
<a id="L328" name="L328"></a> 328         <strong class="reserved">if</strong> (stat(javadll, &amp;s) == 0) <em class="brace">{</em>
<a id="L329" name="L329"></a> 329             <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(path, "\\jre");
<a id="L330" name="L330"></a> 330             <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("JRE path is %s\n", path);
<a id="L331" name="L331"></a> 331             <strong class="reserved">return</strong> JNI_TRUE;
<a id="L332" name="L332"></a> 332         <em class="brace">}</em>
<a id="L333" name="L333"></a> 333     <em class="brace">}</em>
<a id="L334" name="L334"></a> 334 
<div class="comment">
     /* Look for a public JRE on this machine. */</div>
<a id="L336" name="L336"></a> 336     <strong class="reserved">if</strong> (<a href="../S/1.html#L448" title="Defined at 448 in src/launcher/java_md.c.">GetPublicJREHome</a>(path, pathsize)) <em class="brace">{</em>
<a id="L337" name="L337"></a> 337         <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("JRE path is %s\n", path);
<a id="L338" name="L338"></a> 338         <strong class="reserved">return</strong> JNI_TRUE;
<a id="L339" name="L339"></a> 339     <em class="brace">}</em>
<a id="L340" name="L340"></a> 340 
<a id="L341" name="L341"></a> 341     <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L85" title="Defined at 85 in src/launcher/emessages.h.">JRE_ERROR8</a> <a href="../S/1.html#L43" title="Defined at 43 in src/launcher/java_md.c.">JAVA_DLL</a>);
<a id="L342" name="L342"></a> 342     <strong class="reserved">return</strong> JNI_FALSE;
<a id="L343" name="L343"></a> 343 
<a id="L344" name="L344"></a> 344 <em class="brace">}</em>
<a id="L345" name="L345"></a> 345 
<div class="comment">
  Given a JRE location and a JVM type, construct what the name the
  JVM shared library will be.  Return true, if such a library
  exists, false otherwise.</div>
<a id="L351" name="L351"></a> 351 <strong class="reserved">static</strong> jboolean
<a id="L352" name="L352"></a> 352 <a href="../R/3276.html" title="Multiple referred from 2 places.">GetJVMPath</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *jrepath, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *jvmtype,
<a id="L353" name="L353"></a> 353            <strong class="reserved">char</strong> *jvmpath, jint jvmpathsize)
<a id="L354" name="L354"></a> 354 <em class="brace">{</em>
<a id="L355" name="L355"></a> 355     <strong class="reserved">struct</strong> stat s;
<a id="L356" name="L356"></a> 356     <strong class="reserved">if</strong> (<a href="../S/9.html#L50" title="Defined at 50 in src/launcher/jli_util.h.">JLI_StrChr</a>(jvmtype, '/') || <a href="../S/9.html#L50" title="Defined at 50 in src/launcher/jli_util.h.">JLI_StrChr</a>(jvmtype, '\\')) <em class="brace">{</em>
<a id="L357" name="L357"></a> 357         <a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(jvmpath, jvmpathsize, "%s\\" <a href="../S/1.html#L42" title="Defined at 42 in src/launcher/java_md.c.">JVM_DLL</a>, jvmtype);
<a id="L358" name="L358"></a> 358     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L359" name="L359"></a> 359         <a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(jvmpath, jvmpathsize, "%s\\bin\\%s\\" <a href="../S/1.html#L42" title="Defined at 42 in src/launcher/java_md.c.">JVM_DLL</a>,
<a id="L360" name="L360"></a> 360                      jrepath, jvmtype);
<a id="L361" name="L361"></a> 361     <em class="brace">}</em>
<a id="L362" name="L362"></a> 362     <strong class="reserved">if</strong> (stat(jvmpath, &amp;s) == 0) <em class="brace">{</em>
<a id="L363" name="L363"></a> 363         <strong class="reserved">return</strong> JNI_TRUE;
<a id="L364" name="L364"></a> 364     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L365" name="L365"></a> 365         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L366" name="L366"></a> 366     <em class="brace">}</em>
<a id="L367" name="L367"></a> 367 <em class="brace">}</em>
<a id="L368" name="L368"></a> 368 
<div class="comment">
  Load a jvm from "jvmpath" and initialize the invocation functions.</div>
<a id="L372" name="L372"></a> 372 jboolean
<a id="L373" name="L373"></a> 373 <a href="../R/4669.html" title="Multiple referred from 2 places.">LoadJavaVM</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *jvmpath, <a href="../S/5.html#L88" title="Defined at 88 in src/launcher/java.h.">InvocationFunctions</a> *ifn)
<a id="L374" name="L374"></a> 374 <em class="brace">{</em>
<a id="L375" name="L375"></a> 375     HINSTANCE <a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>;
<a id="L376" name="L376"></a> 376 
<a id="L377" name="L377"></a> 377     <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("JVM path is %s\n", jvmpath);
<a id="L378" name="L378"></a> 378 
<div class="comment">
      The Microsoft C Runtime Library needs to be loaded first.  A copy is
      assumed to be present in the "JRE path" directory.  If it is not found
      there (or "JRE path" fails to resolve), skip the explicit load and let
      nature take its course, which is likely to be a failure to execute.</div>
<a id="L386" name="L386"></a> 386     <a href="../S/1.html#L257" title="Defined at 257 in src/launcher/java_md.c.">LoadMSVCRT</a>();
<a id="L387" name="L387"></a> 387 
<div class="comment">
     /* Load the Java VM DLL */</div>
<a id="L389" name="L389"></a> 389     <strong class="reserved">if</strong> ((<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a> = LoadLibrary(jvmpath)) == 0) <em class="brace">{</em>
<a id="L390" name="L390"></a> 390         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L95" title="Defined at 95 in src/launcher/emessages.h.">DLL_ERROR4</a>, (<strong class="reserved">char</strong> *)jvmpath);
<a id="L391" name="L391"></a> 391         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L392" name="L392"></a> 392     <em class="brace">}</em>
<a id="L393" name="L393"></a> 393 
<div class="comment">
     /* Now get the function addresses */</div>
<a id="L395" name="L395"></a> 395     ifn-&gt;CreateJavaVM =
<a id="L396" name="L396"></a> 396         (<strong class="reserved">void</strong> *)GetProcAddress(<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>, "JNI_CreateJavaVM");
<a id="L397" name="L397"></a> 397     ifn-&gt;GetDefaultJavaVMInitArgs =
<a id="L398" name="L398"></a> 398         (<strong class="reserved">void</strong> *)GetProcAddress(<a href="../D/23942.html" title="Multiple defined in 13 places.">handle</a>, "JNI_GetDefaultJavaVMInitArgs");
<a id="L399" name="L399"></a> 399     <strong class="reserved">if</strong> (ifn-&gt;CreateJavaVM == 0 || ifn-&gt;GetDefaultJavaVMInitArgs == 0) <em class="brace">{</em>
<a id="L400" name="L400"></a> 400         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L37" title="Defined at 37 in src/launcher/emessages.h.">JNI_ERROR1</a>, (<strong class="reserved">char</strong> *)jvmpath);
<a id="L401" name="L401"></a> 401         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L402" name="L402"></a> 402     <em class="brace">}</em>
<a id="L403" name="L403"></a> 403 
<a id="L404" name="L404"></a> 404     <strong class="reserved">return</strong> JNI_TRUE;
<a id="L405" name="L405"></a> 405 <em class="brace">}</em>
<a id="L406" name="L406"></a> 406 
<div class="comment">
  If app is "c:\foo\bin\javac", then put "c:\foo" into buf.</div>
<a id="L410" name="L410"></a> 410 jboolean
<a id="L411" name="L411"></a> 411 <a href="../R/3262.html" title="Multiple referred from 3 places.">GetApplicationHome</a>(<strong class="reserved">char</strong> *<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, jint bufsize)
<a id="L412" name="L412"></a> 412 <em class="brace">{</em>
<a id="L413" name="L413"></a> 413     <strong class="reserved">char</strong> *cp;
<a id="L414" name="L414"></a> 414     GetModuleFileName(0, <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, bufsize);
<a id="L415" name="L415"></a> 415     *<a href="../S/9.html#L51" title="Defined at 51 in src/launcher/jli_util.h.">JLI_StrRChr</a>(<div class="comment">
'; /* remove .exe file name */</div>
<a id="L416" name="L416"></a> 416     <strong class="reserved">if</strong> ((cp = <a href="../S/9.html#L51" title="Defined at 51 in src/launcher/jli_util.h.">JLI_StrRChr</a>(<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, '\\')) == 0) <em class="brace">{</em>
<div class="comment">
 This happens if the application is in a drive root, and
         * there is no bin directory. </div>
<a id="L419" name="L419"></a> 419         <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>[0] = '\0';
<a id="L420" name="L420"></a> 420         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L421" name="L421"></a> 421     <em class="brace">}</em>
<div class="comment">
     *cp = '\0';  /* remove the bin\ part */</div>
<a id="L423" name="L423"></a> 423     <strong class="reserved">return</strong> JNI_TRUE;
<a id="L424" name="L424"></a> 424 <em class="brace">}</em>
<a id="L425" name="L425"></a> 425 
<div class="comment">
  Helpers to look in the registry for a public JRE.</div>
<div class="comment">
                     /* Same for 1.5.0, 1.5.1, 1.5.2 etc. */</div>
<a id="L430" name="L430"></a> 430 <em class="sharp">#define</em> <a href="../R/4243.html" title="Multiple referred from 7 places.">JRE_KEY</a>     "Software\\JavaSoft\\Java Runtime Environment"
<a id="L431" name="L431"></a> 431 
<a id="L432" name="L432"></a> 432 <strong class="reserved">static</strong> jboolean
<a id="L433" name="L433"></a> 433 <a href="../R/3289.html" title="Multiple referred from 3 places.">GetStringFromRegistry</a>(HKEY <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <strong class="reserved">char</strong> *<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, jint bufsize)
<a id="L434" name="L434"></a> 434 <em class="brace">{</em>
<a id="L435" name="L435"></a> 435     DWORD <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>, <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L436" name="L436"></a> 436 
<a id="L437" name="L437"></a> 437     <strong class="reserved">if</strong> (RegQueryValueEx(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, 0, &amp;<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>, 0, &amp;<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>) == 0
<a id="L438" name="L438"></a> 438         &amp;&amp; <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> == REG_SZ
<a id="L439" name="L439"></a> 439         &amp;&amp; (<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> &lt; (<strong class="reserved">unsigned</strong> <strong class="reserved">int</strong>)bufsize)) <em class="brace">{</em>
<a id="L440" name="L440"></a> 440         <strong class="reserved">if</strong> (RegQueryValueEx(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, 0, 0, <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, &amp;<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>) == 0) <em class="brace">{</em>
<a id="L441" name="L441"></a> 441             <strong class="reserved">return</strong> JNI_TRUE;
<a id="L442" name="L442"></a> 442         <em class="brace">}</em>
<a id="L443" name="L443"></a> 443     <em class="brace">}</em>
<a id="L444" name="L444"></a> 444     <strong class="reserved">return</strong> JNI_FALSE;
<a id="L445" name="L445"></a> 445 <em class="brace">}</em>
<a id="L446" name="L446"></a> 446 
<a id="L447" name="L447"></a> 447 <strong class="reserved">static</strong> jboolean
<a id="L448" name="L448"></a> 448 <a href="../R/3287.html" title="Multiple referred from 2 places.">GetPublicJREHome</a>(<strong class="reserved">char</strong> *<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, jint bufsize)
<a id="L449" name="L449"></a> 449 <em class="brace">{</em>
<a id="L450" name="L450"></a> 450     HKEY <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, subkey;
<a id="L451" name="L451"></a> 451     <strong class="reserved">char</strong> <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>[<a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>];
<a id="L452" name="L452"></a> 452 
<div class="comment">
      Note: There is a very similar implementation of the following
      registry reading code in the Windows java control panel (javacp.cpl).
      If there are bugs here, a similar bug probably exists there.  Hence,
      changes here require inspection there.</div>
<a id="L459" name="L459"></a> 459 
<div class="comment">
     /* Find the current version of the JRE */</div>
<a id="L461" name="L461"></a> 461     <strong class="reserved">if</strong> (RegOpenKeyEx(HKEY_LOCAL_MACHINE, <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>, 0, KEY_READ, &amp;<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>) != 0) <em class="brace">{</em>
<a id="L462" name="L462"></a> 462         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L97" title="Defined at 97 in src/launcher/emessages.h.">REG_ERROR1</a>, <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>);
<a id="L463" name="L463"></a> 463         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L464" name="L464"></a> 464     <em class="brace">}</em>
<a id="L465" name="L465"></a> 465 
<a id="L466" name="L466"></a> 466     <strong class="reserved">if</strong> (!<a href="../S/1.html#L433" title="Defined at 433 in src/launcher/java_md.c.">GetStringFromRegistry</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, "CurrentVersion",
<a id="L467" name="L467"></a> 467                                <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>, <strong class="reserved">sizeof</strong>(<a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>))) <em class="brace">{</em>
<a id="L468" name="L468"></a> 468         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L98" title="Defined at 98 in src/launcher/emessages.h.">REG_ERROR2</a>, <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>);
<a id="L469" name="L469"></a> 469         RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L470" name="L470"></a> 470         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L471" name="L471"></a> 471     <em class="brace">}</em>
<a id="L472" name="L472"></a> 472 
<a id="L473" name="L473"></a> 473     <strong class="reserved">if</strong> (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(<a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>, <a href="../S/15.html#L1935" title="Defined at 1935 in src/launcher/java.c.">GetDotVersion</a>()) != 0) <em class="brace">{</em>
<a id="L474" name="L474"></a> 474         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L99" title="Defined at 99 in src/launcher/emessages.h.">REG_ERROR3</a>, <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>, <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>, <a href="../S/15.html#L1935" title="Defined at 1935 in src/launcher/java.c.">GetDotVersion</a>()
<a id="L475" name="L475"></a> 475         );
<a id="L476" name="L476"></a> 476         RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L477" name="L477"></a> 477         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L478" name="L478"></a> 478     <em class="brace">}</em>
<a id="L479" name="L479"></a> 479 
<div class="comment">
     /* Find directory where the current version is installed. */</div>
<a id="L481" name="L481"></a> 481     <strong class="reserved">if</strong> (RegOpenKeyEx(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>, 0, KEY_READ, &amp;subkey) != 0) <em class="brace">{</em>
<a id="L482" name="L482"></a> 482         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L97" title="Defined at 97 in src/launcher/emessages.h.">REG_ERROR1</a>, <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>, <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>);
<a id="L483" name="L483"></a> 483         RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L484" name="L484"></a> 484         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L485" name="L485"></a> 485     <em class="brace">}</em>
<a id="L486" name="L486"></a> 486 
<a id="L487" name="L487"></a> 487     <strong class="reserved">if</strong> (!<a href="../S/1.html#L433" title="Defined at 433 in src/launcher/java_md.c.">GetStringFromRegistry</a>(subkey, "JavaHome", <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, bufsize)) <em class="brace">{</em>
<a id="L488" name="L488"></a> 488         <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L100" title="Defined at 100 in src/launcher/emessages.h.">REG_ERROR4</a>, <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>, <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>);
<a id="L489" name="L489"></a> 489         RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L490" name="L490"></a> 490         RegCloseKey(subkey);
<a id="L491" name="L491"></a> 491         <strong class="reserved">return</strong> JNI_FALSE;
<a id="L492" name="L492"></a> 492     <em class="brace">}</em>
<a id="L493" name="L493"></a> 493 
<a id="L494" name="L494"></a> 494     <strong class="reserved">if</strong> (<a href="../S/16.html#L112" title="Defined at 112 in src/launcher/jli_util.c.">JLI_IsTraceLauncher</a>()) <em class="brace">{</em>
<a id="L495" name="L495"></a> 495         <strong class="reserved">char</strong> micro[<a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>];
<a id="L496" name="L496"></a> 496         <strong class="reserved">if</strong> (!<a href="../S/1.html#L433" title="Defined at 433 in src/launcher/java_md.c.">GetStringFromRegistry</a>(subkey, "MicroVersion", micro,
<a id="L497" name="L497"></a> 497                                    <strong class="reserved">sizeof</strong>(micro))) <em class="brace">{</em>
<a id="L498" name="L498"></a> 498             <a href="../D/29724.html" title="Multiple defined in 5 places.">printf</a>("Warning: Can't read MicroVersion\n");
<a id="L499" name="L499"></a> 499             micro[0] = '\0';
<a id="L500" name="L500"></a> 500         <em class="brace">}</em>
<a id="L501" name="L501"></a> 501         <a href="../D/29724.html" title="Multiple defined in 5 places.">printf</a>("Version major.minor.micro = %s.%s\n", <a href="../D/36409.html" title="Multiple defined in 4 places.">version</a>, micro);
<a id="L502" name="L502"></a> 502     <em class="brace">}</em>
<a id="L503" name="L503"></a> 503 
<a id="L504" name="L504"></a> 504     RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L505" name="L505"></a> 505     RegCloseKey(subkey);
<a id="L506" name="L506"></a> 506     <strong class="reserved">return</strong> JNI_TRUE;
<a id="L507" name="L507"></a> 507 <em class="brace">}</em>
<a id="L508" name="L508"></a> 508 
<div class="comment">
  Support for doing cheap, accurate interval timing.</div>
<a id="L512" name="L512"></a> 512 <strong class="reserved">static</strong> jboolean counterAvailable = JNI_FALSE;
<a id="L513" name="L513"></a> 513 <strong class="reserved">static</strong> jboolean counterInitialized = JNI_FALSE;
<a id="L514" name="L514"></a> 514 <strong class="reserved">static</strong> LARGE_INTEGER counterFrequency;
<a id="L515" name="L515"></a> 515 
<a id="L516" name="L516"></a> 516 jlong <a href="../R/1791.html" title="Multiple referred from 9 places.">CounterGet</a>()
<a id="L517" name="L517"></a> 517 <em class="brace">{</em>
<a id="L518" name="L518"></a> 518     LARGE_INTEGER <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L519" name="L519"></a> 519 
<a id="L520" name="L520"></a> 520     <strong class="reserved">if</strong> (!counterInitialized) <em class="brace">{</em>
<a id="L521" name="L521"></a> 521         counterAvailable = QueryPerformanceFrequency(&amp;counterFrequency);
<a id="L522" name="L522"></a> 522         counterInitialized = JNI_TRUE;
<a id="L523" name="L523"></a> 523     <em class="brace">}</em>
<a id="L524" name="L524"></a> 524     <strong class="reserved">if</strong> (!counterAvailable) <em class="brace">{</em>
<a id="L525" name="L525"></a> 525         <strong class="reserved">return</strong> 0;
<a id="L526" name="L526"></a> 526     <em class="brace">}</em>
<a id="L527" name="L527"></a> 527     QueryPerformanceCounter(&amp;<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>);
<a id="L528" name="L528"></a> 528     <strong class="reserved">return</strong> (jlong)(<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>.QuadPart);
<a id="L529" name="L529"></a> 529 <em class="brace">}</em>
<a id="L530" name="L530"></a> 530 
<a id="L531" name="L531"></a> 531 jlong <a href="../R/1788.html" title="Multiple referred from 5 places.">Counter2Micros</a>(jlong counts)
<a id="L532" name="L532"></a> 532 <em class="brace">{</em>
<a id="L533" name="L533"></a> 533     <strong class="reserved">if</strong> (!counterAvailable || !counterInitialized) <em class="brace">{</em>
<a id="L534" name="L534"></a> 534         <strong class="reserved">return</strong> 0;
<a id="L535" name="L535"></a> 535     <em class="brace">}</em>
<a id="L536" name="L536"></a> 536     <strong class="reserved">return</strong> (counts * 1000 * 1000)/counterFrequency.QuadPart;
<a id="L537" name="L537"></a> 537 <em class="brace">}</em>
<div class="comment">
  windows snprintf does not guarantee a null terminator in the buffer,
  if the computed size is equal to or greater than the buffer size,
  as well as error conditions. This function guarantees a null terminator
  under all these conditions. An unreasonable buffer or size will return
  an error value. Under all other conditions this function will return the
  size of the bytes actually written minus the null terminator, similar
  to ansi snprintf api. Thus when calling this function the caller must
  ensure storage for the null terminator.</div>
<a id="L548" name="L548"></a> 548 <strong class="reserved">int</strong>
<a id="L549" name="L549"></a> 549 <a href="../R/4164.html" title="Multiple referred from 10 places.">JLI_Snprintf</a>(<strong class="reserved">char</strong>* <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, size_t <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>, <strong class="reserved">const</strong> <strong class="reserved">char</strong>* <a href="../D/16531.html" title="Multiple defined in 87 places.">format</a>, ...) <em class="brace">{</em>
<a id="L550" name="L550"></a> 550     <strong class="reserved">int</strong> rc;
<a id="L551" name="L551"></a> 551     va_list vl;
<a id="L552" name="L552"></a> 552     <strong class="reserved">if</strong> (<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> == 0 || <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a> == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L553" name="L553"></a> 553         <strong class="reserved">return</strong> -1;
<a id="L554" name="L554"></a> 554     <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[0] = '\0';
<a id="L555" name="L555"></a> 555     va_start(vl, <a href="../D/16531.html" title="Multiple defined in 87 places.">format</a>);
<a id="L556" name="L556"></a> 556     rc = vsnprintf(<a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>, <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>, <a href="../D/16531.html" title="Multiple defined in 87 places.">format</a>, vl);
<a id="L557" name="L557"></a> 557     va_end(vl);
<div class="comment">
     /* force a null terminator, if something is amiss */</div>
<a id="L559" name="L559"></a> 559     <strong class="reserved">if</strong> (rc &lt; 0) <em class="brace">{</em>
<div class="comment">
         /* apply ansi semantics */</div>
<a id="L561" name="L561"></a> 561         <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> - 1] = '\0';
<a id="L562" name="L562"></a> 562         <strong class="reserved">return</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L563" name="L563"></a> 563     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (rc == <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>) <em class="brace">{</em>
<div class="comment">
         /* force a null terminator */</div>
<a id="L565" name="L565"></a> 565         <a href="../S/1629.html#L386" title="Defined at 386 in src/java/lang/invoke/LambdaFormEditor.java.">buffer</a>[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> - 1] = '\0';
<a id="L566" name="L566"></a> 566     <em class="brace">}</em>
<a id="L567" name="L567"></a> 567     <strong class="reserved">return</strong> rc;
<a id="L568" name="L568"></a> 568 <em class="brace">}</em>
<a id="L569" name="L569"></a> 569 
<a id="L570" name="L570"></a> 570 <strong class="reserved">void</strong>
<a id="L571" name="L571"></a> 571 <a href="../R/4159.html" title="Multiple referred from 43 places.">JLI_ReportErrorMessage</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong>* fmt, ...) <em class="brace">{</em>
<a id="L572" name="L572"></a> 572     va_list vl;
<a id="L573" name="L573"></a> 573     va_start(vl,fmt);
<a id="L574" name="L574"></a> 574 
<a id="L575" name="L575"></a> 575     <strong class="reserved">if</strong> (<a href="../S/1.html#L146" title="Defined at 146 in src/launcher/java_md.c.">IsJavaw</a>()) <em class="brace">{</em>
<a id="L576" name="L576"></a> 576         <strong class="reserved">char</strong> *<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>;
<a id="L577" name="L577"></a> 577 
<div class="comment">
         /* get the length of the string we need */</div>
<a id="L579" name="L579"></a> 579         <strong class="reserved">int</strong> n = _vscprintf(fmt, vl);
<a id="L580" name="L580"></a> 580 
<a id="L581" name="L581"></a> 581         <a href="../D/27673.html" title="Multiple defined in 6 places.">message</a> = (<strong class="reserved">char</strong> *)<a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(n + 1);
<a id="L582" name="L582"></a> 582         _vsnprintf(<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>, n, fmt, vl);
<a id="L583" name="L583"></a> 583         <a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>[n]='\0';
<a id="L584" name="L584"></a> 584         MessageBox(<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, <a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>, "Java Virtual Machine Launcher",
<a id="L585" name="L585"></a> 585             (MB_OK|MB_ICONSTOP|MB_APPLMODAL));
<a id="L586" name="L586"></a> 586         <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>);
<a id="L587" name="L587"></a> 587     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L588" name="L588"></a> 588         vfprintf(stderr, fmt, vl);
<a id="L589" name="L589"></a> 589         fprintf(stderr, "\n");
<a id="L590" name="L590"></a> 590     <em class="brace">}</em>
<a id="L591" name="L591"></a> 591     va_end(vl);
<a id="L592" name="L592"></a> 592 <em class="brace">}</em>
<a id="L593" name="L593"></a> 593 
<div class="comment">
  Just like JLI_ReportErrorMessage, except that it concatenates the system
  error message if any, its upto the calling routine to correctly
  format the separation of the messages.</div>
<a id="L599" name="L599"></a> 599 <strong class="reserved">void</strong>
<a id="L600" name="L600"></a> 600 <a href="../R/4160.html" title="Multiple referred from 3 places.">JLI_ReportErrorMessageSys</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *fmt, ...)
<a id="L601" name="L601"></a> 601 <em class="brace">{</em>
<a id="L602" name="L602"></a> 602     va_list vl;
<a id="L603" name="L603"></a> 603 
<a id="L604" name="L604"></a> 604     <strong class="reserved">int</strong> save_errno = errno;
<a id="L605" name="L605"></a> 605     DWORD       errval;
<a id="L606" name="L606"></a> 606     jboolean freeit = JNI_FALSE;
<a id="L607" name="L607"></a> 607     <strong class="reserved">char</strong>  *errtext = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L608" name="L608"></a> 608 
<a id="L609" name="L609"></a> 609     va_start(vl, fmt);
<a id="L610" name="L610"></a> 610 
<a id="L611" name="L611"></a> 611     <strong class="reserved">if</strong> ((errval = GetLastError()) != 0) <div class="comment">
/* Platform SDK / DOS Error */</div>
<a id="L612" name="L612"></a> 612         <strong class="reserved">int</strong> n = FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM|
<a id="L613" name="L613"></a> 613             FORMAT_MESSAGE_IGNORE_INSERTS|FORMAT_MESSAGE_ALLOCATE_BUFFER,
<a id="L614" name="L614"></a> 614             <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, errval, 0, (LPTSTR)&amp;errtext, 0, <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L615" name="L615"></a> 615         <strong class="reserved">if</strong> (errtext == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a> || n == 0) <div class="comment">
/* Paranoia check */</div>
<a id="L616" name="L616"></a> 616             errtext = "";
<a id="L617" name="L617"></a> 617             n = 0;
<a id="L618" name="L618"></a> 618         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L619" name="L619"></a> 619             freeit = JNI_TRUE;
<a id="L620" name="L620"></a> 620             <strong class="reserved">if</strong> (n &gt; 2) <div class="comment">
/* Drop final CR, LF */</div>
<a id="L621" name="L621"></a> 621                 <strong class="reserved">if</strong> (errtext[n - 1] == '\n') n--;
<a id="L622" name="L622"></a> 622                 <strong class="reserved">if</strong> (errtext[n - 1] == '\r') n--;
<a id="L623" name="L623"></a> 623                 errtext[n] = '\0';
<a id="L624" name="L624"></a> 624             <em class="brace">}</em>
<a id="L625" name="L625"></a> 625         <em class="brace">}</em>
<a id="L626" name="L626"></a> 626     <em class="brace">}</em> <strong class="reserved">else</strong> <div class="comment">
/* C runtime error that has no corresponding DOS error code */</div>
<a id="L627" name="L627"></a> 627         errtext = strerror(save_errno);
<a id="L628" name="L628"></a> 628     <em class="brace">}</em>
<a id="L629" name="L629"></a> 629 
<a id="L630" name="L630"></a> 630     <strong class="reserved">if</strong> (<a href="../S/1.html#L146" title="Defined at 146 in src/launcher/java_md.c.">IsJavaw</a>()) <em class="brace">{</em>
<a id="L631" name="L631"></a> 631         <strong class="reserved">char</strong> *<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>;
<a id="L632" name="L632"></a> 632         <strong class="reserved">int</strong> mlen;
<div class="comment">
         /* get the length of the string we need */</div>
<a id="L634" name="L634"></a> 634         <strong class="reserved">int</strong> len = mlen =  _vscprintf(fmt, vl) + 1;
<a id="L635" name="L635"></a> 635         <strong class="reserved">if</strong> (freeit) <em class="brace">{</em>
<a id="L636" name="L636"></a> 636            mlen += (<strong class="reserved">int</strong>)<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(errtext);
<a id="L637" name="L637"></a> 637         <em class="brace">}</em>
<a id="L638" name="L638"></a> 638 
<a id="L639" name="L639"></a> 639         <a href="../D/27673.html" title="Multiple defined in 6 places.">message</a> = (<strong class="reserved">char</strong> *)<a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(mlen);
<a id="L640" name="L640"></a> 640         _vsnprintf(<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>, len, fmt, vl);
<a id="L641" name="L641"></a> 641         <a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>[len]='\0';
<a id="L642" name="L642"></a> 642 
<a id="L643" name="L643"></a> 643         <strong class="reserved">if</strong> (freeit) <em class="brace">{</em>
<a id="L644" name="L644"></a> 644            <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>, errtext);
<a id="L645" name="L645"></a> 645         <em class="brace">}</em>
<a id="L646" name="L646"></a> 646 
<a id="L647" name="L647"></a> 647         MessageBox(<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, <a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>, "Java Virtual Machine Launcher",
<a id="L648" name="L648"></a> 648             (MB_OK|MB_ICONSTOP|MB_APPLMODAL));
<a id="L649" name="L649"></a> 649 
<a id="L650" name="L650"></a> 650         <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(<a href="../D/27673.html" title="Multiple defined in 6 places.">message</a>);
<a id="L651" name="L651"></a> 651     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L652" name="L652"></a> 652         vfprintf(stderr, fmt, vl);
<a id="L653" name="L653"></a> 653         <strong class="reserved">if</strong> (freeit) <em class="brace">{</em>
<a id="L654" name="L654"></a> 654            fprintf(stderr, "%s", errtext);
<a id="L655" name="L655"></a> 655         <em class="brace">}</em>
<a id="L656" name="L656"></a> 656     <em class="brace">}</em>
<a id="L657" name="L657"></a> 657     <strong class="reserved">if</strong> (freeit) <em class="brace">{</em>
<a id="L658" name="L658"></a> 658         (<strong class="reserved">void</strong>)LocalFree((HLOCAL)errtext);
<a id="L659" name="L659"></a> 659     <em class="brace">}</em>
<a id="L660" name="L660"></a> 660     va_end(vl);
<a id="L661" name="L661"></a> 661 <em class="brace">}</em>
<a id="L662" name="L662"></a> 662 
<a id="L663" name="L663"></a> 663 <strong class="reserved">void</strong>  <a href="../R/4161.html" title="Multiple referred from 3 places.">JLI_ReportExceptionDescription</a>(JNIEnv * <a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>) <em class="brace">{</em>
<a id="L664" name="L664"></a> 664     <strong class="reserved">if</strong> (<a href="../S/1.html#L146" title="Defined at 146 in src/launcher/java_md.c.">IsJavaw</a>()) <em class="brace">{</em>
<div class="comment">
         This code should be replaced by code which opens a window with
         the exception detail message, for now atleast put a dialog up.</div>
<a id="L669" name="L669"></a> 669         MessageBox(<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, "A Java Exception has occurred.", "Java Virtual Machine Launcher",
<a id="L670" name="L670"></a> 670                (MB_OK|MB_ICONSTOP|MB_APPLMODAL));
<a id="L671" name="L671"></a> 671     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L672" name="L672"></a> 672         (*<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>)-&gt;ExceptionDescribe(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>);
<a id="L673" name="L673"></a> 673     <em class="brace">}</em>
<a id="L674" name="L674"></a> 674 <em class="brace">}</em>
<a id="L675" name="L675"></a> 675 
<a id="L676" name="L676"></a> 676 jboolean
<a id="L677" name="L677"></a> 677 <a href="../R/7092.html" title="Multiple referred from 4 places.">ServerClassMachine</a>() <em class="brace">{</em>
<a id="L678" name="L678"></a> 678     <strong class="reserved">return</strong> (<a href="../S/15.html#L1959" title="Defined at 1959 in src/launcher/java.c.">GetErgoPolicy</a>() == <a href="../S/5.html#L172" title="Defined at 172 in src/launcher/java.h.">ALWAYS_SERVER_CLASS</a>) ? JNI_TRUE : JNI_FALSE;
<a id="L679" name="L679"></a> 679 <em class="brace">}</em>
<a id="L680" name="L680"></a> 680 
<div class="comment">
  Determine if there is an acceptable JRE in the registry directory top_key.
  Upon locating the "best" one, return a fully qualified path to it.
  "Best" is defined as the most advanced JRE meeting the constraints
  contained in the manifest_info. If no JRE in this directory meets the
  constraints, return NULL.
  It doesn't matter if we get an error reading the registry, or we just
  don't find anything interesting in the directory.  We just return NULL
  in either case.</div>
<a id="L692" name="L692"></a> 692 <strong class="reserved">static</strong> <strong class="reserved">char</strong> *
<a id="L693" name="L693"></a> 693 <a href="../S/1.html#L762" title="Referred from 762 in src/launcher/java_md.c.">ProcessDir</a>(<a href="../D/27439.html" title="Multiple defined in 2 places.">manifest_info</a>* <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>, HKEY top_key) <em class="brace">{</em>
<a id="L694" name="L694"></a> 694     DWORD   <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = 0;
<a id="L695" name="L695"></a> 695     HKEY    ver_key;
<a id="L696" name="L696"></a> 696     <strong class="reserved">char</strong>    <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>[<a href="../S/10.html#L40" title="Defined at 40 in src/launcher/java_md.h.">MAXNAMELEN</a>];
<a id="L697" name="L697"></a> 697     <strong class="reserved">int</strong>     len;
<a id="L698" name="L698"></a> 698     <strong class="reserved">char</strong>    *best = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L699" name="L699"></a> 699 
<div class="comment">
      Enumerate "<top_key>/SOFTWARE/JavaSoft/Java Runtime Environment"
      searching for the best available version.</top_key></div>
<a id="L704" name="L704"></a> 704     <strong class="reserved">while</strong> (RegEnumKey(top_key, <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../S/10.html#L40" title="Defined at 40 in src/launcher/java_md.h.">MAXNAMELEN</a>) == ERROR_SUCCESS) <em class="brace">{</em>
<a id="L705" name="L705"></a> 705         <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>++;
<a id="L706" name="L706"></a> 706         <strong class="reserved">if</strong> (<a href="../S/14.html#L239" title="Defined at 239 in src/launcher/version_comp.c.">JLI_AcceptableRelease</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>-&gt;jre_version))
<a id="L707" name="L707"></a> 707             <strong class="reserved">if</strong> ((best == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) || (<a href="../S/14.html#L136" title="Defined at 136 in src/launcher/version_comp.c.">JLI_ExactVersionId</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, best) &gt; 0)) <em class="brace">{</em>
<a id="L708" name="L708"></a> 708                 <strong class="reserved">if</strong> (best != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L709" name="L709"></a> 709                     <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(best);
<a id="L710" name="L710"></a> 710                 best = <a href="../S/16.html#L67" title="Defined at 67 in src/launcher/jli_util.c.">JLI_StringDup</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L711" name="L711"></a> 711             <em class="brace">}</em>
<a id="L712" name="L712"></a> 712     <em class="brace">}</em>
<a id="L713" name="L713"></a> 713 
<div class="comment">
      Extract "JavaHome" from the "best" registry directory and return
      that path.  If no appropriate version was located, or there is an
      error in extracting the "JavaHome" string, return null.</div>
<a id="L719" name="L719"></a> 719     <strong class="reserved">if</strong> (best == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L720" name="L720"></a> 720         <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L721" name="L721"></a> 721     <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L722" name="L722"></a> 722         <strong class="reserved">if</strong> (RegOpenKeyEx(top_key, best, 0, KEY_READ, &amp;ver_key)
<a id="L723" name="L723"></a> 723           != ERROR_SUCCESS) <em class="brace">{</em>
<a id="L724" name="L724"></a> 724             <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(best);
<a id="L725" name="L725"></a> 725             <strong class="reserved">if</strong> (ver_key != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L726" name="L726"></a> 726                 RegCloseKey(ver_key);
<a id="L727" name="L727"></a> 727             <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L728" name="L728"></a> 728         <em class="brace">}</em>
<a id="L729" name="L729"></a> 729         <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(best);
<a id="L730" name="L730"></a> 730         len = <a href="../S/10.html#L40" title="Defined at 40 in src/launcher/java_md.h.">MAXNAMELEN</a>;
<a id="L731" name="L731"></a> 731         <strong class="reserved">if</strong> (RegQueryValueEx(ver_key, "JavaHome", <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, (LPBYTE)<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>, &amp;len)
<a id="L732" name="L732"></a> 732           != ERROR_SUCCESS) <em class="brace">{</em>
<a id="L733" name="L733"></a> 733             <strong class="reserved">if</strong> (ver_key != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L734" name="L734"></a> 734                 RegCloseKey(ver_key);
<a id="L735" name="L735"></a> 735             <strong class="reserved">return</strong> (<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>);
<a id="L736" name="L736"></a> 736         <em class="brace">}</em>
<a id="L737" name="L737"></a> 737         <strong class="reserved">if</strong> (ver_key != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L738" name="L738"></a> 738             RegCloseKey(ver_key);
<a id="L739" name="L739"></a> 739         <strong class="reserved">return</strong> (<a href="../S/16.html#L67" title="Defined at 67 in src/launcher/jli_util.c.">JLI_StringDup</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>));
<a id="L740" name="L740"></a> 740     <em class="brace">}</em>
<a id="L741" name="L741"></a> 741 <em class="brace">}</em>
<a id="L742" name="L742"></a> 742 
<div class="comment">
  This is the global entry point. It examines the host for the optimal
  JRE to be used by scanning a set of registry entries.  This set of entries
  is hardwired on Windows as "Software\JavaSoft\Java Runtime Environment"
  under the set of roots "{ HKEY_CURRENT_USER, HKEY_LOCAL_MACHINE }".
  This routine simply opens each of these registry directories before passing
  control onto ProcessDir().</div>
<a id="L752" name="L752"></a> 752 <strong class="reserved">char</strong> *
<a id="L753" name="L753"></a> 753 <a href="../R/4705.html" title="Multiple referred from 2 places.">LocateJRE</a>(<a href="../D/27439.html" title="Multiple defined in 2 places.">manifest_info</a>* <a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>) <em class="brace">{</em>
<a id="L754" name="L754"></a> 754     HKEY    <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a> = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L755" name="L755"></a> 755     <strong class="reserved">char</strong>    *path;
<a id="L756" name="L756"></a> 756     <strong class="reserved">int</strong>     key_index;
<a id="L757" name="L757"></a> 757     HKEY    root_keys[2] = <em class="brace">{</em> HKEY_CURRENT_USER, HKEY_LOCAL_MACHINE <em class="brace">}</em>;
<a id="L758" name="L758"></a> 758 
<a id="L759" name="L759"></a> 759     <strong class="reserved">for</strong> (key_index = 0; key_index &lt;= 1; key_index++) <em class="brace">{</em>
<a id="L760" name="L760"></a> 760         <strong class="reserved">if</strong> (RegOpenKeyEx(root_keys[key_index], <a href="../S/1.html#L430" title="Defined at 430 in src/launcher/java_md.c.">JRE_KEY</a>, 0, KEY_READ, &amp;<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>)
<a id="L761" name="L761"></a> 761           == ERROR_SUCCESS)
<a id="L762" name="L762"></a> 762             <strong class="reserved">if</strong> ((path = <a href="../S/1.html#L693" title="Defined at 693 in src/launcher/java_md.c.">ProcessDir</a>(<a href="../D/24493.html" title="Multiple defined in 8 places.">info</a>, <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>)) != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L763" name="L763"></a> 763                 <strong class="reserved">if</strong> (<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a> != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L764" name="L764"></a> 764                     RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L765" name="L765"></a> 765                 <strong class="reserved">return</strong> (path);
<a id="L766" name="L766"></a> 766             <em class="brace">}</em>
<a id="L767" name="L767"></a> 767         <strong class="reserved">if</strong> (<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a> != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L768" name="L768"></a> 768             RegCloseKey(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>);
<a id="L769" name="L769"></a> 769     <em class="brace">}</em>
<a id="L770" name="L770"></a> 770     <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L771" name="L771"></a> 771 <em class="brace">}</em>
<a id="L772" name="L772"></a> 772 
<div class="comment">
  Local helper routine to isolate a single token (option or argument)
  from the command line.
  This routine accepts a pointer to a character pointer.  The first
  token (as defined by MSDN command-line argument syntax) is isolated
  from that string.
  Upon return, the input character pointer pointed to by the parameter s
  is updated to point to the remainding, unscanned, portion of the string,
  or to a null character if the entire string has been consummed.
  This function returns a pointer to a null-terminated string which
  contains the isolated first token, or to the null character if no
  token could be isolated.
  Note the side effect of modifying the input string s by the insertion
  of a null character, making it two strings.
  See "Parsing C Command-Line Arguments" in the MSDN Library for the
  parsing rule details.  The rule summary from that specification is:
   * Arguments are delimited by white space, which is either a space or a tab.
   * A string surrounded by double quotation marks is interpreted as a single
     argument, regardless of white space contained within. A quoted string can
     be embedded in an argument. Note that the caret (^) is not recognized as
     an escape character or delimiter.
   * A double quotation mark preceded by a backslash, \", is interpreted as a
     literal double quotation mark (").
   * Backslashes are interpreted literally, unless they immediately precede a
     double quotation mark.
   * If an even number of backslashes is followed by a double quotation mark,
     then one backslash (\) is placed in the argv array for every pair of
     backslashes (\\), and the double quotation mark (") is interpreted as a
     string delimiter.
   * If an odd number of backslashes is followed by a double quotation mark,
     then one backslash (\) is placed in the argv array for every pair of
     backslashes (\\) and the double quotation mark is interpreted as an
     escape sequence by the remaining backslash, causing a literal double
     quotation mark (") to be placed in argv.</div>
<a id="L819" name="L819"></a> 819 <strong class="reserved">static</strong> <strong class="reserved">char</strong>*
<a id="L820" name="L820"></a> 820 <a href="../R/23710.html" title="Multiple referred from 4 places.">nextarg</a>(<strong class="reserved">char</strong>** s) <em class="brace">{</em>
<a id="L821" name="L821"></a> 821     <strong class="reserved">char</strong>    *p = *s;
<a id="L822" name="L822"></a> 822     <strong class="reserved">char</strong>    *head;
<a id="L823" name="L823"></a> 823     <strong class="reserved">int</strong>     slashes = 0;
<a id="L824" name="L824"></a> 824     <strong class="reserved">int</strong>     inquote = 0;
<a id="L825" name="L825"></a> 825 
<div class="comment">
      Strip leading whitespace, which MSDN defines as only space or tab.
      (Hence, no locale specific "isspace" here.)</div>
<a id="L830" name="L830"></a> 830     <strong class="reserved">while</strong> (*p != (<strong class="reserved">char</strong>)0 &amp;&amp; (*p == ' ' || *p == '\t'))
<a id="L831" name="L831"></a> 831         p++;
<div class="comment">
     head = p;                   /* Save the start of the token to return */</div>
<a id="L833" name="L833"></a> 833 
<div class="comment">
      Isolate a token from the command line.</div>
<a id="L837" name="L837"></a> 837     <strong class="reserved">while</strong> (*p != (<strong class="reserved">char</strong>)0 &amp;&amp; (inquote || !(*p == ' ' || *p == '\t'))) <em class="brace">{</em>
<a id="L838" name="L838"></a> 838         <strong class="reserved">if</strong> (*p == '\\' &amp;&amp; *(p+1) == '"' &amp;&amp; slashes % 2 == 0)
<a id="L839" name="L839"></a> 839             p++;
<a id="L840" name="L840"></a> 840         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (*p == '"')
<a id="L841" name="L841"></a> 841             inquote = !inquote;
<a id="L842" name="L842"></a> 842         slashes = (*p++ == '\\') ? slashes + 1 : 0;
<a id="L843" name="L843"></a> 843     <em class="brace">}</em>
<a id="L844" name="L844"></a> 844 
<div class="comment">
      If the token isolated isn't already terminated in a "char zero",
      then replace the whitespace character with one and move to the
      next character.</div>
<a id="L850" name="L850"></a> 850     <strong class="reserved">if</strong> (*p != (<strong class="reserved">char</strong>)0)
<a id="L851" name="L851"></a> 851         *p++ = (<strong class="reserved">char</strong>)0;
<a id="L852" name="L852"></a> 852 
<div class="comment">
      Update the parameter to point to the head of the remaining string
      reflecting the command line and return a pointer to the leading
      token which was isolated from the command line.</div>
<a id="L858" name="L858"></a> 858     *s = p;
<a id="L859" name="L859"></a> 859     <strong class="reserved">return</strong> (head);
<a id="L860" name="L860"></a> 860 <em class="brace">}</em>
<a id="L861" name="L861"></a> 861 
<div class="comment">
  Local helper routine to return a string equivalent to the input string
  s, but with quotes removed so the result is a string as would be found
  in argv[].  The returned string should be freed by a call to JLI_MemFree().
  The rules for quoting (and escaped quotes) are:
   1 A double quotation mark preceded by a backslash, \", is interpreted as a
     literal double quotation mark (").
   2 Backslashes are interpreted literally, unless they immediately precede a
     double quotation mark.
   3 If an even number of backslashes is followed by a double quotation mark,
     then one backslash (\) is placed in the argv array for every pair of
     backslashes (\\), and the double quotation mark (") is interpreted as a
     string delimiter.
   4 If an odd number of backslashes is followed by a double quotation mark,
     then one backslash (\) is placed in the argv array for every pair of
     backslashes (\\) and the double quotation mark is interpreted as an
     escape sequence by the remaining backslash, causing a literal double
     quotation mark (") to be placed in argv.</div>
<a id="L886" name="L886"></a> 886 <strong class="reserved">static</strong> <strong class="reserved">char</strong>*
<a id="L887" name="L887"></a> 887 <a href="../R/29745.html" title="Multiple referred from 3 places.">unquote</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *s) <em class="brace">{</em>
<a id="L888" name="L888"></a> 888     <strong class="reserved">const</strong> <div class="comment">
/* Pointer to the tail of the original string */</div>
<a id="L889" name="L889"></a> 889     <strong class="reserved">char</strong> *un = (<strong class="reserved">char</strong>*)<a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(<div class="comment">
);  /* Ptr to unquoted string */</div>
<a id="L890" name="L890"></a> 890     <div class="comment">
/* Pointer to the tail of the unquoted string */</div>
<a id="L891" name="L891"></a> 891 
<a id="L892" name="L892"></a> 892     <strong class="reserved">while</strong> (*p != '\0') <em class="brace">{</em>
<a id="L893" name="L893"></a> 893         <strong class="reserved">if</strong> (*p == '"') <em class="brace">{</em>
<a id="L894" name="L894"></a> 894             p++;
<a id="L895" name="L895"></a> 895         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (*p == '\\') <em class="brace">{</em>
<a id="L896" name="L896"></a> 896             <strong class="reserved">const</strong> <strong class="reserved">char</strong> *q = p + <a href="../S/9.html#L58" title="Defined at 58 in src/launcher/jli_util.h.">JLI_StrSpn</a>(p,"\\");
<a id="L897" name="L897"></a> 897             <strong class="reserved">if</strong> (*q == '"')
<a id="L898" name="L898"></a> 898                 <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L899" name="L899"></a> 899                     *pun++ = '\\';
<a id="L900" name="L900"></a> 900                     p += 2;
<a id="L901" name="L901"></a> 901                  <em class="brace">}</em> <strong class="reserved">while</strong> (*p == '\\' &amp;&amp; p &lt; q);
<a id="L902" name="L902"></a> 902             <strong class="reserved">else</strong>
<a id="L903" name="L903"></a> 903                 <strong class="reserved">while</strong> (p &lt; q)
<a id="L904" name="L904"></a> 904                     *pun++ = *p++;
<a id="L905" name="L905"></a> 905         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L906" name="L906"></a> 906             *pun++ = *p++;
<a id="L907" name="L907"></a> 907         <em class="brace">}</em>
<a id="L908" name="L908"></a> 908     <em class="brace">}</em>
<a id="L909" name="L909"></a> 909     *pun = '\0';
<a id="L910" name="L910"></a> 910     <strong class="reserved">return</strong> un;
<a id="L911" name="L911"></a> 911 <em class="brace">}</em>
<a id="L912" name="L912"></a> 912 
<div class="comment">
  Given a path to a jre to execute, this routine checks if this process
  is indeed that jre.  If not, it exec's that jre.
  We want to actually check the paths rather than just the version string
  built into the executable, so that given version specification will yield
  the exact same Java environment, regardless of the version of the arbitrary
  launcher we start with.</div>
<a id="L922" name="L922"></a> 922 <strong class="reserved">void</strong>
<a id="L923" name="L923"></a> 923 <a href="../R/2773.html" title="Multiple referred from 2 places.">ExecJRE</a>(<strong class="reserved">char</strong> *jre, <strong class="reserved">char</strong> **argv) <em class="brace">{</em>
<a id="L924" name="L924"></a> 924     jint     len;
<a id="L925" name="L925"></a> 925     <strong class="reserved">char</strong>    path[<a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a> + 1];
<a id="L926" name="L926"></a> 926 
<a id="L927" name="L927"></a> 927     <strong class="reserved">const</strong> <strong class="reserved">char</strong> *progname = <a href="../S/15.html#L1947" title="Defined at 1947 in src/launcher/java.c.">GetProgramName</a>();
<a id="L928" name="L928"></a> 928 
<div class="comment">
      Resolve the real path to the currently running launcher.</div>
<a id="L932" name="L932"></a> 932     len = GetModuleFileName(<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>, path, <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a> + 1);
<a id="L933" name="L933"></a> 933     <strong class="reserved">if</strong> (len == 0 || len &gt; <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>) <em class="brace">{</em>
<a id="L934" name="L934"></a> 934         <a href="../S/1.html#L600" title="Defined at 600 in src/launcher/java_md.c.">JLI_ReportErrorMessageSys</a>(<a href="../S/7.html#L86" title="Defined at 86 in src/launcher/emessages.h.">JRE_ERROR9</a>, progname);
<a id="L935" name="L935"></a> 935         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(1);
<a id="L936" name="L936"></a> 936     <em class="brace">}</em>
<a id="L937" name="L937"></a> 937 
<a id="L938" name="L938"></a> 938     <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("ExecJRE: old: %s\n", path);
<a id="L939" name="L939"></a> 939     <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("ExecJRE: new: %s\n", jre);
<a id="L940" name="L940"></a> 940 
<div class="comment">
      If the path to the selected JRE directory is a match to the initial
      portion of the path to the currently executing JRE, we have a winner!
      If so, just return.</div>
<a id="L946" name="L946"></a> 946     <strong class="reserved">if</strong> (<a href="../D/4587.html" title="Multiple defined in 2 places.">JLI_StrNCaseCmp</a>(jre, path, <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(jre)) == 0)
<a id="L947" name="L947"></a> 947         <div class="comment">
/* I am the droid you were looking for */</div>
<a id="L948" name="L948"></a> 948 
<div class="comment">
      If this isn't the selected version, exec the selected version.</div>
<a id="L952" name="L952"></a> 952     <a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(path, <strong class="reserved">sizeof</strong>(path), "%s\\bin\\%s.exe", jre, progname);
<a id="L953" name="L953"></a> 953 
<div class="comment">
      Although Windows has an execv() entrypoint, it doesn't actually
      overlay a process: it can only create a new process and terminate
      the old process.  Therefore, any processes waiting on the initial
      process wake up and they shouldn't.  Hence, a chain of pseudo-zombie
      processes must be retained to maintain the proper wait semantics.
      Fortunately the image size of the launcher isn't too large at this
      time.
      If it weren't for this semantic flaw, the code below would be ...
          execv(path, argv);
          JLI_ReportErrorMessage("Error: Exec of %s failed\n", path);
          exit(1);
      The incorrect exec semantics could be addressed by:
          exit((int)spawnv(_P_WAIT, path, argv));
      Unfortunately, a bug in Windows spawn/exec impementation prevents
      this from completely working.  All the Windows POSIX process creation
      interfaces are implemented as wrappers around the native Windows
      function CreateProcess().  CreateProcess() takes a single string
      to specify command line options and arguments, so the POSIX routine
      wrappers build a single string from the argv[] array and in the
      process, any quoting information is lost.
      The solution to this to get the original command line, to process it
      to remove the new multiple JRE options (if any) as was done for argv
      in the common SelectVersion() routine and finally to pass it directly
      to the native CreateProcess() Windows process control interface.</div>
<a id="L986" name="L986"></a> 986     <em class="brace">{</em>
<a id="L987" name="L987"></a> 987         <strong class="reserved">char</strong>    *cmdline;
<a id="L988" name="L988"></a> 988         <strong class="reserved">char</strong>    *p;
<a id="L989" name="L989"></a> 989         <strong class="reserved">char</strong>    *np;
<a id="L990" name="L990"></a> 990         <strong class="reserved">char</strong>    *ocl;
<a id="L991" name="L991"></a> 991         <strong class="reserved">char</strong>    *ccl;
<a id="L992" name="L992"></a> 992         <strong class="reserved">char</strong>    *unquoted;
<a id="L993" name="L993"></a> 993         DWORD   exitCode;
<a id="L994" name="L994"></a> 994         STARTUPINFO si;
<a id="L995" name="L995"></a> 995         PROCESS_INFORMATION pi;
<a id="L996" name="L996"></a> 996 
<div class="comment">
          The following code block gets and processes the original command
          line, replacing the argv[0] equivalent in the command line with
          the path to the new executable and removing the appropriate
          Multiple JRE support options. Note that similar logic exists
          in the platform independent SelectVersion routine, but is
          replicated here due to the syntax of CreateProcess().
          The magic "+ 4" characters added to the command line length are
          2 possible quotes around the path (argv[0]), a space after the
          path and a terminating null character.</div>
<a id="L1009" name="L1009"></a>1009         ocl = GetCommandLine();
<a id="L1010" name="L1010"></a>1010         np = ccl = <a href="../S/16.html#L67" title="Defined at 67 in src/launcher/jli_util.c.">JLI_StringDup</a>(ocl);
<a id="L1011" name="L1011"></a>1011         p = <div class="comment">
/* Discard argv[0] */</div>
<a id="L1012" name="L1012"></a>1012         cmdline = (<strong class="reserved">char</strong> *)<a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(path) + <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(np) + 4);
<a id="L1013" name="L1013"></a>1013         <strong class="reserved">if</strong> (<a href="../S/9.html#L50" title="Defined at 50 in src/launcher/jli_util.h.">JLI_StrChr</a>(path, (<strong class="reserved">int</strong>)' ') == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a> &amp;&amp; <a href="../S/9.html#L50" title="Defined at 50 in src/launcher/jli_util.h.">JLI_StrChr</a>(path, (<strong class="reserved">int</strong>)'\t') == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>)
<a id="L1014" name="L1014"></a>1014             cmdline = <a href="../S/9.html#L55" title="Defined at 55 in src/launcher/jli_util.h.">JLI_StrCpy</a>(cmdline, path);
<a id="L1015" name="L1015"></a>1015         <strong class="reserved">else</strong>
<a id="L1016" name="L1016"></a>1016             cmdline = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L55" title="Defined at 55 in src/launcher/jli_util.h.">JLI_StrCpy</a>(cmdline, "\""), path), "\"");
<a id="L1017" name="L1017"></a>1017 
<a id="L1018" name="L1018"></a>1018         <strong class="reserved">while</strong> (*np != (<strong class="reserved">char</strong>)0) <div class="comment">
/* While more command-line */</div>
<a id="L1019" name="L1019"></a>1019             p = <a href="../S/1.html#L820" title="Defined at 820 in src/launcher/java_md.c.">nextarg</a>(&amp;np);
<a id="L1020" name="L1020"></a>1020             <strong class="reserved">if</strong> (*p != (<strong class="reserved">char</strong>)0) <div class="comment">
/* If a token was isolated */</div>
<a id="L1021" name="L1021"></a>1021                 unquoted = <a href="../D/35956.html" title="Multiple defined in 4 places.">unquote</a>(p);
<a id="L1022" name="L1022"></a>1022                 <strong class="reserved">if</strong> (*unquoted == '-') <div class="comment">
/* Looks like an option */</div>
<a id="L1023" name="L1023"></a>1023                     <strong class="reserved">if</strong> (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(unquoted, "-classpath") == 0 ||
<a id="L1024" name="L1024"></a>1024                       <a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(unquoted, "-cp") == 0) <div class="comment">
/* Unique cp syntax */</div>
<a id="L1025" name="L1025"></a>1025                         cmdline = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(cmdline, " "), p);
<a id="L1026" name="L1026"></a>1026                         p = <a href="../S/1.html#L820" title="Defined at 820 in src/launcher/java_md.c.">nextarg</a>(&amp;np);
<a id="L1027" name="L1027"></a>1027                         <strong class="reserved">if</strong> (*p != (<div class="comment">
)      /* If a token was isolated */</div>
<a id="L1028" name="L1028"></a>1028                             cmdline = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(cmdline, " "), p);
<a id="L1029" name="L1029"></a>1029                     <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/9.html#L53" title="Defined at 53 in src/launcher/jli_util.h.">JLI_StrNCmp</a>(unquoted, "-version:", 9) != 0 &amp;&amp;
<a id="L1030" name="L1030"></a>1030                       <a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(unquoted, "-jre-restrict-search") != 0 &amp;&amp;
<a id="L1031" name="L1031"></a>1031                       <a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(unquoted, "-no-jre-restrict-search") != 0) <em class="brace">{</em>
<a id="L1032" name="L1032"></a>1032                         cmdline = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(cmdline, " "), p);
<a id="L1033" name="L1033"></a>1033                     <em class="brace">}</em>
<a id="L1034" name="L1034"></a>1034                 <em class="brace">}</em> <strong class="reserved">else</strong> <div class="comment">
/* End of options */</div>
<a id="L1035" name="L1035"></a>1035                     cmdline = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(cmdline, " "), p);
<a id="L1036" name="L1036"></a>1036                     cmdline = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(cmdline, " "), np);
<a id="L1037" name="L1037"></a>1037                     <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>((<strong class="reserved">void</strong> *)unquoted);
<a id="L1038" name="L1038"></a>1038                     <strong class="reserved">break</strong>;
<a id="L1039" name="L1039"></a>1039                 <em class="brace">}</em>
<a id="L1040" name="L1040"></a>1040                 <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>((<strong class="reserved">void</strong> *)unquoted);
<a id="L1041" name="L1041"></a>1041             <em class="brace">}</em>
<a id="L1042" name="L1042"></a>1042         <em class="brace">}</em>
<a id="L1043" name="L1043"></a>1043         <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>((<strong class="reserved">void</strong> *)ccl);
<a id="L1044" name="L1044"></a>1044 
<a id="L1045" name="L1045"></a>1045         <strong class="reserved">if</strong> (<a href="../S/16.html#L112" title="Defined at 112 in src/launcher/jli_util.c.">JLI_IsTraceLauncher</a>()) <em class="brace">{</em>
<a id="L1046" name="L1046"></a>1046             np = ccl = <a href="../S/16.html#L67" title="Defined at 67 in src/launcher/jli_util.c.">JLI_StringDup</a>(cmdline);
<a id="L1047" name="L1047"></a>1047             p = <a href="../S/1.html#L820" title="Defined at 820 in src/launcher/java_md.c.">nextarg</a>(&amp;np);
<a id="L1048" name="L1048"></a>1048             <a href="../D/29724.html" title="Multiple defined in 5 places.">printf</a>("ReExec Command: %s (%s)\n", path, p);
<a id="L1049" name="L1049"></a>1049             <a href="../D/29724.html" title="Multiple defined in 5 places.">printf</a>("ReExec Args: %s\n", np);
<a id="L1050" name="L1050"></a>1050             <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>((<strong class="reserved">void</strong> *)ccl);
<a id="L1051" name="L1051"></a>1051         <em class="brace">}</em>
<a id="L1052" name="L1052"></a>1052         (<strong class="reserved">void</strong>)fflush(stdout);
<a id="L1053" name="L1053"></a>1053         (<strong class="reserved">void</strong>)fflush(stderr);
<a id="L1054" name="L1054"></a>1054 
<div class="comment">
          The following code is modeled after a model presented in the
          Microsoft Technical Article "Moving Unix Applications to
          Windows NT" (March 6, 1994) and "Creating Processes" on MSDN
          (Februrary 2005).  It approximates UNIX spawn semantics with
          the parent waiting for termination of the child.</div>
<a id="L1062" name="L1062"></a>1062         memset(&amp;si, 0, <strong class="reserved">sizeof</strong>(si));
<a id="L1063" name="L1063"></a>1063         si.cb =<strong class="reserved">sizeof</strong>(STARTUPINFO);
<a id="L1064" name="L1064"></a>1064         memset(&amp;pi, 0, <strong class="reserved">sizeof</strong>(pi));
<a id="L1065" name="L1065"></a>1065 
<a id="L1066" name="L1066"></a>1066         <div class="comment">
/* executable name */</div>
<div class="comment">
           (LPTSTR)cmdline,                      /* command line */</div>
<a id="L1068" name="L1068"></a>1068           (LPSECURITY_ATTRIBUTES)<div class="comment">
/* process security attr. */</div>
<a id="L1069" name="L1069"></a>1069           (LPSECURITY_ATTRIBUTES)<div class="comment">
/* thread security attr. */</div>
<div class="comment">
           (BOOL)TRUE,                           /* inherits system handles */</div>
<div class="comment">
           (DWORD)0,                             /* creation flags */</div>
<a id="L1072" name="L1072"></a>1072           (LPVOID)<div class="comment">
/* environment block */</div>
<a id="L1073" name="L1073"></a>1073           (LPCTSTR)<div class="comment">
/* current directory */</div>
<div class="comment">
           (LPSTARTUPINFO)&amp;si,                   /* (in) startup information */</div>
<a id="L1075" name="L1075"></a>1075           (LPPROCESS_INFORMATION)&amp;pi)) <div class="comment">
/* (out) process information */</div>
<a id="L1076" name="L1076"></a>1076             <a href="../S/1.html#L600" title="Defined at 600 in src/launcher/java_md.c.">JLI_ReportErrorMessageSys</a>(<a href="../S/7.html#L102" title="Defined at 102 in src/launcher/emessages.h.">SYS_ERROR1</a>, path);
<a id="L1077" name="L1077"></a>1077             <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(1);
<a id="L1078" name="L1078"></a>1078         <em class="brace">}</em>
<a id="L1079" name="L1079"></a>1079 
<a id="L1080" name="L1080"></a>1080         <strong class="reserved">if</strong> (WaitForSingleObject(pi.hProcess, INFINITE) != WAIT_FAILED) <em class="brace">{</em>
<a id="L1081" name="L1081"></a>1081             <strong class="reserved">if</strong> (GetExitCodeProcess(pi.hProcess, &amp;exitCode) == FALSE)
<a id="L1082" name="L1082"></a>1082                 exitCode = 1;
<a id="L1083" name="L1083"></a>1083         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1084" name="L1084"></a>1084             <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L103" title="Defined at 103 in src/launcher/emessages.h.">SYS_ERROR2</a>);
<a id="L1085" name="L1085"></a>1085             exitCode = 1;
<a id="L1086" name="L1086"></a>1086         <em class="brace">}</em>
<a id="L1087" name="L1087"></a>1087 
<a id="L1088" name="L1088"></a>1088         CloseHandle(pi.hThread);
<a id="L1089" name="L1089"></a>1089         CloseHandle(pi.hProcess);
<a id="L1090" name="L1090"></a>1090 
<a id="L1091" name="L1091"></a>1091         <a href="../D/15818.html" title="Multiple defined in 12 places.">exit</a>(exitCode);
<a id="L1092" name="L1092"></a>1092     <em class="brace">}</em>
<a id="L1093" name="L1093"></a>1093 <em class="brace">}</em>
<a id="L1094" name="L1094"></a>1094 
<div class="comment">
  Wrapper for platform dependent unsetenv function.</div>
<a id="L1098" name="L1098"></a>1098 <strong class="reserved">int</strong>
<a id="L1099" name="L1099"></a>1099 <a href="../R/8544.html" title="Multiple referred from 4 places.">UnsetEnv</a>(<strong class="reserved">char</strong> *<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>)
<a id="L1100" name="L1100"></a>1100 <em class="brace">{</em>
<a id="L1101" name="L1101"></a>1101     <strong class="reserved">int</strong> ret;
<a id="L1102" name="L1102"></a>1102     <strong class="reserved">char</strong> *<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> = <a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) + 2);
<a id="L1103" name="L1103"></a>1103     <a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a> = <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(<a href="../S/9.html#L55" title="Defined at 55 in src/launcher/jli_util.h.">JLI_StrCpy</a>(<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>), "=");
<a id="L1104" name="L1104"></a>1104     ret = _putenv(<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>);
<a id="L1105" name="L1105"></a>1105     <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(<a href="../D/11927.html" title="Multiple defined in 8 places.">buf</a>);
<a id="L1106" name="L1106"></a>1106     <strong class="reserved">return</strong> (ret);
<a id="L1107" name="L1107"></a>1107 <em class="brace">}</em>
<a id="L1108" name="L1108"></a>1108 
<div class="comment">
 /* --- Splash Screen shared library support --- */</div>
<a id="L1110" name="L1110"></a>1110 
<a id="L1111" name="L1111"></a>1111 <strong class="reserved">static</strong> <strong class="reserved">const</strong> <strong class="reserved">char</strong>* SPLASHSCREEN_SO = "\\bin\\splashscreen.dll";
<a id="L1112" name="L1112"></a>1112 
<a id="L1113" name="L1113"></a>1113 <strong class="reserved">static</strong> HMODULE hSplashLib = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1114" name="L1114"></a>1114 
<a id="L1115" name="L1115"></a>1115 <strong class="reserved">void</strong>* <a href="../R/7519.html" title="Multiple referred from 2 places.">SplashProcAddress</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong>* <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L1116" name="L1116"></a>1116     <strong class="reserved">char</strong> libraryPath[<div class="comment">
/* some extra space for JLI_StrCat'ing SPLASHSCREEN_SO */</div>
<a id="L1117" name="L1117"></a>1117 
<a id="L1118" name="L1118"></a>1118     <strong class="reserved">if</strong> (!<a href="../S/1.html#L309" title="Defined at 309 in src/launcher/java_md.c.">GetJREPath</a>(libraryPath, <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>)) <em class="brace">{</em>
<a id="L1119" name="L1119"></a>1119         <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1120" name="L1120"></a>1120     <em class="brace">}</em>
<a id="L1121" name="L1121"></a>1121     <strong class="reserved">if</strong> (<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(libraryPath)+<a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(SPLASHSCREEN_SO) &gt;= <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>) <em class="brace">{</em>
<a id="L1122" name="L1122"></a>1122         <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1123" name="L1123"></a>1123     <em class="brace">}</em>
<a id="L1124" name="L1124"></a>1124     <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(libraryPath, SPLASHSCREEN_SO);
<a id="L1125" name="L1125"></a>1125 
<a id="L1126" name="L1126"></a>1126     <strong class="reserved">if</strong> (!hSplashLib) <em class="brace">{</em>
<a id="L1127" name="L1127"></a>1127         hSplashLib = LoadLibrary(libraryPath);
<a id="L1128" name="L1128"></a>1128     <em class="brace">}</em>
<a id="L1129" name="L1129"></a>1129     <strong class="reserved">if</strong> (hSplashLib) <em class="brace">{</em>
<a id="L1130" name="L1130"></a>1130         <strong class="reserved">return</strong> GetProcAddress(hSplashLib, <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>);
<a id="L1131" name="L1131"></a>1131     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1132" name="L1132"></a>1132         <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1133" name="L1133"></a>1133     <em class="brace">}</em>
<a id="L1134" name="L1134"></a>1134 <em class="brace">}</em>
<a id="L1135" name="L1135"></a>1135 
<a id="L1136" name="L1136"></a>1136 <strong class="reserved">void</strong> SplashFreeLibrary() <em class="brace">{</em>
<a id="L1137" name="L1137"></a>1137     <strong class="reserved">if</strong> (hSplashLib) <em class="brace">{</em>
<a id="L1138" name="L1138"></a>1138         FreeLibrary(hSplashLib);
<a id="L1139" name="L1139"></a>1139         hSplashLib = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1140" name="L1140"></a>1140     <em class="brace">}</em>
<a id="L1141" name="L1141"></a>1141 <em class="brace">}</em>
<a id="L1142" name="L1142"></a>1142 
<a id="L1143" name="L1143"></a>1143 <strong class="reserved">const</strong> <strong class="reserved">char</strong> *
<a id="L1144" name="L1144"></a>1144 <a href="../R/22371.html" title="Multiple referred from 2 places.">jlong_format_specifier</a>() <em class="brace">{</em>
<a id="L1145" name="L1145"></a>1145     <strong class="reserved">return</strong> "%I64d";
<a id="L1146" name="L1146"></a>1146 <em class="brace">}</em>
<a id="L1147" name="L1147"></a>1147 
<div class="comment">
  Block current thread and continue execution in a new thread</div>
<a id="L1151" name="L1151"></a>1151 <strong class="reserved">int</strong>
<a id="L1152" name="L1152"></a>1152 <a href="../R/1720.html" title="Multiple referred from 2 places.">ContinueInNewThread0</a>(<strong class="reserved">int</strong> (JNICALL *continuation)(<strong class="reserved">void</strong> *), jlong stack_size, <strong class="reserved">void</strong> * args) <em class="brace">{</em>
<a id="L1153" name="L1153"></a>1153     <strong class="reserved">int</strong> rslt = 0;
<a id="L1154" name="L1154"></a>1154     <strong class="reserved">unsigned</strong> thread_id;
<a id="L1155" name="L1155"></a>1155 
<a id="L1156" name="L1156"></a>1156 <em class="sharp">#ifndef</em> <a href="../S/1.html#L1157" title="Defined at 1157 in src/launcher/java_md.c.">STACK_SIZE_PARAM_IS_A_RESERVATION</a>
<a id="L1157" name="L1157"></a>1157 <em class="sharp">#define</em> <a href="../R/6886.html" title="Multiple referred from 2 places.">STACK_SIZE_PARAM_IS_A_RESERVATION</a>  (0x10000)
<a id="L1158" name="L1158"></a>1158 <em class="sharp">#endif</em>
<a id="L1159" name="L1159"></a>1159 
<div class="comment">
      STACK_SIZE_PARAM_IS_A_RESERVATION is what we want, but it's not
      supported on older version of Windows. Try first with the flag; and
      if that fails try again without the flag. See MSDN document or HotSpot
      source (os_win32.cpp) for details.</div>
<a id="L1166" name="L1166"></a>1166     HANDLE thread_handle =
<a id="L1167" name="L1167"></a>1167       (HANDLE)_beginthreadex(<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>,
<a id="L1168" name="L1168"></a>1168                              (<strong class="reserved">unsigned</strong>)stack_size,
<a id="L1169" name="L1169"></a>1169                              continuation,
<a id="L1170" name="L1170"></a>1170                              args,
<a id="L1171" name="L1171"></a>1171                              <a href="../S/1.html#L1157" title="Defined at 1157 in src/launcher/java_md.c.">STACK_SIZE_PARAM_IS_A_RESERVATION</a>,
<a id="L1172" name="L1172"></a>1172                              &amp;thread_id);
<a id="L1173" name="L1173"></a>1173     <strong class="reserved">if</strong> (thread_handle == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1174" name="L1174"></a>1174       thread_handle =
<a id="L1175" name="L1175"></a>1175       (HANDLE)_beginthreadex(<a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>,
<a id="L1176" name="L1176"></a>1176                              (<strong class="reserved">unsigned</strong>)stack_size,
<a id="L1177" name="L1177"></a>1177                              continuation,
<a id="L1178" name="L1178"></a>1178                              args,
<a id="L1179" name="L1179"></a>1179                              0,
<a id="L1180" name="L1180"></a>1180                              &amp;thread_id);
<a id="L1181" name="L1181"></a>1181     <em class="brace">}</em>
<a id="L1182" name="L1182"></a>1182 
<div class="comment">
     /* AWT preloading (AFTER main thread start) */</div>
<a id="L1184" name="L1184"></a>1184 <em class="sharp">#ifdef</em> <a href="../D/2746.html" title="Multiple defined in 2 places.">ENABLE_AWT_PRELOAD</a>
<div class="comment">
     /* D3D preloading */</div>
<a id="L1186" name="L1186"></a>1186     <strong class="reserved">if</strong> (awtPreloadD3D != 0) <em class="brace">{</em>
<a id="L1187" name="L1187"></a>1187         <strong class="reserved">char</strong> *envValue;
<div class="comment">
 D3D routines checks env.var J2D_D3D if no appropriate
          command line params was specified</div>
<a id="L1191" name="L1191"></a>1191         envValue = <a href="../D/23892.html" title="Multiple defined in 4 places.">getenv</a>("J2D_D3D");
<a id="L1192" name="L1192"></a>1192         <strong class="reserved">if</strong> (envValue != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a> &amp;&amp; <a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(envValue, "false") == 0) <em class="brace">{</em>
<a id="L1193" name="L1193"></a>1193             awtPreloadD3D = 0;
<a id="L1194" name="L1194"></a>1194         <em class="brace">}</em>
<div class="comment">
         /* Test that AWT preloading isn't disabled by J2D_D3D_PRELOAD env.var */</div>
<a id="L1196" name="L1196"></a>1196         envValue = <a href="../D/23892.html" title="Multiple defined in 4 places.">getenv</a>("J2D_D3D_PRELOAD");
<a id="L1197" name="L1197"></a>1197         <strong class="reserved">if</strong> (envValue != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a> &amp;&amp; <a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(envValue, "false") == 0) <em class="brace">{</em>
<a id="L1198" name="L1198"></a>1198             awtPreloadD3D = 0;
<a id="L1199" name="L1199"></a>1199         <em class="brace">}</em>
<a id="L1200" name="L1200"></a>1200         <strong class="reserved">if</strong> (awtPreloadD3D &lt; 0) <em class="brace">{</em>
<div class="comment">
 If awtPreloadD3D is still undefined (-1), test
              if it is turned on by J2D_D3D_PRELOAD env.var.
              By default it's turned OFF.</div>
<a id="L1205" name="L1205"></a>1205             awtPreloadD3D = 0;
<a id="L1206" name="L1206"></a>1206             <strong class="reserved">if</strong> (envValue != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a> &amp;&amp; <a href="../D/4581.html" title="Multiple defined in 2 places.">JLI_StrCaseCmp</a>(envValue, "true") == 0) <em class="brace">{</em>
<a id="L1207" name="L1207"></a>1207                 awtPreloadD3D = 1;
<a id="L1208" name="L1208"></a>1208             <em class="brace">}</em>
<a id="L1209" name="L1209"></a>1209          <em class="brace">}</em>
<a id="L1210" name="L1210"></a>1210     <em class="brace">}</em>
<a id="L1211" name="L1211"></a>1211     <strong class="reserved">if</strong> (awtPreloadD3D) <em class="brace">{</em>
<a id="L1212" name="L1212"></a>1212         <a href="../S/1.html#L1290" title="Defined at 1290 in src/launcher/java_md.c.">AWTPreload</a>(<a href="../S/1.html#L102" title="Defined at 102 in src/launcher/java_md.c.">D3D_PRELOAD_FUNC</a>);
<a id="L1213" name="L1213"></a>1213     <em class="brace">}</em>
<a id="L1214" name="L1214"></a>1214 <div class="comment">
/* ENABLE_AWT_PRELOAD */</div>
<a id="L1215" name="L1215"></a>1215 
<a id="L1216" name="L1216"></a>1216     <strong class="reserved">if</strong> (thread_handle) <em class="brace">{</em>
<a id="L1217" name="L1217"></a>1217       WaitForSingleObject(thread_handle, INFINITE);
<a id="L1218" name="L1218"></a>1218       GetExitCodeThread(thread_handle, &amp;rslt);
<a id="L1219" name="L1219"></a>1219       CloseHandle(thread_handle);
<a id="L1220" name="L1220"></a>1220     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1221" name="L1221"></a>1221       rslt = continuation(args);
<a id="L1222" name="L1222"></a>1222     <em class="brace">}</em>
<a id="L1223" name="L1223"></a>1223 
<a id="L1224" name="L1224"></a>1224 <em class="sharp">#ifdef</em> <a href="../D/2746.html" title="Multiple defined in 2 places.">ENABLE_AWT_PRELOAD</a>
<a id="L1225" name="L1225"></a>1225     <strong class="reserved">if</strong> (awtPreloaded) <em class="brace">{</em>
<a id="L1226" name="L1226"></a>1226         <a href="../S/1.html#L1372" title="Defined at 1372 in src/launcher/java_md.c.">AWTPreloadStop</a>();
<a id="L1227" name="L1227"></a>1227     <em class="brace">}</em>
<a id="L1228" name="L1228"></a>1228 <div class="comment">
/* ENABLE_AWT_PRELOAD */</div>
<a id="L1229" name="L1229"></a>1229 
<a id="L1230" name="L1230"></a>1230     <strong class="reserved">return</strong> rslt;
<a id="L1231" name="L1231"></a>1231 <em class="brace">}</em>
<a id="L1232" name="L1232"></a>1232 
<div class="comment">
 /* Unix only, empty on windows. */</div>
<a id="L1234" name="L1234"></a>1234 <strong class="reserved">void</strong> <a href="../R/7168.html" title="Multiple referred from 2 places.">SetJavaLauncherPlatformProps</a>() <em class="brace">{</em><em class="brace">}</em>
<a id="L1235" name="L1235"></a>1235 
<div class="comment">
  The implementation for finding classes from the bootstrap
  class loader, refer to java.h</div>
<a id="L1240" name="L1240"></a>1240 <strong class="reserved">static</strong> FindClassFromBootLoader_t *findBootClass = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1241" name="L1241"></a>1241 
<a id="L1242" name="L1242"></a>1242 jclass <a href="../R/2997.html" title="Multiple referred from 4 places.">FindBootStrapClass</a>(JNIEnv *<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, <strong class="reserved">const</strong> <strong class="reserved">char</strong> *classname)
<a id="L1243" name="L1243"></a>1243 <em class="brace">{</em>
<a id="L1244" name="L1244"></a>1244    HMODULE hJvm;
<a id="L1245" name="L1245"></a>1245 
<a id="L1246" name="L1246"></a>1246    <strong class="reserved">if</strong> (findBootClass == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1247" name="L1247"></a>1247        hJvm = GetModuleHandle(<a href="../S/1.html#L42" title="Defined at 42 in src/launcher/java_md.c.">JVM_DLL</a>);
<a id="L1248" name="L1248"></a>1248        <strong class="reserved">if</strong> (hJvm == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<div class="comment">
        /* need to use the demangled entry point */</div>
<a id="L1250" name="L1250"></a>1250        findBootClass = (FindClassFromBootLoader_t *)GetProcAddress(hJvm,
<a id="L1251" name="L1251"></a>1251             "JVM_FindClassFromBootLoader");
<a id="L1252" name="L1252"></a>1252        <strong class="reserved">if</strong> (findBootClass == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1253" name="L1253"></a>1253           <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L95" title="Defined at 95 in src/launcher/emessages.h.">DLL_ERROR4</a>, "JVM_FindClassFromBootLoader");
<a id="L1254" name="L1254"></a>1254           <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1255" name="L1255"></a>1255        <em class="brace">}</em>
<a id="L1256" name="L1256"></a>1256    <em class="brace">}</em>
<a id="L1257" name="L1257"></a>1257    <strong class="reserved">return</strong> findBootClass(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, classname);
<a id="L1258" name="L1258"></a>1258 <em class="brace">}</em>
<a id="L1259" name="L1259"></a>1259 
<a id="L1260" name="L1260"></a>1260 <strong class="reserved">void</strong>
<a id="L1261" name="L1261"></a>1261 <a href="../R/3812.html" title="Multiple referred from 2 places.">InitLauncher</a>(boolean javaw)
<a id="L1262" name="L1262"></a>1262 <em class="brace">{</em>
<a id="L1263" name="L1263"></a>1263     INITCOMMONCONTROLSEX icx;
<a id="L1264" name="L1264"></a>1264 
<div class="comment">
      Required for javaw mode MessageBox output as well as for
      HotSpot -XX:+ShowMessageBoxOnError in java mode, an empty
      flag field is sufficient to perform the basic UI initialization.</div>
<a id="L1270" name="L1270"></a>1270     memset(&amp;icx, 0, <strong class="reserved">sizeof</strong>(INITCOMMONCONTROLSEX));
<a id="L1271" name="L1271"></a>1271     icx.dwSize = <strong class="reserved">sizeof</strong>(INITCOMMONCONTROLSEX);
<a id="L1272" name="L1272"></a>1272     InitCommonControlsEx(&amp;icx);
<a id="L1273" name="L1273"></a>1273     _isjavaw = javaw;
<a id="L1274" name="L1274"></a>1274     <a href="../S/16.html#L103" title="Defined at 103 in src/launcher/jli_util.c.">JLI_SetTraceLauncher</a>();
<a id="L1275" name="L1275"></a>1275 <em class="brace">}</em>
<a id="L1276" name="L1276"></a>1276 
<a id="L1277" name="L1277"></a>1277 
<div class="comment">
 /* ============================== */</div>
<div class="comment">
 /* AWT preloading */</div>
<a id="L1280" name="L1280"></a>1280 <em class="sharp">#ifdef</em> <a href="../D/2746.html" title="Multiple defined in 2 places.">ENABLE_AWT_PRELOAD</a>
<a id="L1281" name="L1281"></a>1281 
<a id="L1282" name="L1282"></a>1282 <strong class="reserved">typedef</strong> <strong class="reserved">int</strong> <a href="../S/1.html#L1357" title="Referred from 1357 in src/launcher/java_md.c.">FnPreloadStart</a>(<strong class="reserved">void</strong>);
<a id="L1283" name="L1283"></a>1283 <strong class="reserved">typedef</strong> <strong class="reserved">void</strong> <a href="../R/3033.html" title="Multiple referred from 2 places.">FnPreloadStop</a>(<strong class="reserved">void</strong>);
<a id="L1284" name="L1284"></a>1284 <strong class="reserved">static</strong> <a href="../S/1.html#L1283" title="Defined at 1283 in src/launcher/java_md.c.">FnPreloadStop</a> *fnPreloadStop = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1285" name="L1285"></a>1285 <strong class="reserved">static</strong> HMODULE hPreloadAwt = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1286" name="L1286"></a>1286 
<div class="comment">
  Starts AWT preloading</div>
<a id="L1290" name="L1290"></a>1290 <strong class="reserved">int</strong> <a href="../R/56.html" title="Multiple referred from 2 places.">AWTPreload</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *funcName)
<a id="L1291" name="L1291"></a>1291 <em class="brace">{</em>
<a id="L1292" name="L1292"></a>1292     <strong class="reserved">int</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = -1;
<div class="comment">
     /* load AWT library once (if several preload function should be called) */</div>
<a id="L1294" name="L1294"></a>1294     <strong class="reserved">if</strong> (hPreloadAwt == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<div class="comment">
         /* awt.dll is not loaded yet */</div>
<a id="L1296" name="L1296"></a>1296         <strong class="reserved">char</strong> libraryPath[<a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>];
<a id="L1297" name="L1297"></a>1297         <strong class="reserved">int</strong> jrePathLen = 0;
<a id="L1298" name="L1298"></a>1298         HMODULE hJava = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1299" name="L1299"></a>1299         HMODULE hVerify = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1300" name="L1300"></a>1300 
<a id="L1301" name="L1301"></a>1301         <strong class="reserved">while</strong> (1) <em class="brace">{</em>
<div class="comment">
 awt.dll depends on jvm.dll &amp; java.dll;
              jvm.dll is already loaded, so we need only java.dll;
              java.dll depends on MSVCRT lib &amp; verify.dll.</div>
<a id="L1306" name="L1306"></a>1306             <strong class="reserved">if</strong> (!<a href="../S/1.html#L309" title="Defined at 309 in src/launcher/java_md.c.">GetJREPath</a>(libraryPath, <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>)) <em class="brace">{</em>
<a id="L1307" name="L1307"></a>1307                 <strong class="reserved">break</strong>;
<a id="L1308" name="L1308"></a>1308             <em class="brace">}</em>
<a id="L1309" name="L1309"></a>1309 
<div class="comment">
             /* save path length */</div>
<a id="L1311" name="L1311"></a>1311             jrePathLen = <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(libraryPath);
<a id="L1312" name="L1312"></a>1312 
<a id="L1313" name="L1313"></a>1313             <strong class="reserved">if</strong> (jrePathLen + <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>("\\bin\\verify.dll") &gt;= <a href="../S/10.html#L39" title="Defined at 39 in src/launcher/java_md.h.">MAXPATHLEN</a>) <em class="brace">{</em>
<div class="comment">
 jre path is too long, the library path will not fit there;
                report and abort preloading</div>
<a id="L1317" name="L1317"></a>1317               <a href="../S/1.html#L571" title="Defined at 571 in src/launcher/java_md.c.">JLI_ReportErrorMessage</a>(<a href="../S/7.html#L88" title="Defined at 88 in src/launcher/emessages.h.">JRE_ERROR11</a>);
<a id="L1318" name="L1318"></a>1318               <strong class="reserved">break</strong>;
<a id="L1319" name="L1319"></a>1319             <em class="brace">}</em>
<a id="L1320" name="L1320"></a>1320 
<div class="comment">
             /* load msvcrt 1st */</div>
<a id="L1322" name="L1322"></a>1322             <a href="../S/1.html#L257" title="Defined at 257 in src/launcher/java_md.c.">LoadMSVCRT</a>();
<a id="L1323" name="L1323"></a>1323 
<div class="comment">
             /* load verify.dll */</div>
<a id="L1325" name="L1325"></a>1325             <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(libraryPath, "\\bin\\verify.dll");
<a id="L1326" name="L1326"></a>1326             hVerify = LoadLibrary(libraryPath);
<a id="L1327" name="L1327"></a>1327             <strong class="reserved">if</strong> (hVerify == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1328" name="L1328"></a>1328                 <strong class="reserved">break</strong>;
<a id="L1329" name="L1329"></a>1329             <em class="brace">}</em>
<a id="L1330" name="L1330"></a>1330 
<div class="comment">
             /* restore jrePath */</div>
<a id="L1332" name="L1332"></a>1332             libraryPath[jrePathLen] = 0;
<div class="comment">
             /* load java.dll */</div>
<a id="L1334" name="L1334"></a>1334             <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(libraryPath, "\\bin\\" <a href="../S/1.html#L43" title="Defined at 43 in src/launcher/java_md.c.">JAVA_DLL</a>);
<a id="L1335" name="L1335"></a>1335             hJava = LoadLibrary(libraryPath);
<a id="L1336" name="L1336"></a>1336             <strong class="reserved">if</strong> (hJava == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1337" name="L1337"></a>1337                 <strong class="reserved">break</strong>;
<a id="L1338" name="L1338"></a>1338             <em class="brace">}</em>
<a id="L1339" name="L1339"></a>1339 
<div class="comment">
             /* restore jrePath */</div>
<a id="L1341" name="L1341"></a>1341             libraryPath[jrePathLen] = 0;
<div class="comment">
             /* load awt.dll */</div>
<a id="L1343" name="L1343"></a>1343             <a href="../S/9.html#L54" title="Defined at 54 in src/launcher/jli_util.h.">JLI_StrCat</a>(libraryPath, "\\bin\\awt.dll");
<a id="L1344" name="L1344"></a>1344             hPreloadAwt = LoadLibrary(libraryPath);
<a id="L1345" name="L1345"></a>1345             <strong class="reserved">if</strong> (hPreloadAwt == <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1346" name="L1346"></a>1346                 <strong class="reserved">break</strong>;
<a id="L1347" name="L1347"></a>1347             <em class="brace">}</em>
<a id="L1348" name="L1348"></a>1348 
<div class="comment">
             /* get "preloadStop" func ptr */</div>
<a id="L1350" name="L1350"></a>1350             fnPreloadStop = (<a href="../S/1.html#L1283" title="Defined at 1283 in src/launcher/java_md.c.">FnPreloadStop</a> *)GetProcAddress(hPreloadAwt, "preloadStop");
<a id="L1351" name="L1351"></a>1351 
<a id="L1352" name="L1352"></a>1352             <strong class="reserved">break</strong>;
<a id="L1353" name="L1353"></a>1353         <em class="brace">}</em>
<a id="L1354" name="L1354"></a>1354     <em class="brace">}</em>
<a id="L1355" name="L1355"></a>1355 
<a id="L1356" name="L1356"></a>1356     <strong class="reserved">if</strong> (hPreloadAwt != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1357" name="L1357"></a>1357         <a href="../S/1.html#L1282" title="Defined at 1282 in src/launcher/java_md.c.">FnPreloadStart</a> *fnInit = (<a href="../S/1.html#L1282" title="Defined at 1282 in src/launcher/java_md.c.">FnPreloadStart</a> *)GetProcAddress(hPreloadAwt, funcName);
<a id="L1358" name="L1358"></a>1358         <strong class="reserved">if</strong> (fnInit != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<div class="comment">
             /* don't forget to stop preloading */</div>
<a id="L1360" name="L1360"></a>1360             awtPreloaded = 1;
<a id="L1361" name="L1361"></a>1361 
<a id="L1362" name="L1362"></a>1362             <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = fnInit();
<a id="L1363" name="L1363"></a>1363         <em class="brace">}</em>
<a id="L1364" name="L1364"></a>1364     <em class="brace">}</em>
<a id="L1365" name="L1365"></a>1365 
<a id="L1366" name="L1366"></a>1366     <strong class="reserved">return</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>;
<a id="L1367" name="L1367"></a>1367 <em class="brace">}</em>
<a id="L1368" name="L1368"></a>1368 
<div class="comment">
  Terminates AWT preloading</div>
<a id="L1372" name="L1372"></a>1372 <strong class="reserved">void</strong> <a href="../R/57.html" title="Multiple referred from 2 places.">AWTPreloadStop</a>() <em class="brace">{</em>
<a id="L1373" name="L1373"></a>1373     <strong class="reserved">if</strong> (fnPreloadStop != <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>) <em class="brace">{</em>
<a id="L1374" name="L1374"></a>1374         fnPreloadStop();
<a id="L1375" name="L1375"></a>1375     <em class="brace">}</em>
<a id="L1376" name="L1376"></a>1376 <em class="brace">}</em>
<a id="L1377" name="L1377"></a>1377 
<a id="L1378" name="L1378"></a>1378 <div class="comment">
/* ENABLE_AWT_PRELOAD */</div>
<a id="L1379" name="L1379"></a>1379 
<a id="L1380" name="L1380"></a>1380 <strong class="reserved">int</strong>
<a id="L1381" name="L1381"></a>1381 <a href="../R/4267.html" title="Multiple referred from 2 places.">JVMInit</a>(<a href="../S/5.html#L88" title="Defined at 88 in src/launcher/java.h.">InvocationFunctions</a>* ifn, jlong threadStackSize,
<a id="L1382" name="L1382"></a>1382         <strong class="reserved">int</strong> argc, <strong class="reserved">char</strong> **argv,
<a id="L1383" name="L1383"></a>1383         <strong class="reserved">int</strong> mode, <strong class="reserved">char</strong> *what, <strong class="reserved">int</strong> ret)
<a id="L1384" name="L1384"></a>1384 <em class="brace">{</em>
<a id="L1385" name="L1385"></a>1385     <a href="../S/15.html#L1872" title="Defined at 1872 in src/launcher/java.c.">ShowSplashScreen</a>();
<a id="L1386" name="L1386"></a>1386     <strong class="reserved">return</strong> <a href="../S/15.html#L1977" title="Defined at 1977 in src/launcher/java.c.">ContinueInNewThread</a>(ifn, threadStackSize, argc, argv, mode, what, ret);
<a id="L1387" name="L1387"></a>1387 <em class="brace">}</em>
<a id="L1388" name="L1388"></a>1388 
<a id="L1389" name="L1389"></a>1389 <strong class="reserved">void</strong>
<a id="L1390" name="L1390"></a>1390 <a href="../R/6175.html" title="Multiple referred from 2 places.">PostJVMInit</a>(JNIEnv *<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, jstring mainClass, JavaVM *vm)
<a id="L1391" name="L1391"></a>1391 <em class="brace">{</em>
<a id="L1392" name="L1392"></a>1392     <em class="comment">// stubbed out for windows and *nixes.</em>
<a id="L1393" name="L1393"></a>1393 <em class="brace">}</em>
<a id="L1394" name="L1394"></a>1394 
<a id="L1395" name="L1395"></a>1395 <strong class="reserved">void</strong>
<a id="L1396" name="L1396"></a>1396 <a href="../R/6572.html" title="Multiple referred from 2 places.">RegisterThread</a>()
<a id="L1397" name="L1397"></a>1397 <em class="brace">{</em>
<a id="L1398" name="L1398"></a>1398     <em class="comment">// stubbed out for windows and *nixes.</em>
<a id="L1399" name="L1399"></a>1399 <em class="brace">}</em>
<a id="L1400" name="L1400"></a>1400 
<div class="comment">
  on windows, we return a false to indicate this option is not applicable</div>
<a id="L1404" name="L1404"></a>1404 jboolean
<a id="L1405" name="L1405"></a>1405 <a href="../R/6287.html" title="Multiple referred from 2 places.">ProcessPlatformOption</a>(<strong class="reserved">const</strong> <strong class="reserved">char</strong> *<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L1406" name="L1406"></a>1406 <em class="brace">{</em>
<a id="L1407" name="L1407"></a>1407     <strong class="reserved">return</strong> JNI_FALSE;
<a id="L1408" name="L1408"></a>1408 <em class="brace">}</em>
<a id="L1409" name="L1409"></a>1409 
<a id="L1410" name="L1410"></a>1410 <strong class="reserved">int</strong>
<a id="L1411" name="L1411"></a>1411 <a href="../R/14322.html" title="Multiple referred from 12 places.">filterArgs</a>(<a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a> *stdargs, <strong class="reserved">const</strong> <strong class="reserved">int</strong> nargc, <a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a> **pargv) <em class="brace">{</em>
<a id="L1412" name="L1412"></a>1412     <a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a>* argv = <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1413" name="L1413"></a>1413     <strong class="reserved">int</strong> nargs = 0;
<a id="L1414" name="L1414"></a>1414     <strong class="reserved">int</strong> i;
<a id="L1415" name="L1415"></a>1415 
<div class="comment">
     /* Copy the non-vm args */</div>
<a id="L1417" name="L1417"></a>1417     <strong class="reserved">for</strong> (i = 0; i &lt; nargc ; i++) <em class="brace">{</em>
<a id="L1418" name="L1418"></a>1418         <strong class="reserved">const</strong> <strong class="reserved">char</strong> *<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a> = stdargs[i].<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>;
<a id="L1419" name="L1419"></a>1419         <strong class="reserved">if</strong> (<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>[0] == '-' &amp;&amp; <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>[1] == 'J')
<a id="L1420" name="L1420"></a>1420             <strong class="reserved">continue</strong>;
<a id="L1421" name="L1421"></a>1421         argv = (<a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a>*) <a href="../S/16.html#L52" title="Defined at 52 in src/launcher/jli_util.c.">JLI_MemRealloc</a>(argv, (nargs+1) * <strong class="reserved">sizeof</strong>(<a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a>));
<a id="L1422" name="L1422"></a>1422         argv[nargs].<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a> = <a href="../S/16.html#L67" title="Defined at 67 in src/launcher/jli_util.c.">JLI_StringDup</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1423" name="L1423"></a>1423         argv[nargs].has_wildcard = stdargs[i].has_wildcard;
<a id="L1424" name="L1424"></a>1424         nargs++;
<a id="L1425" name="L1425"></a>1425     <em class="brace">}</em>
<a id="L1426" name="L1426"></a>1426     *pargv = argv;
<a id="L1427" name="L1427"></a>1427     <strong class="reserved">return</strong> nargs;
<a id="L1428" name="L1428"></a>1428 <em class="brace">}</em>
<a id="L1429" name="L1429"></a>1429 
<div class="comment">
  At this point we have the arguments to the application, and we need to
  check with original stdargs in order to compare which of these truly
  needs expansion. cmdtoargs will specify this if it finds a bare
  (unquoted) argument containing a glob character(s) ie. * or ?</div>
<a id="L1436" name="L1436"></a>1436 jobjectArray
<a id="L1437" name="L1437"></a>1437 <a href="../R/1798.html" title="Multiple referred from 2 places.">CreateApplicationArgs</a>(JNIEnv *<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, <strong class="reserved">char</strong> **strv, <strong class="reserved">int</strong> argc)
<a id="L1438" name="L1438"></a>1438 <em class="brace">{</em>
<a id="L1439" name="L1439"></a>1439     <strong class="reserved">int</strong> i, j, idx, tlen;
<a id="L1440" name="L1440"></a>1440     jobjectArray outArray, inArray;
<a id="L1441" name="L1441"></a>1441     <strong class="reserved">char</strong> *ostart, *astart, **nargv;
<a id="L1442" name="L1442"></a>1442     jboolean needs_expansion = JNI_FALSE;
<a id="L1443" name="L1443"></a>1443     jmethodID mid;
<a id="L1444" name="L1444"></a>1444     <strong class="reserved">int</strong> filteredargc, stdargc;
<a id="L1445" name="L1445"></a>1445     <a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a> *stdargs;
<a id="L1446" name="L1446"></a>1446     <a href="../S/9.html#L44" title="Defined at 44 in src/launcher/jli_util.h.">StdArg</a> *filteredargs;
<a id="L1447" name="L1447"></a>1447     jclass cls = <a href="../S/15.html#L1222" title="Defined at 1222 in src/launcher/java.c.">GetLauncherHelperClass</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>);
<a id="L1448" name="L1448"></a>1448     <a href="../S/5.html#L253" title="Defined at 253 in src/launcher/java.h.">NULL_CHECK0</a>(cls);
<a id="L1449" name="L1449"></a>1449 
<a id="L1450" name="L1450"></a>1450     <strong class="reserved">if</strong> (argc == 0) <em class="brace">{</em>
<a id="L1451" name="L1451"></a>1451         <strong class="reserved">return</strong> <a href="../S/15.html#L1270" title="Defined at 1270 in src/launcher/java.c.">NewPlatformStringArray</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, strv, argc);
<a id="L1452" name="L1452"></a>1452     <em class="brace">}</em>
<a id="L1453" name="L1453"></a>1453     <em class="comment">// the holy grail we need to compare with.</em>
<a id="L1454" name="L1454"></a>1454     stdargs = JLI_GetStdArgs();
<a id="L1455" name="L1455"></a>1455     stdargc = JLI_GetStdArgc();
<a id="L1456" name="L1456"></a>1456 
<a id="L1457" name="L1457"></a>1457     filteredargc = <a href="../S/1.html#L1411" title="Defined at 1411 in src/launcher/java_md.c.">filterArgs</a>(stdargs, stdargc, &amp;filteredargs);
<a id="L1458" name="L1458"></a>1458 
<a id="L1459" name="L1459"></a>1459     <em class="comment">// sanity check, this should never happen</em>
<a id="L1460" name="L1460"></a>1460     <strong class="reserved">if</strong> (argc &gt; stdargc) <em class="brace">{</em>
<a id="L1461" name="L1461"></a>1461         <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("Warning: app args is larger than the original, %d %d\n", argc, stdargc);
<a id="L1462" name="L1462"></a>1462         <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("passing arguments as-is.\n");
<a id="L1463" name="L1463"></a>1463         <strong class="reserved">return</strong> <a href="../S/15.html#L1270" title="Defined at 1270 in src/launcher/java.c.">NewPlatformStringArray</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, strv, argc);
<a id="L1464" name="L1464"></a>1464     <em class="brace">}</em>
<a id="L1465" name="L1465"></a>1465 
<a id="L1466" name="L1466"></a>1466     <em class="comment">// sanity check, match the args we have, to the holy grail</em>
<a id="L1467" name="L1467"></a>1467     idx = filteredargc - argc;
<a id="L1468" name="L1468"></a>1468     ostart = filteredargs[idx].<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>;
<a id="L1469" name="L1469"></a>1469     astart = strv[0];
<a id="L1470" name="L1470"></a>1470     <em class="comment">// sanity check, ensure that the first argument of the arrays are the same</em>
<a id="L1471" name="L1471"></a>1471     <strong class="reserved">if</strong> (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(ostart, astart) != 0) <em class="brace">{</em>
<a id="L1472" name="L1472"></a>1472         <em class="comment">// some thing is amiss the args don't match</em>
<a id="L1473" name="L1473"></a>1473         <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("Warning: app args parsing error\n");
<a id="L1474" name="L1474"></a>1474         <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("passing arguments as-is\n");
<a id="L1475" name="L1475"></a>1475         <strong class="reserved">return</strong> <a href="../S/15.html#L1270" title="Defined at 1270 in src/launcher/java.c.">NewPlatformStringArray</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, strv, argc);
<a id="L1476" name="L1476"></a>1476     <em class="brace">}</em>
<a id="L1477" name="L1477"></a>1477 
<a id="L1478" name="L1478"></a>1478     <em class="comment">// make a copy of the args which will be expanded in java if required.</em>
<a id="L1479" name="L1479"></a>1479     nargv = (<strong class="reserved">char</strong> **)<a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(argc * <strong class="reserved">sizeof</strong>(<strong class="reserved">char</strong>*));
<a id="L1480" name="L1480"></a>1480     <strong class="reserved">for</strong> (i = 0, j = idx; i &lt; argc; i++, j++) <em class="brace">{</em>
<a id="L1481" name="L1481"></a>1481         jboolean arg_expand = (<a href="../S/9.html#L52" title="Defined at 52 in src/launcher/jli_util.h.">JLI_StrCmp</a>(filteredargs[j].<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, strv[i]) == 0)
<a id="L1482" name="L1482"></a>1482                                 ? filteredargs[j].has_wildcard
<a id="L1483" name="L1483"></a>1483                                 : JNI_FALSE;
<a id="L1484" name="L1484"></a>1484         <strong class="reserved">if</strong> (needs_expansion == JNI_FALSE)
<a id="L1485" name="L1485"></a>1485             needs_expansion = arg_expand;
<a id="L1486" name="L1486"></a>1486 
<a id="L1487" name="L1487"></a>1487         <em class="comment">// indicator char + String + NULL terminator, the java method will strip</em>
<a id="L1488" name="L1488"></a>1488         <em class="comment">// out the first character, the indicator character, so no matter what</em>
<a id="L1489" name="L1489"></a>1489         <em class="comment">// we add the indicator</em>
<a id="L1490" name="L1490"></a>1490         tlen = 1 + <a href="../S/9.html#L49" title="Defined at 49 in src/launcher/jli_util.h.">JLI_StrLen</a>(strv[i]) + 1;
<a id="L1491" name="L1491"></a>1491         nargv[i] = (<strong class="reserved">char</strong> *) <a href="../S/16.html#L37" title="Defined at 37 in src/launcher/jli_util.c.">JLI_MemAlloc</a>(tlen);
<a id="L1492" name="L1492"></a>1492         <strong class="reserved">if</strong> (<a href="../D/4578.html" title="Multiple defined in 2 places.">JLI_Snprintf</a>(nargv[i], tlen, "%c%s", arg_expand ? 'T' : 'F',
<a id="L1493" name="L1493"></a>1493                          strv[i]) &lt; 0) <em class="brace">{</em>
<a id="L1494" name="L1494"></a>1494             <strong class="reserved">return</strong> <a href="../S/2603.html#L115" title="Defined at 115 in src/java/sql/JDBCType.java.">NULL</a>;
<a id="L1495" name="L1495"></a>1495         <em class="brace">}</em>
<a id="L1496" name="L1496"></a>1496         <a href="../S/16.html#L93" title="Defined at 93 in src/launcher/jli_util.c.">JLI_TraceLauncher</a>("%s\n", nargv[i]);
<a id="L1497" name="L1497"></a>1497     <em class="brace">}</em>
<a id="L1498" name="L1498"></a>1498 
<a id="L1499" name="L1499"></a>1499     <strong class="reserved">if</strong> (!needs_expansion) <em class="brace">{</em>
<a id="L1500" name="L1500"></a>1500         <em class="comment">// clean up any allocated memory and return back the old arguments</em>
<a id="L1501" name="L1501"></a>1501         <strong class="reserved">for</strong> (i = 0 ; i &lt; argc ; i++) <em class="brace">{</em>
<a id="L1502" name="L1502"></a>1502             <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(nargv[i]);
<a id="L1503" name="L1503"></a>1503         <em class="brace">}</em>
<a id="L1504" name="L1504"></a>1504         <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(nargv);
<a id="L1505" name="L1505"></a>1505         <strong class="reserved">return</strong> <a href="../S/15.html#L1270" title="Defined at 1270 in src/launcher/java.c.">NewPlatformStringArray</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, strv, argc);
<a id="L1506" name="L1506"></a>1506     <em class="brace">}</em>
<a id="L1507" name="L1507"></a>1507     <a href="../S/5.html#L253" title="Defined at 253 in src/launcher/java.h.">NULL_CHECK0</a>(mid = (*<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>)-&gt;GetStaticMethodID(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, cls,
<a id="L1508" name="L1508"></a>1508                                                 "expandArgs",
<a id="L1509" name="L1509"></a>1509                                                 "([Ljava/lang/String;)[Ljava/lang/String;"));
<a id="L1510" name="L1510"></a>1510 
<a id="L1511" name="L1511"></a>1511     <em class="comment">// expand the arguments that require expansion, the java method will strip</em>
<a id="L1512" name="L1512"></a>1512     <em class="comment">// out the indicator character.</em>
<a id="L1513" name="L1513"></a>1513     inArray = <a href="../S/15.html#L1270" title="Defined at 1270 in src/launcher/java.c.">NewPlatformStringArray</a>(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, nargv, argc);
<a id="L1514" name="L1514"></a>1514     outArray = (*<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>)-&gt;CallStaticObjectMethod(<a href="../D/15665.html" title="Multiple defined in 2 places.">env</a>, cls, mid, inArray);
<a id="L1515" name="L1515"></a>1515     <strong class="reserved">for</strong> (i = 0; i &lt; argc; i++) <em class="brace">{</em>
<a id="L1516" name="L1516"></a>1516         <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(nargv[i]);
<a id="L1517" name="L1517"></a>1517     <em class="brace">}</em>
<a id="L1518" name="L1518"></a>1518     <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(nargv);
<a id="L1519" name="L1519"></a>1519     <a href="../S/16.html#L82" title="Defined at 82 in src/launcher/jli_util.c.">JLI_MemFree</a>(filteredargs);
<a id="L1520" name="L1520"></a>1520     <strong class="reserved">return</strong> outArray;
<a id="L1521" name="L1521"></a>1521 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L110">[^]</a><a href="#L1437">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>