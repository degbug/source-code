<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/beans/beancontext/BeanContextServicesSupport.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L130">[^]</a><a href="#L1223">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L130" title="Defined at 130.">initialize</a></li>
<li><a href="#L144" title="Defined at 144.">getBeanContextServicesPeer</a></li>
<li><a href="#L185" title="Defined at 185.">addRequestor</a></li>
<li><a href="#L196" title="Defined at 196.">removeRequestor</a></li>
<li><a href="#L202" title="Defined at 202.">verifyRequestor</a></li>
<li><a href="#L209" title="Defined at 209.">verifyAndMaybeSetProvider</a></li>
<li><a href="#L233" title="Defined at 233.">cloneOfEntries</a></li>
<li><a href="#L237" title="Defined at 237.">entries</a></li>
<li><a href="#L239" title="Defined at 239.">isEmpty</a></li>
<li><a href="#L241" title="Defined at 241.">getServiceClass</a></li>
<li><a href="#L243" title="Defined at 243.">getServiceProvider</a></li>
<li><a href="#L247" title="Defined at 247.">getDelegateProvider</a></li>
<li><a href="#L251" title="Defined at 251.">isDelegated</a></li>
<li><a href="#L253" title="Defined at 253.">addRef</a></li>
<li><a href="#L262" title="Defined at 262.">releaseRef</a></li>
<li><a href="#L274" title="Defined at 274.">getRefs</a></li>
<li><a href="#L276" title="Defined at 276.">getDelegateRefs</a></li>
<li><a href="#L278" title="Defined at 278.">getServiceRefs</a></li>
<li><a href="#L305" title="Defined at 305.">addRef</a></li>
<li><a href="#L306" title="Defined at 306.">release</a></li>
<li><a href="#L308" title="Defined at 308.">getServiceClassRef</a></li>
<li><a href="#L310" title="Defined at 310.">isDelegated</a></li>
<li><a href="#L325" title="Defined at 325.">usingService</a></li>
<li><a href="#L377" title="Defined at 377.">releaseService</a></li>
<li><a href="#L421" title="Defined at 421.">revokeService</a></li>
<li><a href="#L478" title="Defined at 478.">cleanupReferences</a></li>
<li><a href="#L513" title="Defined at 513.">revokeAllDelegatedServicesNow</a></li>
<li><a href="#L586" title="Defined at 586.">createBCSChild</a></li>
<li><a href="#L610" title="Defined at 610.">getServiceProvider</a></li>
<li><a href="#L630" title="Defined at 630.">createBCSSServiceProvider</a></li>
<li><a href="#L642" title="Defined at 642.">addBeanContextServicesListener</a></li>
<li><a href="#L657" title="Defined at 657.">removeBeanContextServicesListener</a></li>
<li><a href="#L674" title="Defined at 674.">addService</a></li>
<li><a href="#L686" title="Defined at 686.">addService</a></li>
<li><a href="#L730" title="Defined at 730.">revokeService</a></li>
<li><a href="#L761" title="Defined at 761.">hasService</a></li>
<li><a href="#L794" title="Defined at 794.">getService</a></li>
<li><a href="#L806" title="Defined at 806.">releaseService</a></li>
<li><a href="#L810" title="Defined at 810.">getCurrentServiceSelectors</a></li>
<li><a href="#L814" title="Defined at 814.">serviceRevoked</a></li>
<li><a href="#L835" title="Defined at 835.">getService</a></li>
<li><a href="#L900" title="Defined at 900.">releaseService</a></li>
<li><a href="#L921" title="Defined at 921.">getCurrentServiceClasses</a></li>
<li><a href="#L930" title="Defined at 930.">getCurrentServiceSelectors</a></li>
<li><a href="#L947" title="Defined at 947.">serviceAvailable</a></li>
<li><a href="#L979" title="Defined at 979.">serviceRevoked</a></li>
<li><a href="#L1008" title="Defined at 1008.">getChildBeanContextServicesListener</a></li>
<li><a href="#L1027" title="Defined at 1027.">childJustRemovedHook</a></li>
<li><a href="#L1042" title="Defined at 1042.">releaseBeanContextResources</a></li>
<li><a href="#L1068" title="Defined at 1068.">initializeBeanContextResources</a></li>
<li><a href="#L1088" title="Defined at 1088.">fireServiceAdded</a></li>
<li><a href="#L1100" title="Defined at 1100.">fireServiceAdded</a></li>
<li><a href="#L1115" title="Defined at 1115.">fireServiceRevoked</a></li>
<li><a href="#L1132" title="Defined at 1132.">fireServiceRevoked</a></li>
<li><a href="#L1154" title="Defined at 1154.">bcsPreSerializationHook</a></li>
<li><a href="#L1197" title="Defined at 1197.">bcsPreDeserializationHook</a></li>
<li><a href="#L1213" title="Defined at 1213.">writeObject</a></li>
<li><a href="#L1223" title="Defined at 1223.">readObject</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1998, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.beans.beancontext;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.util.Collection;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.util.HashMap;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.util.HashSet;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.util.Iterator;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.util.Map;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> java.util.Map.Entry;
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.io.IOException;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.io.ObjectInputStream;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.io.ObjectOutputStream;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.io.Serializable;
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.util.TooManyListenersException;
<a id="L42" name="L42"></a>  42 
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> java.util.Locale;
<a id="L44" name="L44"></a>  44 
<div class="comment">
  <p>
  This helper class provides a utility implementation of the
  java.beans.beancontext.BeanContextServices interface.
  </p>
  <p>
  Since this class directly implements the BeanContextServices interface,
  the class can, and is intended to be used either by subclassing this
  implementation, or via delegation of an instance of this class
  from another through the BeanContextProxy interface.
  </p>
  @author Laurence P. G. Cable
  @since 1.2</div>
<a id="L60" name="L60"></a>  60 
<a id="L61" name="L61"></a>  61 <strong class="reserved">public</strong> <strong class="reserved">class</strong>      <a href="../R/757.html" title="Multiple referred from 4 places.">BeanContextServicesSupport</a> <strong class="reserved">extends</strong> <a href="../S/1830.html#L74" title="Defined at 74 in src/java/beans/beancontext/BeanContextSupport.java.">BeanContextSupport</a>
<a id="L62" name="L62"></a>  62        <strong class="reserved">implements</strong> <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> <em class="brace">{</em>
<a id="L63" name="L63"></a>  63     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -8494482757288719206L;
<a id="L64" name="L64"></a>  64 
<div class="comment">
      <p>
      Construct a BeanContextServicesSupport instance
      </p>
      @param peer      The peer BeanContext we are supplying an implementation for, if null the this object is its own peer
      @param lcle      The current Locale for this BeanContext.
      @param dTime     The initial state, true if in design mode, false if runtime.
      @param visible   The initial visibility.</div>
<a id="L76" name="L76"></a>  76 
<a id="L77" name="L77"></a>  77     <strong class="reserved">public</strong> BeanContextServicesSupport(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> peer, <a href="../S/1034.html#L484" title="Defined at 484 in src/java/util/Locale.java.">Locale</a> lcle, <strong class="reserved">boolean</strong> dTime, <strong class="reserved">boolean</strong> visible) <em class="brace">{</em>
<a id="L78" name="L78"></a>  78         <strong class="reserved">super</strong>(peer, lcle, dTime, visible);
<a id="L79" name="L79"></a>  79     <em class="brace">}</em>
<a id="L80" name="L80"></a>  80 
<div class="comment">
      Create an instance using the specified Locale and design mode.
      @param peer      The peer BeanContext we are supplying an implementation for, if null the this object is its own peer
      @param lcle      The current Locale for this BeanContext.
      @param dtime     The initial state, true if in design mode, false if runtime.</div>
<a id="L88" name="L88"></a>  88 
<a id="L89" name="L89"></a>  89     <strong class="reserved">public</strong> BeanContextServicesSupport(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> peer, <a href="../S/1034.html#L484" title="Defined at 484 in src/java/util/Locale.java.">Locale</a> lcle, <strong class="reserved">boolean</strong> dtime) <em class="brace">{</em>
<a id="L90" name="L90"></a>  90         <strong class="reserved">this</strong> (peer, lcle, dtime, <strong class="reserved">true</strong>);
<a id="L91" name="L91"></a>  91     <em class="brace">}</em>
<a id="L92" name="L92"></a>  92 
<div class="comment">
      Create an instance using the specified locale
      @param peer      The peer BeanContext we are supplying an implementation for, if null the this object is its own peer
      @param lcle      The current Locale for this BeanContext.</div>
<a id="L99" name="L99"></a>  99 
<a id="L100" name="L100"></a> 100     <strong class="reserved">public</strong> BeanContextServicesSupport(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> peer, <a href="../S/1034.html#L484" title="Defined at 484 in src/java/util/Locale.java.">Locale</a> lcle) <em class="brace">{</em>
<a id="L101" name="L101"></a> 101         <strong class="reserved">this</strong> (peer, lcle, <strong class="reserved">false</strong>, <strong class="reserved">true</strong>);
<a id="L102" name="L102"></a> 102     <em class="brace">}</em>
<a id="L103" name="L103"></a> 103 
<div class="comment">
      Create an instance with a peer
      @param peer      The peer BeanContext we are supplying an implementation for, if null the this object is its own peer</div>
<a id="L109" name="L109"></a> 109 
<a id="L110" name="L110"></a> 110     <strong class="reserved">public</strong> BeanContextServicesSupport(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> peer) <em class="brace">{</em>
<a id="L111" name="L111"></a> 111         <strong class="reserved">this</strong> (peer, <strong class="reserved">null</strong>, <strong class="reserved">false</strong>, <strong class="reserved">true</strong>);
<a id="L112" name="L112"></a> 112     <em class="brace">}</em>
<a id="L113" name="L113"></a> 113 
<div class="comment">
      Create an instance that is not a delegate of another object</div>
<a id="L117" name="L117"></a> 117 
<a id="L118" name="L118"></a> 118     <strong class="reserved">public</strong> BeanContextServicesSupport() <em class="brace">{</em>
<a id="L119" name="L119"></a> 119         <strong class="reserved">this</strong> (<strong class="reserved">null</strong>, <strong class="reserved">null</strong>, <strong class="reserved">false</strong>, <strong class="reserved">true</strong>);
<a id="L120" name="L120"></a> 120     <em class="brace">}</em>
<a id="L121" name="L121"></a> 121 
<div class="comment">
      called by BeanContextSupport superclass during construction and
      deserialization to initialize subclass transient state.
      subclasses may envelope this method, but should not override it or
      call it directly.</div>
<a id="L129" name="L129"></a> 129 
<a id="L130" name="L130"></a> 130     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/20681.html" title="Multiple referred from 99 places.">initialize</a>() <em class="brace">{</em>
<a id="L131" name="L131"></a> 131         <strong class="reserved">super</strong>.<a href="../D/24646.html" title="Multiple defined in 91 places.">initialize</a>();
<a id="L132" name="L132"></a> 132 
<a id="L133" name="L133"></a> 133         services     = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>(serializable + 1);
<a id="L134" name="L134"></a> 134         bcsListeners = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>(1);
<a id="L135" name="L135"></a> 135     <em class="brace">}</em>
<a id="L136" name="L136"></a> 136 
<div class="comment">
      Gets the <tt>BeanContextServices</tt> associated with this
      <tt>BeanContextServicesSupport</tt>.
      @return the instance of <tt>BeanContext</tt>
      this object is providing the implementation for.</div>
<a id="L144" name="L144"></a> 144     <strong class="reserved">public</strong> <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> <a href="../R/15253.html" title="Multiple referred from 9 places.">getBeanContextServicesPeer</a>() <em class="brace">{</em>
<a id="L145" name="L145"></a> 145         <strong class="reserved">return</strong> (<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a>)<a href="../S/1840.html#L238" title="Defined at 238 in src/java/beans/beancontext/BeanContextChildSupport.java.">getBeanContextChildPeer</a>();
<a id="L146" name="L146"></a> 146     <em class="brace">}</em>
<a id="L147" name="L147"></a> 147 
<div class="comment">
     /************************************************************************/</div>
<a id="L149" name="L149"></a> 149 
<div class="comment">
      protected nested class containing per child information, an instance
      of which is associated with each child in the "children" hashtable.
      subclasses can extend this class to include their own per-child state.
      Note that this 'value' is serialized with the corresponding child 'key'
      when the BeanContextSupport is serialized.</div>
<a id="L158" name="L158"></a> 158 
<a id="L159" name="L159"></a> 159     <strong class="reserved">protected</strong> <strong class="reserved">class</strong> <a href="../R/599.html" title="Multiple referred from 9 places.">BCSSChild</a> <strong class="reserved">extends</strong> <a href="../S/1830.html#L74" title="Defined at 74 in src/java/beans/beancontext/BeanContextSupport.java.">BeanContextSupport</a>.<a href="../S/1830.html#L316" title="Defined at 316 in src/java/beans/beancontext/BeanContextSupport.java.">BCSChild</a>  <em class="brace">{</em>
<a id="L160" name="L160"></a> 160 
<a id="L161" name="L161"></a> 161         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = -3263851306889194873L;
<a id="L162" name="L162"></a> 162 
<div class="comment">
          private nested class to map serviceClass to Provider and requestors
          listeners.</div>
<a id="L167" name="L167"></a> 167 
<a id="L168" name="L168"></a> 168         <strong class="reserved">class</strong> <a href="../R/597.html" title="Multiple referred from 10 places.">BCSSCServiceClassRef</a> <em class="brace">{</em>
<a id="L169" name="L169"></a> 169 
<a id="L170" name="L170"></a> 170             <em class="comment">// create an instance of a service ref</em>
<a id="L171" name="L171"></a> 171 
<a id="L172" name="L172"></a> 172             BCSSCServiceClassRef(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> sc, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp, <strong class="reserved">boolean</strong> delegated) <em class="brace">{</em>
<a id="L173" name="L173"></a> 173                 <strong class="reserved">super</strong>();
<a id="L174" name="L174"></a> 174 
<a id="L175" name="L175"></a> 175                 serviceClass     = sc;
<a id="L176" name="L176"></a> 176 
<a id="L177" name="L177"></a> 177                 <strong class="reserved">if</strong> (delegated)
<a id="L178" name="L178"></a> 178                     delegateProvider = bcsp;
<a id="L179" name="L179"></a> 179                 <strong class="reserved">else</strong>
<a id="L180" name="L180"></a> 180                     serviceProvider  = bcsp;
<a id="L181" name="L181"></a> 181             <em class="brace">}</em>
<a id="L182" name="L182"></a> 182 
<a id="L183" name="L183"></a> 183             <em class="comment">// add a requestor and assoc listener</em>
<a id="L184" name="L184"></a> 184 
<a id="L185" name="L185"></a> 185             <strong class="reserved">void</strong> <a href="../S/1829.html#L345" title="Referred from 345 in src/java/beans/beancontext/BeanContextServicesSupport.java.">addRequestor</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> bcsrl) <strong class="reserved">throws</strong> <a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a> <em class="brace">{</em>
<a id="L186" name="L186"></a> 186                 <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> cbcsrl = (<a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a>)requestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(requestor);
<a id="L187" name="L187"></a> 187 
<a id="L188" name="L188"></a> 188                 <strong class="reserved">if</strong> (cbcsrl != <strong class="reserved">null</strong> &amp;&amp; !cbcsrl.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(bcsrl))
<a id="L189" name="L189"></a> 189                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a>();
<a id="L190" name="L190"></a> 190 
<a id="L191" name="L191"></a> 191                 requestors.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(requestor, bcsrl);
<a id="L192" name="L192"></a> 192             <em class="brace">}</em>
<a id="L193" name="L193"></a> 193 
<a id="L194" name="L194"></a> 194             <em class="comment">// remove a requestor</em>
<a id="L195" name="L195"></a> 195 
<a id="L196" name="L196"></a> 196             <strong class="reserved">void</strong> <a href="../R/26059.html" title="Multiple referred from 5 places.">removeRequestor</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor) <em class="brace">{</em>
<a id="L197" name="L197"></a> 197                 requestors.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(requestor);
<a id="L198" name="L198"></a> 198             <em class="brace">}</em>
<a id="L199" name="L199"></a> 199 
<a id="L200" name="L200"></a> 200             <em class="comment">// check a requestors listener</em>
<a id="L201" name="L201"></a> 201 
<a id="L202" name="L202"></a> 202             <strong class="reserved">void</strong> <a href="../S/1829.html#L342" title="Referred from 342 in src/java/beans/beancontext/BeanContextServicesSupport.java.">verifyRequestor</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> bcsrl) <strong class="reserved">throws</strong> <a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a> <em class="brace">{</em>
<a id="L203" name="L203"></a> 203                 <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> cbcsrl = (<a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a>)requestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(requestor);
<a id="L204" name="L204"></a> 204 
<a id="L205" name="L205"></a> 205                 <strong class="reserved">if</strong> (cbcsrl != <strong class="reserved">null</strong> &amp;&amp; !cbcsrl.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(bcsrl))
<a id="L206" name="L206"></a> 206                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a>();
<a id="L207" name="L207"></a> 207             <em class="brace">}</em>
<a id="L208" name="L208"></a> 208 
<a id="L209" name="L209"></a> 209             <strong class="reserved">void</strong> <a href="../S/1829.html#L341" title="Referred from 341 in src/java/beans/beancontext/BeanContextServicesSupport.java.">verifyAndMaybeSetProvider</a>(<a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp, <strong class="reserved">boolean</strong> <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>) <em class="brace">{</em>
<a id="L210" name="L210"></a> 210                 <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;
<a id="L211" name="L211"></a> 211 
<a id="L212" name="L212"></a> 212                 <strong class="reserved">if</strong> (<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>) <em class="brace">{</em> <em class="comment">// the provider is delegated</em>
<a id="L213" name="L213"></a> 213                     <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = delegateProvider;
<a id="L214" name="L214"></a> 214 
<a id="L215" name="L215"></a> 215                     <strong class="reserved">if</strong> (<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> == <strong class="reserved">null</strong> || bcsp == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L216" name="L216"></a> 216                         delegateProvider = bcsp;
<a id="L217" name="L217"></a> 217                         <strong class="reserved">return</strong>;
<a id="L218" name="L218"></a> 218                     <em class="brace">}</em>
<a id="L219" name="L219"></a> 219                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// the provider is registered with this BCS</em>
<a id="L220" name="L220"></a> 220                     <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> = serviceProvider;
<a id="L221" name="L221"></a> 221 
<a id="L222" name="L222"></a> 222                     <strong class="reserved">if</strong> (<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> == <strong class="reserved">null</strong> || bcsp == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L223" name="L223"></a> 223                         serviceProvider = bcsp;
<a id="L224" name="L224"></a> 224                         <strong class="reserved">return</strong>;
<a id="L225" name="L225"></a> 225                     <em class="brace">}</em>
<a id="L226" name="L226"></a> 226                 <em class="brace">}</em>
<a id="L227" name="L227"></a> 227 
<a id="L228" name="L228"></a> 228                 <strong class="reserved">if</strong> (!<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(bcsp))
<a id="L229" name="L229"></a> 229                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>("existing service reference obtained from different BeanContextServiceProvider not supported");
<a id="L230" name="L230"></a> 230 
<a id="L231" name="L231"></a> 231             <em class="brace">}</em>
<a id="L232" name="L232"></a> 232 
<a id="L233" name="L233"></a> 233             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> <a href="../R/11576.html" title="Multiple referred from 2 places.">cloneOfEntries</a>() <em class="brace">{</em>
<a id="L234" name="L234"></a> 234                 <strong class="reserved">return</strong> ((<a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>)requestors.<a href="../D/12888.html" title="Multiple defined in 229 places.">clone</a>()).<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L235" name="L235"></a> 235             <em class="brace">}</em>
<a id="L236" name="L236"></a> 236 
<a id="L237" name="L237"></a> 237             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> <a href="../R/13953.html" title="Multiple referred from 182 places.">entries</a>() <em class="brace">{</em> <strong class="reserved">return</strong> requestors.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>(); <em class="brace">}</em>
<a id="L238" name="L238"></a> 238 
<a id="L239" name="L239"></a> 239             <strong class="reserved">boolean</strong> <a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>() <em class="brace">{</em> <strong class="reserved">return</strong> requestors.<a href="../R/21404.html" title="Multiple referred from 435 places.">isEmpty</a>(); <em class="brace">}</em>
<a id="L240" name="L240"></a> 240 
<a id="L241" name="L241"></a> 241             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> <a href="../R/18987.html" title="Multiple referred from 6 places.">getServiceClass</a>() <em class="brace">{</em> <strong class="reserved">return</strong> serviceClass; <em class="brace">}</em>
<a id="L242" name="L242"></a> 242 
<a id="L243" name="L243"></a> 243             <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> <a href="../R/18995.html" title="Multiple referred from 6 places.">getServiceProvider</a>() <em class="brace">{</em>
<a id="L244" name="L244"></a> 244                 <strong class="reserved">return</strong> serviceProvider;
<a id="L245" name="L245"></a> 245             <em class="brace">}</em>
<a id="L246" name="L246"></a> 246 
<a id="L247" name="L247"></a> 247             <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> <a href="../R/16101.html" title="Multiple referred from 2 places.">getDelegateProvider</a>() <em class="brace">{</em>
<a id="L248" name="L248"></a> 248                 <strong class="reserved">return</strong> delegateProvider;
<a id="L249" name="L249"></a> 249             <em class="brace">}</em>
<a id="L250" name="L250"></a> 250 
<a id="L251" name="L251"></a> 251             <strong class="reserved">boolean</strong> <a href="../R/21341.html" title="Multiple referred from 17 places.">isDelegated</a>() <em class="brace">{</em> <strong class="reserved">return</strong> delegateProvider != <strong class="reserved">null</strong>; <em class="brace">}</em>
<a id="L252" name="L252"></a> 252 
<a id="L253" name="L253"></a> 253             <strong class="reserved">void</strong> <a href="../R/9927.html" title="Multiple referred from 2 places.">addRef</a>(<strong class="reserved">boolean</strong> delegated) <em class="brace">{</em>
<a id="L254" name="L254"></a> 254                 <strong class="reserved">if</strong> (delegated) <em class="brace">{</em>
<a id="L255" name="L255"></a> 255                     delegateRefs++;
<a id="L256" name="L256"></a> 256                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L257" name="L257"></a> 257                     serviceRefs++;
<a id="L258" name="L258"></a> 258                 <em class="brace">}</em>
<a id="L259" name="L259"></a> 259             <em class="brace">}</em>
<a id="L260" name="L260"></a> 260 
<a id="L261" name="L261"></a> 261 
<a id="L262" name="L262"></a> 262             <strong class="reserved">void</strong> <a href="../S/1829.html#L394" title="Referred from 394 in src/java/beans/beancontext/BeanContextServicesSupport.java.">releaseRef</a>(<strong class="reserved">boolean</strong> delegated) <em class="brace">{</em>
<a id="L263" name="L263"></a> 263                 <strong class="reserved">if</strong> (delegated) <em class="brace">{</em>
<a id="L264" name="L264"></a> 264                     <strong class="reserved">if</strong> (--delegateRefs == 0) <em class="brace">{</em>
<a id="L265" name="L265"></a> 265                         delegateProvider = <strong class="reserved">null</strong>;
<a id="L266" name="L266"></a> 266                     <em class="brace">}</em>
<a id="L267" name="L267"></a> 267                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L268" name="L268"></a> 268                     <strong class="reserved">if</strong> (--serviceRefs  &lt;= 0) <em class="brace">{</em>
<a id="L269" name="L269"></a> 269                         serviceProvider = <strong class="reserved">null</strong>;
<a id="L270" name="L270"></a> 270                     <em class="brace">}</em>
<a id="L271" name="L271"></a> 271                 <em class="brace">}</em>
<a id="L272" name="L272"></a> 272             <em class="brace">}</em>
<a id="L273" name="L273"></a> 273 
<a id="L274" name="L274"></a> 274             <strong class="reserved">int</strong> getRefs() <em class="brace">{</em> <strong class="reserved">return</strong> serviceRefs + delegateRefs; <em class="brace">}</em>
<a id="L275" name="L275"></a> 275 
<a id="L276" name="L276"></a> 276             <strong class="reserved">int</strong> getDelegateRefs() <em class="brace">{</em> <strong class="reserved">return</strong> delegateRefs; <em class="brace">}</em>
<a id="L277" name="L277"></a> 277 
<a id="L278" name="L278"></a> 278             <strong class="reserved">int</strong> getServiceRefs() <em class="brace">{</em> <strong class="reserved">return</strong> serviceRefs; <em class="brace">}</em>
<a id="L279" name="L279"></a> 279 
<div class="comment">
              fields</div>
<a id="L283" name="L283"></a> 283 
<a id="L284" name="L284"></a> 284             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>                               serviceClass;
<a id="L285" name="L285"></a> 285 
<a id="L286" name="L286"></a> 286             <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a>          serviceProvider;
<a id="L287" name="L287"></a> 287             <strong class="reserved">int</strong>                                 serviceRefs;
<a id="L288" name="L288"></a> 288 
<a id="L289" name="L289"></a> 289             <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a>          delegateProvider; <em class="comment">// proxy</em>
<a id="L290" name="L290"></a> 290             <strong class="reserved">int</strong>                                 delegateRefs;
<a id="L291" name="L291"></a> 291 
<a id="L292" name="L292"></a> 292             <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>                             requestors = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>(1);
<a id="L293" name="L293"></a> 293         <em class="brace">}</em>
<a id="L294" name="L294"></a> 294 
<div class="comment">
          per service reference info ...</div>
<a id="L298" name="L298"></a> 298 
<a id="L299" name="L299"></a> 299         <strong class="reserved">class</strong> <a href="../R/598.html" title="Multiple referred from 7 places.">BCSSCServiceRef</a> <em class="brace">{</em>
<a id="L300" name="L300"></a> 300             BCSSCServiceRef(<a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> scref, <strong class="reserved">boolean</strong> <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>) <em class="brace">{</em>
<a id="L301" name="L301"></a> 301                 serviceClassRef = scref;
<a id="L302" name="L302"></a> 302                 delegated       = <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>;
<a id="L303" name="L303"></a> 303             <em class="brace">}</em>
<a id="L304" name="L304"></a> 304 
<a id="L305" name="L305"></a> 305             <strong class="reserved">void</strong> <a href="../R/9927.html" title="Multiple referred from 2 places.">addRef</a>()  <em class="brace">{</em> refCnt++;        <em class="brace">}</em>
<a id="L306" name="L306"></a> 306             <strong class="reserved">int</strong>  <a href="../R/25846.html" title="Multiple referred from 40 places.">release</a>() <em class="brace">{</em> <strong class="reserved">return</strong> --refCnt; <em class="brace">}</em>
<a id="L307" name="L307"></a> 307 
<a id="L308" name="L308"></a> 308             <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> <a href="../R/18988.html" title="Multiple referred from 4 places.">getServiceClassRef</a>() <em class="brace">{</em> <strong class="reserved">return</strong> serviceClassRef; <em class="brace">}</em>
<a id="L309" name="L309"></a> 309 
<a id="L310" name="L310"></a> 310             <strong class="reserved">boolean</strong> <a href="../R/21341.html" title="Multiple referred from 17 places.">isDelegated</a>() <em class="brace">{</em> <strong class="reserved">return</strong> delegated; <em class="brace">}</em>
<a id="L311" name="L311"></a> 311 
<div class="comment">
              fields</div>
<a id="L315" name="L315"></a> 315 
<a id="L316" name="L316"></a> 316             <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> serviceClassRef;
<a id="L317" name="L317"></a> 317             <strong class="reserved">int</strong>                  refCnt    = 1;
<a id="L318" name="L318"></a> 318             <strong class="reserved">boolean</strong>              delegated = <strong class="reserved">false</strong>;
<a id="L319" name="L319"></a> 319         <em class="brace">}</em>
<a id="L320" name="L320"></a> 320 
<a id="L321" name="L321"></a> 321         BCSSChild(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> bcc, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> peer) <em class="brace">{</em> <strong class="reserved">super</strong>(bcc, peer); <em class="brace">}</em>
<a id="L322" name="L322"></a> 322 
<a id="L323" name="L323"></a> 323         <em class="comment">// note usage of service per requestor, per service</em>
<a id="L324" name="L324"></a> 324 
<a id="L325" name="L325"></a> 325         <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/30036.html" title="Multiple referred from 2 places.">usingService</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> service, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp, <strong class="reserved">boolean</strong> <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>, <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> bcsrl)  <strong class="reserved">throws</strong> <a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a>, <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a> <em class="brace">{</em>
<a id="L326" name="L326"></a> 326 
<a id="L327" name="L327"></a> 327             <em class="comment">// first, process mapping from serviceClass to requestor(s)</em>
<a id="L328" name="L328"></a> 328 
<a id="L329" name="L329"></a> 329             <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> serviceClassRef = <strong class="reserved">null</strong>;
<a id="L330" name="L330"></a> 330 
<a id="L331" name="L331"></a> 331             <strong class="reserved">if</strong> (serviceClasses == <strong class="reserved">null</strong>)
<a id="L332" name="L332"></a> 332                 serviceClasses = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>(1);
<a id="L333" name="L333"></a> 333             <strong class="reserved">else</strong>
<a id="L334" name="L334"></a> 334                 serviceClassRef = (<a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a>)serviceClasses.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(serviceClass);
<a id="L335" name="L335"></a> 335 
<a id="L336" name="L336"></a> 336             <strong class="reserved">if</strong> (serviceClassRef == <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// new service being used ...</em>
<a id="L337" name="L337"></a> 337                 serviceClassRef = <strong class="reserved">new</strong> <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a>(serviceClass, bcsp, <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>);
<a id="L338" name="L338"></a> 338                 serviceClasses.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(serviceClass, serviceClassRef);
<a id="L339" name="L339"></a> 339 
<a id="L340" name="L340"></a> 340             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// existing service ...</em>
<a id="L341" name="L341"></a> 341                 serviceClassRef.<a href="../S/1829.html#L209" title="Defined at 209 in src/java/beans/beancontext/BeanContextServicesSupport.java.">verifyAndMaybeSetProvider</a>(bcsp, <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>); <em class="comment">// throws</em>
<a id="L342" name="L342"></a> 342                 serviceClassRef.<a href="../S/1829.html#L202" title="Defined at 202 in src/java/beans/beancontext/BeanContextServicesSupport.java.">verifyRequestor</a>(requestor, bcsrl); <em class="comment">// throws</em>
<a id="L343" name="L343"></a> 343             <em class="brace">}</em>
<a id="L344" name="L344"></a> 344 
<a id="L345" name="L345"></a> 345             serviceClassRef.<a href="../S/1829.html#L185" title="Defined at 185 in src/java/beans/beancontext/BeanContextServicesSupport.java.">addRequestor</a>(requestor, bcsrl);
<a id="L346" name="L346"></a> 346             serviceClassRef.<a href="../D/11031.html" title="Multiple defined in 2 places.">addRef</a>(<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>);
<a id="L347" name="L347"></a> 347 
<a id="L348" name="L348"></a> 348             <em class="comment">// now handle mapping from requestor to service(s)</em>
<a id="L349" name="L349"></a> 349 
<a id="L350" name="L350"></a> 350             <a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a> serviceRef = <strong class="reserved">null</strong>;
<a id="L351" name="L351"></a> 351             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>             services   = <strong class="reserved">null</strong>;
<a id="L352" name="L352"></a> 352 
<a id="L353" name="L353"></a> 353             <strong class="reserved">if</strong> (serviceRequestors == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L354" name="L354"></a> 354                 serviceRequestors = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>(1);
<a id="L355" name="L355"></a> 355             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L356" name="L356"></a> 356                 services = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>)serviceRequestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(requestor);
<a id="L357" name="L357"></a> 357             <em class="brace">}</em>
<a id="L358" name="L358"></a> 358 
<a id="L359" name="L359"></a> 359             <strong class="reserved">if</strong> (services == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L360" name="L360"></a> 360                 services = <strong class="reserved">new</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>(1);
<a id="L361" name="L361"></a> 361 
<a id="L362" name="L362"></a> 362                 serviceRequestors.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(requestor, services);
<a id="L363" name="L363"></a> 363             <em class="brace">}</em> <strong class="reserved">else</strong>
<a id="L364" name="L364"></a> 364                 serviceRef = (<a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a>)services.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(service);
<a id="L365" name="L365"></a> 365 
<a id="L366" name="L366"></a> 366             <strong class="reserved">if</strong> (serviceRef == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L367" name="L367"></a> 367                 serviceRef = <strong class="reserved">new</strong> <a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a>(serviceClassRef, <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>);
<a id="L368" name="L368"></a> 368 
<a id="L369" name="L369"></a> 369                 services.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(service, serviceRef);
<a id="L370" name="L370"></a> 370             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L371" name="L371"></a> 371                 serviceRef.<a href="../D/11031.html" title="Multiple defined in 2 places.">addRef</a>();
<a id="L372" name="L372"></a> 372             <em class="brace">}</em>
<a id="L373" name="L373"></a> 373         <em class="brace">}</em>
<a id="L374" name="L374"></a> 374 
<a id="L375" name="L375"></a> 375         <em class="comment">// release a service reference</em>
<a id="L376" name="L376"></a> 376 
<a id="L377" name="L377"></a> 377         <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/25863.html" title="Multiple referred from 8 places.">releaseService</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> service) <em class="brace">{</em>
<a id="L378" name="L378"></a> 378             <strong class="reserved">if</strong> (serviceRequestors == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>;
<a id="L379" name="L379"></a> 379 
<a id="L380" name="L380"></a> 380             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a> services = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>)serviceRequestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(requestor);
<a id="L381" name="L381"></a> 381 
<a id="L382" name="L382"></a> 382             <strong class="reserved">if</strong> (services == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>; <em class="comment">// oops its not there anymore!</em>
<a id="L383" name="L383"></a> 383 
<a id="L384" name="L384"></a> 384             <a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a> serviceRef = (<a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a>)services.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(service);
<a id="L385" name="L385"></a> 385 
<a id="L386" name="L386"></a> 386             <strong class="reserved">if</strong> (serviceRef == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>; <em class="comment">// oops its not there anymore!</em>
<a id="L387" name="L387"></a> 387 
<a id="L388" name="L388"></a> 388             <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> serviceClassRef = serviceRef.<a href="../S/1829.html#L308" title="Defined at 308 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getServiceClassRef</a>();
<a id="L389" name="L389"></a> 389             <strong class="reserved">boolean</strong>                    <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a> = serviceRef.<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>();
<a id="L390" name="L390"></a> 390             <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp        = <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a> ? serviceClassRef.<a href="../S/1829.html#L247" title="Defined at 247 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getDelegateProvider</a>() : serviceClassRef.<a href="../D/22443.html" title="Multiple defined in 2 places.">getServiceProvider</a>();
<a id="L391" name="L391"></a> 391 
<a id="L392" name="L392"></a> 392             bcsp.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(<a href="../S/1829.html#L61" title="Defined at 61 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BeanContextServicesSupport</a>.<strong class="reserved">this</strong>.<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), requestor, service);
<a id="L393" name="L393"></a> 393 
<a id="L394" name="L394"></a> 394             serviceClassRef.<a href="../S/1829.html#L262" title="Defined at 262 in src/java/beans/beancontext/BeanContextServicesSupport.java.">releaseRef</a>(<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>);
<a id="L395" name="L395"></a> 395             serviceClassRef.<a href="../S/1829.html#L196" title="Defined at 196 in src/java/beans/beancontext/BeanContextServicesSupport.java.">removeRequestor</a>(requestor);
<a id="L396" name="L396"></a> 396 
<a id="L397" name="L397"></a> 397             <strong class="reserved">if</strong> (serviceRef.<a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>() == 0) <em class="brace">{</em>
<a id="L398" name="L398"></a> 398 
<a id="L399" name="L399"></a> 399                 services.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(service);
<a id="L400" name="L400"></a> 400 
<a id="L401" name="L401"></a> 401                 <strong class="reserved">if</strong> (services.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L402" name="L402"></a> 402                     serviceRequestors.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(requestor);
<a id="L403" name="L403"></a> 403                     serviceClassRef.<a href="../S/1829.html#L196" title="Defined at 196 in src/java/beans/beancontext/BeanContextServicesSupport.java.">removeRequestor</a>(requestor);
<a id="L404" name="L404"></a> 404                 <em class="brace">}</em>
<a id="L405" name="L405"></a> 405 
<a id="L406" name="L406"></a> 406                 <strong class="reserved">if</strong> (serviceRequestors.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L407" name="L407"></a> 407                     serviceRequestors = <strong class="reserved">null</strong>;
<a id="L408" name="L408"></a> 408                 <em class="brace">}</em>
<a id="L409" name="L409"></a> 409 
<a id="L410" name="L410"></a> 410                 <strong class="reserved">if</strong> (serviceClassRef.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L411" name="L411"></a> 411                     serviceClasses.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(serviceClassRef.<a href="../D/22435.html" title="Multiple defined in 3 places.">getServiceClass</a>());
<a id="L412" name="L412"></a> 412                 <em class="brace">}</em>
<a id="L413" name="L413"></a> 413 
<a id="L414" name="L414"></a> 414                 <strong class="reserved">if</strong> (serviceClasses.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L415" name="L415"></a> 415                     serviceClasses = <strong class="reserved">null</strong>;
<a id="L416" name="L416"></a> 416             <em class="brace">}</em>
<a id="L417" name="L417"></a> 417         <em class="brace">}</em>
<a id="L418" name="L418"></a> 418 
<a id="L419" name="L419"></a> 419         <em class="comment">// revoke a service</em>
<a id="L420" name="L420"></a> 420 
<a id="L421" name="L421"></a> 421         <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/26487.html" title="Multiple referred from 2 places.">revokeService</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <strong class="reserved">boolean</strong> <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>, <strong class="reserved">boolean</strong> revokeNow) <em class="brace">{</em>
<a id="L422" name="L422"></a> 422             <strong class="reserved">if</strong> (serviceClasses == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>;
<a id="L423" name="L423"></a> 423 
<a id="L424" name="L424"></a> 424             <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> serviceClassRef = (<a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a>)serviceClasses.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(serviceClass);
<a id="L425" name="L425"></a> 425 
<a id="L426" name="L426"></a> 426             <strong class="reserved">if</strong> (serviceClassRef == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>;
<a id="L427" name="L427"></a> 427 
<a id="L428" name="L428"></a> 428             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i = serviceClassRef.<a href="../S/1829.html#L233" title="Defined at 233 in src/java/beans/beancontext/BeanContextServicesSupport.java.">cloneOfEntries</a>();
<a id="L429" name="L429"></a> 429 
<a id="L430" name="L430"></a> 430             <a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a> bcsre       = <strong class="reserved">new</strong> <a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a>(<a href="../S/1829.html#L61" title="Defined at 61 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BeanContextServicesSupport</a>.<strong class="reserved">this</strong>.<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), serviceClass, revokeNow);
<a id="L431" name="L431"></a> 431             <strong class="reserved">boolean</strong>                        noMoreRefs  = <strong class="reserved">false</strong>;
<a id="L432" name="L432"></a> 432 
<a id="L433" name="L433"></a> 433             <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>() &amp;&amp; serviceRequestors != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L434" name="L434"></a> 434                 <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>                         entry    = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L435" name="L435"></a> 435                 <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> listener = (<a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a>)entry.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L436" name="L436"></a> 436 
<a id="L437" name="L437"></a> 437                 <strong class="reserved">if</strong> (revokeNow) <em class="brace">{</em>
<a id="L438" name="L438"></a> 438                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>  requestor = entry.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>();
<a id="L439" name="L439"></a> 439                     <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>     services  = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>)serviceRequestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(requestor);
<a id="L440" name="L440"></a> 440 
<a id="L441" name="L441"></a> 441                     <strong class="reserved">if</strong> (services != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L442" name="L442"></a> 442                         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i1 = services.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L443" name="L443"></a> 443 
<a id="L444" name="L444"></a> 444                         <strong class="reserved">while</strong> (i1.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L445" name="L445"></a> 445                             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>       tmp        = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)i1.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L446" name="L446"></a> 446 
<a id="L447" name="L447"></a> 447                             <a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a> serviceRef = (<a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a>)tmp.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L448" name="L448"></a> 448                             <strong class="reserved">if</strong> (serviceRef.<a href="../S/1829.html#L308" title="Defined at 308 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getServiceClassRef</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(serviceClassRef) &amp;&amp; <a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a> == serviceRef.<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>()) <em class="brace">{</em>
<a id="L449" name="L449"></a> 449                                 i1.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L450" name="L450"></a> 450                             <em class="brace">}</em>
<a id="L451" name="L451"></a> 451                         <em class="brace">}</em>
<a id="L452" name="L452"></a> 452 
<a id="L453" name="L453"></a> 453                         <strong class="reserved">if</strong> (noMoreRefs = services.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L454" name="L454"></a> 454                             serviceRequestors.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(requestor);
<a id="L455" name="L455"></a> 455                         <em class="brace">}</em>
<a id="L456" name="L456"></a> 456                     <em class="brace">}</em>
<a id="L457" name="L457"></a> 457 
<a id="L458" name="L458"></a> 458                     <strong class="reserved">if</strong> (noMoreRefs) serviceClassRef.<a href="../S/1829.html#L196" title="Defined at 196 in src/java/beans/beancontext/BeanContextServicesSupport.java.">removeRequestor</a>(requestor);
<a id="L459" name="L459"></a> 459                 <em class="brace">}</em>
<a id="L460" name="L460"></a> 460 
<a id="L461" name="L461"></a> 461                 listener.<a href="../D/31831.html" title="Multiple defined in 4 places.">serviceRevoked</a>(bcsre);
<a id="L462" name="L462"></a> 462             <em class="brace">}</em>
<a id="L463" name="L463"></a> 463 
<a id="L464" name="L464"></a> 464             <strong class="reserved">if</strong> (revokeNow &amp;&amp; serviceClasses != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L465" name="L465"></a> 465                 <strong class="reserved">if</strong> (serviceClassRef.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L466" name="L466"></a> 466                     serviceClasses.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(serviceClass);
<a id="L467" name="L467"></a> 467 
<a id="L468" name="L468"></a> 468                 <strong class="reserved">if</strong> (serviceClasses.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L469" name="L469"></a> 469                     serviceClasses = <strong class="reserved">null</strong>;
<a id="L470" name="L470"></a> 470             <em class="brace">}</em>
<a id="L471" name="L471"></a> 471 
<a id="L472" name="L472"></a> 472             <strong class="reserved">if</strong> (serviceRequestors != <strong class="reserved">null</strong> &amp;&amp; serviceRequestors.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L473" name="L473"></a> 473                 serviceRequestors = <strong class="reserved">null</strong>;
<a id="L474" name="L474"></a> 474         <em class="brace">}</em>
<a id="L475" name="L475"></a> 475 
<a id="L476" name="L476"></a> 476         <em class="comment">// release all references for this child since it has been unnested.</em>
<a id="L477" name="L477"></a> 477 
<a id="L478" name="L478"></a> 478         <strong class="reserved">void</strong> <a href="../S/1829.html#L1030" title="Referred from 1030 in src/java/beans/beancontext/BeanContextServicesSupport.java.">cleanupReferences</a>() <em class="brace">{</em>
<a id="L479" name="L479"></a> 479 
<a id="L480" name="L480"></a> 480             <strong class="reserved">if</strong> (serviceRequestors == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>;
<a id="L481" name="L481"></a> 481 
<a id="L482" name="L482"></a> 482             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> requestors = serviceRequestors.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L483" name="L483"></a> 483 
<a id="L484" name="L484"></a> 484             <strong class="reserved">while</strong>(requestors.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L485" name="L485"></a> 485                 <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>            tmp       = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)requestors.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L486" name="L486"></a> 486                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>               requestor = tmp.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>();
<a id="L487" name="L487"></a> 487                 <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a>             services  = ((<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>)tmp.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>()).<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L488" name="L488"></a> 488 
<a id="L489" name="L489"></a> 489                 requestors.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L490" name="L490"></a> 490 
<a id="L491" name="L491"></a> 491                 <strong class="reserved">while</strong> (services.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L492" name="L492"></a> 492                     <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>       entry   = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)services.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L493" name="L493"></a> 493                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>          service = entry.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>();
<a id="L494" name="L494"></a> 494                     <a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a> sref    = (<a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a>)entry.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L495" name="L495"></a> 495 
<a id="L496" name="L496"></a> 496                     <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a>       scref = sref.<a href="../S/1829.html#L308" title="Defined at 308 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getServiceClassRef</a>();
<a id="L497" name="L497"></a> 497 
<a id="L498" name="L498"></a> 498                     <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp  = sref.<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>() ? scref.<a href="../S/1829.html#L247" title="Defined at 247 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getDelegateProvider</a>() : scref.<a href="../D/22443.html" title="Multiple defined in 2 places.">getServiceProvider</a>();
<a id="L499" name="L499"></a> 499 
<a id="L500" name="L500"></a> 500                     scref.<a href="../S/1829.html#L196" title="Defined at 196 in src/java/beans/beancontext/BeanContextServicesSupport.java.">removeRequestor</a>(requestor);
<a id="L501" name="L501"></a> 501                     services.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L502" name="L502"></a> 502 
<a id="L503" name="L503"></a> 503                     <strong class="reserved">while</strong> (sref.<a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>() &gt;= 0) <em class="brace">{</em>
<a id="L504" name="L504"></a> 504                         bcsp.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(<a href="../S/1829.html#L61" title="Defined at 61 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BeanContextServicesSupport</a>.<strong class="reserved">this</strong>.<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), requestor, service);
<a id="L505" name="L505"></a> 505                     <em class="brace">}</em>
<a id="L506" name="L506"></a> 506                 <em class="brace">}</em>
<a id="L507" name="L507"></a> 507             <em class="brace">}</em>
<a id="L508" name="L508"></a> 508 
<a id="L509" name="L509"></a> 509             serviceRequestors = <strong class="reserved">null</strong>;
<a id="L510" name="L510"></a> 510             serviceClasses    = <strong class="reserved">null</strong>;
<a id="L511" name="L511"></a> 511         <em class="brace">}</em>
<a id="L512" name="L512"></a> 512 
<a id="L513" name="L513"></a> 513         <strong class="reserved">void</strong> <a href="../S/1829.html#L1055" title="Referred from 1055 in src/java/beans/beancontext/BeanContextServicesSupport.java.">revokeAllDelegatedServicesNow</a>() <em class="brace">{</em>
<a id="L514" name="L514"></a> 514             <strong class="reserved">if</strong> (serviceClasses == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>;
<a id="L515" name="L515"></a> 515 
<a id="L516" name="L516"></a> 516             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> serviceClassRefs  =
<a id="L517" name="L517"></a> 517                 <strong class="reserved">new</strong> <a href="../S/1136.html#L89" title="Defined at 89 in src/java/util/HashSet.java.">HashSet</a>(serviceClasses.<a href="../D/36382.html" title="Multiple defined in 31 places.">values</a>()).<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L518" name="L518"></a> 518 
<a id="L519" name="L519"></a> 519             <strong class="reserved">while</strong> (serviceClassRefs.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L520" name="L520"></a> 520                 <a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a> serviceClassRef = (<a href="../S/1829.html#L168" title="Defined at 168 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceClassRef</a>)serviceClassRefs.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L521" name="L521"></a> 521 
<a id="L522" name="L522"></a> 522                 <strong class="reserved">if</strong> (!serviceClassRef.<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>()) <strong class="reserved">continue</strong>;
<a id="L523" name="L523"></a> 523 
<a id="L524" name="L524"></a> 524                 <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i = serviceClassRef.<a href="../S/1829.html#L233" title="Defined at 233 in src/java/beans/beancontext/BeanContextServicesSupport.java.">cloneOfEntries</a>();
<a id="L525" name="L525"></a> 525                 <a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a> bcsre       = <strong class="reserved">new</strong> <a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a>(<a href="../S/1829.html#L61" title="Defined at 61 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BeanContextServicesSupport</a>.<strong class="reserved">this</strong>.<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), serviceClassRef.<a href="../D/22435.html" title="Multiple defined in 3 places.">getServiceClass</a>(), <strong class="reserved">true</strong>);
<a id="L526" name="L526"></a> 526                 <strong class="reserved">boolean</strong>                        noMoreRefs  = <strong class="reserved">false</strong>;
<a id="L527" name="L527"></a> 527 
<a id="L528" name="L528"></a> 528                 <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L529" name="L529"></a> 529                     <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>                         entry     = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L530" name="L530"></a> 530                     <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> listener  = (<a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a>)entry.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L531" name="L531"></a> 531 
<a id="L532" name="L532"></a> 532                     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>                            requestor = entry.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>();
<a id="L533" name="L533"></a> 533                     <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>                               services  = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>)serviceRequestors.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(requestor);
<a id="L534" name="L534"></a> 534 
<a id="L535" name="L535"></a> 535                     <strong class="reserved">if</strong> (services != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L536" name="L536"></a> 536                         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i1 = services.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L537" name="L537"></a> 537 
<a id="L538" name="L538"></a> 538                         <strong class="reserved">while</strong> (i1.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L539" name="L539"></a> 539                             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>       tmp        = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)i1.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L540" name="L540"></a> 540 
<a id="L541" name="L541"></a> 541                             <a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a> serviceRef = (<a href="../S/1829.html#L299" title="Defined at 299 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSCServiceRef</a>)tmp.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L542" name="L542"></a> 542                             <strong class="reserved">if</strong> (serviceRef.<a href="../S/1829.html#L308" title="Defined at 308 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getServiceClassRef</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(serviceClassRef) &amp;&amp; serviceRef.<a href="../D/25420.html" title="Multiple defined in 3 places.">isDelegated</a>()) <em class="brace">{</em>
<a id="L543" name="L543"></a> 543                                 i1.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>();
<a id="L544" name="L544"></a> 544                             <em class="brace">}</em>
<a id="L545" name="L545"></a> 545                         <em class="brace">}</em>
<a id="L546" name="L546"></a> 546 
<a id="L547" name="L547"></a> 547                         <strong class="reserved">if</strong> (noMoreRefs = services.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L548" name="L548"></a> 548                             serviceRequestors.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(requestor);
<a id="L549" name="L549"></a> 549                         <em class="brace">}</em>
<a id="L550" name="L550"></a> 550                     <em class="brace">}</em>
<a id="L551" name="L551"></a> 551 
<a id="L552" name="L552"></a> 552                     <strong class="reserved">if</strong> (noMoreRefs) serviceClassRef.<a href="../S/1829.html#L196" title="Defined at 196 in src/java/beans/beancontext/BeanContextServicesSupport.java.">removeRequestor</a>(requestor);
<a id="L553" name="L553"></a> 553 
<a id="L554" name="L554"></a> 554                     listener.<a href="../D/31831.html" title="Multiple defined in 4 places.">serviceRevoked</a>(bcsre);
<a id="L555" name="L555"></a> 555 
<a id="L556" name="L556"></a> 556                     <strong class="reserved">if</strong> (serviceClassRef.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L557" name="L557"></a> 557                         serviceClasses.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(serviceClassRef.<a href="../D/22435.html" title="Multiple defined in 3 places.">getServiceClass</a>());
<a id="L558" name="L558"></a> 558                 <em class="brace">}</em>
<a id="L559" name="L559"></a> 559             <em class="brace">}</em>
<a id="L560" name="L560"></a> 560 
<a id="L561" name="L561"></a> 561             <strong class="reserved">if</strong> (serviceClasses.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) serviceClasses = <strong class="reserved">null</strong>;
<a id="L562" name="L562"></a> 562 
<a id="L563" name="L563"></a> 563             <strong class="reserved">if</strong> (serviceRequestors != <strong class="reserved">null</strong> &amp;&amp; serviceRequestors.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>())
<a id="L564" name="L564"></a> 564                 serviceRequestors = <strong class="reserved">null</strong>;
<a id="L565" name="L565"></a> 565         <em class="brace">}</em>
<a id="L566" name="L566"></a> 566 
<div class="comment">
          fields</div>
<a id="L570" name="L570"></a> 570 
<a id="L571" name="L571"></a> 571         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>       serviceClasses;
<a id="L572" name="L572"></a> 572         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>       serviceRequestors;
<a id="L573" name="L573"></a> 573     <em class="brace">}</em>
<a id="L574" name="L574"></a> 574 
<div class="comment">
      <p>
      Subclasses can override this method to insert their own subclass
      of Child without having to override add() or the other Collection
      methods that add children to the set.
      </p>
      @param targetChild the child to create the Child on behalf of
      @param peer        the peer if the targetChild and peer are related by BeanContextProxy</div>
<a id="L585" name="L585"></a> 585 
<a id="L586" name="L586"></a> 586     <strong class="reserved">protected</strong> <a href="../S/1830.html#L316" title="Defined at 316 in src/java/beans/beancontext/BeanContextSupport.java.">BCSChild</a> <a href="../R/12222.html" title="Multiple referred from 2 places.">createBCSChild</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> targetChild, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> peer) <em class="brace">{</em>
<a id="L587" name="L587"></a> 587         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>(targetChild, peer);
<a id="L588" name="L588"></a> 588     <em class="brace">}</em>
<a id="L589" name="L589"></a> 589 
<div class="comment">
     /************************************************************************/</div>
<a id="L591" name="L591"></a> 591 
<div class="comment">
          subclasses may subclass this nested class to add behaviors for
          each BeanContextServicesProvider.</div>
<a id="L596" name="L596"></a> 596 
<a id="L597" name="L597"></a> 597         <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/601.html" title="Multiple referred from 7 places.">BCSSServiceProvider</a> <strong class="reserved">implements</strong> <a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L598" name="L598"></a> 598             <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 861278251667444782L;
<a id="L599" name="L599"></a> 599 
<a id="L600" name="L600"></a> 600             BCSSServiceProvider(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> sc, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp) <em class="brace">{</em>
<a id="L601" name="L601"></a> 601                 <strong class="reserved">super</strong>();
<a id="L602" name="L602"></a> 602 
<a id="L603" name="L603"></a> 603                 serviceProvider = bcsp;
<a id="L604" name="L604"></a> 604             <em class="brace">}</em>
<a id="L605" name="L605"></a> 605 
<div class="comment">
              Returns the service provider.
              @return the service provider</div>
<a id="L610" name="L610"></a> 610             <strong class="reserved">protected</strong> <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> <a href="../R/18995.html" title="Multiple referred from 6 places.">getServiceProvider</a>() <em class="brace">{</em>
<a id="L611" name="L611"></a> 611                 <strong class="reserved">return</strong> serviceProvider;
<a id="L612" name="L612"></a> 612             <em class="brace">}</em>
<a id="L613" name="L613"></a> 613 
<div class="comment">
              The service provider.</div>
<a id="L617" name="L617"></a> 617 
<a id="L618" name="L618"></a> 618             <strong class="reserved">protected</strong> <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> serviceProvider;
<a id="L619" name="L619"></a> 619         <em class="brace">}</em>
<a id="L620" name="L620"></a> 620 
<div class="comment">
          subclasses can override this method to create new subclasses of
          BCSSServiceProvider without having to override addService() in
          order to instantiate.
          @param sc the class
          @param bcsp the service provider
          @return a service provider without overriding addService()</div>
<a id="L629" name="L629"></a> 629 
<a id="L630" name="L630"></a> 630         <strong class="reserved">protected</strong> <a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a> <a href="../S/1829.html#L695" title="Referred from 695 in src/java/beans/beancontext/BeanContextServicesSupport.java.">createBCSSServiceProvider</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> sc, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp) <em class="brace">{</em>
<a id="L631" name="L631"></a> 631             <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a>(sc, bcsp);
<a id="L632" name="L632"></a> 632         <em class="brace">}</em>
<a id="L633" name="L633"></a> 633 
<div class="comment">
     /************************************************************************/</div>
<a id="L635" name="L635"></a> 635 
<div class="comment">
      add a BeanContextServicesListener
      @throws NullPointerException if the argument is null</div>
<a id="L641" name="L641"></a> 641 
<a id="L642" name="L642"></a> 642     <strong class="reserved">public</strong> <strong class="reserved">void</strong> addBeanContextServicesListener(<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a> bcsl) <em class="brace">{</em>
<a id="L643" name="L643"></a> 643         <strong class="reserved">if</strong> (bcsl == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("bcsl");
<a id="L644" name="L644"></a> 644 
<a id="L645" name="L645"></a> 645         <strong class="reserved">synchronized</strong>(bcsListeners) <em class="brace">{</em>
<a id="L646" name="L646"></a> 646             <strong class="reserved">if</strong> (bcsListeners.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(bcsl))
<a id="L647" name="L647"></a> 647                 <strong class="reserved">return</strong>;
<a id="L648" name="L648"></a> 648             <strong class="reserved">else</strong>
<a id="L649" name="L649"></a> 649                 bcsListeners.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(bcsl);
<a id="L650" name="L650"></a> 650         <em class="brace">}</em>
<a id="L651" name="L651"></a> 651     <em class="brace">}</em>
<a id="L652" name="L652"></a> 652 
<div class="comment">
      remove a BeanContextServicesListener</div>
<a id="L656" name="L656"></a> 656 
<a id="L657" name="L657"></a> 657     <strong class="reserved">public</strong> <strong class="reserved">void</strong> removeBeanContextServicesListener(<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a> bcsl) <em class="brace">{</em>
<a id="L658" name="L658"></a> 658         <strong class="reserved">if</strong> (bcsl == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("bcsl");
<a id="L659" name="L659"></a> 659 
<a id="L660" name="L660"></a> 660         <strong class="reserved">synchronized</strong>(bcsListeners) <em class="brace">{</em>
<a id="L661" name="L661"></a> 661             <strong class="reserved">if</strong> (!bcsListeners.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(bcsl))
<a id="L662" name="L662"></a> 662                 <strong class="reserved">return</strong>;
<a id="L663" name="L663"></a> 663             <strong class="reserved">else</strong>
<a id="L664" name="L664"></a> 664                 bcsListeners.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(bcsl);
<a id="L665" name="L665"></a> 665         <em class="brace">}</em>
<a id="L666" name="L666"></a> 666     <em class="brace">}</em>
<a id="L667" name="L667"></a> 667 
<div class="comment">
      add a service
      @param serviceClass the service class
      @param bcsp the service provider</div>
<a id="L673" name="L673"></a> 673 
<a id="L674" name="L674"></a> 674     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../S/1829.html#L675" title="Referred from 675 in src/java/beans/beancontext/BeanContextServicesSupport.java.">addService</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp) <em class="brace">{</em>
<a id="L675" name="L675"></a> 675         <strong class="reserved">return</strong> <a href="../D/11069.html" title="Multiple defined in 3 places.">addService</a>(serviceClass, bcsp, <strong class="reserved">true</strong>);
<a id="L676" name="L676"></a> 676     <em class="brace">}</em>
<a id="L677" name="L677"></a> 677 
<div class="comment">
      add a service
      @param serviceClass the service class
      @param bcsp the service provider
      @param fireEvent whether or not an event should be fired
      @return true if the service was successfully added</div>
<a id="L685" name="L685"></a> 685 
<a id="L686" name="L686"></a> 686     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../S/1829.html#L675" title="Referred from 675 in src/java/beans/beancontext/BeanContextServicesSupport.java.">addService</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp, <strong class="reserved">boolean</strong> fireEvent) <em class="brace">{</em>
<a id="L687" name="L687"></a> 687 
<a id="L688" name="L688"></a> 688         <strong class="reserved">if</strong> (serviceClass == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("serviceClass");
<a id="L689" name="L689"></a> 689         <strong class="reserved">if</strong> (bcsp         == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("bcsp");
<a id="L690" name="L690"></a> 690 
<a id="L691" name="L691"></a> 691         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L692" name="L692"></a> 692             <strong class="reserved">if</strong> (services.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(serviceClass))
<a id="L693" name="L693"></a> 693                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L694" name="L694"></a> 694             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L695" name="L695"></a> 695                 services.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(serviceClass,  <a href="../S/1829.html#L630" title="Defined at 630 in src/java/beans/beancontext/BeanContextServicesSupport.java.">createBCSSServiceProvider</a>(serviceClass, bcsp));
<a id="L696" name="L696"></a> 696 
<a id="L697" name="L697"></a> 697                 <strong class="reserved">if</strong> (bcsp <strong class="reserved">instanceof</strong> <a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a>) serializable++;
<a id="L698" name="L698"></a> 698 
<a id="L699" name="L699"></a> 699                 <strong class="reserved">if</strong> (!fireEvent) <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L700" name="L700"></a> 700 
<a id="L701" name="L701"></a> 701 
<a id="L702" name="L702"></a> 702                 <a href="../S/1827.html#L42" title="Defined at 42 in src/java/beans/beancontext/BeanContextServiceAvailableEvent.java.">BeanContextServiceAvailableEvent</a> bcssae = <strong class="reserved">new</strong> <a href="../S/1827.html#L42" title="Defined at 42 in src/java/beans/beancontext/BeanContextServiceAvailableEvent.java.">BeanContextServiceAvailableEvent</a>(<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), serviceClass);
<a id="L703" name="L703"></a> 703 
<a id="L704" name="L704"></a> 704                 <a href="../D/16367.html" title="Multiple defined in 2 places.">fireServiceAdded</a>(bcssae);
<a id="L705" name="L705"></a> 705 
<a id="L706" name="L706"></a> 706                 <strong class="reserved">synchronized</strong>(<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>) <em class="brace">{</em>
<a id="L707" name="L707"></a> 707                     <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i = <a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/26719.html" title="Multiple defined in 33 places.">keySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L708" name="L708"></a> 708 
<a id="L709" name="L709"></a> 709                     <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L710" name="L710"></a> 710                         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L711" name="L711"></a> 711 
<a id="L712" name="L712"></a> 712                         <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> <strong class="reserved">instanceof</strong> <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a>) <em class="brace">{</em>
<a id="L713" name="L713"></a> 713                             ((<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>).<a href="../D/31828.html" title="Multiple defined in 3 places.">serviceAvailable</a>(bcssae);
<a id="L714" name="L714"></a> 714                         <em class="brace">}</em>
<a id="L715" name="L715"></a> 715                     <em class="brace">}</em>
<a id="L716" name="L716"></a> 716                 <em class="brace">}</em>
<a id="L717" name="L717"></a> 717 
<a id="L718" name="L718"></a> 718                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L719" name="L719"></a> 719             <em class="brace">}</em>
<a id="L720" name="L720"></a> 720         <em class="brace">}</em>
<a id="L721" name="L721"></a> 721     <em class="brace">}</em>
<a id="L722" name="L722"></a> 722 
<div class="comment">
      remove a service
      @param serviceClass the service class
      @param bcsp the service provider
      @param revokeCurrentServicesNow whether or not to revoke the service</div>
<a id="L729" name="L729"></a> 729 
<a id="L730" name="L730"></a> 730     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26487.html" title="Multiple referred from 2 places.">revokeService</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp, <strong class="reserved">boolean</strong> revokeCurrentServicesNow) <em class="brace">{</em>
<a id="L731" name="L731"></a> 731 
<a id="L732" name="L732"></a> 732         <strong class="reserved">if</strong> (serviceClass == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("serviceClass");
<a id="L733" name="L733"></a> 733         <strong class="reserved">if</strong> (bcsp         == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("bcsp");
<a id="L734" name="L734"></a> 734 
<a id="L735" name="L735"></a> 735         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L736" name="L736"></a> 736             <strong class="reserved">if</strong> (!services.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(serviceClass)) <strong class="reserved">return</strong>;
<a id="L737" name="L737"></a> 737 
<a id="L738" name="L738"></a> 738             <a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a> bcsssp = (<a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a>)services.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(serviceClass);
<a id="L739" name="L739"></a> 739 
<a id="L740" name="L740"></a> 740             <strong class="reserved">if</strong> (!bcsssp.<a href="../D/22443.html" title="Multiple defined in 2 places.">getServiceProvider</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(bcsp))
<a id="L741" name="L741"></a> 741                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("service provider mismatch");
<a id="L742" name="L742"></a> 742 
<a id="L743" name="L743"></a> 743             services.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(serviceClass);
<a id="L744" name="L744"></a> 744 
<a id="L745" name="L745"></a> 745             <strong class="reserved">if</strong> (bcsp <strong class="reserved">instanceof</strong> <a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a>) serializable--;
<a id="L746" name="L746"></a> 746 
<a id="L747" name="L747"></a> 747             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i = <a href="../S/1830.html#L843" title="Defined at 843 in src/java/beans/beancontext/BeanContextSupport.java.">bcsChildren</a>(); <em class="comment">// get the BCSChild values.</em>
<a id="L748" name="L748"></a> 748 
<a id="L749" name="L749"></a> 749             <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L750" name="L750"></a> 750                 ((<a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>)i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>()).<a href="../D/31418.html" title="Multiple defined in 3 places.">revokeService</a>(serviceClass, <strong class="reserved">false</strong>, revokeCurrentServicesNow);
<a id="L751" name="L751"></a> 751             <em class="brace">}</em>
<a id="L752" name="L752"></a> 752 
<a id="L753" name="L753"></a> 753             <a href="../D/16368.html" title="Multiple defined in 2 places.">fireServiceRevoked</a>(serviceClass, revokeCurrentServicesNow);
<a id="L754" name="L754"></a> 754         <em class="brace">}</em>
<a id="L755" name="L755"></a> 755     <em class="brace">}</em>
<a id="L756" name="L756"></a> 756 
<div class="comment">
      has a service, which may be delegated</div>
<a id="L760" name="L760"></a> 760 
<a id="L761" name="L761"></a> 761     <strong class="reserved">public</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">boolean</strong> <a href="../S/1829.html#L775" title="Referred from 775 in src/java/beans/beancontext/BeanContextServicesSupport.java.">hasService</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass) <em class="brace">{</em>
<a id="L762" name="L762"></a> 762         <strong class="reserved">if</strong> (serviceClass == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("serviceClass");
<a id="L763" name="L763"></a> 763 
<a id="L764" name="L764"></a> 764         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L765" name="L765"></a> 765             <strong class="reserved">if</strong> (services.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(serviceClass)) <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L766" name="L766"></a> 766 
<a id="L767" name="L767"></a> 767             <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcs = <strong class="reserved">null</strong>;
<a id="L768" name="L768"></a> 768 
<a id="L769" name="L769"></a> 769             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L770" name="L770"></a> 770                 bcs = (<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a>)<a href="../D/17222.html" title="Multiple defined in 3 places.">getBeanContext</a>();
<a id="L771" name="L771"></a> 771             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> cce) <em class="brace">{</em>
<a id="L772" name="L772"></a> 772                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L773" name="L773"></a> 773             <em class="brace">}</em>
<a id="L774" name="L774"></a> 774 
<a id="L775" name="L775"></a> 775             <strong class="reserved">return</strong> bcs == <strong class="reserved">null</strong> ? <strong class="reserved">false</strong> : bcs.<a href="../D/24185.html" title="Multiple defined in 2 places.">hasService</a>(serviceClass);
<a id="L776" name="L776"></a> 776         <em class="brace">}</em>
<a id="L777" name="L777"></a> 777     <em class="brace">}</em>
<a id="L778" name="L778"></a> 778 
<div class="comment">
     /************************************************************************/</div>
<a id="L780" name="L780"></a> 780 
<div class="comment">
      a nested subclass used to represent a proxy for serviceClasses delegated
      to an enclosing BeanContext.</div>
<a id="L785" name="L785"></a> 785 
<a id="L786" name="L786"></a> 786     <strong class="reserved">protected</strong> <strong class="reserved">class</strong> <a href="../R/600.html" title="Multiple referred from 2 places.">BCSSProxyServiceProvider</a> <strong class="reserved">implements</strong> <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a>, <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> <em class="brace">{</em>
<a id="L787" name="L787"></a> 787 
<a id="L788" name="L788"></a> 788         BCSSProxyServiceProvider(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcs) <em class="brace">{</em>
<a id="L789" name="L789"></a> 789             <strong class="reserved">super</strong>();
<a id="L790" name="L790"></a> 790 
<a id="L791" name="L791"></a> 791             nestingCtxt = bcs;
<a id="L792" name="L792"></a> 792         <em class="brace">}</em>
<a id="L793" name="L793"></a> 793 
<a id="L794" name="L794"></a> 794         <strong class="reserved">public</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../R/18986.html" title="Multiple referred from 7 places.">getService</a>(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcs, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> serviceSelector) <em class="brace">{</em>
<a id="L795" name="L795"></a> 795             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> service = <strong class="reserved">null</strong>;
<a id="L796" name="L796"></a> 796 
<a id="L797" name="L797"></a> 797             <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L798" name="L798"></a> 798                 service = nestingCtxt.<a href="../D/22434.html" title="Multiple defined in 5 places.">getService</a>(bcs, requestor, serviceClass, serviceSelector, <strong class="reserved">this</strong>);
<a id="L799" name="L799"></a> 799             <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a> tmle) <em class="brace">{</em>
<a id="L800" name="L800"></a> 800                 <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L801" name="L801"></a> 801             <em class="brace">}</em>
<a id="L802" name="L802"></a> 802 
<a id="L803" name="L803"></a> 803             <strong class="reserved">return</strong> service;
<a id="L804" name="L804"></a> 804         <em class="brace">}</em>
<a id="L805" name="L805"></a> 805 
<a id="L806" name="L806"></a> 806         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/25863.html" title="Multiple referred from 8 places.">releaseService</a>(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcs, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> service) <em class="brace">{</em>
<a id="L807" name="L807"></a> 807             nestingCtxt.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(bcs, requestor, service);
<a id="L808" name="L808"></a> 808         <em class="brace">}</em>
<a id="L809" name="L809"></a> 809 
<a id="L810" name="L810"></a> 810         <strong class="reserved">public</strong> <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> <a href="../R/15903.html" title="Multiple referred from 3 places.">getCurrentServiceSelectors</a>(<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcs, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass) <em class="brace">{</em>
<a id="L811" name="L811"></a> 811             <strong class="reserved">return</strong> nestingCtxt.<a href="../D/18124.html" title="Multiple defined in 5 places.">getCurrentServiceSelectors</a>(serviceClass);
<a id="L812" name="L812"></a> 812         <em class="brace">}</em>
<a id="L813" name="L813"></a> 813 
<a id="L814" name="L814"></a> 814         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26854.html" title="Multiple referred from 5 places.">serviceRevoked</a>(<a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a> bcsre) <em class="brace">{</em>
<a id="L815" name="L815"></a> 815             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i = <a href="../S/1830.html#L843" title="Defined at 843 in src/java/beans/beancontext/BeanContextSupport.java.">bcsChildren</a>(); <em class="comment">// get the BCSChild values.</em>
<a id="L816" name="L816"></a> 816 
<a id="L817" name="L817"></a> 817             <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L818" name="L818"></a> 818                 ((<a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>)i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>()).<a href="../D/31418.html" title="Multiple defined in 3 places.">revokeService</a>(bcsre.<a href="../D/22435.html" title="Multiple defined in 3 places.">getServiceClass</a>(), <strong class="reserved">true</strong>, bcsre.<a href="../S/1833.html#L88" title="Defined at 88 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">isCurrentServiceInvalidNow</a>());
<a id="L819" name="L819"></a> 819             <em class="brace">}</em>
<a id="L820" name="L820"></a> 820         <em class="brace">}</em>
<a id="L821" name="L821"></a> 821 
<div class="comment">
          fields</div>
<a id="L825" name="L825"></a> 825 
<a id="L826" name="L826"></a> 826         <strong class="reserved">private</strong> <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> nestingCtxt;
<a id="L827" name="L827"></a> 827     <em class="brace">}</em>
<a id="L828" name="L828"></a> 828 
<div class="comment">
     /************************************************************************/</div>
<a id="L830" name="L830"></a> 830 
<div class="comment">
      obtain a service which may be delegated</div>
<a id="L834" name="L834"></a> 834 
<a id="L835" name="L835"></a> 835      <strong class="reserved">public</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../R/18986.html" title="Multiple referred from 7 places.">getService</a>(<a href="../S/1837.html#L68" title="Defined at 68 in src/java/beans/beancontext/BeanContextChild.java.">BeanContextChild</a> child, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> serviceSelector, <a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a> bcsrl) <strong class="reserved">throws</strong> <a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a> <em class="brace">{</em>
<a id="L836" name="L836"></a> 836         <strong class="reserved">if</strong> (child        == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("child");
<a id="L837" name="L837"></a> 837         <strong class="reserved">if</strong> (serviceClass == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("serviceClass");
<a id="L838" name="L838"></a> 838         <strong class="reserved">if</strong> (requestor    == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("requestor");
<a id="L839" name="L839"></a> 839         <strong class="reserved">if</strong> (bcsrl        == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("bcsrl");
<a id="L840" name="L840"></a> 840 
<a id="L841" name="L841"></a> 841         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>              service = <strong class="reserved">null</strong>;
<a id="L842" name="L842"></a> 842         <a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>           bcsc;
<a id="L843" name="L843"></a> 843         <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcssp   = <a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>();
<a id="L844" name="L844"></a> 844 
<a id="L845" name="L845"></a> 845         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L846" name="L846"></a> 846             <strong class="reserved">synchronized</strong>(<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>) <em class="brace">{</em> bcsc = (<a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>)<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(child); <em class="brace">}</em>
<a id="L847" name="L847"></a> 847 
<a id="L848" name="L848"></a> 848             <strong class="reserved">if</strong> (bcsc == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("not a child of this context"); <em class="comment">// not a child ...</em>
<a id="L849" name="L849"></a> 849 
<a id="L850" name="L850"></a> 850             <a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a> bcsssp = (<a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a>)services.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(serviceClass);
<a id="L851" name="L851"></a> 851 
<a id="L852" name="L852"></a> 852             <strong class="reserved">if</strong> (bcsssp != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L853" name="L853"></a> 853                 <a href="../S/1835.html#L52" title="Defined at 52 in src/java/beans/beancontext/BeanContextServiceProvider.java.">BeanContextServiceProvider</a> bcsp = bcsssp.<a href="../D/22443.html" title="Multiple defined in 2 places.">getServiceProvider</a>();
<a id="L854" name="L854"></a> 854                 service = bcsp.<a href="../D/22434.html" title="Multiple defined in 5 places.">getService</a>(bcssp, requestor, serviceClass, serviceSelector);
<a id="L855" name="L855"></a> 855                 <strong class="reserved">if</strong> (service != <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// do bookkeeping ...</em>
<a id="L856" name="L856"></a> 856                     <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L857" name="L857"></a> 857                         bcsc.<a href="../S/1829.html#L325" title="Defined at 325 in src/java/beans/beancontext/BeanContextServicesSupport.java.">usingService</a>(requestor, service, serviceClass, bcsp, <strong class="reserved">false</strong>, bcsrl);
<a id="L858" name="L858"></a> 858                     <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a> tmle) <em class="brace">{</em>
<a id="L859" name="L859"></a> 859                         bcsp.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(bcssp, requestor, service);
<a id="L860" name="L860"></a> 860                         <strong class="reserved">throw</strong> tmle;
<a id="L861" name="L861"></a> 861                     <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a> uope) <em class="brace">{</em>
<a id="L862" name="L862"></a> 862                         bcsp.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(bcssp, requestor, service);
<a id="L863" name="L863"></a> 863                         <strong class="reserved">throw</strong> uope; <em class="comment">// unchecked rt exception</em>
<a id="L864" name="L864"></a> 864                     <em class="brace">}</em>
<a id="L865" name="L865"></a> 865 
<a id="L866" name="L866"></a> 866                     <strong class="reserved">return</strong> service;
<a id="L867" name="L867"></a> 867                 <em class="brace">}</em>
<a id="L868" name="L868"></a> 868             <em class="brace">}</em>
<a id="L869" name="L869"></a> 869 
<a id="L870" name="L870"></a> 870 
<a id="L871" name="L871"></a> 871             <strong class="reserved">if</strong> (proxy != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L872" name="L872"></a> 872 
<a id="L873" name="L873"></a> 873                 <em class="comment">// try to delegate ...</em>
<a id="L874" name="L874"></a> 874 
<a id="L875" name="L875"></a> 875                 service = proxy.<a href="../D/22434.html" title="Multiple defined in 5 places.">getService</a>(bcssp, requestor, serviceClass, serviceSelector);
<a id="L876" name="L876"></a> 876 
<a id="L877" name="L877"></a> 877                 <strong class="reserved">if</strong> (service != <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// do bookkeeping ...</em>
<a id="L878" name="L878"></a> 878                     <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L879" name="L879"></a> 879                         bcsc.<a href="../S/1829.html#L325" title="Defined at 325 in src/java/beans/beancontext/BeanContextServicesSupport.java.">usingService</a>(requestor, service, serviceClass, proxy, <strong class="reserved">true</strong>, bcsrl);
<a id="L880" name="L880"></a> 880                     <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1184.html#L50" title="Defined at 50 in src/java/util/TooManyListenersException.java.">TooManyListenersException</a> tmle) <em class="brace">{</em>
<a id="L881" name="L881"></a> 881                         proxy.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(bcssp, requestor, service);
<a id="L882" name="L882"></a> 882                         <strong class="reserved">throw</strong> tmle;
<a id="L883" name="L883"></a> 883                     <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a> uope) <em class="brace">{</em>
<a id="L884" name="L884"></a> 884                         proxy.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(bcssp, requestor, service);
<a id="L885" name="L885"></a> 885                         <strong class="reserved">throw</strong> uope; <em class="comment">// unchecked rt exception</em>
<a id="L886" name="L886"></a> 886                     <em class="brace">}</em>
<a id="L887" name="L887"></a> 887 
<a id="L888" name="L888"></a> 888                     <strong class="reserved">return</strong> service;
<a id="L889" name="L889"></a> 889                 <em class="brace">}</em>
<a id="L890" name="L890"></a> 890             <em class="brace">}</em>
<a id="L891" name="L891"></a> 891         <em class="brace">}</em>
<a id="L892" name="L892"></a> 892 
<a id="L893" name="L893"></a> 893         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L894" name="L894"></a> 894     <em class="brace">}</em>
<a id="L895" name="L895"></a> 895 
<div class="comment">
      release a service</div>
<a id="L899" name="L899"></a> 899 
<a id="L900" name="L900"></a> 900     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/25863.html" title="Multiple referred from 8 places.">releaseService</a>(<a href="../S/1837.html#L68" title="Defined at 68 in src/java/beans/beancontext/BeanContextChild.java.">BeanContextChild</a> child, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> requestor, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> service) <em class="brace">{</em>
<a id="L901" name="L901"></a> 901         <strong class="reserved">if</strong> (child     == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("child");
<a id="L902" name="L902"></a> 902         <strong class="reserved">if</strong> (requestor == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("requestor");
<a id="L903" name="L903"></a> 903         <strong class="reserved">if</strong> (service   == <strong class="reserved">null</strong>) <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("service");
<a id="L904" name="L904"></a> 904 
<a id="L905" name="L905"></a> 905         <a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a> bcsc;
<a id="L906" name="L906"></a> 906 
<a id="L907" name="L907"></a> 907         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L908" name="L908"></a> 908                 <strong class="reserved">synchronized</strong>(<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>) <em class="brace">{</em> bcsc = (<a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>)<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(child); <em class="brace">}</em>
<a id="L909" name="L909"></a> 909 
<a id="L910" name="L910"></a> 910                 <strong class="reserved">if</strong> (bcsc != <strong class="reserved">null</strong>)
<a id="L911" name="L911"></a> 911                     bcsc.<a href="../D/30654.html" title="Multiple defined in 5 places.">releaseService</a>(requestor, service);
<a id="L912" name="L912"></a> 912                 <strong class="reserved">else</strong>
<a id="L913" name="L913"></a> 913                    <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("child actual is not a child of this BeanContext");
<a id="L914" name="L914"></a> 914         <em class="brace">}</em>
<a id="L915" name="L915"></a> 915     <em class="brace">}</em>
<a id="L916" name="L916"></a> 916 
<div class="comment">
      @return an iterator for all the currently registered service classes.</div>
<a id="L920" name="L920"></a> 920 
<a id="L921" name="L921"></a> 921     <strong class="reserved">public</strong> <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> getCurrentServiceClasses() <em class="brace">{</em>
<a id="L922" name="L922"></a> 922         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1830.html#L295" title="Defined at 295 in src/java/beans/beancontext/BeanContextSupport.java.">BCSIterator</a>(services.<a href="../D/26719.html" title="Multiple defined in 33 places.">keySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>());
<a id="L923" name="L923"></a> 923     <em class="brace">}</em>
<a id="L924" name="L924"></a> 924 
<div class="comment">
      @return an iterator for all the currently available service selectors
      (if any) available for the specified service.</div>
<a id="L929" name="L929"></a> 929 
<a id="L930" name="L930"></a> 930     <strong class="reserved">public</strong> <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> <a href="../R/15903.html" title="Multiple referred from 3 places.">getCurrentServiceSelectors</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass) <em class="brace">{</em>
<a id="L931" name="L931"></a> 931 
<a id="L932" name="L932"></a> 932         <a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a> bcsssp = (<a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a>)services.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(serviceClass);
<a id="L933" name="L933"></a> 933 
<a id="L934" name="L934"></a> 934         <strong class="reserved">return</strong> bcsssp != <strong class="reserved">null</strong> ? <strong class="reserved">new</strong> <a href="../S/1830.html#L295" title="Defined at 295 in src/java/beans/beancontext/BeanContextSupport.java.">BCSIterator</a>(bcsssp.<a href="../D/22443.html" title="Multiple defined in 2 places.">getServiceProvider</a>().<a href="../D/18124.html" title="Multiple defined in 5 places.">getCurrentServiceSelectors</a>(<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), serviceClass)) : <strong class="reserved">null</strong>;
<a id="L935" name="L935"></a> 935     <em class="brace">}</em>
<a id="L936" name="L936"></a> 936 
<div class="comment">
      BeanContextServicesListener callback, propagates event to all
      currently registered listeners and BeanContextServices children,
      if this BeanContextService does not already implement this service
      itself.
      subclasses may override or envelope this method to implement their
      own propagation semantics.</div>
<a id="L946" name="L946"></a> 946 
<a id="L947" name="L947"></a> 947      <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26851.html" title="Multiple referred from 3 places.">serviceAvailable</a>(<a href="../S/1827.html#L42" title="Defined at 42 in src/java/beans/beancontext/BeanContextServiceAvailableEvent.java.">BeanContextServiceAvailableEvent</a> bcssae) <em class="brace">{</em>
<a id="L948" name="L948"></a> 948         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L949" name="L949"></a> 949             <strong class="reserved">if</strong> (services.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(bcssae.<a href="../D/22435.html" title="Multiple defined in 3 places.">getServiceClass</a>())) <strong class="reserved">return</strong>;
<a id="L950" name="L950"></a> 950 
<a id="L951" name="L951"></a> 951             <a href="../D/16367.html" title="Multiple defined in 2 places.">fireServiceAdded</a>(bcssae);
<a id="L952" name="L952"></a> 952 
<a id="L953" name="L953"></a> 953             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i;
<a id="L954" name="L954"></a> 954 
<a id="L955" name="L955"></a> 955             <strong class="reserved">synchronized</strong>(<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>) <em class="brace">{</em>
<a id="L956" name="L956"></a> 956                 i = <a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/26719.html" title="Multiple defined in 33 places.">keySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L957" name="L957"></a> 957             <em class="brace">}</em>
<a id="L958" name="L958"></a> 958 
<a id="L959" name="L959"></a> 959             <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L960" name="L960"></a> 960                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L961" name="L961"></a> 961 
<a id="L962" name="L962"></a> 962                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> <strong class="reserved">instanceof</strong> <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a>) <em class="brace">{</em>
<a id="L963" name="L963"></a> 963                     ((<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>).<a href="../D/31828.html" title="Multiple defined in 3 places.">serviceAvailable</a>(bcssae);
<a id="L964" name="L964"></a> 964                 <em class="brace">}</em>
<a id="L965" name="L965"></a> 965             <em class="brace">}</em>
<a id="L966" name="L966"></a> 966         <em class="brace">}</em>
<a id="L967" name="L967"></a> 967      <em class="brace">}</em>
<a id="L968" name="L968"></a> 968 
<div class="comment">
      BeanContextServicesListener callback, propagates event to all
      currently registered listeners and BeanContextServices children,
      if this BeanContextService does not already implement this service
      itself.
      subclasses may override or envelope this method to implement their
      own propagation semantics.</div>
<a id="L978" name="L978"></a> 978 
<a id="L979" name="L979"></a> 979     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26854.html" title="Multiple referred from 5 places.">serviceRevoked</a>(<a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a> bcssre) <em class="brace">{</em>
<a id="L980" name="L980"></a> 980         <strong class="reserved">synchronized</strong>(<a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a>.globalHierarchyLock) <em class="brace">{</em>
<a id="L981" name="L981"></a> 981             <strong class="reserved">if</strong> (services.<a href="../D/13333.html" title="Multiple defined in 42 places.">containsKey</a>(bcssre.<a href="../D/22435.html" title="Multiple defined in 3 places.">getServiceClass</a>())) <strong class="reserved">return</strong>;
<a id="L982" name="L982"></a> 982 
<a id="L983" name="L983"></a> 983             <a href="../D/16368.html" title="Multiple defined in 2 places.">fireServiceRevoked</a>(bcssre);
<a id="L984" name="L984"></a> 984 
<a id="L985" name="L985"></a> 985             <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i;
<a id="L986" name="L986"></a> 986 
<a id="L987" name="L987"></a> 987             <strong class="reserved">synchronized</strong>(<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>) <em class="brace">{</em>
<a id="L988" name="L988"></a> 988                 i = <a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/26719.html" title="Multiple defined in 33 places.">keySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L989" name="L989"></a> 989             <em class="brace">}</em>
<a id="L990" name="L990"></a> 990 
<a id="L991" name="L991"></a> 991             <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>()) <em class="brace">{</em>
<a id="L992" name="L992"></a> 992                 <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L993" name="L993"></a> 993 
<a id="L994" name="L994"></a> 994                 <strong class="reserved">if</strong> (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> <strong class="reserved">instanceof</strong> <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a>) <em class="brace">{</em>
<a id="L995" name="L995"></a> 995                     ((<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a>)<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>).<a href="../D/31831.html" title="Multiple defined in 4 places.">serviceRevoked</a>(bcssre);
<a id="L996" name="L996"></a> 996                 <em class="brace">}</em>
<a id="L997" name="L997"></a> 997             <em class="brace">}</em>
<a id="L998" name="L998"></a> 998         <em class="brace">}</em>
<a id="L999" name="L999"></a> 999     <em class="brace">}</em>
<a id="L1000" name="L1000"></a>1000 
<div class="comment">
      Gets the <tt>BeanContextServicesListener</tt> (if any) of the specified
      child.
      @param child the specified child
      @return the BeanContextServicesListener (if any) of the specified child</div>
<a id="L1008" name="L1008"></a>1008     <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a> getChildBeanContextServicesListener(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> child) <em class="brace">{</em>
<a id="L1009" name="L1009"></a>1009         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1010" name="L1010"></a>1010             <strong class="reserved">return</strong> (<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a>)child;
<a id="L1011" name="L1011"></a>1011         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> cce) <em class="brace">{</em>
<a id="L1012" name="L1012"></a>1012             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L1013" name="L1013"></a>1013         <em class="brace">}</em>
<a id="L1014" name="L1014"></a>1014     <em class="brace">}</em>
<a id="L1015" name="L1015"></a>1015 
<div class="comment">
      called from superclass child removal operations after a child
      has been successfully removed. called with child synchronized.
      This subclass uses this hook to immediately revoke any services
      being used by this child if it is a BeanContextChild.
      subclasses may envelope this method in order to implement their
      own child removal side-effects.</div>
<a id="L1026" name="L1026"></a>1026 
<a id="L1027" name="L1027"></a>1027     <strong class="reserved">protected</strong> <strong class="reserved">void</strong> <a href="../R/11428.html" title="Multiple referred from 2 places.">childJustRemovedHook</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> child, <a href="../S/1830.html#L316" title="Defined at 316 in src/java/beans/beancontext/BeanContextSupport.java.">BCSChild</a> bcsc) <em class="brace">{</em>
<a id="L1028" name="L1028"></a>1028         <a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a> bcssc = (<a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>)bcsc;
<a id="L1029" name="L1029"></a>1029 
<a id="L1030" name="L1030"></a>1030         bcssc.<a href="../S/1829.html#L478" title="Defined at 478 in src/java/beans/beancontext/BeanContextServicesSupport.java.">cleanupReferences</a>();
<a id="L1031" name="L1031"></a>1031     <em class="brace">}</em>
<a id="L1032" name="L1032"></a>1032 
<div class="comment">
      called from setBeanContext to notify a BeanContextChild
      to release resources obtained from the nesting BeanContext.
      This method revokes any services obtained from its parent.
      subclasses may envelope this method to implement their own semantics.</div>
<a id="L1041" name="L1041"></a>1041 
<a id="L1042" name="L1042"></a>1042     <strong class="reserved">protected</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/25848.html" title="Multiple referred from 2 places.">releaseBeanContextResources</a>() <em class="brace">{</em>
<a id="L1043" name="L1043"></a>1043         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] bcssc;
<a id="L1044" name="L1044"></a>1044 
<a id="L1045" name="L1045"></a>1045         <strong class="reserved">super</strong>.<a href="../D/30634.html" title="Multiple defined in 2 places.">releaseBeanContextResources</a>();
<a id="L1046" name="L1046"></a>1046 
<a id="L1047" name="L1047"></a>1047         <strong class="reserved">synchronized</strong>(<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>) <em class="brace">{</em>
<a id="L1048" name="L1048"></a>1048             <strong class="reserved">if</strong> (<a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <strong class="reserved">return</strong>;
<a id="L1049" name="L1049"></a>1049 
<a id="L1050" name="L1050"></a>1050             bcssc = <a href="../D/12744.html" title="Multiple defined in 7 places.">children</a>.<a href="../D/36382.html" title="Multiple defined in 31 places.">values</a>().<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>();
<a id="L1051" name="L1051"></a>1051         <em class="brace">}</em>
<a id="L1052" name="L1052"></a>1052 
<a id="L1053" name="L1053"></a>1053 
<a id="L1054" name="L1054"></a>1054         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; bcssc.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1055" name="L1055"></a>1055             ((<a href="../S/1829.html#L159" title="Defined at 159 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSChild</a>)bcssc[i]).<a href="../S/1829.html#L513" title="Defined at 513 in src/java/beans/beancontext/BeanContextServicesSupport.java.">revokeAllDelegatedServicesNow</a>();
<a id="L1056" name="L1056"></a>1056         <em class="brace">}</em>
<a id="L1057" name="L1057"></a>1057 
<a id="L1058" name="L1058"></a>1058         proxy = <strong class="reserved">null</strong>;
<a id="L1059" name="L1059"></a>1059     <em class="brace">}</em>
<a id="L1060" name="L1060"></a>1060 
<div class="comment">
      called from setBeanContext to notify a BeanContextChild
      to allocate resources obtained from the nesting BeanContext.
      subclasses may envelope this method to implement their own semantics.</div>
<a id="L1067" name="L1067"></a>1067 
<a id="L1068" name="L1068"></a>1068     <strong class="reserved">protected</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/20687.html" title="Multiple referred from 2 places.">initializeBeanContextResources</a>() <em class="brace">{</em>
<a id="L1069" name="L1069"></a>1069         <strong class="reserved">super</strong>.<a href="../D/24652.html" title="Multiple defined in 2 places.">initializeBeanContextResources</a>();
<a id="L1070" name="L1070"></a>1070 
<a id="L1071" name="L1071"></a>1071         <a href="../S/1839.html#L57" title="Defined at 57 in src/java/beans/beancontext/BeanContext.java.">BeanContext</a> nbc = <a href="../D/17222.html" title="Multiple defined in 3 places.">getBeanContext</a>();
<a id="L1072" name="L1072"></a>1072 
<a id="L1073" name="L1073"></a>1073         <strong class="reserved">if</strong> (nbc == <strong class="reserved">null</strong>) <strong class="reserved">return</strong>;
<a id="L1074" name="L1074"></a>1074 
<a id="L1075" name="L1075"></a>1075         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1076" name="L1076"></a>1076             <a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a> bcs = (<a href="../S/1826.html#L45" title="Defined at 45 in src/java/beans/beancontext/BeanContextServices.java.">BeanContextServices</a>)nbc;
<a id="L1077" name="L1077"></a>1077 
<a id="L1078" name="L1078"></a>1078             proxy = <strong class="reserved">new</strong> <a href="../S/1829.html#L786" title="Defined at 786 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSProxyServiceProvider</a>(bcs);
<a id="L1079" name="L1079"></a>1079         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> cce) <em class="brace">{</em>
<a id="L1080" name="L1080"></a>1080             <em class="comment">// do nothing ...</em>
<a id="L1081" name="L1081"></a>1081         <em class="brace">}</em>
<a id="L1082" name="L1082"></a>1082     <em class="brace">}</em>
<a id="L1083" name="L1083"></a>1083 
<div class="comment">
      Fires a <tt>BeanContextServiceEvent</tt> notifying of a new service.
      @param serviceClass the service class</div>
<a id="L1088" name="L1088"></a>1088     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14604.html" title="Multiple referred from 3 places.">fireServiceAdded</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass) <em class="brace">{</em>
<a id="L1089" name="L1089"></a>1089         <a href="../S/1827.html#L42" title="Defined at 42 in src/java/beans/beancontext/BeanContextServiceAvailableEvent.java.">BeanContextServiceAvailableEvent</a> bcssae = <strong class="reserved">new</strong> <a href="../S/1827.html#L42" title="Defined at 42 in src/java/beans/beancontext/BeanContextServiceAvailableEvent.java.">BeanContextServiceAvailableEvent</a>(<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), serviceClass);
<a id="L1090" name="L1090"></a>1090 
<a id="L1091" name="L1091"></a>1091         <a href="../D/16367.html" title="Multiple defined in 2 places.">fireServiceAdded</a>(bcssae);
<a id="L1092" name="L1092"></a>1092     <em class="brace">}</em>
<a id="L1093" name="L1093"></a>1093 
<div class="comment">
      Fires a <tt>BeanContextServiceAvailableEvent</tt> indicating that a new
      service has become available.
      @param bcssae the <tt>BeanContextServiceAvailableEvent</tt></div>
<a id="L1100" name="L1100"></a>1100     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14604.html" title="Multiple referred from 3 places.">fireServiceAdded</a>(<a href="../S/1827.html#L42" title="Defined at 42 in src/java/beans/beancontext/BeanContextServiceAvailableEvent.java.">BeanContextServiceAvailableEvent</a> bcssae) <em class="brace">{</em>
<a id="L1101" name="L1101"></a>1101         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[]                         <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>;
<a id="L1102" name="L1102"></a>1102 
<a id="L1103" name="L1103"></a>1103         <strong class="reserved">synchronized</strong> (bcsListeners) <em class="brace">{</em> <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a> = bcsListeners.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(); <em class="brace">}</em>
<a id="L1104" name="L1104"></a>1104 
<a id="L1105" name="L1105"></a>1105         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1106" name="L1106"></a>1106             ((<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a>)<a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>[i]).<a href="../D/31828.html" title="Multiple defined in 3 places.">serviceAvailable</a>(bcssae);
<a id="L1107" name="L1107"></a>1107         <em class="brace">}</em>
<a id="L1108" name="L1108"></a>1108     <em class="brace">}</em>
<a id="L1109" name="L1109"></a>1109 
<div class="comment">
      Fires a <tt>BeanContextServiceEvent</tt> notifying of a service being revoked.
      @param bcsre the <tt>BeanContextServiceRevokedEvent</tt></div>
<a id="L1115" name="L1115"></a>1115     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14605.html" title="Multiple referred from 2 places.">fireServiceRevoked</a>(<a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a> bcsre) <em class="brace">{</em>
<a id="L1116" name="L1116"></a>1116         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[]                         <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>;
<a id="L1117" name="L1117"></a>1117 
<a id="L1118" name="L1118"></a>1118         <strong class="reserved">synchronized</strong> (bcsListeners) <em class="brace">{</em> <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a> = bcsListeners.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(); <em class="brace">}</em>
<a id="L1119" name="L1119"></a>1119 
<a id="L1120" name="L1120"></a>1120         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1121" name="L1121"></a>1121             ((<a href="../S/1825.html#L37" title="Defined at 37 in src/java/beans/beancontext/BeanContextServiceRevokedListener.java.">BeanContextServiceRevokedListener</a>)<a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>[i]).<a href="../D/31831.html" title="Multiple defined in 4 places.">serviceRevoked</a>(bcsre);
<a id="L1122" name="L1122"></a>1122         <em class="brace">}</em>
<a id="L1123" name="L1123"></a>1123     <em class="brace">}</em>
<a id="L1124" name="L1124"></a>1124 
<div class="comment">
      Fires a <tt>BeanContextServiceRevokedEvent</tt>
      indicating that a particular service is
      no longer available.
      @param serviceClass the service class
      @param revokeNow whether or not the event should be revoked now</div>
<a id="L1132" name="L1132"></a>1132     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/14605.html" title="Multiple referred from 2 places.">fireServiceRevoked</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> serviceClass, <strong class="reserved">boolean</strong> revokeNow) <em class="brace">{</em>
<a id="L1133" name="L1133"></a>1133         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[]                       <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>;
<a id="L1134" name="L1134"></a>1134         <a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a> bcsre = <strong class="reserved">new</strong> <a href="../S/1833.html#L39" title="Defined at 39 in src/java/beans/beancontext/BeanContextServiceRevokedEvent.java.">BeanContextServiceRevokedEvent</a>(<a href="../S/1829.html#L144" title="Defined at 144 in src/java/beans/beancontext/BeanContextServicesSupport.java.">getBeanContextServicesPeer</a>(), serviceClass, revokeNow);
<a id="L1135" name="L1135"></a>1135 
<a id="L1136" name="L1136"></a>1136         <strong class="reserved">synchronized</strong> (bcsListeners) <em class="brace">{</em> <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a> = bcsListeners.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(); <em class="brace">}</em>
<a id="L1137" name="L1137"></a>1137 
<a id="L1138" name="L1138"></a>1138         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L1139" name="L1139"></a>1139             ((<a href="../S/1823.html#L38" title="Defined at 38 in src/java/beans/beancontext/BeanContextServicesListener.java.">BeanContextServicesListener</a>)<a href="../D/13475.html" title="Multiple defined in 92 places.">copy</a>[i]).<a href="../D/31831.html" title="Multiple defined in 4 places.">serviceRevoked</a>(bcsre);
<a id="L1140" name="L1140"></a>1140         <em class="brace">}</em>
<a id="L1141" name="L1141"></a>1141    <em class="brace">}</em>
<a id="L1142" name="L1142"></a>1142 
<div class="comment">
      called from BeanContextSupport writeObject before it serializes the
      children ...
      This class will serialize any Serializable BeanContextServiceProviders
      herein.
      subclasses may envelope this method to insert their own serialization
      processing that has to occur prior to serialization of the children</div>
<a id="L1153" name="L1153"></a>1153 
<a id="L1154" name="L1154"></a>1154     <strong class="reserved">protected</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../S/1830.html#L1002" title="Referred from 1002 in src/java/beans/beancontext/BeanContextSupport.java.">bcsPreSerializationHook</a>(<a href="../S/1381.html#L162" title="Defined at 162 in src/java/io/ObjectOutputStream.java.">ObjectOutputStream</a> oos) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L1155" name="L1155"></a>1155 
<a id="L1156" name="L1156"></a>1156         oos.<a href="../D/37085.html" title="Multiple defined in 12 places.">writeInt</a>(serializable);
<a id="L1157" name="L1157"></a>1157 
<a id="L1158" name="L1158"></a>1158         <strong class="reserved">if</strong> (serializable &lt;= 0) <strong class="reserved">return</strong>;
<a id="L1159" name="L1159"></a>1159 
<a id="L1160" name="L1160"></a>1160         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L1161" name="L1161"></a>1161 
<a id="L1162" name="L1162"></a>1162         <a href="../D/4461.html" title="Multiple defined in 3 places.">Iterator</a> i = services.<a href="../D/15653.html" title="Multiple defined in 34 places.">entrySet</a>().<a href="../D/26592.html" title="Multiple defined in 126 places.">iterator</a>();
<a id="L1163" name="L1163"></a>1163 
<a id="L1164" name="L1164"></a>1164         <strong class="reserved">while</strong> (i.<a href="../D/24134.html" title="Multiple defined in 81 places.">hasNext</a>() &amp;&amp; <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &lt; serializable) <em class="brace">{</em>
<a id="L1165" name="L1165"></a>1165             <a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>           entry = (<a href="../D/5398.html" title="Multiple defined in 3 places.">Map</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>)i.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L1166" name="L1166"></a>1166             <a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a> bcsp  = <strong class="reserved">null</strong>;
<a id="L1167" name="L1167"></a>1167 
<a id="L1168" name="L1168"></a>1168              <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1169" name="L1169"></a>1169                 bcsp = (<a href="../S/1829.html#L597" title="Defined at 597 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSServiceProvider</a>)entry.<a href="../D/23531.html" title="Multiple defined in 212 places.">getValue</a>();
<a id="L1170" name="L1170"></a>1170              <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> cce) <em class="brace">{</em>
<a id="L1171" name="L1171"></a>1171                 <strong class="reserved">continue</strong>;
<a id="L1172" name="L1172"></a>1172              <em class="brace">}</em>
<a id="L1173" name="L1173"></a>1173 
<a id="L1174" name="L1174"></a>1174              <strong class="reserved">if</strong> (bcsp.<a href="../D/22443.html" title="Multiple defined in 2 places.">getServiceProvider</a>() <strong class="reserved">instanceof</strong> <a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a>) <em class="brace">{</em>
<a id="L1175" name="L1175"></a>1175                 oos.<a href="../D/37124.html" title="Multiple defined in 263 places.">writeObject</a>(entry.<a href="../D/19919.html" title="Multiple defined in 41 places.">getKey</a>());
<a id="L1176" name="L1176"></a>1176                 oos.<a href="../D/37124.html" title="Multiple defined in 263 places.">writeObject</a>(bcsp);
<a id="L1177" name="L1177"></a>1177                 <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>++;
<a id="L1178" name="L1178"></a>1178              <em class="brace">}</em>
<a id="L1179" name="L1179"></a>1179         <em class="brace">}</em>
<a id="L1180" name="L1180"></a>1180 
<a id="L1181" name="L1181"></a>1181         <strong class="reserved">if</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> != serializable)
<a id="L1182" name="L1182"></a>1182             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>("wrote different number of service providers than expected");
<a id="L1183" name="L1183"></a>1183     <em class="brace">}</em>
<a id="L1184" name="L1184"></a>1184 
<div class="comment">
      called from BeanContextSupport readObject before it deserializes the
      children ...
      This class will deserialize any Serializable BeanContextServiceProviders
      serialized earlier thus making them available to the children when they
      deserialized.
      subclasses may envelope this method to insert their own serialization
      processing that has to occur prior to serialization of the children</div>
<a id="L1196" name="L1196"></a>1196 
<a id="L1197" name="L1197"></a>1197     <strong class="reserved">protected</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../S/1830.html#L1079" title="Referred from 1079 in src/java/beans/beancontext/BeanContextSupport.java.">bcsPreDeserializationHook</a>(<a href="../S/1378.html#L206" title="Defined at 206 in src/java/io/ObjectInputStream.java.">ObjectInputStream</a> ois) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/1705.html#L53" title="Defined at 53 in src/java/lang/ClassNotFoundException.java.">ClassNotFoundException</a> <em class="brace">{</em>
<a id="L1198" name="L1198"></a>1198 
<a id="L1199" name="L1199"></a>1199         serializable = ois.<a href="../D/30206.html" title="Multiple defined in 10 places.">readInt</a>();
<a id="L1200" name="L1200"></a>1200 
<a id="L1201" name="L1201"></a>1201         <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = serializable;
<a id="L1202" name="L1202"></a>1202 
<a id="L1203" name="L1203"></a>1203         <strong class="reserved">while</strong> (<a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> &gt; 0) <em class="brace">{</em>
<a id="L1204" name="L1204"></a>1204             services.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(ois.<a href="../D/30232.html" title="Multiple defined in 322 places.">readObject</a>(), ois.<a href="../D/30232.html" title="Multiple defined in 322 places.">readObject</a>());
<a id="L1205" name="L1205"></a>1205             <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>--;
<a id="L1206" name="L1206"></a>1206         <em class="brace">}</em>
<a id="L1207" name="L1207"></a>1207     <em class="brace">}</em>
<a id="L1208" name="L1208"></a>1208 
<div class="comment">
      serialize the instance</div>
<a id="L1212" name="L1212"></a>1212 
<a id="L1213" name="L1213"></a>1213     <strong class="reserved">private</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/30680.html" title="Multiple referred from 184 places.">writeObject</a>(<a href="../S/1381.html#L162" title="Defined at 162 in src/java/io/ObjectOutputStream.java.">ObjectOutputStream</a> oos) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a> <em class="brace">{</em>
<a id="L1214" name="L1214"></a>1214         oos.<a href="../D/14752.html" title="Multiple defined in 6 places.">defaultWriteObject</a>();
<a id="L1215" name="L1215"></a>1215 
<a id="L1216" name="L1216"></a>1216         <a href="../D/31785.html" title="Multiple defined in 18 places.">serialize</a>(oos, (<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>)bcsListeners);
<a id="L1217" name="L1217"></a>1217     <em class="brace">}</em>
<a id="L1218" name="L1218"></a>1218 
<div class="comment">
      deserialize the instance</div>
<a id="L1222" name="L1222"></a>1222 
<a id="L1223" name="L1223"></a>1223     <strong class="reserved">private</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/25518.html" title="Multiple referred from 189 places.">readObject</a>(<a href="../S/1378.html#L206" title="Defined at 206 in src/java/io/ObjectInputStream.java.">ObjectInputStream</a> ois) <strong class="reserved">throws</strong> <a href="../S/1392.html#L39" title="Defined at 39 in src/java/io/IOException.java.">IOException</a>, <a href="../S/1705.html#L53" title="Defined at 53 in src/java/lang/ClassNotFoundException.java.">ClassNotFoundException</a> <em class="brace">{</em>
<a id="L1224" name="L1224"></a>1224 
<a id="L1225" name="L1225"></a>1225         ois.<a href="../D/14746.html" title="Multiple defined in 2 places.">defaultReadObject</a>();
<a id="L1226" name="L1226"></a>1226 
<a id="L1227" name="L1227"></a>1227         <a href="../D/14866.html" title="Multiple defined in 24 places.">deserialize</a>(ois, (<a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>)bcsListeners);
<a id="L1228" name="L1228"></a>1228     <em class="brace">}</em>
<a id="L1229" name="L1229"></a>1229 
<a id="L1230" name="L1230"></a>1230 
<div class="comment">
      fields</div>
<a id="L1234" name="L1234"></a>1234 
<div class="comment">
      all accesses to the <code> protected transient HashMap services </code>
      field should be synchronized on that object</div>
<a id="L1239" name="L1239"></a>1239     <strong class="reserved">protected</strong> <strong class="reserved">transient</strong> <a href="../S/867.html#L137" title="Defined at 137 in src/java/util/HashMap.java.">HashMap</a>                  services;
<a id="L1240" name="L1240"></a>1240 
<div class="comment">
      The number of instances of a serializable <tt>BeanContextServceProvider</tt>.</div>
<a id="L1244" name="L1244"></a>1244     <strong class="reserved">protected</strong> <strong class="reserved">transient</strong> <strong class="reserved">int</strong>                      serializable = 0;
<a id="L1245" name="L1245"></a>1245 
<a id="L1246" name="L1246"></a>1246 
<div class="comment">
      Delegate for the <tt>BeanContextServiceProvider</tt>.</div>
<a id="L1250" name="L1250"></a>1250     <strong class="reserved">protected</strong> <strong class="reserved">transient</strong> <a href="../S/1829.html#L786" title="Defined at 786 in src/java/beans/beancontext/BeanContextServicesSupport.java.">BCSSProxyServiceProvider</a> proxy;
<a id="L1251" name="L1251"></a>1251 
<a id="L1252" name="L1252"></a>1252 
<div class="comment">
      List of <tt>BeanContextServicesListener</tt> objects.</div>
<a id="L1256" name="L1256"></a>1256     <strong class="reserved">protected</strong> <strong class="reserved">transient</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>                bcsListeners;
<a id="L1257" name="L1257"></a>1257 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L130">[^]</a><a href="#L1223">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>