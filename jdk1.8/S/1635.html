<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/lang/invoke/MethodHandleProxies.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L150">[^]</a><a href="#L306">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L150" title="Defined at 150.">asInterfaceInstance</a></li>
<li><a href="#L218" title="Defined at 218.">bindCaller</a></li>
<li><a href="#L234" title="Defined at 234.">isWrapperInstance</a></li>
<li><a href="#L238" title="Defined at 238.">asWrapperInstance</a></li>
<li><a href="#L257" title="Defined at 257.">wrapperInstanceTarget</a></li>
<li><a href="#L270" title="Defined at 270.">wrapperInstanceType</a></li>
<li><a href="#L275" title="Defined at 275.">isObjectMethod</a></li>
<li><a href="#L292" title="Defined at 292.">callObjectMethod</a></li>
<li><a href="#L306" title="Defined at 306.">getSingleNameMethods</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2008, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.lang.<a href="../D/25050.html" title="Multiple defined in 52 places.">invoke</a>;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.lang.reflect.*;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.security.AccessController;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.security.PrivilegedAction;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> sun.invoke.WrapperInstance;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> sun.reflect.CallerSensitive;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> sun.reflect.Reflection;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> sun.reflect.misc.ReflectUtil;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> static java.lang.invoke.MethodHandleStatics.*;
<a id="L37" name="L37"></a>  37 
<div class="comment">
  This class consists exclusively of static methods that help adapt
  method handles to other JVM types, such as interfaces.</div>
<a id="L42" name="L42"></a>  42 <strong class="reserved">public</strong> <strong class="reserved">class</strong> MethodHandleProxies <em class="brace">{</em>
<a id="L43" name="L43"></a>  43 
<a id="L44" name="L44"></a>  44     <strong class="reserved">private</strong> MethodHandleProxies() <em class="brace">{</em> <em class="brace">}</em>  <em class="comment">// do not instantiate</em>
<a id="L45" name="L45"></a>  45 
<div class="comment">
      Produces an instance of the given single-method interface which redirects
      its calls to the given method handle.
      <p>
      A single-method interface is an interface which declares a uniquely named method.
      When determining the uniquely named method of a single-method interface,
      the public <code>Object</code> methods (<code>toString</code>, <code>equals</code>, <code>hashCode</code>)
      are disregarded.  For example, {@link java.util.Comparator} is a single-method interface,
      even though it re-declares the <code>Object.equals</code> method.
      </p><p>
      The interface must be public.  No additional access checks are performed.
      </p><p>
      The resulting instance of the required type will respond to
      invocation of the type's uniquely named method by calling
      the given target on the incoming arguments,
      and returning or throwing whatever the target
      returns or throws.  The invocation will be as if by
      <code>target.invoke</code>.
      The target's type will be checked before the
      instance is created, as if by a call to <code>asType</code>,
      which may result in a <code>WrongMethodTypeException</code>.
      </p><p>
      The uniquely named method is allowed to be multiply declared,
      with distinct type descriptors.  (E.g., it can be overloaded,
      or can possess bridge methods.)  All such declarations are
      connected directly to the target method handle.
      Argument and return types are adjusted by <code>asType</code>
      for each individual declaration.
      </p><p>
      The wrapper instance will implement the requested interface
      and its super-types, but no other single-method interfaces.
      This means that the instance will not unexpectedly
      pass an <code>instanceof</code> test for any unrequested type.
      </p><p style="font-size:smaller;">
      <em>Implementation Note:</em>
      Therefore, each instance must implement a unique single-method interface.
      Implementations may not bundle together
      multiple single-method interfaces onto single implementation classes
      in the style of {@link java.awt.AWTEventMulticaster}.
      </p><p>
      The method handle may throw an <em>undeclared exception</em>,
      which means any checked exception (or other checked throwable)
      not declared by the requested type's single abstract method.
      If this happens, the throwable will be wrapped in an instance of
      {@link java.lang.reflect.UndeclaredThrowableException UndeclaredThrowableException}
      and thrown in that wrapped form.
      </p><p>
      Like {@link java.lang.Integer#valueOf Integer.valueOf},
      <code>asInterfaceInstance</code> is a factory method whose results are defined
      by their behavior.
      It is not guaranteed to return a new instance for every call.
      </p><p>
      Because of the possibility of {@linkplain java.lang.reflect.Method#isBridge bridge methods}
      and other corner cases, the interface may also have several abstract methods
      with the same name but having distinct descriptors (types of returns and parameters).
      In this case, all the methods are bound in common to the one given target.
      The type check and effective <code>asType</code> conversion is applied to each
      method type descriptor, and all abstract methods are bound to the target in common.
      Beyond this type check, no further checks are made to determine that the
      abstract methods are related in any way.
      </p><p>
      Future versions of this API may accept additional types,
      such as abstract classes with single abstract methods.
      Future versions of this API may also equip wrapper instances
      with one or more additional public "marker" interfaces.
      </p><p>
      If a security manager is installed, this method is caller sensitive.
      During any invocation of the target method handle via the returned wrapper,
      the original creator of the wrapper (the caller) will be visible
      to context checks requested by the security manager.
      @param <t> the desired type of the wrapper, a single-method interface
      @param intfc a class object representing <code>T</code>
      @param target the method handle to invoke from the wrapper
      @return a correctly-typed wrapper for the given target
      @throws NullPointerException if either argument is null
      @throws IllegalArgumentException if the <code>intfc</code> is not a
              valid argument to this method
      @throws WrongMethodTypeException if the target cannot
              be converted to the type required by the requested interface</t></p></div>
<a id="L127" name="L127"></a> 127     <em class="comment">// Other notes to implementors:</em>
<a id="L128" name="L128"></a> 128     <em class="comment">// &lt;p&gt;</em>
<a id="L129" name="L129"></a> 129     <em class="comment">// No stable mapping is promised between the single-method interface and</em>
<a id="L130" name="L130"></a> 130     <em class="comment">// the implementation class C.  Over time, several implementation</em>
<a id="L131" name="L131"></a> 131     <em class="comment">// classes might be used for the same type.</em>
<a id="L132" name="L132"></a> 132     <em class="comment">// &lt;p&gt;</em>
<a id="L133" name="L133"></a> 133     <em class="comment">// If the implementation is able</em>
<a id="L134" name="L134"></a> 134     <em class="comment">// to prove that a wrapper of the required type</em>
<a id="L135" name="L135"></a> 135     <em class="comment">// has already been created for a given</em>
<a id="L136" name="L136"></a> 136     <em class="comment">// method handle, or for another method handle with the</em>
<a id="L137" name="L137"></a> 137     <em class="comment">// same behavior, the implementation may return that wrapper in place of</em>
<a id="L138" name="L138"></a> 138     <em class="comment">// a new wrapper.</em>
<a id="L139" name="L139"></a> 139     <em class="comment">// &lt;p&gt;</em>
<a id="L140" name="L140"></a> 140     <em class="comment">// This method is designed to apply to common use cases</em>
<a id="L141" name="L141"></a> 141     <em class="comment">// where a single method handle must interoperate with</em>
<a id="L142" name="L142"></a> 142     <em class="comment">// an interface that implements a function-like</em>
<a id="L143" name="L143"></a> 143     <em class="comment">// API.  Additional variations, such as single-abstract-method classes with</em>
<a id="L144" name="L144"></a> 144     <em class="comment">// private constructors, or interfaces with multiple but related</em>
<a id="L145" name="L145"></a> 145     <em class="comment">// entry points, must be covered by hand-written or automatically</em>
<a id="L146" name="L146"></a> 146     <em class="comment">// generated adapter classes.</em>
<a id="L147" name="L147"></a> 147     <em class="comment">//</em>
<a id="L148" name="L148"></a> 148     @CallerSensitive
<a id="L149" name="L149"></a> 149     <strong class="reserved">public</strong> <strong class="reserved">static</strong>
<a id="L150" name="L150"></a> 150     &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> asInterfaceInstance(<strong class="reserved">final</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; intfc, <strong class="reserved">final</strong> <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>) <em class="brace">{</em>
<a id="L151" name="L151"></a> 151         <strong class="reserved">if</strong> (!intfc.<a href="../D/25735.html" title="Multiple defined in 6 places.">isInterface</a>() || !<a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.<a href="../D/26117.html" title="Multiple defined in 5 places.">isPublic</a>(intfc.<a href="../D/20712.html" title="Multiple defined in 18 places.">getModifiers</a>()))
<a id="L152" name="L152"></a> 152             <strong class="reserved">throw</strong> <a href="../D/28010.html" title="Multiple defined in 3 places.">newIllegalArgumentException</a>("not a public interface", intfc.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L153" name="L153"></a> 153         <strong class="reserved">final</strong> <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> mh;
<a id="L154" name="L154"></a> 154         <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>() != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L155" name="L155"></a> 155             <strong class="reserved">final</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; caller = Reflection.getCallerClass();
<a id="L156" name="L156"></a> 156             <strong class="reserved">final</strong> <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> ccl = caller != <strong class="reserved">null</strong> ? caller.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>() : <strong class="reserved">null</strong>;
<a id="L157" name="L157"></a> 157             ReflectUtil.checkProxyPackageAccess(ccl, intfc);
<a id="L158" name="L158"></a> 158             mh = ccl != <strong class="reserved">null</strong> ? <a href="../D/11853.html" title="Multiple defined in 3 places.">bindCaller</a>(<a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>, caller) : <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>;
<a id="L159" name="L159"></a> 159         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L160" name="L160"></a> 160             mh = <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>;
<a id="L161" name="L161"></a> 161         <em class="brace">}</em>
<a id="L162" name="L162"></a> 162         <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> proxyLoader = intfc.<a href="../D/17691.html" title="Multiple defined in 20 places.">getClassLoader</a>();
<a id="L163" name="L163"></a> 163         <strong class="reserved">if</strong> (proxyLoader == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L164" name="L164"></a> 164             <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> cl = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>().<a href="../D/17977.html" title="Multiple defined in 21 places.">getContextClassLoader</a>(); <em class="comment">// avoid use of BCP</em>
<a id="L165" name="L165"></a> 165             proxyLoader = cl != <strong class="reserved">null</strong> ? cl : <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a>.<a href="../D/22895.html" title="Multiple defined in 7 places.">getSystemClassLoader</a>();
<a id="L166" name="L166"></a> 166         <em class="brace">}</em>
<a id="L167" name="L167"></a> 167         <strong class="reserved">final</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a> = <a href="../S/1635.html#L306" title="Defined at 306 in src/java/lang/invoke/MethodHandleProxies.java.">getSingleNameMethods</a>(intfc);
<a id="L168" name="L168"></a> 168         <strong class="reserved">if</strong> (<a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a> == <strong class="reserved">null</strong>)
<a id="L169" name="L169"></a> 169             <strong class="reserved">throw</strong> <a href="../D/28010.html" title="Multiple defined in 3 places.">newIllegalArgumentException</a>("not a single-method interface", intfc.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L170" name="L170"></a> 170         <strong class="reserved">final</strong> <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a>[] vaTargets = <strong class="reserved">new</strong> <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a>[<a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L171" name="L171"></a> 171         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L172" name="L172"></a> 172             <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> sm = <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>[i];
<a id="L173" name="L173"></a> 173             <a href="../D/5628.html" title="Multiple defined in 4 places.">MethodType</a> <a href="../S/1635.html#L176" title="Defined at 176 in src/java/lang/invoke/MethodHandleProxies.java.">smMT</a> = <a href="../D/5628.html" title="Multiple defined in 4 places.">MethodType</a>.<a href="../D/27690.html" title="Multiple defined in 8 places.">methodType</a>(sm.<a href="../D/22080.html" title="Multiple defined in 12 places.">getReturnType</a>(), sm.<a href="../D/21380.html" title="Multiple defined in 7 places.">getParameterTypes</a>());
<a id="L174" name="L174"></a> 174             <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> checkTarget = mh.<a href="../D/11568.html" title="Multiple defined in 2 places.">asType</a>(<a href="../S/1635.html#L176" title="Defined at 176 in src/java/lang/invoke/MethodHandleProxies.java.">smMT</a>);  <em class="comment">// make throw WMT</em>
<a id="L175" name="L175"></a> 175             checkTarget = checkTarget.<a href="../D/11568.html" title="Multiple defined in 2 places.">asType</a>(checkTarget.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>().<a href="../S/1616.html#L582" title="Defined at 582 in src/java/lang/invoke/MethodType.java.">changeReturnType</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>.<strong class="reserved">class</strong>));
<a id="L176" name="L176"></a> 176             vaTargets[i] = checkTarget.<a href="../S/1623.html#L868" title="Defined at 868 in src/java/lang/invoke/MethodHandle.java.">asSpreader</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[].<strong class="reserved">class</strong>, <a href="../R/28681.html" title="Multiple referred from 2 places.">smMT</a>.<a href="../D/29054.html" title="Multiple defined in 2 places.">parameterCount</a>());
<a id="L177" name="L177"></a> 177         <em class="brace">}</em>
<a id="L178" name="L178"></a> 178         <strong class="reserved">final</strong> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a> ih = <strong class="reserved">new</strong> <a href="../S/1641.html#L41" title="Defined at 41 in src/java/lang/reflect/InvocationHandler.java.">InvocationHandler</a>() <em class="brace">{</em>
<a id="L179" name="L179"></a> 179                 <strong class="reserved">private</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/4961.html#L139" title="Defined at 139 in src/com/sun/org/apache/xpath/internal/functions/FuncExtFunction.java.">getArg</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/27856.html" title="Multiple defined in 46 places.">name</a>) <em class="brace">{</em>
<a id="L180" name="L180"></a> 180                     <strong class="reserved">if</strong> ((<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>)<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> == "getWrapperInstanceTarget")  <strong class="reserved">return</strong> <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>;
<a id="L181" name="L181"></a> 181                     <strong class="reserved">if</strong> ((<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>)<a href="../D/27856.html" title="Multiple defined in 46 places.">name</a> == "getWrapperInstanceType")    <strong class="reserved">return</strong> intfc;
<a id="L182" name="L182"></a> 182                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1575.html#L43" title="Defined at 43 in src/java/lang/AssertionError.java.">AssertionError</a>();
<a id="L183" name="L183"></a> 183                 <em class="brace">}</em>
<a id="L184" name="L184"></a> 184                 <strong class="reserved">public</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/25050.html" title="Multiple defined in 52 places.">invoke</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> proxy, <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> method, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] args) <strong class="reserved">throws</strong> <a href="../S/1726.html#L114" title="Defined at 114 in src/java/lang/Throwable.java.">Throwable</a> <em class="brace">{</em>
<a id="L185" name="L185"></a> 185                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L186" name="L186"></a> 186                         <strong class="reserved">if</strong> (method.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>[i]))
<a id="L187" name="L187"></a> 187                             <strong class="reserved">return</strong> vaTargets[i].<a href="../S/1623.html#L481" title="Defined at 481 in src/java/lang/invoke/MethodHandle.java.">invokeExact</a>(args);
<a id="L188" name="L188"></a> 188                     <em class="brace">}</em>
<a id="L189" name="L189"></a> 189                     <strong class="reserved">if</strong> (method.<a href="../D/18264.html" title="Multiple defined in 10 places.">getDeclaringClass</a>() == WrapperInstance.<strong class="reserved">class</strong>)
<a id="L190" name="L190"></a> 190                         <strong class="reserved">return</strong> <a href="../S/4961.html#L139" title="Defined at 139 in src/com/sun/org/apache/xpath/internal/functions/FuncExtFunction.java.">getArg</a>(method.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>());
<a id="L191" name="L191"></a> 191                     <strong class="reserved">if</strong> (<a href="../S/1635.html#L275" title="Defined at 275 in src/java/lang/invoke/MethodHandleProxies.java.">isObjectMethod</a>(method))
<a id="L192" name="L192"></a> 192                         <strong class="reserved">return</strong> <a href="../S/1635.html#L292" title="Defined at 292 in src/java/lang/invoke/MethodHandleProxies.java.">callObjectMethod</a>(proxy, method, args);
<a id="L193" name="L193"></a> 193                     <strong class="reserved">throw</strong> <a href="../D/28023.html" title="Multiple defined in 3 places.">newInternalError</a>("bad proxy method: "+method);
<a id="L194" name="L194"></a> 194                 <em class="brace">}</em>
<a id="L195" name="L195"></a> 195             <em class="brace">}</em>;
<a id="L196" name="L196"></a> 196 
<a id="L197" name="L197"></a> 197         <strong class="reserved">final</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> proxy;
<a id="L198" name="L198"></a> 198         <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>() != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L199" name="L199"></a> 199             <em class="comment">// sun.invoke.WrapperInstance is a restricted interface not accessible</em>
<a id="L200" name="L200"></a> 200             <em class="comment">// by any non-null class loader.</em>
<a id="L201" name="L201"></a> 201             <strong class="reserved">final</strong> <a href="../D/1519.html" title="Multiple defined in 2 places.">ClassLoader</a> loader = proxyLoader;
<a id="L202" name="L202"></a> 202             proxy = <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a>(<strong class="reserved">new</strong> <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt;() <em class="brace">{</em>
<a id="L203" name="L203"></a> 203                 <strong class="reserved">public</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L204" name="L204"></a> 204                     <strong class="reserved">return</strong> <a href="../D/6957.html" title="Multiple defined in 2 places.">Proxy</a>.<a href="../D/28059.html" title="Multiple defined in 2 places.">newProxyInstance</a>(
<a id="L205" name="L205"></a> 205                             loader,
<a id="L206" name="L206"></a> 206                             <strong class="reserved">new</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[]<em class="brace">{</em> intfc, WrapperInstance.<strong class="reserved">class</strong> <em class="brace">}</em>,
<a id="L207" name="L207"></a> 207                             ih);
<a id="L208" name="L208"></a> 208                 <em class="brace">}</em>
<a id="L209" name="L209"></a> 209             <em class="brace">}</em>);
<a id="L210" name="L210"></a> 210         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L211" name="L211"></a> 211             proxy = <a href="../D/6957.html" title="Multiple defined in 2 places.">Proxy</a>.<a href="../D/28059.html" title="Multiple defined in 2 places.">newProxyInstance</a>(proxyLoader,
<a id="L212" name="L212"></a> 212                                            <strong class="reserved">new</strong> <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt;[]<em class="brace">{</em> intfc, WrapperInstance.<strong class="reserved">class</strong> <em class="brace">}</em>,
<a id="L213" name="L213"></a> 213                                            ih);
<a id="L214" name="L214"></a> 214         <em class="brace">}</em>
<a id="L215" name="L215"></a> 215         <strong class="reserved">return</strong> intfc.<a href="../D/12274.html" title="Multiple defined in 6 places.">cast</a>(proxy);
<a id="L216" name="L216"></a> 216     <em class="brace">}</em>
<a id="L217" name="L217"></a> 217 
<a id="L218" name="L218"></a> 218     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> <a href="../R/10607.html" title="Multiple referred from 4 places.">bindCaller</a>(<a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> <a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>, <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; hostClass) <em class="brace">{</em>
<a id="L219" name="L219"></a> 219         <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> cbmh = <a href="../S/1634.html#L49" title="Defined at 49 in src/java/lang/invoke/MethodHandleImpl.java.">MethodHandleImpl</a>.<a href="../D/11853.html" title="Multiple defined in 3 places.">bindCaller</a>(<a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>, hostClass);
<a id="L220" name="L220"></a> 220         <strong class="reserved">if</strong> (<a href="../D/35216.html" title="Multiple defined in 4 places.">target</a>.<a href="../D/26478.html" title="Multiple defined in 2 places.">isVarargsCollector</a>()) <em class="brace">{</em>
<a id="L221" name="L221"></a> 221             <a href="../D/5628.html" title="Multiple defined in 4 places.">MethodType</a> <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a> = cbmh.<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>();
<a id="L222" name="L222"></a> 222             <strong class="reserved">int</strong> <a href="../D/11492.html" title="Multiple defined in 3 places.">arity</a> = <a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>.<a href="../D/29054.html" title="Multiple defined in 2 places.">parameterCount</a>();
<a id="L223" name="L223"></a> 223             <strong class="reserved">return</strong> cbmh.<a href="../S/1623.html#L1173" title="Defined at 1173 in src/java/lang/invoke/MethodHandle.java.">asVarargsCollector</a>(<a href="../D/35749.html" title="Multiple defined in 239 places.">type</a>.<a href="../D/29061.html" title="Multiple defined in 3 places.">parameterType</a>(<a href="../D/11492.html" title="Multiple defined in 3 places.">arity</a>-1));
<a id="L224" name="L224"></a> 224         <em class="brace">}</em>
<a id="L225" name="L225"></a> 225         <strong class="reserved">return</strong> cbmh;
<a id="L226" name="L226"></a> 226     <em class="brace">}</em>
<a id="L227" name="L227"></a> 227 
<div class="comment">
      Determines if the given object was produced by a call to <a href="#L150" title="Defined at 150.">asInterfaceInstance</a>.
      @param x any reference
      @return true if the reference is not null and points to an object produced by <code>asInterfaceInstance</code></div>
<a id="L233" name="L233"></a> 233     <strong class="reserved">public</strong> <strong class="reserved">static</strong>
<a id="L234" name="L234"></a> 234     <strong class="reserved">boolean</strong> isWrapperInstance(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <em class="brace">{</em>
<a id="L235" name="L235"></a> 235         <strong class="reserved">return</strong> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> <strong class="reserved">instanceof</strong> WrapperInstance;
<a id="L236" name="L236"></a> 236     <em class="brace">}</em>
<a id="L237" name="L237"></a> 237 
<a id="L238" name="L238"></a> 238     <strong class="reserved">private</strong> <strong class="reserved">static</strong> WrapperInstance <a href="../R/10361.html" title="Multiple referred from 2 places.">asWrapperInstance</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <em class="brace">{</em>
<a id="L239" name="L239"></a> 239         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L240" name="L240"></a> 240             <strong class="reserved">if</strong> (<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a> != <strong class="reserved">null</strong>)
<a id="L241" name="L241"></a> 241                 <strong class="reserved">return</strong> (WrapperInstance) <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>;
<a id="L242" name="L242"></a> 242         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1727.html#L41" title="Defined at 41 in src/java/lang/ClassCastException.java.">ClassCastException</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em>
<a id="L243" name="L243"></a> 243         <em class="brace">}</em>
<a id="L244" name="L244"></a> 244         <strong class="reserved">throw</strong> <a href="../D/28010.html" title="Multiple defined in 3 places.">newIllegalArgumentException</a>("not a wrapper instance");
<a id="L245" name="L245"></a> 245     <em class="brace">}</em>
<a id="L246" name="L246"></a> 246 
<div class="comment">
      Produces or recovers a target method handle which is behaviorally
      equivalent to the unique method of this wrapper instance.
      The object <code>x</code> must have been produced by a call to <a href="#L150" title="Defined at 150.">asInterfaceInstance</a>.
      This requirement may be tested via <a href="#L234" title="Defined at 234.">isWrapperInstance</a>.
      @param x any reference
      @return a method handle implementing the unique method
      @throws IllegalArgumentException if the reference x is not to a wrapper instance</div>
<a id="L256" name="L256"></a> 256     <strong class="reserved">public</strong> <strong class="reserved">static</strong>
<a id="L257" name="L257"></a> 257     <a href="../S/1623.html#L421" title="Defined at 421 in src/java/lang/invoke/MethodHandle.java.">MethodHandle</a> wrapperInstanceTarget(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <em class="brace">{</em>
<a id="L258" name="L258"></a> 258         <strong class="reserved">return</strong> <a href="../S/1635.html#L238" title="Defined at 238 in src/java/lang/invoke/MethodHandleProxies.java.">asWrapperInstance</a>(<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>).getWrapperInstanceTarget();
<a id="L259" name="L259"></a> 259     <em class="brace">}</em>
<a id="L260" name="L260"></a> 260 
<div class="comment">
      Recovers the unique single-method interface type for which this wrapper instance was created.
      The object <code>x</code> must have been produced by a call to <a href="#L150" title="Defined at 150.">asInterfaceInstance</a>.
      This requirement may be tested via <a href="#L234" title="Defined at 234.">isWrapperInstance</a>.
      @param x any reference
      @return the single-method interface type for which the wrapper was created
      @throws IllegalArgumentException if the reference x is not to a wrapper instance</div>
<a id="L269" name="L269"></a> 269     <strong class="reserved">public</strong> <strong class="reserved">static</strong>
<a id="L270" name="L270"></a> 270     <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; wrapperInstanceType(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>) <em class="brace">{</em>
<a id="L271" name="L271"></a> 271         <strong class="reserved">return</strong> <a href="../S/1635.html#L238" title="Defined at 238 in src/java/lang/invoke/MethodHandleProxies.java.">asWrapperInstance</a>(<a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>).getWrapperInstanceType();
<a id="L272" name="L272"></a> 272     <em class="brace">}</em>
<a id="L273" name="L273"></a> 273 
<a id="L274" name="L274"></a> 274     <strong class="reserved">private</strong> <strong class="reserved">static</strong>
<a id="L275" name="L275"></a> 275     <strong class="reserved">boolean</strong> <a href="../R/21807.html" title="Multiple referred from 3 places.">isObjectMethod</a>(<a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> m) <em class="brace">{</em>
<a id="L276" name="L276"></a> 276         <strong class="reserved">switch</strong> (m.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>()) <em class="brace">{</em>
<a id="L277" name="L277"></a> 277         <strong class="reserved">case</strong> "toString":
<a id="L278" name="L278"></a> 278             <strong class="reserved">return</strong> (m.<a href="../D/22080.html" title="Multiple defined in 12 places.">getReturnType</a>() == <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a>.<strong class="reserved">class</strong>
<a id="L279" name="L279"></a> 279                     &amp;&amp; m.<a href="../D/21380.html" title="Multiple defined in 7 places.">getParameterTypes</a>().<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 0);
<a id="L280" name="L280"></a> 280         <strong class="reserved">case</strong> "hashCode":
<a id="L281" name="L281"></a> 281             <strong class="reserved">return</strong> (m.<a href="../D/22080.html" title="Multiple defined in 12 places.">getReturnType</a>() == <strong class="reserved">int</strong>.<strong class="reserved">class</strong>
<a id="L282" name="L282"></a> 282                     &amp;&amp; m.<a href="../D/21380.html" title="Multiple defined in 7 places.">getParameterTypes</a>().<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 0);
<a id="L283" name="L283"></a> 283         <strong class="reserved">case</strong> "equals":
<a id="L284" name="L284"></a> 284             <strong class="reserved">return</strong> (m.<a href="../D/22080.html" title="Multiple defined in 12 places.">getReturnType</a>() == <strong class="reserved">boolean</strong>.<strong class="reserved">class</strong>
<a id="L285" name="L285"></a> 285                     &amp;&amp; m.<a href="../D/21380.html" title="Multiple defined in 7 places.">getParameterTypes</a>().<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 1
<a id="L286" name="L286"></a> 286                     &amp;&amp; m.<a href="../D/21380.html" title="Multiple defined in 7 places.">getParameterTypes</a>()[0] == <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>.<strong class="reserved">class</strong>);
<a id="L287" name="L287"></a> 287         <em class="brace">}</em>
<a id="L288" name="L288"></a> 288         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L289" name="L289"></a> 289     <em class="brace">}</em>
<a id="L290" name="L290"></a> 290 
<a id="L291" name="L291"></a> 291     <strong class="reserved">private</strong> <strong class="reserved">static</strong>
<a id="L292" name="L292"></a> 292     <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../S/1635.html#L192" title="Referred from 192 in src/java/lang/invoke/MethodHandleProxies.java.">callObjectMethod</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> self, <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> m, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[] args) <em class="brace">{</em>
<a id="L293" name="L293"></a> 293         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a>(<a href="../S/1635.html#L275" title="Defined at 275 in src/java/lang/invoke/MethodHandleProxies.java.">isObjectMethod</a>(m)) : m;
<a id="L294" name="L294"></a> 294         <strong class="reserved">switch</strong> (m.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>()) <em class="brace">{</em>
<a id="L295" name="L295"></a> 295         <strong class="reserved">case</strong> "toString":
<a id="L296" name="L296"></a> 296             <strong class="reserved">return</strong> self.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>().<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>() + "@" + <a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>.<a href="../D/35410.html" title="Multiple defined in 5 places.">toHexString</a>(self.<a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>());
<a id="L297" name="L297"></a> 297         <strong class="reserved">case</strong> "hashCode":
<a id="L298" name="L298"></a> 298             <strong class="reserved">return</strong> <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L508" title="Defined at 508 in src/java/lang/System.java.">identityHashCode</a>(self);
<a id="L299" name="L299"></a> 299         <strong class="reserved">case</strong> "equals":
<a id="L300" name="L300"></a> 300             <strong class="reserved">return</strong> (self == args[0]);
<a id="L301" name="L301"></a> 301         <em class="brace">}</em>
<a id="L302" name="L302"></a> 302         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L303" name="L303"></a> 303     <em class="brace">}</em>
<a id="L304" name="L304"></a> 304 
<a id="L305" name="L305"></a> 305     <strong class="reserved">private</strong> <strong class="reserved">static</strong>
<a id="L306" name="L306"></a> 306     <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[] <a href="../S/1635.html#L167" title="Referred from 167 in src/java/lang/invoke/MethodHandleProxies.java.">getSingleNameMethods</a>(<a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; intfc) <em class="brace">{</em>
<a id="L307" name="L307"></a> 307         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>&gt; <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>&gt;();
<a id="L308" name="L308"></a> 308         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> uniqueName = <strong class="reserved">null</strong>;
<a id="L309" name="L309"></a> 309         <strong class="reserved">for</strong> (<a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a> m : intfc.<a href="../D/20599.html" title="Multiple defined in 9 places.">getMethods</a>()) <em class="brace">{</em>
<a id="L310" name="L310"></a> 310             <strong class="reserved">if</strong> (<a href="../S/1635.html#L275" title="Defined at 275 in src/java/lang/invoke/MethodHandleProxies.java.">isObjectMethod</a>(m))  <strong class="reserved">continue</strong>;
<a id="L311" name="L311"></a> 311             <strong class="reserved">if</strong> (!<a href="../D/5688.html" title="Multiple defined in 3 places.">Modifier</a>.<a href="../D/25144.html" title="Multiple defined in 6 places.">isAbstract</a>(m.<a href="../D/20712.html" title="Multiple defined in 18 places.">getModifiers</a>()))  <strong class="reserved">continue</strong>;
<a id="L312" name="L312"></a> 312             <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> mname = m.<a href="../D/20784.html" title="Multiple defined in 355 places.">getName</a>();
<a id="L313" name="L313"></a> 313             <strong class="reserved">if</strong> (uniqueName == <strong class="reserved">null</strong>)
<a id="L314" name="L314"></a> 314                 uniqueName = mname;
<a id="L315" name="L315"></a> 315             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (!uniqueName.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(mname))
<a id="L316" name="L316"></a> 316                 <strong class="reserved">return</strong> <strong class="reserved">null</strong>;  <em class="comment">// too many abstract methods</em>
<a id="L317" name="L317"></a> 317             <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(m);
<a id="L318" name="L318"></a> 318         <em class="brace">}</em>
<a id="L319" name="L319"></a> 319         <strong class="reserved">if</strong> (uniqueName == <strong class="reserved">null</strong>)  <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L320" name="L320"></a> 320         <strong class="reserved">return</strong> <a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(<strong class="reserved">new</strong> <a href="../D/5605.html" title="Multiple defined in 4 places.">Method</a>[<a href="../D/27692.html" title="Multiple defined in 2 places.">methods</a>.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()]);
<a id="L321" name="L321"></a> 321     <em class="brace">}</em>
<a id="L322" name="L322"></a> 322 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L150">[^]</a><a href="#L306">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>