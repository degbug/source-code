<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/awt/MultipleGradientPaintContext.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L247">[^]</a><a href="#L721">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L247" title="Defined at 247.">calculateLookupData</a></li>
<li><a href="#L338" title="Defined at 338.">calculateSingleArrayGradient</a></li>
<li><a href="#L408" title="Defined at 408.">calculateMultipleArrayGradient</a></li>
<li><a href="#L454" title="Defined at 454.">interpolate</a></li>
<li><a href="#L490" title="Defined at 490.">convertEntireColorLinearRGBtoSRGB</a></li>
<li><a href="#L522" title="Defined at 522.">indexIntoGradientsArrays</a></li>
<li><a href="#L590" title="Defined at 590.">convertSRGBtoLinearRGB</a></li>
<li><a href="#L607" title="Defined at 607.">convertLinearRGBtoSRGB</a></li>
<li><a href="#L624" title="Defined at 624.">getRaster</a></li>
<li><a href="#L654" title="Defined at 654.">fillRaster</a></li>
<li><a href="#L663" title="Defined at 663.">getCachedRaster</a></li>
<li><a href="#L686" title="Defined at 686.">putCachedRaster</a></li>
<li><a href="#L711" title="Defined at 711.">dispose</a></li>
<li><a href="#L721" title="Defined at 721.">getColorModel</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2006, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.awt;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.awt.MultipleGradientPaint.CycleMethod;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.awt.MultipleGradientPaint.ColorSpaceType;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.awt.color.ColorSpace;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.awt.geom.AffineTransform;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.awt.geom.NoninvertibleTransformException;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.awt.geom.Rectangle2D;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> java.awt.image.ColorModel;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> java.awt.image.DataBuffer;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.awt.image.DataBufferInt;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.awt.image.DirectColorModel;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.awt.image.Raster;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.awt.image.SinglePixelPackedSampleModel;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.awt.image.WritableRaster;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.lang.ref.SoftReference;
<a id="L42" name="L42"></a>  42 <strong class="reserved">import</strong> java.lang.ref.WeakReference;
<a id="L43" name="L43"></a>  43 <strong class="reserved">import</strong> java.util.Arrays;
<a id="L44" name="L44"></a>  44 
<div class="comment">
  This is the superclass for all PaintContexts which use a multiple color
  gradient to fill in their raster.  It provides the actual color
  interpolation functionality.  Subclasses only have to deal with using
  the gradient to fill pixels in a raster.
  @author Nicholas Talian, Vincent Hardy, Jim Graham, Jerry Evans</div>
<a id="L53" name="L53"></a>  53 <strong class="reserved">abstract</strong> <strong class="reserved">class</strong> <a href="../R/5337.html" title="Multiple referred from 2 places.">MultipleGradientPaintContext</a> <strong class="reserved">implements</strong> <a href="../D/6571.html" title="Multiple defined in 2 places.">PaintContext</a> <em class="brace">{</em>
<a id="L54" name="L54"></a>  54 
<div class="comment">
      The PaintContext's ColorModel.  This is ARGB if colors are not all
      opaque, otherwise it is RGB.</div>
<a id="L59" name="L59"></a>  59     <strong class="reserved">protected</strong> <a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> model;
<a id="L60" name="L60"></a>  60 
<div class="comment">
     /** Color model used if gradient colors are all opaque. */</div>
<a id="L62" name="L62"></a>  62     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> xrgbmodel =
<a id="L63" name="L63"></a>  63         <strong class="reserved">new</strong> <a href="../S/2270.html#L109" title="Defined at 109 in src/java/awt/image/DirectColorModel.java.">DirectColorModel</a>(24, 0x00ff0000, 0x0000ff00, 0x000000ff);
<a id="L64" name="L64"></a>  64 
<div class="comment">
     /** The cached ColorModel. */</div>
<a id="L66" name="L66"></a>  66     <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> cachedModel;
<a id="L67" name="L67"></a>  67 
<div class="comment">
     /** The cached raster, which is reusable among instances. */</div>
<a id="L69" name="L69"></a>  69     <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a>&gt; cached;
<a id="L70" name="L70"></a>  70 
<div class="comment">
     /** Raster is reused whenever possible. */</div>
<a id="L72" name="L72"></a>  72     <strong class="reserved">protected</strong> <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> saved;
<a id="L73" name="L73"></a>  73 
<div class="comment">
     /** The method to use when painting out of the gradient bounds. */</div>
<a id="L75" name="L75"></a>  75     <strong class="reserved">protected</strong> <a href="../S/2387.html#L47" title="Defined at 47 in src/java/awt/MultipleGradientPaint.java.">CycleMethod</a> cycleMethod;
<a id="L76" name="L76"></a>  76 
<div class="comment">
     /** The ColorSpace in which to perform the interpolation */</div>
<a id="L78" name="L78"></a>  78     <strong class="reserved">protected</strong> <a href="../S/2387.html#L69" title="Defined at 69 in src/java/awt/MultipleGradientPaint.java.">ColorSpaceType</a> colorSpace;
<a id="L79" name="L79"></a>  79 
<div class="comment">
     /** Elements of the inverse transform matrix. */</div>
<a id="L81" name="L81"></a>  81     <strong class="reserved">protected</strong> <strong class="reserved">float</strong> a00, a01, a10, a11, a02, a12;
<a id="L82" name="L82"></a>  82 
<div class="comment">
      This boolean specifies whether we are in simple lookup mode, where an
      input value between 0 and 1 may be used to directly index into a single
      array of gradient colors.  If this boolean value is false, then we have
      to use a 2-step process where we have to determine which gradient array
      we fall into, then determine the index into that array.</div>
<a id="L90" name="L90"></a>  90     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> isSimpleLookup;
<a id="L91" name="L91"></a>  91 
<div class="comment">
      Size of gradients array for scaling the 0-1 index when looking up
      colors the fast way.</div>
<a id="L96" name="L96"></a>  96     <strong class="reserved">protected</strong> <strong class="reserved">int</strong> fastGradientArraySize;
<a id="L97" name="L97"></a>  97 
<div class="comment">
      Array which contains the interpolated color values for each interval,
      used by calculateSingleArrayGradient().  It is protected for possible
      direct access by subclasses.</div>
<a id="L103" name="L103"></a> 103     <strong class="reserved">protected</strong> <strong class="reserved">int</strong>[] gradient;
<a id="L104" name="L104"></a> 104 
<div class="comment">
      Array of gradient arrays, one array for each interval.  Used by
      calculateMultipleArrayGradient().</div>
<a id="L109" name="L109"></a> 109     <strong class="reserved">private</strong> <strong class="reserved">int</strong>[][] gradients;
<a id="L110" name="L110"></a> 110 
<div class="comment">
     /** Normalized intervals array. */</div>
<a id="L112" name="L112"></a> 112     <strong class="reserved">private</strong> <strong class="reserved">float</strong>[] normalizedIntervals;
<a id="L113" name="L113"></a> 113 
<div class="comment">
     /** Fractions array. */</div>
<a id="L115" name="L115"></a> 115     <strong class="reserved">private</strong> <strong class="reserved">float</strong>[] fractions;
<a id="L116" name="L116"></a> 116 
<div class="comment">
     /** Used to determine if gradient colors are all opaque. */</div>
<a id="L118" name="L118"></a> 118     <strong class="reserved">private</strong> <strong class="reserved">int</strong> transparencyTest;
<a id="L119" name="L119"></a> 119 
<div class="comment">
     /** Color space conversion lookup tables. */</div>
<a id="L121" name="L121"></a> 121     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SRGBtoLinearRGB[] = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[256];
<a id="L122" name="L122"></a> 122     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> LinearRGBtoSRGB[] = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[256];
<a id="L123" name="L123"></a> 123 
<a id="L124" name="L124"></a> 124     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L125" name="L125"></a> 125         <em class="comment">// build the tables</em>
<a id="L126" name="L126"></a> 126         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> k = 0; k &lt; 256; k++) <em class="brace">{</em>
<a id="L127" name="L127"></a> 127             SRGBtoLinearRGB[k] = <a href="../S/2113.html#L590" title="Defined at 590 in src/java/awt/MultipleGradientPaintContext.java.">convertSRGBtoLinearRGB</a>(k);
<a id="L128" name="L128"></a> 128             LinearRGBtoSRGB[k] = <a href="../S/2113.html#L607" title="Defined at 607 in src/java/awt/MultipleGradientPaintContext.java.">convertLinearRGBtoSRGB</a>(k);
<a id="L129" name="L129"></a> 129         <em class="brace">}</em>
<a id="L130" name="L130"></a> 130     <em class="brace">}</em>
<a id="L131" name="L131"></a> 131 
<div class="comment">
      Constant number of max colors between any 2 arbitrary colors.
      Used for creating and indexing gradients arrays.</div>
<a id="L136" name="L136"></a> 136     <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> GRADIENT_SIZE = 256;
<a id="L137" name="L137"></a> 137     <strong class="reserved">protected</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> GRADIENT_SIZE_INDEX = GRADIENT_SIZE -1;
<a id="L138" name="L138"></a> 138 
<div class="comment">
      Maximum length of the fast single-array.  If the estimated array size
      is greater than this, switch over to the slow lookup method.
      No particular reason for choosing this number, but it seems to provide
      satisfactory performance for the common case (fast lookup).</div>
<a id="L145" name="L145"></a> 145     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> MAX_GRADIENT_ARRAY_SIZE = 5000;
<a id="L146" name="L146"></a> 146 
<div class="comment">
      Constructor for MultipleGradientPaintContext superclass.</div>
<a id="L150" name="L150"></a> 150     <strong class="reserved">protected</strong> MultipleGradientPaintContext(<a href="../S/2387.html#L42" title="Defined at 42 in src/java/awt/MultipleGradientPaint.java.">MultipleGradientPaint</a> mgp,
<a id="L151" name="L151"></a> 151                                            <a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> cm,
<a id="L152" name="L152"></a> 152                                            <a href="../S/2314.html#L119" title="Defined at 119 in src/java/awt/Rectangle.java.">Rectangle</a> deviceBounds,
<a id="L153" name="L153"></a> 153                                            <a href="../S/2335.html#L43" title="Defined at 43 in src/java/awt/geom/Rectangle2D.java.">Rectangle2D</a> userBounds,
<a id="L154" name="L154"></a> 154                                            <a href="../S/2328.html#L114" title="Defined at 114 in src/java/awt/geom/AffineTransform.java.">AffineTransform</a> t,
<a id="L155" name="L155"></a> 155                                            <a href="../S/2116.html#L82" title="Defined at 82 in src/java/awt/RenderingHints.java.">RenderingHints</a> hints,
<a id="L156" name="L156"></a> 156                                            <strong class="reserved">float</strong>[] fractions,
<a id="L157" name="L157"></a> 157                                            <a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>[] colors,
<a id="L158" name="L158"></a> 158                                            <a href="../S/2387.html#L47" title="Defined at 47 in src/java/awt/MultipleGradientPaint.java.">CycleMethod</a> cycleMethod,
<a id="L159" name="L159"></a> 159                                            <a href="../S/2387.html#L69" title="Defined at 69 in src/java/awt/MultipleGradientPaint.java.">ColorSpaceType</a> colorSpace)
<a id="L160" name="L160"></a> 160     <em class="brace">{</em>
<a id="L161" name="L161"></a> 161         <strong class="reserved">if</strong> (deviceBounds == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L162" name="L162"></a> 162             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("Device bounds cannot be null");
<a id="L163" name="L163"></a> 163         <em class="brace">}</em>
<a id="L164" name="L164"></a> 164 
<a id="L165" name="L165"></a> 165         <strong class="reserved">if</strong> (userBounds == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L166" name="L166"></a> 166             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("User bounds cannot be null");
<a id="L167" name="L167"></a> 167         <em class="brace">}</em>
<a id="L168" name="L168"></a> 168 
<a id="L169" name="L169"></a> 169         <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L170" name="L170"></a> 170             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("Transform cannot be null");
<a id="L171" name="L171"></a> 171         <em class="brace">}</em>
<a id="L172" name="L172"></a> 172 
<a id="L173" name="L173"></a> 173         <strong class="reserved">if</strong> (hints == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L174" name="L174"></a> 174             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("RenderingHints cannot be null");
<a id="L175" name="L175"></a> 175         <em class="brace">}</em>
<a id="L176" name="L176"></a> 176 
<a id="L177" name="L177"></a> 177         <em class="comment">// The inverse transform is needed to go from device to user space.</em>
<a id="L178" name="L178"></a> 178         <em class="comment">// Get all the components of the inverse transform matrix.</em>
<a id="L179" name="L179"></a> 179         <a href="../S/2328.html#L114" title="Defined at 114 in src/java/awt/geom/AffineTransform.java.">AffineTransform</a> tInv;
<a id="L180" name="L180"></a> 180         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L181" name="L181"></a> 181             <em class="comment">// the following assumes that the caller has copied the incoming</em>
<a id="L182" name="L182"></a> 182             <em class="comment">// transform and is not concerned about it being modified</em>
<a id="L183" name="L183"></a> 183             t.<a href="../S/2328.html#L2751" title="Defined at 2751 in src/java/awt/geom/AffineTransform.java.">invert</a>();
<a id="L184" name="L184"></a> 184             tInv = t;
<a id="L185" name="L185"></a> 185         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/2332.html#L35" title="Defined at 35 in src/java/awt/geom/NoninvertibleTransformException.java.">NoninvertibleTransformException</a> e) <em class="brace">{</em>
<a id="L186" name="L186"></a> 186             <em class="comment">// just use identity transform in this case; better to show</em>
<a id="L187" name="L187"></a> 187             <em class="comment">// (incorrect) results than to throw an exception and/or no-op</em>
<a id="L188" name="L188"></a> 188             tInv = <strong class="reserved">new</strong> <a href="../S/2328.html#L114" title="Defined at 114 in src/java/awt/geom/AffineTransform.java.">AffineTransform</a>();
<a id="L189" name="L189"></a> 189         <em class="brace">}</em>
<a id="L190" name="L190"></a> 190         <strong class="reserved">double</strong> m[] = <strong class="reserved">new</strong> <strong class="reserved">double</strong>[6];
<a id="L191" name="L191"></a> 191         tInv.<a href="../D/20416.html" title="Multiple defined in 4 places.">getMatrix</a>(m);
<a id="L192" name="L192"></a> 192         a00 = (<strong class="reserved">float</strong>)m[0];
<a id="L193" name="L193"></a> 193         a10 = (<strong class="reserved">float</strong>)m[1];
<a id="L194" name="L194"></a> 194         a01 = (<strong class="reserved">float</strong>)m[2];
<a id="L195" name="L195"></a> 195         a11 = (<strong class="reserved">float</strong>)m[3];
<a id="L196" name="L196"></a> 196         a02 = (<strong class="reserved">float</strong>)m[4];
<a id="L197" name="L197"></a> 197         a12 = (<strong class="reserved">float</strong>)m[5];
<a id="L198" name="L198"></a> 198 
<a id="L199" name="L199"></a> 199         <em class="comment">// copy some flags</em>
<a id="L200" name="L200"></a> 200         <strong class="reserved">this</strong>.cycleMethod = cycleMethod;
<a id="L201" name="L201"></a> 201         <strong class="reserved">this</strong>.colorSpace = colorSpace;
<a id="L202" name="L202"></a> 202 
<a id="L203" name="L203"></a> 203         <em class="comment">// we can avoid copying this array since we do not modify its values</em>
<a id="L204" name="L204"></a> 204         <strong class="reserved">this</strong>.fractions = fractions;
<a id="L205" name="L205"></a> 205 
<a id="L206" name="L206"></a> 206         <em class="comment">// note that only one of these values can ever be non-null (we either</em>
<a id="L207" name="L207"></a> 207         <em class="comment">// store the fast gradient array or the slow one, but never both</em>
<a id="L208" name="L208"></a> 208         <em class="comment">// at the same time)</em>
<a id="L209" name="L209"></a> 209         <strong class="reserved">int</strong>[] gradient =
<a id="L210" name="L210"></a> 210             (mgp.gradient != <strong class="reserved">null</strong>) ? mgp.gradient.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() : <strong class="reserved">null</strong>;
<a id="L211" name="L211"></a> 211         <strong class="reserved">int</strong>[][] gradients =
<a id="L212" name="L212"></a> 212             (mgp.gradients != <strong class="reserved">null</strong>) ? mgp.gradients.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() : <strong class="reserved">null</strong>;
<a id="L213" name="L213"></a> 213 
<a id="L214" name="L214"></a> 214         <strong class="reserved">if</strong> (gradient == <strong class="reserved">null</strong> &amp;&amp; gradients == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L215" name="L215"></a> 215             <em class="comment">// we need to (re)create the appropriate values</em>
<a id="L216" name="L216"></a> 216             <a href="../S/2113.html#L247" title="Defined at 247 in src/java/awt/MultipleGradientPaintContext.java.">calculateLookupData</a>(colors);
<a id="L217" name="L217"></a> 217 
<a id="L218" name="L218"></a> 218             <em class="comment">// now cache the calculated values in the</em>
<a id="L219" name="L219"></a> 219             <em class="comment">// MultipleGradientPaint instance for future use</em>
<a id="L220" name="L220"></a> 220             mgp.model               = <strong class="reserved">this</strong>.model;
<a id="L221" name="L221"></a> 221             mgp.normalizedIntervals = <strong class="reserved">this</strong>.normalizedIntervals;
<a id="L222" name="L222"></a> 222             mgp.isSimpleLookup      = <strong class="reserved">this</strong>.isSimpleLookup;
<a id="L223" name="L223"></a> 223             <strong class="reserved">if</strong> (isSimpleLookup) <em class="brace">{</em>
<a id="L224" name="L224"></a> 224                 <em class="comment">// only cache the fast array</em>
<a id="L225" name="L225"></a> 225                 mgp.fastGradientArraySize = <strong class="reserved">this</strong>.fastGradientArraySize;
<a id="L226" name="L226"></a> 226                 mgp.gradient = <strong class="reserved">new</strong> <a href="../S/1564.html#L64" title="Defined at 64 in src/java/lang/ref/SoftReference.java.">SoftReference</a>&lt;<strong class="reserved">int</strong>[]&gt;(<strong class="reserved">this</strong>.gradient);
<a id="L227" name="L227"></a> 227             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L228" name="L228"></a> 228                 <em class="comment">// only cache the slow array</em>
<a id="L229" name="L229"></a> 229                 mgp.gradients = <strong class="reserved">new</strong> <a href="../S/1564.html#L64" title="Defined at 64 in src/java/lang/ref/SoftReference.java.">SoftReference</a>&lt;<strong class="reserved">int</strong>[][]&gt;(<strong class="reserved">this</strong>.gradients);
<a id="L230" name="L230"></a> 230             <em class="brace">}</em>
<a id="L231" name="L231"></a> 231         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L232" name="L232"></a> 232             <em class="comment">// use the values cached in the MultipleGradientPaint instance</em>
<a id="L233" name="L233"></a> 233             <strong class="reserved">this</strong>.model                 = mgp.model;
<a id="L234" name="L234"></a> 234             <strong class="reserved">this</strong>.normalizedIntervals   = mgp.normalizedIntervals;
<a id="L235" name="L235"></a> 235             <strong class="reserved">this</strong>.isSimpleLookup        = mgp.isSimpleLookup;
<a id="L236" name="L236"></a> 236             <strong class="reserved">this</strong>.gradient              = gradient;
<a id="L237" name="L237"></a> 237             <strong class="reserved">this</strong>.fastGradientArraySize = mgp.fastGradientArraySize;
<a id="L238" name="L238"></a> 238             <strong class="reserved">this</strong>.gradients             = gradients;
<a id="L239" name="L239"></a> 239         <em class="brace">}</em>
<a id="L240" name="L240"></a> 240     <em class="brace">}</em>
<a id="L241" name="L241"></a> 241 
<div class="comment">
      This function is the meat of this class.  It calculates an array of
      gradient colors based on an array of fractions and color values at
      those fractions.</div>
<a id="L247" name="L247"></a> 247     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2113.html#L216" title="Referred from 216 in src/java/awt/MultipleGradientPaintContext.java.">calculateLookupData</a>(<a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>[] colors) <em class="brace">{</em>
<a id="L248" name="L248"></a> 248         <a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>[] normalizedColors;
<a id="L249" name="L249"></a> 249         <strong class="reserved">if</strong> (colorSpace == <a href="../S/2387.html#L69" title="Defined at 69 in src/java/awt/MultipleGradientPaint.java.">ColorSpaceType</a>.LINEAR_RGB) <em class="brace">{</em>
<a id="L250" name="L250"></a> 250             <em class="comment">// create a new colors array</em>
<a id="L251" name="L251"></a> 251             normalizedColors = <strong class="reserved">new</strong> <a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>[colors.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L252" name="L252"></a> 252             <em class="comment">// convert the colors using the lookup table</em>
<a id="L253" name="L253"></a> 253             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; colors.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L254" name="L254"></a> 254                 <strong class="reserved">int</strong> argb = colors[i].<a href="../D/21814.html" title="Multiple defined in 13 places.">getRGB</a>();
<a id="L255" name="L255"></a> 255                 <strong class="reserved">int</strong> <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> = argb &gt;&gt;&gt; 24;
<a id="L256" name="L256"></a> 256                 <strong class="reserved">int</strong> r = SRGBtoLinearRGB[(argb &gt;&gt; 16) &amp; 0xff];
<a id="L257" name="L257"></a> 257                 <strong class="reserved">int</strong> g = SRGBtoLinearRGB[(argb &gt;&gt;  8) &amp; 0xff];
<a id="L258" name="L258"></a> 258                 <strong class="reserved">int</strong> b = SRGBtoLinearRGB[(argb      ) &amp; 0xff];
<a id="L259" name="L259"></a> 259                 normalizedColors[i] = <strong class="reserved">new</strong> <a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>(r, g, b, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>);
<a id="L260" name="L260"></a> 260             <em class="brace">}</em>
<a id="L261" name="L261"></a> 261         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L262" name="L262"></a> 262             <em class="comment">// we can just use this array by reference since we do not</em>
<a id="L263" name="L263"></a> 263             <em class="comment">// modify its values in the case of SRGB</em>
<a id="L264" name="L264"></a> 264             normalizedColors = colors;
<a id="L265" name="L265"></a> 265         <em class="brace">}</em>
<a id="L266" name="L266"></a> 266 
<a id="L267" name="L267"></a> 267         <em class="comment">// this will store the intervals (distances) between gradient stops</em>
<a id="L268" name="L268"></a> 268         normalizedIntervals = <strong class="reserved">new</strong> <strong class="reserved">float</strong>[fractions.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>-1];
<a id="L269" name="L269"></a> 269 
<a id="L270" name="L270"></a> 270         <em class="comment">// convert from fractions into intervals</em>
<a id="L271" name="L271"></a> 271         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; normalizedIntervals.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L272" name="L272"></a> 272             <em class="comment">// interval distance is equal to the difference in positions</em>
<a id="L273" name="L273"></a> 273             normalizedIntervals[i] = <strong class="reserved">this</strong>.fractions[i+1] - <strong class="reserved">this</strong>.fractions[i];
<a id="L274" name="L274"></a> 274         <em class="brace">}</em>
<a id="L275" name="L275"></a> 275 
<a id="L276" name="L276"></a> 276         <em class="comment">// initialize to be fully opaque for ANDing with colors</em>
<a id="L277" name="L277"></a> 277         transparencyTest = 0xff000000;
<a id="L278" name="L278"></a> 278 
<a id="L279" name="L279"></a> 279         <em class="comment">// array of interpolation arrays</em>
<a id="L280" name="L280"></a> 280         gradients = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[normalizedIntervals.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>][];
<a id="L281" name="L281"></a> 281 
<a id="L282" name="L282"></a> 282         <em class="comment">// find smallest interval</em>
<a id="L283" name="L283"></a> 283         <strong class="reserved">float</strong> Imin = 1;
<a id="L284" name="L284"></a> 284         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; normalizedIntervals.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L285" name="L285"></a> 285             Imin = (Imin &gt; normalizedIntervals[i]) ?
<a id="L286" name="L286"></a> 286                 normalizedIntervals[i] : Imin;
<a id="L287" name="L287"></a> 287         <em class="brace">}</em>
<a id="L288" name="L288"></a> 288 
<a id="L289" name="L289"></a> 289         <em class="comment">// Estimate the size of the entire gradients array.</em>
<a id="L290" name="L290"></a> 290         <em class="comment">// This is to prevent a tiny interval from causing the size of array</em>
<a id="L291" name="L291"></a> 291         <em class="comment">// to explode.  If the estimated size is too large, break to using</em>
<a id="L292" name="L292"></a> 292         <em class="comment">// separate arrays for each interval, and using an indexing scheme at</em>
<a id="L293" name="L293"></a> 293         <em class="comment">// look-up time.</em>
<a id="L294" name="L294"></a> 294         <strong class="reserved">int</strong> estimatedSize = 0;
<a id="L295" name="L295"></a> 295         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; normalizedIntervals.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L296" name="L296"></a> 296             estimatedSize += (normalizedIntervals[i]/Imin) * GRADIENT_SIZE;
<a id="L297" name="L297"></a> 297         <em class="brace">}</em>
<a id="L298" name="L298"></a> 298 
<a id="L299" name="L299"></a> 299         <strong class="reserved">if</strong> (estimatedSize &gt; MAX_GRADIENT_ARRAY_SIZE) <em class="brace">{</em>
<a id="L300" name="L300"></a> 300             <em class="comment">// slow method</em>
<a id="L301" name="L301"></a> 301             <a href="../S/2113.html#L408" title="Defined at 408 in src/java/awt/MultipleGradientPaintContext.java.">calculateMultipleArrayGradient</a>(normalizedColors);
<a id="L302" name="L302"></a> 302         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L303" name="L303"></a> 303             <em class="comment">// fast method</em>
<a id="L304" name="L304"></a> 304             <a href="../S/2113.html#L338" title="Defined at 338 in src/java/awt/MultipleGradientPaintContext.java.">calculateSingleArrayGradient</a>(normalizedColors, Imin);
<a id="L305" name="L305"></a> 305         <em class="brace">}</em>
<a id="L306" name="L306"></a> 306 
<a id="L307" name="L307"></a> 307         <em class="comment">// use the most "economical" model</em>
<a id="L308" name="L308"></a> 308         <strong class="reserved">if</strong> ((transparencyTest &gt;&gt;&gt; 24) == 0xff) <em class="brace">{</em>
<a id="L309" name="L309"></a> 309             model = xrgbmodel;
<a id="L310" name="L310"></a> 310         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L311" name="L311"></a> 311             model = <a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a>.<a href="../S/2256.html#L240" title="Defined at 240 in src/java/awt/image/ColorModel.java.">getRGBdefault</a>();
<a id="L312" name="L312"></a> 312         <em class="brace">}</em>
<a id="L313" name="L313"></a> 313     <em class="brace">}</em>
<a id="L314" name="L314"></a> 314 
<div class="comment">
      FAST LOOKUP METHOD
      This method calculates the gradient color values and places them in a
      single int array, gradient[].  It does this by allocating space for
      each interval based on its size relative to the smallest interval in
      the array.  The smallest interval is allocated 255 interpolated values
      (the maximum number of unique in-between colors in a 24 bit color
      system), and all other intervals are allocated
      size = (255 * the ratio of their size to the smallest interval).
      This scheme expedites a speedy retrieval because the colors are
      distributed along the array according to their user-specified
      distribution.  All that is needed is a relative index from 0 to 1.
      The only problem with this method is that the possibility exists for
      the array size to balloon in the case where there is a
      disproportionately small gradient interval.  In this case the other
      intervals will be allocated huge space, but much of that data is
      redundant.  We thus need to use the space conserving scheme below.
      @param Imin the size of the smallest interval</div>
<a id="L338" name="L338"></a> 338     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2113.html#L304" title="Referred from 304 in src/java/awt/MultipleGradientPaintContext.java.">calculateSingleArrayGradient</a>(<a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>[] colors, <strong class="reserved">float</strong> Imin) <em class="brace">{</em>
<a id="L339" name="L339"></a> 339         <em class="comment">// set the flag so we know later it is a simple (fast) lookup</em>
<a id="L340" name="L340"></a> 340         isSimpleLookup = <strong class="reserved">true</strong>;
<a id="L341" name="L341"></a> 341 
<a id="L342" name="L342"></a> 342         <em class="comment">// 2 colors to interpolate</em>
<a id="L343" name="L343"></a> 343         <strong class="reserved">int</strong> rgb1, rgb2;
<a id="L344" name="L344"></a> 344 
<a id="L345" name="L345"></a> 345         <em class="comment">//the eventual size of the single array</em>
<a id="L346" name="L346"></a> 346         <strong class="reserved">int</strong> gradientsTot = 1;
<a id="L347" name="L347"></a> 347 
<a id="L348" name="L348"></a> 348         <em class="comment">// for every interval (transition between 2 colors)</em>
<a id="L349" name="L349"></a> 349         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; gradients.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L350" name="L350"></a> 350             <em class="comment">// create an array whose size is based on the ratio to the</em>
<a id="L351" name="L351"></a> 351             <em class="comment">// smallest interval</em>
<a id="L352" name="L352"></a> 352             <strong class="reserved">int</strong> nGradients = (<strong class="reserved">int</strong>)((normalizedIntervals[i]/Imin)*255f);
<a id="L353" name="L353"></a> 353             gradientsTot += nGradients;
<a id="L354" name="L354"></a> 354             gradients[i] = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[nGradients];
<a id="L355" name="L355"></a> 355 
<a id="L356" name="L356"></a> 356             <em class="comment">// the 2 colors (keyframes) to interpolate between</em>
<a id="L357" name="L357"></a> 357             rgb1 = colors[i].<a href="../D/21814.html" title="Multiple defined in 13 places.">getRGB</a>();
<a id="L358" name="L358"></a> 358             rgb2 = colors[i+1].<a href="../D/21814.html" title="Multiple defined in 13 places.">getRGB</a>();
<a id="L359" name="L359"></a> 359 
<a id="L360" name="L360"></a> 360             <em class="comment">// fill this array with the colors in between rgb1 and rgb2</em>
<a id="L361" name="L361"></a> 361             <a href="../S/2113.html#L454" title="Defined at 454 in src/java/awt/MultipleGradientPaintContext.java.">interpolate</a>(rgb1, rgb2, gradients[i]);
<a id="L362" name="L362"></a> 362 
<a id="L363" name="L363"></a> 363             <em class="comment">// if the colors are opaque, transparency should still</em>
<a id="L364" name="L364"></a> 364             <em class="comment">// be 0xff000000</em>
<a id="L365" name="L365"></a> 365             transparencyTest &amp;= rgb1;
<a id="L366" name="L366"></a> 366             transparencyTest &amp;= rgb2;
<a id="L367" name="L367"></a> 367         <em class="brace">}</em>
<a id="L368" name="L368"></a> 368 
<a id="L369" name="L369"></a> 369         <em class="comment">// put all gradients in a single array</em>
<a id="L370" name="L370"></a> 370         gradient = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[gradientsTot];
<a id="L371" name="L371"></a> 371         <strong class="reserved">int</strong> curOffset = 0;
<a id="L372" name="L372"></a> 372         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; gradients.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)<em class="brace">{</em>
<a id="L373" name="L373"></a> 373             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(gradients[i], 0, gradient,
<a id="L374" name="L374"></a> 374                              curOffset, gradients[i].<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L375" name="L375"></a> 375             curOffset += gradients[i].<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L376" name="L376"></a> 376         <em class="brace">}</em>
<a id="L377" name="L377"></a> 377         gradient[gradient.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>-1] = colors[colors.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>-1].<a href="../D/21814.html" title="Multiple defined in 13 places.">getRGB</a>();
<a id="L378" name="L378"></a> 378 
<a id="L379" name="L379"></a> 379         <em class="comment">// if interpolation occurred in Linear RGB space, convert the</em>
<a id="L380" name="L380"></a> 380         <em class="comment">// gradients back to sRGB using the lookup table</em>
<a id="L381" name="L381"></a> 381         <strong class="reserved">if</strong> (colorSpace == <a href="../S/2387.html#L69" title="Defined at 69 in src/java/awt/MultipleGradientPaint.java.">ColorSpaceType</a>.LINEAR_RGB) <em class="brace">{</em>
<a id="L382" name="L382"></a> 382             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; gradient.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L383" name="L383"></a> 383                 gradient[i] = <a href="../S/2113.html#L490" title="Defined at 490 in src/java/awt/MultipleGradientPaintContext.java.">convertEntireColorLinearRGBtoSRGB</a>(gradient[i]);
<a id="L384" name="L384"></a> 384             <em class="brace">}</em>
<a id="L385" name="L385"></a> 385         <em class="brace">}</em>
<a id="L386" name="L386"></a> 386 
<a id="L387" name="L387"></a> 387         fastGradientArraySize = gradient.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1;
<a id="L388" name="L388"></a> 388     <em class="brace">}</em>
<a id="L389" name="L389"></a> 389 
<div class="comment">
      SLOW LOOKUP METHOD
      This method calculates the gradient color values for each interval and
      places each into its own 255 size array.  The arrays are stored in
      gradients[][].  (255 is used because this is the maximum number of
      unique colors between 2 arbitrary colors in a 24 bit color system.)
      This method uses the minimum amount of space (only 255 * number of
      intervals), but it aggravates the lookup procedure, because now we
      have to find out which interval to select, then calculate the index
      within that interval.  This causes a significant performance hit,
      because it requires this calculation be done for every point in
      the rendering loop.
      For those of you who are interested, this is a classic example of the
      time-space tradeoff.</div>
<a id="L408" name="L408"></a> 408     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/2113.html#L301" title="Referred from 301 in src/java/awt/MultipleGradientPaintContext.java.">calculateMultipleArrayGradient</a>(<a href="../S/2447.html#L60" title="Defined at 60 in src/java/awt/Color.java.">Color</a>[] colors) <em class="brace">{</em>
<a id="L409" name="L409"></a> 409         <em class="comment">// set the flag so we know later it is a non-simple lookup</em>
<a id="L410" name="L410"></a> 410         isSimpleLookup = <strong class="reserved">false</strong>;
<a id="L411" name="L411"></a> 411 
<a id="L412" name="L412"></a> 412         <em class="comment">// 2 colors to interpolate</em>
<a id="L413" name="L413"></a> 413         <strong class="reserved">int</strong> rgb1, rgb2;
<a id="L414" name="L414"></a> 414 
<a id="L415" name="L415"></a> 415         <em class="comment">// for every interval (transition between 2 colors)</em>
<a id="L416" name="L416"></a> 416         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; gradients.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)<em class="brace">{</em>
<a id="L417" name="L417"></a> 417             <em class="comment">// create an array of the maximum theoretical size for</em>
<a id="L418" name="L418"></a> 418             <em class="comment">// each interval</em>
<a id="L419" name="L419"></a> 419             gradients[i] = <strong class="reserved">new</strong> <strong class="reserved">int</strong>[GRADIENT_SIZE];
<a id="L420" name="L420"></a> 420 
<a id="L421" name="L421"></a> 421             <em class="comment">// get the the 2 colors</em>
<a id="L422" name="L422"></a> 422             rgb1 = colors[i].<a href="../D/21814.html" title="Multiple defined in 13 places.">getRGB</a>();
<a id="L423" name="L423"></a> 423             rgb2 = colors[i+1].<a href="../D/21814.html" title="Multiple defined in 13 places.">getRGB</a>();
<a id="L424" name="L424"></a> 424 
<a id="L425" name="L425"></a> 425             <em class="comment">// fill this array with the colors in between rgb1 and rgb2</em>
<a id="L426" name="L426"></a> 426             <a href="../S/2113.html#L454" title="Defined at 454 in src/java/awt/MultipleGradientPaintContext.java.">interpolate</a>(rgb1, rgb2, gradients[i]);
<a id="L427" name="L427"></a> 427 
<a id="L428" name="L428"></a> 428             <em class="comment">// if the colors are opaque, transparency should still</em>
<a id="L429" name="L429"></a> 429             <em class="comment">// be 0xff000000</em>
<a id="L430" name="L430"></a> 430             transparencyTest &amp;= rgb1;
<a id="L431" name="L431"></a> 431             transparencyTest &amp;= rgb2;
<a id="L432" name="L432"></a> 432         <em class="brace">}</em>
<a id="L433" name="L433"></a> 433 
<a id="L434" name="L434"></a> 434         <em class="comment">// if interpolation occurred in Linear RGB space, convert the</em>
<a id="L435" name="L435"></a> 435         <em class="comment">// gradients back to SRGB using the lookup table</em>
<a id="L436" name="L436"></a> 436         <strong class="reserved">if</strong> (colorSpace == <a href="../S/2387.html#L69" title="Defined at 69 in src/java/awt/MultipleGradientPaint.java.">ColorSpaceType</a>.LINEAR_RGB) <em class="brace">{</em>
<a id="L437" name="L437"></a> 437             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; gradients.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; j++) <em class="brace">{</em>
<a id="L438" name="L438"></a> 438                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; gradients[j].<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L439" name="L439"></a> 439                     gradients[j][i] =
<a id="L440" name="L440"></a> 440                         <a href="../S/2113.html#L490" title="Defined at 490 in src/java/awt/MultipleGradientPaintContext.java.">convertEntireColorLinearRGBtoSRGB</a>(gradients[j][i]);
<a id="L441" name="L441"></a> 441                 <em class="brace">}</em>
<a id="L442" name="L442"></a> 442             <em class="brace">}</em>
<a id="L443" name="L443"></a> 443         <em class="brace">}</em>
<a id="L444" name="L444"></a> 444     <em class="brace">}</em>
<a id="L445" name="L445"></a> 445 
<div class="comment">
      Yet another helper function.  This one linearly interpolates between
      2 colors, filling up the output array.
      @param rgb1 the start color
      @param rgb2 the end color
      @param output the output array of colors; must not be null</div>
<a id="L454" name="L454"></a> 454     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/20971.html" title="Multiple referred from 2 places.">interpolate</a>(<strong class="reserved">int</strong> rgb1, <strong class="reserved">int</strong> rgb2, <strong class="reserved">int</strong>[] <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a>) <em class="brace">{</em>
<a id="L455" name="L455"></a> 455         <em class="comment">// color components</em>
<a id="L456" name="L456"></a> 456         <strong class="reserved">int</strong> a1, r1, g1, b1, da, dr, dg, db;
<a id="L457" name="L457"></a> 457 
<a id="L458" name="L458"></a> 458         <em class="comment">// step between interpolated values</em>
<a id="L459" name="L459"></a> 459         <strong class="reserved">float</strong> stepSize = 1.0f / <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L460" name="L460"></a> 460 
<a id="L461" name="L461"></a> 461         <em class="comment">// extract color components from packed integer</em>
<a id="L462" name="L462"></a> 462         a1 = (rgb1 &gt;&gt; 24) &amp; 0xff;
<a id="L463" name="L463"></a> 463         r1 = (rgb1 &gt;&gt; 16) &amp; 0xff;
<a id="L464" name="L464"></a> 464         g1 = (rgb1 &gt;&gt;  8) &amp; 0xff;
<a id="L465" name="L465"></a> 465         b1 = (rgb1      ) &amp; 0xff;
<a id="L466" name="L466"></a> 466 
<a id="L467" name="L467"></a> 467         <em class="comment">// calculate the total change in alpha, red, green, blue</em>
<a id="L468" name="L468"></a> 468         da = ((rgb2 &gt;&gt; 24) &amp; 0xff) - a1;
<a id="L469" name="L469"></a> 469         dr = ((rgb2 &gt;&gt; 16) &amp; 0xff) - r1;
<a id="L470" name="L470"></a> 470         dg = ((rgb2 &gt;&gt;  8) &amp; 0xff) - g1;
<a id="L471" name="L471"></a> 471         db = ((rgb2      ) &amp; 0xff) - b1;
<a id="L472" name="L472"></a> 472 
<a id="L473" name="L473"></a> 473         <em class="comment">// for each step in the interval calculate the in-between color by</em>
<a id="L474" name="L474"></a> 474         <em class="comment">// multiplying the normalized current position by the total color</em>
<a id="L475" name="L475"></a> 475         <em class="comment">// change (0.5 is added to prevent truncation round-off error)</em>
<a id="L476" name="L476"></a> 476         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L477" name="L477"></a> 477             <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a>[i] =
<a id="L478" name="L478"></a> 478                 (((<strong class="reserved">int</strong>) ((a1 + i * da * stepSize) + 0.5) &lt;&lt; 24)) |
<a id="L479" name="L479"></a> 479                 (((<strong class="reserved">int</strong>) ((r1 + i * dr * stepSize) + 0.5) &lt;&lt; 16)) |
<a id="L480" name="L480"></a> 480                 (((<strong class="reserved">int</strong>) ((g1 + i * dg * stepSize) + 0.5) &lt;&lt;  8)) |
<a id="L481" name="L481"></a> 481                 (((<strong class="reserved">int</strong>) ((b1 + i * db * stepSize) + 0.5)      ));
<a id="L482" name="L482"></a> 482         <em class="brace">}</em>
<a id="L483" name="L483"></a> 483     <em class="brace">}</em>
<a id="L484" name="L484"></a> 484 
<div class="comment">
      Yet another helper function.  This one extracts the color components
      of an integer RGB triple, converts them from LinearRGB to SRGB, then
      recompacts them into an int.</div>
<a id="L490" name="L490"></a> 490     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/12013.html" title="Multiple referred from 2 places.">convertEntireColorLinearRGBtoSRGB</a>(<strong class="reserved">int</strong> rgb) <em class="brace">{</em>
<a id="L491" name="L491"></a> 491         <em class="comment">// color components</em>
<a id="L492" name="L492"></a> 492         <strong class="reserved">int</strong> a1, r1, g1, b1;
<a id="L493" name="L493"></a> 493 
<a id="L494" name="L494"></a> 494         <em class="comment">// extract red, green, blue components</em>
<a id="L495" name="L495"></a> 495         a1 = (rgb &gt;&gt; 24) &amp; 0xff;
<a id="L496" name="L496"></a> 496         r1 = (rgb &gt;&gt; 16) &amp; 0xff;
<a id="L497" name="L497"></a> 497         g1 = (rgb &gt;&gt;  8) &amp; 0xff;
<a id="L498" name="L498"></a> 498         b1 = (rgb      ) &amp; 0xff;
<a id="L499" name="L499"></a> 499 
<a id="L500" name="L500"></a> 500         <em class="comment">// use the lookup table</em>
<a id="L501" name="L501"></a> 501         r1 = LinearRGBtoSRGB[r1];
<a id="L502" name="L502"></a> 502         g1 = LinearRGBtoSRGB[g1];
<a id="L503" name="L503"></a> 503         b1 = LinearRGBtoSRGB[b1];
<a id="L504" name="L504"></a> 504 
<a id="L505" name="L505"></a> 505         <em class="comment">// re-compact the components</em>
<a id="L506" name="L506"></a> 506         <strong class="reserved">return</strong> ((a1 &lt;&lt; 24) |
<a id="L507" name="L507"></a> 507                 (r1 &lt;&lt; 16) |
<a id="L508" name="L508"></a> 508                 (g1 &lt;&lt;  8) |
<a id="L509" name="L509"></a> 509                 (b1      ));
<a id="L510" name="L510"></a> 510     <em class="brace">}</em>
<a id="L511" name="L511"></a> 511 
<div class="comment">
      Helper function to index into the gradients array.  This is necessary
      because each interval has an array of colors with uniform size 255.
      However, the color intervals are not necessarily of uniform length, so
      a conversion is required.
      @param position the unmanipulated position, which will be mapped
                      into the range 0 to 1
      @returns integer color to display</div>
<a id="L522" name="L522"></a> 522     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/20509.html" title="Multiple referred from 2 places.">indexIntoGradientsArrays</a>(<strong class="reserved">float</strong> <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a>) <em class="brace">{</em>
<a id="L523" name="L523"></a> 523         <em class="comment">// first, manipulate position value depending on the cycle method</em>
<a id="L524" name="L524"></a> 524         <strong class="reserved">if</strong> (cycleMethod == <a href="../S/2387.html#L47" title="Defined at 47 in src/java/awt/MultipleGradientPaint.java.">CycleMethod</a>.NO_CYCLE) <em class="brace">{</em>
<a id="L525" name="L525"></a> 525             <strong class="reserved">if</strong> (<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> &gt; 1) <em class="brace">{</em>
<a id="L526" name="L526"></a> 526                 <em class="comment">// upper bound is 1</em>
<a id="L527" name="L527"></a> 527                 <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = 1;
<a id="L528" name="L528"></a> 528             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> &lt; 0) <em class="brace">{</em>
<a id="L529" name="L529"></a> 529                 <em class="comment">// lower bound is 0</em>
<a id="L530" name="L530"></a> 530                 <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = 0;
<a id="L531" name="L531"></a> 531             <em class="brace">}</em>
<a id="L532" name="L532"></a> 532         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (cycleMethod == <a href="../S/2387.html#L47" title="Defined at 47 in src/java/awt/MultipleGradientPaint.java.">CycleMethod</a>.REPEAT) <em class="brace">{</em>
<a id="L533" name="L533"></a> 533             <em class="comment">// get the fractional part</em>
<a id="L534" name="L534"></a> 534             <em class="comment">// (modulo behavior discards integer component)</em>
<a id="L535" name="L535"></a> 535             <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> - (<strong class="reserved">int</strong>)<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a>;
<a id="L536" name="L536"></a> 536 
<a id="L537" name="L537"></a> 537             <em class="comment">//position should now be between -1 and 1</em>
<a id="L538" name="L538"></a> 538             <strong class="reserved">if</strong> (<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> &lt; 0) <em class="brace">{</em>
<a id="L539" name="L539"></a> 539                 <em class="comment">// force it to be in the range 0-1</em>
<a id="L540" name="L540"></a> 540                 <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> + 1;
<a id="L541" name="L541"></a> 541             <em class="brace">}</em>
<a id="L542" name="L542"></a> 542         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em> <em class="comment">// cycleMethod == CycleMethod.REFLECT</em>
<a id="L543" name="L543"></a> 543             <strong class="reserved">if</strong> (<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> &lt; 0) <em class="brace">{</em>
<a id="L544" name="L544"></a> 544                 <em class="comment">// take absolute value</em>
<a id="L545" name="L545"></a> 545                 <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = -<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a>;
<a id="L546" name="L546"></a> 546             <em class="brace">}</em>
<a id="L547" name="L547"></a> 547 
<a id="L548" name="L548"></a> 548             <em class="comment">// get the integer part</em>
<a id="L549" name="L549"></a> 549             <strong class="reserved">int</strong> part = (<strong class="reserved">int</strong>)<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a>;
<a id="L550" name="L550"></a> 550 
<a id="L551" name="L551"></a> 551             <em class="comment">// get the fractional part</em>
<a id="L552" name="L552"></a> 552             <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> - part;
<a id="L553" name="L553"></a> 553 
<a id="L554" name="L554"></a> 554             <strong class="reserved">if</strong> ((part &amp; 1) == 1) <em class="brace">{</em>
<a id="L555" name="L555"></a> 555                 <em class="comment">// integer part is odd, get reflected color instead</em>
<a id="L556" name="L556"></a> 556                 <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> = 1 - <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a>;
<a id="L557" name="L557"></a> 557             <em class="brace">}</em>
<a id="L558" name="L558"></a> 558         <em class="brace">}</em>
<a id="L559" name="L559"></a> 559 
<a id="L560" name="L560"></a> 560         <em class="comment">// now, get the color based on this 0-1 position...</em>
<a id="L561" name="L561"></a> 561 
<a id="L562" name="L562"></a> 562         <strong class="reserved">if</strong> (isSimpleLookup) <em class="brace">{</em>
<a id="L563" name="L563"></a> 563             <em class="comment">// easy to compute: just scale index by array size</em>
<a id="L564" name="L564"></a> 564             <strong class="reserved">return</strong> gradient[(<strong class="reserved">int</strong>)(<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> * fastGradientArraySize)];
<a id="L565" name="L565"></a> 565         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L566" name="L566"></a> 566             <em class="comment">// more complicated computation, to save space</em>
<a id="L567" name="L567"></a> 567 
<a id="L568" name="L568"></a> 568             <em class="comment">// for all the gradient interval arrays</em>
<a id="L569" name="L569"></a> 569             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; gradients.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L570" name="L570"></a> 570                 <strong class="reserved">if</strong> (<a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> &lt; fractions[i+1]) <em class="brace">{</em>
<a id="L571" name="L571"></a> 571                     <em class="comment">// this is the array we want</em>
<a id="L572" name="L572"></a> 572                     <strong class="reserved">float</strong> delta = <a href="../D/29463.html" title="Multiple defined in 19 places.">position</a> - fractions[i];
<a id="L573" name="L573"></a> 573 
<a id="L574" name="L574"></a> 574                     <em class="comment">// this is the interval we want</em>
<a id="L575" name="L575"></a> 575                     <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = (<strong class="reserved">int</strong>)((delta / normalizedIntervals[i])
<a id="L576" name="L576"></a> 576                                       * (GRADIENT_SIZE_INDEX));
<a id="L577" name="L577"></a> 577 
<a id="L578" name="L578"></a> 578                     <strong class="reserved">return</strong> gradients[i][<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>];
<a id="L579" name="L579"></a> 579                 <em class="brace">}</em>
<a id="L580" name="L580"></a> 580             <em class="brace">}</em>
<a id="L581" name="L581"></a> 581         <em class="brace">}</em>
<a id="L582" name="L582"></a> 582 
<a id="L583" name="L583"></a> 583         <strong class="reserved">return</strong> gradients[gradients.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1][GRADIENT_SIZE_INDEX];
<a id="L584" name="L584"></a> 584     <em class="brace">}</em>
<a id="L585" name="L585"></a> 585 
<div class="comment">
      Helper function to convert a color component in sRGB space to linear
      RGB space.  Used to build a static lookup table.</div>
<a id="L590" name="L590"></a> 590     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../S/2113.html#L127" title="Referred from 127 in src/java/awt/MultipleGradientPaintContext.java.">convertSRGBtoLinearRGB</a>(<strong class="reserved">int</strong> color) <em class="brace">{</em>
<a id="L591" name="L591"></a> 591         <strong class="reserved">float</strong> <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a>, <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a>;
<a id="L592" name="L592"></a> 592 
<a id="L593" name="L593"></a> 593         <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> = color / 255.0f;
<a id="L594" name="L594"></a> 594         <strong class="reserved">if</strong> (<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> &lt;= 0.04045f) <em class="brace">{</em>
<a id="L595" name="L595"></a> 595             <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a> = <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> / 12.92f;
<a id="L596" name="L596"></a> 596         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L597" name="L597"></a> 597             <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a> = (<strong class="reserved">float</strong>)<a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/29502.html" title="Multiple defined in 5 places.">pow</a>((<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> + 0.055) / 1.055, 2.4);
<a id="L598" name="L598"></a> 598         <em class="brace">}</em>
<a id="L599" name="L599"></a> 599 
<a id="L600" name="L600"></a> 600         <strong class="reserved">return</strong> <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/31457.html" title="Multiple defined in 6 places.">round</a>(<a href="../D/28597.html" title="Multiple defined in 4 places.">output</a> * 255.0f);
<a id="L601" name="L601"></a> 601     <em class="brace">}</em>
<a id="L602" name="L602"></a> 602 
<div class="comment">
      Helper function to convert a color component in linear RGB space to
      SRGB space.  Used to build a static lookup table.</div>
<a id="L607" name="L607"></a> 607     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../S/2113.html#L128" title="Referred from 128 in src/java/awt/MultipleGradientPaintContext.java.">convertLinearRGBtoSRGB</a>(<strong class="reserved">int</strong> color) <em class="brace">{</em>
<a id="L608" name="L608"></a> 608         <strong class="reserved">float</strong> <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a>, <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a>;
<a id="L609" name="L609"></a> 609 
<a id="L610" name="L610"></a> 610         <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> = color/255.0f;
<a id="L611" name="L611"></a> 611         <strong class="reserved">if</strong> (<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> &lt;= 0.0031308) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612             <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a> = <a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a> * 12.92f;
<a id="L613" name="L613"></a> 613         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L614" name="L614"></a> 614             <a href="../D/28597.html" title="Multiple defined in 4 places.">output</a> = (1.055f *
<a id="L615" name="L615"></a> 615                 ((<strong class="reserved">float</strong>) <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/29502.html" title="Multiple defined in 5 places.">pow</a>(<a href="../S/4116.html#L132" title="Defined at 132 in src/javax/xml/ws/Action.java.">input</a>, (1.0 / 2.4)))) - 0.055f;
<a id="L616" name="L616"></a> 616         <em class="brace">}</em>
<a id="L617" name="L617"></a> 617 
<a id="L618" name="L618"></a> 618         <strong class="reserved">return</strong> <a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/31457.html" title="Multiple defined in 6 places.">round</a>(<a href="../D/28597.html" title="Multiple defined in 4 places.">output</a> * 255.0f);
<a id="L619" name="L619"></a> 619     <em class="brace">}</em>
<a id="L620" name="L620"></a> 620 
<div class="comment">
      {@inheritDoc}</div>
<a id="L624" name="L624"></a> 624     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> <a href="../R/18595.html" title="Multiple referred from 41 places.">getRaster</a>(<strong class="reserved">int</strong> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>, <strong class="reserved">int</strong> y, <strong class="reserved">int</strong> w, <strong class="reserved">int</strong> h) <em class="brace">{</em>
<a id="L625" name="L625"></a> 625         <em class="comment">// If working raster is big enough, reuse it. Otherwise,</em>
<a id="L626" name="L626"></a> 626         <em class="comment">// build a large enough new one.</em>
<a id="L627" name="L627"></a> 627         <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> raster = saved;
<a id="L628" name="L628"></a> 628         <strong class="reserved">if</strong> (raster == <strong class="reserved">null</strong> ||
<a id="L629" name="L629"></a> 629             raster.<a href="../D/23687.html" title="Multiple defined in 56 places.">getWidth</a>() &lt; w || raster.<a href="../D/19442.html" title="Multiple defined in 56 places.">getHeight</a>() &lt; h)
<a id="L630" name="L630"></a> 630         <em class="brace">{</em>
<a id="L631" name="L631"></a> 631             raster = <a href="../D/17453.html" title="Multiple defined in 2 places.">getCachedRaster</a>(model, w, h);
<a id="L632" name="L632"></a> 632             saved = raster;
<a id="L633" name="L633"></a> 633         <em class="brace">}</em>
<a id="L634" name="L634"></a> 634 
<a id="L635" name="L635"></a> 635         <em class="comment">// Access raster internal int array. Because we use a DirectColorModel,</em>
<a id="L636" name="L636"></a> 636         <em class="comment">// we know the DataBuffer is of type DataBufferInt and the SampleModel</em>
<a id="L637" name="L637"></a> 637         <em class="comment">// is SinglePixelPackedSampleModel.</em>
<a id="L638" name="L638"></a> 638         <em class="comment">// Adjust for initial offset in DataBuffer and also for the scanline</em>
<a id="L639" name="L639"></a> 639         <em class="comment">// stride.</em>
<a id="L640" name="L640"></a> 640         <em class="comment">// These calls make the DataBuffer non-acceleratable, but the</em>
<a id="L641" name="L641"></a> 641         <em class="comment">// Raster is never Stable long enough to accelerate anyway...</em>
<a id="L642" name="L642"></a> 642         <a href="../S/2243.html#L59" title="Defined at 59 in src/java/awt/image/DataBufferInt.java.">DataBufferInt</a> rasterDB = (<a href="../S/2243.html#L59" title="Defined at 59 in src/java/awt/image/DataBufferInt.java.">DataBufferInt</a>)raster.<a href="../S/2238.html#L1429" title="Defined at 1429 in src/java/awt/image/Raster.java.">getDataBuffer</a>();
<a id="L643" name="L643"></a> 643         <strong class="reserved">int</strong>[] pixels = rasterDB.<a href="../D/18190.html" title="Multiple defined in 47 places.">getData</a>(0);
<a id="L644" name="L644"></a> 644         <strong class="reserved">int</strong> off = rasterDB.<a href="../D/21176.html" title="Multiple defined in 43 places.">getOffset</a>();
<a id="L645" name="L645"></a> 645         <strong class="reserved">int</strong> scanlineStride = ((<a href="../S/2273.html#L66" title="Defined at 66 in src/java/awt/image/SinglePixelPackedSampleModel.java.">SinglePixelPackedSampleModel</a>)
<a id="L646" name="L646"></a> 646                               raster.<a href="../D/22223.html" title="Multiple defined in 5 places.">getSampleModel</a>()).<a href="../D/22246.html" title="Multiple defined in 3 places.">getScanlineStride</a>();
<a id="L647" name="L647"></a> 647         <strong class="reserved">int</strong> <a href="../D/11206.html" title="Multiple defined in 2 places.">adjust</a> = scanlineStride - w;
<a id="L648" name="L648"></a> 648 
<a id="L649" name="L649"></a> 649         <a href="../D/16052.html" title="Multiple defined in 3 places.">fillRaster</a>(pixels, off, <a href="../D/11206.html" title="Multiple defined in 2 places.">adjust</a>, <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>, y, w, h); <em class="comment">// delegate to subclass</em>
<a id="L650" name="L650"></a> 650 
<a id="L651" name="L651"></a> 651         <strong class="reserved">return</strong> raster;
<a id="L652" name="L652"></a> 652     <em class="brace">}</em>
<a id="L653" name="L653"></a> 653 
<a id="L654" name="L654"></a> 654     <strong class="reserved">protected</strong> <strong class="reserved">abstract</strong> <strong class="reserved">void</strong> <a href="../S/2113.html#L649" title="Referred from 649 in src/java/awt/MultipleGradientPaintContext.java.">fillRaster</a>(<strong class="reserved">int</strong> pixels[], <strong class="reserved">int</strong> off, <strong class="reserved">int</strong> <a href="../D/11206.html" title="Multiple defined in 2 places.">adjust</a>,
<a id="L655" name="L655"></a> 655                                        <strong class="reserved">int</strong> <a href="../D/37285.html" title="Multiple defined in 2 places.">x</a>, <strong class="reserved">int</strong> y, <strong class="reserved">int</strong> w, <strong class="reserved">int</strong> h);
<a id="L656" name="L656"></a> 656 
<a id="L657" name="L657"></a> 657 
<div class="comment">
      Took this cacheRaster code from GradientPaint. It appears to recycle
      rasters for use by any other instance, as long as they are sufficiently
      large.</div>
<a id="L663" name="L663"></a> 663     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">synchronized</strong> <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> <a href="../R/15417.html" title="Multiple referred from 2 places.">getCachedRaster</a>(<a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> cm,
<a id="L664" name="L664"></a> 664                                                        <strong class="reserved">int</strong> w, <strong class="reserved">int</strong> h)
<a id="L665" name="L665"></a> 665     <em class="brace">{</em>
<a id="L666" name="L666"></a> 666         <strong class="reserved">if</strong> (cm == cachedModel) <em class="brace">{</em>
<a id="L667" name="L667"></a> 667             <strong class="reserved">if</strong> (cached != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L668" name="L668"></a> 668                 <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> ras = (<a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a>) cached.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L669" name="L669"></a> 669                 <strong class="reserved">if</strong> (ras != <strong class="reserved">null</strong> &amp;&amp;
<a id="L670" name="L670"></a> 670                     ras.<a href="../D/23687.html" title="Multiple defined in 56 places.">getWidth</a>() &gt;= w &amp;&amp;
<a id="L671" name="L671"></a> 671                     ras.<a href="../D/19442.html" title="Multiple defined in 56 places.">getHeight</a>() &gt;= h)
<a id="L672" name="L672"></a> 672                 <em class="brace">{</em>
<a id="L673" name="L673"></a> 673                     cached = <strong class="reserved">null</strong>;
<a id="L674" name="L674"></a> 674                     <strong class="reserved">return</strong> ras;
<a id="L675" name="L675"></a> 675                 <em class="brace">}</em>
<a id="L676" name="L676"></a> 676             <em class="brace">}</em>
<a id="L677" name="L677"></a> 677         <em class="brace">}</em>
<a id="L678" name="L678"></a> 678         <strong class="reserved">return</strong> cm.<a href="../D/13710.html" title="Multiple defined in 8 places.">createCompatibleWritableRaster</a>(w, h);
<a id="L679" name="L679"></a> 679     <em class="brace">}</em>
<a id="L680" name="L680"></a> 680 
<div class="comment">
      Took this cacheRaster code from GradientPaint. It appears to recycle
      rasters for use by any other instance, as long as they are sufficiently
      large.</div>
<a id="L686" name="L686"></a> 686     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">synchronized</strong> <strong class="reserved">void</strong> <a href="../R/25291.html" title="Multiple referred from 2 places.">putCachedRaster</a>(<a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> cm,
<a id="L687" name="L687"></a> 687                                                      <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> ras)
<a id="L688" name="L688"></a> 688     <em class="brace">{</em>
<a id="L689" name="L689"></a> 689         <strong class="reserved">if</strong> (cached != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L690" name="L690"></a> 690             <a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a> cras = (<a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a>) cached.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L691" name="L691"></a> 691             <strong class="reserved">if</strong> (cras != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L692" name="L692"></a> 692                 <strong class="reserved">int</strong> cw = cras.<a href="../D/23687.html" title="Multiple defined in 56 places.">getWidth</a>();
<a id="L693" name="L693"></a> 693                 <strong class="reserved">int</strong> ch = cras.<a href="../D/19442.html" title="Multiple defined in 56 places.">getHeight</a>();
<a id="L694" name="L694"></a> 694                 <strong class="reserved">int</strong> iw = ras.<a href="../D/23687.html" title="Multiple defined in 56 places.">getWidth</a>();
<a id="L695" name="L695"></a> 695                 <strong class="reserved">int</strong> ih = ras.<a href="../D/19442.html" title="Multiple defined in 56 places.">getHeight</a>();
<a id="L696" name="L696"></a> 696                 <strong class="reserved">if</strong> (cw &gt;= iw &amp;&amp; ch &gt;= ih) <em class="brace">{</em>
<a id="L697" name="L697"></a> 697                     <strong class="reserved">return</strong>;
<a id="L698" name="L698"></a> 698                 <em class="brace">}</em>
<a id="L699" name="L699"></a> 699                 <strong class="reserved">if</strong> (cw * ch &gt;= iw * ih) <em class="brace">{</em>
<a id="L700" name="L700"></a> 700                     <strong class="reserved">return</strong>;
<a id="L701" name="L701"></a> 701                 <em class="brace">}</em>
<a id="L702" name="L702"></a> 702             <em class="brace">}</em>
<a id="L703" name="L703"></a> 703         <em class="brace">}</em>
<a id="L704" name="L704"></a> 704         cachedModel = cm;
<a id="L705" name="L705"></a> 705         cached = <strong class="reserved">new</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/2238.html#L126" title="Defined at 126 in src/java/awt/image/Raster.java.">Raster</a>&gt;(ras);
<a id="L706" name="L706"></a> 706     <em class="brace">}</em>
<a id="L707" name="L707"></a> 707 
<div class="comment">
      {@inheritDoc}</div>
<a id="L711" name="L711"></a> 711     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/13337.html" title="Multiple referred from 363 places.">dispose</a>() <em class="brace">{</em>
<a id="L712" name="L712"></a> 712         <strong class="reserved">if</strong> (saved != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L713" name="L713"></a> 713             <a href="../D/29978.html" title="Multiple defined in 2 places.">putCachedRaster</a>(model, saved);
<a id="L714" name="L714"></a> 714             saved = <strong class="reserved">null</strong>;
<a id="L715" name="L715"></a> 715         <em class="brace">}</em>
<a id="L716" name="L716"></a> 716     <em class="brace">}</em>
<a id="L717" name="L717"></a> 717 
<div class="comment">
      {@inheritDoc}</div>
<a id="L721" name="L721"></a> 721     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../D/1637.html" title="Multiple defined in 2 places.">ColorModel</a> <a href="../R/15661.html" title="Multiple referred from 76 places.">getColorModel</a>() <em class="brace">{</em>
<a id="L722" name="L722"></a> 722         <strong class="reserved">return</strong> model;
<a id="L723" name="L723"></a> 723     <em class="brace">}</em>
<a id="L724" name="L724"></a> 724 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L247">[^]</a><a href="#L721">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>