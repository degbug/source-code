<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/stream/AbstractPipeline.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L81">[^]</a><a href="#L702">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L81" title="Defined at 81.">SuppressWarnings</a></li>
<li><a href="#L87" title="Defined at 87.">SuppressWarnings</a></li>
<li><a href="#L100" title="Defined at 100.">SuppressWarnings</a></li>
<li><a href="#L226" title="Defined at 226.">evaluate</a></li>
<li><a href="#L243" title="Defined at 243.">SuppressWarnings</a></li>
<li><a href="#L244" title="Defined at 244.">evaluateToArrayNode</a></li>
<li><a href="#L273" title="Defined at 273.">SuppressWarnings</a></li>
<li><a href="#L274" title="Defined at 274.">sourceStageSpliterator</a></li>
<li><a href="#L302" title="Defined at 302.">SuppressWarnings</a></li>
<li><a href="#L303" title="Defined at 303.">sequential</a></li>
<li><a href="#L309" title="Defined at 309.">SuppressWarnings</a></li>
<li><a href="#L310" title="Defined at 310.">parallel</a></li>
<li><a href="#L316" title="Defined at 316.">close</a></li>
<li><a href="#L328" title="Defined at 328.">SuppressWarnings</a></li>
<li><a href="#L329" title="Defined at 329.">onClose</a></li>
<li><a href="#L340" title="Defined at 340.">SuppressWarnings</a></li>
<li><a href="#L341" title="Defined at 341.">spliterator</a></li>
<li><a href="#L369" title="Defined at 369.">isParallel</a></li>
<li><a href="#L382" title="Defined at 382.">getStreamFlags</a></li>
<li><a href="#L393" title="Defined at 393.">SuppressWarnings</a></li>
<li><a href="#L394" title="Defined at 394.">sourceSpliterator</a></li>
<li><a href="#L455" title="Defined at 455.">getSourceShape</a></li>
<li><a href="#L465" title="Defined at 465.">exactOutputSizeIfKnown</a></li>
<li><a href="#L470" title="Defined at 470.">wrapAndCopyInto</a></li>
<li><a href="#L476" title="Defined at 476.">copyInto</a></li>
<li><a href="#L490" title="Defined at 490.">SuppressWarnings</a></li>
<li><a href="#L491" title="Defined at 491.">copyIntoWithCancel</a></li>
<li><a href="#L503" title="Defined at 503.">getStreamAndOpFlags</a></li>
<li><a href="#L507" title="Defined at 507.">isOrdered</a></li>
<li><a href="#L512" title="Defined at 512.">SuppressWarnings</a></li>
<li><a href="#L513" title="Defined at 513.">wrapSink</a></li>
<li><a href="#L523" title="Defined at 523.">SuppressWarnings</a></li>
<li><a href="#L524" title="Defined at 524.">wrapSpliterator</a></li>
<li><a href="#L534" title="Defined at 534.">SuppressWarnings</a></li>
<li><a href="#L535" title="Defined at 535.">evaluate</a></li>
<li><a href="#L560" title="Defined at 560.">getOutputShape</a></li>
<li><a href="#L572" title="Defined at 572.">evaluateToNode</a></li>
<li><a href="#L586" title="Defined at 586.">wrap</a></li>
<li><a href="#L595" title="Defined at 595.">lazySpliterator</a></li>
<li><a href="#L605" title="Defined at 605.">forEachWithCancel</a></li>
<li><a href="#L623" title="Defined at 623.">makeNodeBuilder</a></li>
<li><a href="#L637" title="Defined at 637.">opIsStateful</a></li>
<li><a href="#L658" title="Defined at 658.">opWrapSink</a></li>
<li><a href="#L675" title="Defined at 675.">opEvaluateParallel</a></li>
<li><a href="#L701" title="Defined at 701.">SuppressWarnings</a></li>
<li><a href="#L702" title="Defined at 702.">opEvaluateParallelLazy</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2012, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.<a href="../D/34926.html" title="Multiple defined in 21 places.">stream</a>;
<a id="L26" name="L26"></a>  26 
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.util.Objects;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.Spliterator;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.util.function.IntFunction;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.util.function.Supplier;
<a id="L31" name="L31"></a>  31 
<div class="comment">
  Abstract base class for "pipeline" classes, which are the core
  implementations of the Stream interface and its primitive specializations.
  Manages construction and evaluation of stream pipelines.
  <p>An <code>AbstractPipeline</code> represents an initial portion of a stream
  pipeline, encapsulating a stream source and zero or more intermediate
  operations.  The individual <code>AbstractPipeline</code> objects are often
  referred to as <em>stages</em>, where each stage describes either the stream
  source or an intermediate operation.
  </p><p>A concrete intermediate stage is generally built from an
  <code>AbstractPipeline</code>, a shape-specific pipeline class which extends it
  (e.g., <code>IntPipeline</code>) which is also abstract, and an operation-specific
  concrete class which extends that.  <code>AbstractPipeline</code> contains most of
  the mechanics of evaluating the pipeline, and implements methods that will be
  used by the operation; the shape-specific classes add helper methods for
  dealing with collection of results into the appropriate shape-specific
  containers.
  </p><p>After chaining a new intermediate operation, or executing a terminal
  operation, the stream is considered to be consumed, and no more intermediate
  or terminal operations are permitted on this stream instance.
  @implNote
  </p><p>For sequential streams, and parallel streams without
  <a href="package-summary.html#StreamOps">stateful intermediate
  operations</a>, parallel streams, pipeline evaluation is done in a single
  pass that "jams" all the operations together.  For parallel streams with
  stateful operations, execution is divided into segments, where each
  stateful operations marks the end of a segment, and each segment is
  evaluated separately and the result used as the input to the next
  segment.  In all cases, the source data is not consumed until a terminal
  operation begins.
  @param <e_in>  type of input elements
  @param <e_out> type of output elements
  @param <s> type of the subclass implementing <code>BaseStream</code>
  @since 1.8</s></e_out></e_in></p></div>
<a id="L72" name="L72"></a>  72 <strong class="reserved">abstract</strong> <strong class="reserved">class</strong> <a href="../R/99.html" title="Multiple referred from 47 places.">AbstractPipeline</a>&lt;E_IN, E_OUT, S <strong class="reserved">extends</strong> <a href="../S/880.html#L64" title="Defined at 64 in src/java/util/stream/BaseStream.java.">BaseStream</a>&lt;E_OUT, S&gt;&gt;
<a id="L73" name="L73"></a>  73         <strong class="reserved">extends</strong> <a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;E_OUT&gt; <strong class="reserved">implements</strong> <a href="../S/880.html#L64" title="Defined at 64 in src/java/util/stream/BaseStream.java.">BaseStream</a>&lt;E_OUT, S&gt; <em class="brace">{</em>
<a id="L74" name="L74"></a>  74     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> MSG_STREAM_LINKED = "stream has already been operated upon or closed";
<a id="L75" name="L75"></a>  75     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> MSG_CONSUMED = "source already consumed or closed";
<a id="L76" name="L76"></a>  76 
<div class="comment">
      Backlink to the head of the pipeline chain (self if this is the source
      stage).</div>
<a id="L81" name="L81"></a>  81     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("rawtypes")
<a id="L82" name="L82"></a>  82     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> sourceStage;
<a id="L83" name="L83"></a>  83 
<div class="comment">
      The "upstream" pipeline, or null if this is the source stage.</div>
<a id="L87" name="L87"></a>  87     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("rawtypes")
<a id="L88" name="L88"></a>  88     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> previousStage;
<a id="L89" name="L89"></a>  89 
<div class="comment">
      The operation flags for the intermediate operation represented by this
      pipeline object.</div>
<a id="L94" name="L94"></a>  94     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> sourceOrOpFlags;
<a id="L95" name="L95"></a>  95 
<div class="comment">
      The next stage in the pipeline, or null if this is the last stage.
      Effectively final at the point of linking to the next pipeline.</div>
<a id="L100" name="L100"></a> 100     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("rawtypes")
<a id="L101" name="L101"></a> 101     <strong class="reserved">private</strong> <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> nextStage;
<a id="L102" name="L102"></a> 102 
<div class="comment">
      The number of intermediate operations between this pipeline object
      and the stream source if sequential, or the previous stateful if parallel.
      Valid at the point of pipeline preparation for evaluation.</div>
<a id="L108" name="L108"></a> 108     <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a>;
<a id="L109" name="L109"></a> 109 
<div class="comment">
      The combined source and operation flags for the source and all operations
      up to and including the operation represented by this pipeline object.
      Valid at the point of pipeline preparation for evaluation.</div>
<a id="L115" name="L115"></a> 115     <strong class="reserved">private</strong> <strong class="reserved">int</strong> combinedFlags;
<a id="L116" name="L116"></a> 116 
<div class="comment">
      The source spliterator. Only valid for the head pipeline.
      Before the pipeline is consumed if non-null then <code>sourceSupplier</code>
      must be null. After the pipeline is consumed if non-null then is set to
      null.</div>
<a id="L123" name="L123"></a> 123     <strong class="reserved">private</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt; <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>;
<a id="L124" name="L124"></a> 124 
<div class="comment">
      The source supplier. Only valid for the head pipeline. Before the
      pipeline is consumed if non-null then <code>sourceSpliterator</code> must be
      null. After the pipeline is consumed if non-null then is set to null.</div>
<a id="L130" name="L130"></a> 130     <strong class="reserved">private</strong> <a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;? <strong class="reserved">extends</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt;&gt; sourceSupplier;
<a id="L131" name="L131"></a> 131 
<div class="comment">
      True if this pipeline has been linked or consumed</div>
<a id="L135" name="L135"></a> 135     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> linkedOrConsumed;
<a id="L136" name="L136"></a> 136 
<div class="comment">
      True if there are any stateful ops in the pipeline; only valid for the
      source stage.</div>
<a id="L141" name="L141"></a> 141     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> sourceAnyStateful;
<a id="L142" name="L142"></a> 142 
<a id="L143" name="L143"></a> 143     <strong class="reserved">private</strong> <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> sourceCloseAction;
<a id="L144" name="L144"></a> 144 
<div class="comment">
      True if pipeline is parallel, otherwise the pipeline is sequential; only
      valid for the source stage.</div>
<a id="L149" name="L149"></a> 149     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a>;
<a id="L150" name="L150"></a> 150 
<div class="comment">
      Constructor for the head of a stream pipeline.
      @param source <code>Supplier<spliterator></spliterator></code> describing the stream source
      @param sourceFlags The source flags for the stream source, described in
      <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>
      @param parallel True if the pipeline is parallel</div>
<a id="L159" name="L159"></a> 159     AbstractPipeline(<a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;? <strong class="reserved">extends</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt;&gt; <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>,
<a id="L160" name="L160"></a> 160                      <strong class="reserved">int</strong> sourceFlags, <strong class="reserved">boolean</strong> <a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a>) <em class="brace">{</em>
<a id="L161" name="L161"></a> 161         <strong class="reserved">this</strong>.previousStage = <strong class="reserved">null</strong>;
<a id="L162" name="L162"></a> 162         <strong class="reserved">this</strong>.sourceSupplier = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>;
<a id="L163" name="L163"></a> 163         <strong class="reserved">this</strong>.sourceStage = <strong class="reserved">this</strong>;
<a id="L164" name="L164"></a> 164         <strong class="reserved">this</strong>.sourceOrOpFlags = sourceFlags &amp; <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.STREAM_MASK;
<a id="L165" name="L165"></a> 165         <em class="comment">// The following is an optimization of:</em>
<a id="L166" name="L166"></a> 166         <em class="comment">// StreamOpFlag.combineOpFlags(sourceOrOpFlags, StreamOpFlag.INITIAL_OPS_VALUE);</em>
<a id="L167" name="L167"></a> 167         <strong class="reserved">this</strong>.combinedFlags = (~(sourceOrOpFlags &lt;&lt; 1)) &amp; <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.INITIAL_OPS_VALUE;
<a id="L168" name="L168"></a> 168         <strong class="reserved">this</strong>.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = 0;
<a id="L169" name="L169"></a> 169         <strong class="reserved">this</strong>.<a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a> = <a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a>;
<a id="L170" name="L170"></a> 170     <em class="brace">}</em>
<a id="L171" name="L171"></a> 171 
<div class="comment">
      Constructor for the head of a stream pipeline.
      @param source <code>Spliterator</code> describing the stream source
      @param sourceFlags the source flags for the stream source, described in
      <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>
      @param parallel <code>true</code> if the pipeline is parallel</div>
<a id="L180" name="L180"></a> 180     AbstractPipeline(<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt; <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>,
<a id="L181" name="L181"></a> 181                      <strong class="reserved">int</strong> sourceFlags, <strong class="reserved">boolean</strong> <a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a>) <em class="brace">{</em>
<a id="L182" name="L182"></a> 182         <strong class="reserved">this</strong>.previousStage = <strong class="reserved">null</strong>;
<a id="L183" name="L183"></a> 183         <strong class="reserved">this</strong>.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> = <a href="../S/2041.html#L132" title="Defined at 132 in src/java/nio/channels/Pipe.java.">source</a>;
<a id="L184" name="L184"></a> 184         <strong class="reserved">this</strong>.sourceStage = <strong class="reserved">this</strong>;
<a id="L185" name="L185"></a> 185         <strong class="reserved">this</strong>.sourceOrOpFlags = sourceFlags &amp; <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.STREAM_MASK;
<a id="L186" name="L186"></a> 186         <em class="comment">// The following is an optimization of:</em>
<a id="L187" name="L187"></a> 187         <em class="comment">// StreamOpFlag.combineOpFlags(sourceOrOpFlags, StreamOpFlag.INITIAL_OPS_VALUE);</em>
<a id="L188" name="L188"></a> 188         <strong class="reserved">this</strong>.combinedFlags = (~(sourceOrOpFlags &lt;&lt; 1)) &amp; <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.INITIAL_OPS_VALUE;
<a id="L189" name="L189"></a> 189         <strong class="reserved">this</strong>.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = 0;
<a id="L190" name="L190"></a> 190         <strong class="reserved">this</strong>.<a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a> = <a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a>;
<a id="L191" name="L191"></a> 191     <em class="brace">}</em>
<a id="L192" name="L192"></a> 192 
<div class="comment">
      Constructor for appending an intermediate operation stage onto an
      existing pipeline.
      @param previousStage the upstream pipeline stage
      @param opFlags the operation flags for the new stage, described in
      <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a></div>
<a id="L201" name="L201"></a> 201     <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a>(AbstractPipeline&lt;?, E_IN, ?&gt; previousStage, <strong class="reserved">int</strong> opFlags) <em class="brace">{</em>
<a id="L202" name="L202"></a> 202         <strong class="reserved">if</strong> (previousStage.linkedOrConsumed)
<a id="L203" name="L203"></a> 203             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_STREAM_LINKED);
<a id="L204" name="L204"></a> 204         previousStage.linkedOrConsumed = <strong class="reserved">true</strong>;
<a id="L205" name="L205"></a> 205         previousStage.nextStage = <strong class="reserved">this</strong>;
<a id="L206" name="L206"></a> 206 
<a id="L207" name="L207"></a> 207         <strong class="reserved">this</strong>.previousStage = previousStage;
<a id="L208" name="L208"></a> 208         <strong class="reserved">this</strong>.sourceOrOpFlags = opFlags &amp; <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.OP_MASK;
<a id="L209" name="L209"></a> 209         <strong class="reserved">this</strong>.combinedFlags = <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L686" title="Defined at 686 in src/java/util/stream/StreamOpFlag.java.">combineOpFlags</a>(opFlags, previousStage.combinedFlags);
<a id="L210" name="L210"></a> 210         <strong class="reserved">this</strong>.sourceStage = previousStage.sourceStage;
<a id="L211" name="L211"></a> 211         <strong class="reserved">if</strong> (<a href="../D/28504.html" title="Multiple defined in 13 places.">opIsStateful</a>())
<a id="L212" name="L212"></a> 212             sourceStage.sourceAnyStateful = <strong class="reserved">true</strong>;
<a id="L213" name="L213"></a> 213         <strong class="reserved">this</strong>.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = previousStage.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> + 1;
<a id="L214" name="L214"></a> 214     <em class="brace">}</em>
<a id="L215" name="L215"></a> 215 
<a id="L216" name="L216"></a> 216 
<a id="L217" name="L217"></a> 217     <em class="comment">// Terminal evaluation methods</em>
<a id="L218" name="L218"></a> 218 
<div class="comment">
      Evaluate the pipeline with a terminal operation to produce a result.
      @param <r> the type of result
      @param terminalOp the terminal operation to be applied to the pipeline.
      @return the result</r></div>
<a id="L226" name="L226"></a> 226     <strong class="reserved">final</strong> &lt;R&gt; R <a href="../R/14049.html" title="Multiple referred from 144 places.">evaluate</a>(<a href="../S/886.html#L45" title="Defined at 45 in src/java/util/stream/TerminalOp.java.">TerminalOp</a>&lt;E_OUT, R&gt; terminalOp) <em class="brace">{</em>
<a id="L227" name="L227"></a> 227         <a href="../S/1616.html#L490" title="Defined at 490 in src/java/lang/invoke/MethodType.java.">assert</a> <a href="../D/21279.html" title="Multiple defined in 5 places.">getOutputShape</a>() == terminalOp.<a href="../D/24715.html" title="Multiple defined in 7 places.">inputShape</a>();
<a id="L228" name="L228"></a> 228         <strong class="reserved">if</strong> (linkedOrConsumed)
<a id="L229" name="L229"></a> 229             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_STREAM_LINKED);
<a id="L230" name="L230"></a> 230         linkedOrConsumed = <strong class="reserved">true</strong>;
<a id="L231" name="L231"></a> 231 
<a id="L232" name="L232"></a> 232         <strong class="reserved">return</strong> <a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>()
<a id="L233" name="L233"></a> 233                ? terminalOp.<a href="../D/15749.html" title="Multiple defined in 5 places.">evaluateParallel</a>(<strong class="reserved">this</strong>, <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>(terminalOp.<a href="../D/21203.html" title="Multiple defined in 4 places.">getOpFlags</a>()))
<a id="L234" name="L234"></a> 234                : terminalOp.<a href="../D/15751.html" title="Multiple defined in 5 places.">evaluateSequential</a>(<strong class="reserved">this</strong>, <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>(terminalOp.<a href="../D/21203.html" title="Multiple defined in 4 places.">getOpFlags</a>()));
<a id="L235" name="L235"></a> 235     <em class="brace">}</em>
<a id="L236" name="L236"></a> 236 
<div class="comment">
      Collect the elements output from the pipeline stage.
      @param generator the array generator to be used to create array instances
      @return a flat array-backed Node that holds the collected output elements</div>
<a id="L243" name="L243"></a> 243     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L244" name="L244"></a> 244     <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>&lt;E_OUT&gt; <a href="../R/14053.html" title="Multiple referred from 4 places.">evaluateToArrayNode</a>(<a href="../S/980.html#L41" title="Defined at 41 in src/java/util/function/IntFunction.java.">IntFunction</a>&lt;E_OUT[]&gt; generator) <em class="brace">{</em>
<a id="L245" name="L245"></a> 245         <strong class="reserved">if</strong> (linkedOrConsumed)
<a id="L246" name="L246"></a> 246             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_STREAM_LINKED);
<a id="L247" name="L247"></a> 247         linkedOrConsumed = <strong class="reserved">true</strong>;
<a id="L248" name="L248"></a> 248 
<a id="L249" name="L249"></a> 249         <em class="comment">// If the last intermediate operation is stateful then</em>
<a id="L250" name="L250"></a> 250         <em class="comment">// evaluate directly to avoid an extra collection step</em>
<a id="L251" name="L251"></a> 251         <strong class="reserved">if</strong> (<a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>() &amp;&amp; previousStage != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/28504.html" title="Multiple defined in 13 places.">opIsStateful</a>()) <em class="brace">{</em>
<a id="L252" name="L252"></a> 252             <em class="comment">// Set the depth of this, last, pipeline stage to zero to slice the</em>
<a id="L253" name="L253"></a> 253             <em class="comment">// pipeline such that this operation will not be included in the</em>
<a id="L254" name="L254"></a> 254             <em class="comment">// upstream slice and upstream operations will not be included</em>
<a id="L255" name="L255"></a> 255             <em class="comment">// in this slice</em>
<a id="L256" name="L256"></a> 256             <a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = 0;
<a id="L257" name="L257"></a> 257             <strong class="reserved">return</strong> <a href="../D/28502.html" title="Multiple defined in 9 places.">opEvaluateParallel</a>(previousStage, previousStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>(0), generator);
<a id="L258" name="L258"></a> 258         <em class="brace">}</em>
<a id="L259" name="L259"></a> 259         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L260" name="L260"></a> 260             <strong class="reserved">return</strong> <a href="../D/15746.html" title="Multiple defined in 42 places.">evaluate</a>(<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>(0), <strong class="reserved">true</strong>, generator);
<a id="L261" name="L261"></a> 261         <em class="brace">}</em>
<a id="L262" name="L262"></a> 262     <em class="brace">}</em>
<a id="L263" name="L263"></a> 263 
<div class="comment">
      Gets the source stage spliterator if this pipeline stage is the source
      stage.  The pipeline is consumed after this method is called and
      returns successfully.
      @return the source stage spliterator
      @throws IllegalStateException if this pipeline stage is not the source
              stage.</div>
<a id="L273" name="L273"></a> 273     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L274" name="L274"></a> 274     <strong class="reserved">final</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../R/28739.html" title="Multiple referred from 8 places.">sourceStageSpliterator</a>() <em class="brace">{</em>
<a id="L275" name="L275"></a> 275         <strong class="reserved">if</strong> (<strong class="reserved">this</strong> != sourceStage)
<a id="L276" name="L276"></a> 276             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>();
<a id="L277" name="L277"></a> 277 
<a id="L278" name="L278"></a> 278         <strong class="reserved">if</strong> (linkedOrConsumed)
<a id="L279" name="L279"></a> 279             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_STREAM_LINKED);
<a id="L280" name="L280"></a> 280         linkedOrConsumed = <strong class="reserved">true</strong>;
<a id="L281" name="L281"></a> 281 
<a id="L282" name="L282"></a> 282         <strong class="reserved">if</strong> (sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L283" name="L283"></a> 283             @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L284" name="L284"></a> 284             <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; s = sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>;
<a id="L285" name="L285"></a> 285             sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> = <strong class="reserved">null</strong>;
<a id="L286" name="L286"></a> 286             <strong class="reserved">return</strong> s;
<a id="L287" name="L287"></a> 287         <em class="brace">}</em>
<a id="L288" name="L288"></a> 288         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (sourceStage.sourceSupplier != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L289" name="L289"></a> 289             @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L290" name="L290"></a> 290             <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; s = (<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt;) sourceStage.sourceSupplier.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L291" name="L291"></a> 291             sourceStage.sourceSupplier = <strong class="reserved">null</strong>;
<a id="L292" name="L292"></a> 292             <strong class="reserved">return</strong> s;
<a id="L293" name="L293"></a> 293         <em class="brace">}</em>
<a id="L294" name="L294"></a> 294         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L295" name="L295"></a> 295             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_CONSUMED);
<a id="L296" name="L296"></a> 296         <em class="brace">}</em>
<a id="L297" name="L297"></a> 297     <em class="brace">}</em>
<a id="L298" name="L298"></a> 298 
<a id="L299" name="L299"></a> 299     <em class="comment">// BaseStream</em>
<a id="L300" name="L300"></a> 300 
<a id="L301" name="L301"></a> 301     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L302" name="L302"></a> 302     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L303" name="L303"></a> 303     <strong class="reserved">public</strong> <strong class="reserved">final</strong> S <a href="../R/26806.html" title="Multiple referred from 7 places.">sequential</a>() <em class="brace">{</em>
<a id="L304" name="L304"></a> 304         sourceStage.<a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a> = <strong class="reserved">false</strong>;
<a id="L305" name="L305"></a> 305         <strong class="reserved">return</strong> (S) <strong class="reserved">this</strong>;
<a id="L306" name="L306"></a> 306     <em class="brace">}</em>
<a id="L307" name="L307"></a> 307 
<a id="L308" name="L308"></a> 308     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L309" name="L309"></a> 309     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L310" name="L310"></a> 310     <strong class="reserved">public</strong> <strong class="reserved">final</strong> S <a href="../R/24466.html" title="Multiple referred from 81 places.">parallel</a>() <em class="brace">{</em>
<a id="L311" name="L311"></a> 311         sourceStage.<a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a> = <strong class="reserved">true</strong>;
<a id="L312" name="L312"></a> 312         <strong class="reserved">return</strong> (S) <strong class="reserved">this</strong>;
<a id="L313" name="L313"></a> 313     <em class="brace">}</em>
<a id="L314" name="L314"></a> 314 
<a id="L315" name="L315"></a> 315     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L316" name="L316"></a> 316     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/11587.html" title="Multiple referred from 410 places.">close</a>() <em class="brace">{</em>
<a id="L317" name="L317"></a> 317         linkedOrConsumed = <strong class="reserved">true</strong>;
<a id="L318" name="L318"></a> 318         sourceSupplier = <strong class="reserved">null</strong>;
<a id="L319" name="L319"></a> 319         <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> = <strong class="reserved">null</strong>;
<a id="L320" name="L320"></a> 320         <strong class="reserved">if</strong> (sourceStage.sourceCloseAction != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L321" name="L321"></a> 321             <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> closeAction = sourceStage.sourceCloseAction;
<a id="L322" name="L322"></a> 322             sourceStage.sourceCloseAction = <strong class="reserved">null</strong>;
<a id="L323" name="L323"></a> 323             closeAction.<a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>();
<a id="L324" name="L324"></a> 324         <em class="brace">}</em>
<a id="L325" name="L325"></a> 325     <em class="brace">}</em>
<a id="L326" name="L326"></a> 326 
<a id="L327" name="L327"></a> 327     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L328" name="L328"></a> 328     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L329" name="L329"></a> 329     <strong class="reserved">public</strong> S <a href="../R/23947.html" title="Multiple referred from 8 places.">onClose</a>(<a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> closeHandler) <em class="brace">{</em>
<a id="L330" name="L330"></a> 330         <a href="../S/1758.html#L56" title="Defined at 56 in src/java/lang/Runnable.java.">Runnable</a> existingHandler = sourceStage.sourceCloseAction;
<a id="L331" name="L331"></a> 331         sourceStage.sourceCloseAction =
<a id="L332" name="L332"></a> 332                 (existingHandler == <strong class="reserved">null</strong>)
<a id="L333" name="L333"></a> 333                 ? closeHandler
<a id="L334" name="L334"></a> 334                 : <a href="../S/911.html#L44" title="Defined at 44 in src/java/util/stream/Streams.java.">Streams</a>.<a href="../S/911.html#L845" title="Defined at 845 in src/java/util/stream/Streams.java.">composeWithExceptions</a>(existingHandler, closeHandler);
<a id="L335" name="L335"></a> 335         <strong class="reserved">return</strong> (S) <strong class="reserved">this</strong>;
<a id="L336" name="L336"></a> 336     <em class="brace">}</em>
<a id="L337" name="L337"></a> 337 
<a id="L338" name="L338"></a> 338     <em class="comment">// Primitive specialization use co-variant overrides, hence is not final</em>
<a id="L339" name="L339"></a> 339     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L340" name="L340"></a> 340     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L341" name="L341"></a> 341     <strong class="reserved">public</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../R/28762.html" title="Multiple referred from 435 places.">spliterator</a>() <em class="brace">{</em>
<a id="L342" name="L342"></a> 342         <strong class="reserved">if</strong> (linkedOrConsumed)
<a id="L343" name="L343"></a> 343             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_STREAM_LINKED);
<a id="L344" name="L344"></a> 344         linkedOrConsumed = <strong class="reserved">true</strong>;
<a id="L345" name="L345"></a> 345 
<a id="L346" name="L346"></a> 346         <strong class="reserved">if</strong> (<strong class="reserved">this</strong> == sourceStage) <em class="brace">{</em>
<a id="L347" name="L347"></a> 347             <strong class="reserved">if</strong> (sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L348" name="L348"></a> 348                 @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L349" name="L349"></a> 349                 <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; s = (<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt;) sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>;
<a id="L350" name="L350"></a> 350                 sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> = <strong class="reserved">null</strong>;
<a id="L351" name="L351"></a> 351                 <strong class="reserved">return</strong> s;
<a id="L352" name="L352"></a> 352             <em class="brace">}</em>
<a id="L353" name="L353"></a> 353             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (sourceStage.sourceSupplier != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L354" name="L354"></a> 354                 @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L355" name="L355"></a> 355                 <a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt;&gt; s = (<a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt;&gt;) sourceStage.sourceSupplier;
<a id="L356" name="L356"></a> 356                 sourceStage.sourceSupplier = <strong class="reserved">null</strong>;
<a id="L357" name="L357"></a> 357                 <strong class="reserved">return</strong> <a href="../D/26789.html" title="Multiple defined in 5 places.">lazySpliterator</a>(s);
<a id="L358" name="L358"></a> 358             <em class="brace">}</em>
<a id="L359" name="L359"></a> 359             <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L360" name="L360"></a> 360                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_CONSUMED);
<a id="L361" name="L361"></a> 361             <em class="brace">}</em>
<a id="L362" name="L362"></a> 362         <em class="brace">}</em>
<a id="L363" name="L363"></a> 363         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L364" name="L364"></a> 364             <strong class="reserved">return</strong> <a href="../D/36957.html" title="Multiple defined in 35 places.">wrap</a>(<strong class="reserved">this</strong>, () -&gt; <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>(0), <a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>());
<a id="L365" name="L365"></a> 365         <em class="brace">}</em>
<a id="L366" name="L366"></a> 366     <em class="brace">}</em>
<a id="L367" name="L367"></a> 367 
<a id="L368" name="L368"></a> 368     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L369" name="L369"></a> 369     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21858.html" title="Multiple referred from 36 places.">isParallel</a>() <em class="brace">{</em>
<a id="L370" name="L370"></a> 370         <strong class="reserved">return</strong> sourceStage.<a href="../D/29043.html" title="Multiple defined in 5 places.">parallel</a>;
<a id="L371" name="L371"></a> 371     <em class="brace">}</em>
<a id="L372" name="L372"></a> 372 
<a id="L373" name="L373"></a> 373 
<div class="comment">
      Returns the composition of stream flags of the stream source and all
      intermediate operations.
      @return the composition of stream flags of the stream source and all
              intermediate operations
      @see StreamOpFlag</div>
<a id="L382" name="L382"></a> 382     <strong class="reserved">final</strong> <strong class="reserved">int</strong> getStreamFlags() <em class="brace">{</em>
<a id="L383" name="L383"></a> 383         <strong class="reserved">return</strong> <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L703" title="Defined at 703 in src/java/util/stream/StreamOpFlag.java.">toStreamFlags</a>(combinedFlags);
<a id="L384" name="L384"></a> 384     <em class="brace">}</em>
<a id="L385" name="L385"></a> 385 
<div class="comment">
      Get the source spliterator for this pipeline stage.  For a sequential or
      stateless parallel pipeline, this is the source spliterator.  For a
      stateful parallel pipeline, this is a spliterator describing the results
      of all computations up to and including the most recent stateful
      operation.</div>
<a id="L393" name="L393"></a> 393     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L394" name="L394"></a> 394     <strong class="reserved">private</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt; <a href="../R/28738.html" title="Multiple referred from 20 places.">sourceSpliterator</a>(<strong class="reserved">int</strong> terminalFlags) <em class="brace">{</em>
<a id="L395" name="L395"></a> 395         <em class="comment">// Get the source spliterator of the pipeline</em>
<a id="L396" name="L396"></a> 396         <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <strong class="reserved">null</strong>;
<a id="L397" name="L397"></a> 397         <strong class="reserved">if</strong> (sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L398" name="L398"></a> 398             <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>;
<a id="L399" name="L399"></a> 399             sourceStage.<a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a> = <strong class="reserved">null</strong>;
<a id="L400" name="L400"></a> 400         <em class="brace">}</em>
<a id="L401" name="L401"></a> 401         <strong class="reserved">else</strong> <strong class="reserved">if</strong> (sourceStage.sourceSupplier != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L402" name="L402"></a> 402             <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = (<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;?&gt;) sourceStage.sourceSupplier.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L403" name="L403"></a> 403             sourceStage.sourceSupplier = <strong class="reserved">null</strong>;
<a id="L404" name="L404"></a> 404         <em class="brace">}</em>
<a id="L405" name="L405"></a> 405         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L406" name="L406"></a> 406             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1555.html#L38" title="Defined at 38 in src/java/lang/IllegalStateException.java.">IllegalStateException</a>(MSG_CONSUMED);
<a id="L407" name="L407"></a> 407         <em class="brace">}</em>
<a id="L408" name="L408"></a> 408 
<a id="L409" name="L409"></a> 409         <strong class="reserved">if</strong> (<a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>() &amp;&amp; sourceStage.sourceAnyStateful) <em class="brace">{</em>
<a id="L410" name="L410"></a> 410             <em class="comment">// Adapt the source spliterator, evaluating each stateful op</em>
<a id="L411" name="L411"></a> 411             <em class="comment">// in the pipeline up to and including this pipeline stage.</em>
<a id="L412" name="L412"></a> 412             <em class="comment">// The depth and flags of each pipeline stage are adjusted accordingly.</em>
<a id="L413" name="L413"></a> 413             <strong class="reserved">int</strong> <a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = 1;
<a id="L414" name="L414"></a> 414             <strong class="reserved">for</strong> (@<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("rawtypes") <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> <a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a> = sourceStage, p = sourceStage.nextStage, e = <strong class="reserved">this</strong>;
<a id="L415" name="L415"></a> 415                  <a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a> != e;
<a id="L416" name="L416"></a> 416                  <a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a> = p, p = p.nextStage) <em class="brace">{</em>
<a id="L417" name="L417"></a> 417 
<a id="L418" name="L418"></a> 418                 <strong class="reserved">int</strong> thisOpFlags = p.sourceOrOpFlags;
<a id="L419" name="L419"></a> 419                 <strong class="reserved">if</strong> (p.<a href="../D/28504.html" title="Multiple defined in 13 places.">opIsStateful</a>()) <em class="brace">{</em>
<a id="L420" name="L420"></a> 420                     <a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = 0;
<a id="L421" name="L421"></a> 421 
<a id="L422" name="L422"></a> 422                     <strong class="reserved">if</strong> (<a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L327" title="Defined at 327 in src/java/util/stream/StreamOpFlag.java.">SHORT_CIRCUIT</a>.<a href="../S/915.html#L490" title="Defined at 490 in src/java/util/stream/StreamOpFlag.java.">isKnown</a>(thisOpFlags)) <em class="brace">{</em>
<a id="L423" name="L423"></a> 423                         <em class="comment">// Clear the short circuit flag for next pipeline stage</em>
<a id="L424" name="L424"></a> 424                         <em class="comment">// This stage encapsulates short-circuiting, the next</em>
<a id="L425" name="L425"></a> 425                         <em class="comment">// stage may not have any short-circuit operations, and</em>
<a id="L426" name="L426"></a> 426                         <em class="comment">// if so spliterator.forEachRemaining should be used</em>
<a id="L427" name="L427"></a> 427                         <em class="comment">// for traversal</em>
<a id="L428" name="L428"></a> 428                         thisOpFlags = thisOpFlags &amp; ~<a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.IS_SHORT_CIRCUIT;
<a id="L429" name="L429"></a> 429                     <em class="brace">}</em>
<a id="L430" name="L430"></a> 430 
<a id="L431" name="L431"></a> 431                     <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = p.<a href="../S/890.html#L702" title="Defined at 702 in src/java/util/stream/AbstractPipeline.java.">opEvaluateParallelLazy</a>(<a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a>, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>);
<a id="L432" name="L432"></a> 432 
<a id="L433" name="L433"></a> 433                     <em class="comment">// Inject or clear SIZED on the source pipeline stage</em>
<a id="L434" name="L434"></a> 434                     <em class="comment">// based on the stage's spliterator</em>
<a id="L435" name="L435"></a> 435                     thisOpFlags = <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>.<a href="../D/24076.html" title="Multiple defined in 2 places.">hasCharacteristics</a>(<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>.<a href="../S/915.html#L296" title="Defined at 296 in src/java/util/stream/StreamOpFlag.java.">SIZED</a>)
<a id="L436" name="L436"></a> 436                             ? (thisOpFlags &amp; ~<a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.NOT_SIZED) | <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.IS_SIZED
<a id="L437" name="L437"></a> 437                             : (thisOpFlags &amp; ~<a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.IS_SIZED) | <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.NOT_SIZED;
<a id="L438" name="L438"></a> 438                 <em class="brace">}</em>
<a id="L439" name="L439"></a> 439                 p.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> = <a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a>++;
<a id="L440" name="L440"></a> 440                 p.combinedFlags = <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L686" title="Defined at 686 in src/java/util/stream/StreamOpFlag.java.">combineOpFlags</a>(thisOpFlags, <a href="../S/986.html#L3242" title="Defined at 3242 in src/java/util/regex/Pattern.java.">u</a>.combinedFlags);
<a id="L441" name="L441"></a> 441             <em class="brace">}</em>
<a id="L442" name="L442"></a> 442         <em class="brace">}</em>
<a id="L443" name="L443"></a> 443 
<a id="L444" name="L444"></a> 444         <strong class="reserved">if</strong> (terminalFlags != 0)  <em class="brace">{</em>
<a id="L445" name="L445"></a> 445             <em class="comment">// Apply flags from the terminal operation to last pipeline stage</em>
<a id="L446" name="L446"></a> 446             combinedFlags = <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L686" title="Defined at 686 in src/java/util/stream/StreamOpFlag.java.">combineOpFlags</a>(terminalFlags, combinedFlags);
<a id="L447" name="L447"></a> 447         <em class="brace">}</em>
<a id="L448" name="L448"></a> 448 
<a id="L449" name="L449"></a> 449         <strong class="reserved">return</strong> <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L450" name="L450"></a> 450     <em class="brace">}</em>
<a id="L451" name="L451"></a> 451 
<a id="L452" name="L452"></a> 452     <em class="comment">// PipelineHelper</em>
<a id="L453" name="L453"></a> 453 
<a id="L454" name="L454"></a> 454     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L455" name="L455"></a> 455     <strong class="reserved">final</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a> <a href="../R/19105.html" title="Multiple referred from 4 places.">getSourceShape</a>() <em class="brace">{</em>
<a id="L456" name="L456"></a> 456         @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("rawtypes")
<a id="L457" name="L457"></a> 457         <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> p = <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a>.<strong class="reserved">this</strong>;
<a id="L458" name="L458"></a> 458         <strong class="reserved">while</strong> (p.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> &gt; 0) <em class="brace">{</em>
<a id="L459" name="L459"></a> 459             p = p.previousStage;
<a id="L460" name="L460"></a> 460         <em class="brace">}</em>
<a id="L461" name="L461"></a> 461         <strong class="reserved">return</strong> p.<a href="../D/21279.html" title="Multiple defined in 5 places.">getOutputShape</a>();
<a id="L462" name="L462"></a> 462     <em class="brace">}</em>
<a id="L463" name="L463"></a> 463 
<a id="L464" name="L464"></a> 464     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L465" name="L465"></a> 465     <strong class="reserved">final</strong> &lt;P_IN&gt; <strong class="reserved">long</strong> <a href="../R/14063.html" title="Multiple referred from 16 places.">exactOutputSizeIfKnown</a>(<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L466" name="L466"></a> 466         <strong class="reserved">return</strong> <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L296" title="Defined at 296 in src/java/util/stream/StreamOpFlag.java.">SIZED</a>.<a href="../S/915.html#L490" title="Defined at 490 in src/java/util/stream/StreamOpFlag.java.">isKnown</a>(<a href="../D/22753.html" title="Multiple defined in 2 places.">getStreamAndOpFlags</a>()) ? <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>.<a href="../D/18893.html" title="Multiple defined in 4 places.">getExactSizeIfKnown</a>() : -1;
<a id="L467" name="L467"></a> 467     <em class="brace">}</em>
<a id="L468" name="L468"></a> 468 
<a id="L469" name="L469"></a> 469     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L470" name="L470"></a> 470     <strong class="reserved">final</strong> &lt;P_IN, S <strong class="reserved">extends</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;E_OUT&gt;&gt; S <a href="../R/30536.html" title="Multiple referred from 17 places.">wrapAndCopyInto</a>(S <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>, <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L471" name="L471"></a> 471         <a href="../D/13501.html" title="Multiple defined in 23 places.">copyInto</a>(<a href="../D/36961.html" title="Multiple defined in 2 places.">wrapSink</a>(<a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>)), <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>);
<a id="L472" name="L472"></a> 472         <strong class="reserved">return</strong> <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>;
<a id="L473" name="L473"></a> 473     <em class="brace">}</em>
<a id="L474" name="L474"></a> 474 
<a id="L475" name="L475"></a> 475     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L476" name="L476"></a> 476     <strong class="reserved">final</strong> &lt;P_IN&gt; <strong class="reserved">void</strong> <a href="../R/12112.html" title="Multiple referred from 72 places.">copyInto</a>(<a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;P_IN&gt; wrappedSink, <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L477" name="L477"></a> 477         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(wrappedSink);
<a id="L478" name="L478"></a> 478 
<a id="L479" name="L479"></a> 479         <strong class="reserved">if</strong> (!<a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L327" title="Defined at 327 in src/java/util/stream/StreamOpFlag.java.">SHORT_CIRCUIT</a>.<a href="../S/915.html#L490" title="Defined at 490 in src/java/util/stream/StreamOpFlag.java.">isKnown</a>(<a href="../D/22753.html" title="Multiple defined in 2 places.">getStreamAndOpFlags</a>())) <em class="brace">{</em>
<a id="L480" name="L480"></a> 480             wrappedSink.<a href="../D/11808.html" title="Multiple defined in 37 places.">begin</a>(<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>.<a href="../D/18893.html" title="Multiple defined in 4 places.">getExactSizeIfKnown</a>());
<a id="L481" name="L481"></a> 481             <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>.<a href="../D/16513.html" title="Multiple defined in 101 places.">forEachRemaining</a>(wrappedSink);
<a id="L482" name="L482"></a> 482             wrappedSink.<a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>();
<a id="L483" name="L483"></a> 483         <em class="brace">}</em>
<a id="L484" name="L484"></a> 484         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L485" name="L485"></a> 485             <a href="../D/13502.html" title="Multiple defined in 2 places.">copyIntoWithCancel</a>(wrappedSink, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>);
<a id="L486" name="L486"></a> 486         <em class="brace">}</em>
<a id="L487" name="L487"></a> 487     <em class="brace">}</em>
<a id="L488" name="L488"></a> 488 
<a id="L489" name="L489"></a> 489     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L490" name="L490"></a> 490     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L491" name="L491"></a> 491     <strong class="reserved">final</strong> &lt;P_IN&gt; <strong class="reserved">void</strong> <a href="../R/12113.html" title="Multiple referred from 2 places.">copyIntoWithCancel</a>(<a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;P_IN&gt; wrappedSink, <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L492" name="L492"></a> 492         @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>(<em class="brace">{</em>"rawtypes","unchecked"<em class="brace">}</em>)
<a id="L493" name="L493"></a> 493         <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> p = <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a>.<strong class="reserved">this</strong>;
<a id="L494" name="L494"></a> 494         <strong class="reserved">while</strong> (p.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> &gt; 0) <em class="brace">{</em>
<a id="L495" name="L495"></a> 495             p = p.previousStage;
<a id="L496" name="L496"></a> 496         <em class="brace">}</em>
<a id="L497" name="L497"></a> 497         wrappedSink.<a href="../D/11808.html" title="Multiple defined in 37 places.">begin</a>(<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>.<a href="../D/18893.html" title="Multiple defined in 4 places.">getExactSizeIfKnown</a>());
<a id="L498" name="L498"></a> 498         p.<a href="../D/16515.html" title="Multiple defined in 5 places.">forEachWithCancel</a>(<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, wrappedSink);
<a id="L499" name="L499"></a> 499         wrappedSink.<a href="../D/15431.html" title="Multiple defined in 52 places.">end</a>();
<a id="L500" name="L500"></a> 500     <em class="brace">}</em>
<a id="L501" name="L501"></a> 501 
<a id="L502" name="L502"></a> 502     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L503" name="L503"></a> 503     <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19200.html" title="Multiple referred from 22 places.">getStreamAndOpFlags</a>() <em class="brace">{</em>
<a id="L504" name="L504"></a> 504         <strong class="reserved">return</strong> combinedFlags;
<a id="L505" name="L505"></a> 505     <em class="brace">}</em>
<a id="L506" name="L506"></a> 506 
<a id="L507" name="L507"></a> 507     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21829.html" title="Multiple referred from 10 places.">isOrdered</a>() <em class="brace">{</em>
<a id="L508" name="L508"></a> 508         <strong class="reserved">return</strong> <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L281" title="Defined at 281 in src/java/util/stream/StreamOpFlag.java.">ORDERED</a>.<a href="../S/915.html#L490" title="Defined at 490 in src/java/util/stream/StreamOpFlag.java.">isKnown</a>(combinedFlags);
<a id="L509" name="L509"></a> 509     <em class="brace">}</em>
<a id="L510" name="L510"></a> 510 
<a id="L511" name="L511"></a> 511     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L512" name="L512"></a> 512     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L513" name="L513"></a> 513     <strong class="reserved">final</strong> &lt;P_IN&gt; <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;P_IN&gt; <a href="../R/30539.html" title="Multiple referred from 7 places.">wrapSink</a>(<a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;E_OUT&gt; <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>) <em class="brace">{</em>
<a id="L514" name="L514"></a> 514         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>);
<a id="L515" name="L515"></a> 515 
<a id="L516" name="L516"></a> 516         <strong class="reserved">for</strong> ( @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("rawtypes") <a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a> p=<a href="../S/890.html#L72" title="Defined at 72 in src/java/util/stream/AbstractPipeline.java.">AbstractPipeline</a>.<strong class="reserved">this</strong>; p.<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> &gt; 0; p=p.previousStage) <em class="brace">{</em>
<a id="L517" name="L517"></a> 517             <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a> = p.<a href="../D/28506.html" title="Multiple defined in 9 places.">opWrapSink</a>(p.previousStage.combinedFlags, <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>);
<a id="L518" name="L518"></a> 518         <em class="brace">}</em>
<a id="L519" name="L519"></a> 519         <strong class="reserved">return</strong> (<a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;P_IN&gt;) <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>;
<a id="L520" name="L520"></a> 520     <em class="brace">}</em>
<a id="L521" name="L521"></a> 521 
<a id="L522" name="L522"></a> 522     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L523" name="L523"></a> 523     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L524" name="L524"></a> 524     <strong class="reserved">final</strong> &lt;P_IN&gt; <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../R/30540.html" title="Multiple referred from 14 places.">wrapSpliterator</a>(<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>) <em class="brace">{</em>
<a id="L525" name="L525"></a> 525         <strong class="reserved">if</strong> (<a href="../S/3238.html#L188" title="Defined at 188 in src/javax/swing/text/ElementIterator.java.">depth</a> == 0) <em class="brace">{</em>
<a id="L526" name="L526"></a> 526             <strong class="reserved">return</strong> (<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt;) <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>;
<a id="L527" name="L527"></a> 527         <em class="brace">}</em>
<a id="L528" name="L528"></a> 528         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L529" name="L529"></a> 529             <strong class="reserved">return</strong> <a href="../D/36957.html" title="Multiple defined in 35 places.">wrap</a>(<strong class="reserved">this</strong>, () -&gt; <a href="../S/890.html#L394" title="Defined at 394 in src/java/util/stream/AbstractPipeline.java.">sourceSpliterator</a>, <a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>());
<a id="L530" name="L530"></a> 530         <em class="brace">}</em>
<a id="L531" name="L531"></a> 531     <em class="brace">}</em>
<a id="L532" name="L532"></a> 532 
<a id="L533" name="L533"></a> 533     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L534" name="L534"></a> 534     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L535" name="L535"></a> 535     <strong class="reserved">final</strong> &lt;P_IN&gt; <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>&lt;E_OUT&gt; <a href="../R/14049.html" title="Multiple referred from 144 places.">evaluate</a>(<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>,
<a id="L536" name="L536"></a> 536                                       <strong class="reserved">boolean</strong> <a href="../D/16451.html" title="Multiple defined in 2 places.">flatten</a>,
<a id="L537" name="L537"></a> 537                                       <a href="../S/980.html#L41" title="Defined at 41 in src/java/util/function/IntFunction.java.">IntFunction</a>&lt;E_OUT[]&gt; generator) <em class="brace">{</em>
<a id="L538" name="L538"></a> 538         <strong class="reserved">if</strong> (<a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>()) <em class="brace">{</em>
<a id="L539" name="L539"></a> 539             <em class="comment">// @@@ Optimize if op of this pipeline stage is a stateful op</em>
<a id="L540" name="L540"></a> 540             <strong class="reserved">return</strong> <a href="../D/15753.html" title="Multiple defined in 5 places.">evaluateToNode</a>(<strong class="reserved">this</strong>, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, <a href="../D/16451.html" title="Multiple defined in 2 places.">flatten</a>, generator);
<a id="L541" name="L541"></a> 541         <em class="brace">}</em>
<a id="L542" name="L542"></a> 542         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L543" name="L543"></a> 543             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<a href="../D/1017.html" title="Multiple defined in 9 places.">Builder</a>&lt;E_OUT&gt; nb = <a href="../D/27342.html" title="Multiple defined in 6 places.">makeNodeBuilder</a>(
<a id="L544" name="L544"></a> 544                     <a href="../D/15762.html" title="Multiple defined in 2 places.">exactOutputSizeIfKnown</a>(<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>), generator);
<a id="L545" name="L545"></a> 545             <strong class="reserved">return</strong> <a href="../D/36958.html" title="Multiple defined in 2 places.">wrapAndCopyInto</a>(nb, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>).<a href="../D/11931.html" title="Multiple defined in 27 places.">build</a>();
<a id="L546" name="L546"></a> 546         <em class="brace">}</em>
<a id="L547" name="L547"></a> 547     <em class="brace">}</em>
<a id="L548" name="L548"></a> 548 
<a id="L549" name="L549"></a> 549 
<a id="L550" name="L550"></a> 550     <em class="comment">// Shape-specific abstract methods, implemented by XxxPipeline classes</em>
<a id="L551" name="L551"></a> 551 
<div class="comment">
      Get the output shape of the pipeline.  If the pipeline is the head,
      then it's output shape corresponds to the shape of the source.
      Otherwise, it's output shape corresponds to the output shape of the
      associated operation.
      @return the output shape</div>
<a id="L560" name="L560"></a> 560     <strong class="reserved">abstract</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a> <a href="../R/18191.html" title="Multiple referred from 12 places.">getOutputShape</a>();
<a id="L561" name="L561"></a> 561 
<div class="comment">
      Collect elements output from a pipeline into a Node that holds elements
      of this shape.
      @param helper the pipeline helper describing the pipeline stages
      @param spliterator the source spliterator
      @param flattenTree true if the returned node should be flattened
      @param generator the array generator
      @return a Node holding the output of the pipeline</div>
<a id="L572" name="L572"></a> 572     <strong class="reserved">abstract</strong> &lt;P_IN&gt; <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>&lt;E_OUT&gt; <a href="../S/890.html#L540" title="Referred from 540 in src/java/util/stream/AbstractPipeline.java.">evaluateToNode</a>(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;E_OUT&gt; helper,
<a id="L573" name="L573"></a> 573                                                <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>,
<a id="L574" name="L574"></a> 574                                                <strong class="reserved">boolean</strong> flattenTree,
<a id="L575" name="L575"></a> 575                                                <a href="../S/980.html#L41" title="Defined at 41 in src/java/util/function/IntFunction.java.">IntFunction</a>&lt;E_OUT[]&gt; generator);
<a id="L576" name="L576"></a> 576 
<div class="comment">
      Create a spliterator that wraps a source spliterator, compatible with
      this stream shape, and operations associated with a {@link
      PipelineHelper}.
      @param ph the pipeline helper describing the pipeline stages
      @param supplier the supplier of a spliterator
      @return a wrapping spliterator compatible with this shape</div>
<a id="L586" name="L586"></a> 586     <strong class="reserved">abstract</strong> &lt;P_IN&gt; <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../R/30535.html" title="Multiple referred from 76 places.">wrap</a>(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;E_OUT&gt; ph,
<a id="L587" name="L587"></a> 587                                             <a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt;&gt; <a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>,
<a id="L588" name="L588"></a> 588                                             <strong class="reserved">boolean</strong> <a href="../D/26037.html" title="Multiple defined in 2 places.">isParallel</a>);
<a id="L589" name="L589"></a> 589 
<div class="comment">
      Create a lazy spliterator that wraps and obtains the supplied the
      spliterator when a method is invoked on the lazy spliterator.
      @param supplier the supplier of a spliterator</div>
<a id="L595" name="L595"></a> 595     <strong class="reserved">abstract</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../S/890.html#L357" title="Referred from 357 in src/java/util/stream/AbstractPipeline.java.">lazySpliterator</a>(<a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;? <strong class="reserved">extends</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt;&gt; <a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>);
<a id="L596" name="L596"></a> 596 
<div class="comment">
      Traverse the elements of a spliterator compatible with this stream shape,
      pushing those elements into a sink.   If the sink requests cancellation,
      no further elements will be pulled or pushed.
      @param spliterator the spliterator to pull elements from
      @param sink the sink to push elements to</div>
<a id="L605" name="L605"></a> 605     <strong class="reserved">abstract</strong> <strong class="reserved">void</strong> <a href="../S/890.html#L498" title="Referred from 498 in src/java/util/stream/AbstractPipeline.java.">forEachWithCancel</a>(<a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;E_OUT&gt; <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>);
<a id="L606" name="L606"></a> 606 
<div class="comment">
      Make a node builder compatible with this stream shape.
      @param exactSizeIfKnown if {@literal &gt;=0}, then a node builder will be
      created that has a fixed capacity of at most sizeIfKnown elements. If
      {@literal &lt; 0}, then the node builder has an unfixed capacity. A fixed
      capacity node builder will throw exceptions if an element is added after
      builder has reached capacity, or is built before the builder has reached
      capacity.
      @param generator the array generator to be used to create instances of a
      T[] array. For implementations supporting primitive nodes, this parameter
      may be ignored.
      @return a node builder</div>
<a id="L622" name="L622"></a> 622     @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L623" name="L623"></a> 623     <strong class="reserved">abstract</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<a href="../D/1017.html" title="Multiple defined in 9 places.">Builder</a>&lt;E_OUT&gt; <a href="../R/22949.html" title="Multiple referred from 4 places.">makeNodeBuilder</a>(<strong class="reserved">long</strong> exactSizeIfKnown,
<a id="L624" name="L624"></a> 624                                                  <a href="../S/980.html#L41" title="Defined at 41 in src/java/util/function/IntFunction.java.">IntFunction</a>&lt;E_OUT[]&gt; generator);
<a id="L625" name="L625"></a> 625 
<a id="L626" name="L626"></a> 626 
<a id="L627" name="L627"></a> 627     <em class="comment">// Op-specific abstract methods, implemented by the operation class</em>
<a id="L628" name="L628"></a> 628 
<div class="comment">
      Returns whether this operation is stateful or not.  If it is stateful,
      then the method
      {@link #opEvaluateParallel(PipelineHelper, java.util.Spliterator, java.util.function.IntFunction)}
      must be overridden.
      @return <code>true</code> if this operation is stateful</div>
<a id="L637" name="L637"></a> 637     <strong class="reserved">abstract</strong> <strong class="reserved">boolean</strong> <a href="../R/23965.html" title="Multiple referred from 3 places.">opIsStateful</a>();
<a id="L638" name="L638"></a> 638 
<div class="comment">
      Accepts a <code>Sink</code> which will receive the results of this operation,
      and return a <code>Sink</code> which accepts elements of the input type of
      this operation and which performs the operation, passing the results to
      the provided <code>Sink</code>.
      @apiNote
      The implementation may use the <code>flags</code> parameter to optimize the
      sink wrapping.  For example, if the input is already <code>DISTINCT</code>,
      the implementation for the <code>Stream#distinct()</code> method could just
      return the sink it was passed.
      @param flags The combined stream and operation flags up to, but not
             including, this operation
      @param sink sink to which elements should be sent after processing
      @return a sink which accepts elements, perform the operation upon
              each element, and passes the results (if any) to the provided
              <code>Sink</code>.</div>
<a id="L658" name="L658"></a> 658     <strong class="reserved">abstract</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;E_IN&gt; <a href="../R/23967.html" title="Multiple referred from 45 places.">opWrapSink</a>(<strong class="reserved">int</strong> <a href="../D/16441.html" title="Multiple defined in 7 places.">flags</a>, <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;E_OUT&gt; <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>);
<a id="L659" name="L659"></a> 659 
<div class="comment">
      Performs a parallel evaluation of the operation using the specified
      <code>PipelineHelper</code> which describes the upstream intermediate
      operations.  Only called on stateful operations.  If {@link
      #opIsStateful()} returns true then implementations must override the
      default implementation.
      @implSpec The default implementation always throw
      <code>UnsupportedOperationException</code>.
      @param helper the pipeline helper describing the pipeline stages
      @param spliterator the source <code>Spliterator</code>
      @param generator the array generator
      @return a <code>Node</code> describing the result of the evaluation</div>
<a id="L675" name="L675"></a> 675     &lt;P_IN&gt; <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>&lt;E_OUT&gt; <a href="../R/23963.html" title="Multiple referred from 7 places.">opEvaluateParallel</a>(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;E_OUT&gt; helper,
<a id="L676" name="L676"></a> 676                                           <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>,
<a id="L677" name="L677"></a> 677                                           <a href="../S/980.html#L41" title="Defined at 41 in src/java/util/function/IntFunction.java.">IntFunction</a>&lt;E_OUT[]&gt; generator) <em class="brace">{</em>
<a id="L678" name="L678"></a> 678         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>("Parallel evaluation is not supported");
<a id="L679" name="L679"></a> 679     <em class="brace">}</em>
<a id="L680" name="L680"></a> 680 
<div class="comment">
      Returns a <code>Spliterator</code> describing a parallel evaluation of the
      operation, using the specified <code>PipelineHelper</code> which describes the
      upstream intermediate operations.  Only called on stateful operations.
      It is not necessary (though acceptable) to do a full computation of the
      result here; it is preferable, if possible, to describe the result via a
      lazily evaluated spliterator.
      @implSpec The default implementation behaves as if:
      <pre>{@code
          return evaluateParallel(helper, i -&gt; (E_OUT[]) new
      Object[i]).spliterator();
      }</pre>
      and is suitable for implementations that cannot do better than a full
      synchronous evaluation.
      @param helper the pipeline helper
      @param spliterator the source <code>Spliterator</code>
      @return a <code>Spliterator</code> describing the result of the evaluation</div>
<a id="L701" name="L701"></a> 701     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("unchecked")
<a id="L702" name="L702"></a> 702     &lt;P_IN&gt; <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;E_OUT&gt; <a href="../R/23964.html" title="Multiple referred from 6 places.">opEvaluateParallelLazy</a>(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;E_OUT&gt; helper,
<a id="L703" name="L703"></a> 703                                                      <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;P_IN&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L704" name="L704"></a> 704         <strong class="reserved">return</strong> <a href="../D/28502.html" title="Multiple defined in 9 places.">opEvaluateParallel</a>(helper, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, i -&gt; (E_OUT[]) <strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[i]).<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>();
<a id="L705" name="L705"></a> 705     <em class="brace">}</em>
<a id="L706" name="L706"></a> 706 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L81">[^]</a><a href="#L702">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>