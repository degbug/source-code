<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/lang/ThreadLocal.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L104">[^]</a><a href="#L712">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L104" title="Defined at 104.">nextHashCode</a></li>
<li><a href="#L126" title="Defined at 126.">initialValue</a></li>
<li><a href="#L140" title="Defined at 140.">withInitial</a></li>
<li><a href="#L159" title="Defined at 159.">get</a></li>
<li><a href="#L179" title="Defined at 179.">setInitialValue</a></li>
<li><a href="#L199" title="Defined at 199.">set</a></li>
<li><a href="#L219" title="Defined at 219.">remove</a></li>
<li><a href="#L232" title="Defined at 232.">getMap</a></li>
<li><a href="#L243" title="Defined at 243.">createMap</a></li>
<li><a href="#L254" title="Defined at 254.">createInheritedMap</a></li>
<li><a href="#L266" title="Defined at 266.">childValue</a></li>
<li><a href="#L283" title="Defined at 283.">initialValue</a></li>
<li><a href="#L342" title="Defined at 342.">setThreshold</a></li>
<li><a href="#L349" title="Defined at 349.">nextIndex</a></li>
<li><a href="#L356" title="Defined at 356.">prevIndex</a></li>
<li><a href="#L413" title="Defined at 413.">getEntry</a></li>
<li><a href="#L431" title="Defined at 431.">getEntryAfterMiss</a></li>
<li><a href="#L454" title="Defined at 454.">set</a></li>
<li><a href="#L490" title="Defined at 490.">remove</a></li>
<li><a href="#L520" title="Defined at 520.">replaceStaleEntry</a></li>
<li><a href="#L589" title="Defined at 589.">expungeStaleEntry</a></li>
<li><a href="#L649" title="Defined at 649.">cleanSomeSlots</a></li>
<li><a href="#L670" title="Defined at 670.">rehash</a></li>
<li><a href="#L681" title="Defined at 681.">resize</a></li>
<li><a href="#L712" title="Defined at 712.">expungeStaleEntries</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1997, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.lang;
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.lang.ref.*;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.Objects;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.util.concurrent.atomic.AtomicInteger;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.util.function.Supplier;
<a id="L31" name="L31"></a>  31 
<div class="comment">
  This class provides thread-local variables.  These variables differ from
  their normal counterparts in that each thread that accesses one (via its
  <code>get</code> or <code>set</code> method) has its own, independently initialized
  copy of the variable.  <code>ThreadLocal</code> instances are typically private
  static fields in classes that wish to associate state with a thread (e.g.,
  a user ID or Transaction ID).
  <p>For example, the class below generates unique identifiers local to each
  thread.
  A thread's id is assigned the first time it invokes <code>ThreadId.get()</code>
  and remains unchanged on subsequent calls.
  </p><pre>  import java.util.concurrent.atomic.AtomicInteger;
  public class ThreadId {
      // Atomic integer containing the next thread ID to be assigned
      private static final AtomicInteger nextId = new AtomicInteger(0);
      // Thread local variable containing each thread's ID
      private static final ThreadLocal&lt;Integer&gt; threadId =
          new ThreadLocal&lt;Integer&gt;() {
              @Override protected Integer initialValue() {
                  return nextId.getAndIncrement();
          }
      };
      // Returns the current thread's unique ID, assigning it if necessary
      public static int get() {
          return threadId.get();
      }
  }
  </pre>
  <p>Each thread holds an implicit reference to its copy of a thread-local
  variable as long as the thread is alive and the <code>ThreadLocal</code>
  instance is accessible; after a thread goes away, all of its copies of
  thread-local instances are subject to garbage collection (unless other
  references to these copies exist).
  @author  Josh Bloch and Doug Lea
  @since   1.2</p></div>
<a id="L74" name="L74"></a>  74 <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/8133.html" title="Multiple referred from 65 places.">ThreadLocal</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <em class="brace">{</em>
<div class="comment">
      ThreadLocals rely on per-thread linear-probe hash maps attached
      to each thread (Thread.threadLocals and
      inheritableThreadLocals).  The ThreadLocal objects act as keys,
      searched via threadLocalHashCode.  This is a custom hash code
      (useful only within ThreadLocalMaps) that eliminates collisions
      in the common case where consecutively constructed ThreadLocals
      are used by the same threads, while remaining well-behaved in
      less common cases.</div>
<a id="L85" name="L85"></a>  85     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> threadLocalHashCode = <a href="../S/1738.html#L104" title="Defined at 104 in src/java/lang/ThreadLocal.java.">nextHashCode</a>();
<a id="L86" name="L86"></a>  86 
<div class="comment">
      The next hash code to be given out. Updated atomically. Starts at
      zero.</div>
<a id="L91" name="L91"></a>  91     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1089.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicInteger.java.">AtomicInteger</a> <a href="../S/1738.html#L104" title="Defined at 104 in src/java/lang/ThreadLocal.java.">nextHashCode</a> =
<a id="L92" name="L92"></a>  92         <strong class="reserved">new</strong> <a href="../S/1089.html#L54" title="Defined at 54 in src/java/util/concurrent/atomic/AtomicInteger.java.">AtomicInteger</a>();
<a id="L93" name="L93"></a>  93 
<div class="comment">
      The difference between successively generated hash codes - turns
      implicit sequential thread-local IDs into near-optimally spread
      multiplicative hash values for power-of-two-sized tables.</div>
<a id="L99" name="L99"></a>  99     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> HASH_INCREMENT = 0x61c88647;
<a id="L100" name="L100"></a> 100 
<div class="comment">
      Returns the next hash code.</div>
<a id="L104" name="L104"></a> 104     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/23669.html" title="Multiple referred from 5 places.">nextHashCode</a>() <em class="brace">{</em>
<a id="L105" name="L105"></a> 105         <strong class="reserved">return</strong> <a href="../S/1738.html#L104" title="Defined at 104 in src/java/lang/ThreadLocal.java.">nextHashCode</a>.<a href="../D/16937.html" title="Multiple defined in 8 places.">getAndAdd</a>(HASH_INCREMENT);
<a id="L106" name="L106"></a> 106     <em class="brace">}</em>
<a id="L107" name="L107"></a> 107 
<div class="comment">
      Returns the current thread's "initial value" for this
      thread-local variable.  This method will be invoked the first
      time a thread accesses the variable with the <a href="#L159" title="Defined at 159.">get</a>
      method, unless the thread previously invoked the <a href="#L199" title="Defined at 199.">set</a>
      method, in which case the <code>initialValue</code> method will not
      be invoked for the thread.  Normally, this method is invoked at
      most once per thread, but it may be invoked again in case of
      subsequent invocations of <a href="#L219" title="Defined at 219.">remove</a> followed by <a href="#L159" title="Defined at 159.">get</a>.
      <p>This implementation simply returns <code>null</code>; if the
      programmer desires thread-local variables to have an initial
      value other than <code>null</code>, <code>ThreadLocal</code> must be
      subclassed, and this method overridden.  Typically, an
      anonymous inner class will be used.
      @return the initial value for this thread-local</p></div>
<a id="L126" name="L126"></a> 126     <strong class="reserved">protected</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../R/20680.html" title="Multiple referred from 271 places.">initialValue</a>() <em class="brace">{</em>
<a id="L127" name="L127"></a> 127         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L128" name="L128"></a> 128     <em class="brace">}</em>
<a id="L129" name="L129"></a> 129 
<div class="comment">
      Creates a thread local variable. The initial value of the variable is
      determined by invoking the <code>get</code> method on the <code>Supplier</code>.
      @param <s> the type of the thread local's value
      @param supplier the supplier to be used to determine the initial value
      @return a new thread local variable
      @throws NullPointerException if the specified supplier is null
      @since 1.8</s></div>
<a id="L140" name="L140"></a> 140     <strong class="reserved">public</strong> <strong class="reserved">static</strong> &lt;S&gt; <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;S&gt; withInitial(<a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;? <strong class="reserved">extends</strong> S&gt; <a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>) <em class="brace">{</em>
<a id="L141" name="L141"></a> 141         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1738.html#L274" title="Defined at 274 in src/java/lang/ThreadLocal.java.">SuppliedThreadLocal</a>&lt;&gt;(<a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>);
<a id="L142" name="L142"></a> 142     <em class="brace">}</em>
<a id="L143" name="L143"></a> 143 
<div class="comment">
      Creates a thread local variable.
      @see #withInitial(java.util.function.Supplier)</div>
<a id="L148" name="L148"></a> 148     <strong class="reserved">public</strong> ThreadLocal() <em class="brace">{</em>
<a id="L149" name="L149"></a> 149     <em class="brace">}</em>
<a id="L150" name="L150"></a> 150 
<div class="comment">
      Returns the value in the current thread's copy of this
      thread-local variable.  If the variable has no value for the
      current thread, it is first initialized to the value returned
      by an invocation of the <a href="#L126" title="Defined at 126.">initialValue</a> method.
      @return the current thread's value of this thread-local</div>
<a id="L159" name="L159"></a> 159     <strong class="reserved">public</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../R/14874.html" title="Multiple referred from 4230 places.">get</a>() <em class="brace">{</em>
<a id="L160" name="L160"></a> 160         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L161" name="L161"></a> 161         <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> = <a href="../D/20367.html" title="Multiple defined in 6 places.">getMap</a>(t);
<a id="L162" name="L162"></a> 162         <strong class="reserved">if</strong> (<a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L163" name="L163"></a> 163             <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a>.<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>.<a href="../D/18807.html" title="Multiple defined in 12 places.">getEntry</a>(<strong class="reserved">this</strong>);
<a id="L164" name="L164"></a> 164             <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L165" name="L165"></a> 165                 @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L166" name="L166"></a> 166                 <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = (<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>)e.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L167" name="L167"></a> 167                 <strong class="reserved">return</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>;
<a id="L168" name="L168"></a> 168             <em class="brace">}</em>
<a id="L169" name="L169"></a> 169         <em class="brace">}</em>
<a id="L170" name="L170"></a> 170         <strong class="reserved">return</strong> <a href="../D/32946.html" title="Multiple defined in 2 places.">setInitialValue</a>();
<a id="L171" name="L171"></a> 171     <em class="brace">}</em>
<a id="L172" name="L172"></a> 172 
<div class="comment">
      Variant of set() to establish initialValue. Used instead
      of set() in case user has overridden the set() method.
      @return the initial value</div>
<a id="L179" name="L179"></a> 179     <strong class="reserved">private</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../R/27569.html" title="Multiple referred from 3 places.">setInitialValue</a>() <em class="brace">{</em>
<a id="L180" name="L180"></a> 180         <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <a href="../D/24645.html" title="Multiple defined in 4 places.">initialValue</a>();
<a id="L181" name="L181"></a> 181         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L182" name="L182"></a> 182         <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> = <a href="../D/20367.html" title="Multiple defined in 6 places.">getMap</a>(t);
<a id="L183" name="L183"></a> 183         <strong class="reserved">if</strong> (<a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> != <strong class="reserved">null</strong>)
<a id="L184" name="L184"></a> 184             <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(<strong class="reserved">this</strong>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L185" name="L185"></a> 185         <strong class="reserved">else</strong>
<a id="L186" name="L186"></a> 186             <a href="../D/14030.html" title="Multiple defined in 3 places.">createMap</a>(t, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L187" name="L187"></a> 187         <strong class="reserved">return</strong> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L188" name="L188"></a> 188     <em class="brace">}</em>
<a id="L189" name="L189"></a> 189 
<div class="comment">
      Sets the current thread's copy of this thread-local variable
      to the specified value.  Most subclasses will have no need to
      override this method, relying solely on the <a href="#L126" title="Defined at 126.">initialValue</a>
      method to set the values of thread-locals.
      @param value the value to be stored in the current thread's copy of
             this thread-local.</div>
<a id="L199" name="L199"></a> 199     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/26855.html" title="Multiple referred from 752 places.">set</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>) <em class="brace">{</em>
<a id="L200" name="L200"></a> 200         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>();
<a id="L201" name="L201"></a> 201         <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> = <a href="../D/20367.html" title="Multiple defined in 6 places.">getMap</a>(t);
<a id="L202" name="L202"></a> 202         <strong class="reserved">if</strong> (<a href="../D/27441.html" title="Multiple defined in 12 places.">map</a> != <strong class="reserved">null</strong>)
<a id="L203" name="L203"></a> 203             <a href="../D/27441.html" title="Multiple defined in 12 places.">map</a>.<a href="../D/31832.html" title="Multiple defined in 134 places.">set</a>(<strong class="reserved">this</strong>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L204" name="L204"></a> 204         <strong class="reserved">else</strong>
<a id="L205" name="L205"></a> 205             <a href="../D/14030.html" title="Multiple defined in 3 places.">createMap</a>(t, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L206" name="L206"></a> 206     <em class="brace">}</em>
<a id="L207" name="L207"></a> 207 
<div class="comment">
      Removes the current thread's value for this thread-local
      variable.  If this thread-local variable is subsequently
      {@linkplain #get read} by the current thread, its value will be
      reinitialized by invoking its <a href="#L126" title="Defined at 126.">initialValue</a> method,
      unless its value is {@linkplain #set set} by the current thread
      in the interim.  This may result in multiple invocations of the
      <code>initialValue</code> method in the current thread.
      @since 1.5</div>
<a id="L219" name="L219"></a> 219      <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/25882.html" title="Multiple referred from 1115 places.">remove</a>() <em class="brace">{</em>
<a id="L220" name="L220"></a> 220          <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> m = <a href="../D/20367.html" title="Multiple defined in 6 places.">getMap</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>());
<a id="L221" name="L221"></a> 221          <strong class="reserved">if</strong> (m != <strong class="reserved">null</strong>)
<a id="L222" name="L222"></a> 222              m.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(<strong class="reserved">this</strong>);
<a id="L223" name="L223"></a> 223      <em class="brace">}</em>
<a id="L224" name="L224"></a> 224 
<div class="comment">
      Get the map associated with a ThreadLocal. Overridden in
      InheritableThreadLocal.
      @param  t the current thread
      @return the map</div>
<a id="L232" name="L232"></a> 232     <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> <a href="../R/17544.html" title="Multiple referred from 12 places.">getMap</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t) <em class="brace">{</em>
<a id="L233" name="L233"></a> 233         <strong class="reserved">return</strong> t.threadLocals;
<a id="L234" name="L234"></a> 234     <em class="brace">}</em>
<a id="L235" name="L235"></a> 235 
<div class="comment">
      Create the map associated with a ThreadLocal. Overridden in
      InheritableThreadLocal.
      @param t the current thread
      @param firstValue value for the initial entry of the map</div>
<a id="L243" name="L243"></a> 243     <strong class="reserved">void</strong> <a href="../R/12550.html" title="Multiple referred from 3 places.">createMap</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> firstValue) <em class="brace">{</em>
<a id="L244" name="L244"></a> 244         t.threadLocals = <strong class="reserved">new</strong> <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a>(<strong class="reserved">this</strong>, firstValue);
<a id="L245" name="L245"></a> 245     <em class="brace">}</em>
<a id="L246" name="L246"></a> 246 
<div class="comment">
      Factory method to create map of inherited thread locals.
      Designed to be called only from Thread constructor.
      @param  parentMap the map associated with parent thread
      @return a map containing the parent's inheritable bindings</div>
<a id="L254" name="L254"></a> 254     <strong class="reserved">static</strong> <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> <a href="../S/1769.html#L417" title="Referred from 417 in src/java/lang/Thread.java.">createInheritedMap</a>(<a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a> parentMap) <em class="brace">{</em>
<a id="L255" name="L255"></a> 255         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a>(parentMap);
<a id="L256" name="L256"></a> 256     <em class="brace">}</em>
<a id="L257" name="L257"></a> 257 
<div class="comment">
      Method childValue is visibly defined in subclass
      InheritableThreadLocal, but is internally defined here for the
      sake of providing createInheritedMap factory method without
      needing to subclass the map class in InheritableThreadLocal.
      This technique is preferable to the alternative of embedding
      instanceof tests in methods.</div>
<a id="L266" name="L266"></a> 266     <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../R/11432.html" title="Multiple referred from 4 places.">childValue</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> parentValue) <em class="brace">{</em>
<a id="L267" name="L267"></a> 267         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L268" name="L268"></a> 268     <em class="brace">}</em>
<a id="L269" name="L269"></a> 269 
<div class="comment">
      An extension of ThreadLocal that obtains its initial value from
      the specified <code>Supplier</code>.</div>
<a id="L274" name="L274"></a> 274     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../S/1738.html#L141" title="Referred from 141 in src/java/lang/ThreadLocal.java.">SuppliedThreadLocal</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">extends</strong> <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <em class="brace">{</em>
<a id="L275" name="L275"></a> 275 
<a id="L276" name="L276"></a> 276         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;? <strong class="reserved">extends</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>;
<a id="L277" name="L277"></a> 277 
<a id="L278" name="L278"></a> 278         SuppliedThreadLocal(<a href="../S/949.html#L41" title="Defined at 41 in src/java/util/function/Supplier.java.">Supplier</a>&lt;? <strong class="reserved">extends</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>) <em class="brace">{</em>
<a id="L279" name="L279"></a> 279             <strong class="reserved">this</strong>.<a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a> = <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>);
<a id="L280" name="L280"></a> 280         <em class="brace">}</em>
<a id="L281" name="L281"></a> 281 
<a id="L282" name="L282"></a> 282         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L283" name="L283"></a> 283         <strong class="reserved">protected</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> <a href="../R/20680.html" title="Multiple referred from 271 places.">initialValue</a>() <em class="brace">{</em>
<a id="L284" name="L284"></a> 284             <strong class="reserved">return</strong> <a href="../D/35051.html" title="Multiple defined in 2 places.">supplier</a>.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L285" name="L285"></a> 285         <em class="brace">}</em>
<a id="L286" name="L286"></a> 286     <em class="brace">}</em>
<a id="L287" name="L287"></a> 287 
<div class="comment">
      ThreadLocalMap is a customized hash map suitable only for
      maintaining thread local values. No operations are exported
      outside of the ThreadLocal class. The class is package private to
      allow declaration of fields in class Thread.  To help deal with
      very large and long-lived usages, the hash table entries use
      WeakReferences for keys. However, since reference queues are not
      used, stale entries are guaranteed to be removed only when
      the table starts running out of space.</div>
<a id="L298" name="L298"></a> 298     <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/8135.html" title="Multiple referred from 14 places.">ThreadLocalMap</a> <em class="brace">{</em>
<a id="L299" name="L299"></a> 299 
<div class="comment">
          The entries in this hash map extend WeakReference, using
          its main ref field as the key (which is always a
          ThreadLocal object).  Note that null keys (i.e. entry.get()
          == null) mean that the key is no longer referenced, so the
          entry can be expunged from table.  Such entries are referred to
          as "stale entries" in the code that follows.</div>
<a id="L308" name="L308"></a> 308         <strong class="reserved">static</strong> <strong class="reserved">class</strong> <a href="../R/2694.html" title="Multiple referred from 1260 places.">Entry</a> <strong class="reserved">extends</strong> <a href="../S/1569.html#L48" title="Defined at 48 in src/java/lang/ref/WeakReference.java.">WeakReference</a>&lt;<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt;&gt; <em class="brace">{</em>
<div class="comment">
             /** The value associated with this ThreadLocal. */</div>
<a id="L310" name="L310"></a> 310             <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L311" name="L311"></a> 311 
<a id="L312" name="L312"></a> 312             Entry(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; k, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> v) <em class="brace">{</em>
<a id="L313" name="L313"></a> 313                 <strong class="reserved">super</strong>(k);
<a id="L314" name="L314"></a> 314                 <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = v;
<a id="L315" name="L315"></a> 315             <em class="brace">}</em>
<a id="L316" name="L316"></a> 316         <em class="brace">}</em>
<a id="L317" name="L317"></a> 317 
<div class="comment">
          The initial capacity -- MUST be a power of two.</div>
<a id="L321" name="L321"></a> 321         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> INITIAL_CAPACITY = 16;
<a id="L322" name="L322"></a> 322 
<div class="comment">
          The table, resized as necessary.
          table.length MUST always be a power of two.</div>
<a id="L327" name="L327"></a> 327         <strong class="reserved">private</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] table;
<a id="L328" name="L328"></a> 328 
<div class="comment">
          The number of entries in the table.</div>
<a id="L332" name="L332"></a> 332         <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = 0;
<a id="L333" name="L333"></a> 333 
<div class="comment">
          The next size value at which to resize.</div>
<a id="L337" name="L337"></a> 337         <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../S/4096.html#L74" title="Defined at 74 in src/javax/xml/ws/soap/MTOM.java.">threshold</a>; <em class="comment">// Default to 0</em>
<a id="L338" name="L338"></a> 338 
<div class="comment">
          Set the resize threshold to maintain at worst a 2/3 load factor.</div>
<a id="L342" name="L342"></a> 342         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/28284.html" title="Multiple referred from 13 places.">setThreshold</a>(<strong class="reserved">int</strong> len) <em class="brace">{</em>
<a id="L343" name="L343"></a> 343             <a href="../S/4096.html#L74" title="Defined at 74 in src/javax/xml/ws/soap/MTOM.java.">threshold</a> = len * 2 / 3;
<a id="L344" name="L344"></a> 344         <em class="brace">}</em>
<a id="L345" name="L345"></a> 345 
<div class="comment">
          Increment i modulo len.</div>
<a id="L349" name="L349"></a> 349         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/23670.html" title="Multiple referred from 93 places.">nextIndex</a>(<strong class="reserved">int</strong> i, <strong class="reserved">int</strong> len) <em class="brace">{</em>
<a id="L350" name="L350"></a> 350             <strong class="reserved">return</strong> ((i + 1 &lt; len) ? i + 1 : 0);
<a id="L351" name="L351"></a> 351         <em class="brace">}</em>
<a id="L352" name="L352"></a> 352 
<div class="comment">
          Decrement i modulo len.</div>
<a id="L356" name="L356"></a> 356         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">int</strong> <a href="../R/24958.html" title="Multiple referred from 22 places.">prevIndex</a>(<strong class="reserved">int</strong> i, <strong class="reserved">int</strong> len) <em class="brace">{</em>
<a id="L357" name="L357"></a> 357             <strong class="reserved">return</strong> ((i - 1 &gt;= 0) ? i - 1 : len - 1);
<a id="L358" name="L358"></a> 358         <em class="brace">}</em>
<a id="L359" name="L359"></a> 359 
<div class="comment">
          Construct a new map initially containing (firstKey, firstValue).
          ThreadLocalMaps are constructed lazily, so we only create
          one when we have at least one entry to put in it.</div>
<a id="L365" name="L365"></a> 365         ThreadLocalMap(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; <a href="../D/16406.html" title="Multiple defined in 10 places.">firstKey</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> firstValue) <em class="brace">{</em>
<a id="L366" name="L366"></a> 366             table = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[INITIAL_CAPACITY];
<a id="L367" name="L367"></a> 367             <strong class="reserved">int</strong> i = <a href="../D/16406.html" title="Multiple defined in 10 places.">firstKey</a>.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);
<a id="L368" name="L368"></a> 368             table[i] = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>(<a href="../D/16406.html" title="Multiple defined in 10 places.">firstKey</a>, firstValue);
<a id="L369" name="L369"></a> 369             <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = 1;
<a id="L370" name="L370"></a> 370             <a href="../D/34120.html" title="Multiple defined in 4 places.">setThreshold</a>(INITIAL_CAPACITY);
<a id="L371" name="L371"></a> 371         <em class="brace">}</em>
<a id="L372" name="L372"></a> 372 
<div class="comment">
          Construct a new map including all Inheritable ThreadLocals
          from given parent map. Called only by createInheritedMap.
          @param parentMap the map associated with parent thread.</div>
<a id="L379" name="L379"></a> 379         <strong class="reserved">private</strong> <a href="../S/1738.html#L298" title="Defined at 298 in src/java/lang/ThreadLocal.java.">ThreadLocalMap</a>(ThreadLocalMap parentMap) <em class="brace">{</em>
<a id="L380" name="L380"></a> 380             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] parentTable = parentMap.table;
<a id="L381" name="L381"></a> 381             <strong class="reserved">int</strong> len = parentTable.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L382" name="L382"></a> 382             <a href="../D/34120.html" title="Multiple defined in 4 places.">setThreshold</a>(len);
<a id="L383" name="L383"></a> 383             table = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[len];
<a id="L384" name="L384"></a> 384 
<a id="L385" name="L385"></a> 385             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; len; j++) <em class="brace">{</em>
<a id="L386" name="L386"></a> 386                 <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = parentTable[j];
<a id="L387" name="L387"></a> 387                 <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L388" name="L388"></a> 388                     @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L389" name="L389"></a> 389                     <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt; <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a> = (<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>&gt;) e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L390" name="L390"></a> 390                     <strong class="reserved">if</strong> (<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L391" name="L391"></a> 391                         <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>.<a href="../D/12743.html" title="Multiple defined in 2 places.">childValue</a>(e.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L392" name="L392"></a> 392                         <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L393" name="L393"></a> 393                         <strong class="reserved">int</strong> h = <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>.threadLocalHashCode &amp; (len - 1);
<a id="L394" name="L394"></a> 394                         <strong class="reserved">while</strong> (table[h] != <strong class="reserved">null</strong>)
<a id="L395" name="L395"></a> 395                             h = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(h, len);
<a id="L396" name="L396"></a> 396                         table[h] = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a>;
<a id="L397" name="L397"></a> 397                         <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>++;
<a id="L398" name="L398"></a> 398                     <em class="brace">}</em>
<a id="L399" name="L399"></a> 399                 <em class="brace">}</em>
<a id="L400" name="L400"></a> 400             <em class="brace">}</em>
<a id="L401" name="L401"></a> 401         <em class="brace">}</em>
<a id="L402" name="L402"></a> 402 
<div class="comment">
          Get the entry associated with key.  This method
          itself handles only the fast path: a direct hit of existing
          key. It otherwise relays to getEntryAfterMiss.  This is
          designed to maximize performance for direct hits, in part
          by making this method readily inlinable.
          @param  key the thread local object
          @return the entry associated with key, or null if no such</div>
<a id="L413" name="L413"></a> 413         <strong class="reserved">private</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> <a href="../R/16396.html" title="Multiple referred from 29 places.">getEntry</a>(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>) <em class="brace">{</em>
<a id="L414" name="L414"></a> 414             <strong class="reserved">int</strong> i = <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>.threadLocalHashCode &amp; (table.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> - 1);
<a id="L415" name="L415"></a> 415             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = table[i];
<a id="L416" name="L416"></a> 416             <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong> &amp;&amp; e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() == <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>)
<a id="L417" name="L417"></a> 417                 <strong class="reserved">return</strong> e;
<a id="L418" name="L418"></a> 418             <strong class="reserved">else</strong>
<a id="L419" name="L419"></a> 419                 <strong class="reserved">return</strong> <a href="../S/1738.html#L431" title="Defined at 431 in src/java/lang/ThreadLocal.java.">getEntryAfterMiss</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, i, e);
<a id="L420" name="L420"></a> 420         <em class="brace">}</em>
<a id="L421" name="L421"></a> 421 
<div class="comment">
          Version of getEntry method for use when key is not found in
          its direct hash slot.
          @param  key the thread local object
          @param  i the table index for key's hash code
          @param  e the entry at table[i]
          @return the entry associated with key, or null if no such</div>
<a id="L431" name="L431"></a> 431         <strong class="reserved">private</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> <a href="../S/1738.html#L419" title="Referred from 419 in src/java/lang/ThreadLocal.java.">getEntryAfterMiss</a>(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <strong class="reserved">int</strong> i, <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e) <em class="brace">{</em>
<a id="L432" name="L432"></a> 432             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L433" name="L433"></a> 433             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L434" name="L434"></a> 434 
<a id="L435" name="L435"></a> 435             <strong class="reserved">while</strong> (e != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L436" name="L436"></a> 436                 <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; k = e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L437" name="L437"></a> 437                 <strong class="reserved">if</strong> (k == <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>)
<a id="L438" name="L438"></a> 438                     <strong class="reserved">return</strong> e;
<a id="L439" name="L439"></a> 439                 <strong class="reserved">if</strong> (k == <strong class="reserved">null</strong>)
<a id="L440" name="L440"></a> 440                     <a href="../S/1738.html#L589" title="Defined at 589 in src/java/lang/ThreadLocal.java.">expungeStaleEntry</a>(i);
<a id="L441" name="L441"></a> 441                 <strong class="reserved">else</strong>
<a id="L442" name="L442"></a> 442                     i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(i, len);
<a id="L443" name="L443"></a> 443                 e = tab[i];
<a id="L444" name="L444"></a> 444             <em class="brace">}</em>
<a id="L445" name="L445"></a> 445             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L446" name="L446"></a> 446         <em class="brace">}</em>
<a id="L447" name="L447"></a> 447 
<div class="comment">
          Set the value associated with key.
          @param key the thread local object
          @param value the value to be set</div>
<a id="L454" name="L454"></a> 454         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/26855.html" title="Multiple referred from 752 places.">set</a>(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>) <em class="brace">{</em>
<a id="L455" name="L455"></a> 455 
<a id="L456" name="L456"></a> 456             <em class="comment">// We don't use a fast path as with get() because it is at</em>
<a id="L457" name="L457"></a> 457             <em class="comment">// least as common to use set() to create new entries as</em>
<a id="L458" name="L458"></a> 458             <em class="comment">// it is to replace existing ones, in which case, a fast</em>
<a id="L459" name="L459"></a> 459             <em class="comment">// path would fail more often than not.</em>
<a id="L460" name="L460"></a> 460 
<a id="L461" name="L461"></a> 461             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L462" name="L462"></a> 462             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L463" name="L463"></a> 463             <strong class="reserved">int</strong> i = <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>.threadLocalHashCode &amp; (len-1);
<a id="L464" name="L464"></a> 464 
<a id="L465" name="L465"></a> 465             <strong class="reserved">for</strong> (<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = tab[i];
<a id="L466" name="L466"></a> 466                  e != <strong class="reserved">null</strong>;
<a id="L467" name="L467"></a> 467                  e = tab[i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(i, len)]) <em class="brace">{</em>
<a id="L468" name="L468"></a> 468                 <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; k = e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L469" name="L469"></a> 469 
<a id="L470" name="L470"></a> 470                 <strong class="reserved">if</strong> (k == <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>) <em class="brace">{</em>
<a id="L471" name="L471"></a> 471                     e.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L472" name="L472"></a> 472                     <strong class="reserved">return</strong>;
<a id="L473" name="L473"></a> 473                 <em class="brace">}</em>
<a id="L474" name="L474"></a> 474 
<a id="L475" name="L475"></a> 475                 <strong class="reserved">if</strong> (k == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L476" name="L476"></a> 476                     <a href="../S/1738.html#L520" title="Defined at 520 in src/java/lang/ThreadLocal.java.">replaceStaleEntry</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>, i);
<a id="L477" name="L477"></a> 477                     <strong class="reserved">return</strong>;
<a id="L478" name="L478"></a> 478                 <em class="brace">}</em>
<a id="L479" name="L479"></a> 479             <em class="brace">}</em>
<a id="L480" name="L480"></a> 480 
<a id="L481" name="L481"></a> 481             tab[i] = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L482" name="L482"></a> 482             <strong class="reserved">int</strong> sz = ++<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>;
<a id="L483" name="L483"></a> 483             <strong class="reserved">if</strong> (!<a href="../S/1738.html#L649" title="Defined at 649 in src/java/lang/ThreadLocal.java.">cleanSomeSlots</a>(i, sz) &amp;&amp; sz &gt;= <a href="../S/4096.html#L74" title="Defined at 74 in src/javax/xml/ws/soap/MTOM.java.">threshold</a>)
<a id="L484" name="L484"></a> 484                 <a href="../D/30620.html" title="Multiple defined in 6 places.">rehash</a>();
<a id="L485" name="L485"></a> 485         <em class="brace">}</em>
<a id="L486" name="L486"></a> 486 
<div class="comment">
          Remove the entry for key.</div>
<a id="L490" name="L490"></a> 490         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25882.html" title="Multiple referred from 1115 places.">remove</a>(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>) <em class="brace">{</em>
<a id="L491" name="L491"></a> 491             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L492" name="L492"></a> 492             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L493" name="L493"></a> 493             <strong class="reserved">int</strong> i = <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>.threadLocalHashCode &amp; (len-1);
<a id="L494" name="L494"></a> 494             <strong class="reserved">for</strong> (<a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = tab[i];
<a id="L495" name="L495"></a> 495                  e != <strong class="reserved">null</strong>;
<a id="L496" name="L496"></a> 496                  e = tab[i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(i, len)]) <em class="brace">{</em>
<a id="L497" name="L497"></a> 497                 <strong class="reserved">if</strong> (e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() == <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>) <em class="brace">{</em>
<a id="L498" name="L498"></a> 498                     e.<a href="../D/12817.html" title="Multiple defined in 199 places.">clear</a>();
<a id="L499" name="L499"></a> 499                     <a href="../S/1738.html#L589" title="Defined at 589 in src/java/lang/ThreadLocal.java.">expungeStaleEntry</a>(i);
<a id="L500" name="L500"></a> 500                     <strong class="reserved">return</strong>;
<a id="L501" name="L501"></a> 501                 <em class="brace">}</em>
<a id="L502" name="L502"></a> 502             <em class="brace">}</em>
<a id="L503" name="L503"></a> 503         <em class="brace">}</em>
<a id="L504" name="L504"></a> 504 
<div class="comment">
          Replace a stale entry encountered during a set operation
          with an entry for the specified key.  The value passed in
          the value parameter is stored in the entry, whether or not
          an entry already exists for the specified key.
          As a side effect, this method expunges all stale entries in the
          "run" containing the stale entry.  (A run is a sequence of entries
          between two null slots.)
          @param  key the key
          @param  value the value to be associated with key
          @param  staleSlot index of the first stale entry encountered while
                  searching for key.</div>
<a id="L520" name="L520"></a> 520         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../S/1738.html#L476" title="Referred from 476 in src/java/lang/ThreadLocal.java.">replaceStaleEntry</a>(<a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>,
<a id="L521" name="L521"></a> 521                                        <strong class="reserved">int</strong> staleSlot) <em class="brace">{</em>
<a id="L522" name="L522"></a> 522             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L523" name="L523"></a> 523             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L524" name="L524"></a> 524             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e;
<a id="L525" name="L525"></a> 525 
<a id="L526" name="L526"></a> 526             <em class="comment">// Back up to check for prior stale entry in current run.</em>
<a id="L527" name="L527"></a> 527             <em class="comment">// We clean out whole runs at a time to avoid continual</em>
<a id="L528" name="L528"></a> 528             <em class="comment">// incremental rehashing due to garbage collector freeing</em>
<a id="L529" name="L529"></a> 529             <em class="comment">// up refs in bunches (i.e., whenever the collector runs).</em>
<a id="L530" name="L530"></a> 530             <strong class="reserved">int</strong> slotToExpunge = staleSlot;
<a id="L531" name="L531"></a> 531             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../S/1738.html#L356" title="Defined at 356 in src/java/lang/ThreadLocal.java.">prevIndex</a>(staleSlot, len);
<a id="L532" name="L532"></a> 532                  (e = tab[i]) != <strong class="reserved">null</strong>;
<a id="L533" name="L533"></a> 533                  i = <a href="../S/1738.html#L356" title="Defined at 356 in src/java/lang/ThreadLocal.java.">prevIndex</a>(i, len))
<a id="L534" name="L534"></a> 534                 <strong class="reserved">if</strong> (e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() == <strong class="reserved">null</strong>)
<a id="L535" name="L535"></a> 535                     slotToExpunge = i;
<a id="L536" name="L536"></a> 536 
<a id="L537" name="L537"></a> 537             <em class="comment">// Find either the key or trailing null slot of run, whichever</em>
<a id="L538" name="L538"></a> 538             <em class="comment">// occurs first</em>
<a id="L539" name="L539"></a> 539             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(staleSlot, len);
<a id="L540" name="L540"></a> 540                  (e = tab[i]) != <strong class="reserved">null</strong>;
<a id="L541" name="L541"></a> 541                  i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(i, len)) <em class="brace">{</em>
<a id="L542" name="L542"></a> 542                 <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; k = e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L543" name="L543"></a> 543 
<a id="L544" name="L544"></a> 544                 <em class="comment">// If we find key, then we need to swap it</em>
<a id="L545" name="L545"></a> 545                 <em class="comment">// with the stale entry to maintain hash table order.</em>
<a id="L546" name="L546"></a> 546                 <em class="comment">// The newly stale slot, or any other stale slot</em>
<a id="L547" name="L547"></a> 547                 <em class="comment">// encountered above it, can then be sent to expungeStaleEntry</em>
<a id="L548" name="L548"></a> 548                 <em class="comment">// to remove or rehash all of the other entries in run.</em>
<a id="L549" name="L549"></a> 549                 <strong class="reserved">if</strong> (k == <a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>) <em class="brace">{</em>
<a id="L550" name="L550"></a> 550                     e.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>;
<a id="L551" name="L551"></a> 551 
<a id="L552" name="L552"></a> 552                     tab[i] = tab[staleSlot];
<a id="L553" name="L553"></a> 553                     tab[staleSlot] = e;
<a id="L554" name="L554"></a> 554 
<a id="L555" name="L555"></a> 555                     <em class="comment">// Start expunge at preceding stale entry if it exists</em>
<a id="L556" name="L556"></a> 556                     <strong class="reserved">if</strong> (slotToExpunge == staleSlot)
<a id="L557" name="L557"></a> 557                         slotToExpunge = i;
<a id="L558" name="L558"></a> 558                     <a href="../S/1738.html#L649" title="Defined at 649 in src/java/lang/ThreadLocal.java.">cleanSomeSlots</a>(<a href="../S/1738.html#L589" title="Defined at 589 in src/java/lang/ThreadLocal.java.">expungeStaleEntry</a>(slotToExpunge), len);
<a id="L559" name="L559"></a> 559                     <strong class="reserved">return</strong>;
<a id="L560" name="L560"></a> 560                 <em class="brace">}</em>
<a id="L561" name="L561"></a> 561 
<a id="L562" name="L562"></a> 562                 <em class="comment">// If we didn't find stale entry on backward scan, the</em>
<a id="L563" name="L563"></a> 563                 <em class="comment">// first stale entry seen while scanning for key is the</em>
<a id="L564" name="L564"></a> 564                 <em class="comment">// first still present in the run.</em>
<a id="L565" name="L565"></a> 565                 <strong class="reserved">if</strong> (k == <strong class="reserved">null</strong> &amp;&amp; slotToExpunge == staleSlot)
<a id="L566" name="L566"></a> 566                     slotToExpunge = i;
<a id="L567" name="L567"></a> 567             <em class="brace">}</em>
<a id="L568" name="L568"></a> 568 
<a id="L569" name="L569"></a> 569             <em class="comment">// If key not found, put new entry in stale slot</em>
<a id="L570" name="L570"></a> 570             tab[staleSlot].<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <strong class="reserved">null</strong>;
<a id="L571" name="L571"></a> 571             tab[staleSlot] = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>(<a href="../D/26706.html" title="Multiple defined in 2 places.">key</a>, <a href="../D/36360.html" title="Multiple defined in 73 places.">value</a>);
<a id="L572" name="L572"></a> 572 
<a id="L573" name="L573"></a> 573             <em class="comment">// If there are any other stale entries in run, expunge them</em>
<a id="L574" name="L574"></a> 574             <strong class="reserved">if</strong> (slotToExpunge != staleSlot)
<a id="L575" name="L575"></a> 575                 <a href="../S/1738.html#L649" title="Defined at 649 in src/java/lang/ThreadLocal.java.">cleanSomeSlots</a>(<a href="../S/1738.html#L589" title="Defined at 589 in src/java/lang/ThreadLocal.java.">expungeStaleEntry</a>(slotToExpunge), len);
<a id="L576" name="L576"></a> 576         <em class="brace">}</em>
<a id="L577" name="L577"></a> 577 
<div class="comment">
          Expunge a stale entry by rehashing any possibly colliding entries
          lying between staleSlot and the next null slot.  This also expunges
          any other stale entries encountered before the trailing null.  See
          Knuth, Section 6.4
          @param staleSlot index of slot known to have null key
          @return the index of the next null slot after staleSlot
          (all between staleSlot and this slot will have been checked
          for expunging).</div>
<a id="L589" name="L589"></a> 589         <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/14175.html" title="Multiple referred from 6 places.">expungeStaleEntry</a>(<strong class="reserved">int</strong> staleSlot) <em class="brace">{</em>
<a id="L590" name="L590"></a> 590             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L591" name="L591"></a> 591             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L592" name="L592"></a> 592 
<a id="L593" name="L593"></a> 593             <em class="comment">// expunge entry at staleSlot</em>
<a id="L594" name="L594"></a> 594             tab[staleSlot].<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <strong class="reserved">null</strong>;
<a id="L595" name="L595"></a> 595             tab[staleSlot] = <strong class="reserved">null</strong>;
<a id="L596" name="L596"></a> 596             <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>--;
<a id="L597" name="L597"></a> 597 
<a id="L598" name="L598"></a> 598             <em class="comment">// Rehash until we encounter null</em>
<a id="L599" name="L599"></a> 599             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e;
<a id="L600" name="L600"></a> 600             <strong class="reserved">int</strong> i;
<a id="L601" name="L601"></a> 601             <strong class="reserved">for</strong> (i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(staleSlot, len);
<a id="L602" name="L602"></a> 602                  (e = tab[i]) != <strong class="reserved">null</strong>;
<a id="L603" name="L603"></a> 603                  i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(i, len)) <em class="brace">{</em>
<a id="L604" name="L604"></a> 604                 <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; k = e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L605" name="L605"></a> 605                 <strong class="reserved">if</strong> (k == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L606" name="L606"></a> 606                     e.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <strong class="reserved">null</strong>;
<a id="L607" name="L607"></a> 607                     tab[i] = <strong class="reserved">null</strong>;
<a id="L608" name="L608"></a> 608                     <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>--;
<a id="L609" name="L609"></a> 609                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L610" name="L610"></a> 610                     <strong class="reserved">int</strong> h = k.threadLocalHashCode &amp; (len - 1);
<a id="L611" name="L611"></a> 611                     <strong class="reserved">if</strong> (h != i) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612                         tab[i] = <strong class="reserved">null</strong>;
<a id="L613" name="L613"></a> 613 
<a id="L614" name="L614"></a> 614                         <em class="comment">// Unlike Knuth 6.4 Algorithm R, we must scan until</em>
<a id="L615" name="L615"></a> 615                         <em class="comment">// null because multiple entries could have been stale.</em>
<a id="L616" name="L616"></a> 616                         <strong class="reserved">while</strong> (tab[h] != <strong class="reserved">null</strong>)
<a id="L617" name="L617"></a> 617                             h = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(h, len);
<a id="L618" name="L618"></a> 618                         tab[h] = e;
<a id="L619" name="L619"></a> 619                     <em class="brace">}</em>
<a id="L620" name="L620"></a> 620                 <em class="brace">}</em>
<a id="L621" name="L621"></a> 621             <em class="brace">}</em>
<a id="L622" name="L622"></a> 622             <strong class="reserved">return</strong> i;
<a id="L623" name="L623"></a> 623         <em class="brace">}</em>
<a id="L624" name="L624"></a> 624 
<div class="comment">
          Heuristically scan some cells looking for stale entries.
          This is invoked when either a new element is added, or
          another stale one has been expunged. It performs a
          logarithmic number of scans, as a balance between no
          scanning (fast but retains garbage) and a number of scans
          proportional to number of elements, that would find all
          garbage but would cause some insertions to take O(n) time.
          @param i a position known NOT to hold a stale entry. The
          scan starts at the element after i.
          @param n scan control: <code>log2(n)</code> cells are scanned,
          unless a stale entry is found, in which case
          <code>log2(table.length)-1</code> additional cells are scanned.
          When called from insertions, this parameter is the number
          of elements, but when from replaceStaleEntry, it is the
          table length. (Note: all this could be changed to be either
          more or less aggressive by weighting n instead of just
          using straight log n. But this version is simple, fast, and
          seems to work well.)
          @return true if any stale entries have been removed.</div>
<a id="L649" name="L649"></a> 649         <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/11483.html" title="Multiple referred from 3 places.">cleanSomeSlots</a>(<strong class="reserved">int</strong> i, <strong class="reserved">int</strong> n) <em class="brace">{</em>
<a id="L650" name="L650"></a> 650             <strong class="reserved">boolean</strong> removed = <strong class="reserved">false</strong>;
<a id="L651" name="L651"></a> 651             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L652" name="L652"></a> 652             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L653" name="L653"></a> 653             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L654" name="L654"></a> 654                 i = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(i, len);
<a id="L655" name="L655"></a> 655                 <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = tab[i];
<a id="L656" name="L656"></a> 656                 <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong> &amp;&amp; e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L657" name="L657"></a> 657                     n = len;
<a id="L658" name="L658"></a> 658                     removed = <strong class="reserved">true</strong>;
<a id="L659" name="L659"></a> 659                     i = <a href="../S/1738.html#L589" title="Defined at 589 in src/java/lang/ThreadLocal.java.">expungeStaleEntry</a>(i);
<a id="L660" name="L660"></a> 660                 <em class="brace">}</em>
<a id="L661" name="L661"></a> 661             <em class="brace">}</em> <strong class="reserved">while</strong> ( (n &gt;&gt;&gt;= 1) != 0);
<a id="L662" name="L662"></a> 662             <strong class="reserved">return</strong> removed;
<a id="L663" name="L663"></a> 663         <em class="brace">}</em>
<a id="L664" name="L664"></a> 664 
<div class="comment">
          Re-pack and/or re-size the table. First scan the entire
          table removing stale entries. If this doesn't sufficiently
          shrink the size of the table, double the table size.</div>
<a id="L670" name="L670"></a> 670         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/25834.html" title="Multiple referred from 6 places.">rehash</a>() <em class="brace">{</em>
<a id="L671" name="L671"></a> 671             <a href="../D/15897.html" title="Multiple defined in 3 places.">expungeStaleEntries</a>();
<a id="L672" name="L672"></a> 672 
<a id="L673" name="L673"></a> 673             <em class="comment">// Use lower threshold for doubling to avoid hysteresis</em>
<a id="L674" name="L674"></a> 674             <strong class="reserved">if</strong> (<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> &gt;= <a href="../S/4096.html#L74" title="Defined at 74 in src/javax/xml/ws/soap/MTOM.java.">threshold</a> - <a href="../S/4096.html#L74" title="Defined at 74 in src/javax/xml/ws/soap/MTOM.java.">threshold</a> / 4)
<a id="L675" name="L675"></a> 675                 <a href="../D/31231.html" title="Multiple defined in 41 places.">resize</a>();
<a id="L676" name="L676"></a> 676         <em class="brace">}</em>
<a id="L677" name="L677"></a> 677 
<div class="comment">
          Double the capacity of the table.</div>
<a id="L681" name="L681"></a> 681         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/26311.html" title="Multiple referred from 88 places.">resize</a>() <em class="brace">{</em>
<a id="L682" name="L682"></a> 682             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] oldTab = table;
<a id="L683" name="L683"></a> 683             <strong class="reserved">int</strong> oldLen = oldTab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L684" name="L684"></a> 684             <strong class="reserved">int</strong> newLen = oldLen * 2;
<a id="L685" name="L685"></a> 685             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] newTab = <strong class="reserved">new</strong> <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[newLen];
<a id="L686" name="L686"></a> 686             <strong class="reserved">int</strong> <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a> = 0;
<a id="L687" name="L687"></a> 687 
<a id="L688" name="L688"></a> 688             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; oldLen; ++j) <em class="brace">{</em>
<a id="L689" name="L689"></a> 689                 <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = oldTab[j];
<a id="L690" name="L690"></a> 690                 <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L691" name="L691"></a> 691                     <a href="../S/1738.html#L74" title="Defined at 74 in src/java/lang/ThreadLocal.java.">ThreadLocal</a>&lt;?&gt; k = e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L692" name="L692"></a> 692                     <strong class="reserved">if</strong> (k == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L693" name="L693"></a> 693                         e.<a href="../D/36360.html" title="Multiple defined in 73 places.">value</a> = <strong class="reserved">null</strong>; <em class="comment">// Help the GC</em>
<a id="L694" name="L694"></a> 694                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L695" name="L695"></a> 695                         <strong class="reserved">int</strong> h = k.threadLocalHashCode &amp; (newLen - 1);
<a id="L696" name="L696"></a> 696                         <strong class="reserved">while</strong> (newTab[h] != <strong class="reserved">null</strong>)
<a id="L697" name="L697"></a> 697                             h = <a href="../D/28157.html" title="Multiple defined in 12 places.">nextIndex</a>(h, newLen);
<a id="L698" name="L698"></a> 698                         newTab[h] = e;
<a id="L699" name="L699"></a> 699                         <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>++;
<a id="L700" name="L700"></a> 700                     <em class="brace">}</em>
<a id="L701" name="L701"></a> 701                 <em class="brace">}</em>
<a id="L702" name="L702"></a> 702             <em class="brace">}</em>
<a id="L703" name="L703"></a> 703 
<a id="L704" name="L704"></a> 704             <a href="../D/34120.html" title="Multiple defined in 4 places.">setThreshold</a>(newLen);
<a id="L705" name="L705"></a> 705             <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> = <a href="../D/13557.html" title="Multiple defined in 24 places.">count</a>;
<a id="L706" name="L706"></a> 706             table = newTab;
<a id="L707" name="L707"></a> 707         <em class="brace">}</em>
<a id="L708" name="L708"></a> 708 
<div class="comment">
          Expunge all stale entries in the table.</div>
<a id="L712" name="L712"></a> 712         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/14174.html" title="Multiple referred from 7 places.">expungeStaleEntries</a>() <em class="brace">{</em>
<a id="L713" name="L713"></a> 713             <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a>[] tab = table;
<a id="L714" name="L714"></a> 714             <strong class="reserved">int</strong> len = tab.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L715" name="L715"></a> 715             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; len; j++) <em class="brace">{</em>
<a id="L716" name="L716"></a> 716                 <a href="../D/2925.html" title="Multiple defined in 20 places.">Entry</a> e = tab[j];
<a id="L717" name="L717"></a> 717                 <strong class="reserved">if</strong> (e != <strong class="reserved">null</strong> &amp;&amp; e.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>() == <strong class="reserved">null</strong>)
<a id="L718" name="L718"></a> 718                     <a href="../S/1738.html#L589" title="Defined at 589 in src/java/lang/ThreadLocal.java.">expungeStaleEntry</a>(j);
<a id="L719" name="L719"></a> 719             <em class="brace">}</em>
<a id="L720" name="L720"></a> 720         <em class="brace">}</em>
<a id="L721" name="L721"></a> 721     <em class="brace">}</em>
<a id="L722" name="L722"></a> 722 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L104">[^]</a><a href="#L712">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>