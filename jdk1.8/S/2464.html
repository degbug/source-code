<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/text/MergeCollation.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L79">[^]</a><a href="#L302">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L79" title="Defined at 79.">getPattern</a></li>
<li><a href="#L88" title="Defined at 88.">getPattern</a></li>
<li><a href="#L122" title="Defined at 122.">findLastWithNoExtension</a></li>
<li><a href="#L137" title="Defined at 137.">emitPattern</a></li>
<li><a href="#L148" title="Defined at 148.">emitPattern</a></li>
<li><a href="#L163" title="Defined at 163.">setPattern</a></li>
<li><a href="#L173" title="Defined at 173.">addPattern</a></li>
<li><a href="#L191" title="Defined at 191.">getCount</a></li>
<li><a href="#L200" title="Defined at 200.">getItemAt</a></li>
<li><a href="#L235" title="Defined at 235.">fixEntry</a></li>
<li><a href="#L302" title="Defined at 302.">findLastEntry</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1996, 2012, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<div class="comment">
  (C) Copyright Taligent, Inc. 1996, 1997 - All Rights Reserved
  (C) Copyright IBM Corp. 1996, 1997 - All Rights Reserved
    The original version of this source code and documentation is copyrighted
  and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These
  materials are provided under terms of a License Agreement between Taligent
  and Sun. This technology is protected by multiple US and International
  patents. This notice and attribution to Taligent may not be removed.
    Taligent is a registered trademark of Taligent, Inc.</div>
<a id="L38" name="L38"></a>  38 
<a id="L39" name="L39"></a>  39 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.<a href="../D/35255.html" title="Multiple defined in 4 places.">text</a>;
<a id="L40" name="L40"></a>  40 
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L42" name="L42"></a>  42 
<div class="comment">
  Utility class for normalizing and merging patterns for collation.
  Patterns are strings of the form <entry>*, where <entry> has the
  form:
  <pattern> := <entry>*
  <entry> := <separator><chars>{"/"<extension>}
  <separator> := "=", ",", ";", "&lt;", "&amp;"
  <chars>, and <extension> are both arbitrary strings.
  unquoted whitespaces are ignored.
  'xxx' can be used to quote characters
  One difference from Collator is that &amp; is used to reset to a current
  point. Or, in other words, it introduces a new sequence which is to
  be added to the old.
  That is: "a &lt; b &lt; c &lt; d" is the same as "a &lt; b &amp; b &lt; c &amp; c &lt; d" OR
  "a &lt; b &lt; d &amp; b &lt; c"
  XXX: make '' be a single quote.
  @see PatternEntry
  @author             Mark Davis, Helena Shih</extension></chars></separator></extension></chars></separator></entry></entry></pattern></entry></entry></div>
<a id="L62" name="L62"></a>  62 
<a id="L63" name="L63"></a>  63 <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5034.html" title="Multiple referred from 2 places.">MergeCollation</a> <em class="brace">{</em>
<a id="L64" name="L64"></a>  64 
<div class="comment">
      Creates from a pattern
      @exception ParseException If the input pattern is incorrect.</div>
<a id="L69" name="L69"></a>  69     <strong class="reserved">public</strong> MergeCollation(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L70" name="L70"></a>  70     <em class="brace">{</em>
<a id="L71" name="L71"></a>  71         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; statusArray.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++)
<a id="L72" name="L72"></a>  72             statusArray[i] = 0;
<a id="L73" name="L73"></a>  73         <a href="../D/33528.html" title="Multiple defined in 7 places.">setPattern</a>(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>);
<a id="L74" name="L74"></a>  74     <em class="brace">}</em>
<a id="L75" name="L75"></a>  75 
<div class="comment">
      recovers current pattern</div>
<a id="L79" name="L79"></a>  79     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/18317.html" title="Multiple referred from 7 places.">getPattern</a>() <em class="brace">{</em>
<a id="L80" name="L80"></a>  80         <strong class="reserved">return</strong> <a href="../D/21453.html" title="Multiple defined in 7 places.">getPattern</a>(<strong class="reserved">true</strong>);
<a id="L81" name="L81"></a>  81     <em class="brace">}</em>
<a id="L82" name="L82"></a>  82 
<div class="comment">
      recovers current pattern.
      @param withWhiteSpace puts spacing around the entries, and \n
      before &amp; and &lt;</div>
<a id="L88" name="L88"></a>  88     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/18317.html" title="Multiple referred from 7 places.">getPattern</a>(<strong class="reserved">boolean</strong> withWhiteSpace) <em class="brace">{</em>
<a id="L89" name="L89"></a>  89         <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = <strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>();
<a id="L90" name="L90"></a>  90         <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> tmp = <strong class="reserved">null</strong>;
<a id="L91" name="L91"></a>  91         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>&gt; extList = <strong class="reserved">null</strong>;
<a id="L92" name="L92"></a>  92         <strong class="reserved">int</strong> i;
<a id="L93" name="L93"></a>  93         <strong class="reserved">for</strong> (i = 0; i &lt; patterns.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); ++i) <em class="brace">{</em>
<a id="L94" name="L94"></a>  94             <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> entry = patterns.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L95" name="L95"></a>  95             <strong class="reserved">if</strong> (entry.extension.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() != 0) <em class="brace">{</em>
<a id="L96" name="L96"></a>  96                 <strong class="reserved">if</strong> (extList == <strong class="reserved">null</strong>)
<a id="L97" name="L97"></a>  97                     extList = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;&gt;();
<a id="L98" name="L98"></a>  98                 extList.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(entry);
<a id="L99" name="L99"></a>  99             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L100" name="L100"></a> 100                 <strong class="reserved">if</strong> (extList != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L101" name="L101"></a> 101                     <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../S/2464.html#L122" title="Defined at 122 in src/java/text/MergeCollation.java.">findLastWithNoExtension</a>(i-1);
<a id="L102" name="L102"></a> 102                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = extList.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() - 1; j &gt;= 0 ; j--) <em class="brace">{</em>
<a id="L103" name="L103"></a> 103                         tmp = extList.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(j);
<a id="L104" name="L104"></a> 104                         tmp.<a href="../S/2463.html#L114" title="Defined at 114 in src/java/text/PatternEntry.java.">addToBuffer</a>(<a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>, <strong class="reserved">false</strong>, withWhiteSpace, <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>);
<a id="L105" name="L105"></a> 105                     <em class="brace">}</em>
<a id="L106" name="L106"></a> 106                     extList = <strong class="reserved">null</strong>;
<a id="L107" name="L107"></a> 107                 <em class="brace">}</em>
<a id="L108" name="L108"></a> 108                 entry.<a href="../S/2463.html#L114" title="Defined at 114 in src/java/text/PatternEntry.java.">addToBuffer</a>(<a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>, <strong class="reserved">false</strong>, withWhiteSpace, <strong class="reserved">null</strong>);
<a id="L109" name="L109"></a> 109             <em class="brace">}</em>
<a id="L110" name="L110"></a> 110         <em class="brace">}</em>
<a id="L111" name="L111"></a> 111         <strong class="reserved">if</strong> (extList != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L112" name="L112"></a> 112             <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a> = <a href="../S/2464.html#L122" title="Defined at 122 in src/java/text/MergeCollation.java.">findLastWithNoExtension</a>(i-1);
<a id="L113" name="L113"></a> 113             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = extList.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() - 1; j &gt;= 0 ; j--) <em class="brace">{</em>
<a id="L114" name="L114"></a> 114                 tmp = extList.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(j);
<a id="L115" name="L115"></a> 115                 tmp.<a href="../S/2463.html#L114" title="Defined at 114 in src/java/text/PatternEntry.java.">addToBuffer</a>(<a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>, <strong class="reserved">false</strong>, withWhiteSpace, <a href="../D/26739.html" title="Multiple defined in 19 places.">last</a>);
<a id="L116" name="L116"></a> 116             <em class="brace">}</em>
<a id="L117" name="L117"></a> 117             extList = <strong class="reserved">null</strong>;
<a id="L118" name="L118"></a> 118         <em class="brace">}</em>
<a id="L119" name="L119"></a> 119         <strong class="reserved">return</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L120" name="L120"></a> 120     <em class="brace">}</em>
<a id="L121" name="L121"></a> 121 
<a id="L122" name="L122"></a> 122     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> <a href="../R/14407.html" title="Multiple referred from 2 places.">findLastWithNoExtension</a>(<strong class="reserved">int</strong> i) <em class="brace">{</em>
<a id="L123" name="L123"></a> 123         <strong class="reserved">for</strong> (--i;i &gt;= 0; --i) <em class="brace">{</em>
<a id="L124" name="L124"></a> 124             <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> entry = patterns.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L125" name="L125"></a> 125             <strong class="reserved">if</strong> (entry.extension.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 0) <em class="brace">{</em>
<a id="L126" name="L126"></a> 126                 <strong class="reserved">return</strong> entry;
<a id="L127" name="L127"></a> 127             <em class="brace">}</em>
<a id="L128" name="L128"></a> 128         <em class="brace">}</em>
<a id="L129" name="L129"></a> 129         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L130" name="L130"></a> 130     <em class="brace">}</em>
<a id="L131" name="L131"></a> 131 
<div class="comment">
      emits the pattern for collation builder.
      @return emits the string in the format understable to the collation
      builder.</div>
<a id="L137" name="L137"></a> 137     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/2464.html#L138" title="Referred from 138 in src/java/text/MergeCollation.java.">emitPattern</a>() <em class="brace">{</em>
<a id="L138" name="L138"></a> 138         <strong class="reserved">return</strong> <a href="../D/15332.html" title="Multiple defined in 2 places.">emitPattern</a>(<strong class="reserved">true</strong>);
<a id="L139" name="L139"></a> 139     <em class="brace">}</em>
<a id="L140" name="L140"></a> 140 
<div class="comment">
      emits the pattern for collation builder.
      @param withWhiteSpace puts spacing around the entries, and \n
      before &amp; and &lt;
      @return emits the string in the format understable to the collation
      builder.</div>
<a id="L148" name="L148"></a> 148     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../S/2464.html#L138" title="Referred from 138 in src/java/text/MergeCollation.java.">emitPattern</a>(<strong class="reserved">boolean</strong> withWhiteSpace) <em class="brace">{</em>
<a id="L149" name="L149"></a> 149         <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a> = <strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>();
<a id="L150" name="L150"></a> 150         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; patterns.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>(); ++i)
<a id="L151" name="L151"></a> 151         <em class="brace">{</em>
<a id="L152" name="L152"></a> 152             <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> entry = patterns.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L153" name="L153"></a> 153             <strong class="reserved">if</strong> (entry != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L154" name="L154"></a> 154                 entry.<a href="../S/2463.html#L114" title="Defined at 114 in src/java/text/PatternEntry.java.">addToBuffer</a>(<a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>, <strong class="reserved">true</strong>, withWhiteSpace, <strong class="reserved">null</strong>);
<a id="L155" name="L155"></a> 155             <em class="brace">}</em>
<a id="L156" name="L156"></a> 156         <em class="brace">}</em>
<a id="L157" name="L157"></a> 157         <strong class="reserved">return</strong> <a href="../D/31365.html" title="Multiple defined in 7 places.">result</a>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>();
<a id="L158" name="L158"></a> 158     <em class="brace">}</em>
<a id="L159" name="L159"></a> 159 
<div class="comment">
      sets the pattern.</div>
<a id="L163" name="L163"></a> 163     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/27923.html" title="Multiple referred from 8 places.">setPattern</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L164" name="L164"></a> 164     <em class="brace">{</em>
<a id="L165" name="L165"></a> 165         patterns.<a href="../D/12817.html" title="Multiple defined in 199 places.">clear</a>();
<a id="L166" name="L166"></a> 166         <a href="../D/10995.html" title="Multiple defined in 2 places.">addPattern</a>(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>);
<a id="L167" name="L167"></a> 167     <em class="brace">}</em>
<a id="L168" name="L168"></a> 168 
<div class="comment">
      adds a pattern to the current one.
      @param pattern the new pattern to be added</div>
<a id="L173" name="L173"></a> 173     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9898.html" title="Multiple referred from 4 places.">addPattern</a>(<a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L174" name="L174"></a> 174     <em class="brace">{</em>
<a id="L175" name="L175"></a> 175         <strong class="reserved">if</strong> (<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a> == <strong class="reserved">null</strong>)
<a id="L176" name="L176"></a> 176             <strong class="reserved">return</strong>;
<a id="L177" name="L177"></a> 177 
<a id="L178" name="L178"></a> 178         <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>.<a href="../D/6629.html" title="Multiple defined in 9 places.">Parser</a> parser = <strong class="reserved">new</strong> <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>.<a href="../D/6629.html" title="Multiple defined in 9 places.">Parser</a>(<a href="../D/29283.html" title="Multiple defined in 2 places.">pattern</a>);
<a id="L179" name="L179"></a> 179 
<a id="L180" name="L180"></a> 180         <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> entry = parser.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L181" name="L181"></a> 181         <strong class="reserved">while</strong> (entry != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L182" name="L182"></a> 182             <a href="../S/2464.html#L235" title="Defined at 235 in src/java/text/MergeCollation.java.">fixEntry</a>(entry);
<a id="L183" name="L183"></a> 183             entry = parser.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>();
<a id="L184" name="L184"></a> 184         <em class="brace">}</em>
<a id="L185" name="L185"></a> 185     <em class="brace">}</em>
<a id="L186" name="L186"></a> 186 
<div class="comment">
      gets count of separate entries
      @return the size of pattern entries</div>
<a id="L191" name="L191"></a> 191     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/15841.html" title="Multiple referred from 20 places.">getCount</a>() <em class="brace">{</em>
<a id="L192" name="L192"></a> 192         <strong class="reserved">return</strong> patterns.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>();
<a id="L193" name="L193"></a> 193     <em class="brace">}</em>
<a id="L194" name="L194"></a> 194 
<div class="comment">
      gets count of separate entries
      @param index the offset of the desired pattern entry
      @return the requested pattern entry</div>
<a id="L200" name="L200"></a> 200     <strong class="reserved">public</strong> <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> <a href="../S/2456.html#L124" title="Referred from 124 in src/java/text/RBTableBuilder.java.">getItemAt</a>(<strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>) <em class="brace">{</em>
<a id="L201" name="L201"></a> 201         <strong class="reserved">return</strong> patterns.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>);
<a id="L202" name="L202"></a> 202     <em class="brace">}</em>
<a id="L203" name="L203"></a> 203 
<a id="L204" name="L204"></a> 204     <em class="comment">//============================================================</em>
<a id="L205" name="L205"></a> 205     <em class="comment">// privates</em>
<a id="L206" name="L206"></a> 206     <em class="comment">//============================================================</em>
<a id="L207" name="L207"></a> 207     <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>&gt; patterns = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;&gt;(); <em class="comment">// a list of PatternEntries</em>
<a id="L208" name="L208"></a> 208 
<a id="L209" name="L209"></a> 209     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> saveEntry = <strong class="reserved">null</strong>;
<a id="L210" name="L210"></a> 210     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> <a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a> = <strong class="reserved">null</strong>;
<a id="L211" name="L211"></a> 211 
<a id="L212" name="L212"></a> 212     <em class="comment">// This is really used as a local variable inside fixEntry, but we cache</em>
<a id="L213" name="L213"></a> 213     <em class="comment">// it here to avoid newing it up every time the method is called.</em>
<a id="L214" name="L214"></a> 214     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> excess = <strong class="reserved">new</strong> <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a>();
<a id="L215" name="L215"></a> 215 
<a id="L216" name="L216"></a> 216     <em class="comment">//</em>
<a id="L217" name="L217"></a> 217     <em class="comment">// When building a MergeCollation, we need to do lots of searches to see</em>
<a id="L218" name="L218"></a> 218     <em class="comment">// whether a given entry is already in the table.  Since we're using an</em>
<a id="L219" name="L219"></a> 219     <em class="comment">// array, this would make the algorithm O(N*N).  To speed things up, we</em>
<a id="L220" name="L220"></a> 220     <em class="comment">// use this bit array to remember whether the array contains any entries</em>
<a id="L221" name="L221"></a> 221     <em class="comment">// starting with each Unicode character.  If not, we can avoid the search.</em>
<a id="L222" name="L222"></a> 222     <em class="comment">// Using BitSet would make this easier, but it's significantly slower.</em>
<a id="L223" name="L223"></a> 223     <em class="comment">//</em>
<a id="L224" name="L224"></a> 224     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">byte</strong>[] statusArray = <strong class="reserved">new</strong> <strong class="reserved">byte</strong>[8192];
<a id="L225" name="L225"></a> 225     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">byte</strong> BITARRAYMASK = (<strong class="reserved">byte</strong>)0x1;
<a id="L226" name="L226"></a> 226     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  BYTEPOWER = 3;
<a id="L227" name="L227"></a> 227     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong>  BYTEMASK = (1 &lt;&lt; BYTEPOWER) - 1;
<a id="L228" name="L228"></a> 228 
<div class="comment">
      If the strength is RESET, then just change the lastEntry to
      be the current. (If the current is not in patterns, signal an error).
      If not, then remove the current entry, and add it after lastEntry
      (which is usually at the end).</div>
<a id="L235" name="L235"></a> 235     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../S/2464.html#L182" title="Referred from 182 in src/java/text/MergeCollation.java.">fixEntry</a>(<a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L236" name="L236"></a> 236     <em class="brace">{</em>
<a id="L237" name="L237"></a> 237         <em class="comment">// check to see whether the new entry has the same characters as the previous</em>
<a id="L238" name="L238"></a> 238         <em class="comment">// entry did (this can happen when a pattern declaring a difference between two</em>
<a id="L239" name="L239"></a> 239         <em class="comment">// strings that are canonically equivalent is normalized).  If so, and the strength</em>
<a id="L240" name="L240"></a> 240         <em class="comment">// is anything other than IDENTICAL or RESET, throw an exception (you can't</em>
<a id="L241" name="L241"></a> 241         <em class="comment">// declare a string to be unequal to itself).       --rtg 5/24/99</em>
<a id="L242" name="L242"></a> 242         <strong class="reserved">if</strong> (<a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a>.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>)
<a id="L243" name="L243"></a> 243                 &amp;&amp; <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.extension.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(<a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a>.extension)) <em class="brace">{</em>
<a id="L244" name="L244"></a> 244             <strong class="reserved">if</strong> (<a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.strength != <a href="../S/2466.html#L128" title="Defined at 128 in src/java/text/Collator.java.">Collator</a>.IDENTICAL
<a id="L245" name="L245"></a> 245                 &amp;&amp; <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.strength != <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>.RESET) <em class="brace">{</em>
<a id="L246" name="L246"></a> 246                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>("The entries " + <a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a> + " and "
<a id="L247" name="L247"></a> 247                             + <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a> + " are adjacent in the rules, but have conflicting "
<a id="L248" name="L248"></a> 248                             + "strengths: A character can't be unequal to itself.", -1);
<a id="L249" name="L249"></a> 249             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L250" name="L250"></a> 250                 <em class="comment">// otherwise, just skip this entry and behave as though you never saw it</em>
<a id="L251" name="L251"></a> 251                 <strong class="reserved">return</strong>;
<a id="L252" name="L252"></a> 252             <em class="brace">}</em>
<a id="L253" name="L253"></a> 253         <em class="brace">}</em>
<a id="L254" name="L254"></a> 254 
<a id="L255" name="L255"></a> 255         <strong class="reserved">boolean</strong> changeLastEntry = <strong class="reserved">true</strong>;
<a id="L256" name="L256"></a> 256         <strong class="reserved">if</strong> (<a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.strength != <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>.RESET) <em class="brace">{</em>
<a id="L257" name="L257"></a> 257             <strong class="reserved">int</strong> oldIndex = -1;
<a id="L258" name="L258"></a> 258 
<a id="L259" name="L259"></a> 259             <strong class="reserved">if</strong> ((<a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 1)) <em class="brace">{</em>
<a id="L260" name="L260"></a> 260 
<a id="L261" name="L261"></a> 261                 <strong class="reserved">char</strong> <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> = <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0);
<a id="L262" name="L262"></a> 262                 <strong class="reserved">int</strong> statusIndex = <a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &gt;&gt; BYTEPOWER;
<a id="L263" name="L263"></a> 263                 <strong class="reserved">byte</strong> bitClump = statusArray[statusIndex];
<a id="L264" name="L264"></a> 264                 <strong class="reserved">byte</strong> <a href="../D/32001.html" title="Multiple defined in 4 places.">setBit</a> = (<strong class="reserved">byte</strong>)(BITARRAYMASK &lt;&lt; (<a href="../S/986.html#L3167" title="Defined at 3167 in src/java/util/regex/Pattern.java.">c</a> &amp; BYTEMASK));
<a id="L265" name="L265"></a> 265 
<a id="L266" name="L266"></a> 266                 <strong class="reserved">if</strong> (bitClump != 0 &amp;&amp; (bitClump &amp; <a href="../D/32001.html" title="Multiple defined in 4 places.">setBit</a>) != 0) <em class="brace">{</em>
<a id="L267" name="L267"></a> 267                     oldIndex = patterns.<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>(<a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>);
<a id="L268" name="L268"></a> 268                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L269" name="L269"></a> 269                     <em class="comment">// We're going to add an element that starts with this</em>
<a id="L270" name="L270"></a> 270                     <em class="comment">// character, so go ahead and set its bit.</em>
<a id="L271" name="L271"></a> 271                     statusArray[statusIndex] = (<strong class="reserved">byte</strong>)(bitClump | <a href="../D/32001.html" title="Multiple defined in 4 places.">setBit</a>);
<a id="L272" name="L272"></a> 272                 <em class="brace">}</em>
<a id="L273" name="L273"></a> 273             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L274" name="L274"></a> 274                 oldIndex = patterns.<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>(<a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>);
<a id="L275" name="L275"></a> 275             <em class="brace">}</em>
<a id="L276" name="L276"></a> 276             <strong class="reserved">if</strong> (oldIndex != -1) <em class="brace">{</em>
<a id="L277" name="L277"></a> 277                 patterns.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(oldIndex);
<a id="L278" name="L278"></a> 278             <em class="brace">}</em>
<a id="L279" name="L279"></a> 279 
<a id="L280" name="L280"></a> 280             excess.<a href="../D/33077.html" title="Multiple defined in 10 places.">setLength</a>(0);
<a id="L281" name="L281"></a> 281             <strong class="reserved">int</strong> lastIndex = <a href="../S/2464.html#L302" title="Defined at 302 in src/java/text/MergeCollation.java.">findLastEntry</a>(<a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a>, excess);
<a id="L282" name="L282"></a> 282 
<a id="L283" name="L283"></a> 283             <strong class="reserved">if</strong> (excess.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() != 0) <em class="brace">{</em>
<a id="L284" name="L284"></a> 284                 <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.extension = excess + <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>.extension;
<a id="L285" name="L285"></a> 285                 <strong class="reserved">if</strong> (lastIndex != patterns.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()) <em class="brace">{</em>
<a id="L286" name="L286"></a> 286                     <a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a> = saveEntry;
<a id="L287" name="L287"></a> 287                     changeLastEntry = <strong class="reserved">false</strong>;
<a id="L288" name="L288"></a> 288                 <em class="brace">}</em>
<a id="L289" name="L289"></a> 289             <em class="brace">}</em>
<a id="L290" name="L290"></a> 290             <strong class="reserved">if</strong> (lastIndex == patterns.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()) <em class="brace">{</em>
<a id="L291" name="L291"></a> 291                 patterns.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>);
<a id="L292" name="L292"></a> 292                 saveEntry = <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>;
<a id="L293" name="L293"></a> 293             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L294" name="L294"></a> 294                 patterns.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(lastIndex, <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>);
<a id="L295" name="L295"></a> 295             <em class="brace">}</em>
<a id="L296" name="L296"></a> 296         <em class="brace">}</em>
<a id="L297" name="L297"></a> 297         <strong class="reserved">if</strong> (changeLastEntry) <em class="brace">{</em>
<a id="L298" name="L298"></a> 298             <a href="../D/26746.html" title="Multiple defined in 8 places.">lastEntry</a> = <a href="../S/919.html#L617" title="Defined at 617 in src/java/util/jar/JarFile.java.">newEntry</a>;
<a id="L299" name="L299"></a> 299         <em class="brace">}</em>
<a id="L300" name="L300"></a> 300     <em class="brace">}</em>
<a id="L301" name="L301"></a> 301 
<a id="L302" name="L302"></a> 302     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../S/2464.html#L281" title="Referred from 281 in src/java/text/MergeCollation.java.">findLastEntry</a>(<a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> entry,
<a id="L303" name="L303"></a> 303                               <a href="../S/1583.html#L97" title="Defined at 97 in src/java/lang/StringBuffer.java.">StringBuffer</a> excessChars) <strong class="reserved">throws</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>
<a id="L304" name="L304"></a> 304     <em class="brace">{</em>
<a id="L305" name="L305"></a> 305         <strong class="reserved">if</strong> (entry == <strong class="reserved">null</strong>)
<a id="L306" name="L306"></a> 306             <strong class="reserved">return</strong> 0;
<a id="L307" name="L307"></a> 307 
<a id="L308" name="L308"></a> 308         <strong class="reserved">if</strong> (entry.strength != <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a>.RESET) <em class="brace">{</em>
<a id="L309" name="L309"></a> 309             <em class="comment">// Search backwards for string that contains this one;</em>
<a id="L310" name="L310"></a> 310             <em class="comment">// most likely entry is last one</em>
<a id="L311" name="L311"></a> 311 
<a id="L312" name="L312"></a> 312             <strong class="reserved">int</strong> oldIndex = -1;
<a id="L313" name="L313"></a> 313             <strong class="reserved">if</strong> ((entry.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>() == 1)) <em class="brace">{</em>
<a id="L314" name="L314"></a> 314                 <strong class="reserved">int</strong> <a href="../D/24461.html" title="Multiple defined in 6 places.">index</a> = entry.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0) &gt;&gt; BYTEPOWER;
<a id="L315" name="L315"></a> 315                 <strong class="reserved">if</strong> ((statusArray[<a href="../D/24461.html" title="Multiple defined in 6 places.">index</a>] &amp;
<a id="L316" name="L316"></a> 316                     (BITARRAYMASK &lt;&lt; (entry.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/12321.html" title="Multiple defined in 24 places.">charAt</a>(0) &amp; BYTEMASK))) != 0) <em class="brace">{</em>
<a id="L317" name="L317"></a> 317                     oldIndex = patterns.<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>(entry);
<a id="L318" name="L318"></a> 318                 <em class="brace">}</em>
<a id="L319" name="L319"></a> 319             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L320" name="L320"></a> 320                 oldIndex = patterns.<a href="../D/26748.html" title="Multiple defined in 44 places.">lastIndexOf</a>(entry);
<a id="L321" name="L321"></a> 321             <em class="brace">}</em>
<a id="L322" name="L322"></a> 322             <strong class="reserved">if</strong> ((oldIndex == -1))
<a id="L323" name="L323"></a> 323                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>("couldn't find last entry: "
<a id="L324" name="L324"></a> 324                                           + entry, oldIndex);
<a id="L325" name="L325"></a> 325             <strong class="reserved">return</strong> oldIndex + 1;
<a id="L326" name="L326"></a> 326         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L327" name="L327"></a> 327             <strong class="reserved">int</strong> i;
<a id="L328" name="L328"></a> 328             <strong class="reserved">for</strong> (i = patterns.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>() - 1; i &gt;= 0; --i) <em class="brace">{</em>
<a id="L329" name="L329"></a> 329                 <a href="../S/2463.html#L51" title="Defined at 51 in src/java/text/PatternEntry.java.">PatternEntry</a> e = patterns.<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>(i);
<a id="L330" name="L330"></a> 330                 <strong class="reserved">if</strong> (e.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/30514.html" title="Multiple defined in 14 places.">regionMatches</a>(0,entry.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>,0,
<a id="L331" name="L331"></a> 331                                               e.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>())) <em class="brace">{</em>
<a id="L332" name="L332"></a> 332                     excessChars.<a href="../D/11357.html" title="Multiple defined in 137 places.">append</a>(entry.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/35013.html" title="Multiple defined in 26 places.">substring</a>(e.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>(),
<a id="L333" name="L333"></a> 333                                                             entry.<a href="../D/12342.html" title="Multiple defined in 2 places.">chars</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>()));
<a id="L334" name="L334"></a> 334                     <strong class="reserved">break</strong>;
<a id="L335" name="L335"></a> 335                 <em class="brace">}</em>
<a id="L336" name="L336"></a> 336             <em class="brace">}</em>
<a id="L337" name="L337"></a> 337             <strong class="reserved">if</strong> (i == -1)
<a id="L338" name="L338"></a> 338                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/6624.html" title="Multiple defined in 3 places.">ParseException</a>("couldn't find: " + entry, i);
<a id="L339" name="L339"></a> 339             <strong class="reserved">return</strong> i + 1;
<a id="L340" name="L340"></a> 340         <em class="brace">}</em>
<a id="L341" name="L341"></a> 341     <em class="brace">}</em>
<a id="L342" name="L342"></a> 342 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L79">[^]</a><a href="#L302">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>