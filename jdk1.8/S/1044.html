<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/concurrent/locks/AbstractQueuedLongSynchronizer.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L261">[^]</a><a href="#L2090">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L261" title="Defined at 261.">isShared</a></li>
<li><a href="#L272" title="Defined at 272.">predecessor</a></li>
<li><a href="#L318" title="Defined at 318.">getState</a></li>
<li><a href="#L327" title="Defined at 327.">setState</a></li>
<li><a href="#L342" title="Defined at 342.">compareAndSetState</a></li>
<li><a href="#L361" title="Defined at 361.">enq</a></li>
<li><a href="#L383" title="Defined at 383.">addWaiter</a></li>
<li><a href="#L405" title="Defined at 405.">setHead</a></li>
<li><a href="#L416" title="Defined at 416.">unparkSuccessor</a></li>
<li><a href="#L448" title="Defined at 448.">doReleaseShared</a></li>
<li><a href="#L486" title="Defined at 486.">setHeadAndPropagate</a></li>
<li><a href="#L520" title="Defined at 520.">cancelAcquire</a></li>
<li><a href="#L573" title="Defined at 573.">shouldParkAfterFailedAcquire</a></li>
<li><a href="#L604" title="Defined at 604.">selfInterrupt</a></li>
<li><a href="#L613" title="Defined at 613.">parkAndCheckInterrupt</a></li>
<li><a href="#L635" title="Defined at 635.">acquireQueued</a></li>
<li><a href="#L661" title="Defined at 661.">doAcquireInterruptibly</a></li>
<li><a href="#L691" title="Defined at 691.">doAcquireNanos</a></li>
<li><a href="#L726" title="Defined at 726.">doAcquireShared</a></li>
<li><a href="#L758" title="Defined at 758.">doAcquireSharedInterruptibly</a></li>
<li><a href="#L791" title="Defined at 791.">doAcquireSharedNanos</a></li>
<li><a href="#L853" title="Defined at 853.">tryAcquire</a></li>
<li><a href="#L879" title="Defined at 879.">tryRelease</a></li>
<li><a href="#L915" title="Defined at 915.">tryAcquireShared</a></li>
<li><a href="#L940" title="Defined at 940.">tryReleaseShared</a></li>
<li><a href="#L959" title="Defined at 959.">isHeldExclusively</a></li>
<li><a href="#L975" title="Defined at 975.">acquire</a></li>
<li><a href="#L995" title="Defined at 995.">acquireInterruptibly</a></li>
<li><a href="#L1020" title="Defined at 1020.">tryAcquireNanos</a></li>
<li><a href="#L1038" title="Defined at 1038.">release</a></li>
<li><a href="#L1059" title="Defined at 1059.">acquireShared</a></li>
<li><a href="#L1077" title="Defined at 1077.">acquireSharedInterruptibly</a></li>
<li><a href="#L1101" title="Defined at 1101.">tryAcquireSharedNanos</a></li>
<li><a href="#L1118" title="Defined at 1118.">releaseShared</a></li>
<li><a href="#L1139" title="Defined at 1139.">hasQueuedThreads</a></li>
<li><a href="#L1152" title="Defined at 1152.">hasContended</a></li>
<li><a href="#L1167" title="Defined at 1167.">getFirstQueuedThread</a></li>
<li><a href="#L1175" title="Defined at 1175.">fullGetFirstQueuedThread</a></li>
<li><a href="#L1221" title="Defined at 1221.">isQueued</a></li>
<li><a href="#L1239" title="Defined at 1239.">apparentlyFirstQueuedIsExclusive</a></li>
<li><a href="#L1290" title="Defined at 1290.">hasQueuedPredecessors</a></li>
<li><a href="#L1314" title="Defined at 1314.">getQueueLength</a></li>
<li><a href="#L1334" title="Defined at 1334.">getQueuedThreads</a></li>
<li><a href="#L1352" title="Defined at 1352.">getExclusiveQueuedThreads</a></li>
<li><a href="#L1372" title="Defined at 1372.">getSharedQueuedThreads</a></li>
<li><a href="#L1393" title="Defined at 1393.">toString</a></li>
<li><a href="#L1409" title="Defined at 1409.">isOnSyncQueue</a></li>
<li><a href="#L1430" title="Defined at 1430.">findNodeFromTail</a></li>
<li><a href="#L1448" title="Defined at 1448.">transferForSignal</a></li>
<li><a href="#L1475" title="Defined at 1475.">transferAfterCancelledWait</a></li>
<li><a href="#L1497" title="Defined at 1497.">fullyRelease</a></li>
<li><a href="#L1523" title="Defined at 1523.">owns</a></li>
<li><a href="#L1543" title="Defined at 1543.">hasWaiters</a></li>
<li><a href="#L1565" title="Defined at 1565.">getWaitQueueLength</a></li>
<li><a href="#L1587" title="Defined at 1587.">getWaitingThreads</a></li>
<li><a href="#L1628" title="Defined at 1628.">addConditionWaiter</a></li>
<li><a href="#L1650" title="Defined at 1650.">doSignal</a></li>
<li><a href="#L1663" title="Defined at 1663.">doSignalAll</a></li>
<li><a href="#L1687" title="Defined at 1687.">unlinkCancelledWaiters</a></li>
<li><a href="#L1717" title="Defined at 1717.">signal</a></li>
<li><a href="#L1732" title="Defined at 1732.">signalAll</a></li>
<li><a href="#L1751" title="Defined at 1751.">awaitUninterruptibly</a></li>
<li><a href="#L1781" title="Defined at 1781.">checkInterruptWhileWaiting</a></li>
<li><a href="#L1791" title="Defined at 1791.">reportInterruptAfterWait</a></li>
<li><a href="#L1812" title="Defined at 1812.">await</a></li>
<li><a href="#L1844" title="Defined at 1844.">awaitNanos</a></li>
<li><a href="#L1886" title="Defined at 1886.">awaitUntil</a></li>
<li><a href="#L1927" title="Defined at 1927.">await</a></li>
<li><a href="#L1965" title="Defined at 1965.">isOwnedBy</a></li>
<li><a href="#L1977" title="Defined at 1977.">hasWaiters</a></li>
<li><a href="#L1996" title="Defined at 1996.">getWaitQueueLength</a></li>
<li><a href="#L2016" title="Defined at 2016.">getWaitingThreads</a></li>
<li><a href="#L2066" title="Defined at 2066.">compareAndSetHead</a></li>
<li><a href="#L2073" title="Defined at 2073.">compareAndSetTail</a></li>
<li><a href="#L2080" title="Defined at 2080.">compareAndSetWaitStatus</a></li>
<li><a href="#L2090" title="Defined at 2090.">compareAndSetNext</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L24" name="L24"></a>  24 
<div class="comment">
  Written by Doug Lea with assistance from members of JCP JSR-166
  Expert Group and released to the public domain, as explained at
  http://creativecommons.org/publicdomain/zero/1.0/</div>
<a id="L35" name="L35"></a>  35 
<a id="L36" name="L36"></a>  36 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.concurrent.locks;
<a id="L37" name="L37"></a>  37 <strong class="reserved">import</strong> java.util.concurrent.TimeUnit;
<a id="L38" name="L38"></a>  38 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L39" name="L39"></a>  39 <strong class="reserved">import</strong> java.util.Collection;
<a id="L40" name="L40"></a>  40 <strong class="reserved">import</strong> java.util.Date;
<a id="L41" name="L41"></a>  41 <strong class="reserved">import</strong> sun.misc.Unsafe;
<a id="L42" name="L42"></a>  42 
<div class="comment">
  A version of {@link AbstractQueuedSynchronizer} in
  which synchronization state is maintained as a <code>long</code>.
  This class has exactly the same structure, properties, and methods
  as <code>AbstractQueuedSynchronizer</code> with the exception
  that all state-related parameters and results are defined
  as <code>long</code> rather than <code>int</code>. This class
  may be useful when creating synchronizers such as
  multilevel locks and barriers that require
  64 bits of state.
  <p>See {@link AbstractQueuedSynchronizer} for usage
  notes and examples.
  @since 1.6
  @author Doug Lea</p></div>
<a id="L60" name="L60"></a>  60 <strong class="reserved">public</strong> <strong class="reserved">abstract</strong> <strong class="reserved">class</strong> <a href="../R/104.html" title="Multiple referred from 5 places.">AbstractQueuedLongSynchronizer</a>
<a id="L61" name="L61"></a>  61     <strong class="reserved">extends</strong> <a href="../S/1048.html#L50" title="Defined at 50 in src/java/util/concurrent/locks/AbstractOwnableSynchronizer.java.">AbstractOwnableSynchronizer</a>
<a id="L62" name="L62"></a>  62     <strong class="reserved">implements</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L63" name="L63"></a>  63 
<a id="L64" name="L64"></a>  64     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 7373984972572414692L;
<a id="L65" name="L65"></a>  65 
<div class="comment">
      To keep sources in sync, the remainder of this source file is
      exactly cloned from AbstractQueuedSynchronizer, replacing class
      name and changing ints related with sync state to longs. Please
      keep it that way.</div>
<a id="L72" name="L72"></a>  72 
<div class="comment">
      Creates a new <code>AbstractQueuedLongSynchronizer</code> instance
      with initial synchronization state of zero.</div>
<a id="L77" name="L77"></a>  77     <strong class="reserved">protected</strong> AbstractQueuedLongSynchronizer() <em class="brace">{</em> <em class="brace">}</em>
<a id="L78" name="L78"></a>  78 
<div class="comment">
      Wait queue node class.
      <p>The wait queue is a variant of a "CLH" (Craig, Landin, and
      Hagersten) lock queue. CLH locks are normally used for
      spinlocks.  We instead use them for blocking synchronizers, but
      use the same basic tactic of holding some of the control
      information about a thread in the predecessor of its node.  A
      "status" field in each node keeps track of whether a thread
      should block.  A node is signalled when its predecessor
      releases.  Each node of the queue otherwise serves as a
      specific-notification-style monitor holding a single waiting
      thread. The status field does NOT control whether threads are
      granted locks etc though.  A thread may try to acquire if it is
      first in the queue. But being first does not guarantee success;
      it only gives the right to contend.  So the currently released
      contender thread may need to rewait.
      </p><p>To enqueue into a CLH lock, you atomically splice it in as new
      tail. To dequeue, you just set the head field.
      </p><pre>           +------+  prev +-----+       +-----+
      head |      | &lt;---- |     | &lt;---- |     |  tail
           +------+       +-----+       +-----+
      </pre>
      <p>Insertion into a CLH queue requires only a single atomic
      operation on "tail", so there is a simple atomic point of
      demarcation from unqueued to queued. Similarly, dequeuing
      involves only updating the "head". However, it takes a bit
      more work for nodes to determine who their successors are,
      in part to deal with possible cancellation due to timeouts
      and interrupts.
      </p><p>The "prev" links (not used in original CLH locks), are mainly
      needed to handle cancellation. If a node is cancelled, its
      successor is (normally) relinked to a non-cancelled
      predecessor. For explanation of similar mechanics in the case
      of spin locks, see the papers by Scott and Scherer at
      http://www.cs.rochester.edu/u/scott/synchronization/
      </p><p>We also use "next" links to implement blocking mechanics.
      The thread id for each node is kept in its own node, so a
      predecessor signals the next node to wake up by traversing
      next link to determine which thread it is.  Determination of
      successor must avoid races with newly queued nodes to set
      the "next" fields of their predecessors.  This is solved
      when necessary by checking backwards from the atomically
      updated "tail" when a node's successor appears to be null.
      (Or, said differently, the next-links are an optimization
      so that we don't usually need a backward scan.)
      </p><p>Cancellation introduces some conservatism to the basic
      algorithms.  Since we must poll for cancellation of other
      nodes, we can miss noticing whether a cancelled node is
      ahead or behind us. This is dealt with by always unparking
      successors upon cancellation, allowing them to stabilize on
      a new predecessor, unless we can identify an uncancelled
      predecessor who will carry this responsibility.
      </p><p>CLH queues need a dummy header node to get started. But
      we don't create them on construction, because it would be wasted
      effort if there is never contention. Instead, the node
      is constructed and head and tail pointers are set upon first
      contention.
      </p><p>Threads waiting on Conditions use the same nodes, but
      use an additional link. Conditions only need to link nodes
      in simple (non-concurrent) linked queues because they are
      only accessed when exclusively held.  Upon await, a node is
      inserted into a condition queue.  Upon signal, the node is
      transferred to the main queue.  A special value of status
      field is used to mark which queue a node is on.
      </p><p>Thanks go to Dave Dice, Mark Moir, Victor Luchangco, Bill
      Scherer and Michael Scott, along with members of JSR-166
      expert group, for helpful ideas, discussions, and critiques
      on the design of this class.</p></div>
<a id="L158" name="L158"></a> 158     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5542.html" title="Multiple referred from 4060 places.">Node</a> <em class="brace">{</em>
<div class="comment">
         /** Marker to indicate a node is waiting in shared mode */</div>
<a id="L160" name="L160"></a> 160         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> SHARED = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>();
<div class="comment">
         /** Marker to indicate a node is waiting in exclusive mode */</div>
<a id="L162" name="L162"></a> 162         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> EXCLUSIVE = <strong class="reserved">null</strong>;
<a id="L163" name="L163"></a> 163 
<div class="comment">
         /** waitStatus value to indicate thread has cancelled */</div>
<a id="L165" name="L165"></a> 165         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CANCELLED =  1;
<div class="comment">
         /** waitStatus value to indicate successor's thread needs unparking */</div>
<a id="L167" name="L167"></a> 167         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> SIGNAL    = -1;
<div class="comment">
         /** waitStatus value to indicate thread is waiting on condition */</div>
<a id="L169" name="L169"></a> 169         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> CONDITION = -2;
<div class="comment">
          waitStatus value to indicate the next acquireShared should
          unconditionally propagate</div>
<a id="L174" name="L174"></a> 174         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> PROPAGATE = -3;
<a id="L175" name="L175"></a> 175 
<div class="comment">
          Status field, taking on only the values:
            SIGNAL:     The successor of this node is (or will soon be)
                        blocked (via park), so the current node must
                        unpark its successor when it releases or
                        cancels. To avoid races, acquire methods must
                        first indicate they need a signal,
                        then retry the atomic acquire, and then,
                        on failure, block.
            CANCELLED:  This node is cancelled due to timeout or interrupt.
                        Nodes never leave this state. In particular,
                        a thread with cancelled node never again blocks.
            CONDITION:  This node is currently on a condition queue.
                        It will not be used as a sync queue node
                        until transferred, at which time the status
                        will be set to 0. (Use of this value here has
                        nothing to do with the other uses of the
                        field, but simplifies mechanics.)
            PROPAGATE:  A releaseShared should be propagated to other
                        nodes. This is set (for head node only) in
                        doReleaseShared to ensure propagation
                        continues, even if other operations have
                        since intervened.
            0:          None of the above
          The values are arranged numerically to simplify use.
          Non-negative values mean that a node doesn't need to
          signal. So, most code doesn't need to check for particular
          values, just for sign.
          The field is initialized to 0 for normal sync nodes, and
          CONDITION for condition nodes.  It is modified using CAS
          (or when possible, unconditional volatile writes).</div>
<a id="L210" name="L210"></a> 210         <strong class="reserved">volatile</strong> <strong class="reserved">int</strong> waitStatus;
<a id="L211" name="L211"></a> 211 
<div class="comment">
          Link to predecessor node that current node/thread relies on
          for checking waitStatus. Assigned during enqueuing, and nulled
          out (for sake of GC) only upon dequeuing.  Also, upon
          cancellation of a predecessor, we short-circuit while
          finding a non-cancelled one, which will always exist
          because the head node is never cancelled: A node becomes
          head only as a result of successful acquire. A
          cancelled thread never succeeds in acquiring, and a thread only
          cancels itself, not any other node.</div>
<a id="L223" name="L223"></a> 223         <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> prev;
<a id="L224" name="L224"></a> 224 
<div class="comment">
          Link to the successor node that the current node/thread
          unparks upon release. Assigned during enqueuing, adjusted
          when bypassing cancelled predecessors, and nulled out (for
          sake of GC) when dequeued.  The enq operation does not
          assign next field of a predecessor until after attachment,
          so seeing a null next field does not necessarily mean that
          node is at end of queue. However, if a next field appears
          to be null, we can scan prev's from the tail to
          double-check.  The next field of cancelled nodes is set to
          point to the node itself instead of null, to make life
          easier for isOnSyncQueue.</div>
<a id="L238" name="L238"></a> 238         <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L239" name="L239"></a> 239 
<div class="comment">
          The thread that enqueued this node.  Initialized on
          construction and nulled out after use.</div>
<a id="L244" name="L244"></a> 244         <strong class="reserved">volatile</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread;
<a id="L245" name="L245"></a> 245 
<div class="comment">
          Link to next node waiting on condition, or the special
          value SHARED.  Because condition queues are accessed only
          when holding in exclusive mode, we just need a simple
          linked queue to hold nodes while they are waiting on
          conditions. They are then transferred to the queue to
          re-acquire. And because conditions can only be exclusive,
          we save a field by using special value to indicate shared
          mode.</div>
<a id="L256" name="L256"></a> 256         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> nextWaiter;
<a id="L257" name="L257"></a> 257 
<div class="comment">
          Returns true if node is waiting in shared mode.</div>
<a id="L261" name="L261"></a> 261         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/22014.html" title="Multiple referred from 8 places.">isShared</a>() <em class="brace">{</em>
<a id="L262" name="L262"></a> 262             <strong class="reserved">return</strong> nextWaiter == SHARED;
<a id="L263" name="L263"></a> 263         <em class="brace">}</em>
<a id="L264" name="L264"></a> 264 
<div class="comment">
          Returns previous node, or throws NullPointerException if null.
          Use when predecessor cannot be null.  The null check could
          be elided, but is present to help the VM.
          @return the predecessor of this node</div>
<a id="L272" name="L272"></a> 272         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/24906.html" title="Multiple referred from 16 places.">predecessor</a>() <strong class="reserved">throws</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a> <em class="brace">{</em>
<a id="L273" name="L273"></a> 273             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = prev;
<a id="L274" name="L274"></a> 274             <strong class="reserved">if</strong> (p == <strong class="reserved">null</strong>)
<a id="L275" name="L275"></a> 275                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L276" name="L276"></a> 276             <strong class="reserved">else</strong>
<a id="L277" name="L277"></a> 277                 <strong class="reserved">return</strong> p;
<a id="L278" name="L278"></a> 278         <em class="brace">}</em>
<a id="L279" name="L279"></a> 279 
<a id="L280" name="L280"></a> 280         Node() <em class="brace">{</em>    <em class="comment">// Used to establish initial head or SHARED marker</em>
<a id="L281" name="L281"></a> 281         <em class="brace">}</em>
<a id="L282" name="L282"></a> 282 
<a id="L283" name="L283"></a> 283         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread, Node mode) <em class="brace">{</em>     <em class="comment">// Used by addWaiter</em>
<a id="L284" name="L284"></a> 284             <strong class="reserved">this</strong>.nextWaiter = mode;
<a id="L285" name="L285"></a> 285             <strong class="reserved">this</strong>.thread = thread;
<a id="L286" name="L286"></a> 286         <em class="brace">}</em>
<a id="L287" name="L287"></a> 287 
<a id="L288" name="L288"></a> 288         Node(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread, <strong class="reserved">int</strong> waitStatus) <em class="brace">{</em> <em class="comment">// Used by Condition</em>
<a id="L289" name="L289"></a> 289             <strong class="reserved">this</strong>.waitStatus = waitStatus;
<a id="L290" name="L290"></a> 290             <strong class="reserved">this</strong>.thread = thread;
<a id="L291" name="L291"></a> 291         <em class="brace">}</em>
<a id="L292" name="L292"></a> 292     <em class="brace">}</em>
<a id="L293" name="L293"></a> 293 
<div class="comment">
      Head of the wait queue, lazily initialized.  Except for
      initialization, it is modified only via method setHead.  Note:
      If head exists, its waitStatus is guaranteed not to be
      CANCELLED.</div>
<a id="L300" name="L300"></a> 300     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> head;
<a id="L301" name="L301"></a> 301 
<div class="comment">
      Tail of the wait queue, lazily initialized.  Modified only via
      method enq to add new wait node.</div>
<a id="L306" name="L306"></a> 306     <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <strong class="reserved">volatile</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> tail;
<a id="L307" name="L307"></a> 307 
<div class="comment">
      The synchronization state.</div>
<a id="L311" name="L311"></a> 311     <strong class="reserved">private</strong> <strong class="reserved">volatile</strong> <strong class="reserved">long</strong> <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>;
<a id="L312" name="L312"></a> 312 
<div class="comment">
      Returns the current value of synchronization state.
      This operation has memory semantics of a <code>volatile</code> read.
      @return current state value</div>
<a id="L318" name="L318"></a> 318     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../R/19176.html" title="Multiple referred from 92 places.">getState</a>() <em class="brace">{</em>
<a id="L319" name="L319"></a> 319         <strong class="reserved">return</strong> <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a>;
<a id="L320" name="L320"></a> 320     <em class="brace">}</em>
<a id="L321" name="L321"></a> 321 
<div class="comment">
      Sets the value of synchronization state.
      This operation has memory semantics of a <code>volatile</code> write.
      @param newState the new state value</div>
<a id="L327" name="L327"></a> 327     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28224.html" title="Multiple referred from 77 places.">setState</a>(<strong class="reserved">long</strong> newState) <em class="brace">{</em>
<a id="L328" name="L328"></a> 328         <a href="../D/34848.html" title="Multiple defined in 2 places.">state</a> = newState;
<a id="L329" name="L329"></a> 329     <em class="brace">}</em>
<a id="L330" name="L330"></a> 330 
<div class="comment">
      Atomically sets synchronization state to the given updated
      value if the current state value equals the expected value.
      This operation has memory semantics of a <code>volatile</code> read
      and write.
      @param expect the expected value
      @param update the new value
      @return <code>true</code> if successful. False return indicates that the actual
              value was not equal to the expected value.</div>
<a id="L342" name="L342"></a> 342     <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11700.html" title="Multiple referred from 16 places.">compareAndSetState</a>(<strong class="reserved">long</strong> expect, <strong class="reserved">long</strong> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L343" name="L343"></a> 343         <em class="comment">// See below for intrinsics setup to support this</em>
<a id="L344" name="L344"></a> 344         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapLong(<strong class="reserved">this</strong>, stateOffset, expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L345" name="L345"></a> 345     <em class="brace">}</em>
<a id="L346" name="L346"></a> 346 
<a id="L347" name="L347"></a> 347     <em class="comment">// Queuing utilities</em>
<a id="L348" name="L348"></a> 348 
<div class="comment">
      The number of nanoseconds for which it is faster to spin
      rather than to use timed park. A rough estimate suffices
      to improve responsiveness with very short timeouts.</div>
<a id="L354" name="L354"></a> 354     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> spinForTimeoutThreshold = 1000L;
<a id="L355" name="L355"></a> 355 
<div class="comment">
      Inserts node into queue, initializing if necessary. See picture above.
      @param node the node to insert
      @return node's predecessor</div>
<a id="L361" name="L361"></a> 361     <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/13892.html" title="Multiple referred from 6 places.">enq</a>(<strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L362" name="L362"></a> 362         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L363" name="L363"></a> 363             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail;
<a id="L364" name="L364"></a> 364             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>) <em class="brace">{</em> <em class="comment">// Must initialize</em>
<a id="L365" name="L365"></a> 365                 <strong class="reserved">if</strong> (<a href="../D/13037.html" title="Multiple defined in 2 places.">compareAndSetHead</a>(<strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>()))
<a id="L366" name="L366"></a> 366                     tail = head;
<a id="L367" name="L367"></a> 367             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L368" name="L368"></a> 368                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = t;
<a id="L369" name="L369"></a> 369                 <strong class="reserved">if</strong> (<a href="../D/13042.html" title="Multiple defined in 2 places.">compareAndSetTail</a>(t, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L370" name="L370"></a> 370                     t.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L371" name="L371"></a> 371                     <strong class="reserved">return</strong> t;
<a id="L372" name="L372"></a> 372                 <em class="brace">}</em>
<a id="L373" name="L373"></a> 373             <em class="brace">}</em>
<a id="L374" name="L374"></a> 374         <em class="brace">}</em>
<a id="L375" name="L375"></a> 375     <em class="brace">}</em>
<a id="L376" name="L376"></a> 376 
<div class="comment">
      Creates and enqueues node for current thread and given mode.
      @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared
      @return the new node</div>
<a id="L383" name="L383"></a> 383     <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/10036.html" title="Multiple referred from 12 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> mode) <em class="brace">{</em>
<a id="L384" name="L384"></a> 384         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>(), mode);
<a id="L385" name="L385"></a> 385         <em class="comment">// Try the fast path of enq; backup to full enq on failure</em>
<a id="L386" name="L386"></a> 386         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = tail;
<a id="L387" name="L387"></a> 387         <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L388" name="L388"></a> 388             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>;
<a id="L389" name="L389"></a> 389             <strong class="reserved">if</strong> (<a href="../D/13042.html" title="Multiple defined in 2 places.">compareAndSetTail</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L390" name="L390"></a> 390                 <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L391" name="L391"></a> 391                 <strong class="reserved">return</strong> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L392" name="L392"></a> 392             <em class="brace">}</em>
<a id="L393" name="L393"></a> 393         <em class="brace">}</em>
<a id="L394" name="L394"></a> 394         <a href="../D/15581.html" title="Multiple defined in 2 places.">enq</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L395" name="L395"></a> 395         <strong class="reserved">return</strong> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L396" name="L396"></a> 396     <em class="brace">}</em>
<a id="L397" name="L397"></a> 397 
<div class="comment">
      Sets head of queue to be node, thus dequeuing. Called only by
      acquire methods.  Also nulls out unused fields for sake of GC
      and to suppress unnecessary signals and traversals.
      @param node the node</div>
<a id="L405" name="L405"></a> 405     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/27494.html" title="Multiple referred from 8 places.">setHead</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L406" name="L406"></a> 406         head = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L407" name="L407"></a> 407         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L408" name="L408"></a> 408         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <strong class="reserved">null</strong>;
<a id="L409" name="L409"></a> 409     <em class="brace">}</em>
<a id="L410" name="L410"></a> 410 
<div class="comment">
      Wakes up node's successor, if one exists.
      @param node the node</div>
<a id="L416" name="L416"></a> 416     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/29742.html" title="Multiple referred from 6 places.">unparkSuccessor</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<div class="comment">
          If status is negative (i.e., possibly needing signal) try
          to clear in anticipation of signalling.  It is OK if this
          fails or if status is changed by waiting thread.</div>
<a id="L422" name="L422"></a> 422         <strong class="reserved">int</strong> ws = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus;
<a id="L423" name="L423"></a> 423         <strong class="reserved">if</strong> (ws &lt; 0)
<a id="L424" name="L424"></a> 424             <a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, ws, 0);
<a id="L425" name="L425"></a> 425 
<div class="comment">
          Thread to unpark is held in successor, which is normally
          just the next node.  But if cancelled or apparently null,
          traverse backwards from tail to find the actual
          non-cancelled successor.</div>
<a id="L432" name="L432"></a> 432         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L433" name="L433"></a> 433         <strong class="reserved">if</strong> (s == <strong class="reserved">null</strong> || s.waitStatus &gt; 0) <em class="brace">{</em>
<a id="L434" name="L434"></a> 434             s = <strong class="reserved">null</strong>;
<a id="L435" name="L435"></a> 435             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail; t != <strong class="reserved">null</strong> &amp;&amp; t != <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>; t = t.prev)
<a id="L436" name="L436"></a> 436                 <strong class="reserved">if</strong> (t.waitStatus &lt;= 0)
<a id="L437" name="L437"></a> 437                     s = t;
<a id="L438" name="L438"></a> 438         <em class="brace">}</em>
<a id="L439" name="L439"></a> 439         <strong class="reserved">if</strong> (s != <strong class="reserved">null</strong>)
<a id="L440" name="L440"></a> 440             <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(s.thread);
<a id="L441" name="L441"></a> 441     <em class="brace">}</em>
<a id="L442" name="L442"></a> 442 
<div class="comment">
      Release action for shared mode -- signals successor and ensures
      propagation. (Note: For exclusive mode, release just amounts
      to calling unparkSuccessor of head if it needs signal.)</div>
<a id="L448" name="L448"></a> 448     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13431.html" title="Multiple referred from 4 places.">doReleaseShared</a>() <em class="brace">{</em>
<div class="comment">
          Ensure that a release propagates, even if there are other
          in-progress acquires/releases.  This proceeds in the usual
          way of trying to unparkSuccessor of head if it needs
          signal. But if it does not, status is set to PROPAGATE to
          ensure that upon release, propagation continues.
          Additionally, we must loop in case a new node is added
          while we are doing this. Also, unlike other uses of
          unparkSuccessor, we need to know if CAS to reset status
          fails, if so rechecking.</div>
<a id="L460" name="L460"></a> 460         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L461" name="L461"></a> 461             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L462" name="L462"></a> 462             <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong> &amp;&amp; h != tail) <em class="brace">{</em>
<a id="L463" name="L463"></a> 463                 <strong class="reserved">int</strong> ws = h.waitStatus;
<a id="L464" name="L464"></a> 464                 <strong class="reserved">if</strong> (ws == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL) <em class="brace">{</em>
<a id="L465" name="L465"></a> 465                     <strong class="reserved">if</strong> (!<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(h, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL, 0))
<a id="L466" name="L466"></a> 466                         <strong class="reserved">continue</strong>;            <em class="comment">// loop to recheck cases</em>
<a id="L467" name="L467"></a> 467                     <a href="../D/35953.html" title="Multiple defined in 2 places.">unparkSuccessor</a>(h);
<a id="L468" name="L468"></a> 468                 <em class="brace">}</em>
<a id="L469" name="L469"></a> 469                 <strong class="reserved">else</strong> <strong class="reserved">if</strong> (ws == 0 &amp;&amp;
<a id="L470" name="L470"></a> 470                          !<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(h, 0, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.PROPAGATE))
<a id="L471" name="L471"></a> 471                     <strong class="reserved">continue</strong>;                <em class="comment">// loop on failed CAS</em>
<a id="L472" name="L472"></a> 472             <em class="brace">}</em>
<a id="L473" name="L473"></a> 473             <strong class="reserved">if</strong> (h == head)                   <em class="comment">// loop if head changed</em>
<a id="L474" name="L474"></a> 474                 <strong class="reserved">break</strong>;
<a id="L475" name="L475"></a> 475         <em class="brace">}</em>
<a id="L476" name="L476"></a> 476     <em class="brace">}</em>
<a id="L477" name="L477"></a> 477 
<div class="comment">
      Sets head of queue, and checks if successor may be waiting
      in shared mode, if so propagating if either propagate &gt; 0 or
      PROPAGATE status was set.
      @param node the node
      @param propagate the return value from a tryAcquireShared</div>
<a id="L486" name="L486"></a> 486     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/27495.html" title="Multiple referred from 6 places.">setHeadAndPropagate</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">long</strong> propagate) <em class="brace">{</em>
<a id="L487" name="L487"></a> 487         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head; <em class="comment">// Record old head for check below</em>
<a id="L488" name="L488"></a> 488         <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<div class="comment">
          Try to signal next queued node if:
            Propagation was indicated by caller,
              or was recorded (as h.waitStatus either before
              or after setHead) by a previous operation
              (note: this uses sign-check of waitStatus because
               PROPAGATE status may transition to SIGNAL.)
          and
            The next node is waiting in shared mode,
              or we don't know, because it appears null
          The conservatism in both of these checks may cause
          unnecessary wake-ups, but only when there are multiple
          racing acquires/releases, so most need signals now or soon
          anyway.</div>
<a id="L505" name="L505"></a> 505         <strong class="reserved">if</strong> (propagate &gt; 0 || h == <strong class="reserved">null</strong> || h.waitStatus &lt; 0 ||
<a id="L506" name="L506"></a> 506             (h = head) == <strong class="reserved">null</strong> || h.waitStatus &lt; 0) <em class="brace">{</em>
<a id="L507" name="L507"></a> 507             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L508" name="L508"></a> 508             <strong class="reserved">if</strong> (s == <strong class="reserved">null</strong> || s.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>())
<a id="L509" name="L509"></a> 509                 <a href="../D/15071.html" title="Multiple defined in 2 places.">doReleaseShared</a>();
<a id="L510" name="L510"></a> 510         <em class="brace">}</em>
<a id="L511" name="L511"></a> 511     <em class="brace">}</em>
<a id="L512" name="L512"></a> 512 
<a id="L513" name="L513"></a> 513     <em class="comment">// Utilities for various versions of acquire</em>
<a id="L514" name="L514"></a> 514 
<div class="comment">
      Cancels an ongoing attempt to acquire.
      @param node the node</div>
<a id="L520" name="L520"></a> 520     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10919.html" title="Multiple referred from 12 places.">cancelAcquire</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L521" name="L521"></a> 521         <em class="comment">// Ignore if node doesn't exist</em>
<a id="L522" name="L522"></a> 522         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == <strong class="reserved">null</strong>)
<a id="L523" name="L523"></a> 523             <strong class="reserved">return</strong>;
<a id="L524" name="L524"></a> 524 
<a id="L525" name="L525"></a> 525         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread = <strong class="reserved">null</strong>;
<a id="L526" name="L526"></a> 526 
<a id="L527" name="L527"></a> 527         <em class="comment">// Skip cancelled predecessors</em>
<a id="L528" name="L528"></a> 528         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev;
<a id="L529" name="L529"></a> 529         <strong class="reserved">while</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus &gt; 0)
<a id="L530" name="L530"></a> 530             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.prev;
<a id="L531" name="L531"></a> 531 
<a id="L532" name="L532"></a> 532         <em class="comment">// predNext is the apparent node to unsplice. CASes below will</em>
<a id="L533" name="L533"></a> 533         <em class="comment">// fail if not, in which case, we lost race vs another cancel</em>
<a id="L534" name="L534"></a> 534         <em class="comment">// or signal, so no further action is necessary.</em>
<a id="L535" name="L535"></a> 535         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> predNext = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L536" name="L536"></a> 536 
<a id="L537" name="L537"></a> 537         <em class="comment">// Can use unconditional write instead of CAS here.</em>
<a id="L538" name="L538"></a> 538         <em class="comment">// After this atomic step, other Nodes can skip past us.</em>
<a id="L539" name="L539"></a> 539         <em class="comment">// Before, we are free of interference from other threads.</em>
<a id="L540" name="L540"></a> 540         <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus = <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CANCELLED;
<a id="L541" name="L541"></a> 541 
<a id="L542" name="L542"></a> 542         <em class="comment">// If we are the tail, remove ourselves.</em>
<a id="L543" name="L543"></a> 543         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> == tail &amp;&amp; <a href="../D/13042.html" title="Multiple defined in 2 places.">compareAndSetTail</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>)) <em class="brace">{</em>
<a id="L544" name="L544"></a> 544             <a href="../D/13038.html" title="Multiple defined in 2 places.">compareAndSetNext</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, predNext, <strong class="reserved">null</strong>);
<a id="L545" name="L545"></a> 545         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L546" name="L546"></a> 546             <em class="comment">// If successor needs signal, try to set pred's next-link</em>
<a id="L547" name="L547"></a> 547             <em class="comment">// so it will get one. Otherwise wake it up to propagate.</em>
<a id="L548" name="L548"></a> 548             <strong class="reserved">int</strong> ws;
<a id="L549" name="L549"></a> 549             <strong class="reserved">if</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> != head &amp;&amp;
<a id="L550" name="L550"></a> 550                 ((ws = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus) == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL ||
<a id="L551" name="L551"></a> 551                  (ws &lt;= 0 &amp;&amp; <a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, ws, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL))) &amp;&amp;
<a id="L552" name="L552"></a> 552                 <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.thread != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L553" name="L553"></a> 553                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L554" name="L554"></a> 554                 <strong class="reserved">if</strong> (<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != <strong class="reserved">null</strong> &amp;&amp; <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>.waitStatus &lt;= 0)
<a id="L555" name="L555"></a> 555                     <a href="../D/13038.html" title="Multiple defined in 2 places.">compareAndSetNext</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, predNext, <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>);
<a id="L556" name="L556"></a> 556             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L557" name="L557"></a> 557                 <a href="../D/35953.html" title="Multiple defined in 2 places.">unparkSuccessor</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L558" name="L558"></a> 558             <em class="brace">}</em>
<a id="L559" name="L559"></a> 559 
<a id="L560" name="L560"></a> 560             <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>; <em class="comment">// help GC</em>
<a id="L561" name="L561"></a> 561         <em class="brace">}</em>
<a id="L562" name="L562"></a> 562     <em class="brace">}</em>
<a id="L563" name="L563"></a> 563 
<div class="comment">
      Checks and updates status for a node that failed to acquire.
      Returns true if thread should block. This is the main signal
      control in all acquire loops.  Requires that pred == node.prev.
      @param pred node's predecessor holding status
      @param node the node
      @return <code>true</code> if thread should block</div>
<a id="L573" name="L573"></a> 573     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> <a href="../R/28538.html" title="Multiple referred from 12 places.">shouldParkAfterFailedAcquire</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L574" name="L574"></a> 574         <strong class="reserved">int</strong> ws = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus;
<a id="L575" name="L575"></a> 575         <strong class="reserved">if</strong> (ws == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL)
<div class="comment">
              This node has already set status asking a release
              to signal it, so it can safely park.</div>
<a id="L580" name="L580"></a> 580             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L581" name="L581"></a> 581         <strong class="reserved">if</strong> (ws &gt; 0) <em class="brace">{</em>
<div class="comment">
              Predecessor was cancelled. Skip over predecessors and
              indicate retry.</div>
<a id="L586" name="L586"></a> 586             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L587" name="L587"></a> 587                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a> = <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.prev;
<a id="L588" name="L588"></a> 588             <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.waitStatus &gt; 0);
<a id="L589" name="L589"></a> 589             <a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L590" name="L590"></a> 590         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
              waitStatus must be 0 or PROPAGATE.  Indicate that we
              need a signal, but don't park yet.  Caller will need to
              retry to make sure it cannot acquire before parking.</div>
<a id="L596" name="L596"></a> 596             <a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../S/1076.html#L734" title="Defined at 734 in src/java/util/concurrent/ConcurrentLinkedDeque.java.">pred</a>, ws, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL);
<a id="L597" name="L597"></a> 597         <em class="brace">}</em>
<a id="L598" name="L598"></a> 598         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L599" name="L599"></a> 599     <em class="brace">}</em>
<a id="L600" name="L600"></a> 600 
<div class="comment">
      Convenience method to interrupt current thread.</div>
<a id="L604" name="L604"></a> 604     <strong class="reserved">static</strong> <strong class="reserved">void</strong> <a href="../R/26756.html" title="Multiple referred from 8 places.">selfInterrupt</a>() <em class="brace">{</em>
<a id="L605" name="L605"></a> 605         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>().<a href="../D/24969.html" title="Multiple defined in 3 places.">interrupt</a>();
<a id="L606" name="L606"></a> 606     <em class="brace">}</em>
<a id="L607" name="L607"></a> 607 
<div class="comment">
      Convenience method to park and then check if interrupted
      @return <code>true</code> if interrupted</div>
<a id="L613" name="L613"></a> 613     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/24490.html" title="Multiple referred from 8 places.">parkAndCheckInterrupt</a>() <em class="brace">{</em>
<a id="L614" name="L614"></a> 614         <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L615" name="L615"></a> 615         <strong class="reserved">return</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>();
<a id="L616" name="L616"></a> 616     <em class="brace">}</em>
<a id="L617" name="L617"></a> 617 
<div class="comment">
      Various flavors of acquire, varying in exclusive/shared and
      control modes.  Each is mostly the same, but annoyingly
      different.  Only a little bit of factoring is possible due to
      interactions of exception mechanics (including ensuring that we
      cancel if tryAcquire throws exception) and other control, at
      least not without hurting performance too much.</div>
<a id="L626" name="L626"></a> 626 
<div class="comment">
      Acquires in exclusive uninterruptible mode for thread already in
      queue. Used by condition wait methods as well as acquire.
      @param node the node
      @param arg the acquire argument
      @return <code>true</code> if interrupted while waiting</div>
<a id="L635" name="L635"></a> 635     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/9552.html" title="Multiple referred from 12 places.">acquireQueued</a>(<strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L636" name="L636"></a> 636         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L637" name="L637"></a> 637         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L638" name="L638"></a> 638             <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">false</strong>;
<a id="L639" name="L639"></a> 639             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L640" name="L640"></a> 640                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L641" name="L641"></a> 641                 <strong class="reserved">if</strong> (p == head &amp;&amp; <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L642" name="L642"></a> 642                     <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L643" name="L643"></a> 643                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L644" name="L644"></a> 644                     <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L645" name="L645"></a> 645                     <strong class="reserved">return</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>;
<a id="L646" name="L646"></a> 646                 <em class="brace">}</em>
<a id="L647" name="L647"></a> 647                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L648" name="L648"></a> 648                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L649" name="L649"></a> 649                     <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">true</strong>;
<a id="L650" name="L650"></a> 650             <em class="brace">}</em>
<a id="L651" name="L651"></a> 651         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L652" name="L652"></a> 652             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L653" name="L653"></a> 653                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L654" name="L654"></a> 654         <em class="brace">}</em>
<a id="L655" name="L655"></a> 655     <em class="brace">}</em>
<a id="L656" name="L656"></a> 656 
<div class="comment">
      Acquires in exclusive interruptible mode.
      @param arg the acquire argument</div>
<a id="L661" name="L661"></a> 661     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13372.html" title="Multiple referred from 2 places.">doAcquireInterruptibly</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L662" name="L662"></a> 662         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L663" name="L663"></a> 663         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.EXCLUSIVE);
<a id="L664" name="L664"></a> 664         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L665" name="L665"></a> 665         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L666" name="L666"></a> 666             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L667" name="L667"></a> 667                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L668" name="L668"></a> 668                 <strong class="reserved">if</strong> (p == head &amp;&amp; <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L669" name="L669"></a> 669                     <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L670" name="L670"></a> 670                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L671" name="L671"></a> 671                     <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L672" name="L672"></a> 672                     <strong class="reserved">return</strong>;
<a id="L673" name="L673"></a> 673                 <em class="brace">}</em>
<a id="L674" name="L674"></a> 674                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L675" name="L675"></a> 675                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L676" name="L676"></a> 676                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L677" name="L677"></a> 677             <em class="brace">}</em>
<a id="L678" name="L678"></a> 678         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L679" name="L679"></a> 679             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L680" name="L680"></a> 680                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L681" name="L681"></a> 681         <em class="brace">}</em>
<a id="L682" name="L682"></a> 682     <em class="brace">}</em>
<a id="L683" name="L683"></a> 683 
<div class="comment">
      Acquires in exclusive timed mode.
      @param arg the acquire argument
      @param nanosTimeout max wait time
      @return <code>true</code> if acquired</div>
<a id="L691" name="L691"></a> 691     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/13373.html" title="Multiple referred from 2 places.">doAcquireNanos</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L692" name="L692"></a> 692             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L693" name="L693"></a> 693         <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L694" name="L694"></a> 694             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L695" name="L695"></a> 695         <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L696" name="L696"></a> 696         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.EXCLUSIVE);
<a id="L697" name="L697"></a> 697         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L698" name="L698"></a> 698         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L699" name="L699"></a> 699             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L700" name="L700"></a> 700                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L701" name="L701"></a> 701                 <strong class="reserved">if</strong> (p == head &amp;&amp; <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L702" name="L702"></a> 702                     <a href="../D/32835.html" title="Multiple defined in 2 places.">setHead</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L703" name="L703"></a> 703                     p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L704" name="L704"></a> 704                     <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L705" name="L705"></a> 705                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L706" name="L706"></a> 706                 <em class="brace">}</em>
<a id="L707" name="L707"></a> 707                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L708" name="L708"></a> 708                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L709" name="L709"></a> 709                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L710" name="L710"></a> 710                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L711" name="L711"></a> 711                     nanosTimeout &gt; spinForTimeoutThreshold)
<a id="L712" name="L712"></a> 712                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L713" name="L713"></a> 713                 <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L714" name="L714"></a> 714                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L715" name="L715"></a> 715             <em class="brace">}</em>
<a id="L716" name="L716"></a> 716         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L717" name="L717"></a> 717             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L718" name="L718"></a> 718                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L719" name="L719"></a> 719         <em class="brace">}</em>
<a id="L720" name="L720"></a> 720     <em class="brace">}</em>
<a id="L721" name="L721"></a> 721 
<div class="comment">
      Acquires in shared uninterruptible mode.
      @param arg the acquire argument</div>
<a id="L726" name="L726"></a> 726     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13374.html" title="Multiple referred from 2 places.">doAcquireShared</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L727" name="L727"></a> 727         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SHARED);
<a id="L728" name="L728"></a> 728         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L729" name="L729"></a> 729         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L730" name="L730"></a> 730             <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">false</strong>;
<a id="L731" name="L731"></a> 731             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L732" name="L732"></a> 732                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L733" name="L733"></a> 733                 <strong class="reserved">if</strong> (p == head) <em class="brace">{</em>
<a id="L734" name="L734"></a> 734                     <strong class="reserved">long</strong> r = <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L735" name="L735"></a> 735                     <strong class="reserved">if</strong> (r &gt;= 0) <em class="brace">{</em>
<a id="L736" name="L736"></a> 736                         <a href="../D/32836.html" title="Multiple defined in 2 places.">setHeadAndPropagate</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, r);
<a id="L737" name="L737"></a> 737                         p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L738" name="L738"></a> 738                         <strong class="reserved">if</strong> (<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>)
<a id="L739" name="L739"></a> 739                             <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L740" name="L740"></a> 740                         <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L741" name="L741"></a> 741                         <strong class="reserved">return</strong>;
<a id="L742" name="L742"></a> 742                     <em class="brace">}</em>
<a id="L743" name="L743"></a> 743                 <em class="brace">}</em>
<a id="L744" name="L744"></a> 744                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L745" name="L745"></a> 745                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L746" name="L746"></a> 746                     <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">true</strong>;
<a id="L747" name="L747"></a> 747             <em class="brace">}</em>
<a id="L748" name="L748"></a> 748         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L749" name="L749"></a> 749             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L750" name="L750"></a> 750                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L751" name="L751"></a> 751         <em class="brace">}</em>
<a id="L752" name="L752"></a> 752     <em class="brace">}</em>
<a id="L753" name="L753"></a> 753 
<div class="comment">
      Acquires in shared interruptible mode.
      @param arg the acquire argument</div>
<a id="L758" name="L758"></a> 758     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13375.html" title="Multiple referred from 2 places.">doAcquireSharedInterruptibly</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L759" name="L759"></a> 759         <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L760" name="L760"></a> 760         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SHARED);
<a id="L761" name="L761"></a> 761         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L762" name="L762"></a> 762         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L763" name="L763"></a> 763             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L764" name="L764"></a> 764                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L765" name="L765"></a> 765                 <strong class="reserved">if</strong> (p == head) <em class="brace">{</em>
<a id="L766" name="L766"></a> 766                     <strong class="reserved">long</strong> r = <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L767" name="L767"></a> 767                     <strong class="reserved">if</strong> (r &gt;= 0) <em class="brace">{</em>
<a id="L768" name="L768"></a> 768                         <a href="../D/32836.html" title="Multiple defined in 2 places.">setHeadAndPropagate</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, r);
<a id="L769" name="L769"></a> 769                         p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L770" name="L770"></a> 770                         <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L771" name="L771"></a> 771                         <strong class="reserved">return</strong>;
<a id="L772" name="L772"></a> 772                     <em class="brace">}</em>
<a id="L773" name="L773"></a> 773                 <em class="brace">}</em>
<a id="L774" name="L774"></a> 774                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L775" name="L775"></a> 775                     <a href="../D/29073.html" title="Multiple defined in 2 places.">parkAndCheckInterrupt</a>())
<a id="L776" name="L776"></a> 776                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L777" name="L777"></a> 777             <em class="brace">}</em>
<a id="L778" name="L778"></a> 778         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L779" name="L779"></a> 779             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L780" name="L780"></a> 780                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L781" name="L781"></a> 781         <em class="brace">}</em>
<a id="L782" name="L782"></a> 782     <em class="brace">}</em>
<a id="L783" name="L783"></a> 783 
<div class="comment">
      Acquires in shared timed mode.
      @param arg the acquire argument
      @param nanosTimeout max wait time
      @return <code>true</code> if acquired</div>
<a id="L791" name="L791"></a> 791     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/13376.html" title="Multiple referred from 2 places.">doAcquireSharedNanos</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L792" name="L792"></a> 792             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L793" name="L793"></a> 793         <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L794" name="L794"></a> 794             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L795" name="L795"></a> 795         <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L796" name="L796"></a> 796         <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SHARED);
<a id="L797" name="L797"></a> 797         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L798" name="L798"></a> 798         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L799" name="L799"></a> 799             <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L800" name="L800"></a> 800                 <strong class="reserved">final</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/29535.html" title="Multiple defined in 5 places.">predecessor</a>();
<a id="L801" name="L801"></a> 801                 <strong class="reserved">if</strong> (p == head) <em class="brace">{</em>
<a id="L802" name="L802"></a> 802                     <strong class="reserved">long</strong> r = <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L803" name="L803"></a> 803                     <strong class="reserved">if</strong> (r &gt;= 0) <em class="brace">{</em>
<a id="L804" name="L804"></a> 804                         <a href="../D/32836.html" title="Multiple defined in 2 places.">setHeadAndPropagate</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, r);
<a id="L805" name="L805"></a> 805                         p.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <strong class="reserved">null</strong>; <em class="comment">// help GC</em>
<a id="L806" name="L806"></a> 806                         <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L807" name="L807"></a> 807                         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L808" name="L808"></a> 808                     <em class="brace">}</em>
<a id="L809" name="L809"></a> 809                 <em class="brace">}</em>
<a id="L810" name="L810"></a> 810                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L811" name="L811"></a> 811                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L)
<a id="L812" name="L812"></a> 812                     <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L813" name="L813"></a> 813                 <strong class="reserved">if</strong> (<a href="../D/34483.html" title="Multiple defined in 2 places.">shouldParkAfterFailedAcquire</a>(p, <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) &amp;&amp;
<a id="L814" name="L814"></a> 814                     nanosTimeout &gt; spinForTimeoutThreshold)
<a id="L815" name="L815"></a> 815                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L816" name="L816"></a> 816                 <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L817" name="L817"></a> 817                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L818" name="L818"></a> 818             <em class="brace">}</em>
<a id="L819" name="L819"></a> 819         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L820" name="L820"></a> 820             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L821" name="L821"></a> 821                 <a href="../D/12193.html" title="Multiple defined in 2 places.">cancelAcquire</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L822" name="L822"></a> 822         <em class="brace">}</em>
<a id="L823" name="L823"></a> 823     <em class="brace">}</em>
<a id="L824" name="L824"></a> 824 
<a id="L825" name="L825"></a> 825     <em class="comment">// Main exported methods</em>
<a id="L826" name="L826"></a> 826 
<div class="comment">
      Attempts to acquire in exclusive mode. This method should query
      if the state of the object permits it to be acquired in the
      exclusive mode, and if so to acquire it.
      <p>This method is always invoked by the thread performing
      acquire.  If this method reports failure, the acquire method
      may queue the thread, if it is not already queued, until it is
      signalled by a release from some other thread. This can be used
      to implement method {@link Lock#tryLock()}.
      </p><p>The default
      implementation throws {@link UnsupportedOperationException}.
      @param arg the acquire argument. This value is always the one
             passed to an acquire method, or is the value saved on entry
             to a condition wait.  The value is otherwise uninterpreted
             and can represent anything you like.
      @return <code>true</code> if successful. Upon success, this object has
              been acquired.
      @throws IllegalMonitorStateException if acquiring would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if exclusive mode is not supported</p></div>
<a id="L853" name="L853"></a> 853     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/29536.html" title="Multiple referred from 13 places.">tryAcquire</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L854" name="L854"></a> 854         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L855" name="L855"></a> 855     <em class="brace">}</em>
<a id="L856" name="L856"></a> 856 
<div class="comment">
      Attempts to set the state to reflect a release in exclusive
      mode.
      <p>This method is always invoked by the thread performing release.
      </p><p>The default implementation throws
      {@link UnsupportedOperationException}.
      @param arg the release argument. This value is always the one
             passed to a release method, or the current state value upon
             entry to a condition wait.  The value is otherwise
             uninterpreted and can represent anything you like.
      @return <code>true</code> if this object is now in a fully released
              state, so that any waiting threads may attempt to acquire;
              and <code>false</code> otherwise.
      @throws IllegalMonitorStateException if releasing would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if exclusive mode is not supported</p></div>
<a id="L879" name="L879"></a> 879     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/29560.html" title="Multiple referred from 7 places.">tryRelease</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L880" name="L880"></a> 880         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L881" name="L881"></a> 881     <em class="brace">}</em>
<a id="L882" name="L882"></a> 882 
<div class="comment">
      Attempts to acquire in shared mode. This method should query if
      the state of the object permits it to be acquired in the shared
      mode, and if so to acquire it.
      <p>This method is always invoked by the thread performing
      acquire.  If this method reports failure, the acquire method
      may queue the thread, if it is not already queued, until it is
      signalled by a release from some other thread.
      </p><p>The default implementation throws {@link
      UnsupportedOperationException}.
      @param arg the acquire argument. This value is always the one
             passed to an acquire method, or is the value saved on entry
             to a condition wait.  The value is otherwise uninterpreted
             and can represent anything you like.
      @return a negative value on failure; zero if acquisition in shared
              mode succeeded but no subsequent shared-mode acquire can
              succeed; and a positive value if acquisition in shared
              mode succeeded and subsequent shared-mode acquires might
              also succeed, in which case a subsequent waiting thread
              must check availability. (Support for three different
              return values enables this method to be used in contexts
              where acquires only sometimes act exclusively.)  Upon
              success, this object has been acquired.
      @throws IllegalMonitorStateException if acquiring would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if shared mode is not supported</p></div>
<a id="L915" name="L915"></a> 915     <strong class="reserved">protected</strong> <strong class="reserved">long</strong> <a href="../R/29538.html" title="Multiple referred from 12 places.">tryAcquireShared</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L916" name="L916"></a> 916         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L917" name="L917"></a> 917     <em class="brace">}</em>
<a id="L918" name="L918"></a> 918 
<div class="comment">
      Attempts to set the state to reflect a release in shared mode.
      <p>This method is always invoked by the thread performing release.
      </p><p>The default implementation throws
      {@link UnsupportedOperationException}.
      @param arg the release argument. This value is always the one
             passed to a release method, or the current state value upon
             entry to a condition wait.  The value is otherwise
             uninterpreted and can represent anything you like.
      @return <code>true</code> if this release of shared mode may permit a
              waiting acquire (shared or exclusive) to succeed; and
              <code>false</code> otherwise
      @throws IllegalMonitorStateException if releasing would place this
              synchronizer in an illegal state. This exception must be
              thrown in a consistent fashion for synchronization to work
              correctly.
      @throws UnsupportedOperationException if shared mode is not supported</p></div>
<a id="L940" name="L940"></a> 940     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/29561.html" title="Multiple referred from 2 places.">tryReleaseShared</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L941" name="L941"></a> 941         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L942" name="L942"></a> 942     <em class="brace">}</em>
<a id="L943" name="L943"></a> 943 
<div class="comment">
      Returns <code>true</code> if synchronization is held exclusively with
      respect to the current (calling) thread.  This method is invoked
      upon each call to a non-waiting {@link ConditionObject} method.
      (Waiting methods instead invoke {@link #release}.)
      <p>The default implementation throws {@link
      UnsupportedOperationException}. This method is invoked
      internally only within {@link ConditionObject} methods, so need
      not be defined if conditions are not used.
      @return <code>true</code> if synchronization is held exclusively;
              <code>false</code> otherwise
      @throws UnsupportedOperationException if conditions are not supported</p></div>
<a id="L959" name="L959"></a> 959     <strong class="reserved">protected</strong> <strong class="reserved">boolean</strong> <a href="../R/21524.html" title="Multiple referred from 17 places.">isHeldExclusively</a>() <em class="brace">{</em>
<a id="L960" name="L960"></a> 960         <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1777.html#L38" title="Defined at 38 in src/java/lang/UnsupportedOperationException.java.">UnsupportedOperationException</a>();
<a id="L961" name="L961"></a> 961     <em class="brace">}</em>
<a id="L962" name="L962"></a> 962 
<div class="comment">
      Acquires in exclusive mode, ignoring interrupts.  Implemented
      by invoking at least once {@link #tryAcquire},
      returning on success.  Otherwise the thread is queued, possibly
      repeatedly blocking and unblocking, invoking {@link
      #tryAcquire} until success.  This method can be used
      to implement method {@link Lock#lock}.
      @param arg the acquire argument.  This value is conveyed to
             {@link #tryAcquire} but is otherwise uninterpreted and
             can represent anything you like.</div>
<a id="L975" name="L975"></a> 975     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9543.html" title="Multiple referred from 7 places.">acquire</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L976" name="L976"></a> 976         <strong class="reserved">if</strong> (!<a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &amp;&amp;
<a id="L977" name="L977"></a> 977             <a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/11167.html" title="Multiple defined in 2 places.">addWaiter</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.EXCLUSIVE), <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>))
<a id="L978" name="L978"></a> 978             <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L979" name="L979"></a> 979     <em class="brace">}</em>
<a id="L980" name="L980"></a> 980 
<div class="comment">
      Acquires in exclusive mode, aborting if interrupted.
      Implemented by first checking interrupt status, then invoking
      at least once {@link #tryAcquire}, returning on
      success.  Otherwise the thread is queued, possibly repeatedly
      blocking and unblocking, invoking {@link #tryAcquire}
      until success or the thread is interrupted.  This method can be
      used to implement method {@link Lock#lockInterruptibly}.
      @param arg the acquire argument.  This value is conveyed to
             {@link #tryAcquire} but is otherwise uninterpreted and
             can represent anything you like.
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L995" name="L995"></a> 995     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9548.html" title="Multiple referred from 2 places.">acquireInterruptibly</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L996" name="L996"></a> 996             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L997" name="L997"></a> 997         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L998" name="L998"></a> 998             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L999" name="L999"></a> 999         <strong class="reserved">if</strong> (!<a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>))
<a id="L1000" name="L1000"></a>1000             <a href="../D/15007.html" title="Multiple defined in 2 places.">doAcquireInterruptibly</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1001" name="L1001"></a>1001     <em class="brace">}</em>
<a id="L1002" name="L1002"></a>1002 
<div class="comment">
      Attempts to acquire in exclusive mode, aborting if interrupted,
      and failing if the given timeout elapses.  Implemented by first
      checking interrupt status, then invoking at least once {@link
      #tryAcquire}, returning on success.  Otherwise, the thread is
      queued, possibly repeatedly blocking and unblocking, invoking
      {@link #tryAcquire} until success or the thread is interrupted
      or the timeout elapses.  This method can be used to implement
      method {@link Lock#tryLock(long, TimeUnit)}.
      @param arg the acquire argument.  This value is conveyed to
             {@link #tryAcquire} but is otherwise uninterpreted and
             can represent anything you like.
      @param nanosTimeout the maximum number of nanoseconds to wait
      @return <code>true</code> if acquired; <code>false</code> if timed out
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1020" name="L1020"></a>1020     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29537.html" title="Multiple referred from 2 places.">tryAcquireNanos</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L1021" name="L1021"></a>1021             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1022" name="L1022"></a>1022         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1023" name="L1023"></a>1023             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1024" name="L1024"></a>1024         <strong class="reserved">return</strong> <a href="../D/35707.html" title="Multiple defined in 10 places.">tryAcquire</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) ||
<a id="L1025" name="L1025"></a>1025             <a href="../D/15008.html" title="Multiple defined in 2 places.">doAcquireNanos</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, nanosTimeout);
<a id="L1026" name="L1026"></a>1026     <em class="brace">}</em>
<a id="L1027" name="L1027"></a>1027 
<div class="comment">
      Releases in exclusive mode.  Implemented by unblocking one or
      more threads if {@link #tryRelease} returns true.
      This method can be used to implement method {@link Lock#unlock}.
      @param arg the release argument.  This value is conveyed to
             {@link #tryRelease} but is otherwise uninterpreted and
             can represent anything you like.
      @return the value returned from {@link #tryRelease}</div>
<a id="L1038" name="L1038"></a>1038     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/25846.html" title="Multiple referred from 40 places.">release</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1039" name="L1039"></a>1039         <strong class="reserved">if</strong> (<a href="../D/35735.html" title="Multiple defined in 6 places.">tryRelease</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L1040" name="L1040"></a>1040             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L1041" name="L1041"></a>1041             <strong class="reserved">if</strong> (h != <strong class="reserved">null</strong> &amp;&amp; h.waitStatus != 0)
<a id="L1042" name="L1042"></a>1042                 <a href="../D/35953.html" title="Multiple defined in 2 places.">unparkSuccessor</a>(h);
<a id="L1043" name="L1043"></a>1043             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1044" name="L1044"></a>1044         <em class="brace">}</em>
<a id="L1045" name="L1045"></a>1045         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1046" name="L1046"></a>1046     <em class="brace">}</em>
<a id="L1047" name="L1047"></a>1047 
<div class="comment">
      Acquires in shared mode, ignoring interrupts.  Implemented by
      first invoking at least once {@link #tryAcquireShared},
      returning on success.  Otherwise the thread is queued, possibly
      repeatedly blocking and unblocking, invoking {@link
      #tryAcquireShared} until success.
      @param arg the acquire argument.  This value is conveyed to
             {@link #tryAcquireShared} but is otherwise uninterpreted
             and can represent anything you like.</div>
<a id="L1059" name="L1059"></a>1059     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9554.html" title="Multiple referred from 3 places.">acquireShared</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1060" name="L1060"></a>1060         <strong class="reserved">if</strong> (<a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &lt; 0)
<a id="L1061" name="L1061"></a>1061             <a href="../D/15009.html" title="Multiple defined in 2 places.">doAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1062" name="L1062"></a>1062     <em class="brace">}</em>
<a id="L1063" name="L1063"></a>1063 
<div class="comment">
      Acquires in shared mode, aborting if interrupted.  Implemented
      by first checking interrupt status, then invoking at least once
      {@link #tryAcquireShared}, returning on success.  Otherwise the
      thread is queued, possibly repeatedly blocking and unblocking,
      invoking {@link #tryAcquireShared} until success or the thread
      is interrupted.
      @param arg the acquire argument.
      This value is conveyed to {@link #tryAcquireShared} but is
      otherwise uninterpreted and can represent anything
      you like.
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1077" name="L1077"></a>1077     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/9555.html" title="Multiple referred from 4 places.">acquireSharedInterruptibly</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)
<a id="L1078" name="L1078"></a>1078             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1079" name="L1079"></a>1079         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1080" name="L1080"></a>1080             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1081" name="L1081"></a>1081         <strong class="reserved">if</strong> (<a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &lt; 0)
<a id="L1082" name="L1082"></a>1082             <a href="../D/15010.html" title="Multiple defined in 2 places.">doAcquireSharedInterruptibly</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>);
<a id="L1083" name="L1083"></a>1083     <em class="brace">}</em>
<a id="L1084" name="L1084"></a>1084 
<div class="comment">
      Attempts to acquire in shared mode, aborting if interrupted, and
      failing if the given timeout elapses.  Implemented by first
      checking interrupt status, then invoking at least once {@link
      #tryAcquireShared}, returning on success.  Otherwise, the
      thread is queued, possibly repeatedly blocking and unblocking,
      invoking {@link #tryAcquireShared} until success or the thread
      is interrupted or the timeout elapses.
      @param arg the acquire argument.  This value is conveyed to
             {@link #tryAcquireShared} but is otherwise uninterpreted
             and can represent anything you like.
      @param nanosTimeout the maximum number of nanoseconds to wait
      @return <code>true</code> if acquired; <code>false</code> if timed out
      @throws InterruptedException if the current thread is interrupted</div>
<a id="L1101" name="L1101"></a>1101     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29539.html" title="Multiple referred from 4 places.">tryAcquireSharedNanos</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, <strong class="reserved">long</strong> nanosTimeout)
<a id="L1102" name="L1102"></a>1102             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1103" name="L1103"></a>1103         <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1104" name="L1104"></a>1104             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1105" name="L1105"></a>1105         <strong class="reserved">return</strong> <a href="../D/35709.html" title="Multiple defined in 6 places.">tryAcquireShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) &gt;= 0 ||
<a id="L1106" name="L1106"></a>1106             <a href="../D/15011.html" title="Multiple defined in 2 places.">doAcquireSharedNanos</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>, nanosTimeout);
<a id="L1107" name="L1107"></a>1107     <em class="brace">}</em>
<a id="L1108" name="L1108"></a>1108 
<div class="comment">
      Releases in shared mode.  Implemented by unblocking one or more
      threads if {@link #tryReleaseShared} returns true.
      @param arg the release argument.  This value is conveyed to
             {@link #tryReleaseShared} but is otherwise uninterpreted
             and can represent anything you like.
      @return the value returned from {@link #tryReleaseShared}</div>
<a id="L1118" name="L1118"></a>1118     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/25864.html" title="Multiple referred from 4 places.">releaseShared</a>(<strong class="reserved">long</strong> <a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>) <em class="brace">{</em>
<a id="L1119" name="L1119"></a>1119         <strong class="reserved">if</strong> (<a href="../D/35736.html" title="Multiple defined in 5 places.">tryReleaseShared</a>(<a href="../D/11479.html" title="Multiple defined in 2 places.">arg</a>)) <em class="brace">{</em>
<a id="L1120" name="L1120"></a>1120             <a href="../D/15071.html" title="Multiple defined in 2 places.">doReleaseShared</a>();
<a id="L1121" name="L1121"></a>1121             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1122" name="L1122"></a>1122         <em class="brace">}</em>
<a id="L1123" name="L1123"></a>1123         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1124" name="L1124"></a>1124     <em class="brace">}</em>
<a id="L1125" name="L1125"></a>1125 
<a id="L1126" name="L1126"></a>1126     <em class="comment">// Queue inspection methods</em>
<a id="L1127" name="L1127"></a>1127 
<div class="comment">
      Queries whether any threads are waiting to acquire. Note that
      because cancellations due to interrupts and timeouts may occur
      at any time, a <code>true</code> return does not guarantee that any
      other thread will ever acquire.
      <p>In this implementation, this operation returns in
      constant time.
      @return <code>true</code> if there may be other threads waiting to acquire</p></div>
<a id="L1139" name="L1139"></a>1139     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20258.html" title="Multiple referred from 5 places.">hasQueuedThreads</a>() <em class="brace">{</em>
<a id="L1140" name="L1140"></a>1140         <strong class="reserved">return</strong> head != tail;
<a id="L1141" name="L1141"></a>1141     <em class="brace">}</em>
<a id="L1142" name="L1142"></a>1142 
<div class="comment">
      Queries whether any threads have ever contended to acquire this
      synchronizer; that is if an acquire method has ever blocked.
      <p>In this implementation, this operation returns in
      constant time.
      @return <code>true</code> if there has ever been contention</p></div>
<a id="L1152" name="L1152"></a>1152     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> hasContended() <em class="brace">{</em>
<a id="L1153" name="L1153"></a>1153         <strong class="reserved">return</strong> head != <strong class="reserved">null</strong>;
<a id="L1154" name="L1154"></a>1154     <em class="brace">}</em>
<a id="L1155" name="L1155"></a>1155 
<div class="comment">
      Returns the first (longest-waiting) thread in the queue, or
      <code>null</code> if no threads are currently queued.
      <p>In this implementation, this operation normally returns in
      constant time, but may iterate upon contention if other threads are
      concurrently modifying the queue.
      @return the first (longest-waiting) thread in the queue, or
              <code>null</code> if no threads are currently queued</p></div>
<a id="L1167" name="L1167"></a>1167     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> getFirstQueuedThread() <em class="brace">{</em>
<a id="L1168" name="L1168"></a>1168         <em class="comment">// handle only fast path, else relay</em>
<a id="L1169" name="L1169"></a>1169         <strong class="reserved">return</strong> (head == tail) ? <strong class="reserved">null</strong> : <a href="../D/16612.html" title="Multiple defined in 2 places.">fullGetFirstQueuedThread</a>();
<a id="L1170" name="L1170"></a>1170     <em class="brace">}</em>
<a id="L1171" name="L1171"></a>1171 
<div class="comment">
      Version of getFirstQueuedThread called when fastpath fails</div>
<a id="L1175" name="L1175"></a>1175     <strong class="reserved">private</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> <a href="../R/14822.html" title="Multiple referred from 2 places.">fullGetFirstQueuedThread</a>() <em class="brace">{</em>
<div class="comment">
          The first node is normally head.next. Try to get its
          thread field, ensuring consistent reads: If thread
          field is nulled out or s.prev is no longer head, then
          some other thread(s) concurrently performed setHead in
          between some of our reads. We try this twice before
          resorting to traversal.</div>
<a id="L1184" name="L1184"></a>1184         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h, s;
<a id="L1185" name="L1185"></a>1185         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> st;
<a id="L1186" name="L1186"></a>1186         <strong class="reserved">if</strong> (((h = head) != <strong class="reserved">null</strong> &amp;&amp; (s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1187" name="L1187"></a>1187              s.prev == head &amp;&amp; (st = s.thread) != <strong class="reserved">null</strong>) ||
<a id="L1188" name="L1188"></a>1188             ((h = head) != <strong class="reserved">null</strong> &amp;&amp; (s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1189" name="L1189"></a>1189              s.prev == head &amp;&amp; (st = s.thread) != <strong class="reserved">null</strong>))
<a id="L1190" name="L1190"></a>1190             <strong class="reserved">return</strong> st;
<a id="L1191" name="L1191"></a>1191 
<div class="comment">
          Head's next field might not have been set yet, or may have
          been unset after setHead. So we must check to see if tail
          is actually first node. If not, we continue on, safely
          traversing from tail back to head to find first,
          guaranteeing termination.</div>
<a id="L1199" name="L1199"></a>1199 
<a id="L1200" name="L1200"></a>1200         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail;
<a id="L1201" name="L1201"></a>1201         <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> firstThread = <strong class="reserved">null</strong>;
<a id="L1202" name="L1202"></a>1202         <strong class="reserved">while</strong> (t != <strong class="reserved">null</strong> &amp;&amp; t != head) <em class="brace">{</em>
<a id="L1203" name="L1203"></a>1203             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> tt = t.thread;
<a id="L1204" name="L1204"></a>1204             <strong class="reserved">if</strong> (tt != <strong class="reserved">null</strong>)
<a id="L1205" name="L1205"></a>1205                 firstThread = tt;
<a id="L1206" name="L1206"></a>1206             t = t.prev;
<a id="L1207" name="L1207"></a>1207         <em class="brace">}</em>
<a id="L1208" name="L1208"></a>1208         <strong class="reserved">return</strong> firstThread;
<a id="L1209" name="L1209"></a>1209     <em class="brace">}</em>
<a id="L1210" name="L1210"></a>1210 
<div class="comment">
      Returns true if the given thread is currently queued.
      <p>This implementation traverses the queue to determine
      presence of the given thread.
      @param thread the thread
      @return <code>true</code> if the given thread is on the queue
      @throws NullPointerException if the thread is null</p></div>
<a id="L1221" name="L1221"></a>1221     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21920.html" title="Multiple referred from 2 places.">isQueued</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> thread) <em class="brace">{</em>
<a id="L1222" name="L1222"></a>1222         <strong class="reserved">if</strong> (thread == <strong class="reserved">null</strong>)
<a id="L1223" name="L1223"></a>1223             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>();
<a id="L1224" name="L1224"></a>1224         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev)
<a id="L1225" name="L1225"></a>1225             <strong class="reserved">if</strong> (p.thread == thread)
<a id="L1226" name="L1226"></a>1226                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1227" name="L1227"></a>1227         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1228" name="L1228"></a>1228     <em class="brace">}</em>
<a id="L1229" name="L1229"></a>1229 
<div class="comment">
      Returns <code>true</code> if the apparent first queued thread, if one
      exists, is waiting in exclusive mode.  If this method returns
      <code>true</code>, and the current thread is attempting to acquire in
      shared mode (that is, this method is invoked from {@link
      #tryAcquireShared}) then it is guaranteed that the current thread
      is not the first queued thread.  Used only as a heuristic in
      ReentrantReadWriteLock.</div>
<a id="L1239" name="L1239"></a>1239     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../S/1043.html#L682" title="Referred from 682 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">apparentlyFirstQueuedIsExclusive</a>() <em class="brace">{</em>
<a id="L1240" name="L1240"></a>1240         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h, s;
<a id="L1241" name="L1241"></a>1241         <strong class="reserved">return</strong> (h = head) != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1242" name="L1242"></a>1242             (s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>)  != <strong class="reserved">null</strong> &amp;&amp;
<a id="L1243" name="L1243"></a>1243             !s.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>()         &amp;&amp;
<a id="L1244" name="L1244"></a>1244             s.thread != <strong class="reserved">null</strong>;
<a id="L1245" name="L1245"></a>1245     <em class="brace">}</em>
<a id="L1246" name="L1246"></a>1246 
<div class="comment">
      Queries whether any threads have been waiting to acquire longer
      than the current thread.
      <p>An invocation of this method is equivalent to (but may be
      more efficient than):
       </p><pre> {@code
      getFirstQueuedThread() != Thread.currentThread() &amp;&amp;
      hasQueuedThreads()}</pre>
      <p>Note that because cancellations due to interrupts and
      timeouts may occur at any time, a <code>true</code> return does not
      guarantee that some other thread will acquire before the current
      thread.  Likewise, it is possible for another thread to win a
      race to enqueue after this method has returned <code>false</code>,
      due to the queue being empty.
      </p><p>This method is designed to be used by a fair synchronizer to
      avoid <a href="AbstractQueuedSynchronizer.html#barging">barging</a>.
      Such a synchronizer's {@link #tryAcquire} method should return
      <code>false</code>, and its {@link #tryAcquireShared} method should
      return a negative value, if this method returns <code>true</code>
      (unless this is a reentrant acquire).  For example, the {@code
      tryAcquire} method for a fair, reentrant, exclusive mode
      synchronizer might look like this:
       </p><pre> {@code
      protected boolean tryAcquire(int arg) {
        if (isHeldExclusively()) {
          // A reentrant acquire; increment hold count
          return true;
        } else if (hasQueuedPredecessors()) {
          return false;
        } else {
          // try to acquire normally
        }
      }}</pre>
      @return <code>true</code> if there is a queued thread preceding the
              current thread, and <code>false</code> if the current thread
              is at the head of the queue or the queue is empty
      @since 1.7</div>
<a id="L1290" name="L1290"></a>1290     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20257.html" title="Multiple referred from 4 places.">hasQueuedPredecessors</a>() <em class="brace">{</em>
<a id="L1291" name="L1291"></a>1291         <em class="comment">// The correctness of this depends on head being initialized</em>
<a id="L1292" name="L1292"></a>1292         <em class="comment">// before tail and on head.next being accurate if the current</em>
<a id="L1293" name="L1293"></a>1293         <em class="comment">// thread is first in queue.</em>
<a id="L1294" name="L1294"></a>1294         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail; <em class="comment">// Read fields in reverse initialization order</em>
<a id="L1295" name="L1295"></a>1295         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> h = head;
<a id="L1296" name="L1296"></a>1296         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> s;
<a id="L1297" name="L1297"></a>1297         <strong class="reserved">return</strong> h != t &amp;&amp;
<a id="L1298" name="L1298"></a>1298             ((s = h.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>) == <strong class="reserved">null</strong> || s.thread != <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>());
<a id="L1299" name="L1299"></a>1299     <em class="brace">}</em>
<a id="L1300" name="L1300"></a>1300 
<a id="L1301" name="L1301"></a>1301 
<a id="L1302" name="L1302"></a>1302     <em class="comment">// Instrumentation and monitoring methods</em>
<a id="L1303" name="L1303"></a>1303 
<div class="comment">
      Returns an estimate of the number of threads waiting to
      acquire.  The value is only an estimate because the number of
      threads may change dynamically while this method traverses
      internal data structures.  This method is designed for use in
      monitoring system state, not for synchronization
      control.
      @return the estimated number of threads waiting to acquire</div>
<a id="L1314" name="L1314"></a>1314     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/18572.html" title="Multiple referred from 3 places.">getQueueLength</a>() <em class="brace">{</em>
<a id="L1315" name="L1315"></a>1315         <strong class="reserved">int</strong> n = 0;
<a id="L1316" name="L1316"></a>1316         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1317" name="L1317"></a>1317             <strong class="reserved">if</strong> (p.thread != <strong class="reserved">null</strong>)
<a id="L1318" name="L1318"></a>1318                 ++n;
<a id="L1319" name="L1319"></a>1319         <em class="brace">}</em>
<a id="L1320" name="L1320"></a>1320         <strong class="reserved">return</strong> n;
<a id="L1321" name="L1321"></a>1321     <em class="brace">}</em>
<a id="L1322" name="L1322"></a>1322 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire.  Because the actual set of threads may change
      dynamically while constructing this result, the returned
      collection is only a best-effort estimate.  The elements of the
      returned collection are in no particular order.  This method is
      designed to facilitate construction of subclasses that provide
      more extensive monitoring facilities.
      @return the collection of threads</div>
<a id="L1334" name="L1334"></a>1334     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/18573.html" title="Multiple referred from 3 places.">getQueuedThreads</a>() <em class="brace">{</em>
<a id="L1335" name="L1335"></a>1335         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L1336" name="L1336"></a>1336         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1337" name="L1337"></a>1337             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = p.thread;
<a id="L1338" name="L1338"></a>1338             <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L1339" name="L1339"></a>1339                 <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L1340" name="L1340"></a>1340         <em class="brace">}</em>
<a id="L1341" name="L1341"></a>1341         <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L1342" name="L1342"></a>1342     <em class="brace">}</em>
<a id="L1343" name="L1343"></a>1343 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire in exclusive mode. This has the same properties
      as {@link #getQueuedThreads} except that it only returns
      those threads waiting due to an exclusive acquire.
      @return the collection of threads</div>
<a id="L1352" name="L1352"></a>1352     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../S/1043.html#L1321" title="Referred from 1321 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">getExclusiveQueuedThreads</a>() <em class="brace">{</em>
<a id="L1353" name="L1353"></a>1353         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L1354" name="L1354"></a>1354         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1355" name="L1355"></a>1355             <strong class="reserved">if</strong> (!p.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>()) <em class="brace">{</em>
<a id="L1356" name="L1356"></a>1356                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = p.thread;
<a id="L1357" name="L1357"></a>1357                 <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L1358" name="L1358"></a>1358                     <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L1359" name="L1359"></a>1359             <em class="brace">}</em>
<a id="L1360" name="L1360"></a>1360         <em class="brace">}</em>
<a id="L1361" name="L1361"></a>1361         <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L1362" name="L1362"></a>1362     <em class="brace">}</em>
<a id="L1363" name="L1363"></a>1363 
<div class="comment">
      Returns a collection containing threads that may be waiting to
      acquire in shared mode. This has the same properties
      as {@link #getQueuedThreads} except that it only returns
      those threads waiting due to a shared acquire.
      @return the collection of threads</div>
<a id="L1372" name="L1372"></a>1372     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../S/1043.html#L1336" title="Referred from 1336 in src/java/util/concurrent/locks/ReentrantReadWriteLock.java.">getSharedQueuedThreads</a>() <em class="brace">{</em>
<a id="L1373" name="L1373"></a>1373         <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L1374" name="L1374"></a>1374         <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = tail; p != <strong class="reserved">null</strong>; p = p.prev) <em class="brace">{</em>
<a id="L1375" name="L1375"></a>1375             <strong class="reserved">if</strong> (p.<a href="../D/26234.html" title="Multiple defined in 3 places.">isShared</a>()) <em class="brace">{</em>
<a id="L1376" name="L1376"></a>1376                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = p.thread;
<a id="L1377" name="L1377"></a>1377                 <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L1378" name="L1378"></a>1378                     <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L1379" name="L1379"></a>1379             <em class="brace">}</em>
<a id="L1380" name="L1380"></a>1380         <em class="brace">}</em>
<a id="L1381" name="L1381"></a>1381         <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L1382" name="L1382"></a>1382     <em class="brace">}</em>
<a id="L1383" name="L1383"></a>1383 
<div class="comment">
      Returns a string identifying this synchronizer, as well as its state.
      The state, in brackets, includes the String <code>"State ="</code>
      followed by the current value of {@link #getState}, and either
      <code>"nonempty"</code> or <code>"empty"</code> depending on whether the
      queue is empty.
      @return a string identifying this synchronizer, as well as its state</div>
<a id="L1393" name="L1393"></a>1393     <strong class="reserved">public</strong> <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> <a href="../R/29337.html" title="Multiple referred from 3013 places.">toString</a>() <em class="brace">{</em>
<a id="L1394" name="L1394"></a>1394         <strong class="reserved">long</strong> s = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L1395" name="L1395"></a>1395         <a href="../D/8419.html" title="Multiple defined in 2 places.">String</a> q  = <a href="../D/24168.html" title="Multiple defined in 5 places.">hasQueuedThreads</a>() ? "non" : "";
<a id="L1396" name="L1396"></a>1396         <strong class="reserved">return</strong> <strong class="reserved">super</strong>.<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>() +
<a id="L1397" name="L1397"></a>1397             "[State = " + s + ", " + q + "empty queue]";
<a id="L1398" name="L1398"></a>1398     <em class="brace">}</em>
<a id="L1399" name="L1399"></a>1399 
<a id="L1400" name="L1400"></a>1400 
<a id="L1401" name="L1401"></a>1401     <em class="comment">// Internal support methods for Conditions</em>
<a id="L1402" name="L1402"></a>1402 
<div class="comment">
      Returns true if a node, always one that was initially placed on
      a condition queue, is now waiting to reacquire on sync queue.
      @param node the node
      @return true if is reacquiring</div>
<a id="L1409" name="L1409"></a>1409     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21817.html" title="Multiple referred from 12 places.">isOnSyncQueue</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1410" name="L1410"></a>1410         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION || <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.prev == <strong class="reserved">null</strong>)
<a id="L1411" name="L1411"></a>1411             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1412" name="L1412"></a>1412         <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> != <strong class="reserved">null</strong>) <em class="comment">// If has successor, it must be on queue</em>
<a id="L1413" name="L1413"></a>1413             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<div class="comment">
          node.prev can be non-null, but not yet on queue because
          the CAS to place it on queue can fail. So we have to
          traverse from tail to make sure it actually made it.  It
          will always be near the tail in calls to this method, and
          unless the CAS failed (which is unlikely), it will be
          there, so we hardly ever traverse much.</div>
<a id="L1422" name="L1422"></a>1422         <strong class="reserved">return</strong> <a href="../D/16196.html" title="Multiple defined in 2 places.">findNodeFromTail</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1423" name="L1423"></a>1423     <em class="brace">}</em>
<a id="L1424" name="L1424"></a>1424 
<div class="comment">
      Returns true if node is on sync queue by searching backwards from tail.
      Called only when needed by isOnSyncQueue.
      @return true if present</div>
<a id="L1430" name="L1430"></a>1430     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/14443.html" title="Multiple referred from 2 places.">findNodeFromTail</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1431" name="L1431"></a>1431         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = tail;
<a id="L1432" name="L1432"></a>1432         <strong class="reserved">for</strong> (;;) <em class="brace">{</em>
<a id="L1433" name="L1433"></a>1433             <strong class="reserved">if</strong> (t == <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)
<a id="L1434" name="L1434"></a>1434                 <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1435" name="L1435"></a>1435             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>)
<a id="L1436" name="L1436"></a>1436                 <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1437" name="L1437"></a>1437             t = t.prev;
<a id="L1438" name="L1438"></a>1438         <em class="brace">}</em>
<a id="L1439" name="L1439"></a>1439     <em class="brace">}</em>
<a id="L1440" name="L1440"></a>1440 
<div class="comment">
      Transfers a node from a condition queue onto sync queue.
      Returns true if successful.
      @param node the node
      @return true if successfully transferred (else the node was
      cancelled before signal)</div>
<a id="L1448" name="L1448"></a>1448     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29420.html" title="Multiple referred from 4 places.">transferForSignal</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<div class="comment">
          If cannot change waitStatus, the node has been cancelled.</div>
<a id="L1452" name="L1452"></a>1452         <strong class="reserved">if</strong> (!<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION, 0))
<a id="L1453" name="L1453"></a>1453             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1454" name="L1454"></a>1454 
<div class="comment">
          Splice onto queue and try to set waitStatus of predecessor to
          indicate that thread is (probably) waiting. If cancelled or
          attempt to set waitStatus fails, wake up to resync (in which
          case the waitStatus can be transiently and harmlessly wrong).</div>
<a id="L1461" name="L1461"></a>1461         <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> p = <a href="../D/15581.html" title="Multiple defined in 2 places.">enq</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1462" name="L1462"></a>1462         <strong class="reserved">int</strong> ws = p.waitStatus;
<a id="L1463" name="L1463"></a>1463         <strong class="reserved">if</strong> (ws &gt; 0 || !<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(p, ws, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.SIGNAL))
<a id="L1464" name="L1464"></a>1464             <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../S/1045.html#L139" title="Defined at 139 in src/java/util/concurrent/locks/LockSupport.java.">unpark</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.thread);
<a id="L1465" name="L1465"></a>1465         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1466" name="L1466"></a>1466     <em class="brace">}</em>
<a id="L1467" name="L1467"></a>1467 
<div class="comment">
      Transfers node, if necessary, to sync queue after a cancelled wait.
      Returns true if thread was cancelled before being signalled.
      @param node the node
      @return true if cancelled before the node was signalled</div>
<a id="L1475" name="L1475"></a>1475     <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/29414.html" title="Multiple referred from 8 places.">transferAfterCancelledWait</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1476" name="L1476"></a>1476         <strong class="reserved">if</strong> (<a href="../D/13043.html" title="Multiple defined in 2 places.">compareAndSetWaitStatus</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION, 0)) <em class="brace">{</em>
<a id="L1477" name="L1477"></a>1477             <a href="../D/15581.html" title="Multiple defined in 2 places.">enq</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1478" name="L1478"></a>1478             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1479" name="L1479"></a>1479         <em class="brace">}</em>
<div class="comment">
          If we lost out to a signal(), then we can't proceed
          until it finishes its enq().  Cancelling during an
          incomplete transfer is both rare and transient, so just
          spin.</div>
<a id="L1486" name="L1486"></a>1486         <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>))
<a id="L1487" name="L1487"></a>1487             <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L282" title="Defined at 282 in src/java/lang/Thread.java.">yield</a>();
<a id="L1488" name="L1488"></a>1488         <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1489" name="L1489"></a>1489     <em class="brace">}</em>
<a id="L1490" name="L1490"></a>1490 
<div class="comment">
      Invokes release with current state value; returns saved state.
      Cancels node and throws exception on failure.
      @param node the condition node for this wait
      @return previous sync state</div>
<a id="L1497" name="L1497"></a>1497     <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../R/14827.html" title="Multiple referred from 10 places.">fullyRelease</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1498" name="L1498"></a>1498         <strong class="reserved">boolean</strong> <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">true</strong>;
<a id="L1499" name="L1499"></a>1499         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L1500" name="L1500"></a>1500             <strong class="reserved">long</strong> savedState = <a href="../D/22724.html" title="Multiple defined in 28 places.">getState</a>();
<a id="L1501" name="L1501"></a>1501             <strong class="reserved">if</strong> (<a href="../D/30632.html" title="Multiple defined in 19 places.">release</a>(savedState)) <em class="brace">{</em>
<a id="L1502" name="L1502"></a>1502                 <a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a> = <strong class="reserved">false</strong>;
<a id="L1503" name="L1503"></a>1503                 <strong class="reserved">return</strong> savedState;
<a id="L1504" name="L1504"></a>1504             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L1505" name="L1505"></a>1505                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1506" name="L1506"></a>1506             <em class="brace">}</em>
<a id="L1507" name="L1507"></a>1507         <em class="brace">}</em> <strong class="reserved">finally</strong> <em class="brace">{</em>
<a id="L1508" name="L1508"></a>1508             <strong class="reserved">if</strong> (<a href="../S/2033.html#L65" title="Defined at 65 in src/java/nio/channels/CompletionHandler.java.">failed</a>)
<a id="L1509" name="L1509"></a>1509                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.waitStatus = <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CANCELLED;
<a id="L1510" name="L1510"></a>1510         <em class="brace">}</em>
<a id="L1511" name="L1511"></a>1511     <em class="brace">}</em>
<a id="L1512" name="L1512"></a>1512 
<a id="L1513" name="L1513"></a>1513     <em class="comment">// Instrumentation methods for conditions</em>
<a id="L1514" name="L1514"></a>1514 
<div class="comment">
      Queries whether the given ConditionObject
      uses this synchronizer as its lock.
      @param condition the condition
      @return <code>true</code> if owned
      @throws NullPointerException if the condition is null</div>
<a id="L1523" name="L1523"></a>1523     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/24077.html" title="Multiple referred from 6 places.">owns</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1524" name="L1524"></a>1524         <strong class="reserved">return</strong> condition.<a href="../D/26021.html" title="Multiple defined in 2 places.">isOwnedBy</a>(<strong class="reserved">this</strong>);
<a id="L1525" name="L1525"></a>1525     <em class="brace">}</em>
<a id="L1526" name="L1526"></a>1526 
<div class="comment">
      Queries whether any threads are waiting on the given condition
      associated with this synchronizer. Note that because timeouts
      and interrupts may occur at any time, a <code>true</code> return
      does not guarantee that a future <code>signal</code> will awaken
      any threads.  This method is designed primarily for use in
      monitoring of the system state.
      @param condition the condition
      @return <code>true</code> if there are any waiting threads
      @throws IllegalMonitorStateException if exclusive synchronization
              is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this synchronizer
      @throws NullPointerException if the condition is null</div>
<a id="L1543" name="L1543"></a>1543     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20290.html" title="Multiple referred from 6 places.">hasWaiters</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1544" name="L1544"></a>1544         <strong class="reserved">if</strong> (!<a href="../D/28638.html" title="Multiple defined in 2 places.">owns</a>(condition))
<a id="L1545" name="L1545"></a>1545             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Not owner");
<a id="L1546" name="L1546"></a>1546         <strong class="reserved">return</strong> condition.<a href="../D/24209.html" title="Multiple defined in 6 places.">hasWaiters</a>();
<a id="L1547" name="L1547"></a>1547     <em class="brace">}</em>
<a id="L1548" name="L1548"></a>1548 
<div class="comment">
      Returns an estimate of the number of threads waiting on the
      given condition associated with this synchronizer. Note that
      because timeouts and interrupts may occur at any time, the
      estimate serves only as an upper bound on the actual number of
      waiters.  This method is designed for use in monitoring of the
      system state, not for synchronization control.
      @param condition the condition
      @return the estimated number of waiting threads
      @throws IllegalMonitorStateException if exclusive synchronization
              is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this synchronizer
      @throws NullPointerException if the condition is null</div>
<a id="L1565" name="L1565"></a>1565     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19840.html" title="Multiple referred from 4 places.">getWaitQueueLength</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1566" name="L1566"></a>1566         <strong class="reserved">if</strong> (!<a href="../D/28638.html" title="Multiple defined in 2 places.">owns</a>(condition))
<a id="L1567" name="L1567"></a>1567             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Not owner");
<a id="L1568" name="L1568"></a>1568         <strong class="reserved">return</strong> condition.<a href="../D/23651.html" title="Multiple defined in 6 places.">getWaitQueueLength</a>();
<a id="L1569" name="L1569"></a>1569     <em class="brace">}</em>
<a id="L1570" name="L1570"></a>1570 
<div class="comment">
      Returns a collection containing those threads that may be
      waiting on the given condition associated with this
      synchronizer.  Because the actual set of threads may change
      dynamically while constructing this result, the returned
      collection is only a best-effort estimate. The elements of the
      returned collection are in no particular order.
      @param condition the condition
      @return the collection of threads
      @throws IllegalMonitorStateException if exclusive synchronization
              is not held
      @throws IllegalArgumentException if the given condition is
              not associated with this synchronizer
      @throws NullPointerException if the condition is null</div>
<a id="L1587" name="L1587"></a>1587     <strong class="reserved">public</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/19841.html" title="Multiple referred from 4 places.">getWaitingThreads</a>(<a href="../D/1784.html" title="Multiple defined in 2 places.">ConditionObject</a> condition) <em class="brace">{</em>
<a id="L1588" name="L1588"></a>1588         <strong class="reserved">if</strong> (!<a href="../D/28638.html" title="Multiple defined in 2 places.">owns</a>(condition))
<a id="L1589" name="L1589"></a>1589             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../D/4055.html" title="Multiple defined in 2 places.">IllegalArgumentException</a>("Not owner");
<a id="L1590" name="L1590"></a>1590         <strong class="reserved">return</strong> condition.<a href="../D/23655.html" title="Multiple defined in 6 places.">getWaitingThreads</a>();
<a id="L1591" name="L1591"></a>1591     <em class="brace">}</em>
<a id="L1592" name="L1592"></a>1592 
<div class="comment">
      Condition implementation for a {@link
      AbstractQueuedLongSynchronizer} serving as the basis of a {@link
      Lock} implementation.
      <p>Method documentation for this class describes mechanics,
      not behavioral specifications from the point of view of Lock
      and Condition users. Exported versions of this class will in
      general need to be accompanied by documentation describing
      condition semantics that rely on those of the associated
      <code>AbstractQueuedLongSynchronizer</code>.
      </p><p>This class is Serializable, but all fields are transient,
      so deserialized conditions have no waiters.
      @since 1.6</p></div>
<a id="L1610" name="L1610"></a>1610     <strong class="reserved">public</strong> <strong class="reserved">class</strong> <a href="../R/1639.html" title="Multiple referred from 24 places.">ConditionObject</a> <strong class="reserved">implements</strong> <a href="../S/1049.html#L179" title="Defined at 179 in src/java/util/concurrent/locks/Condition.java.">Condition</a>, <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.io.<a href="../S/1407.html#L169" title="Defined at 169 in src/java/io/Serializable.java.">Serializable</a> <em class="brace">{</em>
<a id="L1611" name="L1611"></a>1611         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> serialVersionUID = 1173984872572414699L;
<div class="comment">
         /** First node of condition queue. */</div>
<a id="L1613" name="L1613"></a>1613         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> firstWaiter;
<div class="comment">
         /** Last node of condition queue. */</div>
<a id="L1615" name="L1615"></a>1615         <strong class="reserved">private</strong> <strong class="reserved">transient</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> lastWaiter;
<a id="L1616" name="L1616"></a>1616 
<div class="comment">
          Creates a new <code>ConditionObject</code> instance.</div>
<a id="L1620" name="L1620"></a>1620         <strong class="reserved">public</strong> ConditionObject() <em class="brace">{</em> <em class="brace">}</em>
<a id="L1621" name="L1621"></a>1621 
<a id="L1622" name="L1622"></a>1622         <em class="comment">// Internal methods</em>
<a id="L1623" name="L1623"></a>1623 
<div class="comment">
          Adds a new waiter to wait queue.
          @return its new wait node</div>
<a id="L1628" name="L1628"></a>1628         <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../R/9663.html" title="Multiple referred from 10 places.">addConditionWaiter</a>() <em class="brace">{</em>
<a id="L1629" name="L1629"></a>1629             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = lastWaiter;
<a id="L1630" name="L1630"></a>1630             <em class="comment">// If lastWaiter is cancelled, clean out.</em>
<a id="L1631" name="L1631"></a>1631             <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong> &amp;&amp; t.waitStatus != <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION) <em class="brace">{</em>
<a id="L1632" name="L1632"></a>1632                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L1633" name="L1633"></a>1633                 t = lastWaiter;
<a id="L1634" name="L1634"></a>1634             <em class="brace">}</em>
<a id="L1635" name="L1635"></a>1635             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">new</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>(<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L264" title="Defined at 264 in src/java/lang/Thread.java.">currentThread</a>(), <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION);
<a id="L1636" name="L1636"></a>1636             <strong class="reserved">if</strong> (t == <strong class="reserved">null</strong>)
<a id="L1637" name="L1637"></a>1637                 firstWaiter = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1638" name="L1638"></a>1638             <strong class="reserved">else</strong>
<a id="L1639" name="L1639"></a>1639                 t.nextWaiter = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1640" name="L1640"></a>1640             lastWaiter = <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1641" name="L1641"></a>1641             <strong class="reserved">return</strong> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L1642" name="L1642"></a>1642         <em class="brace">}</em>
<a id="L1643" name="L1643"></a>1643 
<div class="comment">
          Removes and transfers nodes until hit non-cancelled one or
          null. Split out from signal in part to encourage compilers
          to inline the case of no waiters.
          @param first (non-null) the first node on condition queue</div>
<a id="L1650" name="L1650"></a>1650         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13446.html" title="Multiple referred from 2 places.">doSignal</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>) <em class="brace">{</em>
<a id="L1651" name="L1651"></a>1651             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1652" name="L1652"></a>1652                 <strong class="reserved">if</strong> ( (firstWaiter = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter) == <strong class="reserved">null</strong>)
<a id="L1653" name="L1653"></a>1653                     lastWaiter = <strong class="reserved">null</strong>;
<a id="L1654" name="L1654"></a>1654                 <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter = <strong class="reserved">null</strong>;
<a id="L1655" name="L1655"></a>1655             <em class="brace">}</em> <strong class="reserved">while</strong> (!<a href="../D/35584.html" title="Multiple defined in 2 places.">transferForSignal</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>) &amp;&amp;
<a id="L1656" name="L1656"></a>1656                      (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = firstWaiter) != <strong class="reserved">null</strong>);
<a id="L1657" name="L1657"></a>1657         <em class="brace">}</em>
<a id="L1658" name="L1658"></a>1658 
<div class="comment">
          Removes and transfers all nodes.
          @param first (non-null) the first node on condition queue</div>
<a id="L1663" name="L1663"></a>1663         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/13447.html" title="Multiple referred from 2 places.">doSignalAll</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>) <em class="brace">{</em>
<a id="L1664" name="L1664"></a>1664             lastWaiter = firstWaiter = <strong class="reserved">null</strong>;
<a id="L1665" name="L1665"></a>1665             <strong class="reserved">do</strong> <em class="brace">{</em>
<a id="L1666" name="L1666"></a>1666                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter;
<a id="L1667" name="L1667"></a>1667                 <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>.nextWaiter = <strong class="reserved">null</strong>;
<a id="L1668" name="L1668"></a>1668                 <a href="../D/35584.html" title="Multiple defined in 2 places.">transferForSignal</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L1669" name="L1669"></a>1669                 <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1670" name="L1670"></a>1670             <em class="brace">}</em> <strong class="reserved">while</strong> (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> != <strong class="reserved">null</strong>);
<a id="L1671" name="L1671"></a>1671         <em class="brace">}</em>
<a id="L1672" name="L1672"></a>1672 
<div class="comment">
          Unlinks cancelled waiter nodes from condition queue.
          Called only while holding lock. This is called when
          cancellation occurred during condition wait, and upon
          insertion of a new waiter when lastWaiter is seen to have
          been cancelled. This method is needed to avoid garbage
          retention in the absence of signals. So even though it may
          require a full traversal, it comes into play only when
          timeouts or cancellations occur in the absence of
          signals. It traverses all nodes rather than stopping at a
          particular target to unlink all pointers to garbage nodes
          without requiring many re-traversals during cancellation
          storms.</div>
<a id="L1687" name="L1687"></a>1687         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/29706.html" title="Multiple referred from 10 places.">unlinkCancelledWaiters</a>() <em class="brace">{</em>
<a id="L1688" name="L1688"></a>1688             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> t = firstWaiter;
<a id="L1689" name="L1689"></a>1689             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> trail = <strong class="reserved">null</strong>;
<a id="L1690" name="L1690"></a>1690             <strong class="reserved">while</strong> (t != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L1691" name="L1691"></a>1691                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> = t.nextWaiter;
<a id="L1692" name="L1692"></a>1692                 <strong class="reserved">if</strong> (t.waitStatus != <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION) <em class="brace">{</em>
<a id="L1693" name="L1693"></a>1693                     t.nextWaiter = <strong class="reserved">null</strong>;
<a id="L1694" name="L1694"></a>1694                     <strong class="reserved">if</strong> (trail == <strong class="reserved">null</strong>)
<a id="L1695" name="L1695"></a>1695                         firstWaiter = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1696" name="L1696"></a>1696                     <strong class="reserved">else</strong>
<a id="L1697" name="L1697"></a>1697                         trail.nextWaiter = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1698" name="L1698"></a>1698                     <strong class="reserved">if</strong> (<a href="../D/28131.html" title="Multiple defined in 273 places.">next</a> == <strong class="reserved">null</strong>)
<a id="L1699" name="L1699"></a>1699                         lastWaiter = trail;
<a id="L1700" name="L1700"></a>1700                 <em class="brace">}</em>
<a id="L1701" name="L1701"></a>1701                 <strong class="reserved">else</strong>
<a id="L1702" name="L1702"></a>1702                     trail = t;
<a id="L1703" name="L1703"></a>1703                 t = <a href="../D/28131.html" title="Multiple defined in 273 places.">next</a>;
<a id="L1704" name="L1704"></a>1704             <em class="brace">}</em>
<a id="L1705" name="L1705"></a>1705         <em class="brace">}</em>
<a id="L1706" name="L1706"></a>1706 
<a id="L1707" name="L1707"></a>1707         <em class="comment">// public methods</em>
<a id="L1708" name="L1708"></a>1708 
<div class="comment">
          Moves the longest-waiting thread, if one exists, from the
          wait queue for this condition to the wait queue for the
          owning lock.
          @throws IllegalMonitorStateException if {@link #isHeldExclusively}
                  returns <code>false</code></div>
<a id="L1717" name="L1717"></a>1717         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28605.html" title="Multiple referred from 27 places.">signal</a>() <em class="brace">{</em>
<a id="L1718" name="L1718"></a>1718             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L1719" name="L1719"></a>1719                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1720" name="L1720"></a>1720             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = firstWaiter;
<a id="L1721" name="L1721"></a>1721             <strong class="reserved">if</strong> (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> != <strong class="reserved">null</strong>)
<a id="L1722" name="L1722"></a>1722                 <a href="../D/15086.html" title="Multiple defined in 2 places.">doSignal</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L1723" name="L1723"></a>1723         <em class="brace">}</em>
<a id="L1724" name="L1724"></a>1724 
<div class="comment">
          Moves all threads from the wait queue for this condition to
          the wait queue for the owning lock.
          @throws IllegalMonitorStateException if {@link #isHeldExclusively}
                  returns <code>false</code></div>
<a id="L1732" name="L1732"></a>1732         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/28606.html" title="Multiple referred from 10 places.">signalAll</a>() <em class="brace">{</em>
<a id="L1733" name="L1733"></a>1733             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L1734" name="L1734"></a>1734                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1735" name="L1735"></a>1735             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> = firstWaiter;
<a id="L1736" name="L1736"></a>1736             <strong class="reserved">if</strong> (<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a> != <strong class="reserved">null</strong>)
<a id="L1737" name="L1737"></a>1737                 <a href="../D/15087.html" title="Multiple defined in 2 places.">doSignalAll</a>(<a href="../D/16393.html" title="Multiple defined in 45 places.">first</a>);
<a id="L1738" name="L1738"></a>1738         <em class="brace">}</em>
<a id="L1739" name="L1739"></a>1739 
<div class="comment">
          Implements uninterruptible condition wait.
          <ol>
          <li> Save lock state returned by {@link #getState}.
          </li><li> Invoke {@link #release} with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled.
          </li><li> Reacquire by invoking specialized version of
               {@link #acquire} with saved state as argument.
          </li></ol></div>
<a id="L1751" name="L1751"></a>1751         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> awaitUninterruptibly() <em class="brace">{</em>
<a id="L1752" name="L1752"></a>1752             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L1753" name="L1753"></a>1753             <strong class="reserved">long</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1754" name="L1754"></a>1754             <strong class="reserved">boolean</strong> <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">false</strong>;
<a id="L1755" name="L1755"></a>1755             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1756" name="L1756"></a>1756                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L1757" name="L1757"></a>1757                 <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1758" name="L1758"></a>1758                     <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a> = <strong class="reserved">true</strong>;
<a id="L1759" name="L1759"></a>1759             <em class="brace">}</em>
<a id="L1760" name="L1760"></a>1760             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) || <a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>)
<a id="L1761" name="L1761"></a>1761                 <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L1762" name="L1762"></a>1762         <em class="brace">}</em>
<a id="L1763" name="L1763"></a>1763 
<div class="comment">
          For interruptible waits, we need to track whether to throw
          InterruptedException, if interrupted while blocked on
          condition, versus reinterrupt current thread, if
          interrupted while blocked waiting to re-acquire.</div>
<a id="L1770" name="L1770"></a>1770 
<div class="comment">
         /** Mode meaning to reinterrupt on exit from wait */</div>
<a id="L1772" name="L1772"></a>1772         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> REINTERRUPT =  1;
<div class="comment">
         /** Mode meaning to throw InterruptedException on exit from wait */</div>
<a id="L1774" name="L1774"></a>1774         <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> THROW_IE    = -1;
<a id="L1775" name="L1775"></a>1775 
<div class="comment">
          Checks for interrupt, returning THROW_IE if interrupted
          before signalled, REINTERRUPT if after signalled, or
          0 if not interrupted.</div>
<a id="L1781" name="L1781"></a>1781         <strong class="reserved">private</strong> <strong class="reserved">int</strong> <a href="../R/11208.html" title="Multiple referred from 8 places.">checkInterruptWhileWaiting</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) <em class="brace">{</em>
<a id="L1782" name="L1782"></a>1782             <strong class="reserved">return</strong> <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>() ?
<a id="L1783" name="L1783"></a>1783                 (<a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>) ? THROW_IE : REINTERRUPT) :
<a id="L1784" name="L1784"></a>1784                 0;
<a id="L1785" name="L1785"></a>1785         <em class="brace">}</em>
<a id="L1786" name="L1786"></a>1786 
<div class="comment">
          Throws InterruptedException, reinterrupts current thread, or
          does nothing, depending on mode.</div>
<a id="L1791" name="L1791"></a>1791         <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/26189.html" title="Multiple referred from 8 places.">reportInterruptAfterWait</a>(<strong class="reserved">int</strong> interruptMode)
<a id="L1792" name="L1792"></a>1792             <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1793" name="L1793"></a>1793             <strong class="reserved">if</strong> (interruptMode == THROW_IE)
<a id="L1794" name="L1794"></a>1794                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1795" name="L1795"></a>1795             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (interruptMode == REINTERRUPT)
<a id="L1796" name="L1796"></a>1796                 <a href="../D/31725.html" title="Multiple defined in 2 places.">selfInterrupt</a>();
<a id="L1797" name="L1797"></a>1797         <em class="brace">}</em>
<a id="L1798" name="L1798"></a>1798 
<div class="comment">
          Implements interruptible condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by {@link #getState}.
          </li><li> Invoke {@link #release} with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled or interrupted.
          </li><li> Reacquire by invoking specialized version of
               {@link #acquire} with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li></ol></div>
<a id="L1812" name="L1812"></a>1812         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/10432.html" title="Multiple referred from 21 places.">await</a>() <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1813" name="L1813"></a>1813             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1814" name="L1814"></a>1814                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1815" name="L1815"></a>1815             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L1816" name="L1816"></a>1816             <strong class="reserved">long</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1817" name="L1817"></a>1817             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L1818" name="L1818"></a>1818             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1819" name="L1819"></a>1819                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29072.html" title="Multiple defined in 2 places.">park</a>(<strong class="reserved">this</strong>);
<a id="L1820" name="L1820"></a>1820                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L1821" name="L1821"></a>1821                     <strong class="reserved">break</strong>;
<a id="L1822" name="L1822"></a>1822             <em class="brace">}</em>
<a id="L1823" name="L1823"></a>1823             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L1824" name="L1824"></a>1824                 interruptMode = REINTERRUPT;
<a id="L1825" name="L1825"></a>1825             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>) <em class="comment">// clean up if cancelled</em>
<a id="L1826" name="L1826"></a>1826                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L1827" name="L1827"></a>1827             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L1828" name="L1828"></a>1828                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L1829" name="L1829"></a>1829         <em class="brace">}</em>
<a id="L1830" name="L1830"></a>1830 
<div class="comment">
          Implements timed condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by {@link #getState}.
          </li><li> Invoke {@link #release} with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled, interrupted, or timed out.
          </li><li> Reacquire by invoking specialized version of
               {@link #acquire} with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li></ol></div>
<a id="L1844" name="L1844"></a>1844         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../R/10437.html" title="Multiple referred from 20 places.">awaitNanos</a>(<strong class="reserved">long</strong> nanosTimeout)
<a id="L1845" name="L1845"></a>1845                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1846" name="L1846"></a>1846             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1847" name="L1847"></a>1847                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1848" name="L1848"></a>1848             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L1849" name="L1849"></a>1849             <strong class="reserved">long</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1850" name="L1850"></a>1850             <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L1851" name="L1851"></a>1851             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L1852" name="L1852"></a>1852             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1853" name="L1853"></a>1853                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L) <em class="brace">{</em>
<a id="L1854" name="L1854"></a>1854                     <a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1855" name="L1855"></a>1855                     <strong class="reserved">break</strong>;
<a id="L1856" name="L1856"></a>1856                 <em class="brace">}</em>
<a id="L1857" name="L1857"></a>1857                 <strong class="reserved">if</strong> (nanosTimeout &gt;= spinForTimeoutThreshold)
<a id="L1858" name="L1858"></a>1858                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L1859" name="L1859"></a>1859                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L1860" name="L1860"></a>1860                     <strong class="reserved">break</strong>;
<a id="L1861" name="L1861"></a>1861                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L1862" name="L1862"></a>1862             <em class="brace">}</em>
<a id="L1863" name="L1863"></a>1863             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L1864" name="L1864"></a>1864                 interruptMode = REINTERRUPT;
<a id="L1865" name="L1865"></a>1865             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>)
<a id="L1866" name="L1866"></a>1866                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L1867" name="L1867"></a>1867             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L1868" name="L1868"></a>1868                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L1869" name="L1869"></a>1869             <strong class="reserved">return</strong> deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L1870" name="L1870"></a>1870         <em class="brace">}</em>
<a id="L1871" name="L1871"></a>1871 
<div class="comment">
          Implements absolute timed condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by {@link #getState}.
          </li><li> Invoke {@link #release} with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled, interrupted, or timed out.
          </li><li> Reacquire by invoking specialized version of
               {@link #acquire} with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li><li> If timed out while blocked in step 4, return false, else true.
          </li></ol></div>
<a id="L1886" name="L1886"></a>1886         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> awaitUntil(<a href="../D/2208.html" title="Multiple defined in 2 places.">Date</a> deadline)
<a id="L1887" name="L1887"></a>1887                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1888" name="L1888"></a>1888             <strong class="reserved">long</strong> abstime = deadline.<a href="../D/23142.html" title="Multiple defined in 14 places.">getTime</a>();
<a id="L1889" name="L1889"></a>1889             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1890" name="L1890"></a>1890                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1891" name="L1891"></a>1891             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L1892" name="L1892"></a>1892             <strong class="reserved">long</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1893" name="L1893"></a>1893             <strong class="reserved">boolean</strong> timedout = <strong class="reserved">false</strong>;
<a id="L1894" name="L1894"></a>1894             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L1895" name="L1895"></a>1895             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1896" name="L1896"></a>1896                 <strong class="reserved">if</strong> (<a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L353" title="Defined at 353 in src/java/lang/System.java.">currentTimeMillis</a>() &gt; abstime) <em class="brace">{</em>
<a id="L1897" name="L1897"></a>1897                     timedout = <a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1898" name="L1898"></a>1898                     <strong class="reserved">break</strong>;
<a id="L1899" name="L1899"></a>1899                 <em class="brace">}</em>
<a id="L1900" name="L1900"></a>1900                 <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29075.html" title="Multiple defined in 2 places.">parkUntil</a>(<strong class="reserved">this</strong>, abstime);
<a id="L1901" name="L1901"></a>1901                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L1902" name="L1902"></a>1902                     <strong class="reserved">break</strong>;
<a id="L1903" name="L1903"></a>1903             <em class="brace">}</em>
<a id="L1904" name="L1904"></a>1904             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L1905" name="L1905"></a>1905                 interruptMode = REINTERRUPT;
<a id="L1906" name="L1906"></a>1906             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>)
<a id="L1907" name="L1907"></a>1907                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L1908" name="L1908"></a>1908             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L1909" name="L1909"></a>1909                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L1910" name="L1910"></a>1910             <strong class="reserved">return</strong> !timedout;
<a id="L1911" name="L1911"></a>1911         <em class="brace">}</em>
<a id="L1912" name="L1912"></a>1912 
<div class="comment">
          Implements timed condition wait.
          <ol>
          <li> If current thread is interrupted, throw InterruptedException.
          </li><li> Save lock state returned by {@link #getState}.
          </li><li> Invoke {@link #release} with saved state as argument,
               throwing IllegalMonitorStateException if it fails.
          </li><li> Block until signalled, interrupted, or timed out.
          </li><li> Reacquire by invoking specialized version of
               {@link #acquire} with saved state as argument.
          </li><li> If interrupted while blocked in step 4, throw InterruptedException.
          </li><li> If timed out while blocked in step 4, return false, else true.
          </li></ol></div>
<a id="L1927" name="L1927"></a>1927         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/10432.html" title="Multiple referred from 21 places.">await</a>(<strong class="reserved">long</strong> <a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>, <a href="../S/1102.html#L71" title="Defined at 71 in src/java/util/concurrent/TimeUnit.java.">TimeUnit</a> unit)
<a id="L1928" name="L1928"></a>1928                 <strong class="reserved">throws</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a> <em class="brace">{</em>
<a id="L1929" name="L1929"></a>1929             <strong class="reserved">long</strong> nanosTimeout = unit.<a href="../D/35449.html" title="Multiple defined in 2 places.">toNanos</a>(<a href="../D/35330.html" title="Multiple defined in 2 places.">time</a>);
<a id="L1930" name="L1930"></a>1930             <strong class="reserved">if</strong> (<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L943" title="Defined at 943 in src/java/lang/Thread.java.">interrupted</a>())
<a id="L1931" name="L1931"></a>1931                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1730.html#L50" title="Defined at 50 in src/java/lang/InterruptedException.java.">InterruptedException</a>();
<a id="L1932" name="L1932"></a>1932             <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <a href="../D/10721.html" title="Multiple defined in 2 places.">addConditionWaiter</a>();
<a id="L1933" name="L1933"></a>1933             <strong class="reserved">long</strong> savedState = <a href="../D/16617.html" title="Multiple defined in 2 places.">fullyRelease</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1934" name="L1934"></a>1934             <strong class="reserved">final</strong> <strong class="reserved">long</strong> deadline = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>() + nanosTimeout;
<a id="L1935" name="L1935"></a>1935             <strong class="reserved">boolean</strong> timedout = <strong class="reserved">false</strong>;
<a id="L1936" name="L1936"></a>1936             <strong class="reserved">int</strong> interruptMode = 0;
<a id="L1937" name="L1937"></a>1937             <strong class="reserved">while</strong> (!<a href="../D/25989.html" title="Multiple defined in 2 places.">isOnSyncQueue</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) <em class="brace">{</em>
<a id="L1938" name="L1938"></a>1938                 <strong class="reserved">if</strong> (nanosTimeout &lt;= 0L) <em class="brace">{</em>
<a id="L1939" name="L1939"></a>1939                     timedout = <a href="../D/35578.html" title="Multiple defined in 2 places.">transferAfterCancelledWait</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>);
<a id="L1940" name="L1940"></a>1940                     <strong class="reserved">break</strong>;
<a id="L1941" name="L1941"></a>1941                 <em class="brace">}</em>
<a id="L1942" name="L1942"></a>1942                 <strong class="reserved">if</strong> (nanosTimeout &gt;= spinForTimeoutThreshold)
<a id="L1943" name="L1943"></a>1943                     <a href="../S/1045.html#L120" title="Defined at 120 in src/java/util/concurrent/locks/LockSupport.java.">LockSupport</a>.<a href="../D/29074.html" title="Multiple defined in 2 places.">parkNanos</a>(<strong class="reserved">this</strong>, nanosTimeout);
<a id="L1944" name="L1944"></a>1944                 <strong class="reserved">if</strong> ((interruptMode = <a href="../D/12503.html" title="Multiple defined in 2 places.">checkInterruptWhileWaiting</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>)) != 0)
<a id="L1945" name="L1945"></a>1945                     <strong class="reserved">break</strong>;
<a id="L1946" name="L1946"></a>1946                 nanosTimeout = deadline - <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L399" title="Defined at 399 in src/java/lang/System.java.">nanoTime</a>();
<a id="L1947" name="L1947"></a>1947             <em class="brace">}</em>
<a id="L1948" name="L1948"></a>1948             <strong class="reserved">if</strong> (<a href="../D/10584.html" title="Multiple defined in 2 places.">acquireQueued</a>(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, savedState) &amp;&amp; interruptMode != THROW_IE)
<a id="L1949" name="L1949"></a>1949                 interruptMode = REINTERRUPT;
<a id="L1950" name="L1950"></a>1950             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.nextWaiter != <strong class="reserved">null</strong>)
<a id="L1951" name="L1951"></a>1951                 <a href="../D/35906.html" title="Multiple defined in 2 places.">unlinkCancelledWaiters</a>();
<a id="L1952" name="L1952"></a>1952             <strong class="reserved">if</strong> (interruptMode != 0)
<a id="L1953" name="L1953"></a>1953                 <a href="../D/31092.html" title="Multiple defined in 2 places.">reportInterruptAfterWait</a>(interruptMode);
<a id="L1954" name="L1954"></a>1954             <strong class="reserved">return</strong> !timedout;
<a id="L1955" name="L1955"></a>1955         <em class="brace">}</em>
<a id="L1956" name="L1956"></a>1956 
<a id="L1957" name="L1957"></a>1957         <em class="comment">//  support for instrumentation</em>
<a id="L1958" name="L1958"></a>1958 
<div class="comment">
          Returns true if this condition was created by the given
          synchronization object.
          @return <code>true</code> if owned</div>
<a id="L1965" name="L1965"></a>1965         <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/21845.html" title="Multiple referred from 2 places.">isOwnedBy</a>(<a href="../S/1044.html#L60" title="Defined at 60 in src/java/util/concurrent/locks/AbstractQueuedLongSynchronizer.java.">AbstractQueuedLongSynchronizer</a> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a>) <em class="brace">{</em>
<a id="L1966" name="L1966"></a>1966             <strong class="reserved">return</strong> <a href="../D/35158.html" title="Multiple defined in 9 places.">sync</a> == <a href="../S/1044.html#L60" title="Defined at 60 in src/java/util/concurrent/locks/AbstractQueuedLongSynchronizer.java.">AbstractQueuedLongSynchronizer</a>.<strong class="reserved">this</strong>;
<a id="L1967" name="L1967"></a>1967         <em class="brace">}</em>
<a id="L1968" name="L1968"></a>1968 
<div class="comment">
          Queries whether any threads are waiting on this condition.
          Implements {@link AbstractQueuedLongSynchronizer#hasWaiters(ConditionObject)}.
          @return <code>true</code> if there are any waiting threads
          @throws IllegalMonitorStateException if {@link #isHeldExclusively}
                  returns <code>false</code></div>
<a id="L1977" name="L1977"></a>1977         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/20290.html" title="Multiple referred from 6 places.">hasWaiters</a>() <em class="brace">{</em>
<a id="L1978" name="L1978"></a>1978             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L1979" name="L1979"></a>1979                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1980" name="L1980"></a>1980             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> w = firstWaiter; w != <strong class="reserved">null</strong>; w = w.nextWaiter) <em class="brace">{</em>
<a id="L1981" name="L1981"></a>1981                 <strong class="reserved">if</strong> (w.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION)
<a id="L1982" name="L1982"></a>1982                     <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L1983" name="L1983"></a>1983             <em class="brace">}</em>
<a id="L1984" name="L1984"></a>1984             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L1985" name="L1985"></a>1985         <em class="brace">}</em>
<a id="L1986" name="L1986"></a>1986 
<div class="comment">
          Returns an estimate of the number of threads waiting on
          this condition.
          Implements {@link AbstractQueuedLongSynchronizer#getWaitQueueLength(ConditionObject)}.
          @return the estimated number of waiting threads
          @throws IllegalMonitorStateException if {@link #isHeldExclusively}
                  returns <code>false</code></div>
<a id="L1996" name="L1996"></a>1996         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <strong class="reserved">int</strong> <a href="../R/19840.html" title="Multiple referred from 4 places.">getWaitQueueLength</a>() <em class="brace">{</em>
<a id="L1997" name="L1997"></a>1997             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L1998" name="L1998"></a>1998                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L1999" name="L1999"></a>1999             <strong class="reserved">int</strong> n = 0;
<a id="L2000" name="L2000"></a>2000             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> w = firstWaiter; w != <strong class="reserved">null</strong>; w = w.nextWaiter) <em class="brace">{</em>
<a id="L2001" name="L2001"></a>2001                 <strong class="reserved">if</strong> (w.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION)
<a id="L2002" name="L2002"></a>2002                     ++n;
<a id="L2003" name="L2003"></a>2003             <em class="brace">}</em>
<a id="L2004" name="L2004"></a>2004             <strong class="reserved">return</strong> n;
<a id="L2005" name="L2005"></a>2005         <em class="brace">}</em>
<a id="L2006" name="L2006"></a>2006 
<div class="comment">
          Returns a collection containing those threads that may be
          waiting on this Condition.
          Implements {@link AbstractQueuedLongSynchronizer#getWaitingThreads(ConditionObject)}.
          @return the collection of threads
          @throws IllegalMonitorStateException if {@link #isHeldExclusively}
                  returns <code>false</code></div>
<a id="L2016" name="L2016"></a>2016         <strong class="reserved">protected</strong> <strong class="reserved">final</strong> <a href="../S/875.html#L144" title="Defined at 144 in src/java/util/Collection.java.">Collection</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../R/19841.html" title="Multiple referred from 4 places.">getWaitingThreads</a>() <em class="brace">{</em>
<a id="L2017" name="L2017"></a>2017             <strong class="reserved">if</strong> (!<a href="../D/25649.html" title="Multiple defined in 5 places.">isHeldExclusively</a>())
<a id="L2018" name="L2018"></a>2018                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1703.html#L42" title="Defined at 42 in src/java/lang/IllegalMonitorStateException.java.">IllegalMonitorStateException</a>();
<a id="L2019" name="L2019"></a>2019             <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt; <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a> = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;<a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>&gt;();
<a id="L2020" name="L2020"></a>2020             <strong class="reserved">for</strong> (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> w = firstWaiter; w != <strong class="reserved">null</strong>; w = w.nextWaiter) <em class="brace">{</em>
<a id="L2021" name="L2021"></a>2021                 <strong class="reserved">if</strong> (w.waitStatus == <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.CONDITION) <em class="brace">{</em>
<a id="L2022" name="L2022"></a>2022                     <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a> t = w.thread;
<a id="L2023" name="L2023"></a>2023                     <strong class="reserved">if</strong> (t != <strong class="reserved">null</strong>)
<a id="L2024" name="L2024"></a>2024                         <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(t);
<a id="L2025" name="L2025"></a>2025                 <em class="brace">}</em>
<a id="L2026" name="L2026"></a>2026             <em class="brace">}</em>
<a id="L2027" name="L2027"></a>2027             <strong class="reserved">return</strong> <a href="../D/26871.html" title="Multiple defined in 42 places.">list</a>;
<a id="L2028" name="L2028"></a>2028         <em class="brace">}</em>
<a id="L2029" name="L2029"></a>2029     <em class="brace">}</em>
<a id="L2030" name="L2030"></a>2030 
<div class="comment">
      Setup to support compareAndSet. We need to natively implement
      this here: For the sake of permitting future enhancements, we
      cannot explicitly subclass AtomicLong, which would be
      efficient and useful otherwise. So, as the lesser of evils, we
      natively implement using hotspot intrinsics API. And while we
      are at it, we do the same for other CASable fields (which could
      otherwise be done with atomic field updaters).</div>
<a id="L2040" name="L2040"></a>2040     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> Unsafe <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a> = Unsafe.getUnsafe();
<a id="L2041" name="L2041"></a>2041     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> stateOffset;
<a id="L2042" name="L2042"></a>2042     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> headOffset;
<a id="L2043" name="L2043"></a>2043     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> tailOffset;
<a id="L2044" name="L2044"></a>2044     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> waitStatusOffset;
<a id="L2045" name="L2045"></a>2045     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>;
<a id="L2046" name="L2046"></a>2046 
<a id="L2047" name="L2047"></a>2047     <strong class="reserved">static</strong> <em class="brace">{</em>
<a id="L2048" name="L2048"></a>2048         <strong class="reserved">try</strong> <em class="brace">{</em>
<a id="L2049" name="L2049"></a>2049             stateOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2050" name="L2050"></a>2050                 (<a href="../S/1044.html#L60" title="Defined at 60 in src/java/util/concurrent/locks/AbstractQueuedLongSynchronizer.java.">AbstractQueuedLongSynchronizer</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("state"));
<a id="L2051" name="L2051"></a>2051             headOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2052" name="L2052"></a>2052                 (<a href="../S/1044.html#L60" title="Defined at 60 in src/java/util/concurrent/locks/AbstractQueuedLongSynchronizer.java.">AbstractQueuedLongSynchronizer</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("head"));
<a id="L2053" name="L2053"></a>2053             tailOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2054" name="L2054"></a>2054                 (<a href="../S/1044.html#L60" title="Defined at 60 in src/java/util/concurrent/locks/AbstractQueuedLongSynchronizer.java.">AbstractQueuedLongSynchronizer</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("tail"));
<a id="L2055" name="L2055"></a>2055             waitStatusOffset = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2056" name="L2056"></a>2056                 (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("waitStatus"));
<a id="L2057" name="L2057"></a>2057             <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a> = <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.<a href="../D/28395.html" title="Multiple defined in 5 places.">objectFieldOffset</a>
<a id="L2058" name="L2058"></a>2058                 (<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<strong class="reserved">class</strong>.<a href="../S/1722.html#L2065" title="Defined at 2065 in src/java/lang/Class.java.">getDeclaredField</a>("next"));
<a id="L2059" name="L2059"></a>2059 
<a id="L2060" name="L2060"></a>2060         <em class="brace">}</em> <strong class="reserved">catch</strong> (<a href="../S/1582.html#L45" title="Defined at 45 in src/java/lang/Exception.java.">Exception</a> <a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>) <em class="brace">{</em> <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1772.html#L49" title="Defined at 49 in src/java/lang/Error.java.">Error</a>(<a href="../S/5015.html#L111" title="Defined at 111 in src/com/sun/org/apache/xerces/internal/impl/xpath/regex/RegexParser.java.">ex</a>); <em class="brace">}</em>
<a id="L2061" name="L2061"></a>2061     <em class="brace">}</em>
<a id="L2062" name="L2062"></a>2062 
<div class="comment">
      CAS head field. Used only by enq.</div>
<a id="L2066" name="L2066"></a>2066     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11696.html" title="Multiple referred from 2 places.">compareAndSetHead</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2067" name="L2067"></a>2067         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapObject(<strong class="reserved">this</strong>, headOffset, <strong class="reserved">null</strong>, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2068" name="L2068"></a>2068     <em class="brace">}</em>
<a id="L2069" name="L2069"></a>2069 
<div class="comment">
      CAS tail field. Used only by enq.</div>
<a id="L2073" name="L2073"></a>2073     <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11701.html" title="Multiple referred from 6 places.">compareAndSetTail</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> expect, <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2074" name="L2074"></a>2074         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapObject(<strong class="reserved">this</strong>, tailOffset, expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2075" name="L2075"></a>2075     <em class="brace">}</em>
<a id="L2076" name="L2076"></a>2076 
<div class="comment">
      CAS waitStatus field of a node.</div>
<a id="L2080" name="L2080"></a>2080     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11702.html" title="Multiple referred from 16 places.">compareAndSetWaitStatus</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>,
<a id="L2081" name="L2081"></a>2081                                                          <strong class="reserved">int</strong> expect,
<a id="L2082" name="L2082"></a>2082                                                          <strong class="reserved">int</strong> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2083" name="L2083"></a>2083         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapInt(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, waitStatusOffset,
<a id="L2084" name="L2084"></a>2084                                         expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2085" name="L2085"></a>2085     <em class="brace">}</em>
<a id="L2086" name="L2086"></a>2086 
<div class="comment">
      CAS next field of a node.</div>
<a id="L2090" name="L2090"></a>2090     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> <a href="../R/11697.html" title="Multiple referred from 4 places.">compareAndSetNext</a>(<a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>,
<a id="L2091" name="L2091"></a>2091                                                    <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> expect,
<a id="L2092" name="L2092"></a>2092                                                    <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a> <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>) <em class="brace">{</em>
<a id="L2093" name="L2093"></a>2093         <strong class="reserved">return</strong> <a href="../S/1996.html#L558" title="Defined at 558 in src/java/nio/Bits.java.">unsafe</a>.compareAndSwapObject(<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>, <a href="../D/28171.html" title="Multiple defined in 2 places.">nextOffset</a>, expect, <a href="../D/36027.html" title="Multiple defined in 124 places.">update</a>);
<a id="L2094" name="L2094"></a>2094     <em class="brace">}</em>
<a id="L2095" name="L2095"></a>2095 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L261">[^]</a><a href="#L2090">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>