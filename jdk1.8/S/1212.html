<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/security/AccessControlContext.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L103">[^]</a><a href="#L942">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L103" title="Defined at 103.">getDebug</a></li>
<li><a href="#L309" title="Defined at 309.">getContext</a></li>
<li><a href="#L316" title="Defined at 316.">isPrivileged</a></li>
<li><a href="#L324" title="Defined at 324.">getAssignedCombiner</a></li>
<li><a href="#L352" title="Defined at 352.">getDomainCombiner</a></li>
<li><a href="#L364" title="Defined at 364.">getCombiner</a></li>
<li><a href="#L368" title="Defined at 368.">isAuthorized</a></li>
<li><a href="#L391" title="Defined at 391.">checkPermission</a></li>
<li><a href="#L487" title="Defined at 487.">checkPermission2</a></li>
<li><a href="#L551" title="Defined at 551.">optimize</a></li>
<li><a href="#L650" title="Defined at 650.">combine</a></li>
<li><a href="#L718" title="Defined at 718.">calculateFields</a></li>
<li><a href="#L749" title="Defined at 749.">equals</a></li>
<li><a href="#L771" title="Defined at 771.">equalContext</a></li>
<li><a href="#L784" title="Defined at 784.">equalPDs</a></li>
<li><a href="#L803" title="Defined at 803.">equalLimitedContext</a></li>
<li><a href="#L870" title="Defined at 870.">getNextPC</a></li>
<li><a href="#L879" title="Defined at 879.">containsAllPDs</a></li>
<li><a href="#L912" title="Defined at 912.">containsAllLimits</a></li>
<li><a href="#L942" title="Defined at 942.">hashCode</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 1997, 2015, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 
<a id="L26" name="L26"></a>  26 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.security;
<a id="L27" name="L27"></a>  27 
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.ArrayList;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.util.List;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> sun.security.util.Debug;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> sun.security.util.SecurityConstants;
<a id="L32" name="L32"></a>  32 
<a id="L33" name="L33"></a>  33 
<div class="comment">
  An AccessControlContext is used to make system resource access decisions
  based on the context it encapsulates.
  <p>More specifically, it encapsulates a context and
  has a single method, <code>checkPermission</code>,
  that is equivalent to the <code>checkPermission</code> method
  in the AccessController class, with one difference: The AccessControlContext
  <code>checkPermission</code> method makes access decisions based on the
  context it encapsulates,
  rather than that of the current execution thread.
  </p><p>Thus, the purpose of AccessControlContext is for those situations where
  a security check that should be made within a given context
  actually needs to be done from within a
  <i>different</i> context (for example, from within a worker thread).
  </p><p> An AccessControlContext is created by calling the
  <code>AccessController.getContext</code> method.
  The <code>getContext</code> method takes a "snapshot"
  of the current calling context, and places
  it in an AccessControlContext object, which it returns. A sample call is
  the following:
  </p><pre>    AccessControlContext acc = AccessController.getContext()
  </pre>
  <p>
  Code within a different context can subsequently call the
  <code>checkPermission</code> method on the
  previously-saved AccessControlContext object. A sample call is the
  following:
  </p><pre>    acc.checkPermission(permission)
  </pre>
  @see AccessController
  @author Roland Schemers</div>
<a id="L76" name="L76"></a>  76 
<a id="L77" name="L77"></a>  77 <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/138.html" title="Multiple referred from 210 places.">AccessControlContext</a> <em class="brace">{</em>
<a id="L78" name="L78"></a>  78 
<a id="L79" name="L79"></a>  79     <strong class="reserved">private</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[];
<a id="L80" name="L80"></a>  80     <em class="comment">// isPrivileged and isAuthorized are referenced by the VM - do not remove</em>
<a id="L81" name="L81"></a>  81     <em class="comment">// or change their names</em>
<a id="L82" name="L82"></a>  82     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a>;
<a id="L83" name="L83"></a>  83     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../D/25225.html" title="Multiple defined in 2 places.">isAuthorized</a> = <strong class="reserved">false</strong>;
<a id="L84" name="L84"></a>  84 
<a id="L85" name="L85"></a>  85     <em class="comment">// Note: This field is directly used by the virtual machine</em>
<a id="L86" name="L86"></a>  86     <em class="comment">// native codes. Don't touch it.</em>
<a id="L87" name="L87"></a>  87     <strong class="reserved">private</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> privilegedContext;
<a id="L88" name="L88"></a>  88 
<a id="L89" name="L89"></a>  89     <strong class="reserved">private</strong> <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> = <strong class="reserved">null</strong>;
<a id="L90" name="L90"></a>  90 
<a id="L91" name="L91"></a>  91     <em class="comment">// limited privilege scope</em>
<a id="L92" name="L92"></a>  92     <strong class="reserved">private</strong> <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>[];
<a id="L93" name="L93"></a>  93     <strong class="reserved">private</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>;
<a id="L94" name="L94"></a>  94     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> isWrapped;
<a id="L95" name="L95"></a>  95 
<a id="L96" name="L96"></a>  96     <em class="comment">// is constrained by limited privilege scope?</em>
<a id="L97" name="L97"></a>  97     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> isLimited;
<a id="L98" name="L98"></a>  98     <strong class="reserved">private</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> limitedContext[];
<a id="L99" name="L99"></a>  99 
<a id="L100" name="L100"></a> 100     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> debugInit = <strong class="reserved">false</strong>;
<a id="L101" name="L101"></a> 101     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a> <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> = <strong class="reserved">null</strong>;
<a id="L102" name="L102"></a> 102 
<a id="L103" name="L103"></a> 103     <strong class="reserved">static</strong> <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a> <a href="../R/15967.html" title="Multiple referred from 23 places.">getDebug</a>()
<a id="L104" name="L104"></a> 104     <em class="brace">{</em>
<a id="L105" name="L105"></a> 105         <strong class="reserved">if</strong> (debugInit)
<a id="L106" name="L106"></a> 106             <strong class="reserved">return</strong> <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>;
<a id="L107" name="L107"></a> 107         <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L108" name="L108"></a> 108             <strong class="reserved">if</strong> (<a href="../D/6725.html" title="Multiple defined in 3 places.">Policy</a>.<a href="../D/26230.html" title="Multiple defined in 16 places.">isSet</a>()) <em class="brace">{</em>
<a id="L109" name="L109"></a> 109                 <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> = <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.<a href="../D/19762.html" title="Multiple defined in 157 places.">getInstance</a>("access");
<a id="L110" name="L110"></a> 110                 debugInit = <strong class="reserved">true</strong>;
<a id="L111" name="L111"></a> 111             <em class="brace">}</em>
<a id="L112" name="L112"></a> 112             <strong class="reserved">return</strong> <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>;
<a id="L113" name="L113"></a> 113         <em class="brace">}</em>
<a id="L114" name="L114"></a> 114     <em class="brace">}</em>
<a id="L115" name="L115"></a> 115 
<div class="comment">
      Create an AccessControlContext with the given array of ProtectionDomains.
      Context must not be null. Duplicate domains will be removed from the
      context.
      @param context the ProtectionDomains associated with this context.
      The non-duplicate domains are copied from the array. Subsequent
      changes to the array will not affect this AccessControlContext.
      @throws NullPointerException if <code>context</code> is <code>null</code></div>
<a id="L126" name="L126"></a> 126     <strong class="reserved">public</strong> AccessControlContext(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[])
<a id="L127" name="L127"></a> 127     <em class="brace">{</em>
<a id="L128" name="L128"></a> 128         <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 0) <em class="brace">{</em>
<a id="L129" name="L129"></a> 129             <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <strong class="reserved">null</strong>;
<a id="L130" name="L130"></a> 130         <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 1) <em class="brace">{</em>
<a id="L131" name="L131"></a> 131             <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[0] != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L132" name="L132"></a> 132                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/12888.html" title="Multiple defined in 229 places.">clone</a>();
<a id="L133" name="L133"></a> 133             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L134" name="L134"></a> 134                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <strong class="reserved">null</strong>;
<a id="L135" name="L135"></a> 135             <em class="brace">}</em>
<a id="L136" name="L136"></a> 136         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L137" name="L137"></a> 137             <a href="../D/5090.html" title="Multiple defined in 5 places.">List</a>&lt;<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>&gt; v = <strong class="reserved">new</strong> <a href="../D/498.html" title="Multiple defined in 2 places.">ArrayList</a>&lt;&gt;(<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>);
<a id="L138" name="L138"></a> 138             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i =0; i&lt; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L139" name="L139"></a> 139                 <strong class="reserved">if</strong> ((<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i] != <strong class="reserved">null</strong>) &amp;&amp;  (!v.<a href="../D/13313.html" title="Multiple defined in 245 places.">contains</a>(<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i])))
<a id="L140" name="L140"></a> 140                     v.<a href="../D/10632.html" title="Multiple defined in 301 places.">add</a>(<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i]);
<a id="L141" name="L141"></a> 141             <em class="brace">}</em>
<a id="L142" name="L142"></a> 142             <strong class="reserved">if</strong> (!v.<a href="../D/25493.html" title="Multiple defined in 113 places.">isEmpty</a>()) <em class="brace">{</em>
<a id="L143" name="L143"></a> 143                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <strong class="reserved">new</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[v.<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>()];
<a id="L144" name="L144"></a> 144                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = v.<a href="../D/35348.html" title="Multiple defined in 117 places.">toArray</a>(<strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>);
<a id="L145" name="L145"></a> 145             <em class="brace">}</em>
<a id="L146" name="L146"></a> 146         <em class="brace">}</em>
<a id="L147" name="L147"></a> 147     <em class="brace">}</em>
<a id="L148" name="L148"></a> 148 
<div class="comment">
      Create a new <code>AccessControlContext</code> with the given
      <code>AccessControlContext</code> and <code>DomainCombiner</code>.
      This constructor associates the provided
      <code>DomainCombiner</code> with the provided
      <code>AccessControlContext</code>.
      <p>
      @param acc the <code>AccessControlContext</code> associated
               with the provided <code>DomainCombiner</code>.
      @param combiner the <code>DomainCombiner</code> to be associated
               with the provided <code>AccessControlContext</code>.
      @exception NullPointerException if the provided
               <code>context</code> is <code>null</code>.
      @exception SecurityException if a security manager is installed and the
               caller does not have the "createAccessControlContext"
               {@link SecurityPermission}
      @since 1.3</p></div>
<a id="L172" name="L172"></a> 172     <strong class="reserved">public</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a>(AccessControlContext acc,
<a id="L173" name="L173"></a> 173                                 <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>) <em class="brace">{</em>
<a id="L174" name="L174"></a> 174 
<a id="L175" name="L175"></a> 175         <strong class="reserved">this</strong>(acc, <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>, <strong class="reserved">false</strong>);
<a id="L176" name="L176"></a> 176     <em class="brace">}</em>
<a id="L177" name="L177"></a> 177 
<div class="comment">
      package private to allow calls from ProtectionDomain without performing
      the security check for {@linkplain SecurityConstants.CREATE_ACC_PERMISSION}
      permission</div>
<a id="L183" name="L183"></a> 183     <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a>(AccessControlContext acc,
<a id="L184" name="L184"></a> 184                         <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>,
<a id="L185" name="L185"></a> 185                         <strong class="reserved">boolean</strong> preauthorized) <em class="brace">{</em>
<a id="L186" name="L186"></a> 186         <strong class="reserved">if</strong> (!preauthorized) <em class="brace">{</em>
<a id="L187" name="L187"></a> 187             <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> sm = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L188" name="L188"></a> 188             <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L189" name="L189"></a> 189                 sm.<a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>(SecurityConstants.CREATE_ACC_PERMISSION);
<a id="L190" name="L190"></a> 190                 <strong class="reserved">this</strong>.<a href="../D/25225.html" title="Multiple defined in 2 places.">isAuthorized</a> = <strong class="reserved">true</strong>;
<a id="L191" name="L191"></a> 191             <em class="brace">}</em>
<a id="L192" name="L192"></a> 192         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L193" name="L193"></a> 193             <strong class="reserved">this</strong>.<a href="../D/25225.html" title="Multiple defined in 2 places.">isAuthorized</a> = <strong class="reserved">true</strong>;
<a id="L194" name="L194"></a> 194         <em class="brace">}</em>
<a id="L195" name="L195"></a> 195 
<a id="L196" name="L196"></a> 196         <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = acc.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>;
<a id="L197" name="L197"></a> 197 
<a id="L198" name="L198"></a> 198         <em class="comment">// we do not need to run the combine method on the</em>
<a id="L199" name="L199"></a> 199         <em class="comment">// provided ACC.  it was already "combined" when the</em>
<a id="L200" name="L200"></a> 200         <em class="comment">// context was originally retrieved.</em>
<a id="L201" name="L201"></a> 201         <em class="comment">//</em>
<a id="L202" name="L202"></a> 202         <em class="comment">// at this point in time, we simply throw away the old</em>
<a id="L203" name="L203"></a> 203         <em class="comment">// combiner and use the newly provided one.</em>
<a id="L204" name="L204"></a> 204         <strong class="reserved">this</strong>.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> = <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>;
<a id="L205" name="L205"></a> 205     <em class="brace">}</em>
<a id="L206" name="L206"></a> 206 
<div class="comment">
      package private for AccessController
      This "argument wrapper" context will be passed as the actual context
      parameter on an internal doPrivileged() call used in the implementation.</div>
<a id="L213" name="L213"></a> 213     AccessControlContext(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> caller, <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>,
<a id="L214" name="L214"></a> 214         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>, <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>,
<a id="L215" name="L215"></a> 215         <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a>[] perms)
<a id="L216" name="L216"></a> 216     <em class="brace">{</em>
<div class="comment">
          Combine the domains from the doPrivileged() context into our
          wrapper context, if necessary.</div>
<a id="L221" name="L221"></a> 221         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] callerPDs = <strong class="reserved">null</strong>;
<a id="L222" name="L222"></a> 222         <strong class="reserved">if</strong> (caller != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L223" name="L223"></a> 223              callerPDs = <strong class="reserved">new</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] <em class="brace">{</em> caller <em class="brace">}</em>;
<a id="L224" name="L224"></a> 224         <em class="brace">}</em>
<a id="L225" name="L225"></a> 225         <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L226" name="L226"></a> 226             <strong class="reserved">if</strong> (<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L227" name="L227"></a> 227                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>.<a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(callerPDs, <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>);
<a id="L228" name="L228"></a> 228             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L229" name="L229"></a> 229                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(callerPDs, <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>);
<a id="L230" name="L230"></a> 230             <em class="brace">}</em>
<a id="L231" name="L231"></a> 231         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<div class="comment">
              Call combiner even if there is seemingly nothing to combine.</div>
<a id="L235" name="L235"></a> 235             <strong class="reserved">if</strong> (<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L236" name="L236"></a> 236                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>.<a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(callerPDs, <strong class="reserved">null</strong>);
<a id="L237" name="L237"></a> 237             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L238" name="L238"></a> 238                 <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(callerPDs, <strong class="reserved">null</strong>);
<a id="L239" name="L239"></a> 239             <em class="brace">}</em>
<a id="L240" name="L240"></a> 240         <em class="brace">}</em>
<a id="L241" name="L241"></a> 241         <strong class="reserved">this</strong>.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> = <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>;
<a id="L242" name="L242"></a> 242 
<a id="L243" name="L243"></a> 243         <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a>[] tmp = <strong class="reserved">null</strong>;
<a id="L244" name="L244"></a> 244         <strong class="reserved">if</strong> (perms != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L245" name="L245"></a> 245             tmp = <strong class="reserved">new</strong> <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a>[perms.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>];
<a id="L246" name="L246"></a> 246             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i &lt; perms.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L247" name="L247"></a> 247                 <strong class="reserved">if</strong> (perms[i] == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L248" name="L248"></a> 248                     <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("permission can't be null");
<a id="L249" name="L249"></a> 249                 <em class="brace">}</em>
<a id="L250" name="L250"></a> 250 
<div class="comment">
                  An AllPermission argument is equivalent to calling
                  doPrivileged() without any limit permissions.</div>
<a id="L255" name="L255"></a> 255                 <strong class="reserved">if</strong> (perms[i].<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>() == <a href="../S/1336.html#L58" title="Defined at 58 in src/java/security/AllPermission.java.">AllPermission</a>.<strong class="reserved">class</strong>) <em class="brace">{</em>
<a id="L256" name="L256"></a> 256                     <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> = <strong class="reserved">null</strong>;
<a id="L257" name="L257"></a> 257                 <em class="brace">}</em>
<a id="L258" name="L258"></a> 258                 tmp[i] = perms[i];
<a id="L259" name="L259"></a> 259             <em class="brace">}</em>
<a id="L260" name="L260"></a> 260         <em class="brace">}</em>
<a id="L261" name="L261"></a> 261 
<div class="comment">
          For a doPrivileged() with limited privilege scope, initialize
          the relevant fields.
          The limitedContext field contains the union of all domains which
          are enclosed by this limited privilege scope. In other words,
          it contains all of the domains which could potentially be checked
          if none of the limiting permissions implied a requested permission.</div>
<a id="L271" name="L271"></a> 271         <strong class="reserved">if</strong> (<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L272" name="L272"></a> 272             <strong class="reserved">this</strong>.limitedContext = <a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>, <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.limitedContext);
<a id="L273" name="L273"></a> 273             <strong class="reserved">this</strong>.isLimited = <strong class="reserved">true</strong>;
<a id="L274" name="L274"></a> 274             <strong class="reserved">this</strong>.isWrapped = <strong class="reserved">true</strong>;
<a id="L275" name="L275"></a> 275             <strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> = tmp;
<a id="L276" name="L276"></a> 276             <strong class="reserved">this</strong>.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>;
<a id="L277" name="L277"></a> 277             <strong class="reserved">this</strong>.privilegedContext = <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>; <em class="comment">// used in checkPermission2()</em>
<a id="L278" name="L278"></a> 278         <em class="brace">}</em>
<a id="L279" name="L279"></a> 279         <strong class="reserved">this</strong>.<a href="../D/25225.html" title="Multiple defined in 2 places.">isAuthorized</a> = <strong class="reserved">true</strong>;
<a id="L280" name="L280"></a> 280     <em class="brace">}</em>
<a id="L281" name="L281"></a> 281 
<a id="L282" name="L282"></a> 282 
<div class="comment">
      package private constructor for AccessController.getContext()</div>
<a id="L286" name="L286"></a> 286 
<a id="L287" name="L287"></a> 287     AccessControlContext(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[],
<a id="L288" name="L288"></a> 288                          <strong class="reserved">boolean</strong> <a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a>)
<a id="L289" name="L289"></a> 289     <em class="brace">{</em>
<a id="L290" name="L290"></a> 290         <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>;
<a id="L291" name="L291"></a> 291         <strong class="reserved">this</strong>.<a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a> = <a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a>;
<a id="L292" name="L292"></a> 292         <strong class="reserved">this</strong>.<a href="../D/25225.html" title="Multiple defined in 2 places.">isAuthorized</a> = <strong class="reserved">true</strong>;
<a id="L293" name="L293"></a> 293     <em class="brace">}</em>
<a id="L294" name="L294"></a> 294 
<div class="comment">
      Constructor for JavaSecurityAccess.doIntersectionPrivilege()</div>
<a id="L298" name="L298"></a> 298     AccessControlContext(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>,
<a id="L299" name="L299"></a> 299                          <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> privilegedContext)
<a id="L300" name="L300"></a> 300     <em class="brace">{</em>
<a id="L301" name="L301"></a> 301         <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>;
<a id="L302" name="L302"></a> 302         <strong class="reserved">this</strong>.privilegedContext = privilegedContext;
<a id="L303" name="L303"></a> 303         <strong class="reserved">this</strong>.<a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a> = <strong class="reserved">true</strong>;
<a id="L304" name="L304"></a> 304     <em class="brace">}</em>
<a id="L305" name="L305"></a> 305 
<div class="comment">
      Returns this context's context.</div>
<a id="L309" name="L309"></a> 309     <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] <a href="../R/15801.html" title="Multiple referred from 401 places.">getContext</a>() <em class="brace">{</em>
<a id="L310" name="L310"></a> 310         <strong class="reserved">return</strong> <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>;
<a id="L311" name="L311"></a> 311     <em class="brace">}</em>
<a id="L312" name="L312"></a> 312 
<div class="comment">
      Returns true if this context is privileged.</div>
<a id="L316" name="L316"></a> 316     <strong class="reserved">boolean</strong> <a href="../R/21904.html" title="Multiple referred from 8 places.">isPrivileged</a>()
<a id="L317" name="L317"></a> 317     <em class="brace">{</em>
<a id="L318" name="L318"></a> 318         <strong class="reserved">return</strong> <a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a>;
<a id="L319" name="L319"></a> 319     <em class="brace">}</em>
<a id="L320" name="L320"></a> 320 
<div class="comment">
      get the assigned combiner from the privileged or inherited context</div>
<a id="L324" name="L324"></a> 324     <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../R/15128.html" title="Multiple referred from 2 places.">getAssignedCombiner</a>() <em class="brace">{</em>
<a id="L325" name="L325"></a> 325         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> acc;
<a id="L326" name="L326"></a> 326         <strong class="reserved">if</strong> (<a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a>) <em class="brace">{</em>
<a id="L327" name="L327"></a> 327             acc = privilegedContext;
<a id="L328" name="L328"></a> 328         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L329" name="L329"></a> 329             acc = <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../S/1248.html#L805" title="Defined at 805 in src/java/security/AccessController.java.">getInheritedAccessControlContext</a>();
<a id="L330" name="L330"></a> 330         <em class="brace">}</em>
<a id="L331" name="L331"></a> 331         <strong class="reserved">if</strong> (acc != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L332" name="L332"></a> 332             <strong class="reserved">return</strong> acc.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>;
<a id="L333" name="L333"></a> 333         <em class="brace">}</em>
<a id="L334" name="L334"></a> 334         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L335" name="L335"></a> 335     <em class="brace">}</em>
<a id="L336" name="L336"></a> 336 
<div class="comment">
      Get the <code>DomainCombiner</code> associated with this
      <code>AccessControlContext</code>.
      <p>
      @return the <code>DomainCombiner</code> associated with this
               <code>AccessControlContext</code>, or <code>null</code>
               if there is none.
      @exception SecurityException if a security manager is installed and
               the caller does not have the "getDomainCombiner"
               {@link SecurityPermission}
      @since 1.3</p></div>
<a id="L352" name="L352"></a> 352     <strong class="reserved">public</strong> <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../S/2639.html#L299" title="Referred from 299 in src/javax/security/auth/Subject.java.">getDomainCombiner</a>() <em class="brace">{</em>
<a id="L353" name="L353"></a> 353 
<a id="L354" name="L354"></a> 354         <a href="../D/7682.html" title="Multiple defined in 2 places.">SecurityManager</a> sm = <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L333" title="Defined at 333 in src/java/lang/System.java.">getSecurityManager</a>();
<a id="L355" name="L355"></a> 355         <strong class="reserved">if</strong> (sm != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L356" name="L356"></a> 356             sm.<a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>(SecurityConstants.GET_COMBINER_PERMISSION);
<a id="L357" name="L357"></a> 357         <em class="brace">}</em>
<a id="L358" name="L358"></a> 358         <strong class="reserved">return</strong> <a href="../S/1212.html#L364" title="Defined at 364 in src/java/security/AccessControlContext.java.">getCombiner</a>();
<a id="L359" name="L359"></a> 359     <em class="brace">}</em>
<a id="L360" name="L360"></a> 360 
<div class="comment">
      package private for AccessController</div>
<a id="L364" name="L364"></a> 364     <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../R/15686.html" title="Multiple referred from 9 places.">getCombiner</a>() <em class="brace">{</em>
<a id="L365" name="L365"></a> 365         <strong class="reserved">return</strong> <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>;
<a id="L366" name="L366"></a> 366     <em class="brace">}</em>
<a id="L367" name="L367"></a> 367 
<a id="L368" name="L368"></a> 368     <strong class="reserved">boolean</strong> <a href="../R/21191.html" title="Multiple referred from 7 places.">isAuthorized</a>() <em class="brace">{</em>
<a id="L369" name="L369"></a> 369         <strong class="reserved">return</strong> <a href="../D/25225.html" title="Multiple defined in 2 places.">isAuthorized</a>;
<a id="L370" name="L370"></a> 370     <em class="brace">}</em>
<a id="L371" name="L371"></a> 371 
<div class="comment">
      Determines whether the access request indicated by the
      specified permission should be allowed or denied, based on
      the security policy currently in effect, and the context in
      this object. The request is allowed only if every ProtectionDomain
      in the context implies the permission. Otherwise the request is
      denied.
      <p>
      This method quietly returns if the access request
      is permitted, or throws a suitable AccessControlException otherwise.
      @param perm the requested permission.
      @exception AccessControlException if the specified permission
      is not permitted, based on the current security policy and the
      context encapsulated by this object.
      @exception NullPointerException if the permission to check for is null.</p></div>
<a id="L391" name="L391"></a> 391     <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/11295.html" title="Multiple referred from 248 places.">checkPermission</a>(<a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> perm)
<a id="L392" name="L392"></a> 392         <strong class="reserved">throws</strong> <a href="../S/1326.html#L43" title="Defined at 43 in src/java/security/AccessControlException.java.">AccessControlException</a>
<a id="L393" name="L393"></a> 393     <em class="brace">{</em>
<a id="L394" name="L394"></a> 394         <strong class="reserved">boolean</strong> dumpDebug = <strong class="reserved">false</strong>;
<a id="L395" name="L395"></a> 395 
<a id="L396" name="L396"></a> 396         <strong class="reserved">if</strong> (perm == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L397" name="L397"></a> 397             <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1559.html#L53" title="Defined at 53 in src/java/lang/NullPointerException.java.">NullPointerException</a>("permission can't be null");
<a id="L398" name="L398"></a> 398         <em class="brace">}</em>
<a id="L399" name="L399"></a> 399         <strong class="reserved">if</strong> (<a href="../D/18231.html" title="Multiple defined in 4 places.">getDebug</a>() != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L400" name="L400"></a> 400             <em class="comment">// If "codebase" is not specified, we dump the info by default.</em>
<a id="L401" name="L401"></a> 401             dumpDebug = !<a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("codebase=");
<a id="L402" name="L402"></a> 402             <strong class="reserved">if</strong> (!dumpDebug) <em class="brace">{</em>
<a id="L403" name="L403"></a> 403                 <em class="comment">// If "codebase" is specified, only dump if the specified code</em>
<a id="L404" name="L404"></a> 404                 <em class="comment">// value is in the stack.</em>
<a id="L405" name="L405"></a> 405                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> != <strong class="reserved">null</strong> &amp;&amp; i &lt; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L406" name="L406"></a> 406                     <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i].<a href="../D/17761.html" title="Multiple defined in 5 places.">getCodeSource</a>() != <strong class="reserved">null</strong> &amp;&amp;
<a id="L407" name="L407"></a> 407                         <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i].<a href="../D/17761.html" title="Multiple defined in 5 places.">getCodeSource</a>().<a href="../D/20238.html" title="Multiple defined in 36 places.">getLocation</a>() != <strong class="reserved">null</strong> &amp;&amp;
<a id="L408" name="L408"></a> 408                         <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("codebase=" + <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i].<a href="../D/17761.html" title="Multiple defined in 5 places.">getCodeSource</a>().<a href="../D/20238.html" title="Multiple defined in 36 places.">getLocation</a>().<a href="../D/35493.html" title="Multiple defined in 1021 places.">toString</a>())) <em class="brace">{</em>
<a id="L409" name="L409"></a> 409                         dumpDebug = <strong class="reserved">true</strong>;
<a id="L410" name="L410"></a> 410                         <strong class="reserved">break</strong>;
<a id="L411" name="L411"></a> 411                     <em class="brace">}</em>
<a id="L412" name="L412"></a> 412                 <em class="brace">}</em>
<a id="L413" name="L413"></a> 413             <em class="brace">}</em>
<a id="L414" name="L414"></a> 414 
<a id="L415" name="L415"></a> 415             dumpDebug &amp;= !<a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("permission=") ||
<a id="L416" name="L416"></a> 416                 <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("permission=" + perm.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>().<a href="../D/17480.html" title="Multiple defined in 4 places.">getCanonicalName</a>());
<a id="L417" name="L417"></a> 417 
<a id="L418" name="L418"></a> 418             <strong class="reserved">if</strong> (dumpDebug &amp;&amp; <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("stack")) <em class="brace">{</em>
<a id="L419" name="L419"></a> 419                 <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L1328" title="Defined at 1328 in src/java/lang/Thread.java.">dumpStack</a>();
<a id="L420" name="L420"></a> 420             <em class="brace">}</em>
<a id="L421" name="L421"></a> 421 
<a id="L422" name="L422"></a> 422             <strong class="reserved">if</strong> (dumpDebug &amp;&amp; <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("domain")) <em class="brace">{</em>
<a id="L423" name="L423"></a> 423                 <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L424" name="L424"></a> 424                     <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("domain (context is null)");
<a id="L425" name="L425"></a> 425                 <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L426" name="L426"></a> 426                     <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i&lt; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L427" name="L427"></a> 427                         <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("domain "+i+" "+<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i]);
<a id="L428" name="L428"></a> 428                     <em class="brace">}</em>
<a id="L429" name="L429"></a> 429                 <em class="brace">}</em>
<a id="L430" name="L430"></a> 430             <em class="brace">}</em>
<a id="L431" name="L431"></a> 431         <em class="brace">}</em>
<a id="L432" name="L432"></a> 432 
<div class="comment">
          iterate through the ProtectionDomains in the context.
          Stop at the first one that doesn't allow the
          requested permission (throwing an exception).</div>
<a id="L439" name="L439"></a> 439 
<div class="comment">
 if ctxt is null, all we had on the stack were system domains,
           or the first domain was a Privileged system domain. This
           is to make the common case for system code very fast </div>
<a id="L443" name="L443"></a> 443 
<a id="L444" name="L444"></a> 444         <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L445" name="L445"></a> 445             <a href="../S/1212.html#L487" title="Defined at 487 in src/java/security/AccessControlContext.java.">checkPermission2</a>(perm);
<a id="L446" name="L446"></a> 446             <strong class="reserved">return</strong>;
<a id="L447" name="L447"></a> 447         <em class="brace">}</em>
<a id="L448" name="L448"></a> 448 
<a id="L449" name="L449"></a> 449         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i&lt; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L450" name="L450"></a> 450             <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i] != <strong class="reserved">null</strong> &amp;&amp;  !<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i].<a href="../D/24381.html" title="Multiple defined in 34 places.">implies</a>(perm)) <em class="brace">{</em>
<a id="L451" name="L451"></a> 451                 <strong class="reserved">if</strong> (dumpDebug) <em class="brace">{</em>
<a id="L452" name="L452"></a> 452                     <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("access denied " + perm);
<a id="L453" name="L453"></a> 453                 <em class="brace">}</em>
<a id="L454" name="L454"></a> 454 
<a id="L455" name="L455"></a> 455                 <strong class="reserved">if</strong> (<a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a>.isOn("failure") &amp;&amp; <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L456" name="L456"></a> 456                     <em class="comment">// Want to make sure this is always displayed for failure,</em>
<a id="L457" name="L457"></a> 457                     <em class="comment">// but do not want to display again if already displayed</em>
<a id="L458" name="L458"></a> 458                     <em class="comment">// above.</em>
<a id="L459" name="L459"></a> 459                     <strong class="reserved">if</strong> (!dumpDebug) <em class="brace">{</em>
<a id="L460" name="L460"></a> 460                         <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("access denied " + perm);
<a id="L461" name="L461"></a> 461                     <em class="brace">}</em>
<a id="L462" name="L462"></a> 462                     <a href="../S/1769.html#L141" title="Defined at 141 in src/java/lang/Thread.java.">Thread</a>.<a href="../S/1769.html#L1328" title="Defined at 1328 in src/java/lang/Thread.java.">dumpStack</a>();
<a id="L463" name="L463"></a> 463                     <strong class="reserved">final</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> pd = <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i];
<a id="L464" name="L464"></a> 464                     <strong class="reserved">final</strong> <a href="../D/2238.html" title="Multiple defined in 2 places.">Debug</a> db = <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>;
<a id="L465" name="L465"></a> 465                     <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../D/15060.html" title="Multiple defined in 7 places.">doPrivileged</a> (<strong class="reserved">new</strong> <a href="../S/1321.html#L42" title="Defined at 42 in src/java/security/PrivilegedAction.java.">PrivilegedAction</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt;() <em class="brace">{</em>
<a id="L466" name="L466"></a> 466                         <strong class="reserved">public</strong> <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../D/31480.html" title="Multiple defined in 101 places.">run</a>() <em class="brace">{</em>
<a id="L467" name="L467"></a> 467                             db.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("domain that failed "+pd);
<a id="L468" name="L468"></a> 468                             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L469" name="L469"></a> 469                         <em class="brace">}</em>
<a id="L470" name="L470"></a> 470                     <em class="brace">}</em>);
<a id="L471" name="L471"></a> 471                 <em class="brace">}</em>
<a id="L472" name="L472"></a> 472                 <strong class="reserved">throw</strong> <strong class="reserved">new</strong> <a href="../S/1326.html#L43" title="Defined at 43 in src/java/security/AccessControlException.java.">AccessControlException</a>("access denied "+perm, perm);
<a id="L473" name="L473"></a> 473             <em class="brace">}</em>
<a id="L474" name="L474"></a> 474         <em class="brace">}</em>
<a id="L475" name="L475"></a> 475 
<a id="L476" name="L476"></a> 476         <em class="comment">// allow if all of them allowed access</em>
<a id="L477" name="L477"></a> 477         <strong class="reserved">if</strong> (dumpDebug) <em class="brace">{</em>
<a id="L478" name="L478"></a> 478             <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("access allowed "+perm);
<a id="L479" name="L479"></a> 479         <em class="brace">}</em>
<a id="L480" name="L480"></a> 480 
<a id="L481" name="L481"></a> 481         <a href="../S/1212.html#L487" title="Defined at 487 in src/java/security/AccessControlContext.java.">checkPermission2</a>(perm);
<a id="L482" name="L482"></a> 482     <em class="brace">}</em>
<a id="L483" name="L483"></a> 483 
<div class="comment">
      Check the domains associated with the limited privilege scope.</div>
<a id="L487" name="L487"></a> 487     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/11296.html" title="Multiple referred from 4 places.">checkPermission2</a>(<a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> perm) <em class="brace">{</em>
<a id="L488" name="L488"></a> 488         <strong class="reserved">if</strong> (!isLimited) <em class="brace">{</em>
<a id="L489" name="L489"></a> 489             <strong class="reserved">return</strong>;
<a id="L490" name="L490"></a> 490         <em class="brace">}</em>
<a id="L491" name="L491"></a> 491 
<div class="comment">
          Check the doPrivileged() context parameter, if present.</div>
<a id="L495" name="L495"></a> 495         <strong class="reserved">if</strong> (privilegedContext != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L496" name="L496"></a> 496             privilegedContext.<a href="../S/1212.html#L487" title="Defined at 487 in src/java/security/AccessControlContext.java.">checkPermission2</a>(perm);
<a id="L497" name="L497"></a> 497         <em class="brace">}</em>
<a id="L498" name="L498"></a> 498 
<div class="comment">
          Ignore the limited permissions and parent fields of a wrapper
          context since they were already carried down into the unwrapped
          context.</div>
<a id="L504" name="L504"></a> 504         <strong class="reserved">if</strong> (isWrapped) <em class="brace">{</em>
<a id="L505" name="L505"></a> 505             <strong class="reserved">return</strong>;
<a id="L506" name="L506"></a> 506         <em class="brace">}</em>
<a id="L507" name="L507"></a> 507 
<div class="comment">
          Try to match any limited privilege scope.</div>
<a id="L511" name="L511"></a> 511         <strong class="reserved">if</strong> (<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L512" name="L512"></a> 512             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; permClass = perm.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>();
<a id="L513" name="L513"></a> 513             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i=0; i &lt; <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L514" name="L514"></a> 514                 <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> = <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>[i];
<a id="L515" name="L515"></a> 515                 <strong class="reserved">if</strong> (<a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>().<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(permClass) &amp;&amp; <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>.<a href="../D/24381.html" title="Multiple defined in 34 places.">implies</a>(perm)) <em class="brace">{</em>
<a id="L516" name="L516"></a> 516                     <strong class="reserved">return</strong>;
<a id="L517" name="L517"></a> 517                 <em class="brace">}</em>
<a id="L518" name="L518"></a> 518             <em class="brace">}</em>
<a id="L519" name="L519"></a> 519         <em class="brace">}</em>
<a id="L520" name="L520"></a> 520 
<div class="comment">
          Check the limited privilege scope up the call stack or the inherited
          parent thread call stack of this ACC.</div>
<a id="L525" name="L525"></a> 525         <strong class="reserved">if</strong> (<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<div class="comment">
              As an optimization, if the parent context is the inherited call
              stack context from a parent thread then checking the protection
              domains of the parent context is redundant since they have
              already been merged into the child thread's context by
              optimize(). When parent is set to an inherited context this
              context was not directly created by a limited scope
              doPrivileged() and it does not have its own limited permissions.</div>
<a id="L535" name="L535"></a> 535             <strong class="reserved">if</strong> (<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L536" name="L536"></a> 536                 <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.<a href="../S/1212.html#L487" title="Defined at 487 in src/java/security/AccessControlContext.java.">checkPermission2</a>(perm);
<a id="L537" name="L537"></a> 537             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L538" name="L538"></a> 538                 <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.<a href="../D/12594.html" title="Multiple defined in 22 places.">checkPermission</a>(perm);
<a id="L539" name="L539"></a> 539             <em class="brace">}</em>
<a id="L540" name="L540"></a> 540         <em class="brace">}</em>
<a id="L541" name="L541"></a> 541     <em class="brace">}</em>
<a id="L542" name="L542"></a> 542 
<div class="comment">
      Take the stack-based context (this) and combine it with the
      privileged or inherited context, if need be. Any limited
      privilege scope is flagged regardless of whether the assigned
      context comes from an immediately enclosing limited doPrivileged().
      The limited privilege scope can indirectly flow from the inherited
      parent thread or an assigned context previously captured by getContext().</div>
<a id="L551" name="L551"></a> 551     <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../R/24003.html" title="Multiple referred from 16 places.">optimize</a>() <em class="brace">{</em>
<a id="L552" name="L552"></a> 552         <em class="comment">// the assigned (privileged or inherited) context</em>
<a id="L553" name="L553"></a> 553         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> acc;
<a id="L554" name="L554"></a> 554         <a href="../S/1213.html#L81" title="Defined at 81 in src/java/security/DomainCombiner.java.">DomainCombiner</a> <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> = <strong class="reserved">null</strong>;
<a id="L555" name="L555"></a> 555         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> = <strong class="reserved">null</strong>;
<a id="L556" name="L556"></a> 556         <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a>[] <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> = <strong class="reserved">null</strong>;
<a id="L557" name="L557"></a> 557 
<a id="L558" name="L558"></a> 558         <strong class="reserved">if</strong> (<a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a>) <em class="brace">{</em>
<a id="L559" name="L559"></a> 559             acc = privilegedContext;
<a id="L560" name="L560"></a> 560             <strong class="reserved">if</strong> (acc != <strong class="reserved">null</strong>) <em class="brace">{</em>
<div class="comment">
                  If the context is from a limited scope doPrivileged() then
                  copy the permissions and parent fields out of the wrapper
                  context that was created to hold them.</div>
<a id="L566" name="L566"></a> 566                 <strong class="reserved">if</strong> (acc.isWrapped) <em class="brace">{</em>
<a id="L567" name="L567"></a> 567                     <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> = acc.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>;
<a id="L568" name="L568"></a> 568                     <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> = acc.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>;
<a id="L569" name="L569"></a> 569                 <em class="brace">}</em>
<a id="L570" name="L570"></a> 570             <em class="brace">}</em>
<a id="L571" name="L571"></a> 571         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L572" name="L572"></a> 572             acc = <a href="../S/1248.html#L264" title="Defined at 264 in src/java/security/AccessController.java.">AccessController</a>.<a href="../S/1248.html#L805" title="Defined at 805 in src/java/security/AccessController.java.">getInheritedAccessControlContext</a>();
<a id="L573" name="L573"></a> 573             <strong class="reserved">if</strong> (acc != <strong class="reserved">null</strong>) <em class="brace">{</em>
<div class="comment">
                  If the inherited context is constrained by a limited scope
                  doPrivileged() then set it as our parent so we will process
                  the non-domain-related state.</div>
<a id="L579" name="L579"></a> 579                 <strong class="reserved">if</strong> (acc.isLimited) <em class="brace">{</em>
<a id="L580" name="L580"></a> 580                     <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> = acc;
<a id="L581" name="L581"></a> 581                 <em class="brace">}</em>
<a id="L582" name="L582"></a> 582             <em class="brace">}</em>
<a id="L583" name="L583"></a> 583         <em class="brace">}</em>
<a id="L584" name="L584"></a> 584 
<a id="L585" name="L585"></a> 585         <em class="comment">// this.context could be null if only system code is on the stack;</em>
<a id="L586" name="L586"></a> 586         <em class="comment">// in that case, ignore the stack context</em>
<a id="L587" name="L587"></a> 587         <strong class="reserved">boolean</strong> skipStack = (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> == <strong class="reserved">null</strong>);
<a id="L588" name="L588"></a> 588 
<a id="L589" name="L589"></a> 589         <em class="comment">// acc.context could be null if only system code was involved;</em>
<a id="L590" name="L590"></a> 590         <em class="comment">// in that case, ignore the assigned context</em>
<a id="L591" name="L591"></a> 591         <strong class="reserved">boolean</strong> skipAssigned = (acc == <strong class="reserved">null</strong> || acc.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> == <strong class="reserved">null</strong>);
<a id="L592" name="L592"></a> 592         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] assigned = (skipAssigned) ? <strong class="reserved">null</strong> : acc.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>;
<a id="L593" name="L593"></a> 593         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] pd;
<a id="L594" name="L594"></a> 594 
<a id="L595" name="L595"></a> 595         <em class="comment">// if there is no enclosing limited privilege scope on the stack or</em>
<a id="L596" name="L596"></a> 596         <em class="comment">// inherited from a parent thread</em>
<a id="L597" name="L597"></a> 597         <strong class="reserved">boolean</strong> skipLimited = ((acc == <strong class="reserved">null</strong> || !acc.isWrapped) &amp;&amp; <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> == <strong class="reserved">null</strong>);
<a id="L598" name="L598"></a> 598 
<a id="L599" name="L599"></a> 599         <strong class="reserved">if</strong> (acc != <strong class="reserved">null</strong> &amp;&amp; acc.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L600" name="L600"></a> 600             <em class="comment">// let the assigned acc's combiner do its thing</em>
<a id="L601" name="L601"></a> 601             <strong class="reserved">if</strong> (<a href="../D/18231.html" title="Multiple defined in 4 places.">getDebug</a>() != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L602" name="L602"></a> 602                 <a href="../D/14486.html" title="Multiple defined in 5 places.">debug</a>.<a href="../D/29725.html" title="Multiple defined in 27 places.">println</a>("AccessControlContext invoking the Combiner");
<a id="L603" name="L603"></a> 603             <em class="brace">}</em>
<a id="L604" name="L604"></a> 604 
<a id="L605" name="L605"></a> 605             <em class="comment">// No need to clone current and assigned.context</em>
<a id="L606" name="L606"></a> 606             <em class="comment">// combine() will not update them</em>
<a id="L607" name="L607"></a> 607             <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> = acc.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>;
<a id="L608" name="L608"></a> 608             pd = <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>.<a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>, assigned);
<a id="L609" name="L609"></a> 609         <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L610" name="L610"></a> 610             <strong class="reserved">if</strong> (skipStack) <em class="brace">{</em>
<a id="L611" name="L611"></a> 611                 <strong class="reserved">if</strong> (skipAssigned) <em class="brace">{</em>
<a id="L612" name="L612"></a> 612                     <a href="../S/1212.html#L718" title="Defined at 718 in src/java/security/AccessControlContext.java.">calculateFields</a>(acc, <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>, <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>);
<a id="L613" name="L613"></a> 613                     <strong class="reserved">return</strong> <strong class="reserved">this</strong>;
<a id="L614" name="L614"></a> 614                 <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (skipLimited) <em class="brace">{</em>
<a id="L615" name="L615"></a> 615                     <strong class="reserved">return</strong> acc;
<a id="L616" name="L616"></a> 616                 <em class="brace">}</em>
<a id="L617" name="L617"></a> 617             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (assigned != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L618" name="L618"></a> 618                 <strong class="reserved">if</strong> (skipLimited) <em class="brace">{</em>
<a id="L619" name="L619"></a> 619                     <em class="comment">// optimization: if there is a single stack domain and</em>
<a id="L620" name="L620"></a> 620                     <em class="comment">// that domain is already in the assigned context; no</em>
<a id="L621" name="L621"></a> 621                     <em class="comment">// need to combine</em>
<a id="L622" name="L622"></a> 622                     <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a> == 1 &amp;&amp; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[0] == assigned[0]) <em class="brace">{</em>
<a id="L623" name="L623"></a> 623                         <strong class="reserved">return</strong> acc;
<a id="L624" name="L624"></a> 624                     <em class="brace">}</em>
<a id="L625" name="L625"></a> 625                 <em class="brace">}</em>
<a id="L626" name="L626"></a> 626             <em class="brace">}</em>
<a id="L627" name="L627"></a> 627 
<a id="L628" name="L628"></a> 628             pd = <a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>, assigned);
<a id="L629" name="L629"></a> 629             <strong class="reserved">if</strong> (skipLimited &amp;&amp; !skipAssigned &amp;&amp; pd == assigned) <em class="brace">{</em>
<a id="L630" name="L630"></a> 630                 <strong class="reserved">return</strong> acc;
<a id="L631" name="L631"></a> 631             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (skipAssigned &amp;&amp; pd == <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>) <em class="brace">{</em>
<a id="L632" name="L632"></a> 632                 <a href="../S/1212.html#L718" title="Defined at 718 in src/java/security/AccessControlContext.java.">calculateFields</a>(acc, <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>, <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>);
<a id="L633" name="L633"></a> 633                 <strong class="reserved">return</strong> <strong class="reserved">this</strong>;
<a id="L634" name="L634"></a> 634             <em class="brace">}</em>
<a id="L635" name="L635"></a> 635         <em class="brace">}</em>
<a id="L636" name="L636"></a> 636 
<a id="L637" name="L637"></a> 637         <em class="comment">// Reuse existing ACC</em>
<a id="L638" name="L638"></a> 638         <strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> = pd;
<a id="L639" name="L639"></a> 639         <strong class="reserved">this</strong>.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> = <a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>;
<a id="L640" name="L640"></a> 640         <strong class="reserved">this</strong>.<a href="../S/1212.html#L316" title="Defined at 316 in src/java/security/AccessControlContext.java.">isPrivileged</a> = <strong class="reserved">false</strong>;
<a id="L641" name="L641"></a> 641 
<a id="L642" name="L642"></a> 642         <a href="../S/1212.html#L718" title="Defined at 718 in src/java/security/AccessControlContext.java.">calculateFields</a>(acc, <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>, <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>);
<a id="L643" name="L643"></a> 643         <strong class="reserved">return</strong> <strong class="reserved">this</strong>;
<a id="L644" name="L644"></a> 644     <em class="brace">}</em>
<a id="L645" name="L645"></a> 645 
<a id="L646" name="L646"></a> 646 
<div class="comment">
      Combine the current (stack) and assigned domains.</div>
<a id="L650" name="L650"></a> 650     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] <a href="../R/11666.html" title="Multiple referred from 16 places.">combine</a>(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[]<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>,
<a id="L651" name="L651"></a> 651         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] assigned) <em class="brace">{</em>
<a id="L652" name="L652"></a> 652 
<a id="L653" name="L653"></a> 653         <em class="comment">// current could be null if only system code is on the stack;</em>
<a id="L654" name="L654"></a> 654         <em class="comment">// in that case, ignore the stack context</em>
<a id="L655" name="L655"></a> 655         <strong class="reserved">boolean</strong> skipStack = (<a href="../D/14417.html" title="Multiple defined in 10 places.">current</a> == <strong class="reserved">null</strong>);
<a id="L656" name="L656"></a> 656 
<a id="L657" name="L657"></a> 657         <em class="comment">// assigned could be null if only system code was involved;</em>
<a id="L658" name="L658"></a> 658         <em class="comment">// in that case, ignore the assigned context</em>
<a id="L659" name="L659"></a> 659         <strong class="reserved">boolean</strong> skipAssigned = (assigned == <strong class="reserved">null</strong>);
<a id="L660" name="L660"></a> 660 
<a id="L661" name="L661"></a> 661         <strong class="reserved">int</strong> slen = (skipStack) ? 0 : <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L662" name="L662"></a> 662 
<a id="L663" name="L663"></a> 663         <em class="comment">// optimization: if there is no assigned context and the stack length</em>
<a id="L664" name="L664"></a> 664         <em class="comment">// is less then or equal to two; there is no reason to compress the</em>
<a id="L665" name="L665"></a> 665         <em class="comment">// stack context, it already is</em>
<a id="L666" name="L666"></a> 666         <strong class="reserved">if</strong> (skipAssigned &amp;&amp; slen &lt;= 2) <em class="brace">{</em>
<a id="L667" name="L667"></a> 667             <strong class="reserved">return</strong> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;
<a id="L668" name="L668"></a> 668         <em class="brace">}</em>
<a id="L669" name="L669"></a> 669 
<a id="L670" name="L670"></a> 670         <strong class="reserved">int</strong> n = (skipAssigned) ? 0 : assigned.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>;
<a id="L671" name="L671"></a> 671 
<a id="L672" name="L672"></a> 672         <em class="comment">// now we combine both of them, and create a new context</em>
<a id="L673" name="L673"></a> 673         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> pd[] = <strong class="reserved">new</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[slen + n];
<a id="L674" name="L674"></a> 674 
<a id="L675" name="L675"></a> 675         <em class="comment">// first copy in the assigned context domains, no need to compress</em>
<a id="L676" name="L676"></a> 676         <strong class="reserved">if</strong> (!skipAssigned) <em class="brace">{</em>
<a id="L677" name="L677"></a> 677             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(assigned, 0, pd, 0, n);
<a id="L678" name="L678"></a> 678         <em class="brace">}</em>
<a id="L679" name="L679"></a> 679 
<a id="L680" name="L680"></a> 680         <em class="comment">// now add the stack context domains, discarding nulls and duplicates</em>
<a id="L681" name="L681"></a> 681     outer:
<a id="L682" name="L682"></a> 682         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; slen; i++) <em class="brace">{</em>
<a id="L683" name="L683"></a> 683             <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> sd = <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>[i];
<a id="L684" name="L684"></a> 684             <strong class="reserved">if</strong> (sd != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L685" name="L685"></a> 685                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; j &lt; n; j++) <em class="brace">{</em>
<a id="L686" name="L686"></a> 686                     <strong class="reserved">if</strong> (sd == pd[j]) <em class="brace">{</em>
<a id="L687" name="L687"></a> 687                         <strong class="reserved">continue</strong> outer;
<a id="L688" name="L688"></a> 688                     <em class="brace">}</em>
<a id="L689" name="L689"></a> 689                 <em class="brace">}</em>
<a id="L690" name="L690"></a> 690                 pd[n++] = sd;
<a id="L691" name="L691"></a> 691             <em class="brace">}</em>
<a id="L692" name="L692"></a> 692         <em class="brace">}</em>
<a id="L693" name="L693"></a> 693 
<a id="L694" name="L694"></a> 694         <em class="comment">// if length isn't equal, we need to shorten the array</em>
<a id="L695" name="L695"></a> 695         <strong class="reserved">if</strong> (n != pd.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L696" name="L696"></a> 696             <em class="comment">// optimization: if we didn't really combine anything</em>
<a id="L697" name="L697"></a> 697             <strong class="reserved">if</strong> (!skipAssigned &amp;&amp; n == assigned.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) <em class="brace">{</em>
<a id="L698" name="L698"></a> 698                 <strong class="reserved">return</strong> assigned;
<a id="L699" name="L699"></a> 699             <em class="brace">}</em> <strong class="reserved">else</strong> <strong class="reserved">if</strong> (skipAssigned &amp;&amp; n == slen) <em class="brace">{</em>
<a id="L700" name="L700"></a> 700                 <strong class="reserved">return</strong> <a href="../D/14417.html" title="Multiple defined in 10 places.">current</a>;
<a id="L701" name="L701"></a> 701             <em class="brace">}</em>
<a id="L702" name="L702"></a> 702             <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> tmp[] = <strong class="reserved">new</strong> <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[n];
<a id="L703" name="L703"></a> 703             <a href="../S/1557.html#L59" title="Defined at 59 in src/java/lang/System.java.">System</a>.<a href="../S/1557.html#L493" title="Defined at 493 in src/java/lang/System.java.">arraycopy</a>(pd, 0, tmp, 0, n);
<a id="L704" name="L704"></a> 704             pd = tmp;
<a id="L705" name="L705"></a> 705         <em class="brace">}</em>
<a id="L706" name="L706"></a> 706 
<a id="L707" name="L707"></a> 707         <strong class="reserved">return</strong> pd;
<a id="L708" name="L708"></a> 708     <em class="brace">}</em>
<a id="L709" name="L709"></a> 709 
<a id="L710" name="L710"></a> 710 
<div class="comment">
      Calculate the additional domains that could potentially be reached via
      limited privilege scope. Mark the context as being subject to limited
      privilege scope unless the reachable domains (if any) are already
      contained in this domain context (in which case any limited
      privilege scope checking would be redundant).</div>
<a id="L718" name="L718"></a> 718     <strong class="reserved">private</strong> <strong class="reserved">void</strong> <a href="../R/10802.html" title="Multiple referred from 3 places.">calculateFields</a>(<a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> assigned,
<a id="L719" name="L719"></a> 719         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>, <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a>[] <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>)
<a id="L720" name="L720"></a> 720     <em class="brace">{</em>
<a id="L721" name="L721"></a> 721         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] parentLimit = <strong class="reserved">null</strong>;
<a id="L722" name="L722"></a> 722         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] assignedLimit = <strong class="reserved">null</strong>;
<a id="L723" name="L723"></a> 723         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] newLimit;
<a id="L724" name="L724"></a> 724 
<a id="L725" name="L725"></a> 725         parentLimit = (<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> != <strong class="reserved">null</strong>)? <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.limitedContext: <strong class="reserved">null</strong>;
<a id="L726" name="L726"></a> 726         assignedLimit = (assigned != <strong class="reserved">null</strong>)? assigned.limitedContext: <strong class="reserved">null</strong>;
<a id="L727" name="L727"></a> 727         newLimit = <a href="../D/13006.html" title="Multiple defined in 21 places.">combine</a>(parentLimit, assignedLimit);
<a id="L728" name="L728"></a> 728         <strong class="reserved">if</strong> (newLimit != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L729" name="L729"></a> 729             <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> == <strong class="reserved">null</strong> || !<a href="../S/1212.html#L879" title="Defined at 879 in src/java/security/AccessControlContext.java.">containsAllPDs</a>(newLimit, <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>)) <em class="brace">{</em>
<a id="L730" name="L730"></a> 730                 <strong class="reserved">this</strong>.limitedContext = newLimit;
<a id="L731" name="L731"></a> 731                 <strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> = <a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>;
<a id="L732" name="L732"></a> 732                 <strong class="reserved">this</strong>.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>;
<a id="L733" name="L733"></a> 733                 <strong class="reserved">this</strong>.isLimited = <strong class="reserved">true</strong>;
<a id="L734" name="L734"></a> 734             <em class="brace">}</em>
<a id="L735" name="L735"></a> 735         <em class="brace">}</em>
<a id="L736" name="L736"></a> 736     <em class="brace">}</em>
<a id="L737" name="L737"></a> 737 
<a id="L738" name="L738"></a> 738 
<div class="comment">
      Checks two AccessControlContext objects for equality.
      Checks that <i>obj</i> is
      an AccessControlContext and has the same set of ProtectionDomains
      as this context.
      <p>
      @param obj the object we are testing for equality with this object.
      @return true if <i>obj</i> is an AccessControlContext, and has the
      same set of ProtectionDomains as this context, false otherwise.</p></div>
<a id="L749" name="L749"></a> 749     <strong class="reserved">public</strong> <strong class="reserved">boolean</strong> <a href="../R/13992.html" title="Multiple referred from 5400 places.">equals</a>(<a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a> obj) <em class="brace">{</em>
<a id="L750" name="L750"></a> 750         <strong class="reserved">if</strong> (obj == <strong class="reserved">this</strong>)
<a id="L751" name="L751"></a> 751             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L752" name="L752"></a> 752 
<a id="L753" name="L753"></a> 753         <strong class="reserved">if</strong> (! (obj <strong class="reserved">instanceof</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a>))
<a id="L754" name="L754"></a> 754             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L755" name="L755"></a> 755 
<a id="L756" name="L756"></a> 756         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> that = (<a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a>) obj;
<a id="L757" name="L757"></a> 757 
<a id="L758" name="L758"></a> 758         <strong class="reserved">if</strong> (!<a href="../S/1212.html#L771" title="Defined at 771 in src/java/security/AccessControlContext.java.">equalContext</a>(that))
<a id="L759" name="L759"></a> 759             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L760" name="L760"></a> 760 
<a id="L761" name="L761"></a> 761         <strong class="reserved">if</strong> (!<a href="../S/1212.html#L803" title="Defined at 803 in src/java/security/AccessControlContext.java.">equalLimitedContext</a>(that))
<a id="L762" name="L762"></a> 762             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L763" name="L763"></a> 763 
<a id="L764" name="L764"></a> 764         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L765" name="L765"></a> 765     <em class="brace">}</em>
<a id="L766" name="L766"></a> 766 
<div class="comment">
      Compare for equality based on state that is free of limited
      privilege complications.</div>
<a id="L771" name="L771"></a> 771     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/1212.html#L758" title="Referred from 758 in src/java/security/AccessControlContext.java.">equalContext</a>(<a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> that) <em class="brace">{</em>
<a id="L772" name="L772"></a> 772         <strong class="reserved">if</strong> (!<a href="../S/1212.html#L784" title="Defined at 784 in src/java/security/AccessControlContext.java.">equalPDs</a>(<strong class="reserved">this</strong>.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>, that.<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>))
<a id="L773" name="L773"></a> 773             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L774" name="L774"></a> 774 
<a id="L775" name="L775"></a> 775         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> == <strong class="reserved">null</strong> &amp;&amp; that.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> != <strong class="reserved">null</strong>)
<a id="L776" name="L776"></a> 776             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L777" name="L777"></a> 777 
<a id="L778" name="L778"></a> 778         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a> != <strong class="reserved">null</strong> &amp;&amp; !<strong class="reserved">this</strong>.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(that.<a href="../D/13009.html" title="Multiple defined in 2 places.">combiner</a>))
<a id="L779" name="L779"></a> 779             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L780" name="L780"></a> 780 
<a id="L781" name="L781"></a> 781         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L782" name="L782"></a> 782     <em class="brace">}</em>
<a id="L783" name="L783"></a> 783 
<a id="L784" name="L784"></a> 784     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/1212.html#L772" title="Referred from 772 in src/java/security/AccessControlContext.java.">equalPDs</a>(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] b) <em class="brace">{</em>
<a id="L785" name="L785"></a> 785         <strong class="reserved">if</strong> (<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a> == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L786" name="L786"></a> 786             <strong class="reserved">return</strong> (b == <strong class="reserved">null</strong>);
<a id="L787" name="L787"></a> 787         <em class="brace">}</em>
<a id="L788" name="L788"></a> 788 
<a id="L789" name="L789"></a> 789         <strong class="reserved">if</strong> (b == <strong class="reserved">null</strong>)
<a id="L790" name="L790"></a> 790             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L791" name="L791"></a> 791 
<a id="L792" name="L792"></a> 792         <strong class="reserved">if</strong> (!(<a href="../S/1212.html#L879" title="Defined at 879 in src/java/security/AccessControlContext.java.">containsAllPDs</a>(<a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>, b) &amp;&amp; <a href="../S/1212.html#L879" title="Defined at 879 in src/java/security/AccessControlContext.java.">containsAllPDs</a>(b, <a href="../D/10513.html" title="Multiple defined in 3 places.">a</a>)))
<a id="L793" name="L793"></a> 793             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L794" name="L794"></a> 794 
<a id="L795" name="L795"></a> 795         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L796" name="L796"></a> 796     <em class="brace">}</em>
<a id="L797" name="L797"></a> 797 
<div class="comment">
      Compare for equality based on state that is captured during a
      call to AccessController.getContext() when a limited privilege
      scope is in effect.</div>
<a id="L803" name="L803"></a> 803     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../R/13988.html" title="Multiple referred from 2 places.">equalLimitedContext</a>(<a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> that) <em class="brace">{</em>
<a id="L804" name="L804"></a> 804         <strong class="reserved">if</strong> (that == <strong class="reserved">null</strong>)
<a id="L805" name="L805"></a> 805             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L806" name="L806"></a> 806 
<div class="comment">
          If neither instance has limited privilege scope then we're done.</div>
<a id="L810" name="L810"></a> 810         <strong class="reserved">if</strong> (!<strong class="reserved">this</strong>.isLimited &amp;&amp; !that.isLimited)
<a id="L811" name="L811"></a> 811             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L812" name="L812"></a> 812 
<div class="comment">
          If only one instance has limited privilege scope then we're done.</div>
<a id="L816" name="L816"></a> 816          <strong class="reserved">if</strong> (!(<strong class="reserved">this</strong>.isLimited &amp;&amp; that.isLimited))
<a id="L817" name="L817"></a> 817              <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L818" name="L818"></a> 818 
<div class="comment">
          Wrapped instances should never escape outside the implementation
          this class and AccessController so this will probably never happen
          but it only makes any sense to compare if they both have the same
          isWrapped state.</div>
<a id="L825" name="L825"></a> 825         <strong class="reserved">if</strong> ((<strong class="reserved">this</strong>.isWrapped &amp;&amp; !that.isWrapped) ||
<a id="L826" name="L826"></a> 826             (!<strong class="reserved">this</strong>.isWrapped &amp;&amp; that.isWrapped)) <em class="brace">{</em>
<a id="L827" name="L827"></a> 827             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L828" name="L828"></a> 828         <em class="brace">}</em>
<a id="L829" name="L829"></a> 829 
<a id="L830" name="L830"></a> 830         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> == <strong class="reserved">null</strong> &amp;&amp; that.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> != <strong class="reserved">null</strong>)
<a id="L831" name="L831"></a> 831             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L832" name="L832"></a> 832 
<a id="L833" name="L833"></a> 833         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> != <strong class="reserved">null</strong> &amp;&amp; that.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> == <strong class="reserved">null</strong>)
<a id="L834" name="L834"></a> 834             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L835" name="L835"></a> 835 
<a id="L836" name="L836"></a> 836         <strong class="reserved">if</strong> (!(<strong class="reserved">this</strong>.<a href="../S/1212.html#L912" title="Defined at 912 in src/java/security/AccessControlContext.java.">containsAllLimits</a>(that) &amp;&amp; that.<a href="../S/1212.html#L912" title="Defined at 912 in src/java/security/AccessControlContext.java.">containsAllLimits</a>(<strong class="reserved">this</strong>)))
<a id="L837" name="L837"></a> 837             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L838" name="L838"></a> 838 
<div class="comment">
          Skip through any wrapped contexts.</div>
<a id="L842" name="L842"></a> 842         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> thisNextPC = <a href="../S/1212.html#L870" title="Defined at 870 in src/java/security/AccessControlContext.java.">getNextPC</a>(<strong class="reserved">this</strong>);
<a id="L843" name="L843"></a> 843         <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> thatNextPC = <a href="../S/1212.html#L870" title="Defined at 870 in src/java/security/AccessControlContext.java.">getNextPC</a>(that);
<a id="L844" name="L844"></a> 844 
<div class="comment">
          The protection domains and combiner of a privilegedContext are
          not relevant because they have already been included in the context
          of this instance by optimize() so we only care about any limited
          privilege state they may have.</div>
<a id="L851" name="L851"></a> 851         <strong class="reserved">if</strong> (thisNextPC == <strong class="reserved">null</strong> &amp;&amp; thatNextPC != <strong class="reserved">null</strong> &amp;&amp; thatNextPC.isLimited)
<a id="L852" name="L852"></a> 852             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L853" name="L853"></a> 853 
<a id="L854" name="L854"></a> 854         <strong class="reserved">if</strong> (thisNextPC != <strong class="reserved">null</strong> &amp;&amp; !thisNextPC.<a href="../S/1212.html#L803" title="Defined at 803 in src/java/security/AccessControlContext.java.">equalLimitedContext</a>(thatNextPC))
<a id="L855" name="L855"></a> 855             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L856" name="L856"></a> 856 
<a id="L857" name="L857"></a> 857         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> == <strong class="reserved">null</strong> &amp;&amp; that.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> != <strong class="reserved">null</strong>)
<a id="L858" name="L858"></a> 858             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L859" name="L859"></a> 859 
<a id="L860" name="L860"></a> 860         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a> != <strong class="reserved">null</strong> &amp;&amp; !<strong class="reserved">this</strong>.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(that.<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>))
<a id="L861" name="L861"></a> 861             <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L862" name="L862"></a> 862 
<a id="L863" name="L863"></a> 863         <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L864" name="L864"></a> 864     <em class="brace">}</em>
<a id="L865" name="L865"></a> 865 
<div class="comment">
      Follow the privilegedContext link making our best effort to skip
      through any wrapper contexts.</div>
<a id="L870" name="L870"></a> 870     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> <a href="../R/17941.html" title="Multiple referred from 2 places.">getNextPC</a>(<a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> acc) <em class="brace">{</em>
<a id="L871" name="L871"></a> 871         <strong class="reserved">while</strong> (acc != <strong class="reserved">null</strong> &amp;&amp; acc.privilegedContext != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L872" name="L872"></a> 872             acc = acc.privilegedContext;
<a id="L873" name="L873"></a> 873             <strong class="reserved">if</strong> (!acc.isWrapped)
<a id="L874" name="L874"></a> 874                 <strong class="reserved">return</strong> acc;
<a id="L875" name="L875"></a> 875         <em class="brace">}</em>
<a id="L876" name="L876"></a> 876         <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L877" name="L877"></a> 877     <em class="brace">}</em>
<a id="L878" name="L878"></a> 878 
<a id="L879" name="L879"></a> 879     <strong class="reserved">private</strong> <strong class="reserved">static</strong> <strong class="reserved">boolean</strong> <a href="../R/11952.html" title="Multiple referred from 2 places.">containsAllPDs</a>(<a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] thisContext,
<a id="L880" name="L880"></a> 880         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a>[] thatContext) <em class="brace">{</em>
<a id="L881" name="L881"></a> 881         <strong class="reserved">boolean</strong> <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = <strong class="reserved">false</strong>;
<a id="L882" name="L882"></a> 882 
<a id="L883" name="L883"></a> 883         <em class="comment">//</em>
<a id="L884" name="L884"></a> 884         <em class="comment">// ProtectionDomains within an ACC currently cannot be null</em>
<a id="L885" name="L885"></a> 885         <em class="comment">// and this is enforced by the constructor and the various</em>
<a id="L886" name="L886"></a> 886         <em class="comment">// optimize methods. However, historically this logic made attempts</em>
<a id="L887" name="L887"></a> 887         <em class="comment">// to support the notion of a null PD and therefore this logic continues</em>
<a id="L888" name="L888"></a> 888         <em class="comment">// to support that notion.</em>
<a id="L889" name="L889"></a> 889         <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> thisPd;
<a id="L890" name="L890"></a> 890         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; thisContext.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L891" name="L891"></a> 891             <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = <strong class="reserved">false</strong>;
<a id="L892" name="L892"></a> 892             <strong class="reserved">if</strong> ((thisPd = thisContext[i]) == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L893" name="L893"></a> 893                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; (j &lt; thatContext.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) &amp;&amp; !<a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>; j++) <em class="brace">{</em>
<a id="L894" name="L894"></a> 894                     <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = (thatContext[j] == <strong class="reserved">null</strong>);
<a id="L895" name="L895"></a> 895                 <em class="brace">}</em>
<a id="L896" name="L896"></a> 896             <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L897" name="L897"></a> 897                 <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a>&lt;?&gt; thisPdClass = thisPd.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>();
<a id="L898" name="L898"></a> 898                 <a href="../S/1249.html#L61" title="Defined at 61 in src/java/security/ProtectionDomain.java.">ProtectionDomain</a> thatPd;
<a id="L899" name="L899"></a> 899                 <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; (j &lt; thatContext.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) &amp;&amp; !<a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>; j++) <em class="brace">{</em>
<a id="L900" name="L900"></a> 900                     thatPd = thatContext[j];
<a id="L901" name="L901"></a> 901 
<a id="L902" name="L902"></a> 902                     <em class="comment">// Class check required to avoid PD exposure (4285406)</em>
<a id="L903" name="L903"></a> 903                     <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = (thatPd != <strong class="reserved">null</strong> &amp;&amp;
<a id="L904" name="L904"></a> 904                         thisPdClass == thatPd.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>() &amp;&amp; thisPd.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(thatPd));
<a id="L905" name="L905"></a> 905                 <em class="brace">}</em>
<a id="L906" name="L906"></a> 906             <em class="brace">}</em>
<a id="L907" name="L907"></a> 907             <strong class="reserved">if</strong> (!<a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>) <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L908" name="L908"></a> 908         <em class="brace">}</em>
<a id="L909" name="L909"></a> 909         <strong class="reserved">return</strong> <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>;
<a id="L910" name="L910"></a> 910     <em class="brace">}</em>
<a id="L911" name="L911"></a> 911 
<a id="L912" name="L912"></a> 912     <strong class="reserved">private</strong> <strong class="reserved">boolean</strong> <a href="../S/1212.html#L836" title="Referred from 836 in src/java/security/AccessControlContext.java.">containsAllLimits</a>(<a href="../S/1212.html#L77" title="Defined at 77 in src/java/security/AccessControlContext.java.">AccessControlContext</a> that) <em class="brace">{</em>
<a id="L913" name="L913"></a> 913         <strong class="reserved">boolean</strong> <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = <strong class="reserved">false</strong>;
<a id="L914" name="L914"></a> 914         <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> thisPerm;
<a id="L915" name="L915"></a> 915 
<a id="L916" name="L916"></a> 916         <strong class="reserved">if</strong> (<strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> == <strong class="reserved">null</strong> &amp;&amp; that.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a> == <strong class="reserved">null</strong>)
<a id="L917" name="L917"></a> 917             <strong class="reserved">return</strong> <strong class="reserved">true</strong>;
<a id="L918" name="L918"></a> 918 
<a id="L919" name="L919"></a> 919         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i = 0; i &lt; <strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L920" name="L920"></a> 920             <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a> = <strong class="reserved">this</strong>.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>[i];
<a id="L921" name="L921"></a> 921             <a href="../S/1722.html#L119" title="Defined at 119 in src/java/lang/Class.java.">Class</a> &lt;?&gt; limitClass = <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>();
<a id="L922" name="L922"></a> 922             <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = <strong class="reserved">false</strong>;
<a id="L923" name="L923"></a> 923             <strong class="reserved">for</strong> (<strong class="reserved">int</strong> j = 0; (j &lt; that.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>) &amp;&amp; !<a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>; j++) <em class="brace">{</em>
<a id="L924" name="L924"></a> 924                 <a href="../D/6689.html" title="Multiple defined in 2 places.">Permission</a> perm = that.<a href="../D/29330.html" title="Multiple defined in 4 places.">permissions</a>[j];
<a id="L925" name="L925"></a> 925                 <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a> = (limitClass.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(perm.<a href="../D/17675.html" title="Multiple defined in 6 places.">getClass</a>()) &amp;&amp;
<a id="L926" name="L926"></a> 926                     <a href="../D/26840.html" title="Multiple defined in 12 places.">limit</a>.<a href="../D/15685.html" title="Multiple defined in 654 places.">equals</a>(perm));
<a id="L927" name="L927"></a> 927             <em class="brace">}</em>
<a id="L928" name="L928"></a> 928             <strong class="reserved">if</strong> (!<a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>) <strong class="reserved">return</strong> <strong class="reserved">false</strong>;
<a id="L929" name="L929"></a> 929         <em class="brace">}</em>
<a id="L930" name="L930"></a> 930         <strong class="reserved">return</strong> <a href="../D/27519.html" title="Multiple defined in 69 places.">match</a>;
<a id="L931" name="L931"></a> 931     <em class="brace">}</em>
<a id="L932" name="L932"></a> 932 
<a id="L933" name="L933"></a> 933 
<div class="comment">
      Returns the hash code value for this context. The hash code
      is computed by exclusive or-ing the hash code of all the protection
      domains in the context together.
      @return a hash code value for this context.</div>
<a id="L941" name="L941"></a> 941 
<a id="L942" name="L942"></a> 942     <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/20298.html" title="Multiple referred from 715 places.">hashCode</a>() <em class="brace">{</em>
<a id="L943" name="L943"></a> 943         <strong class="reserved">int</strong> <a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a> = 0;
<a id="L944" name="L944"></a> 944 
<a id="L945" name="L945"></a> 945         <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a> == <strong class="reserved">null</strong>)
<a id="L946" name="L946"></a> 946             <strong class="reserved">return</strong> <a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>;
<a id="L947" name="L947"></a> 947 
<a id="L948" name="L948"></a> 948         <strong class="reserved">for</strong> (<strong class="reserved">int</strong> i =0; i &lt; <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>.<a href="../D/26813.html" title="Multiple defined in 43 places.">length</a>; i++) <em class="brace">{</em>
<a id="L949" name="L949"></a> 949             <strong class="reserved">if</strong> (<a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i] != <strong class="reserved">null</strong>)
<a id="L950" name="L950"></a> 950                 <a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a> ^= <a href="../S/1916.html#L117" title="Defined at 117 in src/java/nio/file/WatchEvent.java.">context</a>[i].<a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>();
<a id="L951" name="L951"></a> 951         <em class="brace">}</em>
<a id="L952" name="L952"></a> 952 
<a id="L953" name="L953"></a> 953         <strong class="reserved">return</strong> <a href="../D/24220.html" title="Multiple defined in 552 places.">hashCode</a>;
<a id="L954" name="L954"></a> 954     <em class="brace">}</em>
<a id="L955" name="L955"></a> 955 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L103">[^]</a><a href="#L942">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>