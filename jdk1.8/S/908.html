<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>src/java/util/stream/ForEachOps.java</title>
<meta name="robots" content="noindex,nofollow">
<meta name="generator" content="GLOBAL-6.6.3">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<a id="TOP" name="TOP"></a><div class="comment">
/* [&lt;][&gt;]<a href="#L70">[^]</a><a href="#L487">[v]</a>[top]<a href="#BOTTOM">[bottom]</a><a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
<hr>
<h2 class="header">DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href="#L70" title="Defined at 70.">makeRef</a></li>
<li><a href="#L85" title="Defined at 85.">makeInt</a></li>
<li><a href="#L100" title="Defined at 100.">makeLong</a></li>
<li><a href="#L115" title="Defined at 115.">makeDouble</a></li>
<li><a href="#L144" title="Defined at 144.">getOpFlags</a></li>
<li><a href="#L149" title="Defined at 149.">evaluateSequential</a></li>
<li><a href="#L155" title="Defined at 155.">evaluateParallel</a></li>
<li><a href="#L167" title="Defined at 167.">get</a></li>
<li><a href="#L183" title="Defined at 183.">accept</a></li>
<li><a href="#L199" title="Defined at 199.">inputShape</a></li>
<li><a href="#L204" title="Defined at 204.">accept</a></li>
<li><a href="#L220" title="Defined at 220.">inputShape</a></li>
<li><a href="#L225" title="Defined at 225.">accept</a></li>
<li><a href="#L241" title="Defined at 241.">inputShape</a></li>
<li><a href="#L246" title="Defined at 246.">accept</a></li>
<li><a href="#L253" title="Defined at 253.">SuppressWarnings</a></li>
<li><a href="#L279" title="Defined at 279.">compute</a></li>
<li><a href="#L319" title="Defined at 319.">SuppressWarnings</a></li>
<li><a href="#L399" title="Defined at 399.">compute</a></li>
<li><a href="#L403" title="Defined at 403.">doCompute</a></li>
<li><a href="#L487" title="Defined at 487.">onCompletion</a></li>
</ol>
<hr>
<pre>
<div class="comment">
  Copyright (c) 2012, 2013, Oracle and/or its affiliates. All rights reserved.
  ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</div>
<a id="L25" name="L25"></a>  25 <strong class="reserved">package</strong> <a href="../S/3625.html#L43" title="Defined at 43 in src/javax/management/remote/rmi/RMIConnectionImpl_Stub.java.">java</a>.util.<a href="../D/34926.html" title="Multiple defined in 21 places.">stream</a>;
<a id="L26" name="L26"></a>  26 
<a id="L27" name="L27"></a>  27 <strong class="reserved">import</strong> java.util.Objects;
<a id="L28" name="L28"></a>  28 <strong class="reserved">import</strong> java.util.Spliterator;
<a id="L29" name="L29"></a>  29 <strong class="reserved">import</strong> java.util.concurrent.ConcurrentHashMap;
<a id="L30" name="L30"></a>  30 <strong class="reserved">import</strong> java.util.concurrent.CountedCompleter;
<a id="L31" name="L31"></a>  31 <strong class="reserved">import</strong> java.util.concurrent.ForkJoinTask;
<a id="L32" name="L32"></a>  32 <strong class="reserved">import</strong> java.util.function.Consumer;
<a id="L33" name="L33"></a>  33 <strong class="reserved">import</strong> java.util.function.DoubleConsumer;
<a id="L34" name="L34"></a>  34 <strong class="reserved">import</strong> java.util.function.IntConsumer;
<a id="L35" name="L35"></a>  35 <strong class="reserved">import</strong> java.util.function.IntFunction;
<a id="L36" name="L36"></a>  36 <strong class="reserved">import</strong> java.util.function.LongConsumer;
<a id="L37" name="L37"></a>  37 
<div class="comment">
  Factory for creating instances of <code>TerminalOp</code> that perform an
  action for every element of a stream.  Supported variants include unordered
  traversal (elements are provided to the <code>Consumer</code> as soon as they are
  available), and ordered traversal (elements are provided to the
  <code>Consumer</code> in encounter order.)
  <p>Elements are provided to the <code>Consumer</code> on whatever thread and
  whatever order they become available.  For ordered traversals, it is
  guaranteed that processing an element <em>happens-before</em> processing
  subsequent elements in the encounter order.
  </p><p>Exceptions occurring as a result of sending an element to the
  <code>Consumer</code> will be relayed to the caller and traversal will be
  prematurely terminated.
  @since 1.8</p></div>
<a id="L56" name="L56"></a>  56 <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/3075.html" title="Multiple referred from 9 places.">ForEachOps</a> <em class="brace">{</em>
<a id="L57" name="L57"></a>  57 
<a id="L58" name="L58"></a>  58     <strong class="reserved">private</strong> ForEachOps() <em class="brace">{</em> <em class="brace">}</em>
<a id="L59" name="L59"></a>  59 
<div class="comment">
      Constructs a <code>TerminalOp</code> that perform an action for every element
      of a stream.
      @param action the <code>Consumer</code> that receives all elements of a
             stream
      @param ordered whether an ordered traversal is requested
      @param <t> the type of the stream elements
      @return the <code>TerminalOp</code> instance</t></div>
<a id="L70" name="L70"></a>  70     <strong class="reserved">public</strong> <strong class="reserved">static</strong> &lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../S/886.html#L45" title="Defined at 45 in src/java/util/stream/TerminalOp.java.">TerminalOp</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>, <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <a href="../R/22984.html" title="Multiple referred from 19 places.">makeRef</a>(<a href="../S/963.html#L42" title="Defined at 42 in src/java/util/function/Consumer.java.">Consumer</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>,
<a id="L71" name="L71"></a>  71                                                   <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L72" name="L72"></a>  72         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>);
<a id="L73" name="L73"></a>  73         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>.<a href="../D/6358.html" title="Multiple defined in 14 places.">OfRef</a>&lt;&gt;(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>, ordered);
<a id="L74" name="L74"></a>  74     <em class="brace">}</em>
<a id="L75" name="L75"></a>  75 
<div class="comment">
      Constructs a <code>TerminalOp</code> that perform an action for every element
      of an <code>IntStream</code>.
      @param action the <code>IntConsumer</code> that receives all elements of a
             stream
      @param ordered whether an ordered traversal is requested
      @return the <code>TerminalOp</code> instance</div>
<a id="L85" name="L85"></a>  85     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/886.html#L45" title="Defined at 45 in src/java/util/stream/TerminalOp.java.">TerminalOp</a>&lt;<a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>, <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <a href="../R/22922.html" title="Multiple referred from 17 places.">makeInt</a>(<a href="../S/962.html#L42" title="Defined at 42 in src/java/util/function/IntConsumer.java.">IntConsumer</a> <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>,
<a id="L86" name="L86"></a>  86                                                     <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L87" name="L87"></a>  87         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>);
<a id="L88" name="L88"></a>  88         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>.<a href="../D/6355.html" title="Multiple defined in 22 places.">OfInt</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>, ordered);
<a id="L89" name="L89"></a>  89     <em class="brace">}</em>
<a id="L90" name="L90"></a>  90 
<div class="comment">
      Constructs a <code>TerminalOp</code> that perform an action for every element
      of a <code>LongStream</code>.
      @param action the <code>LongConsumer</code> that receives all elements of a
             stream
      @param ordered whether an ordered traversal is requested
      @return the <code>TerminalOp</code> instance</div>
<a id="L100" name="L100"></a> 100     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/886.html#L45" title="Defined at 45 in src/java/util/stream/TerminalOp.java.">TerminalOp</a>&lt;<a href="../S/1720.html#L54" title="Defined at 54 in src/java/lang/Long.java.">Long</a>, <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <a href="../R/22936.html" title="Multiple referred from 17 places.">makeLong</a>(<a href="../S/947.html#L42" title="Defined at 42 in src/java/util/function/LongConsumer.java.">LongConsumer</a> <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>,
<a id="L101" name="L101"></a> 101                                                   <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L102" name="L102"></a> 102         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>);
<a id="L103" name="L103"></a> 103         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>.<a href="../D/6356.html" title="Multiple defined in 22 places.">OfLong</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>, ordered);
<a id="L104" name="L104"></a> 104     <em class="brace">}</em>
<a id="L105" name="L105"></a> 105 
<div class="comment">
      Constructs a <code>TerminalOp</code> that perform an action for every element
      of a <code>DoubleStream</code>.
      @param action the <code>DoubleConsumer</code> that receives all elements of
             a stream
      @param ordered whether an ordered traversal is requested
      @return the <code>TerminalOp</code> instance</div>
<a id="L115" name="L115"></a> 115     <strong class="reserved">public</strong> <strong class="reserved">static</strong> <a href="../S/886.html#L45" title="Defined at 45 in src/java/util/stream/TerminalOp.java.">TerminalOp</a>&lt;<a href="../D/2585.html" title="Multiple defined in 10 places.">Double</a>, <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <a href="../R/22867.html" title="Multiple referred from 13 places.">makeDouble</a>(<a href="../S/978.html#L42" title="Defined at 42 in src/java/util/function/DoubleConsumer.java.">DoubleConsumer</a> <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>,
<a id="L116" name="L116"></a> 116                                                       <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L117" name="L117"></a> 117         <a href="../S/859.html#L38" title="Defined at 38 in src/java/util/Objects.java.">Objects</a>.<a href="../D/31141.html" title="Multiple defined in 4 places.">requireNonNull</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>);
<a id="L118" name="L118"></a> 118         <strong class="reserved">return</strong> <strong class="reserved">new</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>.<a href="../D/6354.html" title="Multiple defined in 22 places.">OfDouble</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>, ordered);
<a id="L119" name="L119"></a> 119     <em class="brace">}</em>
<a id="L120" name="L120"></a> 120 
<div class="comment">
      A <code>TerminalOp</code> that evaluates a stream pipeline and sends the
      output to itself as a <code>TerminalSink</code>.  Elements will be sent in
      whatever thread they become available.  If the traversal is unordered,
      they will be sent independent of the stream's encounter order.
      <p>This terminal operation is stateless.  For parallel evaluation, each
      leaf instance of a <code>ForEachTask</code> will send elements to the same
      <code>TerminalSink</code> reference that is an instance of this class.
      @param <t> the output type of the stream pipeline</t></p></div>
<a id="L133" name="L133"></a> 133     <strong class="reserved">static</strong> <strong class="reserved">abstract</strong> <strong class="reserved">class</strong> <a href="../R/3074.html" title="Multiple referred from 8 places.">ForEachOp</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;
<a id="L134" name="L134"></a> 134             <strong class="reserved">implements</strong> <a href="../S/886.html#L45" title="Defined at 45 in src/java/util/stream/TerminalOp.java.">TerminalOp</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>, <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt;, <a href="../S/902.html#L38" title="Defined at 38 in src/java/util/stream/TerminalSink.java.">TerminalSink</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>, <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <em class="brace">{</em>
<a id="L135" name="L135"></a> 135         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">boolean</strong> ordered;
<a id="L136" name="L136"></a> 136 
<a id="L137" name="L137"></a> 137         <strong class="reserved">protected</strong> ForEachOp(<strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L138" name="L138"></a> 138             <strong class="reserved">this</strong>.ordered = ordered;
<a id="L139" name="L139"></a> 139         <em class="brace">}</em>
<a id="L140" name="L140"></a> 140 
<a id="L141" name="L141"></a> 141         <em class="comment">// TerminalOp</em>
<a id="L142" name="L142"></a> 142 
<a id="L143" name="L143"></a> 143         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L144" name="L144"></a> 144         <strong class="reserved">public</strong> <strong class="reserved">int</strong> <a href="../R/18134.html" title="Multiple referred from 3 places.">getOpFlags</a>() <em class="brace">{</em>
<a id="L145" name="L145"></a> 145             <strong class="reserved">return</strong> ordered ? 0 : <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.NOT_ORDERED;
<a id="L146" name="L146"></a> 146         <em class="brace">}</em>
<a id="L147" name="L147"></a> 147 
<a id="L148" name="L148"></a> 148         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L149" name="L149"></a> 149         <strong class="reserved">public</strong> &lt;S&gt; <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../R/14052.html" title="Multiple referred from 2 places.">evaluateSequential</a>(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; helper,
<a id="L150" name="L150"></a> 150                                            <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L151" name="L151"></a> 151             <strong class="reserved">return</strong> helper.<a href="../D/36958.html" title="Multiple defined in 2 places.">wrapAndCopyInto</a>(<strong class="reserved">this</strong>, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>).<a href="../D/16676.html" title="Multiple defined in 434 places.">get</a>();
<a id="L152" name="L152"></a> 152         <em class="brace">}</em>
<a id="L153" name="L153"></a> 153 
<a id="L154" name="L154"></a> 154         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L155" name="L155"></a> 155         <strong class="reserved">public</strong> &lt;S&gt; <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../R/14051.html" title="Multiple referred from 3 places.">evaluateParallel</a>(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; helper,
<a id="L156" name="L156"></a> 156                                          <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L157" name="L157"></a> 157             <strong class="reserved">if</strong> (ordered)
<a id="L158" name="L158"></a> 158                 <strong class="reserved">new</strong> <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;&gt;(helper, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, <strong class="reserved">this</strong>).<a href="../D/25050.html" title="Multiple defined in 52 places.">invoke</a>();
<a id="L159" name="L159"></a> 159             <strong class="reserved">else</strong>
<a id="L160" name="L160"></a> 160                 <strong class="reserved">new</strong> <a href="../S/908.html#L254" title="Defined at 254 in src/java/util/stream/ForEachOps.java.">ForEachTask</a>&lt;&gt;(helper, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, helper.<a href="../D/36961.html" title="Multiple defined in 2 places.">wrapSink</a>(<strong class="reserved">this</strong>)).<a href="../D/25050.html" title="Multiple defined in 52 places.">invoke</a>();
<a id="L161" name="L161"></a> 161             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L162" name="L162"></a> 162         <em class="brace">}</em>
<a id="L163" name="L163"></a> 163 
<a id="L164" name="L164"></a> 164         <em class="comment">// TerminalSink</em>
<a id="L165" name="L165"></a> 165 
<a id="L166" name="L166"></a> 166         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L167" name="L167"></a> 167         <strong class="reserved">public</strong> <a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a> <a href="../R/14874.html" title="Multiple referred from 4230 places.">get</a>() <em class="brace">{</em>
<a id="L168" name="L168"></a> 168             <strong class="reserved">return</strong> <strong class="reserved">null</strong>;
<a id="L169" name="L169"></a> 169         <em class="brace">}</em>
<a id="L170" name="L170"></a> 170 
<a id="L171" name="L171"></a> 171         <em class="comment">// Implementations</em>
<a id="L172" name="L172"></a> 172 
<div class="comment">
         /** Implementation class for reference streams */</div>
<a id="L174" name="L174"></a> 174         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5794.html" title="Multiple referred from 29 places.">OfRef</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">extends</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <em class="brace">{</em>
<a id="L175" name="L175"></a> 175             <strong class="reserved">final</strong> <a href="../S/963.html#L42" title="Defined at 42 in src/java/util/function/Consumer.java.">Consumer</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; consumer;
<a id="L176" name="L176"></a> 176 
<a id="L177" name="L177"></a> 177             OfRef(<a href="../S/963.html#L42" title="Defined at 42 in src/java/util/function/Consumer.java.">Consumer</a>&lt;? <strong class="reserved">super</strong> <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; consumer, <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L178" name="L178"></a> 178                 <strong class="reserved">super</strong>(ordered);
<a id="L179" name="L179"></a> 179                 <strong class="reserved">this</strong>.consumer = consumer;
<a id="L180" name="L180"></a> 180             <em class="brace">}</em>
<a id="L181" name="L181"></a> 181 
<a id="L182" name="L182"></a> 182             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L183" name="L183"></a> 183             <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9513.html" title="Multiple referred from 551 places.">accept</a>(<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a> t) <em class="brace">{</em>
<a id="L184" name="L184"></a> 184                 consumer.<a href="../D/10537.html" title="Multiple defined in 327 places.">accept</a>(t);
<a id="L185" name="L185"></a> 185             <em class="brace">}</em>
<a id="L186" name="L186"></a> 186         <em class="brace">}</em>
<a id="L187" name="L187"></a> 187 
<div class="comment">
         /** Implementation class for <code>IntStream</code> */</div>
<a id="L189" name="L189"></a> 189         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5791.html" title="Multiple referred from 155 places.">OfInt</a> <strong class="reserved">extends</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>&lt;<a href="../D/4299.html" title="Multiple defined in 4 places.">Integer</a>&gt;
<a id="L190" name="L190"></a> 190                 <strong class="reserved">implements</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>.<a href="../D/6355.html" title="Multiple defined in 22 places.">OfInt</a> <em class="brace">{</em>
<a id="L191" name="L191"></a> 191             <strong class="reserved">final</strong> <a href="../S/962.html#L42" title="Defined at 42 in src/java/util/function/IntConsumer.java.">IntConsumer</a> consumer;
<a id="L192" name="L192"></a> 192 
<a id="L193" name="L193"></a> 193             OfInt(<a href="../S/962.html#L42" title="Defined at 42 in src/java/util/function/IntConsumer.java.">IntConsumer</a> consumer, <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L194" name="L194"></a> 194                 <strong class="reserved">super</strong>(ordered);
<a id="L195" name="L195"></a> 195                 <strong class="reserved">this</strong>.consumer = consumer;
<a id="L196" name="L196"></a> 196             <em class="brace">}</em>
<a id="L197" name="L197"></a> 197 
<a id="L198" name="L198"></a> 198             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L199" name="L199"></a> 199             <strong class="reserved">public</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a> <a href="../R/20746.html" title="Multiple referred from 23 places.">inputShape</a>() <em class="brace">{</em>
<a id="L200" name="L200"></a> 200                 <strong class="reserved">return</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a>.INT_VALUE;
<a id="L201" name="L201"></a> 201             <em class="brace">}</em>
<a id="L202" name="L202"></a> 202 
<a id="L203" name="L203"></a> 203             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L204" name="L204"></a> 204             <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9513.html" title="Multiple referred from 551 places.">accept</a>(<strong class="reserved">int</strong> t) <em class="brace">{</em>
<a id="L205" name="L205"></a> 205                 consumer.<a href="../D/10537.html" title="Multiple defined in 327 places.">accept</a>(t);
<a id="L206" name="L206"></a> 206             <em class="brace">}</em>
<a id="L207" name="L207"></a> 207         <em class="brace">}</em>
<a id="L208" name="L208"></a> 208 
<div class="comment">
         /** Implementation class for <code>LongStream</code> */</div>
<a id="L210" name="L210"></a> 210         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5792.html" title="Multiple referred from 150 places.">OfLong</a> <strong class="reserved">extends</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>&lt;<a href="../S/1720.html#L54" title="Defined at 54 in src/java/lang/Long.java.">Long</a>&gt;
<a id="L211" name="L211"></a> 211                 <strong class="reserved">implements</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>.<a href="../D/6356.html" title="Multiple defined in 22 places.">OfLong</a> <em class="brace">{</em>
<a id="L212" name="L212"></a> 212             <strong class="reserved">final</strong> <a href="../S/947.html#L42" title="Defined at 42 in src/java/util/function/LongConsumer.java.">LongConsumer</a> consumer;
<a id="L213" name="L213"></a> 213 
<a id="L214" name="L214"></a> 214             OfLong(<a href="../S/947.html#L42" title="Defined at 42 in src/java/util/function/LongConsumer.java.">LongConsumer</a> consumer, <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L215" name="L215"></a> 215                 <strong class="reserved">super</strong>(ordered);
<a id="L216" name="L216"></a> 216                 <strong class="reserved">this</strong>.consumer = consumer;
<a id="L217" name="L217"></a> 217             <em class="brace">}</em>
<a id="L218" name="L218"></a> 218 
<a id="L219" name="L219"></a> 219             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L220" name="L220"></a> 220             <strong class="reserved">public</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a> <a href="../R/20746.html" title="Multiple referred from 23 places.">inputShape</a>() <em class="brace">{</em>
<a id="L221" name="L221"></a> 221                 <strong class="reserved">return</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a>.LONG_VALUE;
<a id="L222" name="L222"></a> 222             <em class="brace">}</em>
<a id="L223" name="L223"></a> 223 
<a id="L224" name="L224"></a> 224             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L225" name="L225"></a> 225             <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9513.html" title="Multiple referred from 551 places.">accept</a>(<strong class="reserved">long</strong> t) <em class="brace">{</em>
<a id="L226" name="L226"></a> 226                 consumer.<a href="../D/10537.html" title="Multiple defined in 327 places.">accept</a>(t);
<a id="L227" name="L227"></a> 227             <em class="brace">}</em>
<a id="L228" name="L228"></a> 228         <em class="brace">}</em>
<a id="L229" name="L229"></a> 229 
<div class="comment">
         /** Implementation class for <code>DoubleStream</code> */</div>
<a id="L231" name="L231"></a> 231         <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/5790.html" title="Multiple referred from 148 places.">OfDouble</a> <strong class="reserved">extends</strong> <a href="../S/908.html#L133" title="Defined at 133 in src/java/util/stream/ForEachOps.java.">ForEachOp</a>&lt;<a href="../D/2585.html" title="Multiple defined in 10 places.">Double</a>&gt;
<a id="L232" name="L232"></a> 232                 <strong class="reserved">implements</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>.<a href="../D/6354.html" title="Multiple defined in 22 places.">OfDouble</a> <em class="brace">{</em>
<a id="L233" name="L233"></a> 233             <strong class="reserved">final</strong> <a href="../S/978.html#L42" title="Defined at 42 in src/java/util/function/DoubleConsumer.java.">DoubleConsumer</a> consumer;
<a id="L234" name="L234"></a> 234 
<a id="L235" name="L235"></a> 235             OfDouble(<a href="../S/978.html#L42" title="Defined at 42 in src/java/util/function/DoubleConsumer.java.">DoubleConsumer</a> consumer, <strong class="reserved">boolean</strong> ordered) <em class="brace">{</em>
<a id="L236" name="L236"></a> 236                 <strong class="reserved">super</strong>(ordered);
<a id="L237" name="L237"></a> 237                 <strong class="reserved">this</strong>.consumer = consumer;
<a id="L238" name="L238"></a> 238             <em class="brace">}</em>
<a id="L239" name="L239"></a> 239 
<a id="L240" name="L240"></a> 240             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L241" name="L241"></a> 241             <strong class="reserved">public</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a> <a href="../R/20746.html" title="Multiple referred from 23 places.">inputShape</a>() <em class="brace">{</em>
<a id="L242" name="L242"></a> 242                 <strong class="reserved">return</strong> <a href="../S/900.html#L49" title="Defined at 49 in src/java/util/stream/StreamShape.java.">StreamShape</a>.DOUBLE_VALUE;
<a id="L243" name="L243"></a> 243             <em class="brace">}</em>
<a id="L244" name="L244"></a> 244 
<a id="L245" name="L245"></a> 245             @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L246" name="L246"></a> 246             <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/9513.html" title="Multiple referred from 551 places.">accept</a>(<strong class="reserved">double</strong> t) <em class="brace">{</em>
<a id="L247" name="L247"></a> 247                 consumer.<a href="../D/10537.html" title="Multiple defined in 327 places.">accept</a>(t);
<a id="L248" name="L248"></a> 248             <em class="brace">}</em>
<a id="L249" name="L249"></a> 249         <em class="brace">}</em>
<a id="L250" name="L250"></a> 250     <em class="brace">}</em>
<a id="L251" name="L251"></a> 251 
<div class="comment">
     /** A <code>ForkJoinTask</code> for performing a parallel for-each operation */</div>
<a id="L253" name="L253"></a> 253     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("serial")
<a id="L254" name="L254"></a> 254     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/3077.html" title="Multiple referred from 5 places.">ForEachTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">extends</strong> <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <em class="brace">{</em>
<a id="L255" name="L255"></a> 255         <strong class="reserved">private</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L256" name="L256"></a> 256         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;S&gt; <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>;
<a id="L257" name="L257"></a> 257         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; helper;
<a id="L258" name="L258"></a> 258         <strong class="reserved">private</strong> <strong class="reserved">long</strong> targetSize;
<a id="L259" name="L259"></a> 259 
<a id="L260" name="L260"></a> 260         ForEachTask(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; helper,
<a id="L261" name="L261"></a> 261                     <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>,
<a id="L262" name="L262"></a> 262                     <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;S&gt; <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>) <em class="brace">{</em>
<a id="L263" name="L263"></a> 263             <strong class="reserved">super</strong>(<strong class="reserved">null</strong>);
<a id="L264" name="L264"></a> 264             <strong class="reserved">this</strong>.<a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a> = <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>;
<a id="L265" name="L265"></a> 265             <strong class="reserved">this</strong>.helper = helper;
<a id="L266" name="L266"></a> 266             <strong class="reserved">this</strong>.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L267" name="L267"></a> 267             <strong class="reserved">this</strong>.targetSize = 0L;
<a id="L268" name="L268"></a> 268         <em class="brace">}</em>
<a id="L269" name="L269"></a> 269 
<a id="L270" name="L270"></a> 270         <a href="../S/908.html#L254" title="Defined at 254 in src/java/util/stream/ForEachOps.java.">ForEachTask</a>(ForEachTask&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>, <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>) <em class="brace">{</em>
<a id="L271" name="L271"></a> 271             <strong class="reserved">super</strong>(<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>);
<a id="L272" name="L272"></a> 272             <strong class="reserved">this</strong>.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L273" name="L273"></a> 273             <strong class="reserved">this</strong>.<a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a> = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.<a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>;
<a id="L274" name="L274"></a> 274             <strong class="reserved">this</strong>.targetSize = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.targetSize;
<a id="L275" name="L275"></a> 275             <strong class="reserved">this</strong>.helper = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.helper;
<a id="L276" name="L276"></a> 276         <em class="brace">}</em>
<a id="L277" name="L277"></a> 277 
<a id="L278" name="L278"></a> 278         <em class="comment">// Similar to AbstractTask but doesn't need to track child tasks</em>
<a id="L279" name="L279"></a> 279         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/11810.html" title="Multiple referred from 7 places.">compute</a>() <em class="brace">{</em>
<a id="L280" name="L280"></a> 280             <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; rightSplit = <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, leftSplit;
<a id="L281" name="L281"></a> 281             <strong class="reserved">long</strong> sizeEstimate = rightSplit.<a href="../D/15739.html" title="Multiple defined in 60 places.">estimateSize</a>(), sizeThreshold;
<a id="L282" name="L282"></a> 282             <strong class="reserved">if</strong> ((sizeThreshold = targetSize) == 0L)
<a id="L283" name="L283"></a> 283                 targetSize = sizeThreshold = <a href="../S/905.html#L87" title="Defined at 87 in src/java/util/stream/AbstractTask.java.">AbstractTask</a>.<a href="../S/905.html#L183" title="Defined at 183 in src/java/util/stream/AbstractTask.java.">suggestTargetSize</a>(sizeEstimate);
<a id="L284" name="L284"></a> 284             <strong class="reserved">boolean</strong> isShortCircuit = <a href="../S/915.html#L204" title="Defined at 204 in src/java/util/stream/StreamOpFlag.java.">StreamOpFlag</a>.<a href="../S/915.html#L327" title="Defined at 327 in src/java/util/stream/StreamOpFlag.java.">SHORT_CIRCUIT</a>.<a href="../S/915.html#L490" title="Defined at 490 in src/java/util/stream/StreamOpFlag.java.">isKnown</a>(helper.<a href="../D/22753.html" title="Multiple defined in 2 places.">getStreamAndOpFlags</a>());
<a id="L285" name="L285"></a> 285             <strong class="reserved">boolean</strong> forkRight = <strong class="reserved">false</strong>;
<a id="L286" name="L286"></a> 286             <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;S&gt; taskSink = <a href="../S/2041.html#L139" title="Defined at 139 in src/java/nio/channels/Pipe.java.">sink</a>;
<a id="L287" name="L287"></a> 287             <a href="../S/908.html#L254" title="Defined at 254 in src/java/util/stream/ForEachOps.java.">ForEachTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; task = <strong class="reserved">this</strong>;
<a id="L288" name="L288"></a> 288             <strong class="reserved">while</strong> (!isShortCircuit || !taskSink.<a href="../D/12215.html" title="Multiple defined in 11 places.">cancellationRequested</a>()) <em class="brace">{</em>
<a id="L289" name="L289"></a> 289                 <strong class="reserved">if</strong> (sizeEstimate &lt;= sizeThreshold ||
<a id="L290" name="L290"></a> 290                     (leftSplit = rightSplit.<a href="../D/35738.html" title="Multiple defined in 81 places.">trySplit</a>()) == <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L291" name="L291"></a> 291                     task.helper.<a href="../D/13501.html" title="Multiple defined in 23 places.">copyInto</a>(taskSink, rightSplit);
<a id="L292" name="L292"></a> 292                     <strong class="reserved">break</strong>;
<a id="L293" name="L293"></a> 293                 <em class="brace">}</em>
<a id="L294" name="L294"></a> 294                 <a href="../S/908.html#L254" title="Defined at 254 in src/java/util/stream/ForEachOps.java.">ForEachTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; leftTask = <strong class="reserved">new</strong> <a href="../S/908.html#L254" title="Defined at 254 in src/java/util/stream/ForEachOps.java.">ForEachTask</a>&lt;&gt;(task, leftSplit);
<a id="L295" name="L295"></a> 295                 task.<a href="../S/1070.html#L525" title="Defined at 525 in src/java/util/concurrent/CountedCompleter.java.">addToPendingCount</a>(1);
<a id="L296" name="L296"></a> 296                 <a href="../S/908.html#L254" title="Defined at 254 in src/java/util/stream/ForEachOps.java.">ForEachTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; taskToFork;
<a id="L297" name="L297"></a> 297                 <strong class="reserved">if</strong> (forkRight) <em class="brace">{</em>
<a id="L298" name="L298"></a> 298                     forkRight = <strong class="reserved">false</strong>;
<a id="L299" name="L299"></a> 299                     rightSplit = leftSplit;
<a id="L300" name="L300"></a> 300                     taskToFork = task;
<a id="L301" name="L301"></a> 301                     task = leftTask;
<a id="L302" name="L302"></a> 302                 <em class="brace">}</em>
<a id="L303" name="L303"></a> 303                 <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L304" name="L304"></a> 304                     forkRight = <strong class="reserved">true</strong>;
<a id="L305" name="L305"></a> 305                     taskToFork = leftTask;
<a id="L306" name="L306"></a> 306                 <em class="brace">}</em>
<a id="L307" name="L307"></a> 307                 taskToFork.<a href="../S/1101.html#L697" title="Defined at 697 in src/java/util/concurrent/ForkJoinTask.java.">fork</a>();
<a id="L308" name="L308"></a> 308                 sizeEstimate = rightSplit.<a href="../D/15739.html" title="Multiple defined in 60 places.">estimateSize</a>();
<a id="L309" name="L309"></a> 309             <em class="brace">}</em>
<a id="L310" name="L310"></a> 310             task.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <strong class="reserved">null</strong>;
<a id="L311" name="L311"></a> 311             task.<a href="../S/1070.html#L597" title="Defined at 597 in src/java/util/concurrent/CountedCompleter.java.">propagateCompletion</a>();
<a id="L312" name="L312"></a> 312         <em class="brace">}</em>
<a id="L313" name="L313"></a> 313     <em class="brace">}</em>
<a id="L314" name="L314"></a> 314 
<div class="comment">
      A <code>ForkJoinTask</code> for performing a parallel for-each operation
      which visits the elements in encounter order</div>
<a id="L319" name="L319"></a> 319     @<a href="../R/7764.html" title="Multiple referred from 264 places.">SuppressWarnings</a>("serial")
<a id="L320" name="L320"></a> 320     <strong class="reserved">static</strong> <strong class="reserved">final</strong> <strong class="reserved">class</strong> <a href="../R/3076.html" title="Multiple referred from 12 places.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">extends</strong> <a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;<a href="../S/1638.html#L37" title="Defined at 37 in src/java/lang/Void.java.">Void</a>&gt; <em class="brace">{</em>
<div class="comment">
          Our goal is to ensure that the elements associated with a task are
          processed according to an in-order traversal of the computation tree.
          We use completion counts for representing these dependencies, so that
          a task does not complete until all the tasks preceding it in this
          order complete.  We use the "completion map" to associate the next
          task in this order for any left child.  We increase the pending count
          of any node on the right side of such a mapping by one to indicate
          its dependency, and when a node on the left side of such a mapping
          completes, it decrements the pending count of its corresponding right
          side.  As the computation tree is expanded by splitting, we must
          atomically update the mappings to maintain the invariant that the
          completion map maps left children to the next node in the in-order
          traversal.
          Take, for example, the following computation tree of tasks:
                a
               / \
              b   c
             / \ / \
            d  e f  g
          The complete map will contain (not necessarily all at the same time)
          the following associations:
            d -&gt; e
            b -&gt; f
            f -&gt; g
          Tasks e, f, g will have their pending counts increased by 1.
          The following relationships hold:
            - completion of d "happens-before" e;
            - completion of d and e "happens-before b;
            - completion of b "happens-before" f; and
            - completion of f "happens-before" g
          Thus overall the "happens-before" relationship holds for the
          reporting of elements, covered by tasks d, e, f and g, as specified
          by the forEachOrdered operation.</div>
<a id="L364" name="L364"></a> 364 
<a id="L365" name="L365"></a> 365         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; helper;
<a id="L366" name="L366"></a> 366         <strong class="reserved">private</strong> <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L367" name="L367"></a> 367         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <strong class="reserved">long</strong> targetSize;
<a id="L368" name="L368"></a> 368         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/1074.html#L267" title="Defined at 267 in src/java/util/concurrent/ConcurrentHashMap.java.">ConcurrentHashMap</a>&lt;<a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;, <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt;&gt; completionMap;
<a id="L369" name="L369"></a> 369         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>;
<a id="L370" name="L370"></a> 370         <strong class="reserved">private</strong> <strong class="reserved">final</strong> <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; leftPredecessor;
<a id="L371" name="L371"></a> 371         <strong class="reserved">private</strong> <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>;
<a id="L372" name="L372"></a> 372 
<a id="L373" name="L373"></a> 373         <strong class="reserved">protected</strong> ForEachOrderedTask(<a href="../S/885.html#L55" title="Defined at 55 in src/java/util/stream/PipelineHelper.java.">PipelineHelper</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; helper,
<a id="L374" name="L374"></a> 374                                      <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>,
<a id="L375" name="L375"></a> 375                                      <a href="../S/896.html#L117" title="Defined at 117 in src/java/util/stream/Sink.java.">Sink</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>) <em class="brace">{</em>
<a id="L376" name="L376"></a> 376             <strong class="reserved">super</strong>(<strong class="reserved">null</strong>);
<a id="L377" name="L377"></a> 377             <strong class="reserved">this</strong>.helper = helper;
<a id="L378" name="L378"></a> 378             <strong class="reserved">this</strong>.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L379" name="L379"></a> 379             <strong class="reserved">this</strong>.targetSize = <a href="../S/905.html#L87" title="Defined at 87 in src/java/util/stream/AbstractTask.java.">AbstractTask</a>.<a href="../S/905.html#L183" title="Defined at 183 in src/java/util/stream/AbstractTask.java.">suggestTargetSize</a>(<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>.<a href="../D/15739.html" title="Multiple defined in 60 places.">estimateSize</a>());
<a id="L380" name="L380"></a> 380             <em class="comment">// Size map to avoid concurrent re-sizes</em>
<a id="L381" name="L381"></a> 381             <strong class="reserved">this</strong>.completionMap = <strong class="reserved">new</strong> <a href="../S/1074.html#L267" title="Defined at 267 in src/java/util/concurrent/ConcurrentHashMap.java.">ConcurrentHashMap</a>&lt;&gt;(<a href="../S/1768.html#L105" title="Defined at 105 in src/java/lang/Math.java.">Math</a>.<a href="../D/27569.html" title="Multiple defined in 28 places.">max</a>(16, <a href="../S/905.html#L87" title="Defined at 87 in src/java/util/stream/AbstractTask.java.">AbstractTask</a>.LEAF_TARGET &lt;&lt; 1));
<a id="L382" name="L382"></a> 382             <strong class="reserved">this</strong>.<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a> = <a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>;
<a id="L383" name="L383"></a> 383             <strong class="reserved">this</strong>.leftPredecessor = <strong class="reserved">null</strong>;
<a id="L384" name="L384"></a> 384         <em class="brace">}</em>
<a id="L385" name="L385"></a> 385 
<a id="L386" name="L386"></a> 386         <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>(ForEachOrderedTask&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>,
<a id="L387" name="L387"></a> 387                            <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>,
<a id="L388" name="L388"></a> 388                            <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; leftPredecessor) <em class="brace">{</em>
<a id="L389" name="L389"></a> 389             <strong class="reserved">super</strong>(<a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>);
<a id="L390" name="L390"></a> 390             <strong class="reserved">this</strong>.helper = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.helper;
<a id="L391" name="L391"></a> 391             <strong class="reserved">this</strong>.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>;
<a id="L392" name="L392"></a> 392             <strong class="reserved">this</strong>.targetSize = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.targetSize;
<a id="L393" name="L393"></a> 393             <strong class="reserved">this</strong>.completionMap = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.completionMap;
<a id="L394" name="L394"></a> 394             <strong class="reserved">this</strong>.<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a> = <a href="../D/29067.html" title="Multiple defined in 4 places.">parent</a>.<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>;
<a id="L395" name="L395"></a> 395             <strong class="reserved">this</strong>.leftPredecessor = leftPredecessor;
<a id="L396" name="L396"></a> 396         <em class="brace">}</em>
<a id="L397" name="L397"></a> 397 
<a id="L398" name="L398"></a> 398         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L399" name="L399"></a> 399         <strong class="reserved">public</strong> <strong class="reserved">final</strong> <strong class="reserved">void</strong> <a href="../R/11810.html" title="Multiple referred from 7 places.">compute</a>() <em class="brace">{</em>
<a id="L400" name="L400"></a> 400             <a href="../S/908.html#L403" title="Defined at 403 in src/java/util/stream/ForEachOps.java.">doCompute</a>(<strong class="reserved">this</strong>);
<a id="L401" name="L401"></a> 401         <em class="brace">}</em>
<a id="L402" name="L402"></a> 402 
<a id="L403" name="L403"></a> 403         <strong class="reserved">private</strong> <strong class="reserved">static</strong> &lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; <strong class="reserved">void</strong> <a href="../S/908.html#L400" title="Referred from 400 in src/java/util/stream/ForEachOps.java.">doCompute</a>(<a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; task) <em class="brace">{</em>
<a id="L404" name="L404"></a> 404             <a href="../S/1151.html#L296" title="Defined at 296 in src/java/util/Spliterator.java.">Spliterator</a>&lt;S&gt; rightSplit = task.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>, leftSplit;
<a id="L405" name="L405"></a> 405             <strong class="reserved">long</strong> sizeThreshold = task.targetSize;
<a id="L406" name="L406"></a> 406             <strong class="reserved">boolean</strong> forkRight = <strong class="reserved">false</strong>;
<a id="L407" name="L407"></a> 407             <strong class="reserved">while</strong> (rightSplit.<a href="../D/15739.html" title="Multiple defined in 60 places.">estimateSize</a>() &gt; sizeThreshold &amp;&amp;
<a id="L408" name="L408"></a> 408                    (leftSplit = rightSplit.<a href="../D/35738.html" title="Multiple defined in 81 places.">trySplit</a>()) != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L409" name="L409"></a> 409                 <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; leftChild =
<a id="L410" name="L410"></a> 410                     <strong class="reserved">new</strong> <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;&gt;(task, leftSplit, task.leftPredecessor);
<a id="L411" name="L411"></a> 411                 <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; rightChild =
<a id="L412" name="L412"></a> 412                     <strong class="reserved">new</strong> <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;&gt;(task, rightSplit, leftChild);
<a id="L413" name="L413"></a> 413 
<a id="L414" name="L414"></a> 414                 <em class="comment">// Fork the parent task</em>
<a id="L415" name="L415"></a> 415                 <em class="comment">// Completion of the left and right children "happens-before"</em>
<a id="L416" name="L416"></a> 416                 <em class="comment">// completion of the parent</em>
<a id="L417" name="L417"></a> 417                 task.<a href="../S/1070.html#L525" title="Defined at 525 in src/java/util/concurrent/CountedCompleter.java.">addToPendingCount</a>(1);
<a id="L418" name="L418"></a> 418                 <em class="comment">// Completion of the left child "happens-before" completion of</em>
<a id="L419" name="L419"></a> 419                 <em class="comment">// the right child</em>
<a id="L420" name="L420"></a> 420                 rightChild.<a href="../S/1070.html#L525" title="Defined at 525 in src/java/util/concurrent/CountedCompleter.java.">addToPendingCount</a>(1);
<a id="L421" name="L421"></a> 421                 task.completionMap.<a href="../D/29971.html" title="Multiple defined in 370 places.">put</a>(leftChild, rightChild);
<a id="L422" name="L422"></a> 422 
<a id="L423" name="L423"></a> 423                 <em class="comment">// If task is not on the left spine</em>
<a id="L424" name="L424"></a> 424                 <strong class="reserved">if</strong> (task.leftPredecessor != <strong class="reserved">null</strong>) <em class="brace">{</em>
<div class="comment">
                      Completion of left-predecessor, or left subtree,
                      "happens-before" completion of left-most leaf node of
                      right subtree.
                      The left child's pending count needs to be updated before
                      it is associated in the completion map, otherwise the
                      left child can complete prematurely and violate the
                      "happens-before" constraint.</div>
<a id="L434" name="L434"></a> 434                     leftChild.<a href="../S/1070.html#L525" title="Defined at 525 in src/java/util/concurrent/CountedCompleter.java.">addToPendingCount</a>(1);
<a id="L435" name="L435"></a> 435                     <em class="comment">// Update association of left-predecessor to left-most</em>
<a id="L436" name="L436"></a> 436                     <em class="comment">// leaf node of right subtree</em>
<a id="L437" name="L437"></a> 437                     <strong class="reserved">if</strong> (task.completionMap.<a href="../D/31035.html" title="Multiple defined in 65 places.">replace</a>(task.leftPredecessor, task, leftChild)) <em class="brace">{</em>
<a id="L438" name="L438"></a> 438                         <em class="comment">// If replaced, adjust the pending count of the parent</em>
<a id="L439" name="L439"></a> 439                         <em class="comment">// to complete when its children complete</em>
<a id="L440" name="L440"></a> 440                         task.<a href="../S/1070.html#L525" title="Defined at 525 in src/java/util/concurrent/CountedCompleter.java.">addToPendingCount</a>(-1);
<a id="L441" name="L441"></a> 441                     <em class="brace">}</em> <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L442" name="L442"></a> 442                         <em class="comment">// Left-predecessor has already completed, parent's</em>
<a id="L443" name="L443"></a> 443                         <em class="comment">// pending count is adjusted by left-predecessor;</em>
<a id="L444" name="L444"></a> 444                         <em class="comment">// left child is ready to complete</em>
<a id="L445" name="L445"></a> 445                         leftChild.<a href="../S/1070.html#L525" title="Defined at 525 in src/java/util/concurrent/CountedCompleter.java.">addToPendingCount</a>(-1);
<a id="L446" name="L446"></a> 446                     <em class="brace">}</em>
<a id="L447" name="L447"></a> 447                 <em class="brace">}</em>
<a id="L448" name="L448"></a> 448 
<a id="L449" name="L449"></a> 449                 <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; taskToFork;
<a id="L450" name="L450"></a> 450                 <strong class="reserved">if</strong> (forkRight) <em class="brace">{</em>
<a id="L451" name="L451"></a> 451                     forkRight = <strong class="reserved">false</strong>;
<a id="L452" name="L452"></a> 452                     rightSplit = leftSplit;
<a id="L453" name="L453"></a> 453                     task = leftChild;
<a id="L454" name="L454"></a> 454                     taskToFork = rightChild;
<a id="L455" name="L455"></a> 455                 <em class="brace">}</em>
<a id="L456" name="L456"></a> 456                 <strong class="reserved">else</strong> <em class="brace">{</em>
<a id="L457" name="L457"></a> 457                     forkRight = <strong class="reserved">true</strong>;
<a id="L458" name="L458"></a> 458                     task = rightChild;
<a id="L459" name="L459"></a> 459                     taskToFork = leftChild;
<a id="L460" name="L460"></a> 460                 <em class="brace">}</em>
<a id="L461" name="L461"></a> 461                 taskToFork.<a href="../S/1101.html#L697" title="Defined at 697 in src/java/util/concurrent/ForkJoinTask.java.">fork</a>();
<a id="L462" name="L462"></a> 462             <em class="brace">}</em>
<a id="L463" name="L463"></a> 463 
<div class="comment">
              Task's pending count is either 0 or 1.  If 1 then the completion
              map will contain a value that is task, and two calls to
              tryComplete are required for completion, one below and one
              triggered by the completion of task's left-predecessor in
              onCompletion.  Therefore there is no data race within the if
              block.</div>
<a id="L472" name="L472"></a> 472             <strong class="reserved">if</strong> (task.<a href="../S/1070.html#L507" title="Defined at 507 in src/java/util/concurrent/CountedCompleter.java.">getPendingCount</a>() &gt; 0) <em class="brace">{</em>
<a id="L473" name="L473"></a> 473                 <em class="comment">// Cannot complete just yet so buffer elements into a Node</em>
<a id="L474" name="L474"></a> 474                 <em class="comment">// for use when completion occurs</em>
<a id="L475" name="L475"></a> 475                 @<a href="../D/8551.html" title="Multiple defined in 725 places.">SuppressWarnings</a>("unchecked")
<a id="L476" name="L476"></a> 476                 <a href="../S/980.html#L41" title="Defined at 41 in src/java/util/function/IntFunction.java.">IntFunction</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[]&gt; generator = <a href="../D/34593.html" title="Multiple defined in 204 places.">size</a> -&gt; (<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>[]) <strong class="reserved">new</strong> <a href="../D/6272.html" title="Multiple defined in 7 places.">Object</a>[<a href="../D/34593.html" title="Multiple defined in 204 places.">size</a>];
<a id="L477" name="L477"></a> 477                 <a href="../D/6077.html" title="Multiple defined in 24 places.">Node</a>.<a href="../D/1017.html" title="Multiple defined in 9 places.">Builder</a>&lt;<a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; nb = task.helper.<a href="../D/27342.html" title="Multiple defined in 6 places.">makeNodeBuilder</a>(
<a id="L478" name="L478"></a> 478                         task.helper.<a href="../D/15762.html" title="Multiple defined in 2 places.">exactOutputSizeIfKnown</a>(rightSplit),
<a id="L479" name="L479"></a> 479                         generator);
<a id="L480" name="L480"></a> 480                 task.<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = task.helper.<a href="../D/36958.html" title="Multiple defined in 2 places.">wrapAndCopyInto</a>(nb, rightSplit).<a href="../D/11931.html" title="Multiple defined in 27 places.">build</a>();
<a id="L481" name="L481"></a> 481                 task.<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <strong class="reserved">null</strong>;
<a id="L482" name="L482"></a> 482             <em class="brace">}</em>
<a id="L483" name="L483"></a> 483             task.<a href="../S/1070.html#L573" title="Defined at 573 in src/java/util/concurrent/CountedCompleter.java.">tryComplete</a>();
<a id="L484" name="L484"></a> 484         <em class="brace">}</em>
<a id="L485" name="L485"></a> 485 
<a id="L486" name="L486"></a> 486         @<a href="../S/1740.html#L51" title="Defined at 51 in src/java/lang/Override.java.">Override</a>
<a id="L487" name="L487"></a> 487         <strong class="reserved">public</strong> <strong class="reserved">void</strong> <a href="../R/23948.html" title="Multiple referred from 6 places.">onCompletion</a>(<a href="../S/1070.html#L411" title="Defined at 411 in src/java/util/concurrent/CountedCompleter.java.">CountedCompleter</a>&lt;?&gt; caller) <em class="brace">{</em>
<a id="L488" name="L488"></a> 488             <strong class="reserved">if</strong> (<a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L489" name="L489"></a> 489                 <em class="comment">// Dump buffered elements from this leaf into the sink</em>
<a id="L490" name="L490"></a> 490                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a>.<a href="../D/16509.html" title="Multiple defined in 84 places.">forEach</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>);
<a id="L491" name="L491"></a> 491                 <a href="../D/28235.html" title="Multiple defined in 11 places.">node</a> = <strong class="reserved">null</strong>;
<a id="L492" name="L492"></a> 492             <em class="brace">}</em>
<a id="L493" name="L493"></a> 493             <strong class="reserved">else</strong> <strong class="reserved">if</strong> (<a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> != <strong class="reserved">null</strong>) <em class="brace">{</em>
<a id="L494" name="L494"></a> 494                 <em class="comment">// Dump elements output from this leaf's pipeline into the sink</em>
<a id="L495" name="L495"></a> 495                 helper.<a href="../D/36958.html" title="Multiple defined in 2 places.">wrapAndCopyInto</a>(<a href="../D/10591.html" title="Multiple defined in 3 places.">action</a>, <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a>);
<a id="L496" name="L496"></a> 496                 <a href="../D/34729.html" title="Multiple defined in 111 places.">spliterator</a> = <strong class="reserved">null</strong>;
<a id="L497" name="L497"></a> 497             <em class="brace">}</em>
<a id="L498" name="L498"></a> 498 
<a id="L499" name="L499"></a> 499             <em class="comment">// The completion of this task *and* the dumping of elements</em>
<a id="L500" name="L500"></a> 500             <em class="comment">// "happens-before" completion of the associated left-most leaf task</em>
<a id="L501" name="L501"></a> 501             <em class="comment">// of right subtree (if any, which can be this task's right sibling)</em>
<a id="L502" name="L502"></a> 502             <em class="comment">//</em>
<a id="L503" name="L503"></a> 503             <a href="../S/908.html#L320" title="Defined at 320 in src/java/util/stream/ForEachOps.java.">ForEachOrderedTask</a>&lt;S, <a href="../D/8701.html" title="Multiple defined in 3 places.">T</a>&gt; leftDescendant = completionMap.<a href="../D/30677.html" title="Multiple defined in 356 places.">remove</a>(<strong class="reserved">this</strong>);
<a id="L504" name="L504"></a> 504             <strong class="reserved">if</strong> (leftDescendant != <strong class="reserved">null</strong>)
<a id="L505" name="L505"></a> 505                 leftDescendant.<a href="../S/1070.html#L573" title="Defined at 573 in src/java/util/concurrent/CountedCompleter.java.">tryComplete</a>();
<a id="L506" name="L506"></a> 506         <em class="brace">}</em>
<a id="L507" name="L507"></a> 507     <em class="brace">}</em>
<a id="L508" name="L508"></a> 508 <em class="brace">}</em>
</pre>
<hr>
<div class="comment">
/* [&lt;][&gt;]<a href="#L70">[^]</a><a href="#L487">[v]</a><a href="#TOP">[top]</a>[bottom]<a href="../mains.html">[index]</a><a href="../help.html">[help]</a> */</div>
</body></html>